<html><head><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2018 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2017-2018 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE
The complete set of authors may be found at http://polymer.github.io/AUTHORS
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS
--><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2016 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2016-2017 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2016-2018 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2015-2016 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2015-2017 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2015-2020 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2017 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!--
@license
IBM Confidential - OCO Source Materials - (C) COPYRIGHT IBM CORP. 2015-2018 - The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
--><meta charset="UTF-8"></head><body><div hidden="" by-vulcanize="">

<script>(function () {
function resolve() {
document.body.removeAttribute('unresolved');
}
if (window.WebComponents) {
addEventListener('WebComponentsReady', resolve);
} else {
if (document.readyState === 'interactive' || document.readyState === 'complete') {
resolve();
} else {
addEventListener('DOMContentLoaded', resolve);
}
}
}());window.Polymer = {
Settings: function () {
var settings = window.Polymer || {};
if (!settings.noUrlSettings) {
var parts = location.search.slice(1).split('&');
for (var i = 0, o; i < parts.length && (o = parts[i]); i++) {
o = o.split('=');
o[0] && (settings[o[0]] = o[1] || true);
}
}
settings.wantShadow = settings.dom === 'shadow';
settings.hasShadow = Boolean(Element.prototype.createShadowRoot);
settings.nativeShadow = settings.hasShadow && !window.ShadowDOMPolyfill;
settings.useShadow = settings.wantShadow && settings.hasShadow;
settings.hasNativeImports = Boolean('import' in document.createElement('link'));
settings.useNativeImports = settings.hasNativeImports;
settings.useNativeCustomElements = !window.CustomElements || window.CustomElements.useNative;
settings.useNativeShadow = settings.useShadow && settings.nativeShadow;
settings.usePolyfillProto = !settings.useNativeCustomElements && !Object.__proto__;
settings.hasNativeCSSProperties = !navigator.userAgent.match('AppleWebKit/601') && window.CSS && CSS.supports && CSS.supports('box-shadow', '0 0 0 var(--foo)');
settings.useNativeCSSProperties = settings.hasNativeCSSProperties && settings.lazyRegister && settings.useNativeCSSProperties;
return settings;
}()
};(function () {
var userPolymer = window.Polymer;
window.Polymer = function (prototype) {
if (typeof prototype === 'function') {
prototype = prototype.prototype;
}
if (!prototype) {
prototype = {};
}
var factory = desugar(prototype);
prototype = factory.prototype;
var options = { prototype: prototype };
if (prototype.extends) {
options.extends = prototype.extends;
}
Polymer.telemetry._registrate(prototype);
document.registerElement(prototype.is, options);
return factory;
};
var desugar = function (prototype) {
var base = Polymer.Base;
if (prototype.extends) {
base = Polymer.Base._getExtendedPrototype(prototype.extends);
}
prototype = Polymer.Base.chainObject(prototype, base);
prototype.registerCallback();
return prototype.constructor;
};
if (userPolymer) {
for (var i in userPolymer) {
Polymer[i] = userPolymer[i];
}
}
Polymer.Class = desugar;
}());
Polymer.telemetry = {
registrations: [],
_regLog: function (prototype) {
console.log('[' + prototype.is + ']: registered');
},
_registrate: function (prototype) {
this.registrations.push(prototype);
Polymer.log && this._regLog(prototype);
},
dumpRegistrations: function () {
this.registrations.forEach(this._regLog);
}
};Object.defineProperty(window, 'currentImport', {
enumerable: true,
configurable: true,
get: function () {
return (document._currentScript || document.currentScript).ownerDocument;
}
});Polymer.RenderStatus = {
_ready: false,
_callbacks: [],
whenReady: function (cb) {
if (this._ready) {
cb();
} else {
this._callbacks.push(cb);
}
},
_makeReady: function () {
this._ready = true;
for (var i = 0; i < this._callbacks.length; i++) {
this._callbacks[i]();
}
this._callbacks = [];
},
_catchFirstRender: function () {
requestAnimationFrame(function () {
Polymer.RenderStatus._makeReady();
});
},
_afterNextRenderQueue: [],
_waitingNextRender: false,
afterNextRender: function (element, fn, args) {
this._watchNextRender();
this._afterNextRenderQueue.push([
element,
fn,
args
]);
},
hasRendered: function () {
return this._ready;
},
_watchNextRender: function () {
if (!this._waitingNextRender) {
this._waitingNextRender = true;
var fn = function () {
Polymer.RenderStatus._flushNextRender();
};
if (!this._ready) {
this.whenReady(fn);
} else {
requestAnimationFrame(fn);
}
}
},
_flushNextRender: function () {
var self = this;
setTimeout(function () {
self._flushRenderCallbacks(self._afterNextRenderQueue);
self._afterNextRenderQueue = [];
self._waitingNextRender = false;
});
},
_flushRenderCallbacks: function (callbacks) {
for (var i = 0, h; i < callbacks.length; i++) {
h = callbacks[i];
h[1].apply(h[0], h[2] || Polymer.nar);
}
}
};
if (window.HTMLImports) {
HTMLImports.whenReady(function () {
Polymer.RenderStatus._catchFirstRender();
});
} else {
Polymer.RenderStatus._catchFirstRender();
}
Polymer.ImportStatus = Polymer.RenderStatus;
Polymer.ImportStatus.whenLoaded = Polymer.ImportStatus.whenReady;(function () {
'use strict';
var settings = Polymer.Settings;
Polymer.Base = {
__isPolymerInstance__: true,
_addFeature: function (feature) {
this.extend(this, feature);
},
registerCallback: function () {
if (settings.lazyRegister === 'max') {
if (this.beforeRegister) {
this.beforeRegister();
}
} else {
this._desugarBehaviors();
this._doBehavior('beforeRegister');
}
this._registerFeatures();
if (!settings.lazyRegister) {
this.ensureRegisterFinished();
}
},
createdCallback: function () {
if (!this.__hasRegisterFinished) {
this._ensureRegisterFinished(this.__proto__);
}
Polymer.telemetry.instanceCount++;
this.root = this;
this._doBehavior('created');
this._initFeatures();
},
ensureRegisterFinished: function () {
this._ensureRegisterFinished(this);
},
_ensureRegisterFinished: function (proto) {
if (proto.__hasRegisterFinished !== proto.is || !proto.is) {
if (settings.lazyRegister === 'max') {
proto._desugarBehaviors();
proto._doBehaviorOnly('beforeRegister');
}
proto.__hasRegisterFinished = proto.is;
if (proto._finishRegisterFeatures) {
proto._finishRegisterFeatures();
}
proto._doBehavior('registered');
if (settings.usePolyfillProto && proto !== this) {
proto.extend(this, proto);
}
}
},
attachedCallback: function () {
var self = this;
Polymer.RenderStatus.whenReady(function () {
self.isAttached = true;
self._doBehavior('attached');
});
},
detachedCallback: function () {
var self = this;
Polymer.RenderStatus.whenReady(function () {
self.isAttached = false;
self._doBehavior('detached');
});
},
attributeChangedCallback: function (name, oldValue, newValue) {
this._attributeChangedImpl(name);
this._doBehavior('attributeChanged', [
name,
oldValue,
newValue
]);
},
_attributeChangedImpl: function (name) {
this._setAttributeToProperty(this, name);
},
extend: function (target, source) {
if (target && source) {
var n$ = Object.getOwnPropertyNames(source);
for (var i = 0, n; i < n$.length && (n = n$[i]); i++) {
this.copyOwnProperty(n, source, target);
}
}
return target || source;
},
mixin: function (target, source) {
for (var i in source) {
target[i] = source[i];
}
return target;
},
copyOwnProperty: function (name, source, target) {
var pd = Object.getOwnPropertyDescriptor(source, name);
if (pd) {
Object.defineProperty(target, name, pd);
}
},
_logger: function (level, args) {
if (args.length === 1 && Array.isArray(args[0])) {
args = args[0];
}
switch (level) {
case 'log':
case 'warn':
case 'error':
console[level].apply(console, args);
break;
}
},
_log: function () {
var args = Array.prototype.slice.call(arguments, 0);
this._logger('log', args);
},
_warn: function () {
var args = Array.prototype.slice.call(arguments, 0);
this._logger('warn', args);
},
_error: function () {
var args = Array.prototype.slice.call(arguments, 0);
this._logger('error', args);
},
_logf: function () {
return this._logPrefix.concat(this.is).concat(Array.prototype.slice.call(arguments, 0));
}
};
Polymer.Base._logPrefix = function () {
var color = window.chrome && !/edge/i.test(navigator.userAgent) || /firefox/i.test(navigator.userAgent);
return color ? [
'%c[%s::%s]:',
'font-weight: bold; background-color:#EEEE00;'
] : ['[%s::%s]:'];
}();
Polymer.Base.chainObject = function (object, inherited) {
if (object && inherited && object !== inherited) {
if (!Object.__proto__) {
object = Polymer.Base.extend(Object.create(inherited), object);
}
object.__proto__ = inherited;
}
return object;
};
Polymer.Base = Polymer.Base.chainObject(Polymer.Base, HTMLElement.prototype);
if (window.CustomElements) {
Polymer.instanceof = CustomElements.instanceof;
} else {
Polymer.instanceof = function (obj, ctor) {
return obj instanceof ctor;
};
}
Polymer.isInstance = function (obj) {
return Boolean(obj && obj.__isPolymerInstance__);
};
Polymer.telemetry.instanceCount = 0;
}());(function () {
var modules = {};
var lcModules = {};
var findModule = function (id) {
return modules[id] || lcModules[id.toLowerCase()];
};
var DomModule = function () {
return document.createElement('dom-module');
};
DomModule.prototype = Object.create(HTMLElement.prototype);
Polymer.Base.extend(DomModule.prototype, {
constructor: DomModule,
createdCallback: function () {
this.register();
},
register: function (id) {
id = id || this.id || this.getAttribute('name') || this.getAttribute('is');
if (id) {
this.id = id;
modules[id] = this;
lcModules[id.toLowerCase()] = this;
}
},
import: function (id, selector) {
if (id) {
var m = findModule(id);
if (!m) {
forceDomModulesUpgrade();
m = findModule(id);
}
if (m && selector) {
m = m.querySelector(selector);
}
return m;
}
}
});
var cePolyfill = window.CustomElements && !CustomElements.useNative;
document.registerElement('dom-module', DomModule);
function forceDomModulesUpgrade() {
if (cePolyfill) {
var script = document._currentScript || document.currentScript;
var doc = script && script.ownerDocument || document;
var modules = doc.querySelectorAll('dom-module');
for (var i = modules.length - 1, m; i >= 0 && (m = modules[i]); i--) {
if (m.__upgraded__) {
return;
} else {
CustomElements.upgrade(m);
}
}
}
}
}());Polymer.Base._addFeature({
_prepIs: function () {
if (!this.is) {
var module = (document._currentScript || document.currentScript).parentNode;
if (module.localName === 'dom-module') {
var id = module.id || module.getAttribute('name') || module.getAttribute('is');
this.is = id;
}
}
if (this.is) {
this.is = this.is.toLowerCase();
}
}
});Polymer.Base._addFeature({
behaviors: [],
_desugarBehaviors: function () {
if (this.behaviors.length) {
this.behaviors = this._desugarSomeBehaviors(this.behaviors);
}
},
_desugarSomeBehaviors: function (behaviors) {
var behaviorSet = [];
behaviors = this._flattenBehaviorsList(behaviors);
for (var i = behaviors.length - 1; i >= 0; i--) {
var b = behaviors[i];
if (behaviorSet.indexOf(b) === -1) {
this._mixinBehavior(b);
behaviorSet.unshift(b);
}
}
return behaviorSet;
},
_flattenBehaviorsList: function (behaviors) {
var flat = [];
for (var i = 0; i < behaviors.length; i++) {
var b = behaviors[i];
if (b instanceof Array) {
flat = flat.concat(this._flattenBehaviorsList(b));
} else if (b) {
flat.push(b);
} else {
this._warn(this._logf('_flattenBehaviorsList', 'behavior is null, check for missing or 404 import'));
}
}
return flat;
},
_mixinBehavior: function (b) {
var n$ = Object.getOwnPropertyNames(b);
for (var i = 0, n; i < n$.length && (n = n$[i]); i++) {
if (!Polymer.Base._behaviorProperties[n] && !this.hasOwnProperty(n)) {
this.copyOwnProperty(n, b, this);
}
}
},
_prepBehaviors: function () {
this._prepFlattenedBehaviors(this.behaviors);
},
_prepFlattenedBehaviors: function (behaviors) {
for (var i = 0, l = behaviors.length; i < l; i++) {
this._prepBehavior(behaviors[i]);
}
this._prepBehavior(this);
},
_doBehavior: function (name, args) {
for (var i = 0; i < this.behaviors.length; i++) {
this._invokeBehavior(this.behaviors[i], name, args);
}
this._invokeBehavior(this, name, args);
},
_doBehaviorOnly: function (name, args) {
for (var i = 0; i < this.behaviors.length; i++) {
this._invokeBehavior(this.behaviors[i], name, args);
}
},
_invokeBehavior: function (b, name, args) {
var fn = b[name];
if (fn) {
fn.apply(this, args || Polymer.nar);
}
},
_marshalBehaviors: function () {
for (var i = 0; i < this.behaviors.length; i++) {
this._marshalBehavior(this.behaviors[i]);
}
this._marshalBehavior(this);
}
});
Polymer.Base._behaviorProperties = {
hostAttributes: true,
beforeRegister: true,
registered: true,
properties: true,
observers: true,
listeners: true,
created: true,
attached: true,
detached: true,
attributeChanged: true,
ready: true
};Polymer.Base._addFeature({
_getExtendedPrototype: function (tag) {
return this._getExtendedNativePrototype(tag);
},
_nativePrototypes: {},
_getExtendedNativePrototype: function (tag) {
var p = this._nativePrototypes[tag];
if (!p) {
var np = this.getNativePrototype(tag);
p = this.extend(Object.create(np), Polymer.Base);
this._nativePrototypes[tag] = p;
}
return p;
},
getNativePrototype: function (tag) {
return Object.getPrototypeOf(document.createElement(tag));
}
});Polymer.Base._addFeature({
_prepConstructor: function () {
this._factoryArgs = this.extends ? [
this.extends,
this.is
] : [this.is];
var ctor = function () {
return this._factory(arguments);
};
if (this.hasOwnProperty('extends')) {
ctor.extends = this.extends;
}
Object.defineProperty(this, 'constructor', {
value: ctor,
writable: true,
configurable: true
});
ctor.prototype = this;
},
_factory: function (args) {
var elt = document.createElement.apply(document, this._factoryArgs);
if (this.factoryImpl) {
this.factoryImpl.apply(elt, args);
}
return elt;
}
});Polymer.nob = Object.create(null);
Polymer.Base._addFeature({
properties: {},
getPropertyInfo: function (property) {
var info = this._getPropertyInfo(property, this.properties);
if (!info) {
for (var i = 0; i < this.behaviors.length; i++) {
info = this._getPropertyInfo(property, this.behaviors[i].properties);
if (info) {
return info;
}
}
}
return info || Polymer.nob;
},
_getPropertyInfo: function (property, properties) {
var p = properties && properties[property];
if (typeof p === 'function') {
p = properties[property] = { type: p };
}
if (p) {
p.defined = true;
}
return p;
},
_prepPropertyInfo: function () {
this._propertyInfo = {};
for (var i = 0; i < this.behaviors.length; i++) {
this._addPropertyInfo(this._propertyInfo, this.behaviors[i].properties);
}
this._addPropertyInfo(this._propertyInfo, this.properties);
this._addPropertyInfo(this._propertyInfo, this._propertyEffects);
},
_addPropertyInfo: function (target, source) {
if (source) {
var t, s;
for (var i in source) {
t = target[i];
s = source[i];
if (i[0] === '_' && !s.readOnly) {
continue;
}
if (!target[i]) {
target[i] = {
type: typeof s === 'function' ? s : s.type,
readOnly: s.readOnly,
attribute: Polymer.CaseMap.camelToDashCase(i)
};
} else {
if (!t.type) {
t.type = s.type;
}
if (!t.readOnly) {
t.readOnly = s.readOnly;
}
}
}
}
}
});Polymer.CaseMap = {
_caseMap: {},
_rx: {
dashToCamel: /-[a-z]/g,
camelToDash: /([A-Z])/g
},
dashToCamelCase: function (dash) {
return this._caseMap[dash] || (this._caseMap[dash] = dash.indexOf('-') < 0 ? dash : dash.replace(this._rx.dashToCamel, function (m) {
return m[1].toUpperCase();
}));
},
camelToDashCase: function (camel) {
return this._caseMap[camel] || (this._caseMap[camel] = camel.replace(this._rx.camelToDash, '-$1').toLowerCase());
}
};Polymer.Base._addFeature({
_addHostAttributes: function (attributes) {
if (!this._aggregatedAttributes) {
this._aggregatedAttributes = {};
}
if (attributes) {
this.mixin(this._aggregatedAttributes, attributes);
}
},
_marshalHostAttributes: function () {
if (this._aggregatedAttributes) {
this._applyAttributes(this, this._aggregatedAttributes);
}
},
_applyAttributes: function (node, attr$) {
for (var n in attr$) {
if (!this.hasAttribute(n) && n !== 'class') {
var v = attr$[n];
this.serializeValueToAttribute(v, n, this);
}
}
},
_marshalAttributes: function () {
this._takeAttributesToModel(this);
},
_takeAttributesToModel: function (model) {
if (this.hasAttributes()) {
for (var i in this._propertyInfo) {
var info = this._propertyInfo[i];
if (this.hasAttribute(info.attribute)) {
this._setAttributeToProperty(model, info.attribute, i, info);
}
}
}
},
_setAttributeToProperty: function (model, attribute, property, info) {
if (!this._serializing) {
property = property || Polymer.CaseMap.dashToCamelCase(attribute);
info = info || this._propertyInfo && this._propertyInfo[property];
if (info && !info.readOnly) {
var v = this.getAttribute(attribute);
model[property] = this.deserialize(v, info.type);
}
}
},
_serializing: false,
reflectPropertyToAttribute: function (property, attribute, value) {
this._serializing = true;
value = value === undefined ? this[property] : value;
this.serializeValueToAttribute(value, attribute || Polymer.CaseMap.camelToDashCase(property));
this._serializing = false;
},
serializeValueToAttribute: function (value, attribute, node) {
var str = this.serialize(value);
node = node || this;
if (str === undefined) {
node.removeAttribute(attribute);
} else {
node.setAttribute(attribute, str);
}
},
deserialize: function (value, type) {
switch (type) {
case Number:
value = Number(value);
break;
case Boolean:
value = value != null;
break;
case Object:
try {
value = JSON.parse(value);
} catch (x) {
}
break;
case Array:
try {
value = JSON.parse(value);
} catch (x) {
value = null;
console.warn('Polymer::Attributes: couldn`t decode Array as JSON');
}
break;
case Date:
value = new Date(value);
break;
case String:
default:
break;
}
return value;
},
serialize: function (value) {
switch (typeof value) {
case 'boolean':
return value ? '' : undefined;
case 'object':
if (value instanceof Date) {
return value.toString();
} else if (value) {
try {
return JSON.stringify(value);
} catch (x) {
return '';
}
}
default:
return value != null ? value : undefined;
}
}
});Polymer.version = "1.6.1";Polymer.Base._addFeature({
_registerFeatures: function () {
this._prepIs();
this._prepBehaviors();
this._prepConstructor();
this._prepPropertyInfo();
},
_prepBehavior: function (b) {
this._addHostAttributes(b.hostAttributes);
},
_marshalBehavior: function (b) {
},
_initFeatures: function () {
this._marshalHostAttributes();
this._marshalBehaviors();
}
});</script>













<script>Polymer.Base._addFeature({
_prepTemplate: function () {
if (this._template === undefined) {
this._template = Polymer.DomModule.import(this.is, 'template');
}
if (this._template && this._template.hasAttribute('is')) {
this._warn(this._logf('_prepTemplate', 'top-level Polymer template ' + 'must not be a type-extension, found', this._template, 'Move inside simple <template>.'));
}
if (this._template && !this._template.content && window.HTMLTemplateElement && HTMLTemplateElement.decorate) {
HTMLTemplateElement.decorate(this._template);
}
},
_stampTemplate: function () {
if (this._template) {
this.root = this.instanceTemplate(this._template);
}
},
instanceTemplate: function (template) {
var dom = document.importNode(template._content || template.content, true);
return dom;
}
});(function () {
var baseAttachedCallback = Polymer.Base.attachedCallback;
Polymer.Base._addFeature({
_hostStack: [],
ready: function () {
},
_registerHost: function (host) {
this.dataHost = host = host || Polymer.Base._hostStack[Polymer.Base._hostStack.length - 1];
if (host && host._clients) {
host._clients.push(this);
}
this._clients = null;
this._clientsReadied = false;
},
_beginHosting: function () {
Polymer.Base._hostStack.push(this);
if (!this._clients) {
this._clients = [];
}
},
_endHosting: function () {
Polymer.Base._hostStack.pop();
},
_tryReady: function () {
this._readied = false;
if (this._canReady()) {
this._ready();
}
},
_canReady: function () {
return !this.dataHost || this.dataHost._clientsReadied;
},
_ready: function () {
this._beforeClientsReady();
if (this._template) {
this._setupRoot();
this._readyClients();
}
this._clientsReadied = true;
this._clients = null;
this._afterClientsReady();
this._readySelf();
},
_readyClients: function () {
this._beginDistribute();
var c$ = this._clients;
if (c$) {
for (var i = 0, l = c$.length, c; i < l && (c = c$[i]); i++) {
c._ready();
}
}
this._finishDistribute();
},
_readySelf: function () {
this._doBehavior('ready');
this._readied = true;
if (this._attachedPending) {
this._attachedPending = false;
this.attachedCallback();
}
},
_beforeClientsReady: function () {
},
_afterClientsReady: function () {
},
_beforeAttached: function () {
},
attachedCallback: function () {
if (this._readied) {
this._beforeAttached();
baseAttachedCallback.call(this);
} else {
this._attachedPending = true;
}
}
});
}());Polymer.ArraySplice = function () {
function newSplice(index, removed, addedCount) {
return {
index: index,
removed: removed,
addedCount: addedCount
};
}
var EDIT_LEAVE = 0;
var EDIT_UPDATE = 1;
var EDIT_ADD = 2;
var EDIT_DELETE = 3;
function ArraySplice() {
}
ArraySplice.prototype = {
calcEditDistances: function (current, currentStart, currentEnd, old, oldStart, oldEnd) {
var rowCount = oldEnd - oldStart + 1;
var columnCount = currentEnd - currentStart + 1;
var distances = new Array(rowCount);
for (var i = 0; i < rowCount; i++) {
distances[i] = new Array(columnCount);
distances[i][0] = i;
}
for (var j = 0; j < columnCount; j++)
distances[0][j] = j;
for (i = 1; i < rowCount; i++) {
for (j = 1; j < columnCount; j++) {
if (this.equals(current[currentStart + j - 1], old[oldStart + i - 1]))
distances[i][j] = distances[i - 1][j - 1];
else {
var north = distances[i - 1][j] + 1;
var west = distances[i][j - 1] + 1;
distances[i][j] = north < west ? north : west;
}
}
}
return distances;
},
spliceOperationsFromEditDistances: function (distances) {
var i = distances.length - 1;
var j = distances[0].length - 1;
var current = distances[i][j];
var edits = [];
while (i > 0 || j > 0) {
if (i == 0) {
edits.push(EDIT_ADD);
j--;
continue;
}
if (j == 0) {
edits.push(EDIT_DELETE);
i--;
continue;
}
var northWest = distances[i - 1][j - 1];
var west = distances[i - 1][j];
var north = distances[i][j - 1];
var min;
if (west < north)
min = west < northWest ? west : northWest;
else
min = north < northWest ? north : northWest;
if (min == northWest) {
if (northWest == current) {
edits.push(EDIT_LEAVE);
} else {
edits.push(EDIT_UPDATE);
current = northWest;
}
i--;
j--;
} else if (min == west) {
edits.push(EDIT_DELETE);
i--;
current = west;
} else {
edits.push(EDIT_ADD);
j--;
current = north;
}
}
edits.reverse();
return edits;
},
calcSplices: function (current, currentStart, currentEnd, old, oldStart, oldEnd) {
var prefixCount = 0;
var suffixCount = 0;
var minLength = Math.min(currentEnd - currentStart, oldEnd - oldStart);
if (currentStart == 0 && oldStart == 0)
prefixCount = this.sharedPrefix(current, old, minLength);
if (currentEnd == current.length && oldEnd == old.length)
suffixCount = this.sharedSuffix(current, old, minLength - prefixCount);
currentStart += prefixCount;
oldStart += prefixCount;
currentEnd -= suffixCount;
oldEnd -= suffixCount;
if (currentEnd - currentStart == 0 && oldEnd - oldStart == 0)
return [];
if (currentStart == currentEnd) {
var splice = newSplice(currentStart, [], 0);
while (oldStart < oldEnd)
splice.removed.push(old[oldStart++]);
return [splice];
} else if (oldStart == oldEnd)
return [newSplice(currentStart, [], currentEnd - currentStart)];
var ops = this.spliceOperationsFromEditDistances(this.calcEditDistances(current, currentStart, currentEnd, old, oldStart, oldEnd));
splice = undefined;
var splices = [];
var index = currentStart;
var oldIndex = oldStart;
for (var i = 0; i < ops.length; i++) {
switch (ops[i]) {
case EDIT_LEAVE:
if (splice) {
splices.push(splice);
splice = undefined;
}
index++;
oldIndex++;
break;
case EDIT_UPDATE:
if (!splice)
splice = newSplice(index, [], 0);
splice.addedCount++;
index++;
splice.removed.push(old[oldIndex]);
oldIndex++;
break;
case EDIT_ADD:
if (!splice)
splice = newSplice(index, [], 0);
splice.addedCount++;
index++;
break;
case EDIT_DELETE:
if (!splice)
splice = newSplice(index, [], 0);
splice.removed.push(old[oldIndex]);
oldIndex++;
break;
}
}
if (splice) {
splices.push(splice);
}
return splices;
},
sharedPrefix: function (current, old, searchLength) {
for (var i = 0; i < searchLength; i++)
if (!this.equals(current[i], old[i]))
return i;
return searchLength;
},
sharedSuffix: function (current, old, searchLength) {
var index1 = current.length;
var index2 = old.length;
var count = 0;
while (count < searchLength && this.equals(current[--index1], old[--index2]))
count++;
return count;
},
calculateSplices: function (current, previous) {
return this.calcSplices(current, 0, current.length, previous, 0, previous.length);
},
equals: function (currentValue, previousValue) {
return currentValue === previousValue;
}
};
return new ArraySplice();
}();Polymer.domInnerHTML = function () {
var escapeAttrRegExp = /[&\u00A0"]/g;
var escapeDataRegExp = /[&\u00A0<>]/g;
function escapeReplace(c) {
switch (c) {
case '&':
return '&amp;';
case '<':
return '&lt;';
case '>':
return '&gt;';
case '"':
return '&quot;';
case '\xA0':
return '&nbsp;';
}
}
function escapeAttr(s) {
return s.replace(escapeAttrRegExp, escapeReplace);
}
function escapeData(s) {
return s.replace(escapeDataRegExp, escapeReplace);
}
function makeSet(arr) {
var set = {};
for (var i = 0; i < arr.length; i++) {
set[arr[i]] = true;
}
return set;
}
var voidElements = makeSet([
'area',
'base',
'br',
'col',
'command',
'embed',
'hr',
'img',
'input',
'keygen',
'link',
'meta',
'param',
'source',
'track',
'wbr'
]);
var plaintextParents = makeSet([
'style',
'script',
'xmp',
'iframe',
'noembed',
'noframes',
'plaintext',
'noscript'
]);
function getOuterHTML(node, parentNode, composed) {
switch (node.nodeType) {
case Node.ELEMENT_NODE:
var tagName = node.localName;
var s = '<' + tagName;
var attrs = node.attributes;
for (var i = 0, attr; attr = attrs[i]; i++) {
s += ' ' + attr.name + '="' + escapeAttr(attr.value) + '"';
}
s += '>';
if (voidElements[tagName]) {
return s;
}
return s + getInnerHTML(node, composed) + '</' + tagName + '>';
case Node.TEXT_NODE:
var data = node.data;
if (parentNode && plaintextParents[parentNode.localName]) {
return data;
}
return escapeData(data);
case Node.COMMENT_NODE:
return '<!--' + node.data + '-->';
default:
console.error(node);
throw new Error('not implemented');
}
}
function getInnerHTML(node, composed) {
if (node instanceof HTMLTemplateElement)
node = node.content;
var s = '';
var c$ = Polymer.dom(node).childNodes;
for (var i = 0, l = c$.length, child; i < l && (child = c$[i]); i++) {
s += getOuterHTML(child, node, composed);
}
return s;
}
return { getInnerHTML: getInnerHTML };
}();(function () {
'use strict';
var nativeInsertBefore = Element.prototype.insertBefore;
var nativeAppendChild = Element.prototype.appendChild;
var nativeRemoveChild = Element.prototype.removeChild;
Polymer.TreeApi = {
arrayCopyChildNodes: function (parent) {
var copy = [], i = 0;
for (var n = parent.firstChild; n; n = n.nextSibling) {
copy[i++] = n;
}
return copy;
},
arrayCopyChildren: function (parent) {
var copy = [], i = 0;
for (var n = parent.firstElementChild; n; n = n.nextElementSibling) {
copy[i++] = n;
}
return copy;
},
arrayCopy: function (a$) {
var l = a$.length;
var copy = new Array(l);
for (var i = 0; i < l; i++) {
copy[i] = a$[i];
}
return copy;
}
};
Polymer.TreeApi.Logical = {
hasParentNode: function (node) {
return Boolean(node.__dom && node.__dom.parentNode);
},
hasChildNodes: function (node) {
return Boolean(node.__dom && node.__dom.childNodes !== undefined);
},
getChildNodes: function (node) {
return this.hasChildNodes(node) ? this._getChildNodes(node) : node.childNodes;
},
_getChildNodes: function (node) {
if (!node.__dom.childNodes) {
node.__dom.childNodes = [];
for (var n = node.__dom.firstChild; n; n = n.__dom.nextSibling) {
node.__dom.childNodes.push(n);
}
}
return node.__dom.childNodes;
},
getParentNode: function (node) {
return node.__dom && node.__dom.parentNode !== undefined ? node.__dom.parentNode : node.parentNode;
},
getFirstChild: function (node) {
return node.__dom && node.__dom.firstChild !== undefined ? node.__dom.firstChild : node.firstChild;
},
getLastChild: function (node) {
return node.__dom && node.__dom.lastChild !== undefined ? node.__dom.lastChild : node.lastChild;
},
getNextSibling: function (node) {
return node.__dom && node.__dom.nextSibling !== undefined ? node.__dom.nextSibling : node.nextSibling;
},
getPreviousSibling: function (node) {
return node.__dom && node.__dom.previousSibling !== undefined ? node.__dom.previousSibling : node.previousSibling;
},
getFirstElementChild: function (node) {
return node.__dom && node.__dom.firstChild !== undefined ? this._getFirstElementChild(node) : node.firstElementChild;
},
_getFirstElementChild: function (node) {
var n = node.__dom.firstChild;
while (n && n.nodeType !== Node.ELEMENT_NODE) {
n = n.__dom.nextSibling;
}
return n;
},
getLastElementChild: function (node) {
return node.__dom && node.__dom.lastChild !== undefined ? this._getLastElementChild(node) : node.lastElementChild;
},
_getLastElementChild: function (node) {
var n = node.__dom.lastChild;
while (n && n.nodeType !== Node.ELEMENT_NODE) {
n = n.__dom.previousSibling;
}
return n;
},
getNextElementSibling: function (node) {
return node.__dom && node.__dom.nextSibling !== undefined ? this._getNextElementSibling(node) : node.nextElementSibling;
},
_getNextElementSibling: function (node) {
var n = node.__dom.nextSibling;
while (n && n.nodeType !== Node.ELEMENT_NODE) {
n = n.__dom.nextSibling;
}
return n;
},
getPreviousElementSibling: function (node) {
return node.__dom && node.__dom.previousSibling !== undefined ? this._getPreviousElementSibling(node) : node.previousElementSibling;
},
_getPreviousElementSibling: function (node) {
var n = node.__dom.previousSibling;
while (n && n.nodeType !== Node.ELEMENT_NODE) {
n = n.__dom.previousSibling;
}
return n;
},
saveChildNodes: function (node) {
if (!this.hasChildNodes(node)) {
node.__dom = node.__dom || {};
node.__dom.firstChild = node.firstChild;
node.__dom.lastChild = node.lastChild;
node.__dom.childNodes = [];
for (var n = node.firstChild; n; n = n.nextSibling) {
n.__dom = n.__dom || {};
n.__dom.parentNode = node;
node.__dom.childNodes.push(n);
n.__dom.nextSibling = n.nextSibling;
n.__dom.previousSibling = n.previousSibling;
}
}
},
recordInsertBefore: function (node, container, ref_node) {
container.__dom.childNodes = null;
if (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {
for (var n = node.firstChild; n; n = n.nextSibling) {
this._linkNode(n, container, ref_node);
}
} else {
this._linkNode(node, container, ref_node);
}
},
_linkNode: function (node, container, ref_node) {
node.__dom = node.__dom || {};
container.__dom = container.__dom || {};
if (ref_node) {
ref_node.__dom = ref_node.__dom || {};
}
node.__dom.previousSibling = ref_node ? ref_node.__dom.previousSibling : container.__dom.lastChild;
if (node.__dom.previousSibling) {
node.__dom.previousSibling.__dom.nextSibling = node;
}
node.__dom.nextSibling = ref_node || null;
if (node.__dom.nextSibling) {
node.__dom.nextSibling.__dom.previousSibling = node;
}
node.__dom.parentNode = container;
if (ref_node) {
if (ref_node === container.__dom.firstChild) {
container.__dom.firstChild = node;
}
} else {
container.__dom.lastChild = node;
if (!container.__dom.firstChild) {
container.__dom.firstChild = node;
}
}
container.__dom.childNodes = null;
},
recordRemoveChild: function (node, container) {
node.__dom = node.__dom || {};
container.__dom = container.__dom || {};
if (node === container.__dom.firstChild) {
container.__dom.firstChild = node.__dom.nextSibling;
}
if (node === container.__dom.lastChild) {
container.__dom.lastChild = node.__dom.previousSibling;
}
var p = node.__dom.previousSibling;
var n = node.__dom.nextSibling;
if (p) {
p.__dom.nextSibling = n;
}
if (n) {
n.__dom.previousSibling = p;
}
node.__dom.parentNode = node.__dom.previousSibling = node.__dom.nextSibling = undefined;
container.__dom.childNodes = null;
}
};
Polymer.TreeApi.Composed = {
getChildNodes: function (node) {
return Polymer.TreeApi.arrayCopyChildNodes(node);
},
getParentNode: function (node) {
return node.parentNode;
},
clearChildNodes: function (node) {
node.textContent = '';
},
insertBefore: function (parentNode, newChild, refChild) {
return nativeInsertBefore.call(parentNode, newChild, refChild || null);
},
appendChild: function (parentNode, newChild) {
return nativeAppendChild.call(parentNode, newChild);
},
removeChild: function (parentNode, node) {
return nativeRemoveChild.call(parentNode, node);
}
};
}());Polymer.DomApi = function () {
'use strict';
var Settings = Polymer.Settings;
var TreeApi = Polymer.TreeApi;
var DomApi = function (node) {
this.node = needsToWrap ? DomApi.wrap(node) : node;
};
var needsToWrap = Settings.hasShadow && !Settings.nativeShadow;
DomApi.wrap = window.wrap ? window.wrap : function (node) {
return node;
};
DomApi.prototype = {
flush: function () {
Polymer.dom.flush();
},
deepContains: function (node) {
if (this.node.contains(node)) {
return true;
}
var n = node;
var doc = node.ownerDocument;
while (n && n !== doc && n !== this.node) {
n = Polymer.dom(n).parentNode || n.host;
}
return n === this.node;
},
queryDistributedElements: function (selector) {
var c$ = this.getEffectiveChildNodes();
var list = [];
for (var i = 0, l = c$.length, c; i < l && (c = c$[i]); i++) {
if (c.nodeType === Node.ELEMENT_NODE && DomApi.matchesSelector.call(c, selector)) {
list.push(c);
}
}
return list;
},
getEffectiveChildNodes: function () {
var list = [];
var c$ = this.childNodes;
for (var i = 0, l = c$.length, c; i < l && (c = c$[i]); i++) {
if (c.localName === CONTENT) {
var d$ = dom(c).getDistributedNodes();
for (var j = 0; j < d$.length; j++) {
list.push(d$[j]);
}
} else {
list.push(c);
}
}
return list;
},
observeNodes: function (callback) {
if (callback) {
if (!this.observer) {
this.observer = this.node.localName === CONTENT ? new DomApi.DistributedNodesObserver(this) : new DomApi.EffectiveNodesObserver(this);
}
return this.observer.addListener(callback);
}
},
unobserveNodes: function (handle) {
if (this.observer) {
this.observer.removeListener(handle);
}
},
notifyObserver: function () {
if (this.observer) {
this.observer.notify();
}
},
_query: function (matcher, node, halter) {
node = node || this.node;
var list = [];
this._queryElements(TreeApi.Logical.getChildNodes(node), matcher, halter, list);
return list;
},
_queryElements: function (elements, matcher, halter, list) {
for (var i = 0, l = elements.length, c; i < l && (c = elements[i]); i++) {
if (c.nodeType === Node.ELEMENT_NODE) {
if (this._queryElement(c, matcher, halter, list)) {
return true;
}
}
}
},
_queryElement: function (node, matcher, halter, list) {
var result = matcher(node);
if (result) {
list.push(node);
}
if (halter && halter(result)) {
return result;
}
this._queryElements(TreeApi.Logical.getChildNodes(node), matcher, halter, list);
}
};
var CONTENT = DomApi.CONTENT = 'content';
var dom = DomApi.factory = function (node) {
node = node || document;
if (!node.__domApi) {
node.__domApi = new DomApi.ctor(node);
}
return node.__domApi;
};
DomApi.hasApi = function (node) {
return Boolean(node.__domApi);
};
DomApi.ctor = DomApi;
Polymer.dom = function (obj, patch) {
if (obj instanceof Event) {
return Polymer.EventApi.factory(obj);
} else {
return DomApi.factory(obj, patch);
}
};
var p = Element.prototype;
DomApi.matchesSelector = p.matches || p.matchesSelector || p.mozMatchesSelector || p.msMatchesSelector || p.oMatchesSelector || p.webkitMatchesSelector;
return DomApi;
}();(function () {
'use strict';
var Settings = Polymer.Settings;
var DomApi = Polymer.DomApi;
var dom = DomApi.factory;
var TreeApi = Polymer.TreeApi;
var getInnerHTML = Polymer.domInnerHTML.getInnerHTML;
var CONTENT = DomApi.CONTENT;
if (Settings.useShadow) {
return;
}
var nativeCloneNode = Element.prototype.cloneNode;
var nativeImportNode = Document.prototype.importNode;
Polymer.Base.extend(DomApi.prototype, {
_lazyDistribute: function (host) {
if (host.shadyRoot && host.shadyRoot._distributionClean) {
host.shadyRoot._distributionClean = false;
Polymer.dom.addDebouncer(host.debounce('_distribute', host._distributeContent));
}
},
appendChild: function (node) {
return this.insertBefore(node);
},
insertBefore: function (node, ref_node) {
if (ref_node && TreeApi.Logical.getParentNode(ref_node) !== this.node) {
throw Error('The ref_node to be inserted before is not a child ' + 'of this node');
}
if (node.nodeType !== Node.DOCUMENT_FRAGMENT_NODE) {
var parent = TreeApi.Logical.getParentNode(node);
if (parent) {
if (DomApi.hasApi(parent)) {
dom(parent).notifyObserver();
}
this._removeNode(node);
} else {
this._removeOwnerShadyRoot(node);
}
}
if (!this._addNode(node, ref_node)) {
if (ref_node) {
ref_node = ref_node.localName === CONTENT ? this._firstComposedNode(ref_node) : ref_node;
}
var container = this.node._isShadyRoot ? this.node.host : this.node;
if (ref_node) {
TreeApi.Composed.insertBefore(container, node, ref_node);
} else {
TreeApi.Composed.appendChild(container, node);
}
}
this.notifyObserver();
return node;
},
_addNode: function (node, ref_node) {
var root = this.getOwnerRoot();
if (root) {
var ipAdded = this._maybeAddInsertionPoint(node, this.node);
if (!root._invalidInsertionPoints) {
root._invalidInsertionPoints = ipAdded;
}
this._addNodeToHost(root.host, node);
}
if (TreeApi.Logical.hasChildNodes(this.node)) {
TreeApi.Logical.recordInsertBefore(node, this.node, ref_node);
}
var handled = this._maybeDistribute(node) || this.node.shadyRoot;
if (handled) {
if (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {
while (node.firstChild) {
TreeApi.Composed.removeChild(node, node.firstChild);
}
} else {
var parent = TreeApi.Composed.getParentNode(node);
if (parent) {
TreeApi.Composed.removeChild(parent, node);
}
}
}
return handled;
},
removeChild: function (node) {
if (TreeApi.Logical.getParentNode(node) !== this.node) {
throw Error('The node to be removed is not a child of this node: ' + node);
}
if (!this._removeNode(node)) {
var container = this.node._isShadyRoot ? this.node.host : this.node;
var parent = TreeApi.Composed.getParentNode(node);
if (container === parent) {
TreeApi.Composed.removeChild(container, node);
}
}
this.notifyObserver();
return node;
},
_removeNode: function (node) {
var logicalParent = TreeApi.Logical.hasParentNode(node) && TreeApi.Logical.getParentNode(node);
var distributed;
var root = this._ownerShadyRootForNode(node);
if (logicalParent) {
distributed = dom(node)._maybeDistributeParent();
TreeApi.Logical.recordRemoveChild(node, logicalParent);
if (root && this._removeDistributedChildren(root, node)) {
root._invalidInsertionPoints = true;
this._lazyDistribute(root.host);
}
}
this._removeOwnerShadyRoot(node);
if (root) {
this._removeNodeFromHost(root.host, node);
}
return distributed;
},
replaceChild: function (node, ref_node) {
this.insertBefore(node, ref_node);
this.removeChild(ref_node);
return node;
},
_hasCachedOwnerRoot: function (node) {
return Boolean(node._ownerShadyRoot !== undefined);
},
getOwnerRoot: function () {
return this._ownerShadyRootForNode(this.node);
},
_ownerShadyRootForNode: function (node) {
if (!node) {
return;
}
var root = node._ownerShadyRoot;
if (root === undefined) {
if (node._isShadyRoot) {
root = node;
} else {
var parent = TreeApi.Logical.getParentNode(node);
if (parent) {
root = parent._isShadyRoot ? parent : this._ownerShadyRootForNode(parent);
} else {
root = null;
}
}
if (root || document.documentElement.contains(node)) {
node._ownerShadyRoot = root;
}
}
return root;
},
_maybeDistribute: function (node) {
var fragContent = node.nodeType === Node.DOCUMENT_FRAGMENT_NODE && !node.__noContent && dom(node).querySelector(CONTENT);
var wrappedContent = fragContent && TreeApi.Logical.getParentNode(fragContent).nodeType !== Node.DOCUMENT_FRAGMENT_NODE;
var hasContent = fragContent || node.localName === CONTENT;
if (hasContent) {
var root = this.getOwnerRoot();
if (root) {
this._lazyDistribute(root.host);
}
}
var needsDist = this._nodeNeedsDistribution(this.node);
if (needsDist) {
this._lazyDistribute(this.node);
}
return needsDist || hasContent && !wrappedContent;
},
_maybeAddInsertionPoint: function (node, parent) {
var added;
if (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE && !node.__noContent) {
var c$ = dom(node).querySelectorAll(CONTENT);
for (var i = 0, n, np, na; i < c$.length && (n = c$[i]); i++) {
np = TreeApi.Logical.getParentNode(n);
if (np === node) {
np = parent;
}
na = this._maybeAddInsertionPoint(n, np);
added = added || na;
}
} else if (node.localName === CONTENT) {
TreeApi.Logical.saveChildNodes(parent);
TreeApi.Logical.saveChildNodes(node);
added = true;
}
return added;
},
_updateInsertionPoints: function (host) {
var i$ = host.shadyRoot._insertionPoints = dom(host.shadyRoot).querySelectorAll(CONTENT);
for (var i = 0, c; i < i$.length; i++) {
c = i$[i];
TreeApi.Logical.saveChildNodes(c);
TreeApi.Logical.saveChildNodes(TreeApi.Logical.getParentNode(c));
}
},
_nodeNeedsDistribution: function (node) {
return node && node.shadyRoot && DomApi.hasInsertionPoint(node.shadyRoot);
},
_addNodeToHost: function (host, node) {
if (host._elementAdd) {
host._elementAdd(node);
}
},
_removeNodeFromHost: function (host, node) {
if (host._elementRemove) {
host._elementRemove(node);
}
},
_removeDistributedChildren: function (root, container) {
var hostNeedsDist;
var ip$ = root._insertionPoints;
for (var i = 0; i < ip$.length; i++) {
var content = ip$[i];
if (this._contains(container, content)) {
var dc$ = dom(content).getDistributedNodes();
for (var j = 0; j < dc$.length; j++) {
hostNeedsDist = true;
var node = dc$[j];
var parent = TreeApi.Composed.getParentNode(node);
if (parent) {
TreeApi.Composed.removeChild(parent, node);
}
}
}
}
return hostNeedsDist;
},
_contains: function (container, node) {
while (node) {
if (node == container) {
return true;
}
node = TreeApi.Logical.getParentNode(node);
}
},
_removeOwnerShadyRoot: function (node) {
if (this._hasCachedOwnerRoot(node)) {
var c$ = TreeApi.Logical.getChildNodes(node);
for (var i = 0, l = c$.length, n; i < l && (n = c$[i]); i++) {
this._removeOwnerShadyRoot(n);
}
}
node._ownerShadyRoot = undefined;
},
_firstComposedNode: function (content) {
var n$ = dom(content).getDistributedNodes();
for (var i = 0, l = n$.length, n, p$; i < l && (n = n$[i]); i++) {
p$ = dom(n).getDestinationInsertionPoints();
if (p$[p$.length - 1] === content) {
return n;
}
}
},
querySelector: function (selector) {
var result = this._query(function (n) {
return DomApi.matchesSelector.call(n, selector);
}, this.node, function (n) {
return Boolean(n);
})[0];
return result || null;
},
querySelectorAll: function (selector) {
return this._query(function (n) {
return DomApi.matchesSelector.call(n, selector);
}, this.node);
},
getDestinationInsertionPoints: function () {
return this.node._destinationInsertionPoints || [];
},
getDistributedNodes: function () {
return this.node._distributedNodes || [];
},
_clear: function () {
while (this.childNodes.length) {
this.removeChild(this.childNodes[0]);
}
},
setAttribute: function (name, value) {
this.node.setAttribute(name, value);
this._maybeDistributeParent();
},
removeAttribute: function (name) {
this.node.removeAttribute(name);
this._maybeDistributeParent();
},
_maybeDistributeParent: function () {
if (this._nodeNeedsDistribution(this.parentNode)) {
this._lazyDistribute(this.parentNode);
return true;
}
},
cloneNode: function (deep) {
var n = nativeCloneNode.call(this.node, false);
if (deep) {
var c$ = this.childNodes;
var d = dom(n);
for (var i = 0, nc; i < c$.length; i++) {
nc = dom(c$[i]).cloneNode(true);
d.appendChild(nc);
}
}
return n;
},
importNode: function (externalNode, deep) {
var doc = this.node instanceof Document ? this.node : this.node.ownerDocument;
var n = nativeImportNode.call(doc, externalNode, false);
if (deep) {
var c$ = TreeApi.Logical.getChildNodes(externalNode);
var d = dom(n);
for (var i = 0, nc; i < c$.length; i++) {
nc = dom(doc).importNode(c$[i], true);
d.appendChild(nc);
}
}
return n;
},
_getComposedInnerHTML: function () {
return getInnerHTML(this.node, true);
}
});
Object.defineProperties(DomApi.prototype, {
activeElement: {
get: function () {
var active = document.activeElement;
if (!active) {
return null;
}
var isShadyRoot = !!this.node._isShadyRoot;
if (this.node !== document) {
if (!isShadyRoot) {
return null;
}
if (this.node.host === active || !this.node.host.contains(active)) {
return null;
}
}
var activeRoot = dom(active).getOwnerRoot();
while (activeRoot && activeRoot !== this.node) {
active = activeRoot.host;
activeRoot = dom(active).getOwnerRoot();
}
if (this.node === document) {
return activeRoot ? null : active;
} else {
return activeRoot === this.node ? active : null;
}
},
configurable: true
},
childNodes: {
get: function () {
var c$ = TreeApi.Logical.getChildNodes(this.node);
return Array.isArray(c$) ? c$ : TreeApi.arrayCopyChildNodes(this.node);
},
configurable: true
},
children: {
get: function () {
if (TreeApi.Logical.hasChildNodes(this.node)) {
return Array.prototype.filter.call(this.childNodes, function (n) {
return n.nodeType === Node.ELEMENT_NODE;
});
} else {
return TreeApi.arrayCopyChildren(this.node);
}
},
configurable: true
},
parentNode: {
get: function () {
return TreeApi.Logical.getParentNode(this.node);
},
configurable: true
},
firstChild: {
get: function () {
return TreeApi.Logical.getFirstChild(this.node);
},
configurable: true
},
lastChild: {
get: function () {
return TreeApi.Logical.getLastChild(this.node);
},
configurable: true
},
nextSibling: {
get: function () {
return TreeApi.Logical.getNextSibling(this.node);
},
configurable: true
},
previousSibling: {
get: function () {
return TreeApi.Logical.getPreviousSibling(this.node);
},
configurable: true
},
firstElementChild: {
get: function () {
return TreeApi.Logical.getFirstElementChild(this.node);
},
configurable: true
},
lastElementChild: {
get: function () {
return TreeApi.Logical.getLastElementChild(this.node);
},
configurable: true
},
nextElementSibling: {
get: function () {
return TreeApi.Logical.getNextElementSibling(this.node);
},
configurable: true
},
previousElementSibling: {
get: function () {
return TreeApi.Logical.getPreviousElementSibling(this.node);
},
configurable: true
},
textContent: {
get: function () {
var nt = this.node.nodeType;
if (nt === Node.TEXT_NODE || nt === Node.COMMENT_NODE) {
return this.node.textContent;
} else {
var tc = [];
for (var i = 0, cn = this.childNodes, c; c = cn[i]; i++) {
if (c.nodeType !== Node.COMMENT_NODE) {
tc.push(c.textContent);
}
}
return tc.join('');
}
},
set: function (text) {
var nt = this.node.nodeType;
if (nt === Node.TEXT_NODE || nt === Node.COMMENT_NODE) {
this.node.textContent = text;
} else {
this._clear();
if (text) {
this.appendChild(document.createTextNode(text));
}
}
},
configurable: true
},
innerHTML: {
get: function () {
var nt = this.node.nodeType;
if (nt === Node.TEXT_NODE || nt === Node.COMMENT_NODE) {
return null;
} else {
return getInnerHTML(this.node);
}
},
set: function (text) {
var nt = this.node.nodeType;
if (nt !== Node.TEXT_NODE || nt !== Node.COMMENT_NODE) {
this._clear();
var d = document.createElement('div');
d.innerHTML = text;
var c$ = TreeApi.arrayCopyChildNodes(d);
for (var i = 0; i < c$.length; i++) {
this.appendChild(c$[i]);
}
}
},
configurable: true
}
});
DomApi.hasInsertionPoint = function (root) {
return Boolean(root && root._insertionPoints.length);
};
}());(function () {
'use strict';
var Settings = Polymer.Settings;
var TreeApi = Polymer.TreeApi;
var DomApi = Polymer.DomApi;
if (!Settings.useShadow) {
return;
}
Polymer.Base.extend(DomApi.prototype, {
querySelectorAll: function (selector) {
return TreeApi.arrayCopy(this.node.querySelectorAll(selector));
},
getOwnerRoot: function () {
var n = this.node;
while (n) {
if (n.nodeType === Node.DOCUMENT_FRAGMENT_NODE && n.host) {
return n;
}
n = n.parentNode;
}
},
importNode: function (externalNode, deep) {
var doc = this.node instanceof Document ? this.node : this.node.ownerDocument;
return doc.importNode(externalNode, deep);
},
getDestinationInsertionPoints: function () {
var n$ = this.node.getDestinationInsertionPoints && this.node.getDestinationInsertionPoints();
return n$ ? TreeApi.arrayCopy(n$) : [];
},
getDistributedNodes: function () {
var n$ = this.node.getDistributedNodes && this.node.getDistributedNodes();
return n$ ? TreeApi.arrayCopy(n$) : [];
}
});
Object.defineProperties(DomApi.prototype, {
activeElement: {
get: function () {
var node = DomApi.wrap(this.node);
var activeElement = node.activeElement;
return node.contains(activeElement) ? activeElement : null;
},
configurable: true
},
childNodes: {
get: function () {
return TreeApi.arrayCopyChildNodes(this.node);
},
configurable: true
},
children: {
get: function () {
return TreeApi.arrayCopyChildren(this.node);
},
configurable: true
},
textContent: {
get: function () {
return this.node.textContent;
},
set: function (value) {
return this.node.textContent = value;
},
configurable: true
},
innerHTML: {
get: function () {
return this.node.innerHTML;
},
set: function (value) {
return this.node.innerHTML = value;
},
configurable: true
}
});
var forwardMethods = function (m$) {
for (var i = 0; i < m$.length; i++) {
forwardMethod(m$[i]);
}
};
var forwardMethod = function (method) {
DomApi.prototype[method] = function () {
return this.node[method].apply(this.node, arguments);
};
};
forwardMethods([
'cloneNode',
'appendChild',
'insertBefore',
'removeChild',
'replaceChild',
'setAttribute',
'removeAttribute',
'querySelector'
]);
var forwardProperties = function (f$) {
for (var i = 0; i < f$.length; i++) {
forwardProperty(f$[i]);
}
};
var forwardProperty = function (name) {
Object.defineProperty(DomApi.prototype, name, {
get: function () {
return this.node[name];
},
configurable: true
});
};
forwardProperties([
'parentNode',
'firstChild',
'lastChild',
'nextSibling',
'previousSibling',
'firstElementChild',
'lastElementChild',
'nextElementSibling',
'previousElementSibling'
]);
}());Polymer.Base.extend(Polymer.dom, {
_flushGuard: 0,
_FLUSH_MAX: 100,
_needsTakeRecords: !Polymer.Settings.useNativeCustomElements,
_debouncers: [],
_staticFlushList: [],
_finishDebouncer: null,
flush: function () {
this._flushGuard = 0;
this._prepareFlush();
while (this._debouncers.length && this._flushGuard < this._FLUSH_MAX) {
while (this._debouncers.length) {
this._debouncers.shift().complete();
}
if (this._finishDebouncer) {
this._finishDebouncer.complete();
}
this._prepareFlush();
this._flushGuard++;
}
if (this._flushGuard >= this._FLUSH_MAX) {
console.warn('Polymer.dom.flush aborted. Flush may not be complete.');
}
},
_prepareFlush: function () {
if (this._needsTakeRecords) {
CustomElements.takeRecords();
}
for (var i = 0; i < this._staticFlushList.length; i++) {
this._staticFlushList[i]();
}
},
addStaticFlush: function (fn) {
this._staticFlushList.push(fn);
},
removeStaticFlush: function (fn) {
var i = this._staticFlushList.indexOf(fn);
if (i >= 0) {
this._staticFlushList.splice(i, 1);
}
},
addDebouncer: function (debouncer) {
this._debouncers.push(debouncer);
this._finishDebouncer = Polymer.Debounce(this._finishDebouncer, this._finishFlush);
},
_finishFlush: function () {
Polymer.dom._debouncers = [];
}
});Polymer.EventApi = function () {
'use strict';
var DomApi = Polymer.DomApi.ctor;
var Settings = Polymer.Settings;
DomApi.Event = function (event) {
this.event = event;
};
if (Settings.useShadow) {
DomApi.Event.prototype = {
get rootTarget() {
return this.event.path[0];
},
get localTarget() {
return this.event.target;
},
get path() {
var path = this.event.path;
if (!Array.isArray(path)) {
path = Array.prototype.slice.call(path);
}
return path;
}
};
} else {
DomApi.Event.prototype = {
get rootTarget() {
return this.event.target;
},
get localTarget() {
var current = this.event.currentTarget;
var currentRoot = current && Polymer.dom(current).getOwnerRoot();
var p$ = this.path;
for (var i = 0; i < p$.length; i++) {
if (Polymer.dom(p$[i]).getOwnerRoot() === currentRoot) {
return p$[i];
}
}
},
get path() {
if (!this.event._path) {
var path = [];
var current = this.rootTarget;
while (current) {
path.push(current);
var insertionPoints = Polymer.dom(current).getDestinationInsertionPoints();
if (insertionPoints.length) {
for (var i = 0; i < insertionPoints.length - 1; i++) {
path.push(insertionPoints[i]);
}
current = insertionPoints[insertionPoints.length - 1];
} else {
current = Polymer.dom(current).parentNode || current.host;
}
}
path.push(window);
this.event._path = path;
}
return this.event._path;
}
};
}
var factory = function (event) {
if (!event.__eventApi) {
event.__eventApi = new DomApi.Event(event);
}
return event.__eventApi;
};
return { factory: factory };
}();(function () {
'use strict';
var DomApi = Polymer.DomApi.ctor;
var useShadow = Polymer.Settings.useShadow;
Object.defineProperty(DomApi.prototype, 'classList', {
get: function () {
if (!this._classList) {
this._classList = new DomApi.ClassList(this);
}
return this._classList;
},
configurable: true
});
DomApi.ClassList = function (host) {
this.domApi = host;
this.node = host.node;
};
DomApi.ClassList.prototype = {
add: function () {
this.node.classList.add.apply(this.node.classList, arguments);
this._distributeParent();
},
remove: function () {
this.node.classList.remove.apply(this.node.classList, arguments);
this._distributeParent();
},
toggle: function () {
this.node.classList.toggle.apply(this.node.classList, arguments);
this._distributeParent();
},
_distributeParent: function () {
if (!useShadow) {
this.domApi._maybeDistributeParent();
}
},
contains: function () {
return this.node.classList.contains.apply(this.node.classList, arguments);
}
};
}());(function () {
'use strict';
var DomApi = Polymer.DomApi.ctor;
var Settings = Polymer.Settings;
DomApi.EffectiveNodesObserver = function (domApi) {
this.domApi = domApi;
this.node = this.domApi.node;
this._listeners = [];
};
DomApi.EffectiveNodesObserver.prototype = {
addListener: function (callback) {
if (!this._isSetup) {
this._setup();
this._isSetup = true;
}
var listener = {
fn: callback,
_nodes: []
};
this._listeners.push(listener);
this._scheduleNotify();
return listener;
},
removeListener: function (handle) {
var i = this._listeners.indexOf(handle);
if (i >= 0) {
this._listeners.splice(i, 1);
handle._nodes = [];
}
if (!this._hasListeners()) {
this._cleanup();
this._isSetup = false;
}
},
_setup: function () {
this._observeContentElements(this.domApi.childNodes);
},
_cleanup: function () {
this._unobserveContentElements(this.domApi.childNodes);
},
_hasListeners: function () {
return Boolean(this._listeners.length);
},
_scheduleNotify: function () {
if (this._debouncer) {
this._debouncer.stop();
}
this._debouncer = Polymer.Debounce(this._debouncer, this._notify);
this._debouncer.context = this;
Polymer.dom.addDebouncer(this._debouncer);
},
notify: function () {
if (this._hasListeners()) {
this._scheduleNotify();
}
},
_notify: function () {
this._beforeCallListeners();
this._callListeners();
},
_beforeCallListeners: function () {
this._updateContentElements();
},
_updateContentElements: function () {
this._observeContentElements(this.domApi.childNodes);
},
_observeContentElements: function (elements) {
for (var i = 0, n; i < elements.length && (n = elements[i]); i++) {
if (this._isContent(n)) {
n.__observeNodesMap = n.__observeNodesMap || new WeakMap();
if (!n.__observeNodesMap.has(this)) {
n.__observeNodesMap.set(this, this._observeContent(n));
}
}
}
},
_observeContent: function (content) {
var self = this;
var h = Polymer.dom(content).observeNodes(function () {
self._scheduleNotify();
});
h._avoidChangeCalculation = true;
return h;
},
_unobserveContentElements: function (elements) {
for (var i = 0, n, h; i < elements.length && (n = elements[i]); i++) {
if (this._isContent(n)) {
h = n.__observeNodesMap.get(this);
if (h) {
Polymer.dom(n).unobserveNodes(h);
n.__observeNodesMap.delete(this);
}
}
}
},
_isContent: function (node) {
return node.localName === 'content';
},
_callListeners: function () {
var o$ = this._listeners;
var nodes = this._getEffectiveNodes();
for (var i = 0, o; i < o$.length && (o = o$[i]); i++) {
var info = this._generateListenerInfo(o, nodes);
if (info || o._alwaysNotify) {
this._callListener(o, info);
}
}
},
_getEffectiveNodes: function () {
return this.domApi.getEffectiveChildNodes();
},
_generateListenerInfo: function (listener, newNodes) {
if (listener._avoidChangeCalculation) {
return true;
}
var oldNodes = listener._nodes;
var info = {
target: this.node,
addedNodes: [],
removedNodes: []
};
var splices = Polymer.ArraySplice.calculateSplices(newNodes, oldNodes);
for (var i = 0, s; i < splices.length && (s = splices[i]); i++) {
for (var j = 0, n; j < s.removed.length && (n = s.removed[j]); j++) {
info.removedNodes.push(n);
}
}
for (i = 0, s; i < splices.length && (s = splices[i]); i++) {
for (j = s.index; j < s.index + s.addedCount; j++) {
info.addedNodes.push(newNodes[j]);
}
}
listener._nodes = newNodes;
if (info.addedNodes.length || info.removedNodes.length) {
return info;
}
},
_callListener: function (listener, info) {
return listener.fn.call(this.node, info);
},
enableShadowAttributeTracking: function () {
}
};
if (Settings.useShadow) {
var baseSetup = DomApi.EffectiveNodesObserver.prototype._setup;
var baseCleanup = DomApi.EffectiveNodesObserver.prototype._cleanup;
Polymer.Base.extend(DomApi.EffectiveNodesObserver.prototype, {
_setup: function () {
if (!this._observer) {
var self = this;
this._mutationHandler = function (mxns) {
if (mxns && mxns.length) {
self._scheduleNotify();
}
};
this._observer = new MutationObserver(this._mutationHandler);
this._boundFlush = function () {
self._flush();
};
Polymer.dom.addStaticFlush(this._boundFlush);
this._observer.observe(this.node, { childList: true });
}
baseSetup.call(this);
},
_cleanup: function () {
this._observer.disconnect();
this._observer = null;
this._mutationHandler = null;
Polymer.dom.removeStaticFlush(this._boundFlush);
baseCleanup.call(this);
},
_flush: function () {
if (this._observer) {
this._mutationHandler(this._observer.takeRecords());
}
},
enableShadowAttributeTracking: function () {
if (this._observer) {
this._makeContentListenersAlwaysNotify();
this._observer.disconnect();
this._observer.observe(this.node, {
childList: true,
attributes: true,
subtree: true
});
var root = this.domApi.getOwnerRoot();
var host = root && root.host;
if (host && Polymer.dom(host).observer) {
Polymer.dom(host).observer.enableShadowAttributeTracking();
}
}
},
_makeContentListenersAlwaysNotify: function () {
for (var i = 0, h; i < this._listeners.length; i++) {
h = this._listeners[i];
h._alwaysNotify = h._isContentListener;
}
}
});
}
}());(function () {
'use strict';
var DomApi = Polymer.DomApi.ctor;
var Settings = Polymer.Settings;
DomApi.DistributedNodesObserver = function (domApi) {
DomApi.EffectiveNodesObserver.call(this, domApi);
};
DomApi.DistributedNodesObserver.prototype = Object.create(DomApi.EffectiveNodesObserver.prototype);
Polymer.Base.extend(DomApi.DistributedNodesObserver.prototype, {
_setup: function () {
},
_cleanup: function () {
},
_beforeCallListeners: function () {
},
_getEffectiveNodes: function () {
return this.domApi.getDistributedNodes();
}
});
if (Settings.useShadow) {
Polymer.Base.extend(DomApi.DistributedNodesObserver.prototype, {
_setup: function () {
if (!this._observer) {
var root = this.domApi.getOwnerRoot();
var host = root && root.host;
if (host) {
var self = this;
this._observer = Polymer.dom(host).observeNodes(function () {
self._scheduleNotify();
});
this._observer._isContentListener = true;
if (this._hasAttrSelect()) {
Polymer.dom(host).observer.enableShadowAttributeTracking();
}
}
}
},
_hasAttrSelect: function () {
var select = this.node.getAttribute('select');
return select && select.match(/[[.]+/);
},
_cleanup: function () {
var root = this.domApi.getOwnerRoot();
var host = root && root.host;
if (host) {
Polymer.dom(host).unobserveNodes(this._observer);
}
this._observer = null;
}
});
}
}());(function () {
var DomApi = Polymer.DomApi;
var TreeApi = Polymer.TreeApi;
Polymer.Base._addFeature({
_prepShady: function () {
this._useContent = this._useContent || Boolean(this._template);
},
_setupShady: function () {
this.shadyRoot = null;
if (!this.__domApi) {
this.__domApi = null;
}
if (!this.__dom) {
this.__dom = null;
}
if (!this._ownerShadyRoot) {
this._ownerShadyRoot = undefined;
}
},
_poolContent: function () {
if (this._useContent) {
TreeApi.Logical.saveChildNodes(this);
}
},
_setupRoot: function () {
if (this._useContent) {
this._createLocalRoot();
if (!this.dataHost) {
upgradeLogicalChildren(TreeApi.Logical.getChildNodes(this));
}
}
},
_createLocalRoot: function () {
this.shadyRoot = this.root;
this.shadyRoot._distributionClean = false;
this.shadyRoot._hasDistributed = false;
this.shadyRoot._isShadyRoot = true;
this.shadyRoot._dirtyRoots = [];
var i$ = this.shadyRoot._insertionPoints = !this._notes || this._notes._hasContent ? this.shadyRoot.querySelectorAll('content') : [];
TreeApi.Logical.saveChildNodes(this.shadyRoot);
for (var i = 0, c; i < i$.length; i++) {
c = i$[i];
TreeApi.Logical.saveChildNodes(c);
TreeApi.Logical.saveChildNodes(c.parentNode);
}
this.shadyRoot.host = this;
},
get domHost() {
var root = Polymer.dom(this).getOwnerRoot();
return root && root.host;
},
distributeContent: function (updateInsertionPoints) {
if (this.shadyRoot) {
this.shadyRoot._invalidInsertionPoints = this.shadyRoot._invalidInsertionPoints || updateInsertionPoints;
var host = getTopDistributingHost(this);
Polymer.dom(this)._lazyDistribute(host);
}
},
_distributeContent: function () {
if (this._useContent && !this.shadyRoot._distributionClean) {
if (this.shadyRoot._invalidInsertionPoints) {
Polymer.dom(this)._updateInsertionPoints(this);
this.shadyRoot._invalidInsertionPoints = false;
}
this._beginDistribute();
this._distributeDirtyRoots();
this._finishDistribute();
}
},
_beginDistribute: function () {
if (this._useContent && DomApi.hasInsertionPoint(this.shadyRoot)) {
this._resetDistribution();
this._distributePool(this.shadyRoot, this._collectPool());
}
},
_distributeDirtyRoots: function () {
var c$ = this.shadyRoot._dirtyRoots;
for (var i = 0, l = c$.length, c; i < l && (c = c$[i]); i++) {
c._distributeContent();
}
this.shadyRoot._dirtyRoots = [];
},
_finishDistribute: function () {
if (this._useContent) {
this.shadyRoot._distributionClean = true;
if (DomApi.hasInsertionPoint(this.shadyRoot)) {
this._composeTree();
notifyContentObservers(this.shadyRoot);
} else {
if (!this.shadyRoot._hasDistributed) {
TreeApi.Composed.clearChildNodes(this);
this.appendChild(this.shadyRoot);
} else {
var children = this._composeNode(this);
this._updateChildNodes(this, children);
}
}
if (!this.shadyRoot._hasDistributed) {
notifyInitialDistribution(this);
}
this.shadyRoot._hasDistributed = true;
}
},
elementMatches: function (selector, node) {
node = node || this;
return DomApi.matchesSelector.call(node, selector);
},
_resetDistribution: function () {
var children = TreeApi.Logical.getChildNodes(this);
for (var i = 0; i < children.length; i++) {
var child = children[i];
if (child._destinationInsertionPoints) {
child._destinationInsertionPoints = undefined;
}
if (isInsertionPoint(child)) {
clearDistributedDestinationInsertionPoints(child);
}
}
var root = this.shadyRoot;
var p$ = root._insertionPoints;
for (var j = 0; j < p$.length; j++) {
p$[j]._distributedNodes = [];
}
},
_collectPool: function () {
var pool = [];
var children = TreeApi.Logical.getChildNodes(this);
for (var i = 0; i < children.length; i++) {
var child = children[i];
if (isInsertionPoint(child)) {
pool.push.apply(pool, child._distributedNodes);
} else {
pool.push(child);
}
}
return pool;
},
_distributePool: function (node, pool) {
var p$ = node._insertionPoints;
for (var i = 0, l = p$.length, p; i < l && (p = p$[i]); i++) {
this._distributeInsertionPoint(p, pool);
maybeRedistributeParent(p, this);
}
},
_distributeInsertionPoint: function (content, pool) {
var anyDistributed = false;
for (var i = 0, l = pool.length, node; i < l; i++) {
node = pool[i];
if (!node) {
continue;
}
if (this._matchesContentSelect(node, content)) {
distributeNodeInto(node, content);
pool[i] = undefined;
anyDistributed = true;
}
}
if (!anyDistributed) {
var children = TreeApi.Logical.getChildNodes(content);
for (var j = 0; j < children.length; j++) {
distributeNodeInto(children[j], content);
}
}
},
_composeTree: function () {
this._updateChildNodes(this, this._composeNode(this));
var p$ = this.shadyRoot._insertionPoints;
for (var i = 0, l = p$.length, p, parent; i < l && (p = p$[i]); i++) {
parent = TreeApi.Logical.getParentNode(p);
if (!parent._useContent && parent !== this && parent !== this.shadyRoot) {
this._updateChildNodes(parent, this._composeNode(parent));
}
}
},
_composeNode: function (node) {
var children = [];
var c$ = TreeApi.Logical.getChildNodes(node.shadyRoot || node);
for (var i = 0; i < c$.length; i++) {
var child = c$[i];
if (isInsertionPoint(child)) {
var distributedNodes = child._distributedNodes;
for (var j = 0; j < distributedNodes.length; j++) {
var distributedNode = distributedNodes[j];
if (isFinalDestination(child, distributedNode)) {
children.push(distributedNode);
}
}
} else {
children.push(child);
}
}
return children;
},
_updateChildNodes: function (container, children) {
var composed = TreeApi.Composed.getChildNodes(container);
var splices = Polymer.ArraySplice.calculateSplices(children, composed);
for (var i = 0, d = 0, s; i < splices.length && (s = splices[i]); i++) {
for (var j = 0, n; j < s.removed.length && (n = s.removed[j]); j++) {
if (TreeApi.Composed.getParentNode(n) === container) {
TreeApi.Composed.removeChild(container, n);
}
composed.splice(s.index + d, 1);
}
d -= s.addedCount;
}
for (var i = 0, s, next; i < splices.length && (s = splices[i]); i++) {
next = composed[s.index];
for (j = s.index, n; j < s.index + s.addedCount; j++) {
n = children[j];
TreeApi.Composed.insertBefore(container, n, next);
composed.splice(j, 0, n);
}
}
},
_matchesContentSelect: function (node, contentElement) {
var select = contentElement.getAttribute('select');
if (!select) {
return true;
}
select = select.trim();
if (!select) {
return true;
}
if (!(node instanceof Element)) {
return false;
}
var validSelectors = /^(:not\()?[*.#[a-zA-Z_|]/;
if (!validSelectors.test(select)) {
return false;
}
return this.elementMatches(select, node);
},
_elementAdd: function () {
},
_elementRemove: function () {
}
});
function distributeNodeInto(child, insertionPoint) {
insertionPoint._distributedNodes.push(child);
var points = child._destinationInsertionPoints;
if (!points) {
child._destinationInsertionPoints = [insertionPoint];
} else {
points.push(insertionPoint);
}
}
function clearDistributedDestinationInsertionPoints(content) {
var e$ = content._distributedNodes;
if (e$) {
for (var i = 0; i < e$.length; i++) {
var d = e$[i]._destinationInsertionPoints;
if (d) {
d.splice(d.indexOf(content) + 1, d.length);
}
}
}
}
function maybeRedistributeParent(content, host) {
var parent = TreeApi.Logical.getParentNode(content);
if (parent && parent.shadyRoot && DomApi.hasInsertionPoint(parent.shadyRoot) && parent.shadyRoot._distributionClean) {
parent.shadyRoot._distributionClean = false;
host.shadyRoot._dirtyRoots.push(parent);
}
}
function isFinalDestination(insertionPoint, node) {
var points = node._destinationInsertionPoints;
return points && points[points.length - 1] === insertionPoint;
}
function isInsertionPoint(node) {
return node.localName == 'content';
}
function getTopDistributingHost(host) {
while (host && hostNeedsRedistribution(host)) {
host = host.domHost;
}
return host;
}
function hostNeedsRedistribution(host) {
var c$ = TreeApi.Logical.getChildNodes(host);
for (var i = 0, c; i < c$.length; i++) {
c = c$[i];
if (c.localName && c.localName === 'content') {
return host.domHost;
}
}
}
function notifyContentObservers(root) {
for (var i = 0, c; i < root._insertionPoints.length; i++) {
c = root._insertionPoints[i];
if (DomApi.hasApi(c)) {
Polymer.dom(c).notifyObserver();
}
}
}
function notifyInitialDistribution(host) {
if (DomApi.hasApi(host)) {
Polymer.dom(host).notifyObserver();
}
}
var needsUpgrade = window.CustomElements && !CustomElements.useNative;
function upgradeLogicalChildren(children) {
if (needsUpgrade && children) {
for (var i = 0; i < children.length; i++) {
CustomElements.upgrade(children[i]);
}
}
}
}());if (Polymer.Settings.useShadow) {
Polymer.Base._addFeature({
_poolContent: function () {
},
_beginDistribute: function () {
},
distributeContent: function () {
},
_distributeContent: function () {
},
_finishDistribute: function () {
},
_createLocalRoot: function () {
this.createShadowRoot();
this.shadowRoot.appendChild(this.root);
this.root = this.shadowRoot;
}
});
}Polymer.Async = {
_currVal: 0,
_lastVal: 0,
_callbacks: [],
_twiddleContent: 0,
_twiddle: document.createTextNode(''),
run: function (callback, waitTime) {
if (waitTime > 0) {
return ~setTimeout(callback, waitTime);
} else {
this._twiddle.textContent = this._twiddleContent++;
this._callbacks.push(callback);
return this._currVal++;
}
},
cancel: function (handle) {
if (handle < 0) {
clearTimeout(~handle);
} else {
var idx = handle - this._lastVal;
if (idx >= 0) {
if (!this._callbacks[idx]) {
throw 'invalid async handle: ' + handle;
}
this._callbacks[idx] = null;
}
}
},
_atEndOfMicrotask: function () {
var len = this._callbacks.length;
for (var i = 0; i < len; i++) {
var cb = this._callbacks[i];
if (cb) {
try {
cb();
} catch (e) {
i++;
this._callbacks.splice(0, i);
this._lastVal += i;
this._twiddle.textContent = this._twiddleContent++;
throw e;
}
}
}
this._callbacks.splice(0, len);
this._lastVal += len;
}
};
new window.MutationObserver(function () {
Polymer.Async._atEndOfMicrotask();
}).observe(Polymer.Async._twiddle, { characterData: true });Polymer.Debounce = function () {
var Async = Polymer.Async;
var Debouncer = function (context) {
this.context = context;
var self = this;
this.boundComplete = function () {
self.complete();
};
};
Debouncer.prototype = {
go: function (callback, wait) {
var h;
this.finish = function () {
Async.cancel(h);
};
h = Async.run(this.boundComplete, wait);
this.callback = callback;
},
stop: function () {
if (this.finish) {
this.finish();
this.finish = null;
this.callback = null;
}
},
complete: function () {
if (this.finish) {
var callback = this.callback;
this.stop();
callback.call(this.context);
}
}
};
function debounce(debouncer, callback, wait) {
if (debouncer) {
debouncer.stop();
} else {
debouncer = new Debouncer(this);
}
debouncer.go(callback, wait);
return debouncer;
}
return debounce;
}();Polymer.Base._addFeature({
_setupDebouncers: function () {
this._debouncers = {};
},
debounce: function (jobName, callback, wait) {
return this._debouncers[jobName] = Polymer.Debounce.call(this, this._debouncers[jobName], callback, wait);
},
isDebouncerActive: function (jobName) {
var debouncer = this._debouncers[jobName];
return !!(debouncer && debouncer.finish);
},
flushDebouncer: function (jobName) {
var debouncer = this._debouncers[jobName];
if (debouncer) {
debouncer.complete();
}
},
cancelDebouncer: function (jobName) {
var debouncer = this._debouncers[jobName];
if (debouncer) {
debouncer.stop();
}
}
});Polymer.DomModule = document.createElement('dom-module');
Polymer.Base._addFeature({
_registerFeatures: function () {
this._prepIs();
this._prepBehaviors();
this._prepConstructor();
this._prepTemplate();
this._prepShady();
this._prepPropertyInfo();
},
_prepBehavior: function (b) {
this._addHostAttributes(b.hostAttributes);
},
_initFeatures: function () {
this._registerHost();
if (this._template) {
this._poolContent();
this._beginHosting();
this._stampTemplate();
this._endHosting();
}
this._marshalHostAttributes();
this._setupDebouncers();
this._marshalBehaviors();
this._tryReady();
},
_marshalBehavior: function (b) {
}
});</script><script>Polymer.nar = [];
Polymer.Annotations = {
parseAnnotations: function (template) {
var list = [];
var content = template._content || template.content;
this._parseNodeAnnotations(content, list, template.hasAttribute('strip-whitespace'));
return list;
},
_parseNodeAnnotations: function (node, list, stripWhiteSpace) {
return node.nodeType === Node.TEXT_NODE ? this._parseTextNodeAnnotation(node, list) : this._parseElementAnnotations(node, list, stripWhiteSpace);
},
_bindingRegex: function () {
var IDENT = '(?:' + '[a-zA-Z_$][\\w.:$\\-*]*' + ')';
var NUMBER = '(?:' + '[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?' + ')';
var SQUOTE_STRING = '(?:' + '\'(?:[^\'\\\\]|\\\\.)*\'' + ')';
var DQUOTE_STRING = '(?:' + '"(?:[^"\\\\]|\\\\.)*"' + ')';
var STRING = '(?:' + SQUOTE_STRING + '|' + DQUOTE_STRING + ')';
var ARGUMENT = '(?:' + IDENT + '|' + NUMBER + '|' + STRING + '\\s*' + ')';
var ARGUMENTS = '(?:' + ARGUMENT + '(?:,\\s*' + ARGUMENT + ')*' + ')';
var ARGUMENT_LIST = '(?:' + '\\(\\s*' + '(?:' + ARGUMENTS + '?' + ')' + '\\)\\s*' + ')';
var BINDING = '(' + IDENT + '\\s*' + ARGUMENT_LIST + '?' + ')';
var OPEN_BRACKET = '(\\[\\[|{{)' + '\\s*';
var CLOSE_BRACKET = '(?:]]|}})';
var NEGATE = '(?:(!)\\s*)?';
var EXPRESSION = OPEN_BRACKET + NEGATE + BINDING + CLOSE_BRACKET;
return new RegExp(EXPRESSION, 'g');
}(),
_parseBindings: function (text) {
var re = this._bindingRegex;
var parts = [];
var lastIndex = 0;
var m;
while ((m = re.exec(text)) !== null) {
if (m.index > lastIndex) {
parts.push({ literal: text.slice(lastIndex, m.index) });
}
var mode = m[1][0];
var negate = Boolean(m[2]);
var value = m[3].trim();
var customEvent, notifyEvent, colon;
if (mode == '{' && (colon = value.indexOf('::')) > 0) {
notifyEvent = value.substring(colon + 2);
value = value.substring(0, colon);
customEvent = true;
}
parts.push({
compoundIndex: parts.length,
value: value,
mode: mode,
negate: negate,
event: notifyEvent,
customEvent: customEvent
});
lastIndex = re.lastIndex;
}
if (lastIndex && lastIndex < text.length) {
var literal = text.substring(lastIndex);
if (literal) {
parts.push({ literal: literal });
}
}
if (parts.length) {
return parts;
}
},
_literalFromParts: function (parts) {
var s = '';
for (var i = 0; i < parts.length; i++) {
var literal = parts[i].literal;
s += literal || '';
}
return s;
},
_parseTextNodeAnnotation: function (node, list) {
var parts = this._parseBindings(node.textContent);
if (parts) {
node.textContent = this._literalFromParts(parts) || ' ';
var annote = {
bindings: [{
kind: 'text',
name: 'textContent',
parts: parts,
isCompound: parts.length !== 1
}]
};
list.push(annote);
return annote;
}
},
_parseElementAnnotations: function (element, list, stripWhiteSpace) {
var annote = {
bindings: [],
events: []
};
if (element.localName === 'content') {
list._hasContent = true;
}
this._parseChildNodesAnnotations(element, annote, list, stripWhiteSpace);
if (element.attributes) {
this._parseNodeAttributeAnnotations(element, annote, list);
if (this.prepElement) {
this.prepElement(element);
}
}
if (annote.bindings.length || annote.events.length || annote.id) {
list.push(annote);
}
return annote;
},
_parseChildNodesAnnotations: function (root, annote, list, stripWhiteSpace) {
if (root.firstChild) {
var node = root.firstChild;
var i = 0;
while (node) {
var next = node.nextSibling;
if (node.localName === 'template' && !node.hasAttribute('preserve-content')) {
this._parseTemplate(node, i, list, annote);
}
if (node.nodeType === Node.TEXT_NODE) {
var n = next;
while (n && n.nodeType === Node.TEXT_NODE) {
node.textContent += n.textContent;
next = n.nextSibling;
root.removeChild(n);
n = next;
}
if (stripWhiteSpace && !node.textContent.trim()) {
root.removeChild(node);
i--;
}
}
if (node.parentNode) {
var childAnnotation = this._parseNodeAnnotations(node, list, stripWhiteSpace);
if (childAnnotation) {
childAnnotation.parent = annote;
childAnnotation.index = i;
}
}
node = next;
i++;
}
}
},
_parseTemplate: function (node, index, list, parent) {
var content = document.createDocumentFragment();
content._notes = this.parseAnnotations(node);
content.appendChild(node.content);
list.push({
bindings: Polymer.nar,
events: Polymer.nar,
templateContent: content,
parent: parent,
index: index
});
},
_parseNodeAttributeAnnotations: function (node, annotation) {
var attrs = Array.prototype.slice.call(node.attributes);
for (var i = attrs.length - 1, a; a = attrs[i]; i--) {
var n = a.name;
var v = a.value;
var b;
if (n.slice(0, 3) === 'on-') {
node.removeAttribute(n);
annotation.events.push({
name: n.slice(3),
value: v
});
} else if (b = this._parseNodeAttributeAnnotation(node, n, v)) {
annotation.bindings.push(b);
} else if (n === 'id') {
annotation.id = v;
}
}
},
_parseNodeAttributeAnnotation: function (node, name, value) {
var parts = this._parseBindings(value);
if (parts) {
var origName = name;
var kind = 'property';
if (name[name.length - 1] == '$') {
name = name.slice(0, -1);
kind = 'attribute';
}
var literal = this._literalFromParts(parts);
if (literal && kind == 'attribute') {
node.setAttribute(name, literal);
}
if (node.localName === 'input' && origName === 'value') {
node.setAttribute(origName, '');
}
node.removeAttribute(origName);
var propertyName = Polymer.CaseMap.dashToCamelCase(name);
if (kind === 'property') {
name = propertyName;
}
return {
kind: kind,
name: name,
propertyName: propertyName,
parts: parts,
literal: literal,
isCompound: parts.length !== 1
};
}
},
findAnnotatedNode: function (root, annote) {
var parent = annote.parent && Polymer.Annotations.findAnnotatedNode(root, annote.parent);
if (parent) {
for (var n = parent.firstChild, i = 0; n; n = n.nextSibling) {
if (annote.index === i++) {
return n;
}
}
} else {
return root;
}
}
};(function () {
function resolveCss(cssText, ownerDocument) {
return cssText.replace(CSS_URL_RX, function (m, pre, url, post) {
return pre + '\'' + resolve(url.replace(/["']/g, ''), ownerDocument) + '\'' + post;
});
}
function resolveAttrs(element, ownerDocument) {
for (var name in URL_ATTRS) {
var a$ = URL_ATTRS[name];
for (var i = 0, l = a$.length, a, at, v; i < l && (a = a$[i]); i++) {
if (name === '*' || element.localName === name) {
at = element.attributes[a];
v = at && at.value;
if (v && v.search(BINDING_RX) < 0) {
at.value = a === 'style' ? resolveCss(v, ownerDocument) : resolve(v, ownerDocument);
}
}
}
}
}
function resolve(url, ownerDocument) {
if (url && ABS_URL.test(url)) {
return url;
}
var resolver = getUrlResolver(ownerDocument);
resolver.href = url;
return resolver.href || url;
}
var tempDoc;
var tempDocBase;
function resolveUrl(url, baseUri) {
if (!tempDoc) {
tempDoc = document.implementation.createHTMLDocument('temp');
tempDocBase = tempDoc.createElement('base');
tempDoc.head.appendChild(tempDocBase);
}
tempDocBase.href = baseUri;
return resolve(url, tempDoc);
}
function getUrlResolver(ownerDocument) {
return ownerDocument.__urlResolver || (ownerDocument.__urlResolver = ownerDocument.createElement('a'));
}
var CSS_URL_RX = /(url\()([^)]*)(\))/g;
var URL_ATTRS = {
'*': [
'href',
'src',
'style',
'url'
],
form: ['action']
};
var ABS_URL = /(^\/)|(^#)|(^[\w-\d]*:)/;
var BINDING_RX = /\{\{|\[\[/;
Polymer.ResolveUrl = {
resolveCss: resolveCss,
resolveAttrs: resolveAttrs,
resolveUrl: resolveUrl
};
}());Polymer.Base._addFeature({
_prepAnnotations: function () {
if (!this._template) {
this._notes = [];
} else {
var self = this;
Polymer.Annotations.prepElement = function (element) {
self._prepElement(element);
};
if (this._template._content && this._template._content._notes) {
this._notes = this._template._content._notes;
} else {
this._notes = Polymer.Annotations.parseAnnotations(this._template);
this._processAnnotations(this._notes);
}
Polymer.Annotations.prepElement = null;
}
},
_processAnnotations: function (notes) {
for (var i = 0; i < notes.length; i++) {
var note = notes[i];
for (var j = 0; j < note.bindings.length; j++) {
var b = note.bindings[j];
for (var k = 0; k < b.parts.length; k++) {
var p = b.parts[k];
if (!p.literal) {
var signature = this._parseMethod(p.value);
if (signature) {
p.signature = signature;
} else {
p.model = this._modelForPath(p.value);
}
}
}
}
if (note.templateContent) {
this._processAnnotations(note.templateContent._notes);
var pp = note.templateContent._parentProps = this._discoverTemplateParentProps(note.templateContent._notes);
var bindings = [];
for (var prop in pp) {
var name = '_parent_' + prop;
bindings.push({
index: note.index,
kind: 'property',
name: name,
propertyName: name,
parts: [{
mode: '{',
model: prop,
value: prop
}]
});
}
note.bindings = note.bindings.concat(bindings);
}
}
},
_discoverTemplateParentProps: function (notes) {
var pp = {};
for (var i = 0, n; i < notes.length && (n = notes[i]); i++) {
for (var j = 0, b$ = n.bindings, b; j < b$.length && (b = b$[j]); j++) {
for (var k = 0, p$ = b.parts, p; k < p$.length && (p = p$[k]); k++) {
if (p.signature) {
var args = p.signature.args;
for (var kk = 0; kk < args.length; kk++) {
var model = args[kk].model;
if (model) {
pp[model] = true;
}
}
if (p.signature.dynamicFn) {
pp[p.signature.method] = true;
}
} else {
if (p.model) {
pp[p.model] = true;
}
}
}
}
if (n.templateContent) {
var tpp = n.templateContent._parentProps;
Polymer.Base.mixin(pp, tpp);
}
}
return pp;
},
_prepElement: function (element) {
Polymer.ResolveUrl.resolveAttrs(element, this._template.ownerDocument);
},
_findAnnotatedNode: Polymer.Annotations.findAnnotatedNode,
_marshalAnnotationReferences: function () {
if (this._template) {
this._marshalIdNodes();
this._marshalAnnotatedNodes();
this._marshalAnnotatedListeners();
}
},
_configureAnnotationReferences: function () {
var notes = this._notes;
var nodes = this._nodes;
for (var i = 0; i < notes.length; i++) {
var note = notes[i];
var node = nodes[i];
this._configureTemplateContent(note, node);
this._configureCompoundBindings(note, node);
}
},
_configureTemplateContent: function (note, node) {
if (note.templateContent) {
node._content = note.templateContent;
}
},
_configureCompoundBindings: function (note, node) {
var bindings = note.bindings;
for (var i = 0; i < bindings.length; i++) {
var binding = bindings[i];
if (binding.isCompound) {
var storage = node.__compoundStorage__ || (node.__compoundStorage__ = {});
var parts = binding.parts;
var literals = new Array(parts.length);
for (var j = 0; j < parts.length; j++) {
literals[j] = parts[j].literal;
}
var name = binding.name;
storage[name] = literals;
if (binding.literal && binding.kind == 'property') {
if (node._configValue) {
node._configValue(name, binding.literal);
} else {
node[name] = binding.literal;
}
}
}
}
},
_marshalIdNodes: function () {
this.$ = {};
for (var i = 0, l = this._notes.length, a; i < l && (a = this._notes[i]); i++) {
if (a.id) {
this.$[a.id] = this._findAnnotatedNode(this.root, a);
}
}
},
_marshalAnnotatedNodes: function () {
if (this._notes && this._notes.length) {
var r = new Array(this._notes.length);
for (var i = 0; i < this._notes.length; i++) {
r[i] = this._findAnnotatedNode(this.root, this._notes[i]);
}
this._nodes = r;
}
},
_marshalAnnotatedListeners: function () {
for (var i = 0, l = this._notes.length, a; i < l && (a = this._notes[i]); i++) {
if (a.events && a.events.length) {
var node = this._findAnnotatedNode(this.root, a);
for (var j = 0, e$ = a.events, e; j < e$.length && (e = e$[j]); j++) {
this.listen(node, e.name, e.value);
}
}
}
}
});Polymer.Base._addFeature({
listeners: {},
_listenListeners: function (listeners) {
var node, name, eventName;
for (eventName in listeners) {
if (eventName.indexOf('.') < 0) {
node = this;
name = eventName;
} else {
name = eventName.split('.');
node = this.$[name[0]];
name = name[1];
}
this.listen(node, name, listeners[eventName]);
}
},
listen: function (node, eventName, methodName) {
var handler = this._recallEventHandler(this, eventName, node, methodName);
if (!handler) {
handler = this._createEventHandler(node, eventName, methodName);
}
if (handler._listening) {
return;
}
this._listen(node, eventName, handler);
handler._listening = true;
},
_boundListenerKey: function (eventName, methodName) {
return eventName + ':' + methodName;
},
_recordEventHandler: function (host, eventName, target, methodName, handler) {
var hbl = host.__boundListeners;
if (!hbl) {
hbl = host.__boundListeners = new WeakMap();
}
var bl = hbl.get(target);
if (!bl) {
bl = {};
hbl.set(target, bl);
}
var key = this._boundListenerKey(eventName, methodName);
bl[key] = handler;
},
_recallEventHandler: function (host, eventName, target, methodName) {
var hbl = host.__boundListeners;
if (!hbl) {
return;
}
var bl = hbl.get(target);
if (!bl) {
return;
}
var key = this._boundListenerKey(eventName, methodName);
return bl[key];
},
_createEventHandler: function (node, eventName, methodName) {
var host = this;
var handler = function (e) {
if (host[methodName]) {
host[methodName](e, e.detail);
} else {
host._warn(host._logf('_createEventHandler', 'listener method `' + methodName + '` not defined'));
}
};
handler._listening = false;
this._recordEventHandler(host, eventName, node, methodName, handler);
return handler;
},
unlisten: function (node, eventName, methodName) {
var handler = this._recallEventHandler(this, eventName, node, methodName);
if (handler) {
this._unlisten(node, eventName, handler);
handler._listening = false;
}
},
_listen: function (node, eventName, handler) {
node.addEventListener(eventName, handler);
},
_unlisten: function (node, eventName, handler) {
node.removeEventListener(eventName, handler);
}
});(function () {
'use strict';
var wrap = Polymer.DomApi.wrap;
var HAS_NATIVE_TA = typeof document.head.style.touchAction === 'string';
var GESTURE_KEY = '__polymerGestures';
var HANDLED_OBJ = '__polymerGesturesHandled';
var TOUCH_ACTION = '__polymerGesturesTouchAction';
var TAP_DISTANCE = 25;
var TRACK_DISTANCE = 5;
var TRACK_LENGTH = 2;
var MOUSE_TIMEOUT = 2500;
var MOUSE_EVENTS = [
'mousedown',
'mousemove',
'mouseup',
'click'
];
var MOUSE_WHICH_TO_BUTTONS = [
0,
1,
4,
2
];
var MOUSE_HAS_BUTTONS = function () {
try {
return new MouseEvent('test', { buttons: 1 }).buttons === 1;
} catch (e) {
return false;
}
}();
var IS_TOUCH_ONLY = navigator.userAgent.match(/iP(?:[oa]d|hone)|Android/);
var mouseCanceller = function (mouseEvent) {
var sc = mouseEvent.sourceCapabilities;
if (sc && !sc.firesTouchEvents) {
return;
}
mouseEvent[HANDLED_OBJ] = { skip: true };
if (mouseEvent.type === 'click') {
var path = Polymer.dom(mouseEvent).path;
for (var i = 0; i < path.length; i++) {
if (path[i] === POINTERSTATE.mouse.target) {
return;
}
}
mouseEvent.preventDefault();
mouseEvent.stopPropagation();
}
};
function setupTeardownMouseCanceller(setup) {
for (var i = 0, en; i < MOUSE_EVENTS.length; i++) {
en = MOUSE_EVENTS[i];
if (setup) {
document.addEventListener(en, mouseCanceller, true);
} else {
document.removeEventListener(en, mouseCanceller, true);
}
}
}
function ignoreMouse() {
if (IS_TOUCH_ONLY) {
return;
}
if (!POINTERSTATE.mouse.mouseIgnoreJob) {
setupTeardownMouseCanceller(true);
}
var unset = function () {
setupTeardownMouseCanceller();
POINTERSTATE.mouse.target = null;
POINTERSTATE.mouse.mouseIgnoreJob = null;
};
POINTERSTATE.mouse.mouseIgnoreJob = Polymer.Debounce(POINTERSTATE.mouse.mouseIgnoreJob, unset, MOUSE_TIMEOUT);
}
function hasLeftMouseButton(ev) {
var type = ev.type;
if (MOUSE_EVENTS.indexOf(type) === -1) {
return false;
}
if (type === 'mousemove') {
var buttons = ev.buttons === undefined ? 1 : ev.buttons;
if (ev instanceof window.MouseEvent && !MOUSE_HAS_BUTTONS) {
buttons = MOUSE_WHICH_TO_BUTTONS[ev.which] || 0;
}
return Boolean(buttons & 1);
} else {
var button = ev.button === undefined ? 0 : ev.button;
return button === 0;
}
}
function isSyntheticClick(ev) {
if (ev.type === 'click') {
if (ev.detail === 0) {
return true;
}
var t = Gestures.findOriginalTarget(ev);
var bcr = t.getBoundingClientRect();
var x = ev.pageX, y = ev.pageY;
return !(x >= bcr.left && x <= bcr.right && (y >= bcr.top && y <= bcr.bottom));
}
return false;
}
var POINTERSTATE = {
mouse: {
target: null,
mouseIgnoreJob: null
},
touch: {
x: 0,
y: 0,
id: -1,
scrollDecided: false
}
};
function firstTouchAction(ev) {
var path = Polymer.dom(ev).path;
var ta = 'auto';
for (var i = 0, n; i < path.length; i++) {
n = path[i];
if (n[TOUCH_ACTION]) {
ta = n[TOUCH_ACTION];
break;
}
}
return ta;
}
function trackDocument(stateObj, movefn, upfn) {
stateObj.movefn = movefn;
stateObj.upfn = upfn;
document.addEventListener('mousemove', movefn);
document.addEventListener('mouseup', upfn);
}
function untrackDocument(stateObj) {
document.removeEventListener('mousemove', stateObj.movefn);
document.removeEventListener('mouseup', stateObj.upfn);
stateObj.movefn = null;
stateObj.upfn = null;
}
var Gestures = {
gestures: {},
recognizers: [],
deepTargetFind: function (x, y) {
var node = document.elementFromPoint(x, y);
var next = node;
while (next && next.shadowRoot) {
next = next.shadowRoot.elementFromPoint(x, y);
if (next) {
node = next;
}
}
return node;
},
findOriginalTarget: function (ev) {
if (ev.path) {
return ev.path[0];
}
return ev.target;
},
handleNative: function (ev) {
var handled;
var type = ev.type;
var node = wrap(ev.currentTarget);
var gobj = node[GESTURE_KEY];
if (!gobj) {
return;
}
var gs = gobj[type];
if (!gs) {
return;
}
if (!ev[HANDLED_OBJ]) {
ev[HANDLED_OBJ] = {};
if (type.slice(0, 5) === 'touch') {
var t = ev.changedTouches[0];
if (type === 'touchstart') {
if (ev.touches.length === 1) {
POINTERSTATE.touch.id = t.identifier;
}
}
if (POINTERSTATE.touch.id !== t.identifier) {
return;
}
if (!HAS_NATIVE_TA) {
if (type === 'touchstart' || type === 'touchmove') {
Gestures.handleTouchAction(ev);
}
}
if (type === 'touchend') {
POINTERSTATE.mouse.target = Polymer.dom(ev).rootTarget;
ignoreMouse();
}
}
}
handled = ev[HANDLED_OBJ];
if (handled.skip) {
return;
}
var recognizers = Gestures.recognizers;
for (var i = 0, r; i < recognizers.length; i++) {
r = recognizers[i];
if (gs[r.name] && !handled[r.name]) {
if (r.flow && r.flow.start.indexOf(ev.type) > -1 && r.reset) {
r.reset();
}
}
}
for (i = 0, r; i < recognizers.length; i++) {
r = recognizers[i];
if (gs[r.name] && !handled[r.name]) {
handled[r.name] = true;
r[type](ev);
}
}
},
handleTouchAction: function (ev) {
var t = ev.changedTouches[0];
var type = ev.type;
if (type === 'touchstart') {
POINTERSTATE.touch.x = t.clientX;
POINTERSTATE.touch.y = t.clientY;
POINTERSTATE.touch.scrollDecided = false;
} else if (type === 'touchmove') {
if (POINTERSTATE.touch.scrollDecided) {
return;
}
POINTERSTATE.touch.scrollDecided = true;
var ta = firstTouchAction(ev);
var prevent = false;
var dx = Math.abs(POINTERSTATE.touch.x - t.clientX);
var dy = Math.abs(POINTERSTATE.touch.y - t.clientY);
if (!ev.cancelable) {
} else if (ta === 'none') {
prevent = true;
} else if (ta === 'pan-x') {
prevent = dy > dx;
} else if (ta === 'pan-y') {
prevent = dx > dy;
}
if (prevent) {
ev.preventDefault();
} else {
Gestures.prevent('track');
}
}
},
add: function (node, evType, handler) {
node = wrap(node);
var recognizer = this.gestures[evType];
var deps = recognizer.deps;
var name = recognizer.name;
var gobj = node[GESTURE_KEY];
if (!gobj) {
node[GESTURE_KEY] = gobj = {};
}
for (var i = 0, dep, gd; i < deps.length; i++) {
dep = deps[i];
if (IS_TOUCH_ONLY && MOUSE_EVENTS.indexOf(dep) > -1) {
continue;
}
gd = gobj[dep];
if (!gd) {
gobj[dep] = gd = { _count: 0 };
}
if (gd._count === 0) {
node.addEventListener(dep, this.handleNative);
}
gd[name] = (gd[name] || 0) + 1;
gd._count = (gd._count || 0) + 1;
}
node.addEventListener(evType, handler);
if (recognizer.touchAction) {
this.setTouchAction(node, recognizer.touchAction);
}
},
remove: function (node, evType, handler) {
node = wrap(node);
var recognizer = this.gestures[evType];
var deps = recognizer.deps;
var name = recognizer.name;
var gobj = node[GESTURE_KEY];
if (gobj) {
for (var i = 0, dep, gd; i < deps.length; i++) {
dep = deps[i];
gd = gobj[dep];
if (gd && gd[name]) {
gd[name] = (gd[name] || 1) - 1;
gd._count = (gd._count || 1) - 1;
if (gd._count === 0) {
node.removeEventListener(dep, this.handleNative);
}
}
}
}
node.removeEventListener(evType, handler);
},
register: function (recog) {
this.recognizers.push(recog);
for (var i = 0; i < recog.emits.length; i++) {
this.gestures[recog.emits[i]] = recog;
}
},
findRecognizerByEvent: function (evName) {
for (var i = 0, r; i < this.recognizers.length; i++) {
r = this.recognizers[i];
for (var j = 0, n; j < r.emits.length; j++) {
n = r.emits[j];
if (n === evName) {
return r;
}
}
}
return null;
},
setTouchAction: function (node, value) {
if (HAS_NATIVE_TA) {
node.style.touchAction = value;
}
node[TOUCH_ACTION] = value;
},
fire: function (target, type, detail) {
var ev = Polymer.Base.fire(type, detail, {
node: target,
bubbles: true,
cancelable: true
});
if (ev.defaultPrevented) {
var preventer = detail.preventer || detail.sourceEvent;
if (preventer && preventer.preventDefault) {
preventer.preventDefault();
}
}
},
prevent: function (evName) {
var recognizer = this.findRecognizerByEvent(evName);
if (recognizer.info) {
recognizer.info.prevent = true;
}
},
resetMouseCanceller: function () {
if (POINTERSTATE.mouse.mouseIgnoreJob) {
POINTERSTATE.mouse.mouseIgnoreJob.complete();
}
}
};
Gestures.register({
name: 'downup',
deps: [
'mousedown',
'touchstart',
'touchend'
],
flow: {
start: [
'mousedown',
'touchstart'
],
end: [
'mouseup',
'touchend'
]
},
emits: [
'down',
'up'
],
info: {
movefn: null,
upfn: null
},
reset: function () {
untrackDocument(this.info);
},
mousedown: function (e) {
if (!hasLeftMouseButton(e)) {
return;
}
var t = Gestures.findOriginalTarget(e);
var self = this;
var movefn = function movefn(e) {
if (!hasLeftMouseButton(e)) {
self.fire('up', t, e);
untrackDocument(self.info);
}
};
var upfn = function upfn(e) {
if (hasLeftMouseButton(e)) {
self.fire('up', t, e);
}
untrackDocument(self.info);
};
trackDocument(this.info, movefn, upfn);
this.fire('down', t, e);
},
touchstart: function (e) {
this.fire('down', Gestures.findOriginalTarget(e), e.changedTouches[0], e);
},
touchend: function (e) {
this.fire('up', Gestures.findOriginalTarget(e), e.changedTouches[0], e);
},
fire: function (type, target, event, preventer) {
Gestures.fire(target, type, {
x: event.clientX,
y: event.clientY,
sourceEvent: event,
preventer: preventer,
prevent: function (e) {
return Gestures.prevent(e);
}
});
}
});
Gestures.register({
name: 'track',
touchAction: 'none',
deps: [
'mousedown',
'touchstart',
'touchmove',
'touchend'
],
flow: {
start: [
'mousedown',
'touchstart'
],
end: [
'mouseup',
'touchend'
]
},
emits: ['track'],
info: {
x: 0,
y: 0,
state: 'start',
started: false,
moves: [],
addMove: function (move) {
if (this.moves.length > TRACK_LENGTH) {
this.moves.shift();
}
this.moves.push(move);
},
movefn: null,
upfn: null,
prevent: false
},
reset: function () {
this.info.state = 'start';
this.info.started = false;
this.info.moves = [];
this.info.x = 0;
this.info.y = 0;
this.info.prevent = false;
untrackDocument(this.info);
},
hasMovedEnough: function (x, y) {
if (this.info.prevent) {
return false;
}
if (this.info.started) {
return true;
}
var dx = Math.abs(this.info.x - x);
var dy = Math.abs(this.info.y - y);
return dx >= TRACK_DISTANCE || dy >= TRACK_DISTANCE;
},
mousedown: function (e) {
if (!hasLeftMouseButton(e)) {
return;
}
var t = Gestures.findOriginalTarget(e);
var self = this;
var movefn = function movefn(e) {
var x = e.clientX, y = e.clientY;
if (self.hasMovedEnough(x, y)) {
self.info.state = self.info.started ? e.type === 'mouseup' ? 'end' : 'track' : 'start';
if (self.info.state === 'start') {
Gestures.prevent('tap');
}
self.info.addMove({
x: x,
y: y
});
if (!hasLeftMouseButton(e)) {
self.info.state = 'end';
untrackDocument(self.info);
}
self.fire(t, e);
self.info.started = true;
}
};
var upfn = function upfn(e) {
if (self.info.started) {
movefn(e);
}
untrackDocument(self.info);
};
trackDocument(this.info, movefn, upfn);
this.info.x = e.clientX;
this.info.y = e.clientY;
},
touchstart: function (e) {
var ct = e.changedTouches[0];
this.info.x = ct.clientX;
this.info.y = ct.clientY;
},
touchmove: function (e) {
var t = Gestures.findOriginalTarget(e);
var ct = e.changedTouches[0];
var x = ct.clientX, y = ct.clientY;
if (this.hasMovedEnough(x, y)) {
if (this.info.state === 'start') {
Gestures.prevent('tap');
}
this.info.addMove({
x: x,
y: y
});
this.fire(t, ct);
this.info.state = 'track';
this.info.started = true;
}
},
touchend: function (e) {
var t = Gestures.findOriginalTarget(e);
var ct = e.changedTouches[0];
if (this.info.started) {
this.info.state = 'end';
this.info.addMove({
x: ct.clientX,
y: ct.clientY
});
this.fire(t, ct, e);
}
},
fire: function (target, touch, preventer) {
var secondlast = this.info.moves[this.info.moves.length - 2];
var lastmove = this.info.moves[this.info.moves.length - 1];
var dx = lastmove.x - this.info.x;
var dy = lastmove.y - this.info.y;
var ddx, ddy = 0;
if (secondlast) {
ddx = lastmove.x - secondlast.x;
ddy = lastmove.y - secondlast.y;
}
return Gestures.fire(target, 'track', {
state: this.info.state,
x: touch.clientX,
y: touch.clientY,
dx: dx,
dy: dy,
ddx: ddx,
ddy: ddy,
sourceEvent: touch,
preventer: preventer,
hover: function () {
return Gestures.deepTargetFind(touch.clientX, touch.clientY);
}
});
}
});
Gestures.register({
name: 'tap',
deps: [
'mousedown',
'click',
'touchstart',
'touchend'
],
flow: {
start: [
'mousedown',
'touchstart'
],
end: [
'click',
'touchend'
]
},
emits: ['tap'],
info: {
x: NaN,
y: NaN,
prevent: false
},
reset: function () {
this.info.x = NaN;
this.info.y = NaN;
this.info.prevent = false;
},
save: function (e) {
this.info.x = e.clientX;
this.info.y = e.clientY;
},
mousedown: function (e) {
if (hasLeftMouseButton(e)) {
this.save(e);
}
},
click: function (e) {
if (hasLeftMouseButton(e)) {
this.forward(e);
}
},
touchstart: function (e) {
this.save(e.changedTouches[0], e);
},
touchend: function (e) {
this.forward(e.changedTouches[0], e);
},
forward: function (e, preventer) {
var dx = Math.abs(e.clientX - this.info.x);
var dy = Math.abs(e.clientY - this.info.y);
var t = Gestures.findOriginalTarget(e);
if (isNaN(dx) || isNaN(dy) || dx <= TAP_DISTANCE && dy <= TAP_DISTANCE || isSyntheticClick(e)) {
if (!this.info.prevent) {
Gestures.fire(t, 'tap', {
x: e.clientX,
y: e.clientY,
sourceEvent: e,
preventer: preventer
});
}
}
}
});
var DIRECTION_MAP = {
x: 'pan-x',
y: 'pan-y',
none: 'none',
all: 'auto'
};
Polymer.Base._addFeature({
_setupGestures: function () {
this.__polymerGestures = null;
},
_listen: function (node, eventName, handler) {
if (Gestures.gestures[eventName]) {
Gestures.add(node, eventName, handler);
} else {
node.addEventListener(eventName, handler);
}
},
_unlisten: function (node, eventName, handler) {
if (Gestures.gestures[eventName]) {
Gestures.remove(node, eventName, handler);
} else {
node.removeEventListener(eventName, handler);
}
},
setScrollDirection: function (direction, node) {
node = node || this;
Gestures.setTouchAction(node, DIRECTION_MAP[direction] || 'auto');
}
});
Polymer.Gestures = Gestures;
}());(function () {
'use strict';
Polymer.Base._addFeature({
$$: function (slctr) {
return Polymer.dom(this.root).querySelector(slctr);
},
toggleClass: function (name, bool, node) {
node = node || this;
if (arguments.length == 1) {
bool = !node.classList.contains(name);
}
if (bool) {
Polymer.dom(node).classList.add(name);
} else {
Polymer.dom(node).classList.remove(name);
}
},
toggleAttribute: function (name, bool, node) {
node = node || this;
if (arguments.length == 1) {
bool = !node.hasAttribute(name);
}
if (bool) {
Polymer.dom(node).setAttribute(name, '');
} else {
Polymer.dom(node).removeAttribute(name);
}
},
classFollows: function (name, toElement, fromElement) {
if (fromElement) {
Polymer.dom(fromElement).classList.remove(name);
}
if (toElement) {
Polymer.dom(toElement).classList.add(name);
}
},
attributeFollows: function (name, toElement, fromElement) {
if (fromElement) {
Polymer.dom(fromElement).removeAttribute(name);
}
if (toElement) {
Polymer.dom(toElement).setAttribute(name, '');
}
},
getEffectiveChildNodes: function () {
return Polymer.dom(this).getEffectiveChildNodes();
},
getEffectiveChildren: function () {
var list = Polymer.dom(this).getEffectiveChildNodes();
return list.filter(function (n) {
return n.nodeType === Node.ELEMENT_NODE;
});
},
getEffectiveTextContent: function () {
var cn = this.getEffectiveChildNodes();
var tc = [];
for (var i = 0, c; c = cn[i]; i++) {
if (c.nodeType !== Node.COMMENT_NODE) {
tc.push(Polymer.dom(c).textContent);
}
}
return tc.join('');
},
queryEffectiveChildren: function (slctr) {
var e$ = Polymer.dom(this).queryDistributedElements(slctr);
return e$ && e$[0];
},
queryAllEffectiveChildren: function (slctr) {
return Polymer.dom(this).queryDistributedElements(slctr);
},
getContentChildNodes: function (slctr) {
var content = Polymer.dom(this.root).querySelector(slctr || 'content');
return content ? Polymer.dom(content).getDistributedNodes() : [];
},
getContentChildren: function (slctr) {
return this.getContentChildNodes(slctr).filter(function (n) {
return n.nodeType === Node.ELEMENT_NODE;
});
},
fire: function (type, detail, options) {
options = options || Polymer.nob;
var node = options.node || this;
detail = detail === null || detail === undefined ? {} : detail;
var bubbles = options.bubbles === undefined ? true : options.bubbles;
var cancelable = Boolean(options.cancelable);
var useCache = options._useCache;
var event = this._getEvent(type, bubbles, cancelable, useCache);
event.detail = detail;
if (useCache) {
this.__eventCache[type] = null;
}
node.dispatchEvent(event);
if (useCache) {
this.__eventCache[type] = event;
}
return event;
},
__eventCache: {},
_getEvent: function (type, bubbles, cancelable, useCache) {
var event = useCache && this.__eventCache[type];
if (!event || (event.bubbles != bubbles || event.cancelable != cancelable)) {
event = new Event(type, {
bubbles: Boolean(bubbles),
cancelable: cancelable
});
}
return event;
},
async: function (callback, waitTime) {
var self = this;
return Polymer.Async.run(function () {
callback.call(self);
}, waitTime);
},
cancelAsync: function (handle) {
Polymer.Async.cancel(handle);
},
arrayDelete: function (path, item) {
var index;
if (Array.isArray(path)) {
index = path.indexOf(item);
if (index >= 0) {
return path.splice(index, 1);
}
} else {
var arr = this._get(path);
index = arr.indexOf(item);
if (index >= 0) {
return this.splice(path, index, 1);
}
}
},
transform: function (transform, node) {
node = node || this;
node.style.webkitTransform = transform;
node.style.transform = transform;
},
translate3d: function (x, y, z, node) {
node = node || this;
this.transform('translate3d(' + x + ',' + y + ',' + z + ')', node);
},
importHref: function (href, onload, onerror, optAsync) {
var link = document.createElement('link');
link.rel = 'import';
link.href = href;
var list = Polymer.Base.importHref.imported = Polymer.Base.importHref.imported || {};
var cached = list[link.href];
var imprt = cached || link;
var self = this;
if (onload) {
var loadListener = function (e) {
e.target.__firedLoad = true;
e.target.removeEventListener('load', loadListener);
return onload.call(self, e);
};
imprt.addEventListener('load', loadListener);
}
if (onerror) {
var errorListener = function (e) {
e.target.__firedError = true;
e.target.removeEventListener('error', errorListener);
return onerror.call(self, e);
};
imprt.addEventListener('error', errorListener);
}
if (cached) {
if (cached.__firedLoad) {
cached.dispatchEvent(new Event('load'));
}
if (cached.__firedError) {
cached.dispatchEvent(new Event('error'));
}
} else {
list[link.href] = link;
optAsync = Boolean(optAsync);
if (optAsync) {
link.setAttribute('async', '');
}
document.head.appendChild(link);
}
return imprt;
},
create: function (tag, props) {
var elt = document.createElement(tag);
if (props) {
for (var n in props) {
elt[n] = props[n];
}
}
return elt;
},
isLightDescendant: function (node) {
return this !== node && this.contains(node) && Polymer.dom(this).getOwnerRoot() === Polymer.dom(node).getOwnerRoot();
},
isLocalDescendant: function (node) {
return this.root === Polymer.dom(node).getOwnerRoot();
}
});
if (!Polymer.Settings.useNativeCustomElements) {
var importHref = Polymer.Base.importHref;
Polymer.Base.importHref = function (href, onload, onerror, optAsync) {
CustomElements.ready = false;
var loadFn = function (e) {
CustomElements.upgradeDocumentTree(document);
CustomElements.ready = true;
if (onload) {
return onload.call(this, e);
}
};
return importHref.call(this, href, loadFn, onerror, optAsync);
};
}
}());Polymer.Bind = {
prepareModel: function (model) {
Polymer.Base.mixin(model, this._modelApi);
},
_modelApi: {
_notifyChange: function (source, event, value) {
value = value === undefined ? this[source] : value;
event = event || Polymer.CaseMap.camelToDashCase(source) + '-changed';
this.fire(event, { value: value }, {
bubbles: false,
cancelable: false,
_useCache: true
});
},
_propertySetter: function (property, value, effects, fromAbove) {
var old = this.__data__[property];
if (old !== value && (old === old || value === value)) {
this.__data__[property] = value;
if (typeof value == 'object') {
this._clearPath(property);
}
if (this._propertyChanged) {
this._propertyChanged(property, value, old);
}
if (effects) {
this._effectEffects(property, value, effects, old, fromAbove);
}
}
return old;
},
__setProperty: function (property, value, quiet, node) {
node = node || this;
var effects = node._propertyEffects && node._propertyEffects[property];
if (effects) {
node._propertySetter(property, value, effects, quiet);
} else if (node[property] !== value) {
node[property] = value;
}
},
_effectEffects: function (property, value, effects, old, fromAbove) {
for (var i = 0, l = effects.length, fx; i < l && (fx = effects[i]); i++) {
fx.fn.call(this, property, this[property], fx.effect, old, fromAbove);
}
},
_clearPath: function (path) {
for (var prop in this.__data__) {
if (prop.indexOf(path + '.') === 0) {
this.__data__[prop] = undefined;
}
}
}
},
ensurePropertyEffects: function (model, property) {
if (!model._propertyEffects) {
model._propertyEffects = {};
}
var fx = model._propertyEffects[property];
if (!fx) {
fx = model._propertyEffects[property] = [];
}
return fx;
},
addPropertyEffect: function (model, property, kind, effect) {
var fx = this.ensurePropertyEffects(model, property);
var propEffect = {
kind: kind,
effect: effect,
fn: Polymer.Bind['_' + kind + 'Effect']
};
fx.push(propEffect);
return propEffect;
},
createBindings: function (model) {
var fx$ = model._propertyEffects;
if (fx$) {
for (var n in fx$) {
var fx = fx$[n];
fx.sort(this._sortPropertyEffects);
this._createAccessors(model, n, fx);
}
}
},
_sortPropertyEffects: function () {
var EFFECT_ORDER = {
'compute': 0,
'annotation': 1,
'annotatedComputation': 2,
'reflect': 3,
'notify': 4,
'observer': 5,
'complexObserver': 6,
'function': 7
};
return function (a, b) {
return EFFECT_ORDER[a.kind] - EFFECT_ORDER[b.kind];
};
}(),
_createAccessors: function (model, property, effects) {
var defun = {
get: function () {
return this.__data__[property];
}
};
var setter = function (value) {
this._propertySetter(property, value, effects);
};
var info = model.getPropertyInfo && model.getPropertyInfo(property);
if (info && info.readOnly) {
if (!info.computed) {
model['_set' + this.upper(property)] = setter;
}
} else {
defun.set = setter;
}
Object.defineProperty(model, property, defun);
},
upper: function (name) {
return name[0].toUpperCase() + name.substring(1);
},
_addAnnotatedListener: function (model, index, property, path, event, negated) {
if (!model._bindListeners) {
model._bindListeners = [];
}
var fn = this._notedListenerFactory(property, path, this._isStructured(path), negated);
var eventName = event || Polymer.CaseMap.camelToDashCase(property) + '-changed';
model._bindListeners.push({
index: index,
property: property,
path: path,
changedFn: fn,
event: eventName
});
},
_isStructured: function (path) {
return path.indexOf('.') > 0;
},
_isEventBogus: function (e, target) {
return e.path && e.path[0] !== target;
},
_notedListenerFactory: function (property, path, isStructured, negated) {
return function (target, value, targetPath) {
if (targetPath) {
this._notifyPath(this._fixPath(path, property, targetPath), value);
} else {
value = target[property];
if (negated) {
value = !value;
}
if (!isStructured) {
this[path] = value;
} else {
if (this.__data__[path] != value) {
this.set(path, value);
}
}
}
};
},
prepareInstance: function (inst) {
inst.__data__ = Object.create(null);
},
setupBindListeners: function (inst) {
var b$ = inst._bindListeners;
for (var i = 0, l = b$.length, info; i < l && (info = b$[i]); i++) {
var node = inst._nodes[info.index];
this._addNotifyListener(node, inst, info.event, info.changedFn);
}
},
_addNotifyListener: function (element, context, event, changedFn) {
element.addEventListener(event, function (e) {
return context._notifyListener(changedFn, e);
});
}
};Polymer.Base.extend(Polymer.Bind, {
_shouldAddListener: function (effect) {
return effect.name && effect.kind != 'attribute' && effect.kind != 'text' && !effect.isCompound && effect.parts[0].mode === '{';
},
_annotationEffect: function (source, value, effect) {
if (source != effect.value) {
value = this._get(effect.value);
this.__data__[effect.value] = value;
}
this._applyEffectValue(effect, value);
},
_reflectEffect: function (source, value, effect) {
this.reflectPropertyToAttribute(source, effect.attribute, value);
},
_notifyEffect: function (source, value, effect, old, fromAbove) {
if (!fromAbove) {
this._notifyChange(source, effect.event, value);
}
},
_functionEffect: function (source, value, fn, old, fromAbove) {
fn.call(this, source, value, old, fromAbove);
},
_observerEffect: function (source, value, effect, old) {
var fn = this[effect.method];
if (fn) {
fn.call(this, value, old);
} else {
this._warn(this._logf('_observerEffect', 'observer method `' + effect.method + '` not defined'));
}
},
_complexObserverEffect: function (source, value, effect) {
var fn = this[effect.method];
if (fn) {
var args = Polymer.Bind._marshalArgs(this.__data__, effect, source, value);
if (args) {
fn.apply(this, args);
}
} else if (effect.dynamicFn) {
} else {
this._warn(this._logf('_complexObserverEffect', 'observer method `' + effect.method + '` not defined'));
}
},
_computeEffect: function (source, value, effect) {
var fn = this[effect.method];
if (fn) {
var args = Polymer.Bind._marshalArgs(this.__data__, effect, source, value);
if (args) {
var computedvalue = fn.apply(this, args);
this.__setProperty(effect.name, computedvalue);
}
} else if (effect.dynamicFn) {
} else {
this._warn(this._logf('_computeEffect', 'compute method `' + effect.method + '` not defined'));
}
},
_annotatedComputationEffect: function (source, value, effect) {
var computedHost = this._rootDataHost || this;
var fn = computedHost[effect.method];
if (fn) {
var args = Polymer.Bind._marshalArgs(this.__data__, effect, source, value);
if (args) {
var computedvalue = fn.apply(computedHost, args);
this._applyEffectValue(effect, computedvalue);
}
} else if (effect.dynamicFn) {
} else {
computedHost._warn(computedHost._logf('_annotatedComputationEffect', 'compute method `' + effect.method + '` not defined'));
}
},
_marshalArgs: function (model, effect, path, value) {
var values = [];
var args = effect.args;
var bailoutEarly = args.length > 1 || effect.dynamicFn;
for (var i = 0, l = args.length; i < l; i++) {
var arg = args[i];
var name = arg.name;
var v;
if (arg.literal) {
v = arg.value;
} else if (path === name) {
v = value;
} else {
v = model[name];
if (v === undefined && arg.structured) {
v = Polymer.Base._get(name, model);
}
}
if (bailoutEarly && v === undefined) {
return;
}
if (arg.wildcard) {
var matches = path.indexOf(name + '.') === 0;
values[i] = {
path: matches ? path : name,
value: matches ? value : v,
base: v
};
} else {
values[i] = v;
}
}
return values;
}
});Polymer.Base._addFeature({
_addPropertyEffect: function (property, kind, effect) {
var prop = Polymer.Bind.addPropertyEffect(this, property, kind, effect);
prop.pathFn = this['_' + prop.kind + 'PathEffect'];
},
_prepEffects: function () {
Polymer.Bind.prepareModel(this);
this._addAnnotationEffects(this._notes);
},
_prepBindings: function () {
Polymer.Bind.createBindings(this);
},
_addPropertyEffects: function (properties) {
if (properties) {
for (var p in properties) {
var prop = properties[p];
if (prop.observer) {
this._addObserverEffect(p, prop.observer);
}
if (prop.computed) {
prop.readOnly = true;
this._addComputedEffect(p, prop.computed);
}
if (prop.notify) {
this._addPropertyEffect(p, 'notify', { event: Polymer.CaseMap.camelToDashCase(p) + '-changed' });
}
if (prop.reflectToAttribute) {
var attr = Polymer.CaseMap.camelToDashCase(p);
if (attr[0] === '-') {
this._warn(this._logf('_addPropertyEffects', 'Property ' + p + ' cannot be reflected to attribute ' + attr + ' because "-" is not a valid starting attribute name. Use a lowercase first letter for the property instead.'));
} else {
this._addPropertyEffect(p, 'reflect', { attribute: attr });
}
}
if (prop.readOnly) {
Polymer.Bind.ensurePropertyEffects(this, p);
}
}
}
},
_addComputedEffect: function (name, expression) {
var sig = this._parseMethod(expression);
var dynamicFn = sig.dynamicFn;
for (var i = 0, arg; i < sig.args.length && (arg = sig.args[i]); i++) {
this._addPropertyEffect(arg.model, 'compute', {
method: sig.method,
args: sig.args,
trigger: arg,
name: name,
dynamicFn: dynamicFn
});
}
if (dynamicFn) {
this._addPropertyEffect(sig.method, 'compute', {
method: sig.method,
args: sig.args,
trigger: null,
name: name,
dynamicFn: dynamicFn
});
}
},
_addObserverEffect: function (property, observer) {
this._addPropertyEffect(property, 'observer', {
method: observer,
property: property
});
},
_addComplexObserverEffects: function (observers) {
if (observers) {
for (var i = 0, o; i < observers.length && (o = observers[i]); i++) {
this._addComplexObserverEffect(o);
}
}
},
_addComplexObserverEffect: function (observer) {
var sig = this._parseMethod(observer);
if (!sig) {
throw new Error('Malformed observer expression \'' + observer + '\'');
}
var dynamicFn = sig.dynamicFn;
for (var i = 0, arg; i < sig.args.length && (arg = sig.args[i]); i++) {
this._addPropertyEffect(arg.model, 'complexObserver', {
method: sig.method,
args: sig.args,
trigger: arg,
dynamicFn: dynamicFn
});
}
if (dynamicFn) {
this._addPropertyEffect(sig.method, 'complexObserver', {
method: sig.method,
args: sig.args,
trigger: null,
dynamicFn: dynamicFn
});
}
},
_addAnnotationEffects: function (notes) {
for (var i = 0, note; i < notes.length && (note = notes[i]); i++) {
var b$ = note.bindings;
for (var j = 0, binding; j < b$.length && (binding = b$[j]); j++) {
this._addAnnotationEffect(binding, i);
}
}
},
_addAnnotationEffect: function (note, index) {
if (Polymer.Bind._shouldAddListener(note)) {
Polymer.Bind._addAnnotatedListener(this, index, note.name, note.parts[0].value, note.parts[0].event, note.parts[0].negate);
}
for (var i = 0; i < note.parts.length; i++) {
var part = note.parts[i];
if (part.signature) {
this._addAnnotatedComputationEffect(note, part, index);
} else if (!part.literal) {
if (note.kind === 'attribute' && note.name[0] === '-') {
this._warn(this._logf('_addAnnotationEffect', 'Cannot set attribute ' + note.name + ' because "-" is not a valid attribute starting character'));
} else {
this._addPropertyEffect(part.model, 'annotation', {
kind: note.kind,
index: index,
name: note.name,
propertyName: note.propertyName,
value: part.value,
isCompound: note.isCompound,
compoundIndex: part.compoundIndex,
event: part.event,
customEvent: part.customEvent,
negate: part.negate
});
}
}
}
},
_addAnnotatedComputationEffect: function (note, part, index) {
var sig = part.signature;
if (sig.static) {
this.__addAnnotatedComputationEffect('__static__', index, note, part, null);
} else {
for (var i = 0, arg; i < sig.args.length && (arg = sig.args[i]); i++) {
if (!arg.literal) {
this.__addAnnotatedComputationEffect(arg.model, index, note, part, arg);
}
}
if (sig.dynamicFn) {
this.__addAnnotatedComputationEffect(sig.method, index, note, part, null);
}
}
},
__addAnnotatedComputationEffect: function (property, index, note, part, trigger) {
this._addPropertyEffect(property, 'annotatedComputation', {
index: index,
isCompound: note.isCompound,
compoundIndex: part.compoundIndex,
kind: note.kind,
name: note.name,
negate: part.negate,
method: part.signature.method,
args: part.signature.args,
trigger: trigger,
dynamicFn: part.signature.dynamicFn
});
},
_parseMethod: function (expression) {
var m = expression.match(/([^\s]+?)\(([\s\S]*)\)/);
if (m) {
var sig = {
method: m[1],
static: true
};
if (this.getPropertyInfo(sig.method) !== Polymer.nob) {
sig.static = false;
sig.dynamicFn = true;
}
if (m[2].trim()) {
var args = m[2].replace(/\\,/g, '&comma;').split(',');
return this._parseArgs(args, sig);
} else {
sig.args = Polymer.nar;
return sig;
}
}
},
_parseArgs: function (argList, sig) {
sig.args = argList.map(function (rawArg) {
var arg = this._parseArg(rawArg);
if (!arg.literal) {
sig.static = false;
}
return arg;
}, this);
return sig;
},
_parseArg: function (rawArg) {
var arg = rawArg.trim().replace(/&comma;/g, ',').replace(/\\(.)/g, '$1');
var a = { name: arg };
var fc = arg[0];
if (fc === '-') {
fc = arg[1];
}
if (fc >= '0' && fc <= '9') {
fc = '#';
}
switch (fc) {
case '\'':
case '"':
a.value = arg.slice(1, -1);
a.literal = true;
break;
case '#':
a.value = Number(arg);
a.literal = true;
break;
}
if (!a.literal) {
a.model = this._modelForPath(arg);
a.structured = arg.indexOf('.') > 0;
if (a.structured) {
a.wildcard = arg.slice(-2) == '.*';
if (a.wildcard) {
a.name = arg.slice(0, -2);
}
}
}
return a;
},
_marshalInstanceEffects: function () {
Polymer.Bind.prepareInstance(this);
if (this._bindListeners) {
Polymer.Bind.setupBindListeners(this);
}
},
_applyEffectValue: function (info, value) {
var node = this._nodes[info.index];
var property = info.name;
value = this._computeFinalAnnotationValue(node, property, value, info);
if (info.kind == 'attribute') {
this.serializeValueToAttribute(value, property, node);
} else {
var pinfo = node._propertyInfo && node._propertyInfo[property];
if (pinfo && pinfo.readOnly) {
return;
}
this.__setProperty(property, value, false, node);
}
},
_computeFinalAnnotationValue: function (node, property, value, info) {
if (info.negate) {
value = !value;
}
if (info.isCompound) {
var storage = node.__compoundStorage__[property];
storage[info.compoundIndex] = value;
value = storage.join('');
}
if (info.kind !== 'attribute') {
if (property === 'className') {
value = this._scopeElementClass(node, value);
}
if (property === 'textContent' || node.localName == 'input' && property == 'value') {
value = value == undefined ? '' : value;
}
}
return value;
},
_executeStaticEffects: function () {
if (this._propertyEffects && this._propertyEffects.__static__) {
this._effectEffects('__static__', null, this._propertyEffects.__static__);
}
}
});(function () {
var usePolyfillProto = Polymer.Settings.usePolyfillProto;
Polymer.Base._addFeature({
_setupConfigure: function (initialConfig) {
this._config = {};
this._handlers = [];
this._aboveConfig = null;
if (initialConfig) {
for (var i in initialConfig) {
if (initialConfig[i] !== undefined) {
this._config[i] = initialConfig[i];
}
}
}
},
_marshalAttributes: function () {
this._takeAttributesToModel(this._config);
},
_attributeChangedImpl: function (name) {
var model = this._clientsReadied ? this : this._config;
this._setAttributeToProperty(model, name);
},
_configValue: function (name, value) {
var info = this._propertyInfo[name];
if (!info || !info.readOnly) {
this._config[name] = value;
}
},
_beforeClientsReady: function () {
this._configure();
},
_configure: function () {
this._configureAnnotationReferences();
this._configureInstanceProperties();
this._aboveConfig = this.mixin({}, this._config);
var config = {};
for (var i = 0; i < this.behaviors.length; i++) {
this._configureProperties(this.behaviors[i].properties, config);
}
this._configureProperties(this.properties, config);
this.mixin(config, this._aboveConfig);
this._config = config;
if (this._clients && this._clients.length) {
this._distributeConfig(this._config);
}
},
_configureInstanceProperties: function () {
for (var i in this._propertyEffects) {
if (!usePolyfillProto && this.hasOwnProperty(i)) {
this._configValue(i, this[i]);
delete this[i];
}
}
},
_configureProperties: function (properties, config) {
for (var i in properties) {
var c = properties[i];
if (c.value !== undefined) {
var value = c.value;
if (typeof value == 'function') {
value = value.call(this, this._config);
}
config[i] = value;
}
}
},
_distributeConfig: function (config) {
var fx$ = this._propertyEffects;
if (fx$) {
for (var p in config) {
var fx = fx$[p];
if (fx) {
for (var i = 0, l = fx.length, x; i < l && (x = fx[i]); i++) {
if (x.kind === 'annotation') {
var node = this._nodes[x.effect.index];
var name = x.effect.propertyName;
var isAttr = x.effect.kind == 'attribute';
var hasEffect = node._propertyEffects && node._propertyEffects[name];
if (node._configValue && (hasEffect || !isAttr)) {
var value = p === x.effect.value ? config[p] : this._get(x.effect.value, config);
value = this._computeFinalAnnotationValue(node, name, value, x.effect);
if (isAttr) {
value = node.deserialize(this.serialize(value), node._propertyInfo[name].type);
}
node._configValue(name, value);
}
}
}
}
}
}
},
_afterClientsReady: function () {
this._executeStaticEffects();
this._applyConfig(this._config, this._aboveConfig);
this._flushHandlers();
},
_applyConfig: function (config, aboveConfig) {
for (var n in config) {
if (this[n] === undefined) {
this.__setProperty(n, config[n], n in aboveConfig);
}
}
},
_notifyListener: function (fn, e) {
if (!Polymer.Bind._isEventBogus(e, e.target)) {
var value, path;
if (e.detail) {
value = e.detail.value;
path = e.detail.path;
}
if (!this._clientsReadied) {
this._queueHandler([
fn,
e.target,
value,
path
]);
} else {
return fn.call(this, e.target, value, path);
}
}
},
_queueHandler: function (args) {
this._handlers.push(args);
},
_flushHandlers: function () {
var h$ = this._handlers;
for (var i = 0, l = h$.length, h; i < l && (h = h$[i]); i++) {
h[0].call(this, h[1], h[2], h[3]);
}
this._handlers = [];
}
});
}());(function () {
'use strict';
Polymer.Base._addFeature({
notifyPath: function (path, value, fromAbove) {
var info = {};
var v = this._get(path, this, info);
if (arguments.length === 1) {
value = v;
}
if (info.path) {
this._notifyPath(info.path, value, fromAbove);
}
},
_notifyPath: function (path, value, fromAbove) {
var old = this._propertySetter(path, value);
if (old !== value && (old === old || value === value)) {
this._pathEffector(path, value);
if (!fromAbove) {
this._notifyPathUp(path, value);
}
return true;
}
},
_getPathParts: function (path) {
if (Array.isArray(path)) {
var parts = [];
for (var i = 0; i < path.length; i++) {
var args = path[i].toString().split('.');
for (var j = 0; j < args.length; j++) {
parts.push(args[j]);
}
}
return parts;
} else {
return path.toString().split('.');
}
},
set: function (path, value, root) {
var prop = root || this;
var parts = this._getPathParts(path);
var array;
var last = parts[parts.length - 1];
if (parts.length > 1) {
for (var i = 0; i < parts.length - 1; i++) {
var part = parts[i];
if (array && part[0] == '#') {
prop = Polymer.Collection.get(array).getItem(part);
} else {
prop = prop[part];
if (array && parseInt(part, 10) == part) {
parts[i] = Polymer.Collection.get(array).getKey(prop);
}
}
if (!prop) {
return;
}
array = Array.isArray(prop) ? prop : null;
}
if (array) {
var coll = Polymer.Collection.get(array);
var old, key;
if (last[0] == '#') {
key = last;
old = coll.getItem(key);
last = array.indexOf(old);
coll.setItem(key, value);
} else if (parseInt(last, 10) == last) {
old = prop[last];
key = coll.getKey(old);
parts[i] = key;
coll.setItem(key, value);
}
}
prop[last] = value;
if (!root) {
this._notifyPath(parts.join('.'), value);
}
} else {
prop[path] = value;
}
},
get: function (path, root) {
return this._get(path, root);
},
_get: function (path, root, info) {
var prop = root || this;
var parts = this._getPathParts(path);
var array;
for (var i = 0; i < parts.length; i++) {
if (!prop) {
return;
}
var part = parts[i];
if (array && part[0] == '#') {
prop = Polymer.Collection.get(array).getItem(part);
} else {
prop = prop[part];
if (info && array && parseInt(part, 10) == part) {
parts[i] = Polymer.Collection.get(array).getKey(prop);
}
}
array = Array.isArray(prop) ? prop : null;
}
if (info) {
info.path = parts.join('.');
}
return prop;
},
_pathEffector: function (path, value) {
var model = this._modelForPath(path);
var fx$ = this._propertyEffects && this._propertyEffects[model];
if (fx$) {
for (var i = 0, fx; i < fx$.length && (fx = fx$[i]); i++) {
var fxFn = fx.pathFn;
if (fxFn) {
fxFn.call(this, path, value, fx.effect);
}
}
}
if (this._boundPaths) {
this._notifyBoundPaths(path, value);
}
},
_annotationPathEffect: function (path, value, effect) {
if (effect.value === path || effect.value.indexOf(path + '.') === 0) {
Polymer.Bind._annotationEffect.call(this, path, value, effect);
} else if (path.indexOf(effect.value + '.') === 0 && !effect.negate) {
var node = this._nodes[effect.index];
if (node && node._notifyPath) {
var p = this._fixPath(effect.name, effect.value, path);
node._notifyPath(p, value, true);
}
}
},
_complexObserverPathEffect: function (path, value, effect) {
if (this._pathMatchesEffect(path, effect)) {
Polymer.Bind._complexObserverEffect.call(this, path, value, effect);
}
},
_computePathEffect: function (path, value, effect) {
if (this._pathMatchesEffect(path, effect)) {
Polymer.Bind._computeEffect.call(this, path, value, effect);
}
},
_annotatedComputationPathEffect: function (path, value, effect) {
if (this._pathMatchesEffect(path, effect)) {
Polymer.Bind._annotatedComputationEffect.call(this, path, value, effect);
}
},
_pathMatchesEffect: function (path, effect) {
var effectArg = effect.trigger.name;
return effectArg == path || effectArg.indexOf(path + '.') === 0 || effect.trigger.wildcard && path.indexOf(effectArg + '.') === 0;
},
linkPaths: function (to, from) {
this._boundPaths = this._boundPaths || {};
if (from) {
this._boundPaths[to] = from;
} else {
this.unlinkPaths(to);
}
},
unlinkPaths: function (path) {
if (this._boundPaths) {
delete this._boundPaths[path];
}
},
_notifyBoundPaths: function (path, value) {
for (var a in this._boundPaths) {
var b = this._boundPaths[a];
if (path.indexOf(a + '.') == 0) {
this._notifyPath(this._fixPath(b, a, path), value);
} else if (path.indexOf(b + '.') == 0) {
this._notifyPath(this._fixPath(a, b, path), value);
}
}
},
_fixPath: function (property, root, path) {
return property + path.slice(root.length);
},
_notifyPathUp: function (path, value) {
var rootName = this._modelForPath(path);
var dashCaseName = Polymer.CaseMap.camelToDashCase(rootName);
var eventName = dashCaseName + this._EVENT_CHANGED;
this.fire(eventName, {
path: path,
value: value
}, {
bubbles: false,
_useCache: true
});
},
_modelForPath: function (path) {
var dot = path.indexOf('.');
return dot < 0 ? path : path.slice(0, dot);
},
_EVENT_CHANGED: '-changed',
notifySplices: function (path, splices) {
var info = {};
var array = this._get(path, this, info);
this._notifySplices(array, info.path, splices);
},
_notifySplices: function (array, path, splices) {
var change = {
keySplices: Polymer.Collection.applySplices(array, splices),
indexSplices: splices
};
var splicesPath = path + '.splices';
this._notifyPath(splicesPath, change);
this._notifyPath(path + '.length', array.length);
this.__data__[splicesPath] = {
keySplices: null,
indexSplices: null
};
},
_notifySplice: function (array, path, index, added, removed) {
this._notifySplices(array, path, [{
index: index,
addedCount: added,
removed: removed,
object: array,
type: 'splice'
}]);
},
push: function (path) {
var info = {};
var array = this._get(path, this, info);
var args = Array.prototype.slice.call(arguments, 1);
var len = array.length;
var ret = array.push.apply(array, args);
if (args.length) {
this._notifySplice(array, info.path, len, args.length, []);
}
return ret;
},
pop: function (path) {
var info = {};
var array = this._get(path, this, info);
var hadLength = Boolean(array.length);
var args = Array.prototype.slice.call(arguments, 1);
var ret = array.pop.apply(array, args);
if (hadLength) {
this._notifySplice(array, info.path, array.length, 0, [ret]);
}
return ret;
},
splice: function (path, start) {
var info = {};
var array = this._get(path, this, info);
if (start < 0) {
start = array.length - Math.floor(-start);
} else {
start = Math.floor(start);
}
if (!start) {
start = 0;
}
var args = Array.prototype.slice.call(arguments, 1);
var ret = array.splice.apply(array, args);
var addedCount = Math.max(args.length - 2, 0);
if (addedCount || ret.length) {
this._notifySplice(array, info.path, start, addedCount, ret);
}
return ret;
},
shift: function (path) {
var info = {};
var array = this._get(path, this, info);
var hadLength = Boolean(array.length);
var args = Array.prototype.slice.call(arguments, 1);
var ret = array.shift.apply(array, args);
if (hadLength) {
this._notifySplice(array, info.path, 0, 0, [ret]);
}
return ret;
},
unshift: function (path) {
var info = {};
var array = this._get(path, this, info);
var args = Array.prototype.slice.call(arguments, 1);
var ret = array.unshift.apply(array, args);
if (args.length) {
this._notifySplice(array, info.path, 0, args.length, []);
}
return ret;
},
prepareModelNotifyPath: function (model) {
this.mixin(model, {
fire: Polymer.Base.fire,
_getEvent: Polymer.Base._getEvent,
__eventCache: Polymer.Base.__eventCache,
notifyPath: Polymer.Base.notifyPath,
_get: Polymer.Base._get,
_EVENT_CHANGED: Polymer.Base._EVENT_CHANGED,
_notifyPath: Polymer.Base._notifyPath,
_notifyPathUp: Polymer.Base._notifyPathUp,
_pathEffector: Polymer.Base._pathEffector,
_annotationPathEffect: Polymer.Base._annotationPathEffect,
_complexObserverPathEffect: Polymer.Base._complexObserverPathEffect,
_annotatedComputationPathEffect: Polymer.Base._annotatedComputationPathEffect,
_computePathEffect: Polymer.Base._computePathEffect,
_modelForPath: Polymer.Base._modelForPath,
_pathMatchesEffect: Polymer.Base._pathMatchesEffect,
_notifyBoundPaths: Polymer.Base._notifyBoundPaths,
_getPathParts: Polymer.Base._getPathParts
});
}
});
}());Polymer.Base._addFeature({
resolveUrl: function (url) {
var module = Polymer.DomModule.import(this.is);
var root = '';
if (module) {
var assetPath = module.getAttribute('assetpath') || '';
root = Polymer.ResolveUrl.resolveUrl(assetPath, module.ownerDocument.baseURI);
}
return Polymer.ResolveUrl.resolveUrl(url, root);
}
});Polymer.CssParse = function () {
return {
parse: function (text) {
text = this._clean(text);
return this._parseCss(this._lex(text), text);
},
_clean: function (cssText) {
return cssText.replace(this._rx.comments, '').replace(this._rx.port, '');
},
_lex: function (text) {
var root = {
start: 0,
end: text.length
};
var n = root;
for (var i = 0, l = text.length; i < l; i++) {
switch (text[i]) {
case this.OPEN_BRACE:
if (!n.rules) {
n.rules = [];
}
var p = n;
var previous = p.rules[p.rules.length - 1];
n = {
start: i + 1,
parent: p,
previous: previous
};
p.rules.push(n);
break;
case this.CLOSE_BRACE:
n.end = i + 1;
n = n.parent || root;
break;
}
}
return root;
},
_parseCss: function (node, text) {
var t = text.substring(node.start, node.end - 1);
node.parsedCssText = node.cssText = t.trim();
if (node.parent) {
var ss = node.previous ? node.previous.end : node.parent.start;
t = text.substring(ss, node.start - 1);
t = this._expandUnicodeEscapes(t);
t = t.replace(this._rx.multipleSpaces, ' ');
t = t.substring(t.lastIndexOf(';') + 1);
var s = node.parsedSelector = node.selector = t.trim();
node.atRule = s.indexOf(this.AT_START) === 0;
if (node.atRule) {
if (s.indexOf(this.MEDIA_START) === 0) {
node.type = this.types.MEDIA_RULE;
} else if (s.match(this._rx.keyframesRule)) {
node.type = this.types.KEYFRAMES_RULE;
node.keyframesName = node.selector.split(this._rx.multipleSpaces).pop();
}
} else {
if (s.indexOf(this.VAR_START) === 0) {
node.type = this.types.MIXIN_RULE;
} else {
node.type = this.types.STYLE_RULE;
}
}
}
var r$ = node.rules;
if (r$) {
for (var i = 0, l = r$.length, r; i < l && (r = r$[i]); i++) {
this._parseCss(r, text);
}
}
return node;
},
_expandUnicodeEscapes: function (s) {
return s.replace(/\\([0-9a-f]{1,6})\s/gi, function () {
var code = arguments[1], repeat = 6 - code.length;
while (repeat--) {
code = '0' + code;
}
return '\\' + code;
});
},
stringify: function (node, preserveProperties, text) {
text = text || '';
var cssText = '';
if (node.cssText || node.rules) {
var r$ = node.rules;
if (r$ && !this._hasMixinRules(r$)) {
for (var i = 0, l = r$.length, r; i < l && (r = r$[i]); i++) {
cssText = this.stringify(r, preserveProperties, cssText);
}
} else {
cssText = preserveProperties ? node.cssText : this.removeCustomProps(node.cssText);
cssText = cssText.trim();
if (cssText) {
cssText = '  ' + cssText + '\n';
}
}
}
if (cssText) {
if (node.selector) {
text += node.selector + ' ' + this.OPEN_BRACE + '\n';
}
text += cssText;
if (node.selector) {
text += this.CLOSE_BRACE + '\n\n';
}
}
return text;
},
_hasMixinRules: function (rules) {
return rules[0].selector.indexOf(this.VAR_START) === 0;
},
removeCustomProps: function (cssText) {
cssText = this.removeCustomPropAssignment(cssText);
return this.removeCustomPropApply(cssText);
},
removeCustomPropAssignment: function (cssText) {
return cssText.replace(this._rx.customProp, '').replace(this._rx.mixinProp, '');
},
removeCustomPropApply: function (cssText) {
return cssText.replace(this._rx.mixinApply, '').replace(this._rx.varApply, '');
},
types: {
STYLE_RULE: 1,
KEYFRAMES_RULE: 7,
MEDIA_RULE: 4,
MIXIN_RULE: 1000
},
OPEN_BRACE: '{',
CLOSE_BRACE: '}',
_rx: {
comments: /\/\*[^*]*\*+([^\/*][^*]*\*+)*\//gim,
port: /@import[^;]*;/gim,
customProp: /(?:^[^;\-\s}]+)?--[^;{}]*?:[^{};]*?(?:[;\n]|$)/gim,
mixinProp: /(?:^[^;\-\s}]+)?--[^;{}]*?:[^{};]*?{[^}]*?}(?:[;\n]|$)?/gim,
mixinApply: /@apply\s*\(?[^);]*\)?\s*(?:[;\n]|$)?/gim,
varApply: /[^;:]*?:[^;]*?var\([^;]*\)(?:[;\n]|$)?/gim,
keyframesRule: /^@[^\s]*keyframes/,
multipleSpaces: /\s+/g
},
VAR_START: '--',
MEDIA_START: '@media',
AT_START: '@'
};
}();Polymer.StyleUtil = function () {
var settings = Polymer.Settings;
return {
NATIVE_VARIABLES: Polymer.Settings.useNativeCSSProperties,
MODULE_STYLES_SELECTOR: 'style, link[rel=import][type~=css], template',
INCLUDE_ATTR: 'include',
toCssText: function (rules, callback) {
if (typeof rules === 'string') {
rules = this.parser.parse(rules);
}
if (callback) {
this.forEachRule(rules, callback);
}
return this.parser.stringify(rules, this.NATIVE_VARIABLES);
},
forRulesInStyles: function (styles, styleRuleCallback, keyframesRuleCallback) {
if (styles) {
for (var i = 0, l = styles.length, s; i < l && (s = styles[i]); i++) {
this.forEachRuleInStyle(s, styleRuleCallback, keyframesRuleCallback);
}
}
},
forActiveRulesInStyles: function (styles, styleRuleCallback, keyframesRuleCallback) {
if (styles) {
for (var i = 0, l = styles.length, s; i < l && (s = styles[i]); i++) {
this.forEachRuleInStyle(s, styleRuleCallback, keyframesRuleCallback, true);
}
}
},
rulesForStyle: function (style) {
if (!style.__cssRules && style.textContent) {
style.__cssRules = this.parser.parse(style.textContent);
}
return style.__cssRules;
},
isKeyframesSelector: function (rule) {
return rule.parent && rule.parent.type === this.ruleTypes.KEYFRAMES_RULE;
},
forEachRuleInStyle: function (style, styleRuleCallback, keyframesRuleCallback, onlyActiveRules) {
var rules = this.rulesForStyle(style);
var styleCallback, keyframeCallback;
if (styleRuleCallback) {
styleCallback = function (rule) {
styleRuleCallback(rule, style);
};
}
if (keyframesRuleCallback) {
keyframeCallback = function (rule) {
keyframesRuleCallback(rule, style);
};
}
this.forEachRule(rules, styleCallback, keyframeCallback, onlyActiveRules);
},
forEachRule: function (node, styleRuleCallback, keyframesRuleCallback, onlyActiveRules) {
if (!node) {
return;
}
var skipRules = false;
if (onlyActiveRules) {
if (node.type === this.ruleTypes.MEDIA_RULE) {
var matchMedia = node.selector.match(this.rx.MEDIA_MATCH);
if (matchMedia) {
if (!window.matchMedia(matchMedia[1]).matches) {
skipRules = true;
}
}
}
}
if (node.type === this.ruleTypes.STYLE_RULE) {
styleRuleCallback(node);
} else if (keyframesRuleCallback && node.type === this.ruleTypes.KEYFRAMES_RULE) {
keyframesRuleCallback(node);
} else if (node.type === this.ruleTypes.MIXIN_RULE) {
skipRules = true;
}
var r$ = node.rules;
if (r$ && !skipRules) {
for (var i = 0, l = r$.length, r; i < l && (r = r$[i]); i++) {
this.forEachRule(r, styleRuleCallback, keyframesRuleCallback, onlyActiveRules);
}
}
},
applyCss: function (cssText, moniker, target, contextNode) {
var style = this.createScopeStyle(cssText, moniker);
return this.applyStyle(style, target, contextNode);
},
applyStyle: function (style, target, contextNode) {
target = target || document.head;
var after = contextNode && contextNode.nextSibling || target.firstChild;
this.__lastHeadApplyNode = style;
return target.insertBefore(style, after);
},
createScopeStyle: function (cssText, moniker) {
var style = document.createElement('style');
if (moniker) {
style.setAttribute('scope', moniker);
}
style.textContent = cssText;
return style;
},
__lastHeadApplyNode: null,
applyStylePlaceHolder: function (moniker) {
var placeHolder = document.createComment(' Shady DOM styles for ' + moniker + ' ');
var after = this.__lastHeadApplyNode ? this.__lastHeadApplyNode.nextSibling : null;
var scope = document.head;
scope.insertBefore(placeHolder, after || scope.firstChild);
this.__lastHeadApplyNode = placeHolder;
return placeHolder;
},
cssFromModules: function (moduleIds, warnIfNotFound) {
var modules = moduleIds.trim().split(' ');
var cssText = '';
for (var i = 0; i < modules.length; i++) {
cssText += this.cssFromModule(modules[i], warnIfNotFound);
}
return cssText;
},
cssFromModule: function (moduleId, warnIfNotFound) {
var m = Polymer.DomModule.import(moduleId);
if (m && !m._cssText) {
m._cssText = this.cssFromElement(m);
}
if (!m && warnIfNotFound) {
console.warn('Could not find style data in module named', moduleId);
}
return m && m._cssText || '';
},
cssFromElement: function (element) {
var cssText = '';
var content = element.content || element;
var e$ = Polymer.TreeApi.arrayCopy(content.querySelectorAll(this.MODULE_STYLES_SELECTOR));
for (var i = 0, e; i < e$.length; i++) {
e = e$[i];
if (e.localName === 'template') {
cssText += this.cssFromElement(e);
} else {
if (e.localName === 'style') {
var include = e.getAttribute(this.INCLUDE_ATTR);
if (include) {
cssText += this.cssFromModules(include, true);
}
e = e.__appliedElement || e;
e.parentNode.removeChild(e);
cssText += this.resolveCss(e.textContent, element.ownerDocument);
} else if (e.import && e.import.body) {
cssText += this.resolveCss(e.import.body.textContent, e.import);
}
}
}
return cssText;
},
isTargetedBuild: function (buildType) {
return settings.useNativeShadow ? buildType === 'shadow' : buildType === 'shady';
},
cssBuildTypeForModule: function (module) {
var dm = Polymer.DomModule.import(module);
if (dm) {
return this.getCssBuildType(dm);
}
},
getCssBuildType: function (element) {
return element.getAttribute('css-build');
},
_findMatchingParen: function (text, start) {
var level = 0;
for (var i = start, l = text.length; i < l; i++) {
switch (text[i]) {
case '(':
level++;
break;
case ')':
if (--level === 0) {
return i;
}
break;
}
}
return -1;
},
processVariableAndFallback: function (str, callback) {
var start = str.indexOf('var(');
if (start === -1) {
return callback(str, '', '', '');
}
var end = this._findMatchingParen(str, start + 3);
var inner = str.substring(start + 4, end);
var prefix = str.substring(0, start);
var suffix = this.processVariableAndFallback(str.substring(end + 1), callback);
var comma = inner.indexOf(',');
if (comma === -1) {
return callback(prefix, inner.trim(), '', suffix);
}
var value = inner.substring(0, comma).trim();
var fallback = inner.substring(comma + 1).trim();
return callback(prefix, value, fallback, suffix);
},
rx: {
VAR_ASSIGN: /(?:^|[;\s{]\s*)(--[\w-]*?)\s*:\s*(?:([^;{]*)|{([^}]*)})(?:(?=[;\s}])|$)/gi,
MIXIN_MATCH: /(?:^|\W+)@apply\s*\(?([^);\n]*)\)?/gi,
VAR_CONSUMED: /(--[\w-]+)\s*([:,;)]|$)/gi,
ANIMATION_MATCH: /(animation\s*:)|(animation-name\s*:)/,
MEDIA_MATCH: /@media[^(]*(\([^)]*\))/,
IS_VAR: /^--/,
BRACKETED: /\{[^}]*\}/g,
HOST_PREFIX: '(?:^|[^.#[:])',
HOST_SUFFIX: '($|[.:[\\s>+~])'
},
resolveCss: Polymer.ResolveUrl.resolveCss,
parser: Polymer.CssParse,
ruleTypes: Polymer.CssParse.types
};
}();Polymer.StyleTransformer = function () {
var styleUtil = Polymer.StyleUtil;
var settings = Polymer.Settings;
var api = {
dom: function (node, scope, useAttr, shouldRemoveScope) {
this._transformDom(node, scope || '', useAttr, shouldRemoveScope);
},
_transformDom: function (node, selector, useAttr, shouldRemoveScope) {
if (node.setAttribute) {
this.element(node, selector, useAttr, shouldRemoveScope);
}
var c$ = Polymer.dom(node).childNodes;
for (var i = 0; i < c$.length; i++) {
this._transformDom(c$[i], selector, useAttr, shouldRemoveScope);
}
},
element: function (element, scope, useAttr, shouldRemoveScope) {
if (useAttr) {
if (shouldRemoveScope) {
element.removeAttribute(SCOPE_NAME);
} else {
element.setAttribute(SCOPE_NAME, scope);
}
} else {
if (scope) {
if (element.classList) {
if (shouldRemoveScope) {
element.classList.remove(SCOPE_NAME);
element.classList.remove(scope);
} else {
element.classList.add(SCOPE_NAME);
element.classList.add(scope);
}
} else if (element.getAttribute) {
var c = element.getAttribute(CLASS);
if (shouldRemoveScope) {
if (c) {
element.setAttribute(CLASS, c.replace(SCOPE_NAME, '').replace(scope, ''));
}
} else {
element.setAttribute(CLASS, (c ? c + ' ' : '') + SCOPE_NAME + ' ' + scope);
}
}
}
}
},
elementStyles: function (element, callback) {
var styles = element._styles;
var cssText = '';
var cssBuildType = element.__cssBuild;
for (var i = 0, l = styles.length, s; i < l && (s = styles[i]); i++) {
var rules = styleUtil.rulesForStyle(s);
cssText += settings.useNativeShadow || cssBuildType === 'shady' ? styleUtil.toCssText(rules, callback) : this.css(rules, element.is, element.extends, callback, element._scopeCssViaAttr) + '\n\n';
}
return cssText.trim();
},
css: function (rules, scope, ext, callback, useAttr) {
var hostScope = this._calcHostScope(scope, ext);
scope = this._calcElementScope(scope, useAttr);
var self = this;
return styleUtil.toCssText(rules, function (rule) {
if (!rule.isScoped) {
self.rule(rule, scope, hostScope);
rule.isScoped = true;
}
if (callback) {
callback(rule, scope, hostScope);
}
});
},
_calcElementScope: function (scope, useAttr) {
if (scope) {
return useAttr ? CSS_ATTR_PREFIX + scope + CSS_ATTR_SUFFIX : CSS_CLASS_PREFIX + scope;
} else {
return '';
}
},
_calcHostScope: function (scope, ext) {
return ext ? '[is=' + scope + ']' : scope;
},
rule: function (rule, scope, hostScope) {
this._transformRule(rule, this._transformComplexSelector, scope, hostScope);
},
_transformRule: function (rule, transformer, scope, hostScope) {
rule.selector = rule.transformedSelector = this._transformRuleCss(rule, transformer, scope, hostScope);
},
_transformRuleCss: function (rule, transformer, scope, hostScope) {
var p$ = rule.selector.split(COMPLEX_SELECTOR_SEP);
if (!styleUtil.isKeyframesSelector(rule)) {
for (var i = 0, l = p$.length, p; i < l && (p = p$[i]); i++) {
p$[i] = transformer.call(this, p, scope, hostScope);
}
}
return p$.join(COMPLEX_SELECTOR_SEP);
},
_transformComplexSelector: function (selector, scope, hostScope) {
var stop = false;
var hostContext = false;
var self = this;
selector = selector.trim();
selector = selector.replace(CONTENT_START, HOST + ' $1');
selector = selector.replace(SIMPLE_SELECTOR_SEP, function (m, c, s) {
if (!stop) {
var info = self._transformCompoundSelector(s, c, scope, hostScope);
stop = stop || info.stop;
hostContext = hostContext || info.hostContext;
c = info.combinator;
s = info.value;
} else {
s = s.replace(SCOPE_JUMP, ' ');
}
return c + s;
});
if (hostContext) {
selector = selector.replace(HOST_CONTEXT_PAREN, function (m, pre, paren, post) {
return pre + paren + ' ' + hostScope + post + COMPLEX_SELECTOR_SEP + ' ' + pre + hostScope + paren + post;
});
}
return selector;
},
_transformCompoundSelector: function (selector, combinator, scope, hostScope) {
var jumpIndex = selector.search(SCOPE_JUMP);
var hostContext = false;
if (selector.indexOf(HOST_CONTEXT) >= 0) {
hostContext = true;
} else if (selector.indexOf(HOST) >= 0) {
selector = this._transformHostSelector(selector, hostScope);
} else if (jumpIndex !== 0) {
selector = scope ? this._transformSimpleSelector(selector, scope) : selector;
}
if (selector.indexOf(CONTENT) >= 0) {
combinator = '';
}
var stop;
if (jumpIndex >= 0) {
selector = selector.replace(SCOPE_JUMP, ' ');
stop = true;
}
return {
value: selector,
combinator: combinator,
stop: stop,
hostContext: hostContext
};
},
_transformSimpleSelector: function (selector, scope) {
var p$ = selector.split(PSEUDO_PREFIX);
p$[0] += scope;
return p$.join(PSEUDO_PREFIX);
},
_transformHostSelector: function (selector, hostScope) {
var m = selector.match(HOST_PAREN);
var paren = m && m[2].trim() || '';
if (paren) {
if (!paren[0].match(SIMPLE_SELECTOR_PREFIX)) {
var typeSelector = paren.split(SIMPLE_SELECTOR_PREFIX)[0];
if (typeSelector === hostScope) {
return paren;
} else {
return SELECTOR_NO_MATCH;
}
} else {
return selector.replace(HOST_PAREN, function (m, host, paren) {
return hostScope + paren;
});
}
} else {
return selector.replace(HOST, hostScope);
}
},
documentRule: function (rule) {
rule.selector = rule.parsedSelector;
this.normalizeRootSelector(rule);
if (!settings.useNativeShadow) {
this._transformRule(rule, this._transformDocumentSelector);
}
},
normalizeRootSelector: function (rule) {
if (rule.selector === ROOT) {
rule.selector = 'html';
}
},
_transformDocumentSelector: function (selector) {
return selector.match(SCOPE_JUMP) ? this._transformComplexSelector(selector, SCOPE_DOC_SELECTOR) : this._transformSimpleSelector(selector.trim(), SCOPE_DOC_SELECTOR);
},
SCOPE_NAME: 'style-scope'
};
var SCOPE_NAME = api.SCOPE_NAME;
var SCOPE_DOC_SELECTOR = ':not([' + SCOPE_NAME + '])' + ':not(.' + SCOPE_NAME + ')';
var COMPLEX_SELECTOR_SEP = ',';
var SIMPLE_SELECTOR_SEP = /(^|[\s>+~]+)((?:\[.+?\]|[^\s>+~=\[])+)/g;
var SIMPLE_SELECTOR_PREFIX = /[[.:#*]/;
var HOST = ':host';
var ROOT = ':root';
var HOST_PAREN = /(:host)(?:\(((?:\([^)(]*\)|[^)(]*)+?)\))/;
var HOST_CONTEXT = ':host-context';
var HOST_CONTEXT_PAREN = /(.*)(?::host-context)(?:\(((?:\([^)(]*\)|[^)(]*)+?)\))(.*)/;
var CONTENT = '::content';
var SCOPE_JUMP = /::content|::shadow|\/deep\//;
var CSS_CLASS_PREFIX = '.';
var CSS_ATTR_PREFIX = '[' + SCOPE_NAME + '~=';
var CSS_ATTR_SUFFIX = ']';
var PSEUDO_PREFIX = ':';
var CLASS = 'class';
var CONTENT_START = new RegExp('^(' + CONTENT + ')');
var SELECTOR_NO_MATCH = 'should_not_match';
return api;
}();Polymer.StyleExtends = function () {
var styleUtil = Polymer.StyleUtil;
return {
hasExtends: function (cssText) {
return Boolean(cssText.match(this.rx.EXTEND));
},
transform: function (style) {
var rules = styleUtil.rulesForStyle(style);
var self = this;
styleUtil.forEachRule(rules, function (rule) {
self._mapRuleOntoParent(rule);
if (rule.parent) {
var m;
while (m = self.rx.EXTEND.exec(rule.cssText)) {
var extend = m[1];
var extendor = self._findExtendor(extend, rule);
if (extendor) {
self._extendRule(rule, extendor);
}
}
}
rule.cssText = rule.cssText.replace(self.rx.EXTEND, '');
});
return styleUtil.toCssText(rules, function (rule) {
if (rule.selector.match(self.rx.STRIP)) {
rule.cssText = '';
}
}, true);
},
_mapRuleOntoParent: function (rule) {
if (rule.parent) {
var map = rule.parent.map || (rule.parent.map = {});
var parts = rule.selector.split(',');
for (var i = 0, p; i < parts.length; i++) {
p = parts[i];
map[p.trim()] = rule;
}
return map;
}
},
_findExtendor: function (extend, rule) {
return rule.parent && rule.parent.map && rule.parent.map[extend] || this._findExtendor(extend, rule.parent);
},
_extendRule: function (target, source) {
if (target.parent !== source.parent) {
this._cloneAndAddRuleToParent(source, target.parent);
}
target.extends = target.extends || [];
target.extends.push(source);
source.selector = source.selector.replace(this.rx.STRIP, '');
source.selector = (source.selector && source.selector + ',\n') + target.selector;
if (source.extends) {
source.extends.forEach(function (e) {
this._extendRule(target, e);
}, this);
}
},
_cloneAndAddRuleToParent: function (rule, parent) {
rule = Object.create(rule);
rule.parent = parent;
if (rule.extends) {
rule.extends = rule.extends.slice();
}
parent.rules.push(rule);
},
rx: {
EXTEND: /@extends\(([^)]*)\)\s*?;/gim,
STRIP: /%[^,]*$/
}
};
}();Polymer.ApplyShim = function () {
'use strict';
var styleUtil = Polymer.StyleUtil;
var MIXIN_MATCH = styleUtil.rx.MIXIN_MATCH;
var VAR_ASSIGN = styleUtil.rx.VAR_ASSIGN;
var BAD_VAR = /var\(\s*(--[^,]*),\s*(--[^)]*)\)/g;
var APPLY_NAME_CLEAN = /;\s*/m;
var INITIAL_INHERIT = /^\s*(initial)|(inherit)\s*$/;
var MIXIN_VAR_SEP = '_-_';
var mixinMap = {};
function mapSet(name, props) {
name = name.trim();
mixinMap[name] = {
properties: props,
dependants: {}
};
}
function mapGet(name) {
name = name.trim();
return mixinMap[name];
}
function replaceInitialOrInherit(property, value) {
var match = INITIAL_INHERIT.exec(value);
if (match) {
if (match[1]) {
value = ApplyShim._getInitialValueForProperty(property);
} else {
value = 'apply-shim-inherit';
}
}
return value;
}
function cssTextToMap(text) {
var props = text.split(';');
var property, value;
var out = {};
for (var i = 0, p, sp; i < props.length; i++) {
p = props[i];
if (p) {
sp = p.split(':');
if (sp.length > 1) {
property = sp[0].trim();
value = replaceInitialOrInherit(property, sp.slice(1).join(':'));
out[property] = value;
}
}
}
return out;
}
function invalidateMixinEntry(mixinEntry) {
var currentProto = ApplyShim.__currentElementProto;
var currentElementName = currentProto && currentProto.is;
for (var elementName in mixinEntry.dependants) {
if (elementName !== currentElementName) {
mixinEntry.dependants[elementName].__applyShimInvalid = true;
}
}
}
function produceCssProperties(matchText, propertyName, valueProperty, valueMixin) {
if (valueProperty) {
styleUtil.processVariableAndFallback(valueProperty, function (prefix, value) {
if (value && mapGet(value)) {
valueMixin = '@apply ' + value + ';';
}
});
}
if (!valueMixin) {
return matchText;
}
var mixinAsProperties = consumeCssProperties(valueMixin);
var prefix = matchText.slice(0, matchText.indexOf('--'));
var mixinValues = cssTextToMap(mixinAsProperties);
var combinedProps = mixinValues;
var mixinEntry = mapGet(propertyName);
var oldProps = mixinEntry && mixinEntry.properties;
if (oldProps) {
combinedProps = Object.create(oldProps);
combinedProps = Polymer.Base.mixin(combinedProps, mixinValues);
} else {
mapSet(propertyName, combinedProps);
}
var out = [];
var p, v;
var needToInvalidate = false;
for (p in combinedProps) {
v = mixinValues[p];
if (v === undefined) {
v = 'initial';
}
if (oldProps && !(p in oldProps)) {
needToInvalidate = true;
}
out.push(propertyName + MIXIN_VAR_SEP + p + ': ' + v);
}
if (needToInvalidate) {
invalidateMixinEntry(mixinEntry);
}
if (mixinEntry) {
mixinEntry.properties = combinedProps;
}
if (valueProperty) {
prefix = matchText + ';' + prefix;
}
return prefix + out.join('; ') + ';';
}
function fixVars(matchText, varA, varB) {
return 'var(' + varA + ',' + 'var(' + varB + '));';
}
function atApplyToCssProperties(mixinName, fallbacks) {
mixinName = mixinName.replace(APPLY_NAME_CLEAN, '');
var vars = [];
var mixinEntry = mapGet(mixinName);
if (!mixinEntry) {
mapSet(mixinName, {});
mixinEntry = mapGet(mixinName);
}
if (mixinEntry) {
var currentProto = ApplyShim.__currentElementProto;
if (currentProto) {
mixinEntry.dependants[currentProto.is] = currentProto;
}
var p, parts, f;
for (p in mixinEntry.properties) {
f = fallbacks && fallbacks[p];
parts = [
p,
': var(',
mixinName,
MIXIN_VAR_SEP,
p
];
if (f) {
parts.push(',', f);
}
parts.push(')');
vars.push(parts.join(''));
}
}
return vars.join('; ');
}
function consumeCssProperties(text) {
var m;
while (m = MIXIN_MATCH.exec(text)) {
var matchText = m[0];
var mixinName = m[1];
var idx = m.index;
var applyPos = idx + matchText.indexOf('@apply');
var afterApplyPos = idx + matchText.length;
var textBeforeApply = text.slice(0, applyPos);
var textAfterApply = text.slice(afterApplyPos);
var defaults = cssTextToMap(textBeforeApply);
var replacement = atApplyToCssProperties(mixinName, defaults);
text = [
textBeforeApply,
replacement,
textAfterApply
].join('');
MIXIN_MATCH.lastIndex = idx + replacement.length;
}
return text;
}
var ApplyShim = {
_measureElement: null,
_map: mixinMap,
_separator: MIXIN_VAR_SEP,
transform: function (styles, elementProto) {
this.__currentElementProto = elementProto;
styleUtil.forRulesInStyles(styles, this._boundTransformRule);
elementProto.__applyShimInvalid = false;
this.__currentElementProto = null;
},
transformRule: function (rule) {
rule.cssText = this.transformCssText(rule.parsedCssText);
if (rule.selector === ':root') {
rule.selector = ':host > *';
}
},
transformCssText: function (cssText) {
cssText = cssText.replace(BAD_VAR, fixVars);
cssText = cssText.replace(VAR_ASSIGN, produceCssProperties);
return consumeCssProperties(cssText);
},
_getInitialValueForProperty: function (property) {
if (!this._measureElement) {
this._measureElement = document.createElement('meta');
this._measureElement.style.all = 'initial';
document.head.appendChild(this._measureElement);
}
return window.getComputedStyle(this._measureElement).getPropertyValue(property);
}
};
ApplyShim._boundTransformRule = ApplyShim.transformRule.bind(ApplyShim);
return ApplyShim;
}();(function () {
var prepElement = Polymer.Base._prepElement;
var nativeShadow = Polymer.Settings.useNativeShadow;
var styleUtil = Polymer.StyleUtil;
var styleTransformer = Polymer.StyleTransformer;
var styleExtends = Polymer.StyleExtends;
var applyShim = Polymer.ApplyShim;
var settings = Polymer.Settings;
Polymer.Base._addFeature({
_prepElement: function (element) {
if (this._encapsulateStyle && this.__cssBuild !== 'shady') {
styleTransformer.element(element, this.is, this._scopeCssViaAttr);
}
prepElement.call(this, element);
},
_prepStyles: function () {
if (this._encapsulateStyle === undefined) {
this._encapsulateStyle = !nativeShadow;
}
if (!nativeShadow) {
this._scopeStyle = styleUtil.applyStylePlaceHolder(this.is);
}
this.__cssBuild = styleUtil.cssBuildTypeForModule(this.is);
},
_prepShimStyles: function () {
if (this._template) {
var hasTargetedCssBuild = styleUtil.isTargetedBuild(this.__cssBuild);
if (settings.useNativeCSSProperties && this.__cssBuild === 'shadow' && hasTargetedCssBuild) {
return;
}
this._styles = this._styles || this._collectStyles();
if (settings.useNativeCSSProperties && !this.__cssBuild) {
applyShim.transform(this._styles, this);
}
var cssText = settings.useNativeCSSProperties && hasTargetedCssBuild ? this._styles.length && this._styles[0].textContent.trim() : styleTransformer.elementStyles(this);
this._prepStyleProperties();
if (!this._needsStyleProperties() && cssText) {
styleUtil.applyCss(cssText, this.is, nativeShadow ? this._template.content : null, this._scopeStyle);
}
} else {
this._styles = [];
}
},
_collectStyles: function () {
var styles = [];
var cssText = '', m$ = this.styleModules;
if (m$) {
for (var i = 0, l = m$.length, m; i < l && (m = m$[i]); i++) {
cssText += styleUtil.cssFromModule(m);
}
}
cssText += styleUtil.cssFromModule(this.is);
var p = this._template && this._template.parentNode;
if (this._template && (!p || p.id.toLowerCase() !== this.is)) {
cssText += styleUtil.cssFromElement(this._template);
}
if (cssText) {
var style = document.createElement('style');
style.textContent = cssText;
if (styleExtends.hasExtends(style.textContent)) {
cssText = styleExtends.transform(style);
}
styles.push(style);
}
return styles;
},
_elementAdd: function (node) {
if (this._encapsulateStyle) {
if (node.__styleScoped) {
node.__styleScoped = false;
} else {
styleTransformer.dom(node, this.is, this._scopeCssViaAttr);
}
}
},
_elementRemove: function (node) {
if (this._encapsulateStyle) {
styleTransformer.dom(node, this.is, this._scopeCssViaAttr, true);
}
},
scopeSubtree: function (container, shouldObserve) {
if (nativeShadow) {
return;
}
var self = this;
var scopify = function (node) {
if (node.nodeType === Node.ELEMENT_NODE) {
var className = node.getAttribute('class');
node.setAttribute('class', self._scopeElementClass(node, className));
var n$ = node.querySelectorAll('*');
for (var i = 0, n; i < n$.length && (n = n$[i]); i++) {
className = n.getAttribute('class');
n.setAttribute('class', self._scopeElementClass(n, className));
}
}
};
scopify(container);
if (shouldObserve) {
var mo = new MutationObserver(function (mxns) {
for (var i = 0, m; i < mxns.length && (m = mxns[i]); i++) {
if (m.addedNodes) {
for (var j = 0; j < m.addedNodes.length; j++) {
scopify(m.addedNodes[j]);
}
}
}
});
mo.observe(container, {
childList: true,
subtree: true
});
return mo;
}
}
});
}());Polymer.StyleProperties = function () {
'use strict';
var matchesSelector = Polymer.DomApi.matchesSelector;
var styleUtil = Polymer.StyleUtil;
var styleTransformer = Polymer.StyleTransformer;
var IS_IE = navigator.userAgent.match('Trident');
var settings = Polymer.Settings;
return {
decorateStyles: function (styles, scope) {
var self = this, props = {}, keyframes = [], ruleIndex = 0;
var scopeSelector = styleTransformer._calcHostScope(scope.is, scope.extends);
styleUtil.forRulesInStyles(styles, function (rule, style) {
self.decorateRule(rule);
rule.index = ruleIndex++;
self.whenHostOrRootRule(scope, rule, style, function (info) {
if (rule.parent.type === styleUtil.ruleTypes.MEDIA_RULE) {
scope.__notStyleScopeCacheable = true;
}
if (info.isHost) {
var hostContextOrFunction = info.selector.split(' ').some(function (s) {
return s.indexOf(scopeSelector) === 0 && s.length !== scopeSelector.length;
});
scope.__notStyleScopeCacheable = scope.__notStyleScopeCacheable || hostContextOrFunction;
}
});
self.collectPropertiesInCssText(rule.propertyInfo.cssText, props);
}, function onKeyframesRule(rule) {
keyframes.push(rule);
});
styles._keyframes = keyframes;
var names = [];
for (var i in props) {
names.push(i);
}
return names;
},
decorateRule: function (rule) {
if (rule.propertyInfo) {
return rule.propertyInfo;
}
var info = {}, properties = {};
var hasProperties = this.collectProperties(rule, properties);
if (hasProperties) {
info.properties = properties;
rule.rules = null;
}
info.cssText = this.collectCssText(rule);
rule.propertyInfo = info;
return info;
},
collectProperties: function (rule, properties) {
var info = rule.propertyInfo;
if (info) {
if (info.properties) {
Polymer.Base.mixin(properties, info.properties);
return true;
}
} else {
var m, rx = this.rx.VAR_ASSIGN;
var cssText = rule.parsedCssText;
var value;
var any;
while (m = rx.exec(cssText)) {
value = (m[2] || m[3]).trim();
if (value !== 'inherit') {
properties[m[1].trim()] = value;
}
any = true;
}
return any;
}
},
collectCssText: function (rule) {
return this.collectConsumingCssText(rule.parsedCssText);
},
collectConsumingCssText: function (cssText) {
return cssText.replace(this.rx.BRACKETED, '').replace(this.rx.VAR_ASSIGN, '');
},
collectPropertiesInCssText: function (cssText, props) {
var m;
while (m = this.rx.VAR_CONSUMED.exec(cssText)) {
var name = m[1];
if (m[2] !== ':') {
props[name] = true;
}
}
},
reify: function (props) {
var names = Object.getOwnPropertyNames(props);
for (var i = 0, n; i < names.length; i++) {
n = names[i];
props[n] = this.valueForProperty(props[n], props);
}
},
valueForProperty: function (property, props) {
if (property) {
if (property.indexOf(';') >= 0) {
property = this.valueForProperties(property, props);
} else {
var self = this;
var fn = function (prefix, value, fallback, suffix) {
var propertyValue = self.valueForProperty(props[value], props);
if (!propertyValue || propertyValue === 'initial') {
propertyValue = self.valueForProperty(props[fallback] || fallback, props) || fallback;
} else if (propertyValue === 'apply-shim-inherit') {
propertyValue = 'inherit';
}
return prefix + (propertyValue || '') + suffix;
};
property = styleUtil.processVariableAndFallback(property, fn);
}
}
return property && property.trim() || '';
},
valueForProperties: function (property, props) {
var parts = property.split(';');
for (var i = 0, p, m; i < parts.length; i++) {
if (p = parts[i]) {
this.rx.MIXIN_MATCH.lastIndex = 0;
m = this.rx.MIXIN_MATCH.exec(p);
if (m) {
p = this.valueForProperty(props[m[1]], props);
} else {
var colon = p.indexOf(':');
if (colon !== -1) {
var pp = p.substring(colon);
pp = pp.trim();
pp = this.valueForProperty(pp, props) || pp;
p = p.substring(0, colon) + pp;
}
}
parts[i] = p && p.lastIndexOf(';') === p.length - 1 ? p.slice(0, -1) : p || '';
}
}
return parts.join(';');
},
applyProperties: function (rule, props) {
var output = '';
if (!rule.propertyInfo) {
this.decorateRule(rule);
}
if (rule.propertyInfo.cssText) {
output = this.valueForProperties(rule.propertyInfo.cssText, props);
}
rule.cssText = output;
},
applyKeyframeTransforms: function (rule, keyframeTransforms) {
var input = rule.cssText;
var output = rule.cssText;
if (rule.hasAnimations == null) {
rule.hasAnimations = this.rx.ANIMATION_MATCH.test(input);
}
if (rule.hasAnimations) {
var transform;
if (rule.keyframeNamesToTransform == null) {
rule.keyframeNamesToTransform = [];
for (var keyframe in keyframeTransforms) {
transform = keyframeTransforms[keyframe];
output = transform(input);
if (input !== output) {
input = output;
rule.keyframeNamesToTransform.push(keyframe);
}
}
} else {
for (var i = 0; i < rule.keyframeNamesToTransform.length; ++i) {
transform = keyframeTransforms[rule.keyframeNamesToTransform[i]];
input = transform(input);
}
output = input;
}
}
rule.cssText = output;
},
propertyDataFromStyles: function (styles, element) {
var props = {}, self = this;
var o = [];
styleUtil.forActiveRulesInStyles(styles, function (rule) {
if (!rule.propertyInfo) {
self.decorateRule(rule);
}
var selectorToMatch = rule.transformedSelector || rule.parsedSelector;
if (element && rule.propertyInfo.properties && selectorToMatch) {
if (matchesSelector.call(element, selectorToMatch)) {
self.collectProperties(rule, props);
addToBitMask(rule.index, o);
}
}
});
return {
properties: props,
key: o
};
},
whenHostOrRootRule: function (scope, rule, style, callback) {
if (!rule.propertyInfo) {
self.decorateRule(rule);
}
if (!rule.propertyInfo.properties) {
return;
}
var hostScope = scope.is ? styleTransformer._calcHostScope(scope.is, scope.extends) : 'html';
var parsedSelector = rule.parsedSelector;
var isRoot = parsedSelector === ':root';
var isHost = parsedSelector.indexOf(':host') === 0;
var cssBuild = scope.__cssBuild || style.__cssBuild;
if (cssBuild === 'shady') {
isRoot = parsedSelector === hostScope + ' > *.' + hostScope || parsedSelector.indexOf('html') !== -1;
isHost = !isRoot && parsedSelector.indexOf(hostScope) === 0;
}
if (cssBuild === 'shadow') {
isRoot = parsedSelector === ':host > *' || parsedSelector === 'html';
isHost = isHost && !isRoot;
}
if (!isRoot && !isHost) {
return;
}
var selectorToMatch = hostScope;
if (isHost) {
if (settings.useNativeShadow && !rule.transformedSelector) {
rule.transformedSelector = styleTransformer._transformRuleCss(rule, styleTransformer._transformComplexSelector, scope.is, hostScope);
}
selectorToMatch = rule.transformedSelector || rule.parsedSelector;
}
callback({
selector: selectorToMatch,
isHost: isHost,
isRoot: isRoot
});
},
hostAndRootPropertiesForScope: function (scope) {
var hostProps = {}, rootProps = {}, self = this;
styleUtil.forActiveRulesInStyles(scope._styles, function (rule, style) {
self.whenHostOrRootRule(scope, rule, style, function (info) {
var element = scope._element || scope;
if (matchesSelector.call(element, info.selector)) {
if (info.isHost) {
self.collectProperties(rule, hostProps);
} else {
self.collectProperties(rule, rootProps);
}
}
});
});
return {
rootProps: rootProps,
hostProps: hostProps
};
},
transformStyles: function (element, properties, scopeSelector) {
var self = this;
var hostSelector = styleTransformer._calcHostScope(element.is, element.extends);
var rxHostSelector = element.extends ? '\\' + hostSelector.slice(0, -1) + '\\]' : hostSelector;
var hostRx = new RegExp(this.rx.HOST_PREFIX + rxHostSelector + this.rx.HOST_SUFFIX);
var keyframeTransforms = this._elementKeyframeTransforms(element, scopeSelector);
return styleTransformer.elementStyles(element, function (rule) {
self.applyProperties(rule, properties);
if (!settings.useNativeShadow && !Polymer.StyleUtil.isKeyframesSelector(rule) && rule.cssText) {
self.applyKeyframeTransforms(rule, keyframeTransforms);
self._scopeSelector(rule, hostRx, hostSelector, element._scopeCssViaAttr, scopeSelector);
}
});
},
_elementKeyframeTransforms: function (element, scopeSelector) {
var keyframesRules = element._styles._keyframes;
var keyframeTransforms = {};
if (!settings.useNativeShadow && keyframesRules) {
for (var i = 0, keyframesRule = keyframesRules[i]; i < keyframesRules.length; keyframesRule = keyframesRules[++i]) {
this._scopeKeyframes(keyframesRule, scopeSelector);
keyframeTransforms[keyframesRule.keyframesName] = this._keyframesRuleTransformer(keyframesRule);
}
}
return keyframeTransforms;
},
_keyframesRuleTransformer: function (keyframesRule) {
return function (cssText) {
return cssText.replace(keyframesRule.keyframesNameRx, keyframesRule.transformedKeyframesName);
};
},
_scopeKeyframes: function (rule, scopeId) {
rule.keyframesNameRx = new RegExp(rule.keyframesName, 'g');
rule.transformedKeyframesName = rule.keyframesName + '-' + scopeId;
rule.transformedSelector = rule.transformedSelector || rule.selector;
rule.selector = rule.transformedSelector.replace(rule.keyframesName, rule.transformedKeyframesName);
},
_scopeSelector: function (rule, hostRx, hostSelector, viaAttr, scopeId) {
rule.transformedSelector = rule.transformedSelector || rule.selector;
var selector = rule.transformedSelector;
var scope = viaAttr ? '[' + styleTransformer.SCOPE_NAME + '~=' + scopeId + ']' : '.' + scopeId;
var parts = selector.split(',');
for (var i = 0, l = parts.length, p; i < l && (p = parts[i]); i++) {
parts[i] = p.match(hostRx) ? p.replace(hostSelector, scope) : scope + ' ' + p;
}
rule.selector = parts.join(',');
},
applyElementScopeSelector: function (element, selector, old, viaAttr) {
var c = viaAttr ? element.getAttribute(styleTransformer.SCOPE_NAME) : element.getAttribute('class') || '';
var v = old ? c.replace(old, selector) : (c ? c + ' ' : '') + this.XSCOPE_NAME + ' ' + selector;
if (c !== v) {
if (viaAttr) {
element.setAttribute(styleTransformer.SCOPE_NAME, v);
} else {
element.setAttribute('class', v);
}
}
},
applyElementStyle: function (element, properties, selector, style) {
var cssText = style ? style.textContent || '' : this.transformStyles(element, properties, selector);
var s = element._customStyle;
if (s && !settings.useNativeShadow && s !== style) {
s._useCount--;
if (s._useCount <= 0 && s.parentNode) {
s.parentNode.removeChild(s);
}
}
if (settings.useNativeShadow) {
if (element._customStyle) {
element._customStyle.textContent = cssText;
style = element._customStyle;
} else if (cssText) {
style = styleUtil.applyCss(cssText, selector, element.root, element._scopeStyle);
}
} else {
if (!style) {
if (cssText) {
style = styleUtil.applyCss(cssText, selector, null, element._scopeStyle);
}
} else if (!style.parentNode) {
styleUtil.applyStyle(style, null, element._scopeStyle);
}
}
if (style) {
style._useCount = style._useCount || 0;
if (element._customStyle != style) {
style._useCount++;
}
element._customStyle = style;
}
if (IS_IE) {
style.textContent = style.textContent;
}
return style;
},
mixinCustomStyle: function (props, customStyle) {
var v;
for (var i in customStyle) {
v = customStyle[i];
if (v || v === 0) {
props[i] = v;
}
}
},
updateNativeStyleProperties: function (element, properties) {
var oldPropertyNames = element.__customStyleProperties;
if (oldPropertyNames) {
for (var i = 0; i < oldPropertyNames.length; i++) {
element.style.removeProperty(oldPropertyNames[i]);
}
}
var propertyNames = [];
for (var p in properties) {
if (properties[p] !== null) {
element.style.setProperty(p, properties[p]);
propertyNames.push(p);
}
}
element.__customStyleProperties = propertyNames;
},
rx: styleUtil.rx,
XSCOPE_NAME: 'x-scope'
};
function addToBitMask(n, bits) {
var o = parseInt(n / 32);
var v = 1 << n % 32;
bits[o] = (bits[o] || 0) | v;
}
}();(function () {
Polymer.StyleCache = function () {
this.cache = {};
};
Polymer.StyleCache.prototype = {
MAX: 100,
store: function (is, data, keyValues, keyStyles) {
data.keyValues = keyValues;
data.styles = keyStyles;
var s$ = this.cache[is] = this.cache[is] || [];
s$.push(data);
if (s$.length > this.MAX) {
s$.shift();
}
},
retrieve: function (is, keyValues, keyStyles) {
var cache = this.cache[is];
if (cache) {
for (var i = cache.length - 1, data; i >= 0; i--) {
data = cache[i];
if (keyStyles === data.styles && this._objectsEqual(keyValues, data.keyValues)) {
return data;
}
}
}
},
clear: function () {
this.cache = {};
},
_objectsEqual: function (target, source) {
var t, s;
for (var i in target) {
t = target[i], s = source[i];
if (!(typeof t === 'object' && t ? this._objectsStrictlyEqual(t, s) : t === s)) {
return false;
}
}
if (Array.isArray(target)) {
return target.length === source.length;
}
return true;
},
_objectsStrictlyEqual: function (target, source) {
return this._objectsEqual(target, source) && this._objectsEqual(source, target);
}
};
}());Polymer.StyleDefaults = function () {
var styleProperties = Polymer.StyleProperties;
var StyleCache = Polymer.StyleCache;
var nativeVariables = Polymer.Settings.useNativeCSSProperties;
var api = {
_styles: [],
_properties: null,
customStyle: {},
_styleCache: new StyleCache(),
_element: Polymer.DomApi.wrap(document.documentElement),
addStyle: function (style) {
this._styles.push(style);
this._properties = null;
},
get _styleProperties() {
if (!this._properties) {
styleProperties.decorateStyles(this._styles, this);
this._styles._scopeStyleProperties = null;
this._properties = styleProperties.hostAndRootPropertiesForScope(this).rootProps;
styleProperties.mixinCustomStyle(this._properties, this.customStyle);
styleProperties.reify(this._properties);
}
return this._properties;
},
hasStyleProperties: function () {
return Boolean(this._properties);
},
_needsStyleProperties: function () {
},
_computeStyleProperties: function () {
return this._styleProperties;
},
updateStyles: function (properties) {
this._properties = null;
if (properties) {
Polymer.Base.mixin(this.customStyle, properties);
}
this._styleCache.clear();
for (var i = 0, s; i < this._styles.length; i++) {
s = this._styles[i];
s = s.__importElement || s;
s._apply();
}
if (nativeVariables) {
styleProperties.updateNativeStyleProperties(document.documentElement, this.customStyle);
}
}
};
return api;
}();(function () {
'use strict';
var serializeValueToAttribute = Polymer.Base.serializeValueToAttribute;
var propertyUtils = Polymer.StyleProperties;
var styleTransformer = Polymer.StyleTransformer;
var styleDefaults = Polymer.StyleDefaults;
var nativeShadow = Polymer.Settings.useNativeShadow;
var nativeVariables = Polymer.Settings.useNativeCSSProperties;
Polymer.Base._addFeature({
_prepStyleProperties: function () {
if (!nativeVariables) {
this._ownStylePropertyNames = this._styles && this._styles.length ? propertyUtils.decorateStyles(this._styles, this) : null;
}
},
customStyle: null,
getComputedStyleValue: function (property) {
return !nativeVariables && this._styleProperties && this._styleProperties[property] || getComputedStyle(this).getPropertyValue(property);
},
_setupStyleProperties: function () {
this.customStyle = {};
this._styleCache = null;
this._styleProperties = null;
this._scopeSelector = null;
this._ownStyleProperties = null;
this._customStyle = null;
},
_needsStyleProperties: function () {
return Boolean(!nativeVariables && this._ownStylePropertyNames && this._ownStylePropertyNames.length);
},
_validateApplyShim: function () {
if (this.__applyShimInvalid) {
Polymer.ApplyShim.transform(this._styles, this.__proto__);
var cssText = styleTransformer.elementStyles(this);
if (nativeShadow) {
var templateStyle = this._template.content.querySelector('style');
if (templateStyle) {
templateStyle.textContent = cssText;
}
} else {
var shadyStyle = this._scopeStyle && this._scopeStyle.nextSibling;
if (shadyStyle) {
shadyStyle.textContent = cssText;
}
}
}
},
_beforeAttached: function () {
if ((!this._scopeSelector || this.__stylePropertiesInvalid) && this._needsStyleProperties()) {
this.__stylePropertiesInvalid = false;
this._updateStyleProperties();
}
},
_findStyleHost: function () {
var e = this, root;
while (root = Polymer.dom(e).getOwnerRoot()) {
if (Polymer.isInstance(root.host)) {
return root.host;
}
e = root.host;
}
return styleDefaults;
},
_updateStyleProperties: function () {
var info, scope = this._findStyleHost();
if (!scope._styleProperties) {
scope._computeStyleProperties();
}
if (!scope._styleCache) {
scope._styleCache = new Polymer.StyleCache();
}
var scopeData = propertyUtils.propertyDataFromStyles(scope._styles, this);
var scopeCacheable = !this.__notStyleScopeCacheable;
if (scopeCacheable) {
scopeData.key.customStyle = this.customStyle;
info = scope._styleCache.retrieve(this.is, scopeData.key, this._styles);
}
var scopeCached = Boolean(info);
if (scopeCached) {
this._styleProperties = info._styleProperties;
} else {
this._computeStyleProperties(scopeData.properties);
}
this._computeOwnStyleProperties();
if (!scopeCached) {
info = styleCache.retrieve(this.is, this._ownStyleProperties, this._styles);
}
var globalCached = Boolean(info) && !scopeCached;
var style = this._applyStyleProperties(info);
if (!scopeCached) {
style = style && nativeShadow ? style.cloneNode(true) : style;
info = {
style: style,
_scopeSelector: this._scopeSelector,
_styleProperties: this._styleProperties
};
if (scopeCacheable) {
scopeData.key.customStyle = {};
this.mixin(scopeData.key.customStyle, this.customStyle);
scope._styleCache.store(this.is, info, scopeData.key, this._styles);
}
if (!globalCached) {
styleCache.store(this.is, Object.create(info), this._ownStyleProperties, this._styles);
}
}
},
_computeStyleProperties: function (scopeProps) {
var scope = this._findStyleHost();
if (!scope._styleProperties) {
scope._computeStyleProperties();
}
var props = Object.create(scope._styleProperties);
var hostAndRootProps = propertyUtils.hostAndRootPropertiesForScope(this);
this.mixin(props, hostAndRootProps.hostProps);
scopeProps = scopeProps || propertyUtils.propertyDataFromStyles(scope._styles, this).properties;
this.mixin(props, scopeProps);
this.mixin(props, hostAndRootProps.rootProps);
propertyUtils.mixinCustomStyle(props, this.customStyle);
propertyUtils.reify(props);
this._styleProperties = props;
},
_computeOwnStyleProperties: function () {
var props = {};
for (var i = 0, n; i < this._ownStylePropertyNames.length; i++) {
n = this._ownStylePropertyNames[i];
props[n] = this._styleProperties[n];
}
this._ownStyleProperties = props;
},
_scopeCount: 0,
_applyStyleProperties: function (info) {
var oldScopeSelector = this._scopeSelector;
this._scopeSelector = info ? info._scopeSelector : this.is + '-' + this.__proto__._scopeCount++;
var style = propertyUtils.applyElementStyle(this, this._styleProperties, this._scopeSelector, info && info.style);
if (!nativeShadow) {
propertyUtils.applyElementScopeSelector(this, this._scopeSelector, oldScopeSelector, this._scopeCssViaAttr);
}
return style;
},
serializeValueToAttribute: function (value, attribute, node) {
node = node || this;
if (attribute === 'class' && !nativeShadow) {
var host = node === this ? this.domHost || this.dataHost : this;
if (host) {
value = host._scopeElementClass(node, value);
}
}
node = this.shadyRoot && this.shadyRoot._hasDistributed ? Polymer.dom(node) : node;
serializeValueToAttribute.call(this, value, attribute, node);
},
_scopeElementClass: function (element, selector) {
if (!nativeShadow && !this._scopeCssViaAttr) {
selector = (selector ? selector + ' ' : '') + SCOPE_NAME + ' ' + this.is + (element._scopeSelector ? ' ' + XSCOPE_NAME + ' ' + element._scopeSelector : '');
}
return selector;
},
updateStyles: function (properties) {
if (properties) {
this.mixin(this.customStyle, properties);
}
if (nativeVariables) {
propertyUtils.updateNativeStyleProperties(this, this.customStyle);
} else {
if (this.isAttached) {
if (this._needsStyleProperties()) {
this._updateStyleProperties();
} else {
this._styleProperties = null;
}
} else {
this.__stylePropertiesInvalid = true;
}
if (this._styleCache) {
this._styleCache.clear();
}
this._updateRootStyles();
}
},
_updateRootStyles: function (root) {
root = root || this.root;
var c$ = Polymer.dom(root)._query(function (e) {
return e.shadyRoot || e.shadowRoot;
});
for (var i = 0, l = c$.length, c; i < l && (c = c$[i]); i++) {
if (c.updateStyles) {
c.updateStyles();
}
}
}
});
Polymer.updateStyles = function (properties) {
styleDefaults.updateStyles(properties);
Polymer.Base._updateRootStyles(document);
};
var styleCache = new Polymer.StyleCache();
Polymer.customStyleCache = styleCache;
var SCOPE_NAME = styleTransformer.SCOPE_NAME;
var XSCOPE_NAME = propertyUtils.XSCOPE_NAME;
}());Polymer.Base._addFeature({
_registerFeatures: function () {
this._prepIs();
this._prepConstructor();
this._prepStyles();
},
_finishRegisterFeatures: function () {
this._prepTemplate();
this._prepShimStyles();
this._prepAnnotations();
this._prepEffects();
this._prepBehaviors();
this._prepPropertyInfo();
this._prepBindings();
this._prepShady();
},
_prepBehavior: function (b) {
this._addPropertyEffects(b.properties);
this._addComplexObserverEffects(b.observers);
this._addHostAttributes(b.hostAttributes);
},
_initFeatures: function () {
this._setupGestures();
this._setupConfigure();
this._setupStyleProperties();
this._setupDebouncers();
this._setupShady();
this._registerHost();
if (this._template) {
this._validateApplyShim();
this._poolContent();
this._beginHosting();
this._stampTemplate();
this._endHosting();
this._marshalAnnotationReferences();
}
this._marshalInstanceEffects();
this._marshalBehaviors();
this._marshalHostAttributes();
this._marshalAttributes();
this._tryReady();
},
_marshalBehavior: function (b) {
if (b.listeners) {
this._listenListeners(b.listeners);
}
}
});(function () {
var propertyUtils = Polymer.StyleProperties;
var styleUtil = Polymer.StyleUtil;
var cssParse = Polymer.CssParse;
var styleDefaults = Polymer.StyleDefaults;
var styleTransformer = Polymer.StyleTransformer;
var applyShim = Polymer.ApplyShim;
var debounce = Polymer.Debounce;
var settings = Polymer.Settings;
var updateDebouncer;
Polymer({
is: 'custom-style',
extends: 'style',
_template: null,
properties: { include: String },
ready: function () {
this.__appliedElement = this.__appliedElement || this;
this.__cssBuild = styleUtil.getCssBuildType(this);
if (this.__appliedElement !== this) {
this.__appliedElement.__cssBuild = this.__cssBuild;
}
this._tryApply();
},
attached: function () {
this._tryApply();
},
_tryApply: function () {
if (!this._appliesToDocument) {
if (this.parentNode && this.parentNode.localName !== 'dom-module') {
this._appliesToDocument = true;
var e = this.__appliedElement;
if (!settings.useNativeCSSProperties) {
this.__needsUpdateStyles = styleDefaults.hasStyleProperties();
styleDefaults.addStyle(e);
}
if (e.textContent || this.include) {
this._apply(true);
} else {
var self = this;
var observer = new MutationObserver(function () {
observer.disconnect();
self._apply(true);
});
observer.observe(e, { childList: true });
}
}
}
},
_updateStyles: function () {
Polymer.updateStyles();
},
_apply: function (initialApply) {
var e = this.__appliedElement;
if (this.include) {
e.textContent = styleUtil.cssFromModules(this.include, true) + e.textContent;
}
if (!e.textContent) {
return;
}
var buildType = this.__cssBuild;
var targetedBuild = styleUtil.isTargetedBuild(buildType);
if (settings.useNativeCSSProperties && targetedBuild) {
return;
}
var styleRules = styleUtil.rulesForStyle(e);
if (!targetedBuild) {
styleUtil.forEachRule(styleRules, function (rule) {
styleTransformer.documentRule(rule);
if (settings.useNativeCSSProperties && !buildType) {
applyShim.transformRule(rule);
}
});
}
if (settings.useNativeCSSProperties) {
e.textContent = styleUtil.toCssText(styleRules);
} else {
var self = this;
var fn = function fn() {
self._flushCustomProperties();
};
if (initialApply) {
Polymer.RenderStatus.whenReady(fn);
} else {
fn();
}
}
},
_flushCustomProperties: function () {
if (this.__needsUpdateStyles) {
this.__needsUpdateStyles = false;
updateDebouncer = debounce(updateDebouncer, this._updateStyles);
} else {
this._applyCustomProperties();
}
},
_applyCustomProperties: function () {
var element = this.__appliedElement;
this._computeStyleProperties();
var props = this._styleProperties;
var rules = styleUtil.rulesForStyle(element);
if (!rules) {
return;
}
element.textContent = styleUtil.toCssText(rules, function (rule) {
var css = rule.cssText = rule.parsedCssText;
if (rule.propertyInfo && rule.propertyInfo.cssText) {
css = cssParse.removeCustomPropAssignment(css);
rule.cssText = propertyUtils.valueForProperties(css, props);
}
});
}
});
}());Polymer.Templatizer = {
properties: { __hideTemplateChildren__: { observer: '_showHideChildren' } },
_instanceProps: Polymer.nob,
_parentPropPrefix: '_parent_',
templatize: function (template) {
this._templatized = template;
if (!template._content) {
template._content = template.content;
}
if (template._content._ctor) {
this.ctor = template._content._ctor;
this._prepParentProperties(this.ctor.prototype, template);
return;
}
var archetype = Object.create(Polymer.Base);
this._customPrepAnnotations(archetype, template);
this._prepParentProperties(archetype, template);
archetype._prepEffects();
this._customPrepEffects(archetype);
archetype._prepBehaviors();
archetype._prepPropertyInfo();
archetype._prepBindings();
archetype._notifyPathUp = this._notifyPathUpImpl;
archetype._scopeElementClass = this._scopeElementClassImpl;
archetype.listen = this._listenImpl;
archetype._showHideChildren = this._showHideChildrenImpl;
archetype.__setPropertyOrig = this.__setProperty;
archetype.__setProperty = this.__setPropertyImpl;
var _constructor = this._constructorImpl;
var ctor = function TemplateInstance(model, host) {
_constructor.call(this, model, host);
};
ctor.prototype = archetype;
archetype.constructor = ctor;
template._content._ctor = ctor;
this.ctor = ctor;
},
_getRootDataHost: function () {
return this.dataHost && this.dataHost._rootDataHost || this.dataHost;
},
_showHideChildrenImpl: function (hide) {
var c = this._children;
for (var i = 0; i < c.length; i++) {
var n = c[i];
if (Boolean(hide) != Boolean(n.__hideTemplateChildren__)) {
if (n.nodeType === Node.TEXT_NODE) {
if (hide) {
n.__polymerTextContent__ = n.textContent;
n.textContent = '';
} else {
n.textContent = n.__polymerTextContent__;
}
} else if (n.style) {
if (hide) {
n.__polymerDisplay__ = n.style.display;
n.style.display = 'none';
} else {
n.style.display = n.__polymerDisplay__;
}
}
}
n.__hideTemplateChildren__ = hide;
}
},
__setPropertyImpl: function (property, value, fromAbove, node) {
if (node && node.__hideTemplateChildren__ && property == 'textContent') {
property = '__polymerTextContent__';
}
this.__setPropertyOrig(property, value, fromAbove, node);
},
_debounceTemplate: function (fn) {
Polymer.dom.addDebouncer(this.debounce('_debounceTemplate', fn));
},
_flushTemplates: function () {
Polymer.dom.flush();
},
_customPrepEffects: function (archetype) {
var parentProps = archetype._parentProps;
for (var prop in parentProps) {
archetype._addPropertyEffect(prop, 'function', this._createHostPropEffector(prop));
}
for (prop in this._instanceProps) {
archetype._addPropertyEffect(prop, 'function', this._createInstancePropEffector(prop));
}
},
_customPrepAnnotations: function (archetype, template) {
archetype._template = template;
var c = template._content;
if (!c._notes) {
var rootDataHost = archetype._rootDataHost;
if (rootDataHost) {
Polymer.Annotations.prepElement = function () {
rootDataHost._prepElement();
};
}
c._notes = Polymer.Annotations.parseAnnotations(template);
Polymer.Annotations.prepElement = null;
this._processAnnotations(c._notes);
}
archetype._notes = c._notes;
archetype._parentProps = c._parentProps;
},
_prepParentProperties: function (archetype, template) {
var parentProps = this._parentProps = archetype._parentProps;
if (this._forwardParentProp && parentProps) {
var proto = archetype._parentPropProto;
var prop;
if (!proto) {
for (prop in this._instanceProps) {
delete parentProps[prop];
}
proto = archetype._parentPropProto = Object.create(null);
if (template != this) {
Polymer.Bind.prepareModel(proto);
Polymer.Base.prepareModelNotifyPath(proto);
}
for (prop in parentProps) {
var parentProp = this._parentPropPrefix + prop;
var effects = [
{
kind: 'function',
effect: this._createForwardPropEffector(prop),
fn: Polymer.Bind._functionEffect
},
{
kind: 'notify',
fn: Polymer.Bind._notifyEffect,
effect: { event: Polymer.CaseMap.camelToDashCase(parentProp) + '-changed' }
}
];
Polymer.Bind._createAccessors(proto, parentProp, effects);
}
}
var self = this;
if (template != this) {
Polymer.Bind.prepareInstance(template);
template._forwardParentProp = function (source, value) {
self._forwardParentProp(source, value);
};
}
this._extendTemplate(template, proto);
template._pathEffector = function (path, value, fromAbove) {
return self._pathEffectorImpl(path, value, fromAbove);
};
}
},
_createForwardPropEffector: function (prop) {
return function (source, value) {
this._forwardParentProp(prop, value);
};
},
_createHostPropEffector: function (prop) {
var prefix = this._parentPropPrefix;
return function (source, value) {
this.dataHost._templatized[prefix + prop] = value;
};
},
_createInstancePropEffector: function (prop) {
return function (source, value, old, fromAbove) {
if (!fromAbove) {
this.dataHost._forwardInstanceProp(this, prop, value);
}
};
},
_extendTemplate: function (template, proto) {
var n$ = Object.getOwnPropertyNames(proto);
if (proto._propertySetter) {
template._propertySetter = proto._propertySetter;
}
for (var i = 0, n; i < n$.length && (n = n$[i]); i++) {
var val = template[n];
var pd = Object.getOwnPropertyDescriptor(proto, n);
Object.defineProperty(template, n, pd);
if (val !== undefined) {
template._propertySetter(n, val);
}
}
},
_showHideChildren: function (hidden) {
},
_forwardInstancePath: function (inst, path, value) {
},
_forwardInstanceProp: function (inst, prop, value) {
},
_notifyPathUpImpl: function (path, value) {
var dataHost = this.dataHost;
var dot = path.indexOf('.');
var root = dot < 0 ? path : path.slice(0, dot);
dataHost._forwardInstancePath.call(dataHost, this, path, value);
if (root in dataHost._parentProps) {
dataHost._templatized._notifyPath(dataHost._parentPropPrefix + path, value);
}
},
_pathEffectorImpl: function (path, value, fromAbove) {
if (this._forwardParentPath) {
if (path.indexOf(this._parentPropPrefix) === 0) {
var subPath = path.substring(this._parentPropPrefix.length);
var model = this._modelForPath(subPath);
if (model in this._parentProps) {
this._forwardParentPath(subPath, value);
}
}
}
Polymer.Base._pathEffector.call(this._templatized, path, value, fromAbove);
},
_constructorImpl: function (model, host) {
this._rootDataHost = host._getRootDataHost();
this._setupConfigure(model);
this._registerHost(host);
this._beginHosting();
this.root = this.instanceTemplate(this._template);
this.root.__noContent = !this._notes._hasContent;
this.root.__styleScoped = true;
this._endHosting();
this._marshalAnnotatedNodes();
this._marshalInstanceEffects();
this._marshalAnnotatedListeners();
var children = [];
for (var n = this.root.firstChild; n; n = n.nextSibling) {
children.push(n);
n._templateInstance = this;
}
this._children = children;
if (host.__hideTemplateChildren__) {
this._showHideChildren(true);
}
this._tryReady();
},
_listenImpl: function (node, eventName, methodName) {
var model = this;
var host = this._rootDataHost;
var handler = host._createEventHandler(node, eventName, methodName);
var decorated = function (e) {
e.model = model;
handler(e);
};
host._listen(node, eventName, decorated);
},
_scopeElementClassImpl: function (node, value) {
var host = this._rootDataHost;
if (host) {
return host._scopeElementClass(node, value);
}
return value;
},
stamp: function (model) {
model = model || {};
if (this._parentProps) {
var templatized = this._templatized;
for (var prop in this._parentProps) {
if (model[prop] === undefined) {
model[prop] = templatized[this._parentPropPrefix + prop];
}
}
}
return new this.ctor(model, this);
},
modelForElement: function (el) {
var model;
while (el) {
if (model = el._templateInstance) {
if (model.dataHost != this) {
el = model.dataHost;
} else {
return model;
}
} else {
el = el.parentNode;
}
}
}
};Polymer({
is: 'dom-template',
extends: 'template',
_template: null,
behaviors: [Polymer.Templatizer],
ready: function () {
this.templatize(this);
}
});Polymer._collections = new WeakMap();
Polymer.Collection = function (userArray) {
Polymer._collections.set(userArray, this);
this.userArray = userArray;
this.store = userArray.slice();
this.initMap();
};
Polymer.Collection.prototype = {
constructor: Polymer.Collection,
initMap: function () {
var omap = this.omap = new WeakMap();
var pmap = this.pmap = {};
var s = this.store;
for (var i = 0; i < s.length; i++) {
var item = s[i];
if (item && typeof item == 'object') {
omap.set(item, i);
} else {
pmap[item] = i;
}
}
},
add: function (item) {
var key = this.store.push(item) - 1;
if (item && typeof item == 'object') {
this.omap.set(item, key);
} else {
this.pmap[item] = key;
}
return '#' + key;
},
removeKey: function (key) {
if (key = this._parseKey(key)) {
this._removeFromMap(this.store[key]);
delete this.store[key];
}
},
_removeFromMap: function (item) {
if (item && typeof item == 'object') {
this.omap.delete(item);
} else {
delete this.pmap[item];
}
},
remove: function (item) {
var key = this.getKey(item);
this.removeKey(key);
return key;
},
getKey: function (item) {
var key;
if (item && typeof item == 'object') {
key = this.omap.get(item);
} else {
key = this.pmap[item];
}
if (key != undefined) {
return '#' + key;
}
},
getKeys: function () {
return Object.keys(this.store).map(function (key) {
return '#' + key;
});
},
_parseKey: function (key) {
if (key && key[0] == '#') {
return key.slice(1);
}
},
setItem: function (key, item) {
if (key = this._parseKey(key)) {
var old = this.store[key];
if (old) {
this._removeFromMap(old);
}
if (item && typeof item == 'object') {
this.omap.set(item, key);
} else {
this.pmap[item] = key;
}
this.store[key] = item;
}
},
getItem: function (key) {
if (key = this._parseKey(key)) {
return this.store[key];
}
},
getItems: function () {
var items = [], store = this.store;
for (var key in store) {
items.push(store[key]);
}
return items;
},
_applySplices: function (splices) {
var keyMap = {}, key;
for (var i = 0, s; i < splices.length && (s = splices[i]); i++) {
s.addedKeys = [];
for (var j = 0; j < s.removed.length; j++) {
key = this.getKey(s.removed[j]);
keyMap[key] = keyMap[key] ? null : -1;
}
for (j = 0; j < s.addedCount; j++) {
var item = this.userArray[s.index + j];
key = this.getKey(item);
key = key === undefined ? this.add(item) : key;
keyMap[key] = keyMap[key] ? null : 1;
s.addedKeys.push(key);
}
}
var removed = [];
var added = [];
for (key in keyMap) {
if (keyMap[key] < 0) {
this.removeKey(key);
removed.push(key);
}
if (keyMap[key] > 0) {
added.push(key);
}
}
return [{
removed: removed,
added: added
}];
}
};
Polymer.Collection.get = function (userArray) {
return Polymer._collections.get(userArray) || new Polymer.Collection(userArray);
};
Polymer.Collection.applySplices = function (userArray, splices) {
var coll = Polymer._collections.get(userArray);
return coll ? coll._applySplices(splices) : null;
};Polymer({
is: 'dom-repeat',
extends: 'template',
_template: null,
properties: {
items: { type: Array },
as: {
type: String,
value: 'item'
},
indexAs: {
type: String,
value: 'index'
},
sort: {
type: Function,
observer: '_sortChanged'
},
filter: {
type: Function,
observer: '_filterChanged'
},
observe: {
type: String,
observer: '_observeChanged'
},
delay: Number,
renderedItemCount: {
type: Number,
notify: true,
readOnly: true
},
initialCount: {
type: Number,
observer: '_initializeChunking'
},
targetFramerate: {
type: Number,
value: 20
},
_targetFrameTime: {
type: Number,
computed: '_computeFrameTime(targetFramerate)'
}
},
behaviors: [Polymer.Templatizer],
observers: ['_itemsChanged(items.*)'],
created: function () {
this._instances = [];
this._pool = [];
this._limit = Infinity;
var self = this;
this._boundRenderChunk = function () {
self._renderChunk();
};
},
detached: function () {
this.__isDetached = true;
for (var i = 0; i < this._instances.length; i++) {
this._detachInstance(i);
}
},
attached: function () {
if (this.__isDetached) {
this.__isDetached = false;
var parent = Polymer.dom(Polymer.dom(this).parentNode);
for (var i = 0; i < this._instances.length; i++) {
this._attachInstance(i, parent);
}
}
},
ready: function () {
this._instanceProps = { __key__: true };
this._instanceProps[this.as] = true;
this._instanceProps[this.indexAs] = true;
if (!this.ctor) {
this.templatize(this);
}
},
_sortChanged: function (sort) {
var dataHost = this._getRootDataHost();
this._sortFn = sort && (typeof sort == 'function' ? sort : function () {
return dataHost[sort].apply(dataHost, arguments);
});
this._needFullRefresh = true;
if (this.items) {
this._debounceTemplate(this._render);
}
},
_filterChanged: function (filter) {
var dataHost = this._getRootDataHost();
this._filterFn = filter && (typeof filter == 'function' ? filter : function () {
return dataHost[filter].apply(dataHost, arguments);
});
this._needFullRefresh = true;
if (this.items) {
this._debounceTemplate(this._render);
}
},
_computeFrameTime: function (rate) {
return Math.ceil(1000 / rate);
},
_initializeChunking: function () {
if (this.initialCount) {
this._limit = this.initialCount;
this._chunkCount = this.initialCount;
this._lastChunkTime = performance.now();
}
},
_tryRenderChunk: function () {
if (this.items && this._limit < this.items.length) {
this.debounce('renderChunk', this._requestRenderChunk);
}
},
_requestRenderChunk: function () {
requestAnimationFrame(this._boundRenderChunk);
},
_renderChunk: function () {
var currChunkTime = performance.now();
var ratio = this._targetFrameTime / (currChunkTime - this._lastChunkTime);
this._chunkCount = Math.round(this._chunkCount * ratio) || 1;
this._limit += this._chunkCount;
this._lastChunkTime = currChunkTime;
this._debounceTemplate(this._render);
},
_observeChanged: function () {
this._observePaths = this.observe && this.observe.replace('.*', '.').split(' ');
},
_itemsChanged: function (change) {
if (change.path == 'items') {
if (Array.isArray(this.items)) {
this.collection = Polymer.Collection.get(this.items);
} else if (!this.items) {
this.collection = null;
} else {
this._error(this._logf('dom-repeat', 'expected array for `items`,' + ' found', this.items));
}
this._keySplices = [];
this._indexSplices = [];
this._needFullRefresh = true;
this._initializeChunking();
this._debounceTemplate(this._render);
} else if (change.path == 'items.splices') {
this._keySplices = this._keySplices.concat(change.value.keySplices);
this._indexSplices = this._indexSplices.concat(change.value.indexSplices);
this._debounceTemplate(this._render);
} else {
var subpath = change.path.slice(6);
this._forwardItemPath(subpath, change.value);
this._checkObservedPaths(subpath);
}
},
_checkObservedPaths: function (path) {
if (this._observePaths) {
path = path.substring(path.indexOf('.') + 1);
var paths = this._observePaths;
for (var i = 0; i < paths.length; i++) {
if (path.indexOf(paths[i]) === 0) {
this._needFullRefresh = true;
if (this.delay) {
this.debounce('render', this._render, this.delay);
} else {
this._debounceTemplate(this._render);
}
return;
}
}
}
},
render: function () {
this._needFullRefresh = true;
this._debounceTemplate(this._render);
this._flushTemplates();
},
_render: function () {
if (this._needFullRefresh) {
this._applyFullRefresh();
this._needFullRefresh = false;
} else if (this._keySplices.length) {
if (this._sortFn) {
this._applySplicesUserSort(this._keySplices);
} else {
if (this._filterFn) {
this._applyFullRefresh();
} else {
this._applySplicesArrayOrder(this._indexSplices);
}
}
} else {
}
this._keySplices = [];
this._indexSplices = [];
var keyToIdx = this._keyToInstIdx = {};
for (var i = this._instances.length - 1; i >= 0; i--) {
var inst = this._instances[i];
if (inst.isPlaceholder && i < this._limit) {
inst = this._insertInstance(i, inst.__key__);
} else if (!inst.isPlaceholder && i >= this._limit) {
inst = this._downgradeInstance(i, inst.__key__);
}
keyToIdx[inst.__key__] = i;
if (!inst.isPlaceholder) {
inst.__setProperty(this.indexAs, i, true);
}
}
this._pool.length = 0;
this._setRenderedItemCount(this._instances.length);
this.fire('dom-change');
this._tryRenderChunk();
},
_applyFullRefresh: function () {
var c = this.collection;
var keys;
if (this._sortFn) {
keys = c ? c.getKeys() : [];
} else {
keys = [];
var items = this.items;
if (items) {
for (var i = 0; i < items.length; i++) {
keys.push(c.getKey(items[i]));
}
}
}
var self = this;
if (this._filterFn) {
keys = keys.filter(function (a) {
return self._filterFn(c.getItem(a));
});
}
if (this._sortFn) {
keys.sort(function (a, b) {
return self._sortFn(c.getItem(a), c.getItem(b));
});
}
for (i = 0; i < keys.length; i++) {
var key = keys[i];
var inst = this._instances[i];
if (inst) {
inst.__key__ = key;
if (!inst.isPlaceholder && i < this._limit) {
inst.__setProperty(this.as, c.getItem(key), true);
}
} else if (i < this._limit) {
this._insertInstance(i, key);
} else {
this._insertPlaceholder(i, key);
}
}
for (var j = this._instances.length - 1; j >= i; j--) {
this._detachAndRemoveInstance(j);
}
},
_numericSort: function (a, b) {
return a - b;
},
_applySplicesUserSort: function (splices) {
var c = this.collection;
var keyMap = {};
var key;
for (var i = 0, s; i < splices.length && (s = splices[i]); i++) {
for (var j = 0; j < s.removed.length; j++) {
key = s.removed[j];
keyMap[key] = keyMap[key] ? null : -1;
}
for (j = 0; j < s.added.length; j++) {
key = s.added[j];
keyMap[key] = keyMap[key] ? null : 1;
}
}
var removedIdxs = [];
var addedKeys = [];
for (key in keyMap) {
if (keyMap[key] === -1) {
removedIdxs.push(this._keyToInstIdx[key]);
}
if (keyMap[key] === 1) {
addedKeys.push(key);
}
}
if (removedIdxs.length) {
removedIdxs.sort(this._numericSort);
for (i = removedIdxs.length - 1; i >= 0; i--) {
var idx = removedIdxs[i];
if (idx !== undefined) {
this._detachAndRemoveInstance(idx);
}
}
}
var self = this;
if (addedKeys.length) {
if (this._filterFn) {
addedKeys = addedKeys.filter(function (a) {
return self._filterFn(c.getItem(a));
});
}
addedKeys.sort(function (a, b) {
return self._sortFn(c.getItem(a), c.getItem(b));
});
var start = 0;
for (i = 0; i < addedKeys.length; i++) {
start = this._insertRowUserSort(start, addedKeys[i]);
}
}
},
_insertRowUserSort: function (start, key) {
var c = this.collection;
var item = c.getItem(key);
var end = this._instances.length - 1;
var idx = -1;
while (start <= end) {
var mid = start + end >> 1;
var midKey = this._instances[mid].__key__;
var cmp = this._sortFn(c.getItem(midKey), item);
if (cmp < 0) {
start = mid + 1;
} else if (cmp > 0) {
end = mid - 1;
} else {
idx = mid;
break;
}
}
if (idx < 0) {
idx = end + 1;
}
this._insertPlaceholder(idx, key);
return idx;
},
_applySplicesArrayOrder: function (splices) {
for (var i = 0, s; i < splices.length && (s = splices[i]); i++) {
for (var j = 0; j < s.removed.length; j++) {
this._detachAndRemoveInstance(s.index);
}
for (j = 0; j < s.addedKeys.length; j++) {
this._insertPlaceholder(s.index + j, s.addedKeys[j]);
}
}
},
_detachInstance: function (idx) {
var inst = this._instances[idx];
if (!inst.isPlaceholder) {
for (var i = 0; i < inst._children.length; i++) {
var el = inst._children[i];
Polymer.dom(inst.root).appendChild(el);
}
return inst;
}
},
_attachInstance: function (idx, parent) {
var inst = this._instances[idx];
if (!inst.isPlaceholder) {
parent.insertBefore(inst.root, this);
}
},
_detachAndRemoveInstance: function (idx) {
var inst = this._detachInstance(idx);
if (inst) {
this._pool.push(inst);
}
this._instances.splice(idx, 1);
},
_insertPlaceholder: function (idx, key) {
this._instances.splice(idx, 0, {
isPlaceholder: true,
__key__: key
});
},
_stampInstance: function (idx, key) {
var model = { __key__: key };
model[this.as] = this.collection.getItem(key);
model[this.indexAs] = idx;
return this.stamp(model);
},
_insertInstance: function (idx, key) {
var inst = this._pool.pop();
if (inst) {
inst.__setProperty(this.as, this.collection.getItem(key), true);
inst.__setProperty('__key__', key, true);
} else {
inst = this._stampInstance(idx, key);
}
var beforeRow = this._instances[idx + 1];
var beforeNode = beforeRow && !beforeRow.isPlaceholder ? beforeRow._children[0] : this;
var parentNode = Polymer.dom(this).parentNode;
Polymer.dom(parentNode).insertBefore(inst.root, beforeNode);
this._instances[idx] = inst;
return inst;
},
_downgradeInstance: function (idx, key) {
var inst = this._detachInstance(idx);
if (inst) {
this._pool.push(inst);
}
inst = {
isPlaceholder: true,
__key__: key
};
this._instances[idx] = inst;
return inst;
},
_showHideChildren: function (hidden) {
for (var i = 0; i < this._instances.length; i++) {
this._instances[i]._showHideChildren(hidden);
}
},
_forwardInstanceProp: function (inst, prop, value) {
if (prop == this.as) {
var idx;
if (this._sortFn || this._filterFn) {
idx = this.items.indexOf(this.collection.getItem(inst.__key__));
} else {
idx = inst[this.indexAs];
}
this.set('items.' + idx, value);
}
},
_forwardInstancePath: function (inst, path, value) {
if (path.indexOf(this.as + '.') === 0) {
this._notifyPath('items.' + inst.__key__ + '.' + path.slice(this.as.length + 1), value);
}
},
_forwardParentProp: function (prop, value) {
var i$ = this._instances;
for (var i = 0, inst; i < i$.length && (inst = i$[i]); i++) {
if (!inst.isPlaceholder) {
inst.__setProperty(prop, value, true);
}
}
},
_forwardParentPath: function (path, value) {
var i$ = this._instances;
for (var i = 0, inst; i < i$.length && (inst = i$[i]); i++) {
if (!inst.isPlaceholder) {
inst._notifyPath(path, value, true);
}
}
},
_forwardItemPath: function (path, value) {
if (this._keyToInstIdx) {
var dot = path.indexOf('.');
var key = path.substring(0, dot < 0 ? path.length : dot);
var idx = this._keyToInstIdx[key];
var inst = this._instances[idx];
if (inst && !inst.isPlaceholder) {
if (dot >= 0) {
path = this.as + '.' + path.substring(dot + 1);
inst._notifyPath(path, value, true);
} else {
inst.__setProperty(this.as, value, true);
}
}
}
},
itemForElement: function (el) {
var instance = this.modelForElement(el);
return instance && instance[this.as];
},
keyForElement: function (el) {
var instance = this.modelForElement(el);
return instance && instance.__key__;
},
indexForElement: function (el) {
var instance = this.modelForElement(el);
return instance && instance[this.indexAs];
}
});Polymer({
is: 'array-selector',
_template: null,
properties: {
items: {
type: Array,
observer: 'clearSelection'
},
multi: {
type: Boolean,
value: false,
observer: 'clearSelection'
},
selected: {
type: Object,
notify: true
},
selectedItem: {
type: Object,
notify: true
},
toggle: {
type: Boolean,
value: false
}
},
clearSelection: function () {
if (Array.isArray(this.selected)) {
for (var i = 0; i < this.selected.length; i++) {
this.unlinkPaths('selected.' + i);
}
} else {
this.unlinkPaths('selected');
this.unlinkPaths('selectedItem');
}
if (this.multi) {
if (!this.selected || this.selected.length) {
this.selected = [];
this._selectedColl = Polymer.Collection.get(this.selected);
}
} else {
this.selected = null;
this._selectedColl = null;
}
this.selectedItem = null;
},
isSelected: function (item) {
if (this.multi) {
return this._selectedColl.getKey(item) !== undefined;
} else {
return this.selected == item;
}
},
deselect: function (item) {
if (this.multi) {
if (this.isSelected(item)) {
var skey = this._selectedColl.getKey(item);
this.arrayDelete('selected', item);
this.unlinkPaths('selected.' + skey);
}
} else {
this.selected = null;
this.selectedItem = null;
this.unlinkPaths('selected');
this.unlinkPaths('selectedItem');
}
},
select: function (item) {
var icol = Polymer.Collection.get(this.items);
var key = icol.getKey(item);
if (this.multi) {
if (this.isSelected(item)) {
if (this.toggle) {
this.deselect(item);
}
} else {
this.push('selected', item);
var skey = this._selectedColl.getKey(item);
this.linkPaths('selected.' + skey, 'items.' + key);
}
} else {
if (this.toggle && item == this.selected) {
this.deselect();
} else {
this.selected = item;
this.selectedItem = item;
this.linkPaths('selected', 'items.' + key);
this.linkPaths('selectedItem', 'items.' + key);
}
}
}
});Polymer({
is: 'dom-if',
extends: 'template',
_template: null,
properties: {
'if': {
type: Boolean,
value: false,
observer: '_queueRender'
},
restamp: {
type: Boolean,
value: false,
observer: '_queueRender'
}
},
behaviors: [Polymer.Templatizer],
_queueRender: function () {
this._debounceTemplate(this._render);
},
detached: function () {
if (!this.parentNode || this.parentNode.nodeType == Node.DOCUMENT_FRAGMENT_NODE && (!Polymer.Settings.hasShadow || !(this.parentNode instanceof ShadowRoot))) {
this._teardownInstance();
}
},
attached: function () {
if (this.if && this.ctor) {
this.async(this._ensureInstance);
}
},
render: function () {
this._flushTemplates();
},
_render: function () {
if (this.if) {
if (!this.ctor) {
this.templatize(this);
}
this._ensureInstance();
this._showHideChildren();
} else if (this.restamp) {
this._teardownInstance();
}
if (!this.restamp && this._instance) {
this._showHideChildren();
}
if (this.if != this._lastIf) {
this.fire('dom-change');
this._lastIf = this.if;
}
},
_ensureInstance: function () {
var parentNode = Polymer.dom(this).parentNode;
if (parentNode) {
var parent = Polymer.dom(parentNode);
if (!this._instance) {
this._instance = this.stamp();
var root = this._instance.root;
parent.insertBefore(root, this);
} else {
var c$ = this._instance._children;
if (c$ && c$.length) {
var lastChild = Polymer.dom(this).previousSibling;
if (lastChild !== c$[c$.length - 1]) {
for (var i = 0, n; i < c$.length && (n = c$[i]); i++) {
parent.insertBefore(n, this);
}
}
}
}
}
},
_teardownInstance: function () {
if (this._instance) {
var c$ = this._instance._children;
if (c$ && c$.length) {
var parent = Polymer.dom(Polymer.dom(c$[0]).parentNode);
for (var i = 0, n; i < c$.length && (n = c$[i]); i++) {
parent.removeChild(n);
}
}
this._instance = null;
}
},
_showHideChildren: function () {
var hidden = this.__hideTemplateChildren__ || !this.if;
if (this._instance) {
this._instance._showHideChildren(hidden);
}
},
_forwardParentProp: function (prop, value) {
if (this._instance) {
this._instance.__setProperty(prop, value, true);
}
},
_forwardParentPath: function (path, value) {
if (this._instance) {
this._instance._notifyPath(path, value, true);
}
}
});Polymer({
is: 'dom-bind',
extends: 'template',
_template: null,
created: function () {
var self = this;
Polymer.RenderStatus.whenReady(function () {
if (document.readyState == 'loading') {
document.addEventListener('DOMContentLoaded', function () {
self._markImportsReady();
});
} else {
self._markImportsReady();
}
});
},
_ensureReady: function () {
if (!this._readied) {
this._readySelf();
}
},
_markImportsReady: function () {
this._importsReady = true;
this._ensureReady();
},
_registerFeatures: function () {
this._prepConstructor();
},
_insertChildren: function () {
var parentDom = Polymer.dom(Polymer.dom(this).parentNode);
parentDom.insertBefore(this.root, this);
},
_removeChildren: function () {
if (this._children) {
for (var i = 0; i < this._children.length; i++) {
this.root.appendChild(this._children[i]);
}
}
},
_initFeatures: function () {
},
_scopeElementClass: function (element, selector) {
if (this.dataHost) {
return this.dataHost._scopeElementClass(element, selector);
} else {
return selector;
}
},
_configureInstanceProperties: function () {
},
_prepConfigure: function () {
var config = {};
for (var prop in this._propertyEffects) {
config[prop] = this[prop];
}
var setupConfigure = this._setupConfigure;
this._setupConfigure = function () {
setupConfigure.call(this, config);
};
},
attached: function () {
if (this._importsReady) {
this.render();
}
},
detached: function () {
this._removeChildren();
},
render: function () {
this._ensureReady();
if (!this._children) {
this._template = this;
this._prepAnnotations();
this._prepEffects();
this._prepBehaviors();
this._prepConfigure();
this._prepBindings();
this._prepPropertyInfo();
Polymer.Base._initFeatures.call(this);
this._children = Polymer.TreeApi.arrayCopyChildNodes(this.root);
}
this._insertChildren();
this.fire('dom-change');
}
});</script><script>
	Polymer({
		
		is: "tricore-context-path",

		properties: {
			
			/**
			 * Property retrieve the current context path. This will not work if the 
			 * context has not yet been initialized.
			 */
			getPath: {
				type: String,
				notify: true,
				readOnly: true,
				value: function() {
					return this._getPath();
				}
			}
		},

		_getPath: function() {
			var contextPathInputElement = document.querySelector("#contextPath");
			var newContextPath = null;
			if (contextPathInputElement) {
				newContextPath = contextPathInputElement.getAttribute("value");
			}
			if (newContextPath && newContextPath.length > 0 && newContextPath.slice(newContextPath.length-1, newContextPath.length) == "/") {
				newContextPath = newContextPath.slice(0, newContextPath.length-1);
			}

			return newContextPath;
		}

	});
</script>

<script>

  (function() {

    // monostate data
    var metaDatas = {};
    var metaArrays = {};
    var singleton = null;

    Polymer.IronMeta = Polymer({

      is: 'iron-meta',

      properties: {

        /**
         * The type of meta-data.  All meta-data of the same type is stored
         * together.
         */
        type: {
          type: String,
          value: 'default',
          observer: '_typeChanged'
        },

        /**
         * The key used to store `value` under the `type` namespace.
         */
        key: {
          type: String,
          observer: '_keyChanged'
        },

        /**
         * The meta-data to store or retrieve.
         */
        value: {
          type: Object,
          notify: true,
          observer: '_valueChanged'
        },

        /**
         * If true, `value` is set to the iron-meta instance itself.
         */
         self: {
          type: Boolean,
          observer: '_selfChanged'
        },

        /**
         * Array of all meta-data values for the given type.
         */
        list: {
          type: Array,
          notify: true
        }

      },

      hostAttributes: {
        hidden: true
      },

      /**
       * Only runs if someone invokes the factory/constructor directly
       * e.g. `new Polymer.IronMeta()`
       *
       * @param {{type: (string|undefined), key: (string|undefined), value}=} config
       */
      factoryImpl: function(config) {
        if (config) {
          for (var n in config) {
            switch(n) {
              case 'type':
              case 'key':
              case 'value':
                this[n] = config[n];
                break;
            }
          }
        }
      },

      created: function() {
        // TODO(sjmiles): good for debugging?
        this._metaDatas = metaDatas;
        this._metaArrays = metaArrays;
      },

      _keyChanged: function(key, old) {
        this._resetRegistration(old);
      },

      _valueChanged: function(value) {
        this._resetRegistration(this.key);
      },

      _selfChanged: function(self) {
        if (self) {
          this.value = this;
        }
      },

      _typeChanged: function(type) {
        this._unregisterKey(this.key);
        if (!metaDatas[type]) {
          metaDatas[type] = {};
        }
        this._metaData = metaDatas[type];
        if (!metaArrays[type]) {
          metaArrays[type] = [];
        }
        this.list = metaArrays[type];
        this._registerKeyValue(this.key, this.value);
      },

      /**
       * Retrieves meta data value by key.
       *
       * @method byKey
       * @param {string} key The key of the meta-data to be returned.
       * @return {*}
       */
      byKey: function(key) {
        return this._metaData && this._metaData[key];
      },

      _resetRegistration: function(oldKey) {
        this._unregisterKey(oldKey);
        this._registerKeyValue(this.key, this.value);
      },

      _unregisterKey: function(key) {
        this._unregister(key, this._metaData, this.list);
      },

      _registerKeyValue: function(key, value) {
        this._register(key, value, this._metaData, this.list);
      },

      _register: function(key, value, data, list) {
        if (key && data && value !== undefined) {
          data[key] = value;
          list.push(value);
        }
      },

      _unregister: function(key, data, list) {
        if (key && data) {
          if (key in data) {
            var value = data[key];
            delete data[key];
            this.arrayDelete(list, value);
          }
        }
      }

    });

    Polymer.IronMeta.getIronMeta = function getIronMeta() {
       if (singleton === null) {
         singleton = new Polymer.IronMeta();
       }
       return singleton;
     };

    /**
    `iron-meta-query` can be used to access infomation stored in `iron-meta`.

    Examples:

    If I create an instance like this:

        <iron-meta key="info" value="foo/bar"></iron-meta>

    Note that value="foo/bar" is the metadata I've defined. I could define more
    attributes or use child nodes to define additional metadata.

    Now I can access that element (and it's metadata) from any `iron-meta-query` instance:

         var value = new Polymer.IronMetaQuery({key: 'info'}).value;

    @group Polymer Iron Elements
    @element iron-meta-query
    */
    Polymer.IronMetaQuery = Polymer({

      is: 'iron-meta-query',

      properties: {

        /**
         * The type of meta-data.  All meta-data of the same type is stored
         * together.
         */
        type: {
          type: String,
          value: 'default',
          observer: '_typeChanged'
        },

        /**
         * Specifies a key to use for retrieving `value` from the `type`
         * namespace.
         */
        key: {
          type: String,
          observer: '_keyChanged'
        },

        /**
         * The meta-data to store or retrieve.
         */
        value: {
          type: Object,
          notify: true,
          readOnly: true
        },

        /**
         * Array of all meta-data values for the given type.
         */
        list: {
          type: Array,
          notify: true
        }

      },

      /**
       * Actually a factory method, not a true constructor. Only runs if
       * someone invokes it directly (via `new Polymer.IronMeta()`);
       *
       * @param {{type: (string|undefined), key: (string|undefined)}=} config
       */
      factoryImpl: function(config) {
        if (config) {
          for (var n in config) {
            switch(n) {
              case 'type':
              case 'key':
                this[n] = config[n];
                break;
            }
          }
        }
      },

      created: function() {
        // TODO(sjmiles): good for debugging?
        this._metaDatas = metaDatas;
        this._metaArrays = metaArrays;
      },

      _keyChanged: function(key) {
        this._setValue(this._metaData && this._metaData[key]);
      },

      _typeChanged: function(type) {
        this._metaData = metaDatas[type];
        this.list = metaArrays[type];
        if (this.key) {
          this._keyChanged(this.key);
        }
      },

      /**
       * Retrieves meta data value by key.
       * @param {string} key The key of the meta-data to be returned.
       * @return {*}
       */
      byKey: function(key) {
        return this._metaData && this._metaData[key];
      }

    });

  })();
</script><script>
	Polymer({

		is: "tricore-url",

		properties: {

			/**
			 * The URL without the context path to use to construct the bind URL.
			 */
			rawUrl: {
				type: String,
				notify: false,
				readOnly: false
			},

			/**
			 * Use this attibute for getting the output of the URL with the context path.
			 */
			bindUrl: {
				type: String,
				notify: true,
				readOnly: true
			},
			
			_demoBaseUrl: {
				type: String,
				readOnly: true
			}
		},

		observers: [
			"_computeUrl(rawUrl)"
		],
		
		_getContextPath: function() {
			if (!this._contextPath) {
				var contextPathElement = document.createElement("tricore-context-path");
				this._contextPath = contextPathElement.getPath;
			}
			return this._contextPath;
		},

		_computeUrl: function(rawUrl) {
			this._setBindUrl(this.getUrl(rawUrl));
		},

		/**
		 * Returns a URL from the given rawUrl that will contain 
		 * the context path.
		 * 
		 * @param {String} rawUrl
		 * @return {String} The URL with the context path.
		 */
		getUrl: function(rawUrl) {
			var demoBaseUrl = this._getDemoBasedUrl();
			if (demoBaseUrl) {
				var fileName = "demo" + rawUrl.match(/[^\?]+/)[0].replace(/\//g, ".") + ".json";
				return demoBaseUrl + "/" + fileName;
			} else {
				return this._getContextPath() + rawUrl;
			}
		},
		
		_getDemoBasedUrl: function() {
			if (!this._demoBaseUrl) {
				var ironMeta = document.createElement("iron-meta");
				ironMeta.type = "tri";
				this._set_demoBaseUrl(ironMeta.byKey("demoBaseUrl"));
			}			
			return this._demoBaseUrl;
		}

	});
</script><script>
	/**
	 * `TriLazyLoadingBehavior` is a utility for lazy-loading resources.
	 * 
	 *	To lazy-load a resource, you must do the following:
	 *
	 *	- Do not import the resource using `<link rel="import">` tag.
	 *	- When you want to load the resource, call the `loadResource` function and pass in the instance of the resource to load in the DOM and its filename.
	 *	
	 * 				
	 *	Example:
	 *
	 *		<!-- <link rel="import" href="resource-to-load.html"> -->
	 *		<dom-module id="my-module">
	 *			<template>
	 *				<resource-to-load id="myResource"></resource-to-load>
	 *				<triplat-graphic id="myGraphic"></triplat-graphic>
	 *			</template>
	 *		</dom-module>
	 *		<script>
	 *			...
	 *		    attached: function() {
	 *				Polymer.RenderStatus.afterNextRender(this, function(){
	 *					this.loadResource(this.$.myResource, 
	 *										"resource-to-load.html");
	 *					this.loadResource(this.$.myGraphic, 
     *										"../triplat-graphic/triplat-graphic.html");
	 *				});
	 *			}
	 *		<script>
	 * 
	 *	The `resource-to-load` and `triplat-graphic` will be loaded after the `my-module` is loaded.
	 *
	 *	### Vulcanized Application
	 *	If you vulcanized the application and at the same time lazy-load a resource, you will need to separate the import links of the lazy-loaded resource so it will not result in the following error: `A type with that name is already registered.`
	 *	To prevent the error, do not import a reference in the lazy-loaded resource, separate it into its own import file, and import that file into the main app view file so that those references will be included in the vulcanized file.
	 *
	 *
	 *	Example in resource-to-load.html:
	 *
	 *		<!-- This is a lazy-loaded resource, do not import resources here, 
	 *			 instead create a separate file. -->
	 *		<dom-module id="resource-to-load">
	 *			<template>
	 *				<other-comp>My lazy-loaded component.</other-comp>
	 *			</template>
	 *		</dom-module>
	 *	
	 *	
	 *	Example in resource-to-load-imports.html:
	 *
	 *		<!-- Create a new file to hold the imports. -->
	 *		<link rel="import" href="other-comp.html">
	 *
	 *		
	 *	Example in my-app-view.html to vulcanize:
	 *
	 *		<link rel="import" href="resource-to-load-imports.html">
	 *
	 *
	 * @polymerBehavior
	 */
	TriLazyLoadingBehavior = { 

		/**
		 * Loads the resource by importing it imperatively.
		 *
		 * @param {HTMLElement} resourceInstance The instance of the resource to load in the DOM. 
		 * @param {string} resourceFilename The filename of the resource to load.
		 * @return {Object} Promise object after the resource is loaded.
		 */	
		 loadResource: function(resourceInstance, resourceFilename) {
			return new Promise(function(resolve) {
				if (!Polymer.isInstance(resourceInstance)) {
					this.importHref(this.resolveUrl(resourceFilename),
						function() {
							resolve();
						},
						function() {
							console.error("Error loading " + resourceFilename + ".");
						},
						false
					);
				} else {
					resolve();
				}
			}.bind(this));
		},
  };
</script><script>
	/**
	 * `TriHomeAppBehavior` keeps track of the home app configuration like the app name, label and URL when the app is launched from another app.
	 *
	 *	<div style="background-color:#FFFFCC">
	 *	    <div style="padding:20px;">
	 *	        <b>Note:</b> When you implement this behavior, you should include `_getDefaultAppLabel()` method to return the default app label when the home app label is not available.  Otherwise, no label will be set.
	 *	    </div>
	 *	</div>
	 * 
	 * @polymerBehavior
	 */
	TriHomeAppBehavior = { 

		properties: {
			/**
			 * The name of the home app from the `homeApp` parameter in the URL.
			 */	
			homeApp: {
				type: String,
				value: null
			},
			/**
			 * The label of the home app from the local storage based on the key from the `homeApp` parameter in the URL plus `AppLabel`.
			 */	
			homeAppLabel: {
				type: String,
				value: null
			},
			/**
			 * The calculated URL of the home app based from the `homeApp` parameter in the URL.
			 */	
			homeUrl: {
				type: String,
				value: null
			},
		},

		ready: function() {
			//retain the call order	
			this._setHomeApp();
			this._setHomeAppLabel();
		},

		_setHomeApp: function() {
			var homeApp = this._getURLParameter('homeApp');
			if (homeApp) {
				this.set("homeApp", homeApp);
				var homeUrl = this.$.triurl.getUrl('/p/web/' + homeApp);
				if (homeUrl) {
					this.set("homeUrl", homeUrl);
				}
			}
		},

		_setHomeAppLabel: function() {
			var homeAppLabel = null;
			if (this.homeApp) {
				homeAppLabel = this._getAppLabelFromStorage();
				if (homeAppLabel) {
					this.set("homeAppLabel", homeAppLabel);
				}
			} 

			if (!homeAppLabel) {
				this.set("homeAppLabel", this._getDefaultAppLabel());				
			}			
		},

		_getAppLabelFromStorage: function() {
			try {
				var appLabel = sessionStorage.getItem(this.homeApp + "AppLabel");
				return appLabel;
			} catch (ex) {
				console.error("Could not retrieve item from sessionStorage.  Enable cookies for this page.", ex);
			};
			return null;			
		},

		_getDefaultAppLabel: function() {
			console.error("_getDefaultAppLabel method should be implemented.  The method is expected to return the default label of the application.");
			return "";
		},
		
		_getURLParameter: function(getParam) {
			var url = window.location.search.substring(1);
			var urlParameters = url.split('&');
			for (var i = 0; i < urlParameters.length; i++)  {
				var parameterName = urlParameters[i].split('=');
				if (parameterName[0] == getParam)  {
					return decodeURIComponent(parameterName[1]);
				}
			}
		},

  };
</script>

<style>
  /* IE 10 support for HTML5 hidden attr */
  [hidden] {
    display: none !important;
  }
</style><style is="custom-style">
  :root {

    --layout: {
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
    };

    --layout-inline: {
      display: -ms-inline-flexbox;
      display: -webkit-inline-flex;
      display: inline-flex;
    };

    --layout-horizontal: {
      @apply(--layout);

      -ms-flex-direction: row;
      -webkit-flex-direction: row;
      flex-direction: row;
    };

    --layout-horizontal-reverse: {
      @apply(--layout);

      -ms-flex-direction: row-reverse;
      -webkit-flex-direction: row-reverse;
      flex-direction: row-reverse;
    };

    --layout-vertical: {
      @apply(--layout);

      -ms-flex-direction: column;
      -webkit-flex-direction: column;
      flex-direction: column;
    };

    --layout-vertical-reverse: {
      @apply(--layout);

      -ms-flex-direction: column-reverse;
      -webkit-flex-direction: column-reverse;
      flex-direction: column-reverse;
    };

    --layout-wrap: {
      -ms-flex-wrap: wrap;
      -webkit-flex-wrap: wrap;
      flex-wrap: wrap;
    };

    --layout-wrap-reverse: {
      -ms-flex-wrap: wrap-reverse;
      -webkit-flex-wrap: wrap-reverse;
      flex-wrap: wrap-reverse;
    };

    --layout-flex-auto: {
      -ms-flex: 1 1 auto;
      -webkit-flex: 1 1 auto;
      flex: 1 1 auto;
    };

    --layout-flex-none: {
      -ms-flex: none;
      -webkit-flex: none;
      flex: none;
    };

    --layout-flex: {
      -ms-flex: 1 1 0.000000001px;
      -webkit-flex: 1;
      flex: 1;
      -webkit-flex-basis: 0.000000001px;
      flex-basis: 0.000000001px;
    };

    --layout-flex-2: {
      -ms-flex: 2;
      -webkit-flex: 2;
      flex: 2;
    };

    --layout-flex-3: {
      -ms-flex: 3;
      -webkit-flex: 3;
      flex: 3;
    };

    --layout-flex-4: {
      -ms-flex: 4;
      -webkit-flex: 4;
      flex: 4;
    };

    --layout-flex-5: {
      -ms-flex: 5;
      -webkit-flex: 5;
      flex: 5;
    };

    --layout-flex-6: {
      -ms-flex: 6;
      -webkit-flex: 6;
      flex: 6;
    };

    --layout-flex-7: {
      -ms-flex: 7;
      -webkit-flex: 7;
      flex: 7;
    };

    --layout-flex-8: {
      -ms-flex: 8;
      -webkit-flex: 8;
      flex: 8;
    };

    --layout-flex-9: {
      -ms-flex: 9;
      -webkit-flex: 9;
      flex: 9;
    };

    --layout-flex-10: {
      -ms-flex: 10;
      -webkit-flex: 10;
      flex: 10;
    };

    --layout-flex-11: {
      -ms-flex: 11;
      -webkit-flex: 11;
      flex: 11;
    };

    --layout-flex-12: {
      -ms-flex: 12;
      -webkit-flex: 12;
      flex: 12;
    };

    /* alignment in cross axis */

    --layout-start: {
      -ms-flex-align: start;
      -webkit-align-items: flex-start;
      align-items: flex-start;
    };

    --layout-center: {
      -ms-flex-align: center;
      -webkit-align-items: center;
      align-items: center;
    };

    --layout-end: {
      -ms-flex-align: end;
      -webkit-align-items: flex-end;
      align-items: flex-end;
    };

    --layout-baseline: {
      -ms-flex-align: baseline;
      -webkit-align-items: baseline;
      align-items: baseline;
    };

    /* alignment in main axis */

    --layout-start-justified: {
      -ms-flex-pack: start;
      -webkit-justify-content: flex-start;
      justify-content: flex-start;
    };

    --layout-center-justified: {
      -ms-flex-pack: center;
      -webkit-justify-content: center;
      justify-content: center;
    };

    --layout-end-justified: {
      -ms-flex-pack: end;
      -webkit-justify-content: flex-end;
      justify-content: flex-end;
    };

    --layout-around-justified: {
      -ms-flex-pack: distribute;
      -webkit-justify-content: space-around;
      justify-content: space-around;
    };

    --layout-justified: {
      -ms-flex-pack: justify;
      -webkit-justify-content: space-between;
      justify-content: space-between;
    };

    --layout-center-center: {
      @apply(--layout-center);
      @apply(--layout-center-justified);
    };

    /* self alignment */

    --layout-self-start: {
      -ms-align-self: flex-start;
      -webkit-align-self: flex-start;
      align-self: flex-start;
    };

    --layout-self-center: {
      -ms-align-self: center;
      -webkit-align-self: center;
      align-self: center;
    };

    --layout-self-end: {
      -ms-align-self: flex-end;
      -webkit-align-self: flex-end;
      align-self: flex-end;
    };

    --layout-self-stretch: {
      -ms-align-self: stretch;
      -webkit-align-self: stretch;
      align-self: stretch;
    };

    --layout-self-baseline: {
      -ms-align-self: baseline;
      -webkit-align-self: baseline;
      align-self: baseline;
    };

    /* multi-line alignment in main axis */

    --layout-start-aligned: {
      -ms-flex-line-pack: start;  /* IE10 */
      -ms-align-content: flex-start;
      -webkit-align-content: flex-start;
      align-content: flex-start;
    };

    --layout-end-aligned: {
      -ms-flex-line-pack: end;  /* IE10 */
      -ms-align-content: flex-end;
      -webkit-align-content: flex-end;
      align-content: flex-end;
    };

    --layout-center-aligned: {
      -ms-flex-line-pack: center;  /* IE10 */
      -ms-align-content: center;
      -webkit-align-content: center;
      align-content: center;
    };

    --layout-between-aligned: {
      -ms-flex-line-pack: justify;  /* IE10 */
      -ms-align-content: space-between;
      -webkit-align-content: space-between;
      align-content: space-between;
    };

    --layout-around-aligned: {
      -ms-flex-line-pack: distribute;  /* IE10 */
      -ms-align-content: space-around;
      -webkit-align-content: space-around;
      align-content: space-around;
    };

    /*******************************
              Other Layout
    *******************************/

    --layout-block: {
      display: block;
    };

    --layout-invisible: {
      visibility: hidden !important;
    };

    --layout-relative: {
      position: relative;
    };

    --layout-fit: {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    };

    --layout-scroll: {
      -webkit-overflow-scrolling: touch;
      overflow: auto;
    };

    --layout-fullbleed: {
      margin: 0;
      height: 100vh;
    };

    /* fixed position */

    --layout-fixed-top: {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
    };

    --layout-fixed-right: {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
    };

    --layout-fixed-bottom: {
      position: fixed;
      right: 0;
      bottom: 0;
      left: 0;
    };

    --layout-fixed-left: {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
    };

  }

</style>
<dom-module id="iron-flex" assetpath="../iron-flex-layout/">
  <template>
    <style>
      .layout.horizontal,
      .layout.vertical {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
      }

      .layout.inline {
        display: -ms-inline-flexbox;
        display: -webkit-inline-flex;
        display: inline-flex;
      }

      .layout.horizontal {
        -ms-flex-direction: row;
        -webkit-flex-direction: row;
        flex-direction: row;
      }

      .layout.vertical {
        -ms-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
      }

      .layout.wrap {
        -ms-flex-wrap: wrap;
        -webkit-flex-wrap: wrap;
        flex-wrap: wrap;
      }

      .layout.center,
      .layout.center-center {
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
      }

      .layout.center-justified,
      .layout.center-center {
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
      }

      .flex {
        -ms-flex: 1 1 0.000000001px;
        -webkit-flex: 1;
        flex: 1;
        -webkit-flex-basis: 0.000000001px;
        flex-basis: 0.000000001px;
      }

      .flex-auto {
        -ms-flex: 1 1 auto;
        -webkit-flex: 1 1 auto;
        flex: 1 1 auto;
      }

      .flex-none {
        -ms-flex: none;
        -webkit-flex: none;
        flex: none;
      }
    </style>
  </template>
</dom-module>


<dom-module id="iron-flex-reverse" assetpath="../iron-flex-layout/">
  <template>
    <style>
      .layout.horizontal-reverse,
      .layout.vertical-reverse {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
      }

      .layout.horizontal-reverse {
        -ms-flex-direction: row-reverse;
        -webkit-flex-direction: row-reverse;
        flex-direction: row-reverse;
      }

      .layout.vertical-reverse {
        -ms-flex-direction: column-reverse;
        -webkit-flex-direction: column-reverse;
        flex-direction: column-reverse;
      }

      .layout.wrap-reverse {
        -ms-flex-wrap: wrap-reverse;
        -webkit-flex-wrap: wrap-reverse;
        flex-wrap: wrap-reverse;
      }
    </style>
  </template>
</dom-module>


<dom-module id="iron-flex-alignment" assetpath="../iron-flex-layout/">
  <template>
    <style>
      /**
       * Alignment in cross axis.
       */
      .layout.start {
        -ms-flex-align: start;
        -webkit-align-items: flex-start;
        align-items: flex-start;
      }

      .layout.center,
      .layout.center-center {
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
      }

      .layout.end {
        -ms-flex-align: end;
        -webkit-align-items: flex-end;
        align-items: flex-end;
      }

      .layout.baseline {
        -ms-flex-align: baseline;
        -webkit-align-items: baseline;
        align-items: baseline;
      }

      /**
       * Alignment in main axis.
       */
      .layout.start-justified {
        -ms-flex-pack: start;
        -webkit-justify-content: flex-start;
        justify-content: flex-start;
      }

      .layout.center-justified,
      .layout.center-center {
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
      }

      .layout.end-justified {
        -ms-flex-pack: end;
        -webkit-justify-content: flex-end;
        justify-content: flex-end;
      }

      .layout.around-justified {
        -ms-flex-pack: distribute;
        -webkit-justify-content: space-around;
        justify-content: space-around;
      }

      .layout.justified {
        -ms-flex-pack: justify;
        -webkit-justify-content: space-between;
        justify-content: space-between;
      }

      /**
       * Self alignment.
       */
      .self-start {
        -ms-align-self: flex-start;
        -webkit-align-self: flex-start;
        align-self: flex-start;
      }

      .self-center {
        -ms-align-self: center;
        -webkit-align-self: center;
        align-self: center;
      }

      .self-end {
        -ms-align-self: flex-end;
        -webkit-align-self: flex-end;
        align-self: flex-end;
      }

      .self-stretch {
        -ms-align-self: stretch;
        -webkit-align-self: stretch;
        align-self: stretch;
      }

      .self-baseline {
        -ms-align-self: baseline;
        -webkit-align-self: baseline;
        align-self: baseline;
      };

      /**
       * multi-line alignment in main axis.
       */
      .layout.start-aligned {
        -ms-flex-line-pack: start;  /* IE10 */
        -ms-align-content: flex-start;
        -webkit-align-content: flex-start;
        align-content: flex-start;
      }

      .layout.end-aligned {
        -ms-flex-line-pack: end;  /* IE10 */
        -ms-align-content: flex-end;
        -webkit-align-content: flex-end;
        align-content: flex-end;
      }

      .layout.center-aligned {
        -ms-flex-line-pack: center;  /* IE10 */
        -ms-align-content: center;
        -webkit-align-content: center;
        align-content: center;
      }

      .layout.between-aligned {
        -ms-flex-line-pack: justify;  /* IE10 */
        -ms-align-content: space-between;
        -webkit-align-content: space-between;
        align-content: space-between;
      }

      .layout.around-aligned {
        -ms-flex-line-pack: distribute;  /* IE10 */
        -ms-align-content: space-around;
        -webkit-align-content: space-around;
        align-content: space-around;
      }
    </style>
  </template>
</dom-module>

<dom-module id="iron-flex-factors" assetpath="../iron-flex-layout/">
  <template>
    <style>
      .flex,
      .flex-1 {
        -ms-flex: 1 1 0.000000001px;
        -webkit-flex: 1;
        flex: 1;
        -webkit-flex-basis: 0.000000001px;
        flex-basis: 0.000000001px;
      }

      .flex-2 {
        -ms-flex: 2;
        -webkit-flex: 2;
        flex: 2;
      }

      .flex-3 {
        -ms-flex: 3;
        -webkit-flex: 3;
        flex: 3;
      }

      .flex-4 {
        -ms-flex: 4;
        -webkit-flex: 4;
        flex: 4;
      }

      .flex-5 {
        -ms-flex: 5;
        -webkit-flex: 5;
        flex: 5;
      }

      .flex-6 {
        -ms-flex: 6;
        -webkit-flex: 6;
        flex: 6;
      }

      .flex-7 {
        -ms-flex: 7;
        -webkit-flex: 7;
        flex: 7;
      }

      .flex-8 {
        -ms-flex: 8;
        -webkit-flex: 8;
        flex: 8;
      }

      .flex-9 {
        -ms-flex: 9;
        -webkit-flex: 9;
        flex: 9;
      }

      .flex-10 {
        -ms-flex: 10;
        -webkit-flex: 10;
        flex: 10;
      }

      .flex-11 {
        -ms-flex: 11;
        -webkit-flex: 11;
        flex: 11;
      }

      .flex-12 {
        -ms-flex: 12;
        -webkit-flex: 12;
        flex: 12;
      }
    </style>
  </template>
</dom-module>


<dom-module id="iron-positioning" assetpath="../iron-flex-layout/">
  <template>
    <style>
      .block {
        display: block;
      }

      /* IE 10 support for HTML5 hidden attr */
      [hidden] {
        display: none !important;
      }

      .invisible {
        visibility: hidden !important;
      }

      .relative {
        position: relative;
      }

      .fit {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }

      body.fullbleed {
        margin: 0;
        height: 100vh;
      }

      .scroll {
        -webkit-overflow-scrolling: touch;
        overflow: auto;
      }

      /* fixed position */
      .fixed-bottom,
      .fixed-left,
      .fixed-right,
      .fixed-top {
        position: fixed;
      }

      .fixed-top {
        top: 0;
        left: 0;
        right: 0;
      }

      .fixed-right {
        top: 0;
        right: 0;
        bottom: 0;
      }

      .fixed-bottom {
        right: 0;
        bottom: 0;
        left: 0;
      }

      .fixed-left {
        top: 0;
        bottom: 0;
        left: 0;
      }
    </style>
  </template>
</dom-module>
<style is="custom-style">

	@font-face {
		font-family: 'IBM Plex Sans';
		src: url("../triplat-theme/IBMPlex/IBMPlexSans-Light.woff2") format('woff2'),
		     url("../triplat-theme/IBMPlex/IBMPlexSans-Light.woff") format('woff');
		font-weight: 100;
	}

	@font-face {
		font-family: 'IBM Plex Sans';
		src: url("../triplat-theme/IBMPlex/IBMPlexSans-Regular.woff2") format('woff2'),
		     url("../triplat-theme/IBMPlex/IBMPlexSans-Regular.woff") format('woff');
		font-weight: 400;
	}

	@font-face {
		font-family: 'IBM Plex Sans';
		src: url("../triplat-theme/IBMPlex/IBMPlexSans-Medium.woff2") format('woff2'),
		     url("../triplat-theme/IBMPlex/IBMPlexSans-Medium.woff") format('woff');
		font-weight: 500;
	}

	@font-face {
		font-family: 'IBM Plex Sans';
		src: url("../triplat-theme/IBMPlex/IBMPlexSans-SemiBold.woff2") format('woff2'),
		     url("../triplat-theme/IBMPlex/IBMPlexSans-SemiBold.woff") format('woff');
		font-weight: 900;
	}

	:root {
		/*
		 * IBM Colors
		 */
		--ibm-blue-10: #edf5ff;
		--ibm-blue-20: #d0e2ff;
		--ibm-blue-30: #a6c8ff;
		--ibm-blue-40: #78a9ff;
		--ibm-blue-50: #4589ff;
		--ibm-blue-60: #0f62fe;
		--ibm-blue-70: #0043ce;
		--ibm-blue-80: #002d9c;
		--ibm-blue-90: #001d6c;
		--ibm-blue-100: #001141;

		--ibm-green-10: #defbe6;
		--ibm-green-20: #a7f0ba;
		--ibm-green-30: #6fdc8c;
		--ibm-green-40: #42be65;
		--ibm-green-50: #24a148;
		--ibm-green-60: #198038;
		--ibm-green-70: #0e6027;
		--ibm-green-80: #044317;
		--ibm-green-90: #022d0d;
		--ibm-green-100: #071908;

		--ibm-teal-10: #d9fbfb;
		--ibm-teal-20: #9ef0f0;
		--ibm-teal-30: #3ddbd9;
		--ibm-teal-40: #08bdba;
		--ibm-teal-50: #009d9a;
		--ibm-teal-60: #007d79;
		--ibm-teal-70: #005d5d;
		--ibm-teal-80: #004144;
		--ibm-teal-90: #022b30;
		--ibm-teal-100: #081a1c;

		--ibm-purple-10: #f6f2ff;
		--ibm-purple-20: #e8daff;
		--ibm-purple-30: #d4bbff;
		--ibm-purple-40: #be95ff;
		--ibm-purple-50: #a56eff;
		--ibm-purple-60: #8a3ffc;
		--ibm-purple-70: #6929c4;
		--ibm-purple-80: #491d8b;
		--ibm-purple-90: #31135e;
		--ibm-purple-100: #1c0f30;

		--ibm-magenta-10: #fff0f7;
		--ibm-magenta-20: #ffd6e8;
		--ibm-magenta-30: #ffafd2;
		--ibm-magenta-40: #ff7eb6;
		--ibm-magenta-50: #ee5396;
		--ibm-magenta-60: #d12771;
		--ibm-magenta-70: #9f1853;
		--ibm-magenta-80: #740937;
		--ibm-magenta-90: #510224;
		--ibm-magenta-100: #2a0a18;

		--ibm-red-10: #fff1f1;
		--ibm-red-20: #ffd7d9;
		--ibm-red-30: #ffb3b8;
		--ibm-red-40: #ff8389;
		--ibm-red-50: #fa4d56;
		--ibm-red-60: #da1e28;
		--ibm-red-70: #a2191f;
		--ibm-red-80: #750e13;
		--ibm-red-90: #520408;
		--ibm-red-100: #2d0709;

		--ibm-orange-10: #fff2e8;
		--ibm-orange-20: #ffd9Be;
		--ibm-orange-30: #ffb784;
		--ibm-orange-40: #ff832b;
		--ibm-orange-50: #eb6200;
		--ibm-orange-60: #ba4e00;
		--ibm-orange-70: #8a3800;
		--ibm-orange-80: #5e2900;
		--ibm-orange-90: #3e1a00;
		--ibm-orange-100: #231000;

		--ibm-yellow-10: #fcf4d6;
		--ibm-yellow-20: #fddc69;
		--ibm-yellow-30: #f1c21b;
		--ibm-yellow-40: #d2a106;
		--ibm-yellow-50: #b28600;
		--ibm-yellow-60: #8e6a00;
		--ibm-yellow-70: #684e00;
		--ibm-yellow-80: #483700;
		--ibm-yellow-90: #302400;
		--ibm-yellow-100: #1c1500;

		--ibm-gray-10: #f4f4f4;
		--ibm-gray-20: #e0e0e0;
		--ibm-gray-30: #c6c6c6;
		--ibm-gray-40: #a8a8a8;
		--ibm-gray-50: #8d8d8d;
		--ibm-gray-60: #6f6f6f;
		--ibm-gray-70: #525252;
		--ibm-gray-80: #393939;
		--ibm-gray-90: #262626;
		--ibm-gray-100: #161616;

		--ibm-cool-gray-10: #f2f4f8;
		--ibm-cool-gray-20: #dde1e6;
		--ibm-cool-gray-30: #c1c7cd;
		--ibm-cool-gray-40: #a2a9b0;
		--ibm-cool-gray-50: #878d96;
		--ibm-cool-gray-60: #697077;
		--ibm-cool-gray-70: #4d5358;
		--ibm-cool-gray-80: #343a3f;
		--ibm-cool-gray-90: #21272a;
		--ibm-cool-gray-100: #121619;

		--ibm-warm-gray-10: #f7f3f2;
		--ibm-warm-gray-20: #e5e0df;
		--ibm-warm-gray-30: #cac5c4;
		--ibm-warm-gray-40: #ada8a8;
		--ibm-warm-gray-50: #8f8b8b;
		--ibm-warm-gray-60: #736f6f;
		--ibm-warm-gray-70: #565151;
		--ibm-warm-gray-80: #3c3838;
		--ibm-warm-gray-90: #272525;
		--ibm-warm-gray-100: #171414;

		--ibm-neutral-1: rgb(253, 253, 253);
		--ibm-neutral-2: rgb(249, 249, 249);
		--ibm-neutral-3: rgb(244, 244, 244);
		--ibm-neutral-4: rgb(236, 236, 236);

		--ibm-cool-neutral-1: rgb(251, 253, 253);
		--ibm-cool-neutral-2: rgb(249, 249, 251);
		--ibm-cool-neutral-3: rgb(240, 242, 244);
		--ibm-cool-neutral-4: rgb(236, 240, 242);

		--ibm-warm-neutral-1: rgb(253, 251, 251);
		--ibm-warm-neutral-2: rgb(253, 251, 251);
		--ibm-warm-neutral-3: rgb(247, 245, 245);
		--ibm-warm-neutral-4: rgb(242, 238, 238);

		/*
		 * Theme Colors
		 */
		--tri-primary-dark-color: var(--ibm-gray-100);
		--tri-primary-color: var(--ibm-blue-60);
		--tri-primary-light-color: var(--ibm-blue-40);

		--tri-primary-color-10: var(--ibm-blue-10);
		--tri-primary-color-20: var(--ibm-blue-20);
		--tri-primary-color-30: var(--ibm-blue-30);
		--tri-primary-color-40: var(--ibm-blue-40);
		--tri-primary-color-50: var(--ibm-blue-50);
		--tri-primary-color-60: var(--ibm-blue-60);
		--tri-primary-color-70: var(--ibm-blue-70);
		--tri-primary-color-80: var(--ibm-blue-80);
		--tri-primary-color-90: var(--ibm-blue-90);
		--tri-primary-color-100: var(--ibm-blue-100);

		--tri-secondary-color: var(--ibm-gray-60);
		--tri-info-color: var(--ibm-blue-70);
		--tri-success-color: var(--ibm-green-50);
		--tri-warning-color: var(--ibm-yellow-30);
		--tri-major-warning-color: var(--ibm-orange-40);
		--tri-danger-color: var(--ibm-red-60);
		--tri-error-color: var(--ibm-red-60);

		--tri-disabled-dark-color: rgba(0,0,0,0.3); /* note: will not appear on black background */
		--tri-disabled-light-color: rgba(255,255,255,0.3); /* note: will not appear on white background */

		/*
		 * Overwriting Polymer's theme variables
		 */
		--primary-text-color: var(--tri-primary-content-color);
		--primary-background-color: var(--tri-primary-content-background-color);
		--secondary-text-color: var(--tri-primary-content-label-color);
		--disabled-text-color: var(--tri-disabled-light-color);
		--divider-color: var(--tri-primary-content-accent-color);
		--error-color: var(--tri-error-color);
		--primary-color: var(--tri-primary-color);
		--light-primary-color: var(--tri-primary-light-color);
		--dark-primary-color: var(--tri-primary-dark-color);
		--accent-color: var(--tri-primary-color);
		--light-accent-color: var(--tri-primary-light-color);
		--dark-accent-color: var(--tri-primary-dark-color);

		--triplat-date-picker-icon-color: var(--tri-primary-content-color);
		--triblock-tab-selected-band-color: rgb(15,98,254);
		--triblock-tab-selected-band-height: 3px;
		--triblock-tab-focused-band-height: 3px;
		--triblock-tab-focused-band-background-color: rgb(141,141,141);
		--triblock-tab-unselected-color : rgb(126,126,126);
		
		/*
		 * Font
		 */
		--tri-font-family: 'IBM Plex Sans', 'Helvetica Neue', Arial, sans-serif;
		font-family: var(--tri-font-family);
		font-size: 14px;
		color: var(--tri-primary-content-color);

		/*
		 * General Content
		 */
		/* body */
		--tri-body-background-color: var(--ibm-gray-10);
		/* header */
		--tri-header-background-color: var(--tri-primary-dark-color);
		--tri-header-color: white;
		/* footer */
		--tri-footer-background-color: rgb(0,0,0);
		--tri-footer-color: white;
		--tri-footer-button: {
			background-color: var(--ibm-blue-60);
			color: white;
			height:40px;
		};
		--tri-footer-button-hover: {
			background-color: var(--ibm-blue-70);
			color: white;
		};
		--tri-footer-button-press: {
			background-color: var(--ibm-blue-80);
			color: white;
		};
		--tri-footer-secondary-button: {
			background-color: var(--tri-secondary-color);
			color: white;
			height:40px
		};
		--tri-footer-secondary-button-hover: {
			background-color: rgb(76,76,76);
			color: white;
		};
		--tri-footer-secondary-button-press: {
			background-color: var(--ibm-blue-70);
			color: white;
		};
		--tri-footer-danger-button: {
			border: 1px solid white;
			padding: var(--tri-button-1px-border-padding);
			background-color: var(--tri-footer-background-color);
			color: white;
		};
		--tri-footer-danger-button-hover: {
			background-color: var(--ibm-orange-30);
			color: white;
		};
		--tri-footer-danger-button-press: {
			background-color: var(--tri-danger-color);
			color: white;
		};
		--tri-footer-button-disabled: {
			border-color: var(--ibm-gray-60);
			background-color: var(--ibm-gray-70);
			color: var(--ibm-gray-40);
		};
		--tri-footer-icon-button-color: var(--ibm-blue-30);
		--tri-footer-icon-button-hover-color: var(--ibm-blue-50);
		--tri-footer-icon-button-press-color: var(--ibm-blue-10);
		/* primary content */
		--tri-primary-content-background-color: white;
		--tri-primary-content-color: black;
		--tri-primary-content-accent-color: var(--ibm-gray-20);
		--tri-primary-content-label-color: var(--ibm-gray-60);

		/*
		 * Buttons
		 */
		--tri-button-padding: 12px 24px;
		--tri-button-1px-border-padding: 11px 23px; /* subtracting the 1px border from the default padding */
		--tri-button-2px-border-padding: 10px 22px; /* subtracting the 2px border from the default padding */
		--tri-button-3px-border-padding: 9px 21px; /* subtracting the 3px border from the default padding */
		/* primary */
		--tri-primary-button: {
			padding: var(--tri-button-padding);
			background-color:var(--ibm-blue-60);
			color: white;
		};
		--tri-primary-button-hover: {
			background-color: #0353e9;
			color: white;
		};
		--tri-primary-button-press: {
			background-color: var(--ibm-blue-80);
			color: white;
		};
		/* primary-outline */
		--tri-primary-outline-button: {
			border: 1px solid var(--ibm-blue-60);
			padding: var(--tri-button-1px-border-padding);
			background-color: white;
			color: var(--ibm-blue-60);
		};
		--tri-primary-outline-button-hover: {
			border: none;
			padding: var(--tri-button-padding);
			background-color: var(--ibm-blue-70);
			color: white;
		};
		--tri-primary-outline-button-press: {
			background-color: var(--ibm-blue-70);
			color: white;
		};
		/* secondary */
		--tri-secondary-button: {
			padding: var(--tri-button-padding);
			background-color: var(--ibm-gray-80);
			color: white;
		};
		--tri-secondary-button-hover: {
			border: none;
			padding: var(--tri-button-padding);
			background-color: #4c4c4c;
			color: white;
		};
		--tri-secondary-button-press: {
			background-color: var(--ibm-gray-60);
			color: white;
		};
		--tri-secondary-button-disabled: {
			border: none;
			padding: var(--tri-button-padding);
			background-color: var(--ibm-gray-30);
			color: var(--ibm-gray-40);
		};
		/* info */
		--tri-info-button: {
			padding: var(--tri-button-padding);
			background-color: var(--ibm-blue-30);
			color: white;
		};
		--tri-info-button-hover: {
			background-color: var(--ibm-blue-20);
			color: white;
		};
		--tri-info-button-press: {
			background-color: var(--ibm-blue-40);
			color: white;
		};
		/* info-outline */
		--tri-info-outline-button: {
			border: 2px solid var(--ibm-blue-30);
			padding: var(--tri-button-2px-border-padding);
			background-color: white;
			color: var(--ibm-blue-30);
		};
		--tri-info-outline-button-hover: {
			border: none;
			padding: var(--tri-button-padding);
			background-color: var(--ibm-blue-30);
			color: white;
		};
		--tri-info-outline-button-press: {
			background-color: var(--ibm-blue-40);
			color: white;
		};
		/* success */
		--tri-success-button: {
			padding: var(--tri-button-padding);
			background-color: var(--ibm-green-40);
			color: white;
		};
		--tri-success-button-hover: {
			background-color: var(--ibm-green-30);
			color: white;
		};
		--tri-success-button-press: {
			background-color: var(--ibm-green-60);
			color: white;
		};
		/* success-outline */
		--tri-success-outline-button: {
			border: 2px solid var(--ibm-green-40);
			padding: var(--tri-button-2px-border-padding);
			background-color: white;
			color: var(--ibm-green-40);
		};
		--tri-success-outline-button-hover: {
			border: none;
			padding: var(--tri-button-padding);
			background-color: var(--ibm-green-40);
			color: white;
		};
		--tri-success-outline-button-press: {
			background-color: var(--ibm-green-60);
			color: white;
		};
		/* warning */
		--tri-warning-button: {
			padding: var(--tri-button-padding);
			background-color: var(--ibm-yellow-30);
			color: white;
		};
		--tri-warning-button-hover: {
			background-color: var(--ibm-yellow-20);
			color: white;
		};
		--tri-warning-button-press: {
			background-color: var(--ibm-yellow-40);
			color: white;
		};
		/* warning-outline */
		--tri-warning-outline-button: {
			border: 2px solid var(--ibm-yellow-30);
			padding: var(--tri-button-2px-border-padding);
			background-color: white;
			color: var(--ibm-yellow-30);
		};
		--tri-warning-outline-button-hover: {
			border: none;
			padding: var(--tri-button-padding);
			background-color: var(--ibm-yellow-30);
			color: white;
		};
		--tri-warning-outline-button-press: {
			background-color: var(--ibm-yellow-40);
			color: white;
		};
		/* major-warning */
		--tri-major-warning-button: {
			padding: var(--tri-button-padding);
			background-color: var(--ibm-orange-40);
			color: white;
		};
		--tri-major-warning-button-hover: {
			background-color: var(--ibm-orange-20);
			color: white;
		};
		--tri-major-warning-button-press: {
			background-color: var(--ibm-orange-60);
			color: white;
		};
		/* major-warning-outline */
		--tri-major-warning-outline-button: {
			border: 2px solid var(--ibm-orange-40);
			padding: var(--tri-button-2px-border-padding);
			background-color: white;
			color: var(--ibm-orange-40);
		};
		--tri-major-warning-outline-button-hover: {
			border: none;
			padding: var(--tri-button-padding);
			background-color: var(--ibm-orange-40);
			color: white;
		};
		--tri-major-warning-outline-button-press: {
			background-color: var(--ibm-orange-60);
			color: white;
		};
		/* danger */
		--tri-danger-button: {
			padding: var(--tri-button-padding);
			background-color: var(--ibm-red-60);
			color: white;
		};
		--tri-danger-button-hover: {
			background-color: #ba1b23;
			color: white;
		};
		--tri-danger-button-press: {
			background-color: var(--ibm-red-80);
			color: white;
		};
		/* danger-outline */
		--tri-danger-outline-button: {
			border: 1px solid var(--ibm-gray-30);
			padding: var(--tri-button-1px-border-padding);
			background-color: white;
			color: var(--ibm-orange-50);
		};
		--tri-danger-outline-button-hover: {
			border: none;
			padding: var(--tri-button-padding);
			background-color: var(--ibm-orange-50);
			color: white;
		};
		--tri-danger-outline-button-press: {
			background-color: var(--ibm-orange-70);
			color: white;
		};
		/* disabled */
		--tri-disabled-button: {
			padding: var(--tri-button-2px-border-padding);
			background-color: var(--ibm-gray-30);
			color: var(--ibm-gray-40);
		};

		/*
		 * Icon Buttons
		 */
		/* primary */
		--tri-primary-icon-button-color: var(--ibm-gray-80);
		--tri-primary-icon-button-hover-color: #4c4c4c;
		--tri-primary-icon-button-press-color: var(--ibm-gray-60);
		/* secondary */
		--tri-secondary-icon-button-color: var(--ibm-gray-50);
		--tri-secondary-icon-button-hover-color: var(--ibm-gray-30);
		--tri-secondary-icon-button-press-color: var(--ibm-gray-70);
		/* info */
		--tri-info-icon-button-color: var(--ibm-blue-30);
		--tri-info-icon-button-hover-color: var(--ibm-blue-20);
		--tri-info-icon-button-press-color: var(--ibm-blue-40);
		/* success */
		--tri-success-icon-button-color: var(--ibm-green-40);
		--tri-success-icon-button-hover-color: var(--ibm-green-30);
		--tri-success-icon-button-press-color: var(--ibm-green-60);
		/* warning */
		--tri-warning-icon-button-color: var(--ibm-yellow-30);
		--tri-warning-icon-button-hover-color: var(--ibm-yellow-20);
		--tri-warning-icon-button-press-color: var(--ibm-yellow-40);
		/* major-warning */
		--tri-major-warning-icon-button-color: var(--ibm-orange-40);
		--tri-major-warning-icon-button-hover-color: var(--ibm-orange-20);
		--tri-major-warning-icon-button-press-color: var(--ibm-orange-60);
		/* danger */
		--tri-danger-icon-button-color: var(--ibm-orange-50);
		--tri-danger-icon-button-hover-color: var(--ibm-orange-30);
		--tri-danger-icon-button-press-color: var(--ibm-orange-70);
		/* error */
		--tri-error-icon-button-color: var(--ibm-red-50);
		--tri-error-icon-button-hover-color: var(--ibm-red-30);
		--tri-error-icon-button-press-color: var(--ibm-red-70);
		/* disabled */
		--tri-disabled-icon-button-color: var(--ibm-gray-30);

		/*
		 * paper-button
		 */		
		--paper-button-flat-keyboard-focus: {
			outline: 3px double var(--ibm-gray-50);
		}

		/*
		* triblock-app-layout drawer
		*/

		--triblock-app-layout-mobile-drawer-background-color: var(--tri-primary-dark-color);
		--triblock-app-layout-mobile-drawer-hover-background-color: rgb(61,61,61);

		/*
		* triblock-slide-navigation
		*/	

		--triblock-slide-animation-background-color: rgb(61,61,61);
		--triblock-side-nav-item-selected-color: rgb(61,61,61);
		--triblock-side-nav-item-selected: {
			background-color: rgb(61,61,61);
		};

		/*
		 * paper-checkbox
		 */
		--paper-checkbox-unchecked-color: var(--tri-primary-dark-color);
		--paper-checkbox-unchecked-ink-color: var(--tri-primary-dark-color);
		--paper-checkbox-checked-color: var(--tri-primary-dark-color);
		--paper-checkbox-checked-ink-color: var(--tri-primary-dark-color);
		--paper-checkbox-label-color: var(--tri-primary-dark-color);
		
		/*
		 * paper-toggle-button
		 */
		--paper-toggle-button-unchecked-bar: {
			opacity: 1;
			background-color: var(--ibm-gray-50);
			border-radius: 0.9375rem;
			width: 48px;
			height: 24px;
		};
		--paper-toggle-button-unchecked-button-color: var(--ibm-gray-20);
		--paper-toggle-button-unchecked-button: {
			background-color: var(--ibm-gray-20);
			top: 3px;
			left: 3px;
			height: 18px;
			width: 18px;
			box-shadow: none;
		}
		--paper-toggle-button-checked-bar: {
			opacity: 1;
			background-color: var(--ibm-green-50);
		};
		--paper-toggle-button-checked-button-color: white;
		--paper-toggle-button-checked-button: {
			background-color: white;
			-webkit-transform: translate(24px, 0) !important;
			transform: translate(24px, 0) !important;
			top: 3px;
			left: 3px;
			height: 18px;
			width: 18px;
		}

		/*
		 * paper-dialog
		 */
		--paper-dialog: {
			font-family: var(--tri-font-family);
		};
		--paper-dialog-title: {
			font-family: var(--tri-font-family);
		};

		/*
		 * paper-icon-button
		 */
		--paper-icon-button-disabled-text: var(--tri-disabled-dark-color);

		/*
		 * paper-input
		 */
		--paper-input-container-color: var(--tri-primary-content-label-color);
		--paper-input-container-input-color: var(--tri-primary-content-color);
		--paper-input-container-focus-color: var(--tri-primary-color);
		--paper-input-container-invalid-color: var(--tri-error-color);
		--paper-input-container-input: {
			font-family: var(--tri-font-family);
		};
		--paper-input-container-label: {
			font-family: var(--tri-font-family);
		};

		/*
		 * paper-item
		 */
		--paper-item: {
			font-family: var(--tri-font-family);
		};
		--paper-item-disabled-color: var(--tri-disabled-dark-color);
		--triplat-select-input-paper-item: {
			font-family: var(--tri-font-family);
		};
		
		/*
		 * paper-radio-button
		 */
		--paper-radio-button-unchecked-color: var(--tri-primary-dark-color);
		--paper-radio-button-unchecked-ink-color: var(--tri-primary-dark-color);
		--paper-radio-button-checked-color: var(--tri-primary-dark-color);
		--paper-radio-button-checked-ink-color: var(--tri-primary-dark-color);
		--paper-radio-button-label-color: var(--tri-primary-dark-color);
		
		/*
		 * paper-spinner
		 */
		--paper-spinner-layer-1-color: var(--tri-primary-color);
		--paper-spinner-layer-2-color: var(--tri-secondary-color);
		--paper-spinner-layer-3-color: var(--tri-primary-color);
		--paper-spinner-layer-4-color: var(--tri-secondary-color);

		/*
		 * paper-toolbar
		 */
		--paper-toolbar-height: 50px;
		--paper-toolbar-sm-height: 50px;
		--paper-toolbar-background: var(--tri-header-background-color);
		--paper-toolbar-color: var(--tri-header-color);
		--paper-toolbar-title: {
			font-family: var(--tri-font-family);
		};
		--paper-toolbar-content: {
			padding: 0 0 0 0;
		};

		/*
		 * paper-tooltip
		 */
		--paper-tooltip: {
			font-family: var(--tri-font-family);
			font-size: 14px;
		};
		
		
		/*
		 * triplat-ds-search-input
		 */
		--triplat-ds-search-input-dropdown-item-hover-border-color: #0353e9;
		--triplat-ds-search-input-dropdown-item-background-color: var(--tri-body-background-color);
		--triplat-ds-search-input-dropdown-header-background-color: var(--ibm-gray-30);
		--triplat-ds-search-input-dropdown-header-text-color: var(--tri-primary-content-color);
		--triplat-ds-search-input-dropdown-item-border-color: var(--ibm-gray-40);
		--triplat-ds-search-input-primary-text-color: var(--tri-primary-content-color);
		--triplat-ds-search-input-expand-filters-background-color: var(--tri-body-background-color);
		--triplat-ds-search-input-expand-filters-remove-icon-color: var(--tri-primary-content-color);
		--triplat-ds-search-input-filter-operator-background-color: var(--ibm-gray-30);
		--triplat-ds-search-input-border-color: var(--tri-body-background-color);
		
		/*
		 * triplat-search-input
		 */
		--triplat-search-input-dropdown-item-hover-border-color: #0353e9;
		--triplat-search-input-dropdown-item-background-color: var(--tri-body-background-color);
		--triplat-search-input-dropdown-header-background-color: var(--ibm-gray-30);
		--triplat-search-input-dropdown-header-text-color: var(--tri-primary-content-color);
		--triplat-search-input-dropdown-item-border-color: var(--ibm-gray-40);
		--triplat-search-input-primary-text-color: var(--tri-primary-content-color);
		--triplat-search-input-expand-filters-background-color: var(--tri-body-background-color);
		--triplat-search-input-expand-filters-remove-icon-color: var(--tri-primary-content-color);
		--triplat-search-input-filter-operator-background-color: var(--ibm-gray-30);
		--triplat-search-input-border-color: var(--tri-body-background-color);
		
		/*
		 * triplat-graphic-legend
		 */
		--triplat-graphic-legend-checkbox-color:  var(--tri-primary-dark-color);
		--triplat-graphic-legend-radio-color:  var(--tri-primary-dark-color);
	}

	/*
	*Overrides for workplace services portal
	*/

	:root div.container.tricomp-portal-item-welcome {
		border-bottom: 1px solid rgb(202,202,202);
	}

	:root tricomp-portal-services#services {
		background-color: rgb(224,224,224);
	}

	:root div.service-item-container:hover {
		background-color: rgb(202,202,202);
		cursor: pointer;
	}

	:root div.service-item-container {
		background-color: rgb(224,224,224);
		color: rgb(57,57,57);
		border-bottom: 1px solid rgb(202,202,202);
	}

	:root div.service-title {
		color: var(--tri-primary-color);
	}

	:root div:not([small-screen]).service-item-container:hover .service-title::after {
				content: "";
				position: absolute;
				right: 0;
				bottom: -5px;
				left: 0;
				display: inline-block;
				height: 2px;
				background-color: transparent;
			}
	/*
	* end portal overrides
	*/

	/*
	* space assessment overrides
	*/

	:root #vertical-tabs.tripage-my-space-assessments {
		background-color: var(--tri-primary-dark-color);
	}

	:root #vertical-tabs.tripage-my-space-assessments div.iron-selected.tripage-my-space-assessments {
		background-color: rgb(61,61,61);
	}

	:root .badge[data-badge].tripage-my-space-assessments::after {
		background-color:var(--tri-primary-color);
	}

	:root .layout-button.tripage-my-space-assessments {
		color: var(--tri-primary-dark-color);
	}

	:root #details-vertical-tabs.tripage-assessment-details {
		background-color:var(--tri-primary-dark-color);
	}

	:root #details-vertical-tabs.tripage-assessment-details div.iron-selected.tripage-assessment-details {
		background-color: rgb(61,61,61);
	}

	:root .placeholder-icon.tricomp-completed-assessment-card {
		color: rgb(61,61,61);
	}

	/*
	* end space assessment overrides
	*/
	
	/* 
	 * overrides triplat-ds-search
	 */
	:root .footer-container .footer-loading-text, :root .footer-container .footer-loading-dots, :root .footer-container .footer-selected-text {
		color: white;
	}
	
	:root #main > .filters > .single {
        border-bottom-color: var(--ibm-gray-40);
    }
    
    /*
	 * group move overrides
	 */
	:root .search-container > .search-line .blue-background {
		background-color: var(--tri-body-background-color);
		color: var(--tri-primary-content-color);
	}
	
	:root .graphic-actions[checked] {
		background-color: var(--ibm-blue-60);
	}

	/*
	 * a (link tag) / class="tri-link"
	 */
	:root a:not(.tri-disable-theme) {
		text-decoration: none;
		color: var(--tri-primary-color);
	}
	:root .tri-link {
		cursor: pointer;
		color: var(--tri-primary-color);
	}
	:root a:not(.tri-disable-theme).underline,
	:root .tri-link.underline {
		text-decoration: underline;
	}
	:root a:not(.tri-disable-theme):hover,
	:root .tri-link:hover {
		text-decoration: underline;
	}
	/* footer */
	:root a:not(.tri-disable-theme).footer,
	:root a:not(.tri-disable-theme)[footer],
	:root .tri-link.footer,
	:root .tri-link[footer] {
		color: var(--ibm-blue-30);
	}

	/*
	 * class="tri-h#" / class="tri-fine-print"
	 * (<h#> and <small> elements are avoided here, since these elements have preset browser settings that we don't want)
	 */
	:root .tri-h1 {
		font-size: 36px;
		font-weight: 100;
	}
	:root .tri-h2 {
		font-size: 22px;
	}
	:root .tri-h3 {
		font-size: 18px;
	}
	:root .tri-fine-print {
		font-size: 12px;
		color: var(--ibm-gray-100);
	}

	/*
	 * iron-icon
	 */
	/* primary */
	:root iron-icon:not(.tri-disable-theme)[primary],
	:root iron-icon:not(.tri-disable-theme).primary {
		color: var(--tri-primary-content-color);
	}
	/* secondary */
	:root iron-icon:not(.tri-disable-theme)[secondary],
	:root iron-icon:not(.tri-disable-theme).secondary {
		color: var(--tri-secondary-color);
	}
	/* info */
	:root iron-icon:not(.tri-disable-theme)[info],
	:root iron-icon:not(.tri-disable-theme).info {
		color: var(--tri-info-color);
	}
	/* success */
	:root iron-icon:not(.tri-disable-theme)[success],
	:root iron-icon:not(.tri-disable-theme).success {
		color: var(--tri-success-color);
	}
	/* warning */
	:root iron-icon:not(.tri-disable-theme)[warning],
	:root iron-icon:not(.tri-disable-theme).warning {
		color: var(--tri-warning-color);
	}
	/* major-warning */
	:root iron-icon:not(.tri-disable-theme)[major-warning],
	:root iron-icon:not(.tri-disable-theme).major-warning {
		color: var(--tri-major-warning-color);
	}
	/* danger */
	:root iron-icon:not(.tri-disable-theme)[danger],
	:root iron-icon:not(.tri-disable-theme).danger {
		color: var(--tri-danger-color);
	}
	/* error */
	:root iron-icon:not(.tri-disable-theme)[error],
	:root iron-icon:not(.tri-disable-theme).error {
		color: var(--tri-error-color);
	}
	/* footer */
	:root iron-icon:not(.tri-disable-theme)[footer],
	:root iron-icon:not(.tri-disable-theme).footer {
		color: var(--tri-footer-color);
	}

	/*
	 * label
	 */
	:root label:not(.tri-disable-theme) {
		color: var(--tri-primary-content-label-color);
	}

	/*
	 * paper-button
	 */
	/* default */
	:root paper-button:not(.tri-disable-theme) {
		@apply(--layout-vertical);
		@apply(--layout-center-center);
		font-family: var(--tri-font-family);
		font-weight: 400;
		border-radius: 0px;
		text-align: center;
		text-transform: none;
		width: auto;
		margin: 0 5px;
		@apply(--tri-primary-button);
		
	}
	/* default hover */
	:root paper-button:not(.tri-disable-theme):hover {
		@apply(--tri-primary-button-hover);
	}
	/* default pressed */
	:root paper-button:not(.tri-disable-theme)[pressed] {
		@apply(--tri-primary-button-press);
	}
	/* primary-outline */
	:root paper-button:not(.tri-disable-theme)[primary-outline],
	:root paper-button:not(.tri-disable-theme).primary-outline {
		@apply(--tri-primary-outline-button);
	}
	/* primary-outline hover */
	:root paper-button:not(.tri-disable-theme)[primary-outline]:hover,
	:root paper-button:not(.tri-disable-theme).primary-outline:hover {
		@apply(--tri-primary-outline-button-hover);
	}
	/* primary-outline pressed */
	:root paper-button:not(.tri-disable-theme)[primary-outline][pressed],
	:root paper-button:not(.tri-disable-theme).primary-outline[pressed] {
		@apply(--tri-primary-outline-button-press);
	}
	/* secondary */
	:root paper-button:not(.tri-disable-theme)[secondary],
	:root paper-button:not(.tri-disable-theme).secondary {
		@apply(--tri-secondary-button);
	}
	/* secondary hover */
	:root paper-button:not(.tri-disable-theme)[secondary]:hover,
	:root paper-button:not(.tri-disable-theme).secondary:hover {
		@apply(--tri-secondary-button-hover);
	}
	/* secondary pressed */
	:root paper-button:not(.tri-disable-theme)[secondary][pressed],
	:root paper-button:not(.tri-disable-theme).secondary[pressed] {
		@apply(--tri-secondary-button-press);
	}
	/* secondary disabled */
	:root paper-button:not(.tri-disable-theme)[secondary][disabled],
	:root paper-button:not(.tri-disable-theme).secondary[disabled] {
		@apply(--tri-secondary-button-disabled);
	}
	/* info */
	:root paper-button:not(.tri-disable-theme)[info],
	:root paper-button:not(.tri-disable-theme).info {
		@apply(--tri-info-button);
	}
	/* info hover */
	:root paper-button:not(.tri-disable-theme)[info]:hover,
	:root paper-button:not(.tri-disable-theme).info:hover {
		@apply(--tri-info-button-hover);
	}
	/* info pressed */
	:root paper-button:not(.tri-disable-theme)[info][pressed],
	:root paper-button:not(.tri-disable-theme).info[pressed] {
		@apply(--tri-info-button-press);
	}
	/* info-outline */
	:root paper-button:not(.tri-disable-theme)[info-outline],
	:root paper-button:not(.tri-disable-theme).info-outline {
		@apply(--tri-info-outline-button);
	}
	/* info-outline hover */
	:root paper-button:not(.tri-disable-theme)[info-outline]:hover,
	:root paper-button:not(.tri-disable-theme).info-outline:hover {
		@apply(--tri-info-outline-button-hover);
	}
	/* info-outline pressed */
	:root paper-button:not(.tri-disable-theme)[info-outline][pressed],
	:root paper-button:not(.tri-disable-theme).info-outline[pressed] {
		@apply(--tri-info-outline-button-press);
	}
	/* success */
	:root paper-button:not(.tri-disable-theme)[success],
	:root paper-button:not(.tri-disable-theme).success {
		@apply(--tri-success-button);
	}
	/* success hover */
	:root paper-button:not(.tri-disable-theme)[success]:hover,
	:root paper-button:not(.tri-disable-theme).success:hover {
		@apply(--tri-success-button-hover);
	}
	/* success pressed */
	:root paper-button:not(.tri-disable-theme)[success][pressed],
	:root paper-button:not(.tri-disable-theme).success[pressed] {
		@apply(--tri-success-button-press);
	}
	/* success-outline */
	:root paper-button:not(.tri-disable-theme)[success-outline],
	:root paper-button:not(.tri-disable-theme).success-outline {
		@apply(--tri-success-outline-button);
	}
	/* success-outline hover */
	:root paper-button:not(.tri-disable-theme)[success-outline]:hover,
	:root paper-button:not(.tri-disable-theme).success-outline:hover {
		@apply(--tri-success-outline-button-hover);
	}
	/* success-outline pressed */
	:root paper-button:not(.tri-disable-theme)[success-outline][pressed],
	:root paper-button:not(.tri-disable-theme).success-outline[pressed] {
		@apply(--tri-success-outline-button-press);
	}
	/* warning */
	:root paper-button:not(.tri-disable-theme)[warning],
	:root paper-button:not(.tri-disable-theme).warning {
		@apply(--tri-warning-button);
	}
	/* warning hover */
	:root paper-button:not(.tri-disable-theme)[warning]:hover,
	:root paper-button:not(.tri-disable-theme).warning:hover {
		@apply(--tri-warning-button-hover);
	}
	/* warning pressed */
	:root paper-button:not(.tri-disable-theme)[warning][pressed],
	:root paper-button:not(.tri-disable-theme).warning[pressed] {
		@apply(--tri-warning-button-press);
	}
	/* warning-outline */
	:root paper-button:not(.tri-disable-theme)[warning-outline],
	:root paper-button:not(.tri-disable-theme).warning-outline {
		@apply(--tri-warning-outline-button);
	}
	/* warning-outline hover */
	:root paper-button:not(.tri-disable-theme)[warning-outline]:hover,
	:root paper-button:not(.tri-disable-theme).warning-outline:hover {
		@apply(--tri-warning-outline-button-hover);
	}
	/* warning-outline pressed */
	:root paper-button:not(.tri-disable-theme)[warning-outline][pressed],
	:root paper-button:not(.tri-disable-theme).warning-outline[pressed] {
		@apply(--tri-warning-outline-button-press);
	}
	/* major-warning */
	:root paper-button:not(.tri-disable-theme)[major-warning],
	:root paper-button:not(.tri-disable-theme).major-warning {
		@apply(--tri-major-warning-button);
	}
	/* major-warning hover */
	:root paper-button:not(.tri-disable-theme)[major-warning]:hover,
	:root paper-button:not(.tri-disable-theme).major-warning:hover {
		@apply(--tri-major-warning-button-hover);
	}
	/* major-warning pressed */
	:root paper-button:not(.tri-disable-theme)[major-warning][pressed],
	:root paper-button:not(.tri-disable-theme).major-warning[pressed] {
		@apply(--tri-major-warning-button-press);
	}
	/* major-warning-outline */
	:root paper-button:not(.tri-disable-theme)[major-warning-outline],
	:root paper-button:not(.tri-disable-theme).major-warning-outline {
		@apply(--tri-major-warning-outline-button);
	}
	/* major-warning-outline hover */
	:root paper-button:not(.tri-disable-theme)[major-warning-outline]:hover,
	:root paper-button:not(.tri-disable-theme).major-warning-outline:hover {
		@apply(--tri-major-warning-outline-button-hover);
	}
	/* major-warning-outline pressed */
	:root paper-button:not(.tri-disable-theme)[major-warning-outline][pressed],
	:root paper-button:not(.tri-disable-theme).major-warning-outline[pressed] {
		@apply(--tri-major-warning-outline-button-press);
	}
	/* danger */
	:root paper-button:not(.tri-disable-theme)[danger],
	:root paper-button:not(.tri-disable-theme).danger {
		@apply(--tri-danger-button);
	}
	/* danger hover */
	:root paper-button:not(.tri-disable-theme)[danger]:hover,
	:root paper-button:not(.tri-disable-theme).danger:hover {
		@apply(--tri-danger-button-hover);
	}
	/* danger pressed */
	:root paper-button:not(.tri-disable-theme)[danger][pressed],
	:root paper-button:not(.tri-disable-theme).danger[pressed] {
		@apply(--tri-danger-button-press);
	}
	/* danger-outline */
	:root paper-button:not(.tri-disable-theme)[danger-outline],
	:root paper-button:not(.tri-disable-theme).danger-outline {
		@apply(--tri-danger-outline-button);
	}
	/* danger-outline hover */
	:root paper-button:not(.tri-disable-theme)[danger-outline]:hover,
	:root paper-button:not(.tri-disable-theme).danger-outline:hover {
		@apply(--tri-danger-outline-button-hover);
	}
	/* danger-outline pressed */
	:root paper-button:not(.tri-disable-theme)[danger-outline][pressed],
	:root paper-button:not(.tri-disable-theme).danger-outline[pressed] {
		@apply(--tri-danger-outline-button-press);
	}
	/* footer */
	:root paper-button:not(.tri-disable-theme)[footer],
	:root paper-button:not(.tri-disable-theme).footer {
		@apply(--tri-footer-button);
	}
	/* footer hover */
	:root paper-button:not(.tri-disable-theme)[footer]:hover,
	:root paper-button:not(.tri-disable-theme).footer:hover {
		@apply(--tri-footer-button-hover);
	}
	/* footer pressed */
	:root paper-button:not(.tri-disable-theme)[footer][pressed],
	:root paper-button:not(.tri-disable-theme).footer[pressed] {
		@apply(--tri-footer-button-press);
	}
	/* footer secondary */
	:root paper-button:not(.tri-disable-theme)[footer-secondary],
	:root paper-button:not(.tri-disable-theme).footer-secondary {
		@apply(--tri-footer-secondary-button);
	}
	/* footer secondary hover */
	:root paper-button:not(.tri-disable-theme)[footer-secondary]:hover,
	:root paper-button:not(.tri-disable-theme).footer-secondary:hover {
		@apply(--tri-footer-secondary-button-hover);
	}
	/* footer secondary pressed */
	:root paper-button:not(.tri-disable-theme)[footer-secondary][pressed],
	:root paper-button:not(.tri-disable-theme).footer-secondary[pressed] {
		@apply(--tri-footer-secondary-button-press);
	}
	/* footer danger */
	:root paper-button:not(.tri-disable-theme)[footer-danger],
	:root paper-button:not(.tri-disable-theme).footer-danger {
		@apply(--tri-footer-danger-button);
	}
	/* footer danger hover */
	:root paper-button:not(.tri-disable-theme)[footer-danger]:hover,
	:root paper-button:not(.tri-disable-theme).footer-danger:hover {
		@apply(--tri-footer-danger-button-hover);
	}
	/* footer danger pressed */
	:root paper-button:not(.tri-disable-theme)[footer-danger][pressed],
	:root paper-button:not(.tri-disable-theme).footer-danger[pressed] {
		@apply(--tri-footer-danger-button-press);
	}
	/* footer disabled */
	:root paper-button:not(.tri-disable-theme)[footer][disabled],
	:root paper-button:not(.tri-disable-theme)[footer-secondary][disabled],
	:root paper-button:not(.tri-disable-theme)[footer-danger][disabled],
	:root paper-button:not(.tri-disable-theme).footer[disabled],
	:root paper-button:not(.tri-disable-theme).footer-secondary[disabled],
	:root paper-button:not(.tri-disable-theme).footer-danger[disabled] {
		@apply(--tri-footer-button-disabled);
	}
	/* default disabled */
	:root paper-button:not(.tri-disable-theme)[disabled] {
		@apply(--tri-disabled-button);
	}

	/*
	 * paper-checkbox
	 */
	:root paper-checkbox:not(.tri-disable-theme) {
		font-family: var(--tri-font-family);
	}

	/*
	 * paper-icon-button
	 */
	/* primary */
	:root paper-icon-button:not(.tri-disable-theme)[primary],
	:root paper-icon-button:not(.tri-disable-theme).primary {
		color: var(--tri-primary-icon-button-color);
	}
	/* primary hover */
	:root paper-icon-button:not(.tri-disable-theme)[primary]:hover,
	:root paper-icon-button:not(.tri-disable-theme).primary:hover {
		color: var(--tri-primary-icon-button-hover-color);
	}
	/* primary press */
	:root paper-icon-button:not(.tri-disable-theme)[primary][pressed],
	:root paper-icon-button:not(.tri-disable-theme).primary[pressed] {
		color: var(--tri-primary-icon-button-press-color);
	}
	/* secondary */
	:root paper-icon-button:not(.tri-disable-theme)[secondary],
	:root paper-icon-button:not(.tri-disable-theme).secondary {
		color: var(--tri-secondary-icon-button-color);
	}
	/* secondary hover */
	:root paper-icon-button:not(.tri-disable-theme)[secondary]:hover,
	:root paper-icon-button:not(.tri-disable-theme).secondary:hover {
		color: var(--tri-secondary-icon-button-hover-color);
	}
	/* secondary press */
	:root paper-icon-button:not(.tri-disable-theme)[secondary][pressed],
	:root paper-icon-button:not(.tri-disable-theme).secondary[pressed] {
		color: var(--tri-secondary-icon-button-press-color);
	}
	/* info */
	:root paper-icon-button:not(.tri-disable-theme)[info],
	:root paper-icon-button:not(.tri-disable-theme).info {
		color: var(--tri-info-icon-button-color);
	}
	/* info hover */
	:root paper-icon-button:not(.tri-disable-theme)[info]:hover,
	:root paper-icon-button:not(.tri-disable-theme).info:hover {
		color: var(--tri-info-icon-button-hover-color);
	}
	/* info press */
	:root paper-icon-button:not(.tri-disable-theme)[info][pressed],
	:root paper-icon-button:not(.tri-disable-theme).info[pressed] {
		color: var(--tri-info-icon-button-press-color);
	}
	/* success */
	:root paper-icon-button:not(.tri-disable-theme)[success],
	:root paper-icon-button:not(.tri-disable-theme).success {
		color: var(--tri-success-icon-button-color);
	}
	/* success hover */
	:root paper-icon-button:not(.tri-disable-theme)[success]:hover,
	:root paper-icon-button:not(.tri-disable-theme).success:hover {
		color: var(--tri-success-icon-button-hover-color);
	}
	/* success press */
	:root paper-icon-button:not(.tri-disable-theme)[success][pressed],
	:root paper-icon-button:not(.tri-disable-theme).success[pressed] {
		color: var(--tri-success-icon-button-press-color);
	}
	/* warning */
	:root paper-icon-button:not(.tri-disable-theme)[warning],
	:root paper-icon-button:not(.tri-disable-theme).warning {
		color: var(--tri-warning-icon-button-color);
	}
	/* warning hover */
	:root paper-icon-button:not(.tri-disable-theme)[warning]:hover,
	:root paper-icon-button:not(.tri-disable-theme).warning:hover {
		color: var(--tri-warning-icon-button-hover-color);
	}
	/* warning press */
	:root paper-icon-button:not(.tri-disable-theme)[warning][pressed],
	:root paper-icon-button:not(.tri-disable-theme).warning[pressed] {
		color: var(--tri-warning-icon-button-press-color);
	}
	/* major-warning */
	:root paper-icon-button:not(.tri-disable-theme)[major-warning],
	:root paper-icon-button:not(.tri-disable-theme).major-warning {
		color: var(--tri-major-warning-icon-button-color);
	}
	/* major-warning hover */
	:root paper-icon-button:not(.tri-disable-theme)[major-warning]:hover,
	:root paper-icon-button:not(.tri-disable-theme).major-warning:hover {
		color: var(--tri-major-warning-icon-button-hover-color);
	}
	/* major-warning press */
	:root paper-icon-button:not(.tri-disable-theme)[major-warning][pressed],
	:root paper-icon-button:not(.tri-disable-theme).major-warning[pressed] {
		color: var(--tri-major-warning-icon-button-press-color);
	}
	/* danger */
	:root paper-icon-button:not(.tri-disable-theme)[danger],
	:root paper-icon-button:not(.tri-disable-theme).danger {
		color: var(--tri-danger-icon-button-color);
	}
	/* danger hover */
	:root paper-icon-button:not(.tri-disable-theme)[danger]:hover,
	:root paper-icon-button:not(.tri-disable-theme).danger:hover {
		color: var(--tri-danger-icon-button-hover-color);
	}
	/* danger press */
	:root paper-icon-button:not(.tri-disable-theme)[danger][pressed],
	:root paper-icon-button:not(.tri-disable-theme).danger[pressed] {
		color: var(--tri-danger-icon-button-press-color);
	}
	/* error */
	:root paper-icon-button:not(.tri-disable-theme)[error],
	:root paper-icon-button:not(.tri-disable-theme).error {
		color: var(--tri-error-icon-button-color);
	}
	/* error hover */
	:root paper-icon-button:not(.tri-disable-theme)[error]:hover,
	:root paper-icon-button:not(.tri-disable-theme).error:hover {
		color: var(--tri-error-icon-button-hover-color);
	}
	/* error press */
	:root paper-icon-button:not(.tri-disable-theme)[error][pressed],
	:root paper-icon-button:not(.tri-disable-theme).error[pressed] {
		color: var(--tri-error-icon-button-press-color);
	}
	/* footer */
	:root paper-icon-button:not(.tri-disable-theme)[footer],
	:root paper-icon-button:not(.tri-disable-theme).footer {
		color: var(--tri-footer-icon-button-color);
	}
	/* footer hover */
	:root paper-icon-button:not(.tri-disable-theme)[footer]:hover,
	:root paper-icon-button:not(.tri-disable-theme).footer:hover {
		color: var(--tri-footer-icon-button-hover-color);
	}
	/* footer press */
	:root paper-icon-button:not(.tri-disable-theme)[footer][pressed],
	:root paper-icon-button:not(.tri-disable-theme).footer[pressed] {
		color: var(--tri-footer-icon-button-press-color);
	}
	/* disabled */
	:root paper-icon-button:not(.tri-disable-theme)[disabled],
	:root paper-icon-button:not(.tri-disable-theme).disabled {
		/*opacity: var(--tri-button-disabled-opacity);*/
		color: var(--tri-disabled-icon-button-color);
	}

	/*
	 * paper-item
	 */
	:root paper-item:not(.tri-disable-theme) {
		font-family: var(--tri-font-family);
	}

	/*
	 * paper-radio-button
	 */
	:root paper-radio-button:not(.tri-disable-theme) {
		font-family: var(--tri-font-family);
	}

	/*
	 * paper-toast
	 */
	:root paper-toast:not(.tri-disable-theme) {
		font-family: var(--tri-font-family);
	}
	
	/*
	 * paper-toggle-button
	 */
	paper-toggle-button:not(.tri-disable-theme):not([disabled]) {
		cursor: pointer;
	}

	/*
	 * table
	 */
	:root div.tri-table:not(.tri-disable-theme),
	:root div[tri-table]:not(.tri-disable-theme) {
		display: table;
		background-color: var(--tri-primary-content-background-color);
		border-collapse: collapse;
		border-spacing: 0;
		color: var(--tri-primary-content-color);
		font-size: 14px;
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-thead,
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-thead] {
		display: table-header-group;
		background-color: var(--tri-primary-content-background-color);
		color: var(--tri-primary-color);
		border-bottom: 1px solid var(--tri-primary-content-accent-color);
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-thead > div.tri-tr,
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-thead] > div[tri-tr] {
		display: table-row;
		background-color: var(--tri-primary-content-background-color);
		color: var(--tri-primary-color);
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-thead div.tri-th,
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-thead] div[tri-th] {
		display: table-cell;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
		line-height: 30px;
		padding: 5px 10px 5px 0px;
		text-align: left;
		min-width: 100px;
		font-weight: bold;
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-thead div.tri-th::before,
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-thead] div[tri-th]::before {
		border-left: 1px solid var(--tri-primary-content-accent-color);
		content: "";
		font-size: 18px;
		padding-right: 10px;
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-thead div.tri-th:first-child::before,
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-thead] div[tri-th]:first-child::before {
		border-left: none !important;
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-tbody,
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-tbody] {
		display: table-row-group;
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr,
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr] {
		display: table-row;
		border-bottom: 1px solid var(--tri-primary-content-accent-color);
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr:nth-child(odd),
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr]:nth-child(odd) {
		background-color: var(--tri-body-background-color);
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr:nth-child(even),
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr]:nth-child(even) {
		background-color: var(--tri-primary-content-background-color);
	}
	:root div.tri-table[clickable-rows]:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr:hover,
	:root div[tri-table][clickable-rows]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr]:hover {
		cursor: pointer;
		background-color: var(--tri-primary-content-accent-color);
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr[selected],
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr][selected] {
		background-color: var(--tri-primary-content-accent-color) !important;
	}
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr][selected]:hover {
		background-color: var(--ibm-gray-30) !important;
	}
	:root div.tri-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr > div.tri-td,
	:root div[tri-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr] > div[tri-td] {
		display: table-cell;
		vertical-align: middle;
		height: 45px;
		padding: 10px;
		min-width: 100px;
		/*position: relative;
		overflow: hidden;
		text-overflow: ellipsis;
		-webkit-line-clamp: 2;*/
	}
	/*:root div.tri-table:not(.tri-disable-theme) > tbody > tr > td > div:after,
	:root div[tri-table]:not(.tri-disable-theme) > tbody > tr > td > div:after {
		content: '...';
		text-align: right;
		bottom: 0;
		right: 0;
		width: 25%;
		display: block;
		position: absolute;
		height: 14px;
		background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 1) 75%);
	}*/

	/*
	 * table - fixed header (requires defining your own column widths by wrapping tri-th's and tri-td's in <div>s with widths specified using --layout-flex-#)
	 */
	:root div.tri-fixed-table:not(.tri-disable-theme),
	:root div[tri-fixed-table]:not(.tri-disable-theme) {
		@apply(--layout-vertical);
		background-color: var(--tri-primary-content-background-color);
		color: var(--tri-primary-content-color);
		font-size: 14px;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-thead,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-thead] {
		@apply(--layout-vertical);
		background-color: var(--tri-primary-content-background-color);
		color: var(--tri-primary-color);
		border-bottom: 1px solid var(--tri-primary-content-accent-color);
		min-height: 0;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-thead > div.tri-tr,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-thead] > div[tri-tr] {
		@apply(--layout-horizontal);
		background-color: var(--tri-primary-content-background-color);
		color: var(--tri-primary-color);
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-thead div.tri-th,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-thead] div[tri-th] {
		@apply(--layout-horizontal);
		@apply(--layout-center);
		/*white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;*/
		line-height: 30px;
		height: 30px;
		padding: 5px 10px 5px 0px;
		text-align: left;
		min-width: 0;
		font-weight: bold;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-thead div.tri-th > span.tri-th-label,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-thead] div[tri-th] > span[tri-th-label] {
		flex-shrink: 1;
		/*white-space: nowrap;*/
		overflow: hidden;
		/*text-overflow: ellipsis;*/
		min-width: 0;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-thead > div.tri-tr > div,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-thead] > div[tri-tr] > div {
		min-width: 100px;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-thead div.tri-th::before,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-thead] div[tri-th]::before {
		border-left: 1px solid var(--tri-primary-content-accent-color);
		content: "";
		font-size: 18px;
		padding-right: 10px;
		height: 20px;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-thead > div.tri-tr > div.tri-th:first-child::before,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-thead] > div[tri-tr] > div[tri-th]:first-child::before {
		border-left: none !important;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-thead > div.tri-tr > div:first-child > div.tri-th::before,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-thead] > div[tri-tr] > div:first-child > div[tri-th]::before {
		border-left: none !important;
	}
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-tbody] {
		@apply(--layout-vertical);
		@apply(--layout-flex);
		@apply(--layout-scroll);
		min-height: 0;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr] {
		@apply(--layout-horizontal);
		border-bottom: 1px solid var(--tri-primary-content-accent-color);
		flex-shrink: 0;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr:nth-child(odd),
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr]:nth-child(odd) {
		background-color: var(--tri-body-background-color);
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr:nth-child(even),
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr]:nth-child(even) {
		background-color: var(--tri-primary-content-background-color);
	}
	:root div.tri-fixed-table[clickable-rows]:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr:hover,
	:root div[tri-fixed-table][clickable-rows]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr]:hover {
		cursor: pointer;
		background-color: var(--tri-primary-content-accent-color);
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr[selected],
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr][selected] {
		background-color: var(--tri-primary-content-accent-color) !important;
	}
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr][selected]:hover {
		background-color: var(--ibm-gray-30) !important;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr div.tri-td,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr] div[tri-td] {
		@apply(--layout-horizontal);
		@apply(--layout-center);
		height: 45px;
		padding: 10px;
	}
	:root div.tri-fixed-table:not(.tri-disable-theme) > div.tri-tbody > div.tri-tr > div,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > div[tri-tbody] > div[tri-tr] > div {
		min-width: 100px;
		overflow: hidden;
		/*position: relative;
		overflow: hidden;
		text-overflow: ellipsis;
		-webkit-line-clamp: 2;*/
	}
	/*:root div.tri-fixed-table:not(.tri-disable-theme) > tbody > tr > td > div:after,
	:root div[tri-fixed-table]:not(.tri-disable-theme) > tbody > tr > td > div:after {
		content: '...';
		text-align: right;
		bottom: 0;
		right: 0;
		width: 25%;
		display: block;
		position: absolute;
		height: 14px;
		background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 1) 75%);
	}*/

</style><dom-module id="tricore-properties" assetpath="../tricore-properties/">
	<template>
		<style>
			:host {
				display: none;
			}
		</style>
		<iron-meta id="meta" type="tri" key="sso"></iron-meta>
	</template>
</dom-module>
<script>
	Polymer({

		is: "tricore-properties",

		properties: {

			ssoSet: {
				type: Boolean,
				notify: false,
				readOnly: false,
				observer: "_initSso"
			},

			sso: {
				type: Boolean,
				notify: true,
				readOnly: true
			}

		},

		ready: function() {
			this._setSso(this.$.meta.byKey("sso"));
		},

		_initSso: function(sso) {
			this.$.meta.set("value", sso);
		}

	});
</script>


<script src="../promise-polyfill/Promise.js"></script><script>
if (!window.Promise) {
  window.Promise = MakePromise(Polymer.Base.async);
}
</script><script>
  'use strict';

  Polymer({
    is: 'iron-request',

    hostAttributes: {
      hidden: true
    },

    properties: {

      /**
       * A reference to the XMLHttpRequest instance used to generate the
       * network request.
       *
       * @type {XMLHttpRequest}
       */
      xhr: {
        type: Object,
        notify: true,
        readOnly: true,
        value: function() {
          return new XMLHttpRequest();
        }
      },

      /**
       * A reference to the parsed response body, if the `xhr` has completely
       * resolved.
       *
       * @type {*}
       * @default null
       */
      response: {
        type: Object,
        notify: true,
        readOnly: true,
        value: function() {
          return null;
        }
      },

      /**
       * A reference to the status code, if the `xhr` has completely resolved.
       */
      status: {
        type: Number,
        notify: true,
        readOnly: true,
        value: 0
      },

      /**
       * A reference to the status text, if the `xhr` has completely resolved.
       */
      statusText: {
        type: String,
        notify: true,
        readOnly: true,
        value: ''
      },

      /**
       * A promise that resolves when the `xhr` response comes back, or rejects
       * if there is an error before the `xhr` completes.
       *
       * @type {Promise}
       */
      completes: {
        type: Object,
        readOnly: true,
        notify: true,
        value: function() {
          return new Promise(function (resolve, reject) {
            this.resolveCompletes = resolve;
            this.rejectCompletes = reject;
          }.bind(this));
        }
      },

      /**
       * An object that contains progress information emitted by the XHR if
       * available.
       *
       * @default {}
       */
      progress: {
        type: Object,
        notify: true,
        readOnly: true,
        value: function() {
          return {};
        }
      },

      /**
       * Aborted will be true if an abort of the request is attempted.
       */
      aborted: {
        type: Boolean,
        notify: true,
        readOnly: true,
        value: false,
      },

      /**
       * Errored will be true if the browser fired an error event from the
       * XHR object (mainly network errors).
       */
      errored: {
        type: Boolean,
        notify: true,
        readOnly: true,
        value: false
      },

      /**
       * TimedOut will be true if the XHR threw a timeout event.
       */
      timedOut: {
        type: Boolean,
        notify: true,
        readOnly: true,
        value: false
      }
    },

    /**
     * Succeeded is true if the request succeeded. The request succeeded if it
     * loaded without error, wasn't aborted, and the status code is ≥ 200, and
     * < 300, or if the status code is 0.
     *
     * The status code 0 is accepted as a success because some schemes - e.g.
     * file:// - don't provide status codes.
     *
     * @return {boolean}
     */
    get succeeded() {
      if (this.errored || this.aborted || this.timedOut) {
        return false;
      }
      var status = this.xhr.status || 0;

      // Note: if we are using the file:// protocol, the status code will be 0
      // for all outcomes (successful or otherwise).
      return status === 0 ||
        (status >= 200 && status < 300);
    },

    /**
     * Sends an HTTP request to the server and returns the XHR object.
     *
     * The handling of the `body` parameter will vary based on the Content-Type
     * header. See the docs for iron-ajax's `body` param for details.
     *
     * @param {{
     *   url: string,
     *   method: (string|undefined),
     *   async: (boolean|undefined),
     *   body: (ArrayBuffer|ArrayBufferView|Blob|Document|FormData|null|string|undefined|Object),
     *   headers: (Object|undefined),
     *   handleAs: (string|undefined),
     *   jsonPrefix: (string|undefined),
     *   withCredentials: (boolean|undefined)}} options -
     *     url The url to which the request is sent.
     *     method The HTTP method to use, default is GET.
     *     async By default, all requests are sent asynchronously. To send synchronous requests,
     *         set to false.
     *     body The content for the request body for POST method.
     *     headers HTTP request headers.
     *     handleAs The response type. Default is 'text'.
     *     withCredentials Whether or not to send credentials on the request. Default is false.
     *   timeout: (Number|undefined)
     * @return {Promise}
     */
    send: function (options) {
      var xhr = this.xhr;

      if (xhr.readyState > 0) {
        return null;
      }

      xhr.addEventListener('progress', function (progress) {
        this._setProgress({
          lengthComputable: progress.lengthComputable,
          loaded: progress.loaded,
          total: progress.total
        });
      }.bind(this))

      xhr.addEventListener('error', function (error) {
        this._setErrored(true);
        this._updateStatus();
        this.rejectCompletes(error);
      }.bind(this));

      xhr.addEventListener('timeout', function (error) {
        this._setTimedOut(true);
        this._updateStatus();
        this.rejectCompletes(error);
      }.bind(this));

      xhr.addEventListener('abort', function () {
        this._updateStatus();
        this.rejectCompletes(new Error('Request aborted.'));
      }.bind(this));

      // Called after all of the above.
      xhr.addEventListener('loadend', function () {
        this._updateStatus();
        this._setResponse(this.parseResponse());

        if (!this.succeeded) {
          this.rejectCompletes(new Error('The request failed with status code: ' + this.xhr.status));
          return;
        }

        this.resolveCompletes(this);
      }.bind(this));

      this.url = options.url;
      xhr.open(
        options.method || 'GET',
        options.url,
        options.async !== false
      );

      var acceptType = {
        'json': 'application/json',
        'text': 'text/plain',
        'html': 'text/html',
        'xml': 'application/xml',
        'arraybuffer': 'application/octet-stream'
      }[options.handleAs];
      var headers = options.headers || Object.create(null);
      var newHeaders = Object.create(null);
      for (var key in headers) {
        newHeaders[key.toLowerCase()] = headers[key];
      }
      headers = newHeaders;

      if (acceptType && !headers['accept']) {
        headers['accept'] = acceptType;
      }
      Object.keys(headers).forEach(function (requestHeader) {
        if (/[A-Z]/.test(requestHeader)) {
          Polymer.Base._error('Headers must be lower case, got', requestHeader);
        }
        xhr.setRequestHeader(
          requestHeader,
          headers[requestHeader]
        );
      }, this);

      if (options.async !== false) {
        if (options.async) {
          xhr.timeout = options.timeout;
        }

        var handleAs = options.handleAs;

        // If a JSON prefix is present, the responseType must be 'text' or the
        // browser won’t be able to parse the response.
        if (!!options.jsonPrefix || !handleAs) {
          handleAs = 'text';
        }

        // In IE, `xhr.responseType` is an empty string when the response
        // returns. Hence, caching it as `xhr._responseType`.
        xhr.responseType = xhr._responseType = handleAs;

        // Cache the JSON prefix, if it exists.
        if (!!options.jsonPrefix) {
          xhr._jsonPrefix = options.jsonPrefix;
        }
      }

      xhr.withCredentials = !!options.withCredentials;


      var body = this._encodeBodyObject(options.body, headers['content-type']);

      xhr.send(
        /** @type {ArrayBuffer|ArrayBufferView|Blob|Document|FormData|
                   null|string|undefined} */
        (body));

      return this.completes;
    },

    /**
     * Attempts to parse the response body of the XHR. If parsing succeeds,
     * the value returned will be deserialized based on the `responseType`
     * set on the XHR.
     *
     * @return {*} The parsed response,
     * or undefined if there was an empty response or parsing failed.
     */
    parseResponse: function () {
      var xhr = this.xhr;
      var responseType = xhr.responseType || xhr._responseType;
      var preferResponseText = !this.xhr.responseType;
      var prefixLen = (xhr._jsonPrefix && xhr._jsonPrefix.length) || 0;

      try {
        switch (responseType) {
          case 'json':
            // If the xhr object doesn't have a natural `xhr.responseType`,
            // we can assume that the browser hasn't parsed the response for us,
            // and so parsing is our responsibility. Likewise if response is
            // undefined, as there's no way to encode undefined in JSON.
            if (preferResponseText || xhr.response === undefined) {
              // Try to emulate the JSON section of the response body section of
              // the spec: https://xhr.spec.whatwg.org/#response-body
              // That is to say, we try to parse as JSON, but if anything goes
              // wrong return null.
              try {
                return JSON.parse(xhr.responseText);
              } catch (_) {
                return null;
              }
            }

            return xhr.response;
          case 'xml':
            return xhr.responseXML;
          case 'blob':
          case 'document':
          case 'arraybuffer':
            return xhr.response;
          case 'text':
          default: {
            // If `prefixLen` is set, it implies the response should be parsed
            // as JSON once the prefix of length `prefixLen` is stripped from
            // it. Emulate the behavior above where null is returned on failure
            // to parse.
            if (prefixLen) {
              try {
                return JSON.parse(xhr.responseText.substring(prefixLen));
              } catch (_) {
                return null;
              }
            }
            return xhr.responseText;
          }
        }
      } catch (e) {
        this.rejectCompletes(new Error('Could not parse response. ' + e.message));
      }
    },

    /**
     * Aborts the request.
     */
    abort: function () {
      this._setAborted(true);
      this.xhr.abort();
    },

    /**
     * @param {*} body The given body of the request to try and encode.
     * @param {?string} contentType The given content type, to infer an encoding
     *     from.
     * @return {*} Either the encoded body as a string, if successful,
     *     or the unaltered body object if no encoding could be inferred.
     */
    _encodeBodyObject: function(body, contentType) {
      if (typeof body == 'string') {
        return body;  // Already encoded.
      }
      var bodyObj = /** @type {Object} */ (body);
      switch(contentType) {
        case('application/json'):
          return JSON.stringify(bodyObj);
        case('application/x-www-form-urlencoded'):
          return this._wwwFormUrlEncode(bodyObj);
      }
      return body;
    },

    /**
     * @param {Object} object The object to encode as x-www-form-urlencoded.
     * @return {string} .
     */
    _wwwFormUrlEncode: function(object) {
      if (!object) {
        return '';
      }
      var pieces = [];
      Object.keys(object).forEach(function(key) {
        // TODO(rictic): handle array values here, in a consistent way with
        //   iron-ajax params.
        pieces.push(
            this._wwwFormUrlEncodePiece(key) + '=' +
            this._wwwFormUrlEncodePiece(object[key]));
      }, this);
      return pieces.join('&');
    },

    /**
     * @param {*} str A key or value to encode as x-www-form-urlencoded.
     * @return {string} .
     */
    _wwwFormUrlEncodePiece: function(str) {
      // Spec says to normalize newlines to \r\n and replace %20 spaces with +.
      // jQuery does this as well, so this is likely to be widely compatible.
      if (str === null) {
        return '';
      }
      return encodeURIComponent(str.toString().replace(/\r?\n/g, '\r\n'))
          .replace(/%20/g, '+');
    },

    /**
     * Updates the status code and status text.
     */
    _updateStatus: function() {
      this._setStatus(this.xhr.status);
      this._setStatusText((this.xhr.statusText === undefined) ? '' : this.xhr.statusText);
    }
  });
</script><script>
  'use strict';

  Polymer({

    is: 'iron-ajax',

    /**
     * Fired when a request is sent.
     *
     * @event request
     * @event iron-ajax-request
     */

    /**
     * Fired when a response is received.
     *
     * @event response
     * @event iron-ajax-response
     */

    /**
     * Fired when an error is received.
     *
     * @event error
     * @event iron-ajax-error
     */

    hostAttributes: {
      hidden: true
    },

    properties: {
      /**
       * The URL target of the request.
       */
      url: {
        type: String
      },

      /**
       * An object that contains query parameters to be appended to the
       * specified `url` when generating a request. If you wish to set the body
       * content when making a POST request, you should use the `body` property
       * instead.
       */
      params: {
        type: Object,
        value: function() {
          return {};
        }
      },

      /**
       * The HTTP method to use such as 'GET', 'POST', 'PUT', or 'DELETE'.
       * Default is 'GET'.
       */
      method: {
        type: String,
        value: 'GET'
      },

      /**
       * HTTP request headers to send.
       *
       * Example:
       *
       *     <iron-ajax
       *         auto
       *         url="http://somesite.com"
       *         headers='{"X-Requested-With": "XMLHttpRequest"}'
       *         handle-as="json"></iron-ajax>
       *
       * Note: setting a `Content-Type` header here will override the value
       * specified by the `contentType` property of this element.
       */
      headers: {
        type: Object,
        value: function() {
          return {};
        }
      },

      /**
       * Content type to use when sending data. If the `contentType` property
       * is set and a `Content-Type` header is specified in the `headers`
       * property, the `headers` property value will take precedence.
       *
       * Varies the handling of the `body` param.
       */
      contentType: {
        type: String,
        value: null
      },

      /**
       * Body content to send with the request, typically used with "POST"
       * requests.
       *
       * If body is a string it will be sent unmodified.
       *
       * If Content-Type is set to a value listed below, then
       * the body will be encoded accordingly.
       *
       *    * `content-type="application/json"`
       *      * body is encoded like `{"foo":"bar baz","x":1}`
       *    * `content-type="application/x-www-form-urlencoded"`
       *      * body is encoded like `foo=bar+baz&x=1`
       *
       * Otherwise the body will be passed to the browser unmodified, and it
       * will handle any encoding (e.g. for FormData, Blob, ArrayBuffer).
       *
       * @type (ArrayBuffer|ArrayBufferView|Blob|Document|FormData|null|string|undefined|Object)
       */
      body: {
        type: Object,
        value: null
      },

      /**
       * Toggle whether XHR is synchronous or asynchronous. Don't change this
       * to true unless You Know What You Are Doing™.
       */
      sync: {
        type: Boolean,
        value: false
      },

      /**
       * Specifies what data to store in the `response` property, and
       * to deliver as `event.detail.response` in `response` events.
       *
       * One of:
       *
       *    `text`: uses `XHR.responseText`.
       *
       *    `xml`: uses `XHR.responseXML`.
       *
       *    `json`: uses `XHR.responseText` parsed as JSON.
       *
       *    `arraybuffer`: uses `XHR.response`.
       *
       *    `blob`: uses `XHR.response`.
       *
       *    `document`: uses `XHR.response`.
       */
      handleAs: {
        type: String,
        value: 'json'
      },

      /**
       * Set the withCredentials flag on the request.
       */
      withCredentials: {
        type: Boolean,
        value: false
      },

      /**
       * Set the timeout flag on the request.
       */
      timeout: {
        type: Number,
        value: 0
      },

      /**
       * If true, automatically performs an Ajax request when either `url` or
       * `params` changes.
       */
      auto: {
        type: Boolean,
        value: false
      },

      /**
       * If true, error messages will automatically be logged to the console.
       */
      verbose: {
        type: Boolean,
        value: false
      },

      /**
       * The most recent request made by this iron-ajax element.
       */
      lastRequest: {
        type: Object,
        notify: true,
        readOnly: true
      },

      /**
       * True while lastRequest is in flight.
       */
      loading: {
        type: Boolean,
        notify: true,
        readOnly: true
      },

      /**
       * lastRequest's response.
       *
       * Note that lastResponse and lastError are set when lastRequest finishes,
       * so if loading is true, then lastResponse and lastError will correspond
       * to the result of the previous request.
       *
       * The type of the response is determined by the value of `handleAs` at
       * the time that the request was generated.
       *
       * @type {Object}
       */
      lastResponse: {
        type: Object,
        notify: true,
        readOnly: true
      },

      /**
       * lastRequest's error, if any.
       *
       * @type {Object}
       */
      lastError: {
        type: Object,
        notify: true,
        readOnly: true
      },

      /**
       * An Array of all in-flight requests originating from this iron-ajax
       * element.
       */
      activeRequests: {
        type: Array,
        notify: true,
        readOnly: true,
        value: function() {
          return [];
        }
      },

      /**
       * Length of time in milliseconds to debounce multiple automatically generated requests.
       */
      debounceDuration: {
        type: Number,
        value: 0,
        notify: true
      },

      /**
       * Prefix to be stripped from a JSON response before parsing it.
       *
       * In order to prevent an attack using CSRF with Array responses
       * (http://haacked.com/archive/2008/11/20/anatomy-of-a-subtle-json-vulnerability.aspx/)
       * many backends will mitigate this by prefixing all JSON response bodies
       * with a string that would be nonsensical to a JavaScript parser.
       *
       */
      jsonPrefix: {
        type: String,
        value: ''
      },

      /**
       * By default, iron-ajax's events do not bubble. Setting this attribute will cause its
       * request and response events as well as its iron-ajax-request, -response,  and -error
       * events to bubble to the window object. The vanilla error event never bubbles when
       * using shadow dom even if this.bubbles is true because a scoped flag is not passed with
       * it (first link) and because the shadow dom spec did not used to allow certain events,
       * including events named error, to leak outside of shadow trees (second link).
       * https://www.w3.org/TR/shadow-dom/#scoped-flag
       * https://www.w3.org/TR/2015/WD-shadow-dom-20151215/#events-that-are-not-leaked-into-ancestor-trees
       */
      bubbles: {
        type: Boolean,
        value: false
      },

      _boundHandleResponse: {
        type: Function,
        value: function() {
          return this._handleResponse.bind(this);
        }
      }
    },

    observers: [
      '_requestOptionsChanged(url, method, params.*, headers, contentType, ' +
          'body, sync, handleAs, jsonPrefix, withCredentials, timeout, auto)'
    ],

    /**
     * The query string that should be appended to the `url`, serialized from
     * the current value of `params`.
     *
     * @return {string}
     */
    get queryString () {
      var queryParts = [];
      var param;
      var value;

      for (param in this.params) {
        value = this.params[param];
        param = window.encodeURIComponent(param);

        if (Array.isArray(value)) {
          for (var i = 0; i < value.length; i++) {
            queryParts.push(param + '=' + window.encodeURIComponent(value[i]));
          }
        } else if (value !== null) {
          queryParts.push(param + '=' + window.encodeURIComponent(value));
        } else {
          queryParts.push(param);
        }
      }

      return queryParts.join('&');
    },

    /**
     * The `url` with query string (if `params` are specified), suitable for
     * providing to an `iron-request` instance.
     *
     * @return {string}
     */
    get requestUrl() {
      var queryString = this.queryString;
      var url = this.url || '';

      if (queryString) {
        var bindingChar = url.indexOf('?') >= 0 ? '&' : '?';
        return url + bindingChar + queryString;
      }

      return url;
    },

    /**
     * An object that maps header names to header values, first applying the
     * the value of `Content-Type` and then overlaying the headers specified
     * in the `headers` property.
     *
     * @return {Object}
     */
    get requestHeaders() {
      var headers = {};
      var contentType = this.contentType;
      if (contentType == null && (typeof this.body === 'string')) {
        contentType = 'application/x-www-form-urlencoded';
      }
      if (contentType) {
        headers['content-type'] = contentType;
      }
      var header;

      if (this.headers instanceof Object) {
        for (header in this.headers) {
          headers[header] = this.headers[header].toString();
        }
      }

      return headers;
    },

    /**
     * Request options suitable for generating an `iron-request` instance based
     * on the current state of the `iron-ajax` instance's properties.
     *
     * @return {{
     *   url: string,
     *   method: (string|undefined),
     *   async: (boolean|undefined),
     *   body: (ArrayBuffer|ArrayBufferView|Blob|Document|FormData|null|string|undefined|Object),
     *   headers: (Object|undefined),
     *   handleAs: (string|undefined),
     *   jsonPrefix: (string|undefined),
     *   withCredentials: (boolean|undefined)}}
     */
    toRequestOptions: function() {
      return {
        url: this.requestUrl || '',
        method: this.method,
        headers: this.requestHeaders,
        body: this.body,
        async: !this.sync,
        handleAs: this.handleAs,
        jsonPrefix: this.jsonPrefix,
        withCredentials: this.withCredentials,
        timeout: this.timeout
      };
    },

    /**
     * Performs an AJAX request to the specified URL.
     *
     * @return {!IronRequestElement}
     */
    generateRequest: function() {
      var request = /** @type {!IronRequestElement} */ (document.createElement('iron-request'));
      var requestOptions = this.toRequestOptions();

      this.push('activeRequests', request);

      request.completes.then(
        this._boundHandleResponse
      ).catch(
        this._handleError.bind(this, request)
      ).then(
        this._discardRequest.bind(this, request)
      );

      request.send(requestOptions);

      this._setLastRequest(request);
      this._setLoading(true);

      this.fire('request', {
        request: request,
        options: requestOptions
      }, {bubbles: this.bubbles});

      this.fire('iron-ajax-request', {
        request: request,
        options: requestOptions
      }, {bubbles: this.bubbles});

      return request;
    },

    _handleResponse: function(request) {
      if (request === this.lastRequest) {
        this._setLastResponse(request.response);
        this._setLastError(null);
        this._setLoading(false);
      }
      this.fire('response', request, {bubbles: this.bubbles});
      this.fire('iron-ajax-response', request, {bubbles: this.bubbles});
    },

    _handleError: function(request, error) {
      if (this.verbose) {
        Polymer.Base._error(error);
      }

      if (request === this.lastRequest) {
        this._setLastError({
          request: request,
          error: error,
          status: request.xhr.status,
          statusText: request.xhr.statusText,
          response: request.xhr.response
        });
        this._setLastResponse(null);
        this._setLoading(false);
      }

      // Tests fail if this goes after the normal this.fire('error', ...)
      this.fire('iron-ajax-error', {
        request: request,
        error: error
      }, {bubbles: this.bubbles});

      this.fire('error', {
        request: request,
        error: error
      }, {bubbles: this.bubbles});
    },

    _discardRequest: function(request) {
      var requestIndex = this.activeRequests.indexOf(request);

      if (requestIndex > -1) {
        this.splice('activeRequests', requestIndex, 1);
      }
    },

    _requestOptionsChanged: function() {
      this.debounce('generate-request', function() {
        if (this.url == null) {
          return;
        }

        if (this.auto) {
          this.generateRequest();
        }
      }, this.debounceDuration);
    },

  });
</script><script>
	Polymer.TriplatWebContextIdBehavior = {

		properties:  {

			_webContextIdPromise: {
				type: Object,
				notify: false,
				readOnly: true,
				value: new Promise(function(resolve) {
					var url = document.createElement("tricore-url");
					var ajax = document.createElement("iron-ajax");
					ajax.url = url.getUrl("/p/webapi/noop");
					ajax.addEventListener("response", function(e) {
						resolve(e.detail.xhr.getResponseHeader("triWebContextId"));
					});
					ajax.generateRequest();
				})
			}

		},

		listeners: {
			"triplat-ds-web-context-id-search": "_onSearch"
		},

		attached: function() {
			this._beforeunloadHandler = this._endContext.bind(this);
			window.addEventListener("beforeunload", this._beforeunloadHandler);
		},

		detached: function() {
			if (this._beforeunloadHandler) {
				window.removeEventListener("beforeunload", this._beforeunloadHandler);
			}
			this._endContext();
		},

		getWebContextId: function() {
			return this._webContextIdPromise;	
		},

		_endContext: function(e) {
			if (this.unsaveCheckBeforeUnload) {
				var confirmationMessage = this.unsaveCheckBeforeUnload();
				if (confirmationMessage !== "") {
					e.returnValue = confirmationMessage;
					return confirmationMessage;
				}
			}
			this.getWebContextId().then(function(webContextId) {
				var url = document.createElement("tricore-url");
				var ajax = document.createElement("iron-ajax");
				ajax.url = url.getUrl("/p/webapi/end");
				ajax.headers = {"triWebContextId": webContextId};
				ajax.generateRequest();
			});
		},

		_onSearch: function(e) {
			e.stopPropagation();
			var childEl = e.detail.sourceElement;
			this.fire("triplat-ds-web-context-id-parent-found", this, {
				bubbles: false,
				node: childEl
			});
		}

	};
</script>


<script>
	Polymer.TriplatDsChangeBehavior = {

		listeners: {
			"triplat-ds-request-change-notification": "_onTriplatDsRequestChangeNotification"
		},

		created: function() {
			this._parentDsChange = null;
			this._interestedDescendants = [];
		},

		attached: function() {
			this.fire("triplat-ds-request-change-notification", null, {
				node: this,
				bubbles: true,
				cancelable: true
			});
		},

		detached: function() {
			if (this._parentDsChange) {
				this._parentDsChange.stopResizeNotificationsFor(this);
			}
		},

		notifyDsInfoChanged: function(dsInfo) {
			this._interestedDescendants.forEach(function(interestedDescendant) {
				interestedDescendant.notifyDsInfoChanged(dsInfo);
			});

			this.fire("triplat-ds-change", dsInfo, {
				node: this,
				bubbles: false
			});
		},

		assignParentDsChange: function(parentDsChange) {
			this._parentDsChange = parentDsChange;
		},

		stopResizeNotificationsFor: function(target) {
			var index = this._interestedDescendants.indexOf(target);

			if (index > -1) {
				this._interestedDescendants.splice(index, 1);
			}
		},

		_onTriplatDsRequestChangeNotification: function(event) {
			var target = event.path ? event.path[0] : event.target;

			if (target === this) {
				return;
			}

			if (this._interestedDescendants.indexOf(target) === -1) {
				this._interestedDescendants.push(target);
			}

			target.assignParentDsChange(this);

			event.stopPropagation();
		}

	};
</script><script>
	/**
	 *	A behavior to support query pagination. 
	 *
	 *	@polymerBehavior Polymer.TriplatQueryPageBehavior
	 *
	 */
	Polymer.TriplatQueryPageBehaviorImpl = {


		/**
	     * Fired when the page changes.
	     *
	     * @event triplat-query-page-change
	     */

		properties: {

			from: {
				type: Number,
				notify: true,
				readOnly: false
			},

			size: {
				type: Number,
				notify: false,
				readOnly: false
			},

			page: {
				type: Object,
				notify: true,
				readOnly: true,
				observer: "_pageChanged"
			}

		},

		observers: [
			"_init(from, size)"
		],

		_init: function(from, size) {
			this._setPage({from: from, size: size});
		},

		_pageChanged: function(page) {
			this.fire("triplat-query-page-change", page);
		},

		reset: function() {

		}

	};

	/**
	 * @polymerBehavior
	 */
	Polymer.TriplatQueryPageBehavior = [
		Polymer.TriplatQueryPageBehaviorImpl,
		Polymer.TriplatDsChangeBehavior
	];
</script><script>
	Polymer({

		is: "triplat-query-page",

		behaviors: [
			Polymer.TriplatQueryPageBehavior
		],

		properties: {

			/**
			 * The number of the current page retrieved from the server. The methods reset, prev, and next can be used to change this.
			 */
			currentPage: {
				type: Number,
				notify: true,
				readOnly: false,
				value: 1
			},

			/**
			 * The total number of pages available from the server.
			 */
			totalPages: {
				type: Number,
				notify: true,
				readOnly: true
			},

			/**
			  * The total number of records available from the server.
			  */ 
			totalSize: {
				type: Number,
				notify: true,
				readOnly: true
			},

			/**
			 * The number of records that you want to represent a page.
			 */
			size: {
				type: Number
			}

		},

		observers: [
			"_totalSizeChanged(totalSize, size)",
			"_currentPageChanged(currentPage, size)"
		],

		listeners: {
			"triplat-ds-change": "_dsChanged"
		},

		_totalSizeChanged: function(totalSize, size) {
			this._setTotalPages(Math.max(Math.ceil(totalSize / size), 1));
		},

		_currentPageChanged: function(currentPage, size) {
			if (this._ignoreCurrentPageChanged) {
				return;
			}

			if (currentPage < 1) {
				this.set("currentPage", 1);
				return;
			}
			
			if (this.totalPages != undefined && this.totalPages != null && currentPage > this.totalPages) {
				this.set("currentPage", this.totalPages);
				return;
			}

			this.set("from", (currentPage - 1) * size);
		},

		_dsChanged: function(e) {
			this._setTotalSize(e.detail.totalSize);
		},

		/**
		 * Resets the current page to one.
		 */
		reset: function() {
			this.set("currentPage", 1);
		},

		/**
		 * Retrieves the next page of records.
		 */
		next: function() {
			this.set("currentPage", this.currentPage + 1);
		},

		/**
		 * Retrieves the previous page of records.
		 */
		prev: function() {
			this.set("currentPage", this.currentPage - 1);
		}

	});
</script><script>
	Polymer({

		is: "triplat-query-scroll-page",

		properties: {

			/**
			 * This element contains the data items on the page, whose scroll event is responsible for triggering this pagination request.
			 */
			scroller: {
				type: Object,
				notify: false,
				readOnly: false,
				observer: "_initScroller"
			},

			/**
			  * The number of pixels from the current scroll position to the bottom of the scroller that will trigger a pagination request. 
			  */ 
			threshold: {
				type: Number,
				notify: false,
				readOnly: false,
				value: 250
			},

			/**
			  * The total number of records that have been retrieved from the server.
			  */ 
			dataSize: {
				type: Number,
				notify: true,
				readOnly: true
			},

			/**
			  * The total number of records available from the server.
			  */ 
			totalSize: {
				type: Number,
				notify: true,
				readOnly: true
			},

			/**
			 * The number of records that you want to represent a page.
			 */
			size: {
				type: Number
			},
            
            /**
             * By default, the triplat-query-scroll-page will listen to dom-change events from 
             * the scroller container. When a dom-change from a dom-repeat occurs, it will check if the 
             * currently retrieved records activated the scrollbar on the scroller container. 
             * If there is no scrollbar yet and there are more records to be retrieved, the 
             * triplat-query-scroll-page will trigger the triplat-ds to fetch more records until the 
             * scrollbar is activated on the scroller or all records have been retrieved.
             * This logic prevents the scenario where the first page of records are retrieved and there are more 
             * records to be retrieved, but the scroller container does not have a scrollbar to trigger 
             * the retrieval of remaining records.
             * If <b>disableAutoFetch</b> is true it will disable this auto-fetch logic.
             */
			disableAutoFetch: {
                type: Boolean,
                value: false
            },
            
            /**
			 * Deprecated. Use the <b>disableAutoFetch</b> property instead.
			 */
            acceptModernSearch: {
                type: Boolean,
                value: false
            },

            /**
             * If true, the <b>triplat-query-scroll-page</b> will react to the movement of scroller's horizontal 
             * scrollbar. Otherwise, it will react to the movement of scroller's vertical scrollbar.
             */
            horizontalScroll: {
				type: Boolean,
				value: false
			}
		},

		behaviors: [
			Polymer.TriplatQueryPageBehavior
		],

		listeners: {
			"triplat-ds-change": "_onDsChanged"
		},

		/**
		 * Sets the scroller to null.
		 */
		detached: function() {
			this.set("scroller", null);
		},

		_initScroller: function(newScroller, oldScroller) {
			if (oldScroller) {
				this.unlisten(oldScroller, "scroll", "_onScroll");
			}
			if (newScroller) {
				if (this._isAutoFetchEnabled()) {
					this.listen(newScroller, "dom-change", "_scrollerDataPopulationComplete");
				}
				this.set("from", 0); // TODO this might cause problems if the scroller is switched
				this.listen(newScroller, "scroll", "_onScroll");
			}
		},

		_onScroll: function(e) {
			if (this._disable) {
				return;
			}

			if (this.horizontalScroll) {
				var initial = this.scroller.scrollLeft;
				var opposite = initial + this.scroller.offsetWidth;
				var size = this.scroller.scrollWidth;
			} else {
				var initial = this.scroller.scrollTop;
				var opposite = initial + this.scroller.offsetHeight;
				var size = this.scroller.scrollHeight;
			}

			if ((size - opposite) < this.threshold) {
				this._nextPage();
			}
		},

		_onDsChanged: function(e) {
			this._disable = false;
			this._setTotalSize(e.detail.totalSize);
			this._setDataSize(e.detail.size);
			if (this.scroller && this._isAutoFetchEnabled()) {
				this.listen(this.scroller, "dom-change", "_scrollerDataPopulationComplete");
			}
		},

		/**
		 * Sets the 'from' to zero.
		 */
		reset: function() {
			this.set("from", 0);
		},

		_scrollerDataPopulationComplete: function(event) {
			if (event.target != null &&  event.target.is !== undefined && event.target.is == "dom-repeat") {
				var canScroll = true;
				Polymer.dom(this.scroller).flush();
				if (this.horizontalScroll) {
					if (this.scroller &&
						this.scroller.clientWidth > 0 &&
						this.scroller.scrollWidth > 0 &&
						this.scroller.scrollWidth <= this.scroller.clientWidth) {
						canScroll = false;
					}
				} else {
					if (this.scroller &&
						this.scroller.clientHeight > 0 &&
						this.scroller.scrollHeight > 0 &&
						this.scroller.scrollHeight <= this.scroller.clientHeight) {
						canScroll = false;
					}
				}

				if (canScroll) {
					this.unlisten(this.scroller, "dom-change", "_scrollerDataPopulationComplete");
				} else {
					this._nextPage();
				}
			}
		},

		_nextPage: function() {
			this._disable = true;
			if (this.totalSize != null && this.dataSize != null && this.dataSize < this.totalSize) {
				this.set("from", this.from + this.size);
			}
		},

		_isAutoFetchEnabled: function() {
			return !this.disableAutoFetch && !this.acceptModernSearch;
		}

	});
</script><script>
	Polymer({

		is: "triplat-query-sort",

		/**
	     * Fired when the sort changes.
	     *
	     * @event triplat-query-sort-changed
	     */

		properties: {

			/**
			 * The name of the data source field to be used for this sort.
			 */
			name: {
				type: String,
				notify: false,
				readOnly: false
			},

			/**
			 * If specified, the sort order will be descending. Otherwise it will be ascending.
			 */
			desc: {
				type: Boolean,
				notify: false,
				readOnly: false,
				value: false
			},

			/**
			 * If specified, the client query will attempt to convert the operands to the specified type before applying the filter.
			 * The supported types are:
			 *  - DATE
			 *  - DATE_TIME
			 *  - STRING_WITH_ID
			 */
			type: {
				type: String,
				value: ""
			},

			/** 
			 * A representation of 'name' and 'desc' in a single object. 
			 */
			sort: {
				type: Object,
				notify: true,
				readOnly: true,
				observer: "_sortChanged"
			}

		},

		observers: [
			"_initBoth(name, desc, type)"
		],

		_initBoth: function(name, desc, type) {
			this._setSort({name: name, desc: desc, type: type});
		},

		_sortChanged: function(sort) {
			this.fire("triplat-query-sort-changed", sort);
		}

	});
</script><script>
	Polymer({

		is: "triplat-query-resource-calendar",

		/**
	     * Fired after the availability object changes.
	     *
	     * @event triplat-query-resource-calendar-changed
	     */

		properties: {

			/**
			 * The start date for the range that you want to search. This must be in ISO format.  
			 */
			startDate: {
				type: String,
				observer: "_startDateChanged",
				required: true
			},

			/**
			 * The end date for the range that you want to search. This must be in ISO format.
			 */
			endDate: {
				type: String,
				observer: "_endDateChanged",
				required: true
			},

			/**
			  * The resource identifier of the calendar you want to query. If not specified, then the context-id will be used.
			  */ 
			id: {
				type: Number,
				observer: "_idChanged"
			},

			/**
			  * The calendar set name that you want to be used. If not specified, then the calendar set name specified in the 
			  * Query Name field of that data source model will be used.
			  */ 
			name: {
				type: String,
				observer: "_nameChanged"
			},

			/** 
			 * A representation of 'startDate', 'endDate' , 'id' and 'name' in a single object. 
			 */
			availability: {
				type: Object,
				notify: true,
				readOnly: true,
				observer: "_availabilityChanged"
			}


		},

		observers: [
			"_initAll(startDate, endDate, id, name)"
		],

		_initAll: function(startDate, endDate, id, name) {
			this._setAvailability({startDate: startDate, endDate: endDate, id: id, name: name});
		},

		_availabilityChanged: function(availability) {
			this.debounce("availabilityChanged",  function() {
				this.fire("triplat-query-resource-calendar-changed", availability);
			});
		},

		_startDateChanged: function(e) {
			this._setAvailability({startDate: this.startDate, endDate: this.endDate, id: this.id, name: this.name});
		},

		_endDateChanged: function(e) {
			this._setAvailability({startDate: this.startDate, endDate: this.endDate, id: this.id, name: this.name});
		},

		_idChanged: function(e) {
			this._setAvailability({startDate: this.startDate, endDate: this.endDate, id: this.id, name: this.name});
		},

		_nameChanged: function(e) {
			this._setAvailability({startDate: this.startDate, endDate: this.endDate, id: this.id, name: this.name});
		}


	});
</script><script>
	Polymer({

		is: "triplat-query-filter",

		/**
	     * Fired when the filter changes.
	     *
	     * @event triplat-query-filter-change
	     */

		properties: {

			/**
			 * The name of the data source field to be used for this filter.
			 */ 
			name: {
				type: String,
				notify: false,
				readOnly: false
			},
			
			/**
			 * The operator to be used for this comparison. The list of supported values for operator can be found on the triplat-query documentation page.
			 */
			operator: {
				type: String,
				notify: false,
				readOnly: false
			},

			/**
			 * The value to which the field will be evaluated. 
			 */
			value: {
				type: Object,
				notify: false,
				readOnly: false
			},

			/**
			 * If specified and when the value is empty, this entire filter will be ignored.
			 */
			ignoreIfBlank: {
				type: Boolean,
				notify: false,
				readOnly: false,
				value: false
			},

			/**
			 * If specified, then this filter will be required.
			 */
			required: {
				type: Boolean,
				notify: false,
				readOnly: false,
				value: false
			},

			/**
			 * An internal representation of the filter.
			 */
			filter: {
				type: Object,
				notify: true,
				readOnly: true,
				observer: "_filterChanged"
			},

			/**
			 * If specified, the client query will attempt to convert the operands to the specified type before applying the filter.
			 * The supported types are:
			 *  - DATE
			 *  - DATE_TIME
			 *  - STRING_WITH_ID
			 */
			type: {
				type: String,
				value: ""
			}

		},

		observers: [
			"_init(name, operator, value, ignoreIfBlank, type)"
		],

		_init: function(name, operator, value, ignoreIfBlank, type) {
			this._setFilter({name: name, operator: operator, value: value, ignoreIfBlank: ignoreIfBlank, type: type});
		},

		_filterChanged: function(filter) {
			this.fire("triplat-query-filter-change", filter);
		}

	});
</script><dom-module id="triplat-query" assetpath="../triplat-query/">
	<style>
		:host {
			display: none;
		}
	</style>
	<template>
		<content></content>
	</template>
</dom-module>
<script>

	TriplatQuery = {

		getFieldValueByName: function(record, fieldName) {
			var fieldNameParts = fieldName.split(".");
			var currentValue = record;
			for (var i = 0; i < fieldNameParts.length; i++) {
				if (currentValue == null || currentValue == undefined) {
					return null;
				}
				var fieldNamePart = fieldNameParts[i];
				currentValue = currentValue[fieldNamePart];
			}
			return currentValue;
		},

		castValue: function(value, type) {
			var result = value;
			if (type !== undefined && type != null && value !== undefined && value != null) {
				switch (type) {
					case "DATE":
				        var date = new Date(value.substring(0,10));
				        if (!isNaN(date)) {
				        	result = date.getTime();
				        }
				        break;
				    case "DATE_TIME":
				        var dateTime = new Date(value);
				        if (!isNaN(dateTime)) {
				        	result = dateTime.getTime();
				        }
				        break;
				    case "STRING_WITH_ID":
				        result = typeof value === 'object' ? value.value : value;
				        break;
				}
			}	
			return result;
		}

	};

	TriplatQuery.FilterToken = function() {
		this.leaf = true;
		this.precedence = 4;
	};
	TriplatQuery.FilterToken.prototype.execute = function(record) {
		console.warn("woops, token needs implementing");
	};


	TriplatQuery.RecordValue = function(fieldName) {
		TriplatQuery.FilterToken.call(this);
		this.fieldName = fieldName;
	};
	TriplatQuery.RecordValue.prototype = Object.create(TriplatQuery.FilterToken.prototype);
	TriplatQuery.RecordValue.constructor = TriplatQuery.RecordValue;
	TriplatQuery.RecordValue.prototype.execute = function(record, type) {
		var value = TriplatQuery.getFieldValueByName(record, this.fieldName);
		return TriplatQuery.castValue(value, type);
	};


	TriplatQuery.LiteralValue = function(value) {
		TriplatQuery.FilterToken.call(this);
		this.value = value;
	};
	TriplatQuery.LiteralValue.prototype = Object.create(TriplatQuery.FilterToken.prototype);
	TriplatQuery.LiteralValue.constructor = TriplatQuery.LiteralValue;
	TriplatQuery.LiteralValue.prototype.execute = function(record, type) {
		return TriplatQuery.castValue(this.value, type);
	};


	TriplatQuery.Operator = function() {
		TriplatQuery.FilterToken.call(this);
		this.leaf = false;
		this.precedence = 3;
	};
	TriplatQuery.Operator.prototype = Object.create(TriplatQuery.FilterToken.prototype);
	TriplatQuery.Operator.constructor = TriplatQuery.Operator;
	TriplatQuery.Operator.prototype.execute = function(record) {
		console.warn("woops, operator needs implementing");
	};


	TriplatQuery.OrOperator = function() {
		TriplatQuery.Operator.call(this);
		this.precedence = 1;
	};
	TriplatQuery.OrOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.OrOperator.constructor = TriplatQuery.OrOperator;
	TriplatQuery.OrOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record);
		if (leftSideValue == null) { 
			return false; // we want to ignore the filter, so when the parent is an OR, that means treating the filter as FALSE
		}
		if (leftSideValue == true) {
			return true;
		}
		var rightSideValue = this.rightSideOperator.execute(record);
		if (rightSideValue == null) { 
			return false; // we want to ignore the filter, so when the parent is an OR, that means treating the filter as FALSE
		}
		if (rightSideValue == true) {
			return true;
		} else {
			return false;
		}
	};


	TriplatQuery.AndOperator = function() {
		TriplatQuery.Operator.call(this);
		this.precedence = 2;
	};
	TriplatQuery.AndOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.AndOperator.constructor = TriplatQuery.AndOperator;
	TriplatQuery.AndOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record);
		if (leftSideValue == null) { 
			return true; // we want to ignore the filter, so when the parent is an AND, that means treating the filter as TRUE
		}
		if (leftSideValue == false) {
			return false;
		}
		var rightSideValue = this.rightSideOperator.execute(record);
		if (rightSideValue == null) { 
			return true; // we want to ignore the filter, so when the parent is an AND, that means treating the filter as TRUE
		}
		if (rightSideValue == true) {
			return true;
		} else {
			return false;
		}
	};

	TriplatQuery.OpenParenthesisOperator = function() {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.OpenParenthesisOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.OpenParenthesisOperator.constructor = TriplatQuery.OpenParenthesisOperator;
	TriplatQuery.OpenParenthesisOperator.prototype.execute = function(record) {
		//TBD
		return true;
	};

	TriplatQuery.CloseParenthesisOperator = function() {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.CloseParenthesisOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.CloseParenthesisOperator.constructor = TriplatQuery.CloseParenthesisOperator;
	TriplatQuery.CloseParenthesisOperator.prototype.execute = function(record) {
		//TBD
		return true;
	};


	TriplatQuery.ContainsOperator = function(precedence) {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.ContainsOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.ContainsOperator.constructor = TriplatQuery.ContainsOperator;
	TriplatQuery.ContainsOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record, this.type) || "";
		var rightSideValue = this.rightSideOperator.execute(record, this.type) || "";
		leftSideValue = typeof leftSideValue == "string" ? leftSideValue : leftSideValue + "";
		rightSideValue = typeof rightSideValue == "string" ? rightSideValue : rightSideValue + "";
		if (rightSideValue === "" && leftSideValue != "") {
			return false; // return false if the filter value is blank to match server side filtering
		}
		return leftSideValue.toLowerCase().indexOf(rightSideValue.toLowerCase()) >= 0;
	};


	TriplatQuery.EqualsOperator = function(precedence) {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.EqualsOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.EqualsOperator.constructor = TriplatQuery.EqualsOperator;
	TriplatQuery.EqualsOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record, this.type);
		var rightSideValue = this.rightSideOperator.execute(record, this.type);
		if (this.ignoreIfBlank == true && rightSideValue === "") {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (leftSideValue == null && rightSideValue === "") {
			return true; // return true if the comparison is null = blank to match server side filtering
		}
		return leftSideValue == rightSideValue;
	};

	TriplatQuery.NotEqualsOperator = function(precedence) {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.NotEqualsOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.NotEqualsOperator.constructor = TriplatQuery.NotEqualsOperator;
	TriplatQuery.NotEqualsOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record, this.type);
		var rightSideValue = this.rightSideOperator.execute(record, this.type);
		if (this.ignoreIfBlank == true && rightSideValue === "") {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (leftSideValue == null) { leftSideValue = ""; }
		if (rightSideValue == null) { rightSideValue = ""; }
		return leftSideValue != rightSideValue;
	};

	TriplatQuery.StartsWithOperator = function(precedence) {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.StartsWithOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.StartsWithOperator.constructor = TriplatQuery.StartsWithOperator;
	TriplatQuery.StartsWithOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record, this.type) || "";
		var rightSideValue = this.rightSideOperator.execute(record, this.type) || "";
		leftSideValue = typeof leftSideValue == "string" ? leftSideValue : leftSideValue + "";
		rightSideValue = typeof rightSideValue == "string" ? rightSideValue : rightSideValue + "";
		if (rightSideValue === "" && leftSideValue != "") {
			return false; // return false if the filter value is blank to match server side filtering
		}
		return leftSideValue.toLowerCase().startsWith(rightSideValue.toLowerCase());
	};


	TriplatQuery.LessThanOperator = function(precedence) {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.LessThanOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.LessThanOperator.constructor = TriplatQuery.LessThanOperator;
	TriplatQuery.LessThanOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record, this.type);
		var rightSideValue = this.rightSideOperator.execute(record, this.type);
		if ((this.type == "DATE" || this.type == "DATE_TIME") && ((rightSideValue == null || rightSideValue === ""))) {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (this.ignoreIfBlank == true && ((rightSideValue == null || rightSideValue === ""))) {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (leftSideValue == null) {
			return false; // return false if the value is null to match the server side filtering
		}
		if (typeof leftSideValue == "number" && typeof rightSideValue != "number") {
			rightSideValue = parseFloat(rightSideValue);
		}
		return leftSideValue < rightSideValue;
	};


	TriplatQuery.LessThanOrEqualsOperator = function(precedence) {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.LessThanOrEqualsOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.LessThanOrEqualsOperator.constructor = TriplatQuery.LessThanOrEqualsOperator;
	TriplatQuery.LessThanOrEqualsOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record, this.type);
		var rightSideValue = this.rightSideOperator.execute(record, this.type);
		if ((this.type == "DATE" || this.type == "DATE_TIME") && ((rightSideValue == null || rightSideValue === ""))) {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (this.ignoreIfBlank == true && ((rightSideValue == null || rightSideValue === ""))) {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (leftSideValue == null && rightSideValue != null) {
			return false; // return false to match the server side filtering
		}
		if (typeof leftSideValue == "number" && typeof rightSideValue != "number") {
			rightSideValue = parseFloat(rightSideValue);
		}
		return leftSideValue <= rightSideValue;
	};


	TriplatQuery.GreaterThanOperator = function(precedence) {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.GreaterThanOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.GreaterThanOperator.constructor = TriplatQuery.GreaterThanOperator;
	TriplatQuery.GreaterThanOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record, this.type);
		var rightSideValue = this.rightSideOperator.execute(record, this.type);
		if ((this.type == "DATE" || this.type == "DATE_TIME") && ((rightSideValue == null || rightSideValue === ""))) {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (this.ignoreIfBlank == true && ((rightSideValue == null || rightSideValue === ""))) {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (leftSideValue == null) {
			return false; // return false to match the server side filtering
		}
		if (typeof leftSideValue == "number" && typeof rightSideValue != "number") {
			rightSideValue = parseFloat(rightSideValue);
		}
		return leftSideValue > rightSideValue;
	};


	TriplatQuery.GreaterThanOrEqualsOperator = function(precedence) {
		TriplatQuery.Operator.call(this);
	};
	TriplatQuery.GreaterThanOrEqualsOperator.prototype = Object.create(TriplatQuery.Operator.prototype);
	TriplatQuery.GreaterThanOrEqualsOperator.constructor = TriplatQuery.GreaterThanOrEqualsOperator;
	TriplatQuery.GreaterThanOrEqualsOperator.prototype.execute = function(record) {
		var leftSideValue = this.leftSideOperator.execute(record, this.type);
		var rightSideValue = this.rightSideOperator.execute(record, this.type);

		if ((this.type == "DATE" || this.type == "DATE_TIME") && ((rightSideValue == null || rightSideValue === ""))) {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (this.ignoreIfBlank == true && ((rightSideValue == null || rightSideValue === ""))) {
			if (this.isRoot) {
				return true; // this is the only filter, so return TRUE to ignore it (matching server-side filtering)
			} else {
				return null; // null will cause the 'and' or 'or' operator to ignore this filter
			}
		}
		if (leftSideValue == null && rightSideValue != null) {
			return false; // return false to match the server side filtering
		}
		if (typeof leftSideValue == "number" && typeof rightSideValue != "number") {
			rightSideValue = parseFloat(rightSideValue);
		}
		return leftSideValue >= rightSideValue;
	};

	TriplatQuery.Operators = {
		"or": TriplatQuery.OrOperator,
		"and": TriplatQuery.AndOperator,
		"open parenthesis": TriplatQuery.OpenParenthesisOperator,
		"close parenthesis": TriplatQuery.CloseParenthesisOperator,
		"contains": TriplatQuery.ContainsOperator,
		"equals": TriplatQuery.EqualsOperator,
		"not equals": TriplatQuery.NotEqualsOperator,
		"starts with": TriplatQuery.StartsWithOperator,
		"less than": TriplatQuery.LessThanOperator,
		"less than or equals": TriplatQuery.LessThanOrEqualsOperator,
		"greater than": TriplatQuery.GreaterThanOperator,
		"greater than or equals": TriplatQuery.GreaterThanOrEqualsOperator
	};

	TriplatQuery.Query = function(page, filters, sorts, calendar, searchColumn) {
		this.page = page;
		this.filters = filters;
		this.sorts = sorts;
		this.calendar = calendar;
        this.searchColumn = searchColumn;
	};

	TriplatQuery.Query.prototype.buildOperationTree = function() {
		if (!this.operationTree) {
			var root = null;
			var parenthesisOpen = 0;
			for (var i = 0; i < this.filters.length; i++) {
				var filter = this.filters[i];
				var operatorType = TriplatQuery.Operators[filter.operator];
				var operator = new operatorType();
				if (filter.operator == "open parenthesis") {
					parenthesisOpen++;
					continue; // no additional processing is needed for the parenthesis
				}
				if (filter.operator == "close parenthesis") {
					parenthesisOpen--;
					continue; // no additional processing is needed for the parenthesis
				}
				if (parenthesisOpen > 0) {
					// if we are within parenthesis, then make this operator a higher precedence. 
					// use this formula to ensure within the  parenthesis the relatve precedence is honored
					operator.precedence = operator.precedence + (parenthesisOpen * 5);
				}

				if (filter.name) {
					operator.leftSideOperator = new TriplatQuery.RecordValue(filter.name);
					operator.rightSideOperator = new TriplatQuery.LiteralValue(filter.value);
					operator.type = filter.type;
					operator.isRoot = false;
					operator.ignoreIfBlank = filter.ignoreIfBlank;
				}

				if (root == null) {
					root = operator;
					continue;
				}

				var parentOperator = null;
				var visitingOperator = root;
				while (true) {
					if (!visitingOperator) {
						parentOperator.rightSideOperator = operator;
						break;
					}

					if (operator.precedence < visitingOperator.precedence) {
						if (parentOperator) {
							parentOperator.rightSideOperator = operator;
						} else {
							root = operator;
						}
						operator.leftSideOperator = visitingOperator;
						break;
					}

					parentOperator = visitingOperator;
					visitingOperator = visitingOperator.rightSideOperator;
				}
			}

			if (root != null) {
				root.isRoot = true;
			}
			this.operationTree = root;
		}

		return this.operationTree;
	};

	TriplatQuery.Query.prototype.filterRecords = function(records) {
		if (!records) {
			return null;
		}
		
		var operationTree = this.buildOperationTree();
		if (operationTree == null) {
			return records.slice();
		}

		return records.filter(function(record) {
			var result = operationTree.execute(record);
			return result;
		});
	};

	TriplatQuery.Query.prototype.sortRecords = function(records) {
		if (!records) {
			return;
		}

		var sorts = this.sorts;
		if (!sorts || sorts.length == 0) {
			return;
		}

		records.sort(function(a, b) {
			for (var i = 0; i < sorts.length; i++) {
				var sort = sorts[i];
				var x1 = sort.desc ? TriplatQuery.getFieldValueByName(b, sort.name) : TriplatQuery.getFieldValueByName(a, sort.name);
				var x2 = sort.desc ? TriplatQuery.getFieldValueByName(a, sort.name) : TriplatQuery.getFieldValueByName(b, sort.name);

				x1 = TriplatQuery.castValue(x1, sort.type);
				x2 = TriplatQuery.castValue(x2, sort.type);

				if (x1 != undefined && x1 != null && typeof x1 == "string") {
					x1 = x1.toLowerCase();
				} else if (x1 == null || x1 == undefined) {
					if (typeof x2 == "string") x1 = "";
					if (typeof x2 == "number") x1 = 0;	
				}

				if (x2 != undefined && x2 != null && typeof x2 == "string") {
					x2 = x2.toLowerCase();
				} else if (x2 == null || x2 == undefined){
					if (typeof x1 == "string") x2 = "";
					if (typeof x1 == "number") x2 = 0;
				}

				if (x1 < x2) {
					return -1;
				}
				if (x1 > x2) {
					return 1;
				}
			}
			return 0;
		});
	};

	TriplatQuery.Query.prototype.applyQuery = function(records) {
		if (!records) {
			return null;
		}
		var appliedRecords = this.filterRecords(records);
		this.sortRecords(appliedRecords);
		return appliedRecords
	};

	TriplatQuery.Query.prototype.areFiltersEqual = function(that) {
		if (!that || !(that instanceof TriplatQuery.Query)) {
			return false;
		}

		if (!this.filters && !that.filters) {
			// both filters are null
			return true;
		}

		if (!this.filters || !that.filters) {
			// only one is null
			return false;
		}

		if (this.filters.length != that.filters.length) {
			// the number of filters are different
			return false;
		}

		for (var i = 0; i < this.filters.length; i++) {
			var thisFilter = this.filters[i];
			var thatFilter = that.filters[i];

			if (thisFilter.name != thatFilter.name) {
				return false;
			}

			if (thisFilter.operator != thatFilter.operator) {
				return false;
			}

			if (thisFilter.value != thatFilter.value) {
				// TODO this works fine for string... could be an object in the future?
				return false;
			}
		}

		return true;
	};

	TriplatQuery.Query.prototype.areSortsEqual = function(that) {
		if (!that || !(that instanceof TriplatQuery.Query)) {
			return false;
		}

		if (!this.sorts && !that.sorts) {
			// both filters are null
			return true;
		}

		if (!this.sorts || !that.sorts) {
			// only one is null
			return false;
		}

		if (this.sorts.length != that.sorts.length) {
			// the number of sorts are different
			return false;
		}

		for (var i = 0; i < this.sorts.length; i++) {
			var thisSort = this.sorts[i];
			var thatSort = that.sorts[i];

			if (thisSort.name != thatSort.name) {
				return false;
			}

			if (thisSort.desc != thatSort.desc) {
				return false;
			}

			if (thisSort.type != thatSort.type) {
				return false;
			}
		}

		return true;
	};

	TriplatQuery.Query.prototype.isPageEqual = function(that) {
		if (!that || !(that instanceof TriplatQuery.Query)) {
			return false;
		}

		if (!this.page && !this.page) {
			return true;
		}

		if (!this.page || !that.page) {
			return false;
		}

		return this.page.from == that.page.from && this.page.size == that.page.size;
	};

	TriplatQuery.Query.prototype.isCalendarEqual = function(that) {
		if (!that || !(that instanceof TriplatQuery.Query)) {
			return false;
		}

		if (!this.calendar && !that.calendar) {
			return true;
		}

		if (!this.calendar || !that.calendar) {
			return false;
		}

		return this.calendar.startDate == that.calendar.startDate && 
		       this.calendar.endDate == that.calendar.endDate && 
		       this.calendar.id == that.calendar.id &&
		       this.calendar.name == that.calendar.name;
	};

	Polymer({

		is: "triplat-query",

		/**
	     * Fired when the query changes. This event is deprecated, use triplat-query-changed.
	     *
	     * @event trplat-query-changed
	     */
		/**
	     * Fired when the query changes.
	     *
	     * @event triplat-query-changed
	     */
		properties: {

			/**
			 * An object that has all the query information. This includes the page, filters and 
			 * sorting.
			 */
			query: {
				type: Object,
				notify: true,
				readOnly: true
			},

			/**
			 * The amount of delay between the time (milliseconds) a filter value, sort order or 
			 * page is changed and the time the query changed event is fired.
			 * 
			 * This delay is needed so we can wait a bit after a change in case there are more 
			 * changes. For example as a user types a filter, we don't need to immediately send a 
			 * new request for each character typed.
			 */
			delay: {
				type: Number,
				notify: false,
				readOnly: false,
				value: 100
			},

			/**
			 * Whether this query is paginated or not.
			 */
			paginated: {
				type: Boolean,
				notify: true,
				readOnly: true
			},

			/**
			 * When triplat-query is not a child of triplat-ds, then this represents the data that 
			 * you want to be filtered.
			 */
			data: {
				type: Object,
				notify: true
			},

			/**
			 * When triplat-query is not a child of triplat-ds, then this represents the data that 
			 * has been filtered.
			 */ 
			filteredDataOut: {
				type: Object,
				notify: true,
				readOnly: true
			},

			/**
			 * If this is a paginated query, appendPage tells you whether the pagination should 
			 * append or not.
			 */
			appendPage: {
				type: Boolean,
				notify: true,
				readOnly: true
			},
            
            /**
			 * If this query is used for doing search by using the new search input, 
             * this binding is needed. Make sure it is bound to the same property as
             * the related "triplat-search-input".
			 */
            appendFilters: {
                type: Array
            },

			/**
			 * If this is server-side filter without pagination, this tells you the maximum number of entries returned.
			 */
			forceServerFilteringSize: {
				type: Number,
				value: 10000
			},
            
            /**
			 * If the query is used for a search, this tells the column name
			 */
			searchColumn: {
				type: String
			},

			_filterMeta: {
				type: Array,
				notify: false,
				readOnly: true
			},

			_query: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_deferredHandleDataChange: {
				type: Boolean,
				value: false
			}, 
            
            _appendFilterIndexLookup: {
                type: Object,
                value: {}
            }

		},

		get _intDelay() {
			return parseInt(this.delay);
		},

		listeners: {
			"triplat-query-page-change": "_pageChanged",
			"triplat-query-sort-changed": "_sortChanged",
			"triplat-query-resource-calendar-changed": "_resourceCalendarChanged",
			"triplat-query-filter-change": "_filterChanged"
		},

		observers: [
			"_queryChanged(_query.*)",
			"_handleDataChange(data.*)",
            "_appendFiltersChanged(appendFilters.*)"
		],

		get _validPage() {
			if (!this._query.page) {
				return false;
			}
			var page = this._query.page;
			
			var from = parseInt(page.from);
			if (isNaN(from)) {
				return false;
			}
			
			var size = parseInt(page.size);
			if (isNaN(size)) {
				return false;
			}

			return true;
		},

		attached: function() {
			this.async(function() {
				this._init();
				if (this._deferredHandlDataChange) {
					this._handleDataChange();
					this._deferredHandlDataChange = false;
				}
			});
		},

		_init: function() {
			var query = {};
			var pageElement = Polymer.dom(this).querySelector("triplat-query-page,triplat-query-scroll-page");
			var paginated = pageElement != undefined;
			if (pageElement) {
				if (pageElement.page) {
					query.page = pageElement.page;
				}
				if (pageElement.tagName == "TRIPLAT-QUERY-SCROLL-PAGE") {
					this._setAppendPage(true);
				} else {
					this._setAppendPage(false);
				}
			}

			var sortElements = Polymer.dom(this).querySelectorAll("triplat-query-sort");
			query.sorts = new Array(sortElements.length);
			for (var i = 0; i < sortElements.length; i++) {
				var sortElement = sortElements[i];
				this._setIndex(sortElement, i);
				if (sortElement.sort) {
					query.sorts[i] = sortElement.sort;
				}
			}

			var filterElements = Polymer.dom(this).querySelectorAll("triplat-query-filter,triplat-query-and,triplat-query-or,triplat-query-open-paren,triplat-query-close-paren");
			query.filters = new Array(filterElements.length);
			this._set_filterMeta([]);
			for (var i = 0; i < filterElements.length; i++) {
				var filterElement = filterElements[i];
				this._buildFilterMeta(filterElement, i, query);
			}

			var calendarElement = Polymer.dom(this).querySelector("triplat-query-resource-calendar");
			if (calendarElement) {
				query.calendar = new Object;
				if (calendarElement.availability) {
					query.calendar = calendarElement.availability;
				}
			}

			this._setPaginated(paginated);
			this._set_query(query);
		},

		_setIndex: function(element, index) {
			Polymer.dom(element).setAttribute("triplat-query-index", index);
		},

		_getIndex: function(element) {
			return element.getAttribute("triplat-query-index");
		},

		_pageChanged: function(e) {
			e.stopPropagation();
			this.set("_query.page", e.detail);
		},

		_sortChanged: function(e) {
			e.stopPropagation();
			var index = this._getIndex(e.target);
			this.set("_query.sorts." + index, e.detail);
		},

		_resourceCalendarChanged: function(e) {
			e.stopPropagation();
			this.set("_query.calendar", e.detail);
		},

		_filterChanged: function(e) {
			e.stopPropagation();
			var index = this._getIndex(e.target);
			if (this._query != undefined && this._query.filters != undefined) {
				this.set("_query.filters." + index, e.detail);
			} 
		},

		_queryChanged: function(change) {
			if (this._delayHandle != undefined && this._delayHandle != null) {
				this.cancelAsync(this._delayHandle);
			}
			if (change.path.indexOf("_query.filters") == 0) {
				this._delayHandle = this.async(this._doQueryChanged, this._intDelay);
			} else if (change.path.indexOf("_query.page") == 0 && this.appendPage == true) {
				// the page was updated and is in append page mode, so don't delay the update
				this._doQueryChanged();
			} else if (change.path.indexOf("_query.calendar") == 0) {
				this._doQueryChanged();
			} else {
				// TODO should we only delay for filter changes?
				// this._doQueryChanged();
				this._delayHandle = this.async(this._doQueryChanged, this._intDelay);
			}
		},

		_handleDataChange: function() {
			if (this.query == undefined || this.query == null) {
				this._deferredHandleDataChange = true;
				return;
			}
			if (this.data) {
				this._setFilteredDataOut(this.query.applyQuery(this.data));
			} else {
				this._setFilteredDataOut(null);
			}
		},

		_doQueryChanged: function() {
			var page = null;
			if (this.paginated) {
				if (!this._validPage) {
					return;
				}
				page = this._query.page;
			}

			var filters = [];
			for (var i = 0; i < this._query.filters.length; i++) {
				var filter = this._query.filters[i];

				if (filter == undefined) {
					//return;
					continue;
				}

				var meta = this._filterMeta[i];
				filters.push(filter);
				if (!meta.required && !meta.ignoreIfBlank) {
					continue;
				}
				
				var blankValue = false;
				if (filter.value === undefined || filter.value === "") {
					blankValue = true;
				}

				if (meta.required && blankValue) {
					return;
				}

				if (meta.ignoreIfBlank && blankValue) {
					filters.pop(); // remove the filter

					// if this is the last filter, then remove the boolean operator to its left
					if (i == this._query.filters.length - 1) {
						filters.pop();
					}
					i++; // skip the boolean operator that would have been to the right of this ignored filter
				}
				
			}

			var filterIndex = 0;
			while (filterIndex < filters.length) {
				var currentFilter = filters[filterIndex];
				
				var nextFilter = null;
				if (filterIndex < filters.length -1) {
					nextFilter = filters[filterIndex+1];
				}
				
				// 1) cannot start with operator nor close parenthesis
				if (filterIndex == 0) {
					if (currentFilter.operator == "close parenthesis" || currentFilter.operator == "and" || currentFilter.operator == "or") {
						filters.splice(0,1); 
						continue; 
					}
				}

				// 2) cannot end with operator nor open parenthesis
				if (nextFilter == null) {
					if (currentFilter.operator == "or" || currentFilter.operator == "and" || currentFilter.operator == "open parenthesis") {
						filters.splice(filterIndex,1);
						if (filterIndex > 0) {
							filterIndex--;
						}
						filterIndex = 0;
						continue;
					} else {
						// must be a valid filter to end the statement, like close paren or a condition
						break;
					}
				}

				// 3) operator and must have condition following it
				if (currentFilter.operator == "and" || currentFilter.operator == "or") {
					if (nextFilter.operator == "and" || nextFilter.operator == "or" || nextFilter.operator == "close parenthesis") {
						filters.splice(filterIndex,1);
						if (filterIndex > 0) {
							filterIndex--;
						}
						filterIndex = 0;
						continue;
					}
				}

				// 4) close parenthesis must have operator following it
				if (currentFilter.operator == "close parenthesis") {
					if (nextFilter.operator == "and" || nextFilter.operator == "or") {
						// valid
					} else {
						filters.splice(filterIndex,1);
						if (filterIndex > 0) {
							filterIndex--;
						}
						filterIndex = 0;
						continue;
					}
				}
				if (currentFilter.operator == "open parenthesis") {
					if (nextFilter != null && (nextFilter.operator == "and" || nextFilter.operator == "or")) { 
						if (filterIndex == filters.length - 1) {
							// this is the end of the filter, so remove open parenthesis
							filters.splice(filterIndex,1);
						} else {
							// this is not the end of the filter, so remove open and the following boolean operator
							filters.splice(filterIndex,2);
						}
						if (filterIndex > 0) {
							filterIndex--;
						} else {
							filterIndex = 0;
						}
						continue;
					}
				}
				filterIndex++;
			}

			var sorts = this._query.sorts == null ? null : this._query.sorts.slice();

			if (page == undefined || page == null) {
				page = new Object;
				page.from = 0;
				page.size = this.forceServerFilteringSize;
			}

			var calendar = this._query.calendar == null ? null : this._query.calendar;


			var query = new TriplatQuery.Query(page, filters, sorts, calendar, this.searchColumn);

			if (this.query 
					&& this.query.page 
					&& this.query.page.from != 0 
					&& (!this.query.areFiltersEqual(query) || !this.query.areSortsEqual(query))) {
				var pageElement = Polymer.dom(this).querySelector("triplat-query-page,triplat-query-scroll-page");
				this.async(function() {
					pageElement.reset();
				});
				this._setQuery(query);
			} else {
				this._setQuery(query);
				if (this.data) {
					this._setFilteredDataOut(this.query.applyQuery(this.data));
				} else {
					this.fire("trplat-query-changed", {query: query, append: this.appendPage, paginated: this.paginated});
					this.fire("triplat-query-changed", {query: query, append: this.appendPage, paginated: this.paginated});
				}
			}
		},
        
        _appendFiltersChanged: function(change){
            if(change.path == "appendFilters.splices"){
                // Should clone for assignment later
                var queryJson = JSON.parse(JSON.stringify(this.query));
                var pageElement = this.queryEffectiveChildren("triplat-query-page,triplat-query-scroll-page");
                if(pageElement){
                    this.async(function() {
                        pageElement.reset();
                    });
                }
                var query = new TriplatQuery.Query(queryJson.page, 
                                                   queryJson.filters, 
                                                   queryJson.sorts, 
                                                   queryJson.calendar,
                                                   queryJson.searchColumn);
                var indexSplice = change.value.indexSplices[0];
                var removed = indexSplice.removed;
                if(removed.length > 1){
                    this._removeFilters(query);   
                }
                else if(removed.length == 1) {
                    var lookup = (removed[0].isUniversal) ? "_universalFilter" : removed[0].name;
                    this._removeFilter(lookup, query);
                }
                for (var i = 0; i < indexSplice.addedCount; i++) {
    				var added = indexSplice.object[indexSplice.index + i];
                    var currentIndex = query.filters.length;
                    if(added.isUniversal){
                        this._addUniversalFilter(added.filters, currentIndex, query);
                    } else {
                        this._appendFilterIndexLookup[added.name] = { start: currentIndex, elemStart: currentIndex};
                        if(currentIndex > 0){
                            var filterElementName = (added.appendWithAnd) ? "triplat-query-and" : "triplat-query-or";
                            this._addFilterElement(filterElementName, currentIndex, query);
                            currentIndex++;
                        }
                        this._addFilterElement("triplat-query-filter", currentIndex, query, added);
                    }
                }
                this._set_query(query);
                this._setQuery(query);
            }
        },
        
        _addUniversalFilter: function(filters, currentIndex, query){
            this._appendFilterIndexLookup["_universalFilter"] = { start: currentIndex, elemStart: currentIndex};
            if(currentIndex > 0){
                this._addFilterElement("triplat-query-and", currentIndex, query);
                currentIndex++;
            }
            this._addFilterElement("triplat-query-open-paren", currentIndex, query);
            currentIndex++;
            for(var i = 0; i < filters.length; i++){
                var filter = filters[i];
                if(!filter.appendWithAnd){
                    this._addFilterElement("triplat-query-or", currentIndex, query);
                    currentIndex++;
                }
                var filterElement = this._createFilterElement("triplat-query-filter", filter, filter.value, currentIndex);
                this._buildFilterMeta(filterElement, currentIndex, query);
                currentIndex++;
            }
            this._addFilterElement("triplat-query-close-paren", currentIndex, query);
            currentIndex++;
            this._appendFilterIndexLookup["_universalFilter"].end = currentIndex;
            this._appendFilterIndexLookup["_universalFilter"].elemEnd = currentIndex;
        },
        
        _adjustFilterLookup: function(filterRemoved){
            var filters = Object.keys(this._appendFilterIndexLookup);
            for(var filter in filters){
                var filterObj = this._appendFilterIndexLookup[filters[filter]];
                if(filterObj.end <= filterRemoved.start){
                    continue;
                }
                var amountToAdjust = (filterRemoved.end - filterRemoved.start);
                filterObj.start -= amountToAdjust;
                filterObj.end -= amountToAdjust;
            }    
        },
        
        _removeFilter: function(lookup, query){
            var indexRemoved = this._appendFilterIndexLookup[lookup];
            query.filters.splice(indexRemoved.start, (indexRemoved.end - indexRemoved.start));
            this._removeFilterElement(lookup);
            delete this._appendFilterIndexLookup[lookup];
            this._adjustFilterLookup(indexRemoved)           
        },
        
        _removeFilters: function(query){
            var start = query.filters.length;
            var filters = Object.keys(this._appendFilterIndexLookup);
            for(var filter in filters){
                var lookup = filters[filter];
                var candidate = this._appendFilterIndexLookup[lookup].start;
                if(candidate < start){
                    start = candidate;    
                }
                this._removeFilterElement(lookup);
            }
            query.filters.splice(start, query.filters.length - start);
        },
        
        _removeFilterElement: function(lookup){
            var filterStart = this._appendFilterIndexLookup[lookup].elemStart;
            var filterEnd = this._appendFilterIndexLookup[lookup].elemEnd;
            for(var i = filterStart; i < filterEnd; i++){
                this._removeChildQueryElement(i);    
            }    
        },
        
        _removeChildQueryElement: function(removeIndex){
            var tagElem = Polymer.dom(this).querySelector("[triplat-query-index='"+removeIndex+"']:not(triplat-query-sort)");
            if(tagElem){
                Polymer.dom(this).removeChild(tagElem);
            }
        },
        
        _addFilterElement: function(elementName, currentIndex, query, filterProps){
            if(filterProps){
                var isGroup = filterProps.value.length > 1;
                if(isGroup){
                    this._addFilterElement("triplat-query-open-paren", currentIndex, query);
                    currentIndex++;
                }
                filterProps.value.forEach(function(value, index){
                    if(index > 0){
                        this._addFilterElement("triplat-query-or", currentIndex, query);
                        currentIndex++;
                    }
                    var filterElement = this._createFilterElement(elementName, filterProps, value, currentIndex);
                    this._buildFilterMeta(filterElement, currentIndex, query);
                    currentIndex++;
                }, this);
                if(isGroup){
                    this._addFilterElement("triplat-query-close-paren", currentIndex, query);
                    currentIndex++;
                }
                this._appendFilterIndexLookup[filterProps.name].end = currentIndex;
                this._appendFilterIndexLookup[filterProps.name].elemEnd = currentIndex;
            } else {
                var filterElement = document.createElement(elementName); 
                Polymer.dom(this).appendChild(filterElement);
                this._buildFilterMeta(filterElement, currentIndex, query);
            }
        },
        
        _createFilterElement: function(elementName, filterProps, value, currentIndex){
            var filterElement = document.createElement(elementName);
            var name = filterProps.isStringWithId ? filterProps.name+".value" : filterProps.name;
            filterElement.name = name;
            filterElement.operator = filterProps.operator;
            filterElement.value = value;
            Polymer.dom(this).appendChild(filterElement);
            return filterElement;
        },
        
        _buildFilterMeta: function(filterElement, currentIndex, query){
            this._setIndex(filterElement, currentIndex);
            var meta = {required: false, ignoreIfBlank: false};
            if (filterElement.tagName === "TRIPLAT-QUERY-AND") {
                query.filters[currentIndex] = {operator: "and"};
            } else if (filterElement.tagName === "TRIPLAT-QUERY-OR") {
                query.filters[currentIndex] = {operator: "or"};
            } else if (filterElement.tagName === "TRIPLAT-QUERY-OPEN-PAREN") {
                query.filters[currentIndex] = {operator: "open parenthesis", required: true};
            } else if (filterElement.tagName === "TRIPLAT-QUERY-CLOSE-PAREN") {
                query.filters[currentIndex] = {operator: "close parenthesis", required: true};
            } else {
                if (filterElement.ignoreIfBlank) {
                    meta.ignoreIfBlank = true;
                }
                if (filterElement.required) {
                    meta.required = true;
                }
                if (filterElement.filter) {
                    query.filters[currentIndex] = filterElement.filter;
                }
            }
            this.push("_filterMeta", meta);  
        }

	});
</script><script>
	Polymer({

		is: "triplat-ds-context",

		/**
	     * Fired when the context changes.
	     *
	     * @event triplat-ds-context-changed
	     */

		properties: {

			/**
			 * The data source name. 
			 */
			name: {
				type: String
			},

			/**
			 * An object that holds a context ID or an array of context IDs. Use an array of context IDs only with the parent data source.
			 */
			contextId: {
				type: Object
			},

			_index: {
				type: Number
			}

		},

		observers: [
			"_initIndex(_index)",
			"_initContextId(contextId.*)"
		],

		_initIndex: function() {
			if (this.contextId != undefined && this.contextId != null) {
				this.fire("triplat-ds-context-changed");
			}
		},

		_initContextId: function() {
			if (this._index != undefined && this._index != null) {
				this.fire("triplat-ds-context-changed");
			}
		}

	});
</script><script>
	Polymer({

		is: "triplat-ds-instance",

		/**
	     * Fired when the instance Id changes.
	     *
	     * @event triplat-ds-instance-changed
	     */

		properties: {

			instanceId: {
				type: Number,
				notify: false,
				readOnly: false,
				observer: "_handleInstanceIdChanged"
			}

		},

		_handleInstanceIdChanged: function(instanceId) {
			this.fire("triplat-ds-instance-changed", {instanceId: instanceId});
		},

	});
</script><script>
	Polymer({

		is: "triplat-ds-record-by-id",

		properties: {

			recordId: {
				type: Number,
				observer: "_initRecord"
			},

			data: {
				type: Array,
				notify: true,
				readOnly: false,
				observer: "_initRecord"
			},

			record: {
				type: Object,
				notify: true,
				readOnly: true
			}

		},

		_initRecord: function() {
			if (this.recordId == null 
					|| this.recordId == undefined 
					|| this.data == null 
					|| this.data == undefined) {
				this._setRecord(null);
				return;
			}

			var foundRecord = null;
			for (var i = 0; i < this.data.length; i++) {
				var record = this.data[i];
				if (this.recordId == record._id) {
					foundRecord = record;
					break;
				}
			}
			this._setRecord(foundRecord);
		}

	});
</script>

<script>

  /**
   * `Polymer.NeonAnimatableBehavior` is implemented by elements containing animations for use with
   * elements implementing `Polymer.NeonAnimationRunnerBehavior`.
   * @polymerBehavior
   */
  Polymer.NeonAnimatableBehavior = {

    properties: {

      /**
       * Animation configuration. See README for more info.
       */
      animationConfig: {
        type: Object
      },

      /**
       * Convenience property for setting an 'entry' animation. Do not set `animationConfig.entry`
       * manually if using this. The animated node is set to `this` if using this property.
       */
      entryAnimation: {
        observer: '_entryAnimationChanged',
        type: String
      },

      /**
       * Convenience property for setting an 'exit' animation. Do not set `animationConfig.exit`
       * manually if using this. The animated node is set to `this` if using this property.
       */
      exitAnimation: {
        observer: '_exitAnimationChanged',
        type: String
      }

    },

    _entryAnimationChanged: function() {
      this.animationConfig = this.animationConfig || {};
      this.animationConfig['entry'] = [{
        name: this.entryAnimation,
        node: this
      }];
    },

    _exitAnimationChanged: function() {
      this.animationConfig = this.animationConfig || {};
      this.animationConfig['exit'] = [{
        name: this.exitAnimation,
        node: this
      }];
    },

    _copyProperties: function(config1, config2) {
      // shallowly copy properties from config2 to config1
      for (var property in config2) {
        config1[property] = config2[property];
      }
    },

    _cloneConfig: function(config) {
      var clone = {
        isClone: true
      };
      this._copyProperties(clone, config);
      return clone;
    },

    _getAnimationConfigRecursive: function(type, map, allConfigs) {
      if (!this.animationConfig) {
        return;
      }

      if(this.animationConfig.value && typeof this.animationConfig.value === 'function') {
      	this._warn(this._logf('playAnimation', "Please put 'animationConfig' inside of your components 'properties' object instead of outside of it."));
      	return;
      }

      // type is optional
      var thisConfig;
      if (type) {
        thisConfig = this.animationConfig[type];
      } else {
        thisConfig = this.animationConfig;
      }

      if (!Array.isArray(thisConfig)) {
        thisConfig = [thisConfig];
      }

      // iterate animations and recurse to process configurations from child nodes
      if (thisConfig) {
        for (var config, index = 0; config = thisConfig[index]; index++) {
          if (config.animatable) {
            config.animatable._getAnimationConfigRecursive(config.type || type, map, allConfigs);
          } else {
            if (config.id) {
              var cachedConfig = map[config.id];
              if (cachedConfig) {
                // merge configurations with the same id, making a clone lazily
                if (!cachedConfig.isClone) {
                  map[config.id] = this._cloneConfig(cachedConfig)
                  cachedConfig = map[config.id];
                }
                this._copyProperties(cachedConfig, config);
              } else {
                // put any configs with an id into a map
                map[config.id] = config;
              }
            } else {
              allConfigs.push(config);
            }
          }
        }
      }
    },

    /**
     * An element implementing `Polymer.NeonAnimationRunnerBehavior` calls this method to configure
     * an animation with an optional type. Elements implementing `Polymer.NeonAnimatableBehavior`
     * should define the property `animationConfig`, which is either a configuration object
     * or a map of animation type to array of configuration objects.
     */
    getAnimationConfig: function(type) {
      var map = {};
      var allConfigs = [];
      this._getAnimationConfigRecursive(type, map, allConfigs);
      // append the configurations saved in the map to the array
      for (var key in map) {
        allConfigs.push(map[key]);
      }
      return allConfigs;
    }

  };

</script><script>

  /**
   * `Polymer.NeonAnimationRunnerBehavior` adds a method to run animations.
   *
   * @polymerBehavior Polymer.NeonAnimationRunnerBehavior
   */
  Polymer.NeonAnimationRunnerBehaviorImpl = {

    _configureAnimations: function(configs) {
      var results = [];
      if (configs.length > 0) {
        for (var config, index = 0; config = configs[index]; index++) {
          var neonAnimation = document.createElement(config.name);
          // is this element actually a neon animation?
          if (neonAnimation.isNeonAnimation) {
            var result = null;
            // configuration or play could fail if polyfills aren't loaded
            try {
              result = neonAnimation.configure(config);
              // Check if we have an Effect rather than an Animation
              if (typeof result.cancel != 'function') { 
                result = document.timeline.play(result);
              }
            } catch (e) {
              result = null;
              console.warn('Couldnt play', '(', config.name, ').', e);
            }
            if (result) {
              results.push({
                neonAnimation: neonAnimation,
                config: config,
                animation: result,
              });
            }
          } else {
            console.warn(this.is + ':', config.name, 'not found!');
          }
        }
      }
      return results;
    },

    _shouldComplete: function(activeEntries) {
      var finished = true;
      for (var i = 0; i < activeEntries.length; i++) {
        if (activeEntries[i].animation.playState != 'finished') {
          finished = false;
          break;
        }
      }
      return finished;
    },

    _complete: function(activeEntries) {
      for (var i = 0; i < activeEntries.length; i++) {
        activeEntries[i].neonAnimation.complete(activeEntries[i].config);
      }
      for (var i = 0; i < activeEntries.length; i++) {
        activeEntries[i].animation.cancel();
      }
    },

    /**
     * Plays an animation with an optional `type`.
     * @param {string=} type
     * @param {!Object=} cookie
     */
    playAnimation: function(type, cookie) {
      var configs = this.getAnimationConfig(type);
      if (!configs) {
        return;
      }
      this._active = this._active || {};
      if (this._active[type]) {
        this._complete(this._active[type]);
        delete this._active[type];
      }

      var activeEntries = this._configureAnimations(configs);

      if (activeEntries.length == 0) {
        this.fire('neon-animation-finish', cookie, {bubbles: false});
        return;
      }

      this._active[type] = activeEntries;

      for (var i = 0; i < activeEntries.length; i++) {
        activeEntries[i].animation.onfinish = function() {
          if (this._shouldComplete(activeEntries)) {
            this._complete(activeEntries);
            delete this._active[type];
            this.fire('neon-animation-finish', cookie, {bubbles: false});
          }
        }.bind(this);
      }
    },

    /**
     * Cancels the currently running animations.
     */
    cancelAnimation: function() {
      for (var k in this._animations) {
        this._animations[k].cancel();
      }
      this._animations = {};
    }
  };

  /** @polymerBehavior Polymer.NeonAnimationRunnerBehavior */
  Polymer.NeonAnimationRunnerBehavior = [
    Polymer.NeonAnimatableBehavior,
    Polymer.NeonAnimationRunnerBehaviorImpl
  ];
</script><script>
/**
`Polymer.IronFitBehavior` fits an element in another element using `max-height` and `max-width`, and
optionally centers it in the window or another element.

The element will only be sized and/or positioned if it has not already been sized and/or positioned
by CSS.

CSS properties               | Action
-----------------------------|-------------------------------------------
`position` set               | Element is not centered horizontally or vertically
`top` or `bottom` set        | Element is not vertically centered
`left` or `right` set        | Element is not horizontally centered
`max-height` set             | Element respects `max-height`
`max-width` set              | Element respects `max-width`

`Polymer.IronFitBehavior` can position an element into another element using
`verticalAlign` and `horizontalAlign`. This will override the element's css position.

      <div class="container">
        <iron-fit-impl vertical-align="top" horizontal-align="auto">
          Positioned into the container
        </iron-fit-impl>
      </div>

Use `noOverlap` to position the element around another element without overlapping it.

      <div class="container">
        <iron-fit-impl no-overlap vertical-align="auto" horizontal-align="auto">
          Positioned around the container
        </iron-fit-impl>
      </div>

@demo demo/index.html
@polymerBehavior
*/

  Polymer.IronFitBehavior = {

    properties: {

      /**
       * The element that will receive a `max-height`/`width`. By default it is the same as `this`,
       * but it can be set to a child element. This is useful, for example, for implementing a
       * scrolling region inside the element.
       * @type {!Element}
       */
      sizingTarget: {
        type: Object,
        value: function() {
          return this;
        }
      },

      /**
       * The element to fit `this` into.
       */
      fitInto: {
        type: Object,
        value: window
      },

      /**
       * Will position the element around the positionTarget without overlapping it.
       */
      noOverlap: {
        type: Boolean
      },

      /**
       * The element that should be used to position the element. If not set, it will
       * default to the parent node.
       * @type {!Element}
       */
      positionTarget: {
        type: Element
      },

      /**
       * The orientation against which to align the element horizontally
       * relative to the `positionTarget`. Possible values are "left", "right", "auto".
       */
      horizontalAlign: {
        type: String
      },

      /**
       * The orientation against which to align the element vertically
       * relative to the `positionTarget`. Possible values are "top", "bottom", "auto".
       */
      verticalAlign: {
        type: String
      },

      /**
       * If true, it will use `horizontalAlign` and `verticalAlign` values as preferred alignment
       * and if there's not enough space, it will pick the values which minimize the cropping.
       */
      dynamicAlign: {
        type: Boolean
      },

      /**
       * The same as setting margin-left and margin-right css properties.
       * @deprecated
       */
      horizontalOffset: {
        type: Number,
        value: 0,
        notify: true
      },

      /**
       * The same as setting margin-top and margin-bottom css properties.
       * @deprecated
       */
      verticalOffset: {
        type: Number,
        value: 0,
        notify: true
      },

      /**
       * Set to true to auto-fit on attach.
       */
      autoFitOnAttach: {
        type: Boolean,
        value: false
      },

      /** @type {?Object} */
      _fitInfo: {
        type: Object
      }
    },

    get _fitWidth() {
      var fitWidth;
      if (this.fitInto === window) {
        fitWidth = this.fitInto.innerWidth;
      } else {
        fitWidth = this.fitInto.getBoundingClientRect().width;
      }
      return fitWidth;
    },

    get _fitHeight() {
      var fitHeight;
      if (this.fitInto === window) {
        fitHeight = this.fitInto.innerHeight;
      } else {
        fitHeight = this.fitInto.getBoundingClientRect().height;
      }
      return fitHeight;
    },

    get _fitLeft() {
      var fitLeft;
      if (this.fitInto === window) {
        fitLeft = 0;
      } else {
        fitLeft = this.fitInto.getBoundingClientRect().left;
      }
      return fitLeft;
    },

    get _fitTop() {
      var fitTop;
      if (this.fitInto === window) {
        fitTop = 0;
      } else {
        fitTop = this.fitInto.getBoundingClientRect().top;
      }
      return fitTop;
    },

    /**
     * The element that should be used to position the element,
     * if no position target is configured.
     */
    get _defaultPositionTarget() {
      var parent = Polymer.dom(this).parentNode;

      if (parent && parent.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {
        parent = parent.host;
      }

      return parent;
    },

    /**
     * The horizontal align value, accounting for the RTL/LTR text direction.
     */
    get _localeHorizontalAlign() {
      if (this._isRTL) {
        // In RTL, "left" becomes "right".
        if (this.horizontalAlign === 'right') {
          return 'left';
        }
        if (this.horizontalAlign === 'left') {
          return 'right';
        }
      }
      return this.horizontalAlign;
    },

    attached: function() {
      // Memoize this to avoid expensive calculations & relayouts.
      this._isRTL = window.getComputedStyle(this).direction == 'rtl';
      this.positionTarget = this.positionTarget || this._defaultPositionTarget;
      if (this.autoFitOnAttach) {
        if (window.getComputedStyle(this).display === 'none') {
          setTimeout(function() {
            this.fit();
          }.bind(this));
        } else {
          this.fit();
        }
      }
    },

    /**
     * Positions and fits the element into the `fitInto` element.
     */
    fit: function() {
      this.position();
      this.constrain();
      this.center();
    },

    /**
     * Memoize information needed to position and size the target element.
     * @suppress {deprecated}
     */
    _discoverInfo: function() {
      if (this._fitInfo) {
        return;
      }
      var target = window.getComputedStyle(this);
      var sizer = window.getComputedStyle(this.sizingTarget);

      this._fitInfo = {
        inlineStyle: {
          top: this.style.top || '',
          left: this.style.left || '',
          position: this.style.position || ''
        },
        sizerInlineStyle: {
          maxWidth: this.sizingTarget.style.maxWidth || '',
          maxHeight: this.sizingTarget.style.maxHeight || '',
          boxSizing: this.sizingTarget.style.boxSizing || ''
        },
        positionedBy: {
          vertically: target.top !== 'auto' ? 'top' : (target.bottom !== 'auto' ?
            'bottom' : null),
          horizontally: target.left !== 'auto' ? 'left' : (target.right !== 'auto' ?
            'right' : null)
        },
        sizedBy: {
          height: sizer.maxHeight !== 'none',
          width: sizer.maxWidth !== 'none',
          minWidth: parseInt(sizer.minWidth, 10) || 0,
          minHeight: parseInt(sizer.minHeight, 10) || 0
        },
        margin: {
          top: parseInt(target.marginTop, 10) || 0,
          right: parseInt(target.marginRight, 10) || 0,
          bottom: parseInt(target.marginBottom, 10) || 0,
          left: parseInt(target.marginLeft, 10) || 0
        }
      };

      // Support these properties until they are removed.
      if (this.verticalOffset) {
        this._fitInfo.margin.top = this._fitInfo.margin.bottom = this.verticalOffset;
        this._fitInfo.inlineStyle.marginTop = this.style.marginTop || '';
        this._fitInfo.inlineStyle.marginBottom = this.style.marginBottom || '';
        this.style.marginTop = this.style.marginBottom = this.verticalOffset + 'px';
      }
      if (this.horizontalOffset) {
        this._fitInfo.margin.left = this._fitInfo.margin.right = this.horizontalOffset;
        this._fitInfo.inlineStyle.marginLeft = this.style.marginLeft || '';
        this._fitInfo.inlineStyle.marginRight = this.style.marginRight || '';
        this.style.marginLeft = this.style.marginRight = this.horizontalOffset + 'px';
      }
    },

    /**
     * Resets the target element's position and size constraints, and clear
     * the memoized data.
     */
    resetFit: function() {
      var info = this._fitInfo || {};
      for (var property in info.sizerInlineStyle) {
        this.sizingTarget.style[property] = info.sizerInlineStyle[property];
      }
      for (var property in info.inlineStyle) {
        this.style[property] = info.inlineStyle[property];
      }

      this._fitInfo = null;
    },

    /**
     * Equivalent to calling `resetFit()` and `fit()`. Useful to call this after
     * the element or the `fitInto` element has been resized, or if any of the
     * positioning properties (e.g. `horizontalAlign, verticalAlign`) is updated.
     * It preserves the scroll position of the sizingTarget.
     */
    refit: function() {
      var scrollLeft = this.sizingTarget.scrollLeft;
      var scrollTop = this.sizingTarget.scrollTop;
      this.resetFit();
      this.fit();
      this.sizingTarget.scrollLeft = scrollLeft;
      this.sizingTarget.scrollTop = scrollTop;
    },

    /**
     * Positions the element according to `horizontalAlign, verticalAlign`.
     */
    position: function() {
      if (!this.horizontalAlign && !this.verticalAlign) {
        // needs to be centered, and it is done after constrain.
        return;
      }
      this._discoverInfo();

      this.style.position = 'fixed';
      // Need border-box for margin/padding.
      this.sizingTarget.style.boxSizing = 'border-box';
      // Set to 0, 0 in order to discover any offset caused by parent stacking contexts.
      this.style.left = '0px';
      this.style.top = '0px';

      var rect = this.getBoundingClientRect();
      var positionRect = this.__getNormalizedRect(this.positionTarget);
      var fitRect = this.__getNormalizedRect(this.fitInto);

      var margin = this._fitInfo.margin;

      // Consider the margin as part of the size for position calculations.
      var size = {
        width: rect.width + margin.left + margin.right,
        height: rect.height + margin.top + margin.bottom
      };

      var position = this.__getPosition(this._localeHorizontalAlign, this.verticalAlign, size, positionRect, fitRect);

      var left = position.left + margin.left;
      var top = position.top + margin.top;

      // Use original size (without margin).
      var right = Math.min(fitRect.right - margin.right, left + rect.width);
      var bottom = Math.min(fitRect.bottom - margin.bottom, top + rect.height);

      var minWidth = this._fitInfo.sizedBy.minWidth;
      var minHeight = this._fitInfo.sizedBy.minHeight;
      if (left < margin.left) {
        left = margin.left;
        if (right - left < minWidth) {
          left = right - minWidth;
        }
      }
      if (top < margin.top) {
        top = margin.top;
        if (bottom - top < minHeight) {
          top = bottom - minHeight;
        }
      }

      this.sizingTarget.style.maxWidth = (right - left) + 'px';
      this.sizingTarget.style.maxHeight = (bottom - top) + 'px';

      // Remove the offset caused by any stacking context.
      this.style.left = (left - rect.left) + 'px';
      this.style.top = (top - rect.top) + 'px';
    },

    /**
     * Constrains the size of the element to `fitInto` by setting `max-height`
     * and/or `max-width`.
     */
    constrain: function() {
      if (this.horizontalAlign || this.verticalAlign) {
        return;
      }
      this._discoverInfo();

      var info = this._fitInfo;
      // position at (0px, 0px) if not already positioned, so we can measure the natural size.
      if (!info.positionedBy.vertically) {
        this.style.position = 'fixed';
        this.style.top = '0px';
      }
      if (!info.positionedBy.horizontally) {
        this.style.position = 'fixed';
        this.style.left = '0px';
      }

      // need border-box for margin/padding
      this.sizingTarget.style.boxSizing = 'border-box';
      // constrain the width and height if not already set
      var rect = this.getBoundingClientRect();
      if (!info.sizedBy.height) {
        this.__sizeDimension(rect, info.positionedBy.vertically, 'top', 'bottom', 'Height');
      }
      if (!info.sizedBy.width) {
        this.__sizeDimension(rect, info.positionedBy.horizontally, 'left', 'right', 'Width');
      }
    },

    /**
     * @protected
     * @deprecated
     */
    _sizeDimension: function(rect, positionedBy, start, end, extent) {
      this.__sizeDimension(rect, positionedBy, start, end, extent);
    },

    /**
     * @private
     */
    __sizeDimension: function(rect, positionedBy, start, end, extent) {
      var info = this._fitInfo;
      var fitRect = this.__getNormalizedRect(this.fitInto);
      var max = extent === 'Width' ? fitRect.width : fitRect.height;
      var flip = (positionedBy === end);
      var offset = flip ? max - rect[end] : rect[start];
      var margin = info.margin[flip ? start : end];
      var offsetExtent = 'offset' + extent;
      var sizingOffset = this[offsetExtent] - this.sizingTarget[offsetExtent];
      this.sizingTarget.style['max' + extent] = (max - margin - offset - sizingOffset) + 'px';
    },

    /**
     * Centers horizontally and vertically if not already positioned. This also sets
     * `position:fixed`.
     */
    center: function() {
      if (this.horizontalAlign || this.verticalAlign) {
        return;
      }
      this._discoverInfo();

      var positionedBy = this._fitInfo.positionedBy;
      if (positionedBy.vertically && positionedBy.horizontally) {
        // Already positioned.
        return;
      }
      // Need position:fixed to center
      this.style.position = 'fixed';
      // Take into account the offset caused by parents that create stacking
      // contexts (e.g. with transform: translate3d). Translate to 0,0 and
      // measure the bounding rect.
      if (!positionedBy.vertically) {
        this.style.top = '0px';
      }
      if (!positionedBy.horizontally) {
        this.style.left = '0px';
      }
      // It will take in consideration margins and transforms
      var rect = this.getBoundingClientRect();
      var fitRect = this.__getNormalizedRect(this.fitInto);
      if (!positionedBy.vertically) {
        var top = fitRect.top - rect.top + (fitRect.height - rect.height) / 2;
        this.style.top = top + 'px';
      }
      if (!positionedBy.horizontally) {
        var left = fitRect.left - rect.left + (fitRect.width - rect.width) / 2;
        this.style.left = left + 'px';
      }
    },

    __getNormalizedRect: function(target) {
      if (target === document.documentElement || target === window) {
        return {
          top: 0,
          left: 0,
          width: window.innerWidth,
          height: window.innerHeight,
          right: window.innerWidth,
          bottom: window.innerHeight
        };
      }
      return target.getBoundingClientRect();
    },

    __getCroppedArea: function(position, size, fitRect) {
      var verticalCrop = Math.min(0, position.top) + Math.min(0, fitRect.bottom - (position.top + size.height));
      var horizontalCrop = Math.min(0, position.left) + Math.min(0, fitRect.right - (position.left + size.width));
      return Math.abs(verticalCrop) * size.width + Math.abs(horizontalCrop) * size.height;
    },


    __getPosition: function(hAlign, vAlign, size, positionRect, fitRect) {
      // All the possible configurations.
      // Ordered as top-left, top-right, bottom-left, bottom-right.
      var positions = [{
        verticalAlign: 'top',
        horizontalAlign: 'left',
        top: positionRect.top,
        left: positionRect.left
      }, {
        verticalAlign: 'top',
        horizontalAlign: 'right',
        top: positionRect.top,
        left: positionRect.right - size.width
      }, {
        verticalAlign: 'bottom',
        horizontalAlign: 'left',
        top: positionRect.bottom - size.height,
        left: positionRect.left
      }, {
        verticalAlign: 'bottom',
        horizontalAlign: 'right',
        top: positionRect.bottom - size.height,
        left: positionRect.right - size.width
      }];

      if (this.noOverlap) {
        // Duplicate.
        for (var i = 0, l = positions.length; i < l; i++) {
          var copy = {};
          for (var key in positions[i]) {
            copy[key] = positions[i][key];
          }
          positions.push(copy);
        }
        // Horizontal overlap only.
        positions[0].top = positions[1].top += positionRect.height;
        positions[2].top = positions[3].top -= positionRect.height;
        // Vertical overlap only.
        positions[4].left = positions[6].left += positionRect.width;
        positions[5].left = positions[7].left -= positionRect.width;
      }

      // Consider auto as null for coding convenience.
      vAlign = vAlign === 'auto' ? null : vAlign;
      hAlign = hAlign === 'auto' ? null : hAlign;

      var position;
      for (var i = 0; i < positions.length; i++) {
        var pos = positions[i];

        // If both vAlign and hAlign are defined, return exact match.
        // For dynamicAlign and noOverlap we'll have more than one candidate, so
        // we'll have to check the croppedArea to make the best choice.
        if (!this.dynamicAlign && !this.noOverlap &&
            pos.verticalAlign === vAlign && pos.horizontalAlign === hAlign) {
          position = pos;
          break;
        }

        // Align is ok if alignment preferences are respected. If no preferences,
        // it is considered ok.
        var alignOk = (!vAlign || pos.verticalAlign === vAlign) &&
                      (!hAlign || pos.horizontalAlign === hAlign);

        // Filter out elements that don't match the alignment (if defined).
        // With dynamicAlign, we need to consider all the positions to find the
        // one that minimizes the cropped area.
        if (!this.dynamicAlign && !alignOk) {
          continue;
        }

        position = position || pos;
        pos.croppedArea = this.__getCroppedArea(pos, size, fitRect);
        var diff = pos.croppedArea - position.croppedArea;
        // Check which crops less. If it crops equally, check if align is ok.
        if (diff < 0 || (diff === 0 && alignOk)) {
          position = pos;
        }
        // If not cropped and respects the align requirements, keep it.
        // This allows to prefer positions overlapping horizontally over the
        // ones overlapping vertically.
        if (position.croppedArea === 0 && alignOk) {
          break;
        }
      }

      return position;
    }

  };
</script><script>
  /**
   * `IronResizableBehavior` is a behavior that can be used in Polymer elements to
   * coordinate the flow of resize events between "resizers" (elements that control the
   * size or hidden state of their children) and "resizables" (elements that need to be
   * notified when they are resized or un-hidden by their parents in order to take
   * action on their new measurements).
   *
   * Elements that perform measurement should add the `IronResizableBehavior` behavior to
   * their element definition and listen for the `iron-resize` event on themselves.
   * This event will be fired when they become showing after having been hidden,
   * when they are resized explicitly by another resizable, or when the window has been
   * resized.
   *
   * Note, the `iron-resize` event is non-bubbling.
   *
   * @polymerBehavior Polymer.IronResizableBehavior
   * @demo demo/index.html
   **/
  Polymer.IronResizableBehavior = {
    properties: {
      /**
       * The closest ancestor element that implements `IronResizableBehavior`.
       */
      _parentResizable: {
        type: Object,
        observer: '_parentResizableChanged'
      },

      /**
       * True if this element is currently notifying its descedant elements of
       * resize.
       */
      _notifyingDescendant: {
        type: Boolean,
        value: false
      }
    },

    listeners: {
      'iron-request-resize-notifications': '_onIronRequestResizeNotifications'
    },

    created: function() {
      // We don't really need property effects on these, and also we want them
      // to be created before the `_parentResizable` observer fires:
      this._interestedResizables = [];
      this._boundNotifyResize = this.notifyResize.bind(this);
    },

    attached: function() {
      this.fire('iron-request-resize-notifications', null, {
        node: this,
        bubbles: true,
        cancelable: true
      });

      if (!this._parentResizable) {
        window.addEventListener('resize', this._boundNotifyResize);
        this.notifyResize();
      }
    },

    detached: function() {
      if (this._parentResizable) {
        this._parentResizable.stopResizeNotificationsFor(this);
      } else {
        window.removeEventListener('resize', this._boundNotifyResize);
      }

      this._parentResizable = null;
    },

    /**
     * Can be called to manually notify a resizable and its descendant
     * resizables of a resize change.
     */
    notifyResize: function() {
      if (!this.isAttached) {
        return;
      }

      this._interestedResizables.forEach(function(resizable) {
        if (this.resizerShouldNotify(resizable)) {
          this._notifyDescendant(resizable);
        }
      }, this);

      this._fireResize();
    },

    /**
     * Used to assign the closest resizable ancestor to this resizable
     * if the ancestor detects a request for notifications.
     */
    assignParentResizable: function(parentResizable) {
      this._parentResizable = parentResizable;
    },

    /**
     * Used to remove a resizable descendant from the list of descendants
     * that should be notified of a resize change.
     */
    stopResizeNotificationsFor: function(target) {
      var index = this._interestedResizables.indexOf(target);

      if (index > -1) {
        this._interestedResizables.splice(index, 1);
        this.unlisten(target, 'iron-resize', '_onDescendantIronResize');
      }
    },

    /**
     * This method can be overridden to filter nested elements that should or
     * should not be notified by the current element. Return true if an element
     * should be notified, or false if it should not be notified.
     *
     * @param {HTMLElement} element A candidate descendant element that
     * implements `IronResizableBehavior`.
     * @return {boolean} True if the `element` should be notified of resize.
     */
    resizerShouldNotify: function(element) { return true; },

    _onDescendantIronResize: function(event) {
      if (this._notifyingDescendant) {
        event.stopPropagation();
        return;
      }

      // NOTE(cdata): In ShadowDOM, event retargetting makes echoing of the
      // otherwise non-bubbling event "just work." We do it manually here for
      // the case where Polymer is not using shadow roots for whatever reason:
      if (!Polymer.Settings.useShadow) {
        this._fireResize();
      }
    },

    _fireResize: function() {
      this.fire('iron-resize', null, {
        node: this,
        bubbles: false
      });
    },

    _onIronRequestResizeNotifications: function(event) {
      var target = event.path ? event.path[0] : event.target;

      if (target === this) {
        return;
      }

      if (this._interestedResizables.indexOf(target) === -1) {
        this._interestedResizables.push(target);
        this.listen(target, 'iron-resize', '_onDescendantIronResize');
      }

      target.assignParentResizable(this);
      this._notifyDescendant(target);

      event.stopPropagation();
    },

    _parentResizableChanged: function(parentResizable) {
      if (parentResizable) {
        window.removeEventListener('resize', this._boundNotifyResize);
      }
    },

    _notifyDescendant: function(descendant) {
      // NOTE(cdata): In IE10, attached is fired on children first, so it's
      // important not to notify them if the parent is not attached yet (or
      // else they will get redundantly notified when the parent attaches).
      if (!this.isAttached) {
        return;
      }

      this._notifyingDescendant = true;
      descendant.notifyResize();
      this._notifyingDescendant = false;
    }
  };
</script><script>
  (function() {
    'use strict';

    /**
     * Chrome uses an older version of DOM Level 3 Keyboard Events
     *
     * Most keys are labeled as text, but some are Unicode codepoints.
     * Values taken from: http://www.w3.org/TR/2007/WD-DOM-Level-3-Events-20071221/keyset.html#KeySet-Set
     */
    var KEY_IDENTIFIER = {
      'U+0008': 'backspace',
      'U+0009': 'tab',
      'U+001B': 'esc',
      'U+0020': 'space',
      'U+007F': 'del'
    };

    /**
     * Special table for KeyboardEvent.keyCode.
     * KeyboardEvent.keyIdentifier is better, and KeyBoardEvent.key is even better
     * than that.
     *
     * Values from: https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent.keyCode#Value_of_keyCode
     */
    var KEY_CODE = {
      8: 'backspace',
      9: 'tab',
      13: 'enter',
      27: 'esc',
      33: 'pageup',
      34: 'pagedown',
      35: 'end',
      36: 'home',
      32: 'space',
      37: 'left',
      38: 'up',
      39: 'right',
      40: 'down',
      46: 'del',
      106: '*'
    };

    /**
     * MODIFIER_KEYS maps the short name for modifier keys used in a key
     * combo string to the property name that references those same keys
     * in a KeyboardEvent instance.
     */
    var MODIFIER_KEYS = {
      'shift': 'shiftKey',
      'ctrl': 'ctrlKey',
      'alt': 'altKey',
      'meta': 'metaKey'
    };

    /**
     * KeyboardEvent.key is mostly represented by printable character made by
     * the keyboard, with unprintable keys labeled nicely.
     *
     * However, on OS X, Alt+char can make a Unicode character that follows an
     * Apple-specific mapping. In this case, we fall back to .keyCode.
     */
    var KEY_CHAR = /[a-z0-9*]/;

    /**
     * Matches a keyIdentifier string.
     */
    var IDENT_CHAR = /U\+/;

    /**
     * Matches arrow keys in Gecko 27.0+
     */
    var ARROW_KEY = /^arrow/;

    /**
     * Matches space keys everywhere (notably including IE10's exceptional name
     * `spacebar`).
     */
    var SPACE_KEY = /^space(bar)?/;

    /**
     * Matches ESC key.
     *
     * Value from: http://w3c.github.io/uievents-key/#key-Escape
     */
    var ESC_KEY = /^escape$/;

    /**
     * Transforms the key.
     * @param {string} key The KeyBoardEvent.key
     * @param {Boolean} [noSpecialChars] Limits the transformation to
     * alpha-numeric characters.
     */
    function transformKey(key, noSpecialChars) {
      var validKey = '';
      if (key) {
        var lKey = key.toLowerCase();
        if (lKey === ' ' || SPACE_KEY.test(lKey)) {
          validKey = 'space';
        } else if (ESC_KEY.test(lKey)) {
          validKey = 'esc';
        } else if (lKey.length == 1) {
          if (!noSpecialChars || KEY_CHAR.test(lKey)) {
            validKey = lKey;
          }
        } else if (ARROW_KEY.test(lKey)) {
          validKey = lKey.replace('arrow', '');
        } else if (lKey == 'multiply') {
          // numpad '*' can map to Multiply on IE/Windows
          validKey = '*';
        } else {
          validKey = lKey;
        }
      }
      return validKey;
    }

    function transformKeyIdentifier(keyIdent) {
      var validKey = '';
      if (keyIdent) {
        if (keyIdent in KEY_IDENTIFIER) {
          validKey = KEY_IDENTIFIER[keyIdent];
        } else if (IDENT_CHAR.test(keyIdent)) {
          keyIdent = parseInt(keyIdent.replace('U+', '0x'), 16);
          validKey = String.fromCharCode(keyIdent).toLowerCase();
        } else {
          validKey = keyIdent.toLowerCase();
        }
      }
      return validKey;
    }

    function transformKeyCode(keyCode) {
      var validKey = '';
      if (Number(keyCode)) {
        if (keyCode >= 65 && keyCode <= 90) {
          // ascii a-z
          // lowercase is 32 offset from uppercase
          validKey = String.fromCharCode(32 + keyCode);
        } else if (keyCode >= 112 && keyCode <= 123) {
          // function keys f1-f12
          validKey = 'f' + (keyCode - 112);
        } else if (keyCode >= 48 && keyCode <= 57) {
          // top 0-9 keys
          validKey = String(keyCode - 48);
        } else if (keyCode >= 96 && keyCode <= 105) {
          // num pad 0-9
          validKey = String(keyCode - 96);
        } else {
          validKey = KEY_CODE[keyCode];
        }
      }
      return validKey;
    }

    /**
      * Calculates the normalized key for a KeyboardEvent.
      * @param {KeyboardEvent} keyEvent
      * @param {Boolean} [noSpecialChars] Set to true to limit keyEvent.key
      * transformation to alpha-numeric chars. This is useful with key
      * combinations like shift + 2, which on FF for MacOS produces
      * keyEvent.key = @
      * To get 2 returned, set noSpecialChars = true
      * To get @ returned, set noSpecialChars = false
     */
    function normalizedKeyForEvent(keyEvent, noSpecialChars) {
      // Fall back from .key, to .detail.key for artifical keyboard events,
      // and then to deprecated .keyIdentifier and .keyCode.
      if (keyEvent.key) {
        return transformKey(keyEvent.key, noSpecialChars);
      }
      if (keyEvent.detail && keyEvent.detail.key) {
        return transformKey(keyEvent.detail.key, noSpecialChars);
      }
      return transformKeyIdentifier(keyEvent.keyIdentifier) ||
        transformKeyCode(keyEvent.keyCode) || '';
    }

    function keyComboMatchesEvent(keyCombo, event) {
      // For combos with modifiers we support only alpha-numeric keys
      var keyEvent = normalizedKeyForEvent(event, keyCombo.hasModifiers);
      return keyEvent === keyCombo.key &&
        (!keyCombo.hasModifiers || (
          !!event.shiftKey === !!keyCombo.shiftKey &&
          !!event.ctrlKey === !!keyCombo.ctrlKey &&
          !!event.altKey === !!keyCombo.altKey &&
          !!event.metaKey === !!keyCombo.metaKey)
        );
    }

    function parseKeyComboString(keyComboString) {
      if (keyComboString.length === 1) {
        return {
          combo: keyComboString,
          key: keyComboString,
          event: 'keydown'
        };
      }
      return keyComboString.split('+').reduce(function(parsedKeyCombo, keyComboPart) {
        var eventParts = keyComboPart.split(':');
        var keyName = eventParts[0];
        var event = eventParts[1];

        if (keyName in MODIFIER_KEYS) {
          parsedKeyCombo[MODIFIER_KEYS[keyName]] = true;
          parsedKeyCombo.hasModifiers = true;
        } else {
          parsedKeyCombo.key = keyName;
          parsedKeyCombo.event = event || 'keydown';
        }

        return parsedKeyCombo;
      }, {
        combo: keyComboString.split(':').shift()
      });
    }

    function parseEventString(eventString) {
      return eventString.trim().split(' ').map(function(keyComboString) {
        return parseKeyComboString(keyComboString);
      });
    }

    /**
     * `Polymer.IronA11yKeysBehavior` provides a normalized interface for processing
     * keyboard commands that pertain to [WAI-ARIA best practices](http://www.w3.org/TR/wai-aria-practices/#kbd_general_binding).
     * The element takes care of browser differences with respect to Keyboard events
     * and uses an expressive syntax to filter key presses.
     *
     * Use the `keyBindings` prototype property to express what combination of keys
     * will trigger the callback. A key binding has the format
     * `"KEY+MODIFIER:EVENT": "callback"` (`"KEY": "callback"` or
     * `"KEY:EVENT": "callback"` are valid as well). Some examples:
     *
     *      keyBindings: {
     *        'space': '_onKeydown', // same as 'space:keydown'
     *        'shift+tab': '_onKeydown',
     *        'enter:keypress': '_onKeypress',
     *        'esc:keyup': '_onKeyup'
     *      }
     *
     * The callback will receive with an event containing the following information in `event.detail`:
     *
     *      _onKeydown: function(event) {
     *        console.log(event.detail.combo); // KEY+MODIFIER, e.g. "shift+tab"
     *        console.log(event.detail.key); // KEY only, e.g. "tab"
     *        console.log(event.detail.event); // EVENT, e.g. "keydown"
     *        console.log(event.detail.keyboardEvent); // the original KeyboardEvent
     *      }
     *
     * Use the `keyEventTarget` attribute to set up event handlers on a specific
     * node.
     *
     * See the [demo source code](https://github.com/PolymerElements/iron-a11y-keys-behavior/blob/master/demo/x-key-aware.html)
     * for an example.
     *
     * @demo demo/index.html
     * @polymerBehavior
     */
    Polymer.IronA11yKeysBehavior = {
      properties: {
        /**
         * The EventTarget that will be firing relevant KeyboardEvents. Set it to
         * `null` to disable the listeners.
         * @type {?EventTarget}
         */
        keyEventTarget: {
          type: Object,
          value: function() {
            return this;
          }
        },

        /**
         * If true, this property will cause the implementing element to
         * automatically stop propagation on any handled KeyboardEvents.
         */
        stopKeyboardEventPropagation: {
          type: Boolean,
          value: false
        },

        _boundKeyHandlers: {
          type: Array,
          value: function() {
            return [];
          }
        },

        // We use this due to a limitation in IE10 where instances will have
        // own properties of everything on the "prototype".
        _imperativeKeyBindings: {
          type: Object,
          value: function() {
            return {};
          }
        }
      },

      observers: [
        '_resetKeyEventListeners(keyEventTarget, _boundKeyHandlers)'
      ],


      /**
       * To be used to express what combination of keys  will trigger the relative
       * callback. e.g. `keyBindings: { 'esc': '_onEscPressed'}`
       * @type {!Object}
       */
      keyBindings: {},

      registered: function() {
        this._prepKeyBindings();
      },

      attached: function() {
        this._listenKeyEventListeners();
      },

      detached: function() {
        this._unlistenKeyEventListeners();
      },

      /**
       * Can be used to imperatively add a key binding to the implementing
       * element. This is the imperative equivalent of declaring a keybinding
       * in the `keyBindings` prototype property.
       */
      addOwnKeyBinding: function(eventString, handlerName) {
        this._imperativeKeyBindings[eventString] = handlerName;
        this._prepKeyBindings();
        this._resetKeyEventListeners();
      },

      /**
       * When called, will remove all imperatively-added key bindings.
       */
      removeOwnKeyBindings: function() {
        this._imperativeKeyBindings = {};
        this._prepKeyBindings();
        this._resetKeyEventListeners();
      },

      /**
       * Returns true if a keyboard event matches `eventString`.
       *
       * @param {KeyboardEvent} event
       * @param {string} eventString
       * @return {boolean}
       */
      keyboardEventMatchesKeys: function(event, eventString) {
        var keyCombos = parseEventString(eventString);
        for (var i = 0; i < keyCombos.length; ++i) {
          if (keyComboMatchesEvent(keyCombos[i], event)) {
            return true;
          }
        }
        return false;
      },

      _collectKeyBindings: function() {
        var keyBindings = this.behaviors.map(function(behavior) {
          return behavior.keyBindings;
        });

        if (keyBindings.indexOf(this.keyBindings) === -1) {
          keyBindings.push(this.keyBindings);
        }

        return keyBindings;
      },

      _prepKeyBindings: function() {
        this._keyBindings = {};

        this._collectKeyBindings().forEach(function(keyBindings) {
          for (var eventString in keyBindings) {
            this._addKeyBinding(eventString, keyBindings[eventString]);
          }
        }, this);

        for (var eventString in this._imperativeKeyBindings) {
          this._addKeyBinding(eventString, this._imperativeKeyBindings[eventString]);
        }

        // Give precedence to combos with modifiers to be checked first.
        for (var eventName in this._keyBindings) {
          this._keyBindings[eventName].sort(function (kb1, kb2) {
            var b1 = kb1[0].hasModifiers;
            var b2 = kb2[0].hasModifiers;
            return (b1 === b2) ? 0 : b1 ? -1 : 1;
          })
        }
      },

      _addKeyBinding: function(eventString, handlerName) {
        parseEventString(eventString).forEach(function(keyCombo) {
          this._keyBindings[keyCombo.event] =
            this._keyBindings[keyCombo.event] || [];

          this._keyBindings[keyCombo.event].push([
            keyCombo,
            handlerName
          ]);
        }, this);
      },

      _resetKeyEventListeners: function() {
        this._unlistenKeyEventListeners();

        if (this.isAttached) {
          this._listenKeyEventListeners();
        }
      },

      _listenKeyEventListeners: function() {
        if (!this.keyEventTarget) {
          return;
        }
        Object.keys(this._keyBindings).forEach(function(eventName) {
          var keyBindings = this._keyBindings[eventName];
          var boundKeyHandler = this._onKeyBindingEvent.bind(this, keyBindings);

          this._boundKeyHandlers.push([this.keyEventTarget, eventName, boundKeyHandler]);

          this.keyEventTarget.addEventListener(eventName, boundKeyHandler);
        }, this);
      },

      _unlistenKeyEventListeners: function() {
        var keyHandlerTuple;
        var keyEventTarget;
        var eventName;
        var boundKeyHandler;

        while (this._boundKeyHandlers.length) {
          // My kingdom for block-scope binding and destructuring assignment..
          keyHandlerTuple = this._boundKeyHandlers.pop();
          keyEventTarget = keyHandlerTuple[0];
          eventName = keyHandlerTuple[1];
          boundKeyHandler = keyHandlerTuple[2];

          keyEventTarget.removeEventListener(eventName, boundKeyHandler);
        }
      },

      _onKeyBindingEvent: function(keyBindings, event) {
        if (this.stopKeyboardEventPropagation) {
          event.stopPropagation();
        }

        // if event has been already prevented, don't do anything
        if (event.defaultPrevented) {
          return;
        }

        for (var i = 0; i < keyBindings.length; i++) {
          var keyCombo = keyBindings[i][0];
          var handlerName = keyBindings[i][1];
          if (keyComboMatchesEvent(keyCombo, event)) {
            this._triggerKeyHandler(keyCombo, handlerName, event);
            // exit the loop if eventDefault was prevented
            if (event.defaultPrevented) {
              return;
            }
          }
        }
      },

      _triggerKeyHandler: function(keyCombo, handlerName, keyboardEvent) {
        var detail = Object.create(keyCombo);
        detail.keyboardEvent = keyboardEvent;
        var event = new CustomEvent(keyCombo.event, {
          detail: detail,
          cancelable: true
        });
        this[handlerName].call(this, event);
        if (event.defaultPrevented) {
          keyboardEvent.preventDefault();
        }
      }
    };
  })();
</script>

<dom-module id="iron-overlay-backdrop" assetpath="../iron-overlay-behavior/">

  <template>
    <style>
      :host {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--iron-overlay-backdrop-background-color, #000);
        opacity: 0;
        transition: opacity 0.2s;
        pointer-events: none;
        @apply(--iron-overlay-backdrop);
      }

      :host(.opened) {
        opacity: var(--iron-overlay-backdrop-opacity, 0.6);
        pointer-events: auto;
        @apply(--iron-overlay-backdrop-opened);
      }
    </style>

    <content></content>
  </template>

</dom-module>

<script>
(function() {
'use strict';

  Polymer({

    is: 'iron-overlay-backdrop',

    properties: {

      /**
       * Returns true if the backdrop is opened.
       */
      opened: {
        reflectToAttribute: true,
        type: Boolean,
        value: false,
        observer: '_openedChanged'
      }

    },

    listeners: {
      'transitionend': '_onTransitionend'
    },

    created: function() {
      // Used to cancel previous requestAnimationFrame calls when opened changes.
      this.__openedRaf = null;
    },

    attached: function() {
      this.opened && this._openedChanged(this.opened);
    },

    /**
     * Appends the backdrop to document body if needed.
     */
    prepare: function() {
      if (this.opened && !this.parentNode) {
        Polymer.dom(document.body).appendChild(this);
      }
    },

    /**
     * Shows the backdrop.
     */
    open: function() {
      this.opened = true;
    },

    /**
     * Hides the backdrop.
     */
    close: function() {
      this.opened = false;
    },

    /**
     * Removes the backdrop from document body if needed.
     */
    complete: function() {
      if (!this.opened && this.parentNode === document.body) {
        Polymer.dom(this.parentNode).removeChild(this);
      }
    },

    _onTransitionend: function(event) {
      if (event && event.target === this) {
        this.complete();
      }
    },

    /**
     * @param {boolean} opened
     * @private
     */
    _openedChanged: function(opened) {
      if (opened) {
        // Auto-attach.
        this.prepare();
      } else {
        // Animation might be disabled via the mixin or opacity custom property.
        // If it is disabled in other ways, it's up to the user to call complete.
        var cs = window.getComputedStyle(this);
        if (cs.transitionDuration === '0s' || cs.opacity == 0) {
          this.complete();
        }
      }

      if (!this.isAttached) {
        return;
      }

      // Always cancel previous requestAnimationFrame.
      if (this.__openedRaf) {
        window.cancelAnimationFrame(this.__openedRaf);
        this.__openedRaf = null;
      }
      // Force relayout to ensure proper transitions.
      this.scrollTop = this.scrollTop;
      this.__openedRaf = window.requestAnimationFrame(function() {
        this.__openedRaf = null;
        this.toggleClass('opened', this.opened);
      }.bind(this));
    }
  });

})();

</script>
<script>

  /**
   * @struct
   * @constructor
   * @private
   */
  Polymer.IronOverlayManagerClass = function() {
    /**
     * Used to keep track of the opened overlays.
     * @private {Array<Element>}
     */
    this._overlays = [];

    /**
     * iframes have a default z-index of 100,
     * so this default should be at least that.
     * @private {number}
     */
    this._minimumZ = 101;

    /**
     * Memoized backdrop element.
     * @private {Element|null}
     */
    this._backdropElement = null;

    // Enable document-wide tap recognizer.
    Polymer.Gestures.add(document, 'tap', this._onCaptureClick.bind(this));

    document.addEventListener('focus', this._onCaptureFocus.bind(this), true);
    document.addEventListener('keydown', this._onCaptureKeyDown.bind(this), true);
  };

  Polymer.IronOverlayManagerClass.prototype = {

    constructor: Polymer.IronOverlayManagerClass,

    /**
     * The shared backdrop element.
     * @type {!Element} backdropElement
     */
    get backdropElement() {
      if (!this._backdropElement) {
        this._backdropElement = document.createElement('iron-overlay-backdrop');
      }
      return this._backdropElement;
    },

    /**
     * The deepest active element.
     * @type {!Element} activeElement the active element
     */
    get deepActiveElement() {
      // document.activeElement can be null
      // https://developer.mozilla.org/en-US/docs/Web/API/Document/activeElement
      // In case of null, default it to document.body.
      var active = document.activeElement || document.body;
      while (active.root && Polymer.dom(active.root).activeElement) {
        active = Polymer.dom(active.root).activeElement;
      }
      return active;
    },

    /**
     * Brings the overlay at the specified index to the front.
     * @param {number} i
     * @private
     */
    _bringOverlayAtIndexToFront: function(i) {
      var overlay = this._overlays[i];
      if (!overlay) {
        return;
      }
      var lastI = this._overlays.length - 1;
      var currentOverlay = this._overlays[lastI];
      // Ensure always-on-top overlay stays on top.
      if (currentOverlay && this._shouldBeBehindOverlay(overlay, currentOverlay)) {
        lastI--;
      }
      // If already the top element, return.
      if (i >= lastI) {
        return;
      }
      // Update z-index to be on top.
      var minimumZ = Math.max(this.currentOverlayZ(), this._minimumZ);
      if (this._getZ(overlay) <= minimumZ) {
        this._applyOverlayZ(overlay, minimumZ);
      }

      // Shift other overlays behind the new on top.
      while (i < lastI) {
        this._overlays[i] = this._overlays[i + 1];
        i++;
      }
      this._overlays[lastI] = overlay;
    },

    /**
     * Adds the overlay and updates its z-index if it's opened, or removes it if it's closed.
     * Also updates the backdrop z-index.
     * @param {!Element} overlay
     */
    addOrRemoveOverlay: function(overlay) {
      if (overlay.opened) {
        this.addOverlay(overlay);
      } else {
        this.removeOverlay(overlay);
      }
    },

    /**
     * Tracks overlays for z-index and focus management.
     * Ensures the last added overlay with always-on-top remains on top.
     * @param {!Element} overlay
     */
    addOverlay: function(overlay) {
      var i = this._overlays.indexOf(overlay);
      if (i >= 0) {
        this._bringOverlayAtIndexToFront(i);
        this.trackBackdrop();
        return;
      }
      var insertionIndex = this._overlays.length;
      var currentOverlay = this._overlays[insertionIndex - 1];
      var minimumZ = Math.max(this._getZ(currentOverlay), this._minimumZ);
      var newZ = this._getZ(overlay);

      // Ensure always-on-top overlay stays on top.
      if (currentOverlay && this._shouldBeBehindOverlay(overlay, currentOverlay)) {
        // This bumps the z-index of +2.
        this._applyOverlayZ(currentOverlay, minimumZ);
        insertionIndex--;
        // Update minimumZ to match previous overlay's z-index.
        var previousOverlay = this._overlays[insertionIndex - 1];
        minimumZ = Math.max(this._getZ(previousOverlay), this._minimumZ);
      }

      // Update z-index and insert overlay.
      if (newZ <= minimumZ) {
        this._applyOverlayZ(overlay, minimumZ);
      }
      this._overlays.splice(insertionIndex, 0, overlay);

      this.trackBackdrop();
    },

    /**
     * @param {!Element} overlay
     */
    removeOverlay: function(overlay) {
      var i = this._overlays.indexOf(overlay);
      if (i === -1) {
        return;
      }
      this._overlays.splice(i, 1);

      this.trackBackdrop();
    },

    /**
     * Returns the current overlay.
     * @return {Element|undefined}
     */
    currentOverlay: function() {
      var i = this._overlays.length - 1;
      return this._overlays[i];
    },

    /**
     * Returns the current overlay z-index.
     * @return {number}
     */
    currentOverlayZ: function() {
      return this._getZ(this.currentOverlay());
    },

    /**
     * Ensures that the minimum z-index of new overlays is at least `minimumZ`.
     * This does not effect the z-index of any existing overlays.
     * @param {number} minimumZ
     */
    ensureMinimumZ: function(minimumZ) {
      this._minimumZ = Math.max(this._minimumZ, minimumZ);
    },

    focusOverlay: function() {
      var current = /** @type {?} */ (this.currentOverlay());
      if (current) {
        current._applyFocus();
      }
    },

    /**
     * Updates the backdrop z-index.
     */
    trackBackdrop: function() {
      var overlay = this._overlayWithBackdrop();
      // Avoid creating the backdrop if there is no overlay with backdrop.
      if (!overlay && !this._backdropElement) {
        return;
      }
      this.backdropElement.style.zIndex = this._getZ(overlay) - 1;
      this.backdropElement.opened = !!overlay;
    },

    /**
     * @return {Array<Element>}
     */
    getBackdrops: function() {
      var backdrops = [];
      for (var i = 0; i < this._overlays.length; i++) {
        if (this._overlays[i].withBackdrop) {
          backdrops.push(this._overlays[i]);
        }
      }
      return backdrops;
    },

    /**
     * Returns the z-index for the backdrop.
     * @return {number}
     */
    backdropZ: function() {
      return this._getZ(this._overlayWithBackdrop()) - 1;
    },

    /**
     * Returns the first opened overlay that has a backdrop.
     * @return {Element|undefined}
     * @private
     */
    _overlayWithBackdrop: function() {
      for (var i = 0; i < this._overlays.length; i++) {
        if (this._overlays[i].withBackdrop) {
          return this._overlays[i];
        }
      }
    },

    /**
     * Calculates the minimum z-index for the overlay.
     * @param {Element=} overlay
     * @private
     */
    _getZ: function(overlay) {
      var z = this._minimumZ;
      if (overlay) {
        var z1 = Number(overlay.style.zIndex || window.getComputedStyle(overlay).zIndex);
        // Check if is a number
        // Number.isNaN not supported in IE 10+
        if (z1 === z1) {
          z = z1;
        }
      }
      return z;
    },

    /**
     * @param {!Element} element
     * @param {number|string} z
     * @private
     */
    _setZ: function(element, z) {
      element.style.zIndex = z;
    },

    /**
     * @param {!Element} overlay
     * @param {number} aboveZ
     * @private
     */
    _applyOverlayZ: function(overlay, aboveZ) {
      this._setZ(overlay, aboveZ + 2);
    },

    /**
     * Returns the deepest overlay in the path.
     * @param {Array<Element>=} path
     * @return {Element|undefined}
     * @suppress {missingProperties}
     * @private
     */
    _overlayInPath: function(path) {
      path = path || [];
      for (var i = 0; i < path.length; i++) {
        if (path[i]._manager === this) {
          return path[i];
        }
      }
    },

    /**
     * Ensures the click event is delegated to the right overlay.
     * @param {!Event} event
     * @private
     */
    _onCaptureClick: function(event) {
      var overlay = /** @type {?} */ (this.currentOverlay());
      // Check if clicked outside of top overlay.
      if (overlay && this._overlayInPath(Polymer.dom(event).path) !== overlay) {
        overlay._onCaptureClick(event);
      }
    },

    /**
     * Ensures the focus event is delegated to the right overlay.
     * @param {!Event} event
     * @private
     */
    _onCaptureFocus: function(event) {
      var overlay = /** @type {?} */ (this.currentOverlay());
      if (overlay) {
        overlay._onCaptureFocus(event);
      }
    },

    /**
     * Ensures TAB and ESC keyboard events are delegated to the right overlay.
     * @param {!Event} event
     * @private
     */
    _onCaptureKeyDown: function(event) {
      var overlay = /** @type {?} */ (this.currentOverlay());
      if (overlay) {
        if (Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(event, 'esc')) {
          overlay._onCaptureEsc(event);
        } else if (Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(event, 'tab')) {
          overlay._onCaptureTab(event);
        }
      }
    },

    /**
     * Returns if the overlay1 should be behind overlay2.
     * @param {!Element} overlay1
     * @param {!Element} overlay2
     * @return {boolean}
     * @suppress {missingProperties}
     * @private
     */
    _shouldBeBehindOverlay: function(overlay1, overlay2) {
      return !overlay1.alwaysOnTop && overlay2.alwaysOnTop;
    }
  };

  Polymer.IronOverlayManager = new Polymer.IronOverlayManagerClass();
</script><script>
(function() {
'use strict';

/**
Use `Polymer.IronOverlayBehavior` to implement an element that can be hidden or shown, and displays
on top of other content. It includes an optional backdrop, and can be used to implement a variety
of UI controls including dialogs and drop downs. Multiple overlays may be displayed at once.

See the [demo source code](https://github.com/PolymerElements/iron-overlay-behavior/blob/master/demo/simple-overlay.html)
for an example.

### Closing and canceling

An overlay may be hidden by closing or canceling. The difference between close and cancel is user
intent. Closing generally implies that the user acknowledged the content on the overlay. By default,
it will cancel whenever the user taps outside it or presses the escape key. This behavior is
configurable with the `no-cancel-on-esc-key` and the `no-cancel-on-outside-click` properties.
`close()` should be called explicitly by the implementer when the user interacts with a control
in the overlay element. When the dialog is canceled, the overlay fires an 'iron-overlay-canceled'
event. Call `preventDefault` on this event to prevent the overlay from closing.

### Positioning

By default the element is sized and positioned to fit and centered inside the window. You can
position and size it manually using CSS. See `Polymer.IronFitBehavior`.

### Backdrop

Set the `with-backdrop` attribute to display a backdrop behind the overlay. The backdrop is
appended to `<body>` and is of type `<iron-overlay-backdrop>`. See its doc page for styling
options.

In addition, `with-backdrop` will wrap the focus within the content in the light DOM.
Override the [`_focusableNodes` getter](#Polymer.IronOverlayBehavior:property-_focusableNodes)
to achieve a different behavior.

### Limitations

The element is styled to appear on top of other content by setting its `z-index` property. You
must ensure no element has a stacking context with a higher `z-index` than its parent stacking
context. You should place this element as a child of `<body>` whenever possible.

@demo demo/index.html
@polymerBehavior Polymer.IronOverlayBehavior
*/

  Polymer.IronOverlayBehaviorImpl = {

    properties: {

      /**
       * True if the overlay is currently displayed.
       */
      opened: {
        observer: '_openedChanged',
        type: Boolean,
        value: false,
        notify: true
      },

      /**
       * True if the overlay was canceled when it was last closed.
       */
      canceled: {
        observer: '_canceledChanged',
        readOnly: true,
        type: Boolean,
        value: false
      },

      /**
       * Set to true to display a backdrop behind the overlay. It traps the focus
       * within the light DOM of the overlay.
       */
      withBackdrop: {
        observer: '_withBackdropChanged',
        type: Boolean
      },

      /**
       * Set to true to disable auto-focusing the overlay or child nodes with
       * the `autofocus` attribute` when the overlay is opened.
       */
      noAutoFocus: {
        type: Boolean,
        value: false
      },

      /**
       * Set to true to disable canceling the overlay with the ESC key.
       */
      noCancelOnEscKey: {
        type: Boolean,
        value: false
      },

      /**
       * Set to true to disable canceling the overlay by clicking outside it.
       */
      noCancelOnOutsideClick: {
        type: Boolean,
        value: false
      },

      /**
       * Contains the reason(s) this overlay was last closed (see `iron-overlay-closed`).
       * `IronOverlayBehavior` provides the `canceled` reason; implementers of the
       * behavior can provide other reasons in addition to `canceled`.
       */
      closingReason: {
        // was a getter before, but needs to be a property so other
        // behaviors can override this.
        type: Object
      },

      /**
       * Set to true to enable restoring of focus when overlay is closed.
       */
      restoreFocusOnClose: {
        type: Boolean,
        value: false
      },

      /**
       * Set to true to keep overlay always on top.
       */
      alwaysOnTop: {
        type: Boolean
      },

      /**
       * Shortcut to access to the overlay manager.
       * @private
       * @type {Polymer.IronOverlayManagerClass}
       */
      _manager: {
        type: Object,
        value: Polymer.IronOverlayManager
      },

      /**
       * The node being focused.
       * @type {?Node}
       */
      _focusedChild: {
        type: Object
      }

    },

    listeners: {
      'iron-resize': '_onIronResize'
    },

    /**
     * The backdrop element.
     * @type {Element}
     */
    get backdropElement() {
      return this._manager.backdropElement;
    },

    /**
     * Returns the node to give focus to.
     * @type {Node}
     */
    get _focusNode() {
      return this._focusedChild || Polymer.dom(this).querySelector('[autofocus]') || this;
    },

    /**
     * Array of nodes that can receive focus (overlay included), ordered by `tabindex`.
     * This is used to retrieve which is the first and last focusable nodes in order
     * to wrap the focus for overlays `with-backdrop`.
     *
     * If you know what is your content (specifically the first and last focusable children),
     * you can override this method to return only `[firstFocusable, lastFocusable];`
     * @type {Array<Node>}
     * @protected
     */
    get _focusableNodes() {
      // Elements that can be focused even if they have [disabled] attribute.
      var FOCUSABLE_WITH_DISABLED = [
        'a[href]',
        'area[href]',
        'iframe',
        '[tabindex]',
        '[contentEditable=true]'
      ];

      // Elements that cannot be focused if they have [disabled] attribute.
      var FOCUSABLE_WITHOUT_DISABLED = [
        'input',
        'select',
        'textarea',
        'button'
      ];

      // Discard elements with tabindex=-1 (makes them not focusable).
      var selector = FOCUSABLE_WITH_DISABLED.join(':not([tabindex="-1"]),') +
        ':not([tabindex="-1"]),' +
        FOCUSABLE_WITHOUT_DISABLED.join(':not([disabled]):not([tabindex="-1"]),') +
        ':not([disabled]):not([tabindex="-1"])';

      var focusables = Polymer.dom(this).querySelectorAll(selector);
      if (this.tabIndex >= 0) {
        // Insert at the beginning because we might have all elements with tabIndex = 0,
        // and the overlay should be the first of the list.
        focusables.splice(0, 0, this);
      }
      // Sort by tabindex.
      return focusables.sort(function (a, b) {
        if (a.tabIndex === b.tabIndex) {
          return 0;
        }
        if (a.tabIndex === 0 || a.tabIndex > b.tabIndex) {
          return 1;
        }
        return -1;
      });
    },

    ready: function() {
      // Used to skip calls to notifyResize and refit while the overlay is animating.
      this.__isAnimating = false;
      // with-backdrop needs tabindex to be set in order to trap the focus.
      // If it is not set, IronOverlayBehavior will set it, and remove it if with-backdrop = false.
      this.__shouldRemoveTabIndex = false;
      // Used for wrapping the focus on TAB / Shift+TAB.
      this.__firstFocusableNode = this.__lastFocusableNode = null;
      // Used by __onNextAnimationFrame to cancel any previous callback.
      this.__raf = null;
      // Focused node before overlay gets opened. Can be restored on close.
      this.__restoreFocusNode = null;
      this._ensureSetup();
    },

    attached: function() {
      // Call _openedChanged here so that position can be computed correctly.
      if (this.opened) {
        this._openedChanged(this.opened);
      }
      this._observer = Polymer.dom(this).observeNodes(this._onNodesChange);
    },

    detached: function() {
      Polymer.dom(this).unobserveNodes(this._observer);
      this._observer = null;
      if (this.__raf) {
        window.cancelAnimationFrame(this.__raf);
        this.__raf = null;
      }
      this._manager.removeOverlay(this);
    },

    /**
     * Toggle the opened state of the overlay.
     */
    toggle: function() {
      this._setCanceled(false);
      this.opened = !this.opened;
    },

    /**
     * Open the overlay.
     */
    open: function() {
      this._setCanceled(false);
      this.opened = true;
    },

    /**
     * Close the overlay.
     */
    close: function() {
      this._setCanceled(false);
      this.opened = false;
    },

    /**
     * Cancels the overlay.
     * @param {Event=} event The original event
     */
    cancel: function(event) {
      var cancelEvent = this.fire('iron-overlay-canceled', event, {cancelable: true});
      if (cancelEvent.defaultPrevented) {
        return;
      }

      this._setCanceled(true);
      this.opened = false;
    },

    /**
     * Invalidates the cached tabbable nodes. To be called when any of the focusable
     * content changes (e.g. a button is disabled).
     */
    invalidateTabbables: function() {
      this.__firstFocusableNode = this.__lastFocusableNode = null;
    },

    _ensureSetup: function() {
      if (this._overlaySetup) {
        return;
      }
      this._overlaySetup = true;
      this.style.outline = 'none';
      this.style.display = 'none';
    },

    /**
     * Called when `opened` changes.
     * @param {boolean=} opened
     * @protected
     */
    _openedChanged: function(opened) {
      if (opened) {
        this.removeAttribute('aria-hidden');
      } else {
        this.setAttribute('aria-hidden', 'true');
      }

      // Defer any animation-related code on attached
      // (_openedChanged gets called again on attached).
      if (!this.isAttached) {
        return;
      }

      this.__isAnimating = true;

      // Use requestAnimationFrame for non-blocking rendering.
      this.__onNextAnimationFrame(this.__openedChanged);
    },

    _canceledChanged: function() {
      this.closingReason = this.closingReason || {};
      this.closingReason.canceled = this.canceled;
    },

    _withBackdropChanged: function() {
      // If tabindex is already set, no need to override it.
      if (this.withBackdrop && !this.hasAttribute('tabindex')) {
        this.setAttribute('tabindex', '-1');
        this.__shouldRemoveTabIndex = true;
      } else if (this.__shouldRemoveTabIndex) {
        this.removeAttribute('tabindex');
        this.__shouldRemoveTabIndex = false;
      }
      if (this.opened && this.isAttached) {
        this._manager.trackBackdrop();
      }
    },

    /**
     * tasks which must occur before opening; e.g. making the element visible.
     * @protected
     */
    _prepareRenderOpened: function() {
      // Store focused node.
      this.__restoreFocusNode = this._manager.deepActiveElement;

      // Needed to calculate the size of the overlay so that transitions on its size
      // will have the correct starting points.
      this._preparePositioning();
      this.refit();
      this._finishPositioning();

      // Safari will apply the focus to the autofocus element when displayed
      // for the first time, so we make sure to return the focus where it was.
      if (this.noAutoFocus && document.activeElement === this._focusNode) {
        this._focusNode.blur();
        this.__restoreFocusNode.focus();
      }
    },

    /**
     * Tasks which cause the overlay to actually open; typically play an animation.
     * @protected
     */
    _renderOpened: function() {
      this._finishRenderOpened();
    },

    /**
     * Tasks which cause the overlay to actually close; typically play an animation.
     * @protected
     */
    _renderClosed: function() {
      this._finishRenderClosed();
    },

    /**
     * Tasks to be performed at the end of open action. Will fire `iron-overlay-opened`.
     * @protected
     */
    _finishRenderOpened: function() {
      this.notifyResize();
      this.__isAnimating = false;

      this.fire('iron-overlay-opened');
    },

    /**
     * Tasks to be performed at the end of close action. Will fire `iron-overlay-closed`.
     * @protected
     */
    _finishRenderClosed: function() {
      // Hide the overlay.
      this.style.display = 'none';
      // Reset z-index only at the end of the animation.
      this.style.zIndex = '';
      this.notifyResize();
      this.__isAnimating = false;
      this.fire('iron-overlay-closed', this.closingReason);
    },

    _preparePositioning: function() {
      this.style.transition = this.style.webkitTransition = 'none';
      this.style.transform = this.style.webkitTransform = 'none';
      this.style.display = '';
    },

    _finishPositioning: function() {
      // First, make it invisible & reactivate animations.
      this.style.display = 'none';
      // Force reflow before re-enabling animations so that they don't start.
      // Set scrollTop to itself so that Closure Compiler doesn't remove this.
      this.scrollTop = this.scrollTop;
      this.style.transition = this.style.webkitTransition = '';
      this.style.transform = this.style.webkitTransform = '';
      // Now that animations are enabled, make it visible again
      this.style.display = '';
      // Force reflow, so that following animations are properly started.
      // Set scrollTop to itself so that Closure Compiler doesn't remove this.
      this.scrollTop = this.scrollTop;
    },

    /**
     * Applies focus according to the opened state.
     * @protected
     */
    _applyFocus: function() {
      if (this.opened) {
        if (!this.noAutoFocus) {
          this._focusNode.focus();
        }
      }
      else {
        this._focusNode.blur();
        this._focusedChild = null;
        // Restore focus.
        if (this.restoreFocusOnClose && this.__restoreFocusNode) {
          this.__restoreFocusNode.focus();
        }
        this.__restoreFocusNode = null;
        // If many overlays get closed at the same time, one of them would still
        // be the currentOverlay even if already closed, and would call _applyFocus
        // infinitely, so we check for this not to be the current overlay.
        var currentOverlay = this._manager.currentOverlay();
        if (currentOverlay && this !== currentOverlay) {
          currentOverlay._applyFocus();
        }
      }
    },

    /**
     * Cancels (closes) the overlay. Call when click happens outside the overlay.
     * @param {!Event} event
     * @protected
     */
    _onCaptureClick: function(event) {
      if (!this.noCancelOnOutsideClick) {
        this.cancel(event);
      }
    },

    /**
     * Keeps track of the focused child. If withBackdrop, traps focus within overlay.
     * @param {!Event} event
     * @protected
     */
    _onCaptureFocus: function (event) {
      if (!this.withBackdrop) {
        return;
      }
      var path = Polymer.dom(event).path;
      if (path.indexOf(this) === -1) {
        event.stopPropagation();
        this._applyFocus();
      } else {
        this._focusedChild = path[0];
      }
    },

    /**
     * Handles the ESC key event and cancels (closes) the overlay.
     * @param {!Event} event
     * @protected
     */
    _onCaptureEsc: function(event) {
      if (!this.noCancelOnEscKey) {
        this.cancel(event);
      }
    },

    /**
     * Handles TAB key events to track focus changes.
     * Will wrap focus for overlays withBackdrop.
     * @param {!Event} event
     * @protected
     */
    _onCaptureTab: function(event) {
      if (!this.withBackdrop) {
        return;
      }
      this.__ensureFirstLastFocusables();
      // TAB wraps from last to first focusable.
      // Shift + TAB wraps from first to last focusable.
      var shift = event.shiftKey;
      var nodeToCheck = shift ? this.__firstFocusableNode : this.__lastFocusableNode;
      var nodeToSet = shift ? this.__lastFocusableNode : this.__firstFocusableNode;
      var shouldWrap = false;
      if (nodeToCheck === nodeToSet) {
        // If nodeToCheck is the same as nodeToSet, it means we have an overlay
        // with 0 or 1 focusables; in either case we still need to trap the
        // focus within the overlay.
        shouldWrap = true;
      } else {
        // In dom=shadow, the manager will receive focus changes on the main
        // root but not the ones within other shadow roots, so we can't rely on
        // _focusedChild, but we should check the deepest active element.
        var focusedNode = this._manager.deepActiveElement;
        // If the active element is not the nodeToCheck but the overlay itself,
        // it means the focus is about to go outside the overlay, hence we
        // should prevent that (e.g. user opens the overlay and hit Shift+TAB).
        shouldWrap = (focusedNode === nodeToCheck || focusedNode === this);
      }

      if (shouldWrap) {
        // When the overlay contains the last focusable element of the document
        // and it's already focused, pressing TAB would move the focus outside
        // the document (e.g. to the browser search bar). Similarly, when the
        // overlay contains the first focusable element of the document and it's
        // already focused, pressing Shift+TAB would move the focus outside the
        // document (e.g. to the browser search bar).
        // In both cases, we would not receive a focus event, but only a blur.
        // In order to achieve focus wrapping, we prevent this TAB event and
        // force the focus. This will also prevent the focus to temporarily move
        // outside the overlay, which might cause scrolling.
        event.preventDefault();
        this._focusedChild = nodeToSet;
        this._applyFocus();
      }
    },

    /**
     * Refits if the overlay is opened and not animating.
     * @protected
     */
    _onIronResize: function() {
      if (this.opened && !this.__isAnimating) {
        this.__onNextAnimationFrame(this.refit);
      }
    },

    /**
     * Will call notifyResize if overlay is opened.
     * Can be overridden in order to avoid multiple observers on the same node.
     * @protected
     */
    _onNodesChange: function() {
      if (this.opened && !this.__isAnimating) {
        // It might have added focusable nodes, so invalidate cached values.
        this.invalidateTabbables();
        this.notifyResize();
      }
    },

    /**
     * Will set first and last focusable nodes if any of them is not set.
     * @private
     */
    __ensureFirstLastFocusables: function() {
      if (!this.__firstFocusableNode || !this.__lastFocusableNode) {
        var focusableNodes = this._focusableNodes;
        this.__firstFocusableNode = focusableNodes[0];
        this.__lastFocusableNode = focusableNodes[focusableNodes.length - 1];
      }
    },

    /**
     * Tasks executed when opened changes: prepare for the opening, move the
     * focus, update the manager, render opened/closed.
     * @private
     */
    __openedChanged: function() {
      if (this.opened) {
        // Make overlay visible, then add it to the manager.
        this._prepareRenderOpened();
        this._manager.addOverlay(this);
        // Move the focus to the child node with [autofocus].
        this._applyFocus();

        this._renderOpened();
      } else {
        // Remove overlay, then restore the focus before actually closing.
        this._manager.removeOverlay(this);
        this._applyFocus();

        this._renderClosed();
      }
    },

    /**
     * Executes a callback on the next animation frame, overriding any previous
     * callback awaiting for the next animation frame. e.g.
     * `__onNextAnimationFrame(callback1) && __onNextAnimationFrame(callback2)`;
     * `callback1` will never be invoked.
     * @param {!Function} callback Its `this` parameter is the overlay itself.
     * @private
     */
    __onNextAnimationFrame: function(callback) {
      if (this.__raf) {
        window.cancelAnimationFrame(this.__raf);
      }
      var self = this;
      this.__raf = window.requestAnimationFrame(function nextAnimationFrame() {
        self.__raf = null;
        callback.call(self);
      });
    }

  };

  /** @polymerBehavior */
  Polymer.IronOverlayBehavior = [Polymer.IronFitBehavior, Polymer.IronResizableBehavior, Polymer.IronOverlayBehaviorImpl];

  /**
   * Fired after the overlay opens.
   * @event iron-overlay-opened
   */

  /**
   * Fired when the overlay is canceled, but before it is closed.
   * @event iron-overlay-canceled
   * @param {Event} event The closing of the overlay can be prevented
   * by calling `event.preventDefault()`. The `event.detail` is the original event that
   * originated the canceling (e.g. ESC keyboard event or click event outside the overlay).
   */

  /**
   * Fired after the overlay closes.
   * @event iron-overlay-closed
   * @param {Event} event The `event.detail` is the `closingReason` property
   * (contains `canceled`, whether the overlay was canceled).
   */

})();
</script><script>

/**
Use `Polymer.PaperDialogBehavior` and `paper-dialog-shared-styles.html` to implement a Material Design
dialog.

For example, if `<paper-dialog-impl>` implements this behavior:

    <paper-dialog-impl>
        <h2>Header</h2>
        <div>Dialog body</div>
        <div class="buttons">
            <paper-button dialog-dismiss>Cancel</paper-button>
            <paper-button dialog-confirm>Accept</paper-button>
        </div>
    </paper-dialog-impl>

`paper-dialog-shared-styles.html` provide styles for a header, content area, and an action area for buttons.
Use the `<h2>` tag for the header and the `buttons` class for the action area. You can use the
`paper-dialog-scrollable` element (in its own repository) if you need a scrolling content area.

Use the `dialog-dismiss` and `dialog-confirm` attributes on interactive controls to close the
dialog. If the user dismisses the dialog with `dialog-confirm`, the `closingReason` will update
to include `confirmed: true`.

### Accessibility

This element has `role="dialog"` by default. Depending on the context, it may be more appropriate
to override this attribute with `role="alertdialog"`.

If `modal` is set, the element will prevent the focus from exiting the element.
It will also ensure that focus remains in the dialog.

@hero hero.svg
@demo demo/index.html
@polymerBehavior Polymer.PaperDialogBehavior
*/

  Polymer.PaperDialogBehaviorImpl = {

    hostAttributes: {
      'role': 'dialog',
      'tabindex': '-1'
    },

    properties: {

      /**
       * If `modal` is true, this implies `no-cancel-on-outside-click`, `no-cancel-on-esc-key` and `with-backdrop`.
       */
      modal: {
        type: Boolean,
        value: false
      }

    },

    observers: [
      '_modalChanged(modal, _readied)'
    ],

    listeners: {
      'tap': '_onDialogClick'
    },

    ready: function () {
      // Only now these properties can be read.
      this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;
      this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;
      this.__prevWithBackdrop = this.withBackdrop;
    },

    _modalChanged: function(modal, readied) {
      // modal implies noCancelOnOutsideClick, noCancelOnEscKey and withBackdrop.
      // We need to wait for the element to be ready before we can read the
      // properties values.
      if (!readied) {
        return;
      }

      if (modal) {
        this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;
        this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;
        this.__prevWithBackdrop = this.withBackdrop;
        this.noCancelOnOutsideClick = true;
        this.noCancelOnEscKey = true;
        this.withBackdrop = true;
      } else {
        // If the value was changed to false, let it false.
        this.noCancelOnOutsideClick = this.noCancelOnOutsideClick &&
          this.__prevNoCancelOnOutsideClick;
        this.noCancelOnEscKey = this.noCancelOnEscKey &&
          this.__prevNoCancelOnEscKey;
        this.withBackdrop = this.withBackdrop && this.__prevWithBackdrop;
      }
    },

    _updateClosingReasonConfirmed: function(confirmed) {
      this.closingReason = this.closingReason || {};
      this.closingReason.confirmed = confirmed;
    },

    /**
     * Will dismiss the dialog if user clicked on an element with dialog-dismiss
     * or dialog-confirm attribute.
     */
    _onDialogClick: function(event) {
      // Search for the element with dialog-confirm or dialog-dismiss,
      // from the root target until this (excluded).
      var path = Polymer.dom(event).path;
      for (var i = 0; i < path.indexOf(this); i++) {
        var target = path[i];
        if (target.hasAttribute && (target.hasAttribute('dialog-dismiss') || target.hasAttribute('dialog-confirm'))) {
          this._updateClosingReasonConfirmed(target.hasAttribute('dialog-confirm'));
          this.close();
          event.stopPropagation();
          break;
        }
      }
    }

  };

  /** @polymerBehavior */
  Polymer.PaperDialogBehavior = [Polymer.IronOverlayBehavior, Polymer.PaperDialogBehaviorImpl];

</script>



<style is="custom-style">

  :root {

    /* Material Design color palette for Google products */

    --google-red-100: #f4c7c3;
    --google-red-300: #e67c73;
    --google-red-500: #db4437;
    --google-red-700: #c53929;

    --google-blue-100: #c6dafc;
    --google-blue-300: #7baaf7;
    --google-blue-500: #4285f4;
    --google-blue-700: #3367d6;

    --google-green-100: #b7e1cd;
    --google-green-300: #57bb8a;
    --google-green-500: #0f9d58;
    --google-green-700: #0b8043;

    --google-yellow-100: #fce8b2;
    --google-yellow-300: #f7cb4d;
    --google-yellow-500: #f4b400;
    --google-yellow-700: #f09300;

    --google-grey-100: #f5f5f5;
    --google-grey-300: #e0e0e0;
    --google-grey-500: #9e9e9e;
    --google-grey-700: #616161;
    
    /* Material Design color palette from online spec document */

    --paper-red-50: #ffebee;
    --paper-red-100: #ffcdd2;
    --paper-red-200: #ef9a9a;
    --paper-red-300: #e57373;
    --paper-red-400: #ef5350;
    --paper-red-500: #f44336;
    --paper-red-600: #e53935;
    --paper-red-700: #d32f2f;
    --paper-red-800: #c62828;
    --paper-red-900: #b71c1c;
    --paper-red-a100: #ff8a80;
    --paper-red-a200: #ff5252;
    --paper-red-a400: #ff1744;
    --paper-red-a700: #d50000;
 
    --paper-pink-50: #fce4ec;
    --paper-pink-100: #f8bbd0;
    --paper-pink-200: #f48fb1;
    --paper-pink-300: #f06292;
    --paper-pink-400: #ec407a;
    --paper-pink-500: #e91e63;
    --paper-pink-600: #d81b60;
    --paper-pink-700: #c2185b;
    --paper-pink-800: #ad1457;
    --paper-pink-900: #880e4f;
    --paper-pink-a100: #ff80ab;
    --paper-pink-a200: #ff4081;
    --paper-pink-a400: #f50057;
    --paper-pink-a700: #c51162;
 
    --paper-purple-50: #f3e5f5;
    --paper-purple-100: #e1bee7;
    --paper-purple-200: #ce93d8;
    --paper-purple-300: #ba68c8;
    --paper-purple-400: #ab47bc;
    --paper-purple-500: #9c27b0;
    --paper-purple-600: #8e24aa;
    --paper-purple-700: #7b1fa2;
    --paper-purple-800: #6a1b9a;
    --paper-purple-900: #4a148c;
    --paper-purple-a100: #ea80fc;
    --paper-purple-a200: #e040fb;
    --paper-purple-a400: #d500f9;
    --paper-purple-a700: #aa00ff;
 
    --paper-deep-purple-50: #ede7f6;
    --paper-deep-purple-100: #d1c4e9;
    --paper-deep-purple-200: #b39ddb;
    --paper-deep-purple-300: #9575cd;
    --paper-deep-purple-400: #7e57c2;
    --paper-deep-purple-500: #673ab7;
    --paper-deep-purple-600: #5e35b1;
    --paper-deep-purple-700: #512da8;
    --paper-deep-purple-800: #4527a0;
    --paper-deep-purple-900: #311b92;
    --paper-deep-purple-a100: #b388ff;
    --paper-deep-purple-a200: #7c4dff;
    --paper-deep-purple-a400: #651fff;
    --paper-deep-purple-a700: #6200ea;
 
    --paper-indigo-50: #e8eaf6;
    --paper-indigo-100: #c5cae9;
    --paper-indigo-200: #9fa8da;
    --paper-indigo-300: #7986cb;
    --paper-indigo-400: #5c6bc0;
    --paper-indigo-500: #3f51b5;
    --paper-indigo-600: #3949ab;
    --paper-indigo-700: #303f9f;
    --paper-indigo-800: #283593;
    --paper-indigo-900: #1a237e;
    --paper-indigo-a100: #8c9eff;
    --paper-indigo-a200: #536dfe;
    --paper-indigo-a400: #3d5afe;
    --paper-indigo-a700: #304ffe;
 
    --paper-blue-50: #e3f2fd;
    --paper-blue-100: #bbdefb;
    --paper-blue-200: #90caf9;
    --paper-blue-300: #64b5f6;
    --paper-blue-400: #42a5f5;
    --paper-blue-500: #2196f3;
    --paper-blue-600: #1e88e5;
    --paper-blue-700: #1976d2;
    --paper-blue-800: #1565c0;
    --paper-blue-900: #0d47a1;
    --paper-blue-a100: #82b1ff;
    --paper-blue-a200: #448aff;
    --paper-blue-a400: #2979ff;
    --paper-blue-a700: #2962ff;
 
    --paper-light-blue-50: #e1f5fe;
    --paper-light-blue-100: #b3e5fc;
    --paper-light-blue-200: #81d4fa;
    --paper-light-blue-300: #4fc3f7;
    --paper-light-blue-400: #29b6f6;
    --paper-light-blue-500: #03a9f4;
    --paper-light-blue-600: #039be5;
    --paper-light-blue-700: #0288d1;
    --paper-light-blue-800: #0277bd;
    --paper-light-blue-900: #01579b;
    --paper-light-blue-a100: #80d8ff;
    --paper-light-blue-a200: #40c4ff;
    --paper-light-blue-a400: #00b0ff;
    --paper-light-blue-a700: #0091ea;
 
    --paper-cyan-50: #e0f7fa;
    --paper-cyan-100: #b2ebf2;
    --paper-cyan-200: #80deea;
    --paper-cyan-300: #4dd0e1;
    --paper-cyan-400: #26c6da;
    --paper-cyan-500: #00bcd4;
    --paper-cyan-600: #00acc1;
    --paper-cyan-700: #0097a7;
    --paper-cyan-800: #00838f;
    --paper-cyan-900: #006064;
    --paper-cyan-a100: #84ffff;
    --paper-cyan-a200: #18ffff;
    --paper-cyan-a400: #00e5ff;
    --paper-cyan-a700: #00b8d4;
 
    --paper-teal-50: #e0f2f1;
    --paper-teal-100: #b2dfdb;
    --paper-teal-200: #80cbc4;
    --paper-teal-300: #4db6ac;
    --paper-teal-400: #26a69a;
    --paper-teal-500: #009688;
    --paper-teal-600: #00897b;
    --paper-teal-700: #00796b;
    --paper-teal-800: #00695c;
    --paper-teal-900: #004d40;
    --paper-teal-a100: #a7ffeb;
    --paper-teal-a200: #64ffda;
    --paper-teal-a400: #1de9b6;
    --paper-teal-a700: #00bfa5;
 
    --paper-green-50: #e8f5e9;
    --paper-green-100: #c8e6c9;
    --paper-green-200: #a5d6a7;
    --paper-green-300: #81c784;
    --paper-green-400: #66bb6a;
    --paper-green-500: #4caf50;
    --paper-green-600: #43a047;
    --paper-green-700: #388e3c;
    --paper-green-800: #2e7d32;
    --paper-green-900: #1b5e20;
    --paper-green-a100: #b9f6ca;
    --paper-green-a200: #69f0ae;
    --paper-green-a400: #00e676;
    --paper-green-a700: #00c853;
 
    --paper-light-green-50: #f1f8e9;
    --paper-light-green-100: #dcedc8;
    --paper-light-green-200: #c5e1a5;
    --paper-light-green-300: #aed581;
    --paper-light-green-400: #9ccc65;
    --paper-light-green-500: #8bc34a;
    --paper-light-green-600: #7cb342;
    --paper-light-green-700: #689f38;
    --paper-light-green-800: #558b2f;
    --paper-light-green-900: #33691e;
    --paper-light-green-a100: #ccff90;
    --paper-light-green-a200: #b2ff59;
    --paper-light-green-a400: #76ff03;
    --paper-light-green-a700: #64dd17;
 
    --paper-lime-50: #f9fbe7;
    --paper-lime-100: #f0f4c3;
    --paper-lime-200: #e6ee9c;
    --paper-lime-300: #dce775;
    --paper-lime-400: #d4e157;
    --paper-lime-500: #cddc39;
    --paper-lime-600: #c0ca33;
    --paper-lime-700: #afb42b;
    --paper-lime-800: #9e9d24;
    --paper-lime-900: #827717;
    --paper-lime-a100: #f4ff81;
    --paper-lime-a200: #eeff41;
    --paper-lime-a400: #c6ff00;
    --paper-lime-a700: #aeea00;
 
    --paper-yellow-50: #fffde7;
    --paper-yellow-100: #fff9c4;
    --paper-yellow-200: #fff59d;
    --paper-yellow-300: #fff176;
    --paper-yellow-400: #ffee58;
    --paper-yellow-500: #ffeb3b;
    --paper-yellow-600: #fdd835;
    --paper-yellow-700: #fbc02d;
    --paper-yellow-800: #f9a825;
    --paper-yellow-900: #f57f17;
    --paper-yellow-a100: #ffff8d;
    --paper-yellow-a200: #ffff00;
    --paper-yellow-a400: #ffea00;
    --paper-yellow-a700: #ffd600;
 
    --paper-amber-50: #fff8e1;
    --paper-amber-100: #ffecb3;
    --paper-amber-200: #ffe082;
    --paper-amber-300: #ffd54f;
    --paper-amber-400: #ffca28;
    --paper-amber-500: #ffc107;
    --paper-amber-600: #ffb300;
    --paper-amber-700: #ffa000;
    --paper-amber-800: #ff8f00;
    --paper-amber-900: #ff6f00;
    --paper-amber-a100: #ffe57f;
    --paper-amber-a200: #ffd740;
    --paper-amber-a400: #ffc400;
    --paper-amber-a700: #ffab00;
 
    --paper-orange-50: #fff3e0;
    --paper-orange-100: #ffe0b2;
    --paper-orange-200: #ffcc80;
    --paper-orange-300: #ffb74d;
    --paper-orange-400: #ffa726;
    --paper-orange-500: #ff9800;
    --paper-orange-600: #fb8c00;
    --paper-orange-700: #f57c00;
    --paper-orange-800: #ef6c00;
    --paper-orange-900: #e65100;
    --paper-orange-a100: #ffd180;
    --paper-orange-a200: #ffab40;
    --paper-orange-a400: #ff9100;
    --paper-orange-a700: #ff6500;
 
    --paper-deep-orange-50: #fbe9e7;
    --paper-deep-orange-100: #ffccbc;
    --paper-deep-orange-200: #ffab91;
    --paper-deep-orange-300: #ff8a65;
    --paper-deep-orange-400: #ff7043;
    --paper-deep-orange-500: #ff5722;
    --paper-deep-orange-600: #f4511e;
    --paper-deep-orange-700: #e64a19;
    --paper-deep-orange-800: #d84315;
    --paper-deep-orange-900: #bf360c;
    --paper-deep-orange-a100: #ff9e80;
    --paper-deep-orange-a200: #ff6e40;
    --paper-deep-orange-a400: #ff3d00;
    --paper-deep-orange-a700: #dd2c00;
 
    --paper-brown-50: #efebe9;
    --paper-brown-100: #d7ccc8;
    --paper-brown-200: #bcaaa4;
    --paper-brown-300: #a1887f;
    --paper-brown-400: #8d6e63;
    --paper-brown-500: #795548;
    --paper-brown-600: #6d4c41;
    --paper-brown-700: #5d4037;
    --paper-brown-800: #4e342e;
    --paper-brown-900: #3e2723;
 
    --paper-grey-50: #fafafa;
    --paper-grey-100: #f5f5f5;
    --paper-grey-200: #eeeeee;
    --paper-grey-300: #e0e0e0;
    --paper-grey-400: #bdbdbd;
    --paper-grey-500: #9e9e9e;
    --paper-grey-600: #757575;
    --paper-grey-700: #616161;
    --paper-grey-800: #424242;
    --paper-grey-900: #212121;
 
    --paper-blue-grey-50: #eceff1;
    --paper-blue-grey-100: #cfd8dc;
    --paper-blue-grey-200: #b0bec5;
    --paper-blue-grey-300: #90a4ae;
    --paper-blue-grey-400: #78909c;
    --paper-blue-grey-500: #607d8b;
    --paper-blue-grey-600: #546e7a;
    --paper-blue-grey-700: #455a64;
    --paper-blue-grey-800: #37474f;
    --paper-blue-grey-900: #263238;

    /* opacity for dark text on a light background */
    --dark-divider-opacity: 0.12;
    --dark-disabled-opacity: 0.38; /* or hint text or icon */
    --dark-secondary-opacity: 0.54;
    --dark-primary-opacity: 0.87;

    /* opacity for light text on a dark background */
    --light-divider-opacity: 0.12;
    --light-disabled-opacity: 0.3; /* or hint text or icon */
    --light-secondary-opacity: 0.7;
    --light-primary-opacity: 1.0;

  }

</style><style is="custom-style">

  :root {
    /*
     * You can use these generic variables in your elements for easy theming.
     * For example, if all your elements use `--primary-text-color` as its main
     * color, then switching from a light to a dark theme is just a matter of
     * changing the value of `--primary-text-color` in your application.
     */
    --primary-text-color: var(--light-theme-text-color);
    --primary-background-color: var(--light-theme-background-color);
    --secondary-text-color: var(--light-theme-secondary-color);
    --disabled-text-color: var(--light-theme-disabled-color);
    --divider-color: var(--light-theme-divider-color);
    --error-color: var(--paper-deep-orange-a700);

    /*
     * Primary and accent colors. Also see color.html for more colors.
     */
    --primary-color: var(--paper-indigo-500);
    --light-primary-color: var(--paper-indigo-100);
    --dark-primary-color: var(--paper-indigo-700);

    --accent-color: var(--paper-pink-a200);
    --light-accent-color: var(--paper-pink-a100);
    --dark-accent-color: var(--paper-pink-a400);


    /*
     * Material Design Light background theme
     */
    --light-theme-background-color: #ffffff;
    --light-theme-base-color: #000000;
    --light-theme-text-color: var(--paper-grey-900);
    --light-theme-secondary-color: #737373;  /* for secondary text and icons */
    --light-theme-disabled-color: #9b9b9b;  /* disabled/hint text */
    --light-theme-divider-color: #dbdbdb;

    /*
     * Material Design Dark background theme
     */
    --dark-theme-background-color: var(--paper-grey-900);
    --dark-theme-base-color: #ffffff;
    --dark-theme-text-color: #ffffff;
    --dark-theme-secondary-color: #bcbcbc;  /* for secondary text and icons */
    --dark-theme-disabled-color: #646464;  /* disabled/hint text */
    --dark-theme-divider-color: #3c3c3c;

    /*
     * Deprecated values because of their confusing names.
     */
    --text-primary-color: var(--dark-theme-text-color);
    --default-primary-color: var(--primary-color);

  }

</style><style>
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-Thin.ttf") format("truetype");
font-weight: 100;
font-style: normal;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-ThinItalic.ttf") format("truetype");
font-weight: 100;
font-style: italic;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-Light.ttf") format("truetype");
font-weight: 300;
font-style: normal;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-LightItalic.ttf") format("truetype");
font-weight: 300;
font-style: italic;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-Regular.ttf") format("truetype");
font-weight: 400;
font-style: normal;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-Italic.ttf") format("truetype");
font-weight: 400;
font-style: italic;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-Medium.ttf") format("truetype");
font-weight: 500;
font-style: normal;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-MediumItalic.ttf") format("truetype");
font-weight: 500;
font-style: italic;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-Bold.ttf") format("truetype");
font-weight: 700;
font-style: normal;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-BoldItalic.ttf") format("truetype");
font-weight: 700;
font-style: italic;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-Black.ttf") format("truetype");
font-weight: 900;
font-style: normal;
}
@font-face {
font-family: "Roboto";
src: url("../font-roboto/fonts/roboto/Roboto-BlackItalic.ttf") format("truetype");
font-weight: 900;
font-style: italic;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-Thin.ttf") format("truetype");
font-weight: 100;
font-style: normal;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-ThinItalic.ttf") format("truetype");
font-weight: 100;
font-style: italic;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-Light.ttf") format("truetype");
font-weight: 300;
font-style: normal;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-LightItalic.ttf") format("truetype");
font-weight: 300;
font-style: italic;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-Regular.ttf") format("truetype");
font-weight: 400;
font-style: normal;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-Italic.ttf") format("truetype");
font-weight: 400;
font-style: italic;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-Medium.ttf") format("truetype");
font-weight: 500;
font-style: normal;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-MediumItalic.ttf") format("truetype");
font-weight: 500;
font-style: italic;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-Bold.ttf") format("truetype");
font-weight: 700;
font-style: normal;
}
@font-face {
font-family: "Roboto Mono";
src: url("../font-roboto/fonts/robotomono/RobotoMono-BoldItalic.ttf") format("truetype");
font-weight: 700;
font-style: italic;
}
</style>
<style is="custom-style">

  :root {

    /* Shared Styles */
    --paper-font-common-base: {
      font-family: 'Roboto', 'Noto', sans-serif;
      -webkit-font-smoothing: antialiased;
    };

    --paper-font-common-code: {
      font-family: 'Roboto Mono', 'Consolas', 'Menlo', monospace;
      -webkit-font-smoothing: antialiased;
    };

    --paper-font-common-expensive-kerning: {
      text-rendering: optimizeLegibility;
    };

    --paper-font-common-nowrap: {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    };

    /* Material Font Styles */

    --paper-font-display4: {
      @apply(--paper-font-common-base);
      @apply(--paper-font-common-nowrap);

      font-size: 112px;
      font-weight: 300;
      letter-spacing: -.044em;
      line-height: 120px;
    };

    --paper-font-display3: {
      @apply(--paper-font-common-base);
      @apply(--paper-font-common-nowrap);

      font-size: 56px;
      font-weight: 400;
      letter-spacing: -.026em;
      line-height: 60px;
    };

    --paper-font-display2: {
      @apply(--paper-font-common-base);

      font-size: 45px;
      font-weight: 400;
      letter-spacing: -.018em;
      line-height: 48px;
    };

    --paper-font-display1: {
      @apply(--paper-font-common-base);

      font-size: 34px;
      font-weight: 400;
      letter-spacing: -.01em;
      line-height: 40px;
    };

    --paper-font-headline: {
      @apply(--paper-font-common-base);

      font-size: 24px;
      font-weight: 400;
      letter-spacing: -.012em;
      line-height: 32px;
    };

    --paper-font-title: {
      @apply(--paper-font-common-base);
      @apply(--paper-font-common-nowrap);

      font-size: 20px;
      font-weight: 500;
      line-height: 28px;
    };

    --paper-font-subhead: {
      @apply(--paper-font-common-base);

      font-size: 16px;
      font-weight: 400;
      line-height: 24px;
    };

    --paper-font-body2: {
      @apply(--paper-font-common-base);

      font-size: 14px;
      font-weight: 500;
      line-height: 24px;
    };

    --paper-font-body1: {
      @apply(--paper-font-common-base);

      font-size: 14px;
      font-weight: 400;
      line-height: 20px;
    };

    --paper-font-caption: {
      @apply(--paper-font-common-base);
      @apply(--paper-font-common-nowrap);

      font-size: 12px;
      font-weight: 400;
      letter-spacing: 0.011em;
      line-height: 20px;
    };

    --paper-font-menu: {
      @apply(--paper-font-common-base);
      @apply(--paper-font-common-nowrap);

      font-size: 13px;
      font-weight: 500;
      line-height: 24px;
    };

    --paper-font-button: {
      @apply(--paper-font-common-base);
      @apply(--paper-font-common-nowrap);

      font-size: 14px;
      font-weight: 500;
      letter-spacing: 0.018em;
      line-height: 24px;
      text-transform: uppercase;
    };

    --paper-font-code2: {
      @apply(--paper-font-common-code);

      font-size: 14px;
      font-weight: 700;
      line-height: 20px;
    };

    --paper-font-code1: {
      @apply(--paper-font-common-code);

      font-size: 14px;
      font-weight: 500;
      line-height: 20px;
    };

  }

</style><style is="custom-style">

  :root {

    --shadow-transition: {
      transition: box-shadow 0.28s cubic-bezier(0.4, 0, 0.2, 1);
    };

    --shadow-none: {
      box-shadow: none;
    };

    /* from http://codepen.io/shyndman/pen/c5394ddf2e8b2a5c9185904b57421cdb */

    --shadow-elevation-2dp: {
      box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),
                  0 1px 5px 0 rgba(0, 0, 0, 0.12),
                  0 3px 1px -2px rgba(0, 0, 0, 0.2);
    };

    --shadow-elevation-3dp: {
      box-shadow: 0 3px 4px 0 rgba(0, 0, 0, 0.14),
                  0 1px 8px 0 rgba(0, 0, 0, 0.12),
                  0 3px 3px -2px rgba(0, 0, 0, 0.4);
    };

    --shadow-elevation-4dp: {
      box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14),
                  0 1px 10px 0 rgba(0, 0, 0, 0.12),
                  0 2px 4px -1px rgba(0, 0, 0, 0.4);
    };

    --shadow-elevation-6dp: {
      box-shadow: 0 6px 10px 0 rgba(0, 0, 0, 0.14),
                  0 1px 18px 0 rgba(0, 0, 0, 0.12),
                  0 3px 5px -1px rgba(0, 0, 0, 0.4);
    };

    --shadow-elevation-8dp: {
      box-shadow: 0 8px 10px 1px rgba(0, 0, 0, 0.14),
                  0 3px 14px 2px rgba(0, 0, 0, 0.12),
                  0 5px 5px -3px rgba(0, 0, 0, 0.4);
    };

    --shadow-elevation-12dp: {
      box-shadow: 0 12px 16px 1px rgba(0, 0, 0, 0.14),
                  0 4px 22px 3px rgba(0, 0, 0, 0.12),
                  0 6px 7px -4px rgba(0, 0, 0, 0.4);
    };

    --shadow-elevation-16dp: {
      box-shadow: 0 16px 24px 2px rgba(0, 0, 0, 0.14),
                  0  6px 30px 5px rgba(0, 0, 0, 0.12),
                  0  8px 10px -5px rgba(0, 0, 0, 0.4);
    };

    --shadow-elevation-24dp: {
      box-shadow: 0 24px 38px 3px rgba(0, 0, 0, 0.14),
                  0 9px 46px 8px rgba(0, 0, 0, 0.12),
                  0 11px 15px -7px rgba(0, 0, 0, 0.4);
    };
  }

</style><dom-module id="paper-dialog-shared-styles" assetpath="../paper-dialog-behavior/">
  <template>
    <style>
      :host {
        display: block;
        margin: 24px 40px;

        background: var(--paper-dialog-background-color, --primary-background-color);
        color: var(--paper-dialog-color, --primary-text-color);

        @apply(--paper-font-body1);
        @apply(--shadow-elevation-16dp);
        @apply(--paper-dialog);
      }

      :host > ::content > * {
        margin-top: 20px;
        padding: 0 24px;
      }

      :host > ::content > .no-padding {
        padding: 0;
      }

      :host > ::content > *:first-child {
        margin-top: 24px;
      }

      :host > ::content > *:last-child {
        margin-bottom: 24px;
      }

      :host > ::content h2 {
        position: relative;
        margin: 0;
        @apply(--paper-font-title);

        @apply(--paper-dialog-title);
      }

      :host > ::content .buttons {
        position: relative;
        padding: 8px 8px 8px 24px;
        margin: 0;

        color: var(--paper-dialog-button-color, --primary-color);

        @apply(--layout-horizontal);
        @apply(--layout-end-justified);
      }
    </style>
  </template>
</dom-module>
<dom-module id="paper-dialog" assetpath="../paper-dialog/">
  <template>
    <style include="paper-dialog-shared-styles"></style>
    <content></content>
  </template>
</dom-module>

<script>

(function() {

  Polymer({

    is: 'paper-dialog',

    behaviors: [
      Polymer.PaperDialogBehavior,
      Polymer.NeonAnimationRunnerBehavior
    ],

    listeners: {
      'neon-animation-finish': '_onNeonAnimationFinish'
    },

    _renderOpened: function() {
      this.cancelAnimation();
      this.playAnimation('entry');
    },

    _renderClosed: function() {
      this.cancelAnimation();
      this.playAnimation('exit');
    },

    _onNeonAnimationFinish: function() {
      if (this.opened) {
        this._finishRenderOpened();
      } else {
        this._finishRenderClosed();
      }
    }

  });

})();

</script>


<script>

  /**
   * @demo demo/index.html
   * @polymerBehavior
   */
  Polymer.IronControlState = {

    properties: {

      /**
       * If true, the element currently has focus.
       */
      focused: {
        type: Boolean,
        value: false,
        notify: true,
        readOnly: true,
        reflectToAttribute: true
      },

      /**
       * If true, the user cannot interact with this element.
       */
      disabled: {
        type: Boolean,
        value: false,
        notify: true,
        observer: '_disabledChanged',
        reflectToAttribute: true
      },

      _oldTabIndex: {
        type: Number
      },

      _boundFocusBlurHandler: {
        type: Function,
        value: function() {
          return this._focusBlurHandler.bind(this);
        }
      }

    },

    observers: [
      '_changedControlState(focused, disabled)'
    ],

    ready: function() {
      this.addEventListener('focus', this._boundFocusBlurHandler, true);
      this.addEventListener('blur', this._boundFocusBlurHandler, true);
    },

    _focusBlurHandler: function(event) {
      // NOTE(cdata):  if we are in ShadowDOM land, `event.target` will
      // eventually become `this` due to retargeting; if we are not in
      // ShadowDOM land, `event.target` will eventually become `this` due
      // to the second conditional which fires a synthetic event (that is also
      // handled). In either case, we can disregard `event.path`.

      if (event.target === this) {
        this._setFocused(event.type === 'focus');
      } else if (!this.shadowRoot) {
        var target = /** @type {Node} */(Polymer.dom(event).localTarget);
        if (!this.isLightDescendant(target)) {
          this.fire(event.type, {sourceEvent: event}, {
            node: this,
            bubbles: event.bubbles,
            cancelable: event.cancelable
          });
        }
      }
    },

    _disabledChanged: function(disabled, old) {
      this.setAttribute('aria-disabled', disabled ? 'true' : 'false');
      this.style.pointerEvents = disabled ? 'none' : '';
      if (disabled) {
        this._oldTabIndex = this.tabIndex;
        this._setFocused(false);
        this.tabIndex = -1;
        this.blur();
      } else if (this._oldTabIndex !== undefined) {
        this.tabIndex = this._oldTabIndex;
      }
    },

    _changedControlState: function() {
      // _controlStateChanged is abstract, follow-on behaviors may implement it
      if (this._controlStateChanged) {
        this._controlStateChanged();
      }
    }

  };

</script><script>

  /**
   * @demo demo/index.html
   * @polymerBehavior Polymer.IronButtonState
   */
  Polymer.IronButtonStateImpl = {

    properties: {

      /**
       * If true, the user is currently holding down the button.
       */
      pressed: {
        type: Boolean,
        readOnly: true,
        value: false,
        reflectToAttribute: true,
        observer: '_pressedChanged'
      },

      /**
       * If true, the button toggles the active state with each tap or press
       * of the spacebar.
       */
      toggles: {
        type: Boolean,
        value: false,
        reflectToAttribute: true
      },

      /**
       * If true, the button is a toggle and is currently in the active state.
       */
      active: {
        type: Boolean,
        value: false,
        notify: true,
        reflectToAttribute: true
      },

      /**
       * True if the element is currently being pressed by a "pointer," which
       * is loosely defined as mouse or touch input (but specifically excluding
       * keyboard input).
       */
      pointerDown: {
        type: Boolean,
        readOnly: true,
        value: false
      },

      /**
       * True if the input device that caused the element to receive focus
       * was a keyboard.
       */
      receivedFocusFromKeyboard: {
        type: Boolean,
        readOnly: true
      },

      /**
       * The aria attribute to be set if the button is a toggle and in the
       * active state.
       */
      ariaActiveAttribute: {
        type: String,
        value: 'aria-pressed',
        observer: '_ariaActiveAttributeChanged'
      }
    },

    listeners: {
      down: '_downHandler',
      up: '_upHandler',
      tap: '_tapHandler'
    },

    observers: [
      '_detectKeyboardFocus(focused)',
      '_activeChanged(active, ariaActiveAttribute)'
    ],

    keyBindings: {
      'enter:keydown': '_asyncClick',
      'space:keydown': '_spaceKeyDownHandler',
      'space:keyup': '_spaceKeyUpHandler',
    },

    _mouseEventRe: /^mouse/,

    _tapHandler: function() {
      if (this.toggles) {
       // a tap is needed to toggle the active state
        this._userActivate(!this.active);
      } else {
        this.active = false;
      }
    },

    _detectKeyboardFocus: function(focused) {
      this._setReceivedFocusFromKeyboard(!this.pointerDown && focused);
    },

    // to emulate native checkbox, (de-)activations from a user interaction fire
    // 'change' events
    _userActivate: function(active) {
      if (this.active !== active) {
        this.active = active;
        this.fire('change');
      }
    },

    _downHandler: function(event) {
      this._setPointerDown(true);
      this._setPressed(true);
      this._setReceivedFocusFromKeyboard(false);
    },

    _upHandler: function() {
      this._setPointerDown(false);
      this._setPressed(false);
    },

    /**
     * @param {!KeyboardEvent} event .
     */
    _spaceKeyDownHandler: function(event) {
      var keyboardEvent = event.detail.keyboardEvent;
      var target = Polymer.dom(keyboardEvent).localTarget;

      // Ignore the event if this is coming from a focused light child, since that
      // element will deal with it.
      if (this.isLightDescendant(/** @type {Node} */(target)))
        return;

      keyboardEvent.preventDefault();
      keyboardEvent.stopImmediatePropagation();
      this._setPressed(true);
    },

    /**
     * @param {!KeyboardEvent} event .
     */
    _spaceKeyUpHandler: function(event) {
      var keyboardEvent = event.detail.keyboardEvent;
      var target = Polymer.dom(keyboardEvent).localTarget;

      // Ignore the event if this is coming from a focused light child, since that
      // element will deal with it.
      if (this.isLightDescendant(/** @type {Node} */(target)))
        return;

      if (this.pressed) {
        this._asyncClick();
      }
      this._setPressed(false);
    },

    // trigger click asynchronously, the asynchrony is useful to allow one
    // event handler to unwind before triggering another event
    _asyncClick: function() {
      this.async(function() {
        this.click();
      }, 1);
    },

    // any of these changes are considered a change to button state

    _pressedChanged: function(pressed) {
      this._changedButtonState();
    },

    _ariaActiveAttributeChanged: function(value, oldValue) {
      if (oldValue && oldValue != value && this.hasAttribute(oldValue)) {
        this.removeAttribute(oldValue);
      }
    },

    _activeChanged: function(active, ariaActiveAttribute) {
      if (this.toggles) {
        this.setAttribute(this.ariaActiveAttribute,
                          active ? 'true' : 'false');
      } else {
        this.removeAttribute(this.ariaActiveAttribute);
      }
      this._changedButtonState();
    },

    _controlStateChanged: function() {
      if (this.disabled) {
        this._setPressed(false);
      } else {
        this._changedButtonState();
      }
    },

    // provide hook for follow-on behaviors to react to button-state

    _changedButtonState: function() {
      if (this._buttonStateChanged) {
        this._buttonStateChanged(); // abstract
      }
    }

  };

  /** @polymerBehavior */
  Polymer.IronButtonState = [
    Polymer.IronA11yKeysBehavior,
    Polymer.IronButtonStateImpl
  ];

</script>

<dom-module id="paper-ripple" assetpath="../paper-ripple/">

  <template>
    <style>
      :host {
        display: block;
        position: absolute;
        border-radius: inherit;
        overflow: hidden;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;

        /* See PolymerElements/paper-behaviors/issues/34. On non-Chrome browsers,
         * creating a node (with a position:absolute) in the middle of an event
         * handler "interrupts" that event handler (which happens when the
         * ripple is created on demand) */
        pointer-events: none;
      }

      :host([animating]) {
        /* This resolves a rendering issue in Chrome (as of 40) where the
           ripple is not properly clipped by its parent (which may have
           rounded corners). See: http://jsbin.com/temexa/4

           Note: We only apply this style conditionally. Otherwise, the browser
           will create a new compositing layer for every ripple element on the
           page, and that would be bad. */
        -webkit-transform: translate(0, 0);
        transform: translate3d(0, 0, 0);
      }

      #background,
      #waves,
      .wave-container,
      .wave {
        pointer-events: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      #background,
      .wave {
        opacity: 0;
      }

      #waves,
      .wave {
        overflow: hidden;
      }

      .wave-container,
      .wave {
        border-radius: 50%;
      }

      :host(.circle) #background,
      :host(.circle) #waves {
        border-radius: 50%;
      }

      :host(.circle) .wave-container {
        overflow: hidden;
      }
    </style>

    <div id="background"></div>
    <div id="waves"></div>
  </template>
</dom-module>
<script>
  (function() {
    var Utility = {
      distance: function(x1, y1, x2, y2) {
        var xDelta = (x1 - x2);
        var yDelta = (y1 - y2);

        return Math.sqrt(xDelta * xDelta + yDelta * yDelta);
      },

      now: window.performance && window.performance.now ?
          window.performance.now.bind(window.performance) : Date.now
    };

    /**
     * @param {HTMLElement} element
     * @constructor
     */
    function ElementMetrics(element) {
      this.element = element;
      this.width = this.boundingRect.width;
      this.height = this.boundingRect.height;

      this.size = Math.max(this.width, this.height);
    }

    ElementMetrics.prototype = {
      get boundingRect () {
        return this.element.getBoundingClientRect();
      },

      furthestCornerDistanceFrom: function(x, y) {
        var topLeft = Utility.distance(x, y, 0, 0);
        var topRight = Utility.distance(x, y, this.width, 0);
        var bottomLeft = Utility.distance(x, y, 0, this.height);
        var bottomRight = Utility.distance(x, y, this.width, this.height);

        return Math.max(topLeft, topRight, bottomLeft, bottomRight);
      }
    };

    /**
     * @param {HTMLElement} element
     * @constructor
     */
    function Ripple(element) {
      this.element = element;
      this.color = window.getComputedStyle(element).color;

      this.wave = document.createElement('div');
      this.waveContainer = document.createElement('div');
      this.wave.style.backgroundColor = this.color;
      this.wave.classList.add('wave');
      this.waveContainer.classList.add('wave-container');
      Polymer.dom(this.waveContainer).appendChild(this.wave);

      this.resetInteractionState();
    }

    Ripple.MAX_RADIUS = 300;

    Ripple.prototype = {
      get recenters() {
        return this.element.recenters;
      },

      get center() {
        return this.element.center;
      },

      get mouseDownElapsed() {
        var elapsed;

        if (!this.mouseDownStart) {
          return 0;
        }

        elapsed = Utility.now() - this.mouseDownStart;

        if (this.mouseUpStart) {
          elapsed -= this.mouseUpElapsed;
        }

        return elapsed;
      },

      get mouseUpElapsed() {
        return this.mouseUpStart ?
          Utility.now () - this.mouseUpStart : 0;
      },

      get mouseDownElapsedSeconds() {
        return this.mouseDownElapsed / 1000;
      },

      get mouseUpElapsedSeconds() {
        return this.mouseUpElapsed / 1000;
      },

      get mouseInteractionSeconds() {
        return this.mouseDownElapsedSeconds + this.mouseUpElapsedSeconds;
      },

      get initialOpacity() {
        return this.element.initialOpacity;
      },

      get opacityDecayVelocity() {
        return this.element.opacityDecayVelocity;
      },

      get radius() {
        var width2 = this.containerMetrics.width * this.containerMetrics.width;
        var height2 = this.containerMetrics.height * this.containerMetrics.height;
        var waveRadius = Math.min(
          Math.sqrt(width2 + height2),
          Ripple.MAX_RADIUS
        ) * 1.1 + 5;

        var duration = 1.1 - 0.2 * (waveRadius / Ripple.MAX_RADIUS);
        var timeNow = this.mouseInteractionSeconds / duration;
        var size = waveRadius * (1 - Math.pow(80, -timeNow));

        return Math.abs(size);
      },

      get opacity() {
        if (!this.mouseUpStart) {
          return this.initialOpacity;
        }

        return Math.max(
          0,
          this.initialOpacity - this.mouseUpElapsedSeconds * this.opacityDecayVelocity
        );
      },

      get outerOpacity() {
        // Linear increase in background opacity, capped at the opacity
        // of the wavefront (waveOpacity).
        var outerOpacity = this.mouseUpElapsedSeconds * 0.3;
        var waveOpacity = this.opacity;

        return Math.max(
          0,
          Math.min(outerOpacity, waveOpacity)
        );
      },

      get isOpacityFullyDecayed() {
        return this.opacity < 0.01 &&
          this.radius >= Math.min(this.maxRadius, Ripple.MAX_RADIUS);
      },

      get isRestingAtMaxRadius() {
        return this.opacity >= this.initialOpacity &&
          this.radius >= Math.min(this.maxRadius, Ripple.MAX_RADIUS);
      },

      get isAnimationComplete() {
        return this.mouseUpStart ?
          this.isOpacityFullyDecayed : this.isRestingAtMaxRadius;
      },

      get translationFraction() {
        return Math.min(
          1,
          this.radius / this.containerMetrics.size * 2 / Math.sqrt(2)
        );
      },

      get xNow() {
        if (this.xEnd) {
          return this.xStart + this.translationFraction * (this.xEnd - this.xStart);
        }

        return this.xStart;
      },

      get yNow() {
        if (this.yEnd) {
          return this.yStart + this.translationFraction * (this.yEnd - this.yStart);
        }

        return this.yStart;
      },

      get isMouseDown() {
        return this.mouseDownStart && !this.mouseUpStart;
      },

      resetInteractionState: function() {
        this.maxRadius = 0;
        this.mouseDownStart = 0;
        this.mouseUpStart = 0;

        this.xStart = 0;
        this.yStart = 0;
        this.xEnd = 0;
        this.yEnd = 0;
        this.slideDistance = 0;

        this.containerMetrics = new ElementMetrics(this.element);
      },

      draw: function() {
        var scale;
        var translateString;
        var dx;
        var dy;

        this.wave.style.opacity = this.opacity;

        scale = this.radius / (this.containerMetrics.size / 2);
        dx = this.xNow - (this.containerMetrics.width / 2);
        dy = this.yNow - (this.containerMetrics.height / 2);


        // 2d transform for safari because of border-radius and overflow:hidden clipping bug.
        // https://bugs.webkit.org/show_bug.cgi?id=98538
        this.waveContainer.style.webkitTransform = 'translate(' + dx + 'px, ' + dy + 'px)';
        this.waveContainer.style.transform = 'translate3d(' + dx + 'px, ' + dy + 'px, 0)';
        this.wave.style.webkitTransform = 'scale(' + scale + ',' + scale + ')';
        this.wave.style.transform = 'scale3d(' + scale + ',' + scale + ',1)';
      },

      /** @param {Event=} event */
      downAction: function(event) {
        var xCenter = this.containerMetrics.width / 2;
        var yCenter = this.containerMetrics.height / 2;

        this.resetInteractionState();
        this.mouseDownStart = Utility.now();

        if (this.center) {
          this.xStart = xCenter;
          this.yStart = yCenter;
          this.slideDistance = Utility.distance(
            this.xStart, this.yStart, this.xEnd, this.yEnd
          );
        } else {
          this.xStart = event ?
              event.detail.x - this.containerMetrics.boundingRect.left :
              this.containerMetrics.width / 2;
          this.yStart = event ?
              event.detail.y - this.containerMetrics.boundingRect.top :
              this.containerMetrics.height / 2;
        }

        if (this.recenters) {
          this.xEnd = xCenter;
          this.yEnd = yCenter;
          this.slideDistance = Utility.distance(
            this.xStart, this.yStart, this.xEnd, this.yEnd
          );
        }

        this.maxRadius = this.containerMetrics.furthestCornerDistanceFrom(
          this.xStart,
          this.yStart
        );

        this.waveContainer.style.top =
          (this.containerMetrics.height - this.containerMetrics.size) / 2 + 'px';
        this.waveContainer.style.left =
          (this.containerMetrics.width - this.containerMetrics.size) / 2 + 'px';

        this.waveContainer.style.width = this.containerMetrics.size + 'px';
        this.waveContainer.style.height = this.containerMetrics.size + 'px';
      },

      /** @param {Event=} event */
      upAction: function(event) {
        if (!this.isMouseDown) {
          return;
        }

        this.mouseUpStart = Utility.now();
      },

      remove: function() {
        Polymer.dom(this.waveContainer.parentNode).removeChild(
          this.waveContainer
        );
      }
    };

    Polymer({
      is: 'paper-ripple',

      behaviors: [
        Polymer.IronA11yKeysBehavior
      ],

      properties: {
        /**
         * The initial opacity set on the wave.
         *
         * @attribute initialOpacity
         * @type number
         * @default 0.25
         */
        initialOpacity: {
          type: Number,
          value: 0.25
        },

        /**
         * How fast (opacity per second) the wave fades out.
         *
         * @attribute opacityDecayVelocity
         * @type number
         * @default 0.8
         */
        opacityDecayVelocity: {
          type: Number,
          value: 0.8
        },

        /**
         * If true, ripples will exhibit a gravitational pull towards
         * the center of their container as they fade away.
         *
         * @attribute recenters
         * @type boolean
         * @default false
         */
        recenters: {
          type: Boolean,
          value: false
        },

        /**
         * If true, ripples will center inside its container
         *
         * @attribute recenters
         * @type boolean
         * @default false
         */
        center: {
          type: Boolean,
          value: false
        },

        /**
         * A list of the visual ripples.
         *
         * @attribute ripples
         * @type Array
         * @default []
         */
        ripples: {
          type: Array,
          value: function() {
            return [];
          }
        },

        /**
         * True when there are visible ripples animating within the
         * element.
         */
        animating: {
          type: Boolean,
          readOnly: true,
          reflectToAttribute: true,
          value: false
        },

        /**
         * If true, the ripple will remain in the "down" state until `holdDown`
         * is set to false again.
         */
        holdDown: {
          type: Boolean,
          value: false,
          observer: '_holdDownChanged'
        },

        /**
         * If true, the ripple will not generate a ripple effect
         * via pointer interaction.
         * Calling ripple's imperative api like `simulatedRipple` will
         * still generate the ripple effect.
         */
        noink: {
          type: Boolean,
          value: false
        },

        _animating: {
          type: Boolean
        },

        _boundAnimate: {
          type: Function,
          value: function() {
            return this.animate.bind(this);
          }
        }
      },

      get target () {
        return this.keyEventTarget;
      },

      keyBindings: {
        'enter:keydown': '_onEnterKeydown',
        'space:keydown': '_onSpaceKeydown',
        'space:keyup': '_onSpaceKeyup'
      },

      attached: function() {
        // Set up a11yKeysBehavior to listen to key events on the target,
        // so that space and enter activate the ripple even if the target doesn't
        // handle key events. The key handlers deal with `noink` themselves.
        if (this.parentNode.nodeType == 11) { // DOCUMENT_FRAGMENT_NODE
          this.keyEventTarget = Polymer.dom(this).getOwnerRoot().host;
        } else {
          this.keyEventTarget = this.parentNode;
        }
        var keyEventTarget = /** @type {!EventTarget} */ (this.keyEventTarget);
        this.listen(keyEventTarget, 'up', 'uiUpAction');
        this.listen(keyEventTarget, 'down', 'uiDownAction');
      },

      detached: function() {
        this.unlisten(this.keyEventTarget, 'up', 'uiUpAction');
        this.unlisten(this.keyEventTarget, 'down', 'uiDownAction');
        this.keyEventTarget = null;
      },

      get shouldKeepAnimating () {
        for (var index = 0; index < this.ripples.length; ++index) {
          if (!this.ripples[index].isAnimationComplete) {
            return true;
          }
        }

        return false;
      },

      simulatedRipple: function() {
        this.downAction(null);

        // Please see polymer/polymer#1305
        this.async(function() {
          this.upAction();
        }, 1);
      },

      /**
       * Provokes a ripple down effect via a UI event,
       * respecting the `noink` property.
       * @param {Event=} event
       */
      uiDownAction: function(event) {
        if (!this.noink) {
          this.downAction(event);
        }
      },

      /**
       * Provokes a ripple down effect via a UI event,
       * *not* respecting the `noink` property.
       * @param {Event=} event
       */
      downAction: function(event) {
        if (this.holdDown && this.ripples.length > 0) {
          return;
        }

        var ripple = this.addRipple();

        ripple.downAction(event);

        if (!this._animating) {
          this._animating = true;
          this.animate();
        }
      },

      /**
       * Provokes a ripple up effect via a UI event,
       * respecting the `noink` property.
       * @param {Event=} event
       */
      uiUpAction: function(event) {
        if (!this.noink) {
          this.upAction(event);
        }
      },

      /**
       * Provokes a ripple up effect via a UI event,
       * *not* respecting the `noink` property.
       * @param {Event=} event
       */
      upAction: function(event) {
        if (this.holdDown) {
          return;
        }

        this.ripples.forEach(function(ripple) {
          ripple.upAction(event);
        });

        this._animating = true;
        this.animate();
      },

      onAnimationComplete: function() {
        this._animating = false;
        this.$.background.style.backgroundColor = null;
        this.fire('transitionend');
      },

      addRipple: function() {
        var ripple = new Ripple(this);

        Polymer.dom(this.$.waves).appendChild(ripple.waveContainer);
        this.$.background.style.backgroundColor = ripple.color;
        this.ripples.push(ripple);

        this._setAnimating(true);

        return ripple;
      },

      removeRipple: function(ripple) {
        var rippleIndex = this.ripples.indexOf(ripple);

        if (rippleIndex < 0) {
          return;
        }

        this.ripples.splice(rippleIndex, 1);

        ripple.remove();

        if (!this.ripples.length) {
          this._setAnimating(false);
        }
      },

      /**
       * This conflicts with Element#antimate().
       * https://developer.mozilla.org/en-US/docs/Web/API/Element/animate
       * @suppress {checkTypes}
       */
      animate: function() {
        if (!this._animating) {
          return;
        }
        var index;
        var ripple;

        for (index = 0; index < this.ripples.length; ++index) {
          ripple = this.ripples[index];

          ripple.draw();

          this.$.background.style.opacity = ripple.outerOpacity;

          if (ripple.isOpacityFullyDecayed && !ripple.isRestingAtMaxRadius) {
            this.removeRipple(ripple);
          }
        }

        if (!this.shouldKeepAnimating && this.ripples.length === 0) {
          this.onAnimationComplete();
        } else {
          window.requestAnimationFrame(this._boundAnimate);
        }
      },

      _onEnterKeydown: function() {
        this.uiDownAction();
        this.async(this.uiUpAction, 1);
      },

      _onSpaceKeydown: function() {
        this.uiDownAction();
      },

      _onSpaceKeyup: function() {
        this.uiUpAction();
      },

      // note: holdDown does not respect noink since it can be a focus based
      // effect.
      _holdDownChanged: function(newVal, oldVal) {
        if (oldVal === undefined) {
          return;
        }
        if (newVal) {
          this.downAction();
        } else {
          this.upAction();
        }
      }

      /**
      Fired when the animation finishes.
      This is useful if you want to wait until
      the ripple animation finishes to perform some action.

      @event transitionend
      @param {{node: Object}} detail Contains the animated node.
      */
    });
  })();
</script>
<script>
  /**
   * `Polymer.PaperRippleBehavior` dynamically implements a ripple
   * when the element has focus via pointer or keyboard.
   *
   * NOTE: This behavior is intended to be used in conjunction with and after
   * `Polymer.IronButtonState` and `Polymer.IronControlState`.
   *
   * @polymerBehavior Polymer.PaperRippleBehavior
   */
  Polymer.PaperRippleBehavior = {
    properties: {
      /**
       * If true, the element will not produce a ripple effect when interacted
       * with via the pointer.
       */
      noink: {
        type: Boolean,
        observer: '_noinkChanged'
      },

      /**
       * @type {Element|undefined}
       */
      _rippleContainer: {
        type: Object,
      }
    },

    /**
     * Ensures a `<paper-ripple>` element is available when the element is
     * focused.
     */
    _buttonStateChanged: function() {
      if (this.focused) {
        this.ensureRipple();
      }
    },

    /**
     * In addition to the functionality provided in `IronButtonState`, ensures
     * a ripple effect is created when the element is in a `pressed` state.
     */
    _downHandler: function(event) {
      Polymer.IronButtonStateImpl._downHandler.call(this, event);
      if (this.pressed) {
        this.ensureRipple(event);
      }
    },

    /**
     * Ensures this element contains a ripple effect. For startup efficiency
     * the ripple effect is dynamically on demand when needed.
     * @param {!Event=} optTriggeringEvent (optional) event that triggered the
     * ripple.
     */
    ensureRipple: function(optTriggeringEvent) {
      if (!this.hasRipple()) {
        this._ripple = this._createRipple();
        this._ripple.noink = this.noink;
        var rippleContainer = this._rippleContainer || this.root;
        if (rippleContainer) {
          Polymer.dom(rippleContainer).appendChild(this._ripple);
        }
        if (optTriggeringEvent) {
          // Check if the event happened inside of the ripple container
          // Fall back to host instead of the root because distributed text
          // nodes are not valid event targets
          var domContainer = Polymer.dom(this._rippleContainer || this);
          var target = Polymer.dom(optTriggeringEvent).rootTarget;
          if (domContainer.deepContains( /** @type {Node} */(target))) {
            this._ripple.uiDownAction(optTriggeringEvent);
          }
        }
      }
    },

    /**
     * Returns the `<paper-ripple>` element used by this element to create
     * ripple effects. The element's ripple is created on demand, when
     * necessary, and calling this method will force the
     * ripple to be created.
     */
    getRipple: function() {
      this.ensureRipple();
      return this._ripple;
    },

    /**
     * Returns true if this element currently contains a ripple effect.
     * @return {boolean}
     */
    hasRipple: function() {
      return Boolean(this._ripple);
    },

    /**
     * Create the element's ripple effect via creating a `<paper-ripple>`.
     * Override this method to customize the ripple element.
     * @return {!PaperRippleElement} Returns a `<paper-ripple>` element.
     */
    _createRipple: function() {
      return /** @type {!PaperRippleElement} */ (
          document.createElement('paper-ripple'));
    },

    _noinkChanged: function(noink) {
      if (this.hasRipple()) {
        this._ripple.noink = noink;
      }
    }
  };
</script><script>
  /** @polymerBehavior Polymer.PaperButtonBehavior */
  Polymer.PaperButtonBehaviorImpl = {
    properties: {
      /**
       * The z-depth of this element, from 0-5. Setting to 0 will remove the
       * shadow, and each increasing number greater than 0 will be "deeper"
       * than the last.
       *
       * @attribute elevation
       * @type number
       * @default 1
       */
      elevation: {
        type: Number,
        reflectToAttribute: true,
        readOnly: true
      }
    },

    observers: [
      '_calculateElevation(focused, disabled, active, pressed, receivedFocusFromKeyboard)',
      '_computeKeyboardClass(receivedFocusFromKeyboard)'
    ],

    hostAttributes: {
      role: 'button',
      tabindex: '0',
      animated: true
    },

    _calculateElevation: function() {
      var e = 1;
      if (this.disabled) {
        e = 0;
      } else if (this.active || this.pressed) {
        e = 4;
      } else if (this.receivedFocusFromKeyboard) {
        e = 3;
      }
      this._setElevation(e);
    },

    _computeKeyboardClass: function(receivedFocusFromKeyboard) {
      this.toggleClass('keyboard-focus', receivedFocusFromKeyboard);
    },

    /**
     * In addition to `IronButtonState` behavior, when space key goes down,
     * create a ripple down effect.
     *
     * @param {!KeyboardEvent} event .
     */
    _spaceKeyDownHandler: function(event) {
      Polymer.IronButtonStateImpl._spaceKeyDownHandler.call(this, event);
      // Ensure that there is at most one ripple when the space key is held down.
      if (this.hasRipple() && this.getRipple().ripples.length < 1) {
        this._ripple.uiDownAction();
      }
    },

    /**
     * In addition to `IronButtonState` behavior, when space key goes up,
     * create a ripple up effect.
     *
     * @param {!KeyboardEvent} event .
     */
    _spaceKeyUpHandler: function(event) {
      Polymer.IronButtonStateImpl._spaceKeyUpHandler.call(this, event);
      if (this.hasRipple()) {
        this._ripple.uiUpAction();
      }
    }
  };

  /** @polymerBehavior */
  Polymer.PaperButtonBehavior = [
    Polymer.IronButtonState,
    Polymer.IronControlState,
    Polymer.PaperRippleBehavior,
    Polymer.PaperButtonBehaviorImpl
  ];
</script><dom-module id="paper-material-shared-styles" assetpath="../paper-material/">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
      }

      :host([elevation="1"]) {
        @apply(--shadow-elevation-2dp);
      }

      :host([elevation="2"]) {
        @apply(--shadow-elevation-4dp);
      }

      :host([elevation="3"]) {
        @apply(--shadow-elevation-6dp);
      }

      :host([elevation="4"]) {
        @apply(--shadow-elevation-8dp);
      }

      :host([elevation="5"]) {
        @apply(--shadow-elevation-16dp);
      }
    </style>
  </template>
</dom-module>
<dom-module id="paper-button" assetpath="../paper-button/">
  <template strip-whitespace="">
    <style include="paper-material-shared-styles">
      :host {
        @apply(--layout-inline);
        @apply(--layout-center-center);
        position: relative;
        box-sizing: border-box;
        min-width: 5.14em;
        margin: 0 0.29em;
        background: transparent;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        -webkit-tap-highlight-color: transparent;
        font: inherit;
        text-transform: uppercase;
        outline-width: 0;
        border-radius: 3px;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        cursor: pointer;
        z-index: 0;
        padding: 0.7em 0.57em;

        @apply(--paper-font-common-base);
        @apply(--paper-button);
      }

      :host([hidden]) {
        display: none !important;
      }

      :host([raised].keyboard-focus) {
        font-weight: bold;
        @apply(--paper-button-raised-keyboard-focus);
      }

      :host(:not([raised]).keyboard-focus) {
        font-weight: bold;
        @apply(--paper-button-flat-keyboard-focus);
      }

      :host([disabled]) {
        background: #eaeaea;
        color: #a8a8a8;
        cursor: auto;
        pointer-events: none;

        @apply(--paper-button-disabled);
      }

      :host([animated]) {
        @apply(--shadow-transition);
      }

      paper-ripple {
        color: var(--paper-button-ink-color);
      }
    </style>

    <content></content>
  </template>

  <script>
    Polymer({
      is: 'paper-button',

      behaviors: [
        Polymer.PaperButtonBehavior
      ],

      properties: {
        /**
         * If true, the button should be styled with a shadow.
         */
        raised: {
          type: Boolean,
          reflectToAttribute: true,
          value: false,
          observer: '_calculateElevation'
        }
      },

      _calculateElevation: function() {
        if (!this.raised) {
          this._setElevation(0);
        } else {
          Polymer.PaperButtonBehaviorImpl._calculateElevation.apply(this);
        }
      }

      /**
      Fired when the animation finishes.
      This is useful if you want to wait until
      the ripple animation finishes to perform some action.

      @event transitionend
      Event param: {{node: Object}} detail Contains the animated node.
      */
    });
  </script>
</dom-module>




<dom-module id="paper-material" assetpath="../paper-material/">
  <template>
    <style include="paper-material-shared-styles"></style>
    <style>
      :host([animated]) {
        @apply(--shadow-transition);
      }
    </style>

    <content></content>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'paper-material',

    properties: {
      /**
       * The z-depth of this element, from 0-5. Setting to 0 will remove the
       * shadow, and each increasing number greater than 0 will be "deeper"
       * than the last.
       *
       * @attribute elevation
       * @type number
       * @default 1
       */
      elevation: {
        type: Number,
        reflectToAttribute: true,
        value: 1
      },

      /**
       * Set this to true to animate the shadow when setting a new
       * `elevation` value.
       *
       * @attribute animated
       * @type boolean
       * @default false
       */
      animated: {
        type: Boolean,
        reflectToAttribute: true,
        value: false
      }
    }
  });
</script>

<dom-module id="triplat-signout" assetpath="../triplat-signout-button/">
	<template>
		<tricore-url id="homeUrl" bind-url="{{homeUrl}}"></tricore-url>
		<tricore-url raw-url="/p/websignon/signout" bind-url="{{url}}"></tricore-url>
		<tricore-url raw-url="/p/websignon/sso/signout" bind-url="{{ssoUrl}}"></tricore-url>
		<iron-ajax id="ajax" url="{{url}}" method="POST" on-response="_handleRespone" on-error="_handleRespone"></iron-ajax>
		<tricore-properties id="properties" sso="{{sso}}"></tricore-properties>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-signout",
		
		properties: {
			/**
	 		 * The name of the home application. 
	 		 * This is used to redirect the user to the home application after signing out from the current application.  
	 		 */
			homeApp: String,	
		},
		
		signout: function() {
			if (this.sso) {
				window.location.href = this.ssoUrl;
			} else {
				this.$.ajax.generateRequest();
			}
		},

		/**
		 * Call this method to sign out of TRIRIGA.
		 */
		_handleRespone: function() {
			if (this.homeApp) {
				var homeUrl = this.$.homeUrl.getUrl("/p/web/" + this.homeApp);
				window.location.href = homeUrl; 
			} else {
		
				// Regular expression that matches everything from the start of the current url
				// until the first # or / after the UX app context path (/p/web/).
				var rootOfCurrentApp = /.*\/p\/web\/[^\/#]*(?=[\/#])/.exec(window.location.href);
				if (rootOfCurrentApp && rootOfCurrentApp.length > 0) {
					window.location.href = rootOfCurrentApp[0];
				} else {
					//If there is no match then it is already in the application root, so just reload it
					window.location.reload();
				}
			
			}
		}

	});
</script><dom-module id="tricore-error" assetpath="../tricore-error/">
	<style>
		:host {
			font-family: "Helvetica Neue";
			@apply(--layout);
			@apply(--layout-horizontal);
			@apply(--layout-center-justified);
		}
		
		@media (min-width: 500px) {
			.container {
				width: 400px;
			}
		}

		@media (max-width: 499px) {
			.container {
				@apply(--layout-flex);
				padding: 0px 30px;
			}
		}
		
		paper-material {
			padding: 20px;
			margin-left: 10px;
		}
		
	</style>
	<template>
	<triplat-signout id="signout"></triplat-signout>	
	<paper-material elevation="[[elevation]]">
		<div class="layout vertial container" tabindex="0">
			<h2>[[title]]</h2>
			<p>[[message_line1Label]]</p>
			<p>[[message_line2Label]]</p>
			<p hidden$="{{!includeSignin}}"><a on-tap="_signout" href="../tricore-error">[[_signIn]]</a></p>
		</div>
	</paper-material>
	</template>
</dom-module>

<script>
	Polymer({
	
		is: "tricore-error",

		properties: {

			/**
			 * The title of the error message.
			 */
			title: String,

			/**
			 * The first line of the error message.
			 */
			message_line1Label: String,

			/**
			 * The second line of the error message.
			 */
			message_line2Label: String,

	  		/** 
	  		  * Optional. Boolean value to indicate whether to include a sign in link. The "Go back to Sign In." link will be displayed at the third line.
	  		  */
	  		includeSignin: {
	  			type: Boolean,
	  			value: false
	  		}, 

	  		/**
			 * Whether or not the message panel is elevated. "1" for elevated and "0" for not elevated.
			 */
			elevation: {
				type: String,
				notify: false,
				readOnly: false,
				value: "1"
			}
		},
		
		ready: function() {
			var __dictionary__signin = "Go back to Sign In.";
			this.set("_signIn",__dictionary__signin);
		},
		
		_signout: function() {
			this.$.signout.signout();
		},
		
	});
</script><dom-module id="triplat-ds" assetpath="../triplat-ds/">
	<template>
		<tricore-context-path get-path="{{_contextPath}}"></tricore-context-path>
		<content></content>
		<paper-dialog id="triPlatDsErrorDialog">
		    <tricore-error id="triPlatDsErrorMsg" elevation="0"></tricore-error>
		    <div class="buttons">
		        <paper-button id="triPlatDsCloseButton" dialog-dismiss="">Close</paper-button>
		    </div>
		</paper-dialog>
	</template>
</dom-module>
<script>
	TriPlatDs = {};

	TriPlatDs.RefreshType = function() {};
	TriPlatDs.RefreshType.NONE = new TriPlatDs.RefreshType();
	TriPlatDs.RefreshType.SERVER = new TriPlatDs.RefreshType();
	TriPlatDs.RefreshType.CLIENT = new TriPlatDs.RefreshType();
	TriPlatDs.RefreshType.BOTH = new TriPlatDs.RefreshType();

	Polymer({

		is: "triplat-ds",

		/**
	     * Fired after a get or refresh is complete.
	     *
	     * @event ds-get-complete
	     */

	    /**
	     * Fired if a get or refresh results in an error.
	     *
	     * @event ds-get-error
	     */

		/**
	     * Fired after a create is complete.
		 * If wfParameters parameter is not provided in the createRecord(), then the event detail only includes the created record ID(s). Otherwise, 
		 * the event detail includes the created record ID(s) and action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
	     *
	     * @event ds-create-complete
	     */

		/**
	     * Fired if a create results in an error.
	     *
	     * @event ds-create-error
	     */

	    /**
	     * Fired after a delete is complete.
		 * The event detail includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
	     *
	     * @event ds-delete-complete
	     */

	    /**
	     * Fired if a delete results in an error.
	     *
	     * @event ds-delete-error
	     */

	    /**
	     * Fired after an update is complete.
		 * The event detail includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
	     *
	     * @event ds-update-complete
	     */

	    /**
	     * Fired if an update results is an error.
	     *
	     * @event ds-update-error
	     */

	    /**
	     * Fired after a perform action is complete.
		 * The event detail includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
	     *
	     * @event ds-perform-action-complete
	     */

	    /**
	     * Fired if a perform action results in an error.
	     *
	     * @event ds-perform-action-error
	     */

	    /**
	     * Fired after an add is complete.
		 * The event detail includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
	     *
	     * @event ds-add-complete
	     */

	    /**
	     * Fired if an add results in an error.
	     *
	     * @event ds-add-error
	     */

	    /**
	     * Fired after a remove is complete.
		 * The event detail includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
	     *
	     * @event ds-remove-complete
	     */

	    /**
	     * Fired if a remove results in an error.
	     *
	     * @event ds-remove-error
	     */

	    behaviors: [
	    	Polymer.TriplatDsChangeBehavior
	    ],

		properties: {

			/**
			 * The data source name that will be retrieved.
			 */
			name: {
				type: String,
				nofity: true,
				readOnly: false
			},
			
			/**
			 * A flag to enable the data source from requesting field metadata properies set in Data Modeler.
			 */
			includeMetadata:{
				type: Boolean,
				value: false,
				notify: true
			},
			
			/*
			 * The data object to which the metadata of the fields in data source values can be bound.
			 */
			metadata:{
				type: Object,
				notify: true,
				readOnly: true
			},

			/*
			 * The data object to which the data source values can be bound.
			 */
			data: {
				type: Object,
				notify: true,
				readOnly: false
			},

			/*
			 * The transition information object provides information about the available state transition actions and sub actions for the current state of the record.<br>
			 * If the data source type is BUSINESS_OBJECT for a single record, then this transition information is populated for that record.
			 * If the data source type is BUSINESS_OBJECT or QUERY for multiple records, then this transition information is populated for a given record from that data source.
			 */
			 transitionInfo: {
				type: Object,
				notify: true,
				readOnly: false
			},

			/**
			 * When using a triplat-query that does not paginate, this is 
			 * populated with the filtered and sorted values.
			 */
			filteredData: {
				type: Object,
				notify: true,
				readOnly: true
			},

			/**
			 * Used to access the currently applied query if a 
			 * triplat-query is used.
			 */
			query: {
				type: Object,
				notify: true,
				readOnly: true,
				observer: "_handleQueryChanged"
			},

			/**
			 * A flag to disable the retrieval of records.
			 */
			disable: {
				type: Boolean,
				notify: false,
				readOnly: false,
				value: false,
				observer: "_onDisableChanged"
			},

			/**
			 * A flag to prevent the data source from requesting data when the context or the query changes.
			 */
			manual: {
				type: Boolean,
				value: false
			},

			/**
			 * When using a paginated query, this flag will tell you whether 
			 * the pages will append to the result or not.
			 */
			appendPage: {
				type: Boolean,
				notify: true,
				readOnly: true
			},

			/**
			 * This will give you the total number of results of a multiple records query data source.
			 */
			queryTotalSize: {
				type: Number,
				notify: true,
				readOnly: true
			},

			/**
			 * A flag that can be used to be notified when this data 
			 * source is requesting data from the server.
			 */
			loading: {
				type: Boolean,
				notify: true,
				readOnly: true,
				value: false
			},

			/**
			 * Can be used to get the context path for this data source.
			 */
			context: {
				type: String,
				notify: true,
				readOnly: true,
				observer: "_handleContextStringChanged"
			},

			/**
			 * Can be used to get the parent path for this data source 
			 * when an instance is specified.
			 */
			parentContext: {
				type: String,
				notify: true,
				readOnly: true
			},

			/**
			 * Use this flag to tell the data source you will providing 
			 * your own application instance ID instead of using the ID 
			 * configured in metadata.
			 */
			ignoreAppContext: {
				type: Boolean,
				notify: false,
				readOnly: false
			},

			/**
			 * Use this flag to indicate that you want server-side filtering
			 * even though pagination is not being used.
			 */
			forceServerFiltering: {
				type: Boolean,
				value: false
			},

			/** 
			 * This flag should only be used when the query called by the data source is of type RESERVE.
			 * Use this flag to indicate that you want both available and unavailable resources. 
			 */
			reserveIncludeUnavailable: {
				type: Boolean,
				value: false
			},

			_serverFiltering: {
				type: Boolean,
				value: false
			},

			_container: {
				type: Object,
				notify: true,
				readOnly: false
			},

			_contexts: {
				type: Array,
				notify: true,
				readOnly: true
			},

			_instanceId: {
				type: Number
			},

			_hasInstance: {
				type: Boolean
			},

			_hasQuery: {
				type: Boolean,
				notify: false,
				readOnly: true
			},

			_isQueryPaginated: {
				type: Boolean,
				notify: false,
				readOnly: true
			},

			_registered: {
				type: Boolean,
				notify: false,
				readOnly: true,
				value: false
			},
			
			_offlineMode: {
				type: String
			},

            /**
             * Use this flag to indicate that you only want to retrieve the total number of results of a multiple records query data source without retrieving the data.
             */
            countOnly: {
                type: Boolean,
                notify: false,
                readOnly: false,
                value: false,
                observer: "_onCountOnlyChanged"
            }
		},

		observers: [
			"_handleContextChanged(name, _contexts.*)",
			"_handleDataChange(data.*)",
			"_dsInfoChanged(queryTotalSize, data.length)"
		],

		listeners: {
			"triplat-ds-context-changed": "_handleChildDsContextChanged",
			"triplat-ds-instance-changed": "_handleChildDsInstanceChanged"
		},
		
		_getBoFieldsMetaData: function(){
			var self = this;
			if(this.includeMetadata===true){
				var returnValue;
				 var boFieldsAjax = this._boFieldsAjax;
					if (!boFieldsAjax) {
						boFieldsAjax = document.createElement("iron-ajax");
						boFieldsAjax.url = this._contextPath + "/p/webapi/rest/v2/meta/dsfieldmeta";
						boFieldsAjax.addEventListener("response", function(resp){
								self._setMetadata(boFieldsAjax.lastResponse);	
							});
						boFieldsAjax.addEventListener("error", function(err){
								console.log("Error occured while retrieving datasourse metadata");	
							});		
						boFieldsAjax.method = "GET";
						boFieldsAjax.contentType = "application/json";
						boFieldsAjax.generateRequest();
					} 
				
			}
		},
		
		attached: function() {
			var node = this;
			var container = null;
			while (node) {
				node = Polymer.dom(node).parentNode;
				if (node && node.nodeType !== Node.ELEMENT_NODE) {
					node = node.host;
				}
				if (node && node.isTriplatDsContainer === true) {
					container = node;
					break;
				}
			}

			if (!container) {
				console.warn("No triplat-ds container found.");
				console.warn(this);
				return;
			}

			this.set("_container", container);

			this.async(this._initContext);

			this.set("_serverFiltering", this.forceServerFiltering);

			var serverFilteringElement = Polymer.dom(this).querySelector("triplat-query-page,triplat-query-scroll-page,triplat-query-resource-calendar");
			if(serverFilteringElement) {
				this.set("_serverFiltering", true);
			}
			this._getBoFieldsMetaData();
		},

		detached: function() {
			if (this._container && this.context) {
				this._unregister(this.context);
			}

			this.set("_context", null);
		},

		/**
		 * Refreshes the data for this data source and returns a promise that can be used to be notified when the request is complete.
		 *
		 * @return {Promise} 
		 */
		refresh: function() {
			return new Promise(function(resolve, reject) {
				this._container.refresh(this, this.context, resolve, reject, this._getOfflineMode());
			}.bind(this));
		},

		// Called by triplat-ds-container-behavior
		_onGetComplete: function(e) {
			this.fire("ds-get-complete", e);
		},

		// Called by triplat-ds-container-behavior
		_onGetError: function(e) {
			this.fire("ds-get-error", e);
		},

		/**
		 * Creates a record for this data source and returns a promise that can be used to be notified when the request is complete. 
		 * If wfParameters parameter is not provided in the createRecord(), then the return promise only includes the created record ID(s). Otherwise, 
		 * the return promise includes the created record ID(s) and action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
		 *
		 * @param {Object | Array} data The data that will be created.
		 * @param {TriPlatDs.RefreshType} refreshType (Optional) The refresh type used to refresh after the operation.
		 * @param {String} actionGroup (Optional) The action group name for triggering an action with this operation.
		 * @param {String} action (Optional) The action name for triggering an action with this operation.
		 * @param {Map <String, Object>} wfParameters (Optional) The workflow parameters map for the key and value.
		 * Each key-and-value pair represents a workflow parameter.
		 * The key is the workflow parameter name.
		 * The value can be a single instance ID, an array of instance IDs, an object with the '_id' property that holds the instance ID, or an array of objects that each have the '_id' property.
		 * @return {Promise}
		 */
		createRecord: function(data, refreshType, actionGroup, action, wfParameters, appContext) {
			if (this._hasInstance) {
				console.warn("createRecord is not suppored for instance triplat-ds elements.");
				return;
			}

			var wfParametersMap = this._getWFParametersMap(wfParameters);

			return new Promise(function(resolve, reject) {
				this._container.createRecord(
					this, 
					this.context, 
					data, 
					refreshType, 
					actionGroup, 
					action, 
					resolve, 
					reject,
					wfParametersMap,
					this._getOfflineMode(),
					appContext);
			}.bind(this));
		},

		// Called by triplat-ds-container-behavior
		_onCreateComplete: function(detail) {
			this.fire("ds-create-complete", detail);
		},

		// Called by triplat-ds-container-behavior
		_onCreateError: function(e) {
			this.fire("ds-create-error", e);
		},

		/**
		 * Deletes a record for this data source and returns a promise that can be used to be notified when the request is complete. 
		 * The return promise includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
		 *
		 * @param {Number | Array} instanceId The ID(s) to be deleted.
		 * @param {TriPlatDs.RefreshType} refreshType (Optional) The refresh type used to refresh after the operation.
		 * @param {String} actionGroup (Optional) The action group name for triggering an action with this operation.
		 * @param {String} action (Optional) The action name for triggering an action with this operation.
		 * @param {Map <String, Object>} wfParameters (Optional) The workflow parameters map for the key and value.
		 * Each key-and-value pair represents a workflow parameter.
		 * The key is the workflow parameter name.
		 * The value can be a single instance ID, an array of instance IDs, an object with the '_id' property that holds the instance ID, or an array of objects that each have the '_id' property.
		 * @return {Promise}
		 */
		deleteRecord: function(instanceId, refreshType, actionGroup, action, wfParameters, appContext) {
			if (this._hasInstance) {
				console.warn("deleteRecord is not suppored for instance triplat-ds elements.");
				return;
			}
			var wfParametersMap = this._getWFParametersMap(wfParameters);

			return new Promise(function(resolve, reject) {
				this._container.deleteRecord(
					this,
					this.context,
					instanceId,
					refreshType,
					actionGroup,
					action,
					resolve,
					reject,
					wfParametersMap,
					this._getOfflineMode(),
					appContext);
			}.bind(this));
		},

		// Called by triplat-ds-container-behavior
		_onDeleteComplete: function(e) {
			this.fire("ds-delete-complete", e);
		},

		// Called by triplat-ds-container-behavior
		_onDeleteError: function(e) {
			this.fire("ds-delete-error", e);	
		},

		/**
		 * Updates a record for this data source and returns a promise that can be used to be notified when the request is complete. 
		 * The return promise includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
		 * 
		 * @param {Number | Array} instanceId (Optional) The ID(s) to be updated. Can be omitted if this is a single 
		 * record datasource.
		 * @param {TriPlatDs.RefreshType} refreshType (Optional) The refresh type used to refresh after the operation.
		 * Defaults to TriPlat.RefreshType.NONE.
		 * @param {String} actionGroup (Optional) The action group name for triggering an action with this operation.
		 * @param {String} action (Optional) The action name for triggering an action with this operation.
		 * @param {Map <String, Object>} wfParameters (Optional) The workflow parameters map for the key and value.
		 * Each key-and-value pair represents a workflow parameter.
		 * The key is the workflow parameter name.
		 * The value can be a single instance ID, an array of instance IDs, an object with the '_id' property that holds the instance ID, or an array of objects that each have the '_id' property.
		 * @return {Promise} 
		 */
		updateRecord: function(instanceId, refreshType, actionGroup, action, wfParameters, appContext) {
			var args = this._getUpdateInstanceIdArguments(arguments);
			if (args == null) {
				console.warn("Can't perform update as no Instance ID was found or supplied.");
				return;
			}

			var wfParametersMap = this._getWFParametersMap(args.wfParameters);
			
			return new Promise(function(resolve, reject) {
				this._container.updateRecord(
					this, 
					this.context, 
					args.instanceId, 
					args.refreshType, 
					args.actionGroup, 
					args.action, 
					"_onUpdateComplete",
					"_onUpdateError",
					false, /* not ID's only */
					resolve,
					reject,
					wfParametersMap,
					this._getOfflineMode(),
					appContext);
			}.bind(this));
		},

		// Called by triplat-ds-container-behavior
		_onUpdateComplete: function(e) {
			this.fire("ds-update-complete", e);
		},

		// Called by triplat-ds-container-behavior
		_onUpdateError: function(e) {
			this.fire("ds-update-error", e);
		},

		/**
		 * Performs an action on one or more records in this data source and returns a promise that can be used to be notified when the request is complete. 
		 * The return promise includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
		 * 
		 * @param {Number | Array} instanceId (Optional) The ID(s) to fire actions on. Can be omitted if this is a single 
		 * record datasource.
		 * @param {TriPlatDs.RefreshType} refreshType (Optional) The refresh type used to refresh after the operation.
		 * Defaults to TriPlat.RefreshType.NONE.
		 * @param {String} actionGroup (Optional) The action group name for triggering an action with this operation.
		 * @param {String} action (Optional) The action name for triggering an action with this operation.
		 * @param {Map <String, Object>} wfParameters (Optional) The workflow parameters map for the key and value.
		 * Each key-and-value pair represents a workflow parameter.
		 * The key is the workflow parameter name.
		 * The value can be a single instance ID, an array of instance IDs, an object with the '_id' property that holds the instance ID, or an array of objects that each have the '_id' property.
		 * @return {Promise} 
		 */
		performAction: function(instanceId, refreshType, actionGroup, action, wfParameters, appContext) {
			var args = this._getUpdateInstanceIdArguments(arguments);
			if (args == null) {
				console.warn("Can't perform action as no Instance ID was found or supplied.");
				return;
			}

			var wfParametersMap = this._getWFParametersMap(args.wfParameters);
			
			return new Promise(function(resolve, reject) {
				this._container.updateRecord(
					this, 
					this.context, 
					args.instanceId, 
					args.refreshType, 
					args.actionGroup, 
					args.action, 
					"_onPerformActionComplete",
					"_onPerformActionError",
					true, /* ID's only */
					resolve,
					reject,
					wfParametersMap,
					this._getOfflineMode(),
					appContext);
			}.bind(this));
		},

		// Called by triplat-ds-container-behavior
		_onPerformActionComplete: function(e) {
			this.fire("ds-perform-action-complete", e);
		},

		// Called by triplat-ds-container-behavior
		_onPerformActionError: function(e) {
			this.fire("ds-perform-action-error", e);
		},

		/**
		 * Adds a record to this data source and returns a promise that can be used to be notified when the request is complete. 
		 * The return promise includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
		 * 
		 * @param {Object | Array} data The records to be added to this data source.
		 * @param {TriPlatDs.RefreshType} refreshType (Optional) The refresh type used to refresh after the operation.
		 * @param {String} actionGroup (Optional) The action group name for triggering an action with this operation.
		 * @param {String} action (Optional) The action name for triggering an action with this operation.
		 * @param {Map <String, Object>} wfParameters (Optional) The workflow parameters map for the key and value.
		 * Each key-and-value pair represents a workflow parameter.
		 * The key is the workflow parameter name.
		 * The value can be a single instance ID, an array of instance IDs, an object with the '_id' property that holds the instance ID, or an array of objects that each have the '_id' property.
		 * @return {Promise} 		 
		 */
		addRecord: function(data, refreshType, actionGroup, action, wfParameters, appContext) {
			if (this._hasInstance) {
				console.warn("addRecord is not suppored for instance triplat-ds elements.");
				return;
			}
			var wfParametersMap = this._getWFParametersMap(wfParameters);
			
			return new Promise(function(resolve, reject) {
				this._container.addRecord(
					this,
					this.context,
					data,
					refreshType,
					actionGroup,
					action,
					resolve,
					reject,
					wfParametersMap,
					this._getOfflineMode(),
					appContext);
			}.bind(this));
		},

		// Called by triplat-ds-container-behavior
		_onAddComplete: function(e) {
			this.fire("ds-add-complete", e);
		},

		// Called by triplat-ds-container-behavior
		_onAddError: function(e) {
			this.fire("ds-add-error", e);
		},

		/**
		 * Removes a record from this data source and returns a promise that can be used to be notified when the request is complete. 
		 * The return promise includes action information such as the action group, action, and workflow parameters map.
		 * The workflow parameters map includes parameters that are sent to the server (wfParameters) and parameters that are returned by the workflow (if any exist).
		 * 
		 * @param {Object | Array} data The records to be removed from this data source.
		 * @param {TriPlatDs.RefreshType} refreshType (Optional) The refresh type used to refresh after the operation.
		 * @param {String} actionGroup (Optional) The action group name for triggering an action with this operation.
		 * @param {String} action (Optional) The action name for triggering an action with this operation.
		 * @param {Map <String, Object>} wfParameters (Optional) The workflow parameters map for the key and value.
		 * Each key-and-value pair represents a workflow parameter.
		 * The key is the workflow parameter name.
		 * The value can be a single instance ID, an array of instance IDs, an object with the '_id' property that holds the instance ID, or an array of objects that each have the '_id' property.
		 * @return {Promise} 
		 */
		removeRecord: function(data, refreshType, actionGroup, action, wfParameters, appContext) {
			if (this._hasInstance) {
				console.warn("removeRecord is not suppored for instance triplat-ds elements.");
				return;
			}
			var wfParametersMap = this._getWFParametersMap(wfParameters);
			
			return new Promise(function(resolve, reject) {
				this._container.removeRecord(
					this,
					this.context,
					data,
					refreshType,
					actionGroup,
					action,
					resolve,
					reject,
					wfParametersMap,
					this._getOfflineMode(),
					appContext);
			}.bind(this));
		},

		// Called by triplat-ds-container-behavior
		_onRemoveComplete: function(e) {
			this.fire("ds-remove-complete", e);
		},

		// Called by triplat-ds-container-behavior
		_onRemoveError: function(e) {
			this.fire("ds-remove-error", e);
		},

		_initContext: function() {
			var queryElement = Polymer.dom(this).querySelector("triplat-query");
			if (queryElement) {
				this._set_hasQuery(true);
				if (queryElement.query) {
					this._setQuery(queryElement.query);
				}
				if (queryElement.appendPage) {
					this._setAppendPage(true);
				} else {
					this._setAppendPage(false);
				}
				this.listen(queryElement, "triplat-query-changed", "_handleQueryChangedEvent");
			} else {
				this._set_hasQuery(false);
			}

			var dsInstances = Polymer.dom(this).querySelectorAll("triplat-ds-instance");
			var hasInstance;
			if (dsInstances.length == 0) {
				// means not an instance
				hasInstance = false;
			} else if (dsInstances.length == 1) {
				hasInstance = true;
				this.set("_instanceId", dsInstances[0].instanceId);
			} else {
				hasInstance = false;
				console.warn("Only one triplat-ds-instance can be defined for a triplat-ds.");
			}
			this.set("_hasInstance", hasInstance);

			var index = 0;
			var dsContexts = Polymer.dom(this).querySelectorAll("triplat-ds-context");
			this._set_contexts(new Array(dsContexts.length));
			dsContexts.forEach(function(dsContext) {
				dsContext.set("_index", index);
				index++;
			});
		},

		_handleQueryChangedEvent: function(e) {
			this._set_isQueryPaginated(e.detail.paginated);
			this._setAppendPage(e.detail.append);
			this._setQuery(e.detail.query);
		},

		_handleQueryChanged: function(query) {
			this._doUpdateDsIfNeeded();
			this._applyQuery();
		},

		_handleChildDsContextChanged: function(e) {
			e.stopPropagation();
			var dsContext = e.target;
			
			if (dsContext.contextId) {
				//dsContext.contextId is an object and can hold a single contextId or an array of contextIds
				var contextIds = this._getContextIdsFromObject(dsContext.contextId);
				var contextId = null;
				if(contextIds != null && contextIds.length > 0){
					contextId = contextIds[0];
					if(this.context != null && this.context.indexOf(""+contextId) > -1){
						//set a different contextId from the array in order to generate a different url (context) as array values can changed
						contextId = contextIds[contextIds.length-1];
					}
				}
				this._contexts[dsContext._index] = {name: dsContext.name, contextId: contextId, contextIds: contextIds};
				this._handleContextChanged();
			} else {
				this._contexts[dsContext._index] = null;
				this._handleContextChanged();
			}
		},

		_handleChildDsInstanceChanged: function(e) {
			e.stopPropagation();

			if (!this._hasInstance) {
				return;
			}

			this.set("_instanceId", e.detail.instanceId);
			this._handleContextChanged();
		},

		_handleContextChanged: function() {
			var context = "";
			if (!this.ignoreAppContext) {
				context += "/" + this._container.modelAndView + "/" + this._container.instanceId;
			}

			for (var i = 0; i < this._contexts.length; i++) {
				var contextObject = this._contexts[i];
				if (contextObject == null || contextObject.contextId==null) {
					this._setParentContext(null);
					this._setContext(null);
					this._setLoading(false);
					return;
				}
				var name = i == 0 && this.ignoreAppContext ? this._container.modelAndView : contextObject.name;
				context += "/" + name + "/" + contextObject.contextId;
			}

			context += "/" + this.name;

			if (this._hasInstance) {
				if (this._instanceId == undefined || this._instanceId == null) {
					this._setParentContext(null);
					this._setContext(null);
					this._setLoading(false);
					return;
				}
				this._setParentContext(context);
				context += "/" + this._instanceId;
			}

			this._setContext(context);
		},

		_handleContextStringChanged: function(newValue, oldValue) {
			if (oldValue) {
				this._unregister(oldValue);
			}
			if (newValue) {
				this._doUpdateDsIfNeeded();
			}
		},

		_onDisableChanged: function(disable) {
			if (disable) {
				this._unregister(this.context);
			} else {
				this._doUpdateDsIfNeeded();
			}
		},

        _onCountOnlyChanged: function(newValue, oldValue) {
        	if(this._container){
	    		this._container.updateCountOnly(this, this.context, newValue);
	        	if(!this.disable && !this.manual){
	        		this.refresh();
	        	}
        	}
        },

		_unregister: function(context) {
			this._setDsDataInternal(null);
			if (this._container) {
				this._container.unregisterContext(this, context);
			}
			this._set_registered(false);
		},

		_doUpdateDsIfNeeded: function() {
			if (this.context == undefined || this.context == null || this.context.length <= 0) {
				return;
			}
			if (this.disable) {
				return;
			}
			if (!this._container) {
				return;
			}
			if (this._hasQuery && this._isQueryPaginated == undefined) {
				return;
			}
			if (!this._hasQuery || (!this._serverFiltering && !this._isQueryPaginated)) {
				if (this._registered) {
					// already register... so just skip
				} else {
					this._container.registerContext(this, this.context, this.parentContext, this.manual, null, null, this._getOfflineMode(), this.countOnly);
					this._set_registered(true);
				}
				return;
			}

			if (!this.query) {
				return;
			}

			if (!this._registered) {
				this._container.registerContext(this, this.context, this.parentContext, this.manual, this.query, this.appendPage, this._getOfflineMode(), this.countOnly);
				this._set_registered(true);
			} else {
				this._container.updateQuery(this, this.context, this.query, this.manual, this._getOfflineMode());
			}
		},

		_applyQuery: function() {
			if (!this._serverFiltering && (!this._hasQuery || this._isQueryPaginated)) {
				return;
			}
			if (!this.data) {
				if (this.filteredData) {
					this._setFilteredData(null);
				}
				return;
			}
			if (!this.query) {
				return;
			}

			this._setFilteredData(this.query.applyQuery(this.data));
		},

		// Called by triplat-ds-container-behavior
		_setDsData: function(data) {
			this._setDsDataInternal(data);
		},

		_setDsTransitionInfo: function(transitionInfo) {
			this.set("transitionInfo", transitionInfo);
		},

		_setDsDataInternal: function(data) {
			this._internalSetData = true;
			this.set("data", data);
			this._internalSetData = false;
		},

        _notifyDsDataAppended: function(records) {
            var data = this.get("data");            
            if (records.length > 0) {
                this.notifySplices(
                    "data", 
                    [{
                        index: data.length - records.length, 
                        removed: [], 
                        addedCount: records.length, 
                        object: data, 
                        type: 'splice'
                    }]
                );
            }            
        },

		_handleDataChange: function(change) {
			this._applyQuery();

			if (change.path === "data") {
				// do nothing
				if (!this._internalSetData) {
					this._container.dsChanged(this, this.context, this.data);
				}
			} else if (change.path === "data.splices") {
				this._container.dataChanged(this, this.context, change);	
			} else {
				this._container.dataChanged(this, this.context, change);
			}
		},

		_notifyDsDataChange: function(change) {
			if (change.path === "data") {
				// do nothing
			} else if (change.path === "data.splices") {
				this.notifyPath(change.path, this.get(change.path));
			} else {
				this.notifyPath(change.path, this.get(change.path));
			}
		},

		_canFindInstanceIdForUpdate: function() {
			if (!this.data) {
				return false;
			}
			if (Array.isArray(this.data)) {
				return false;
			}
			return this._isNumber(this.data._id);
		},

		_isNumber: function(value) {
			var numberValue = parseInt(value);
			return !isNaN(numberValue);
		},

		_isNumberOrArray: function(value) {
			if (Array.isArray(value)) {
				return true;
			}
			if (this._isNumber(value)) {
				return true;
			}
			return false
		},

		_getUpdateInstanceIdArguments: function(args) {
			var instanceId = this._getInstanceIdFromArgs(args);
			if (instanceId == null) {
				return null;
			}

			var returnArgs = {
				instanceId: instanceId
			};
			returnArgs.refreshType = this._getRefreshTypeFromArgs(args);

			var actionArgs = this._getActionArgsFromArgs(args);
			if (actionArgs.length >= 2) {
				returnArgs.actionGroup = actionArgs[0];
				returnArgs.action = actionArgs[1];
				returnArgs.wfParameters = actionArgs[2];
			}

			return returnArgs;
		},

		_getInstanceIdFromArgs: function(args) {
			if (args.length > 0 && this._isNumberOrArray(args[0])) {
				return args[0];
			}

			if (!this._canFindInstanceIdForUpdate()) {
				return null;
			}

			return this.data._id;
		},

		_getRefreshTypeFromArgs: function(args) {
			var refreshType = null;
			for (var i = 0; i < args.length; i++) {
				if (i > 1) {
					break;
				}
				if (args[i] instanceof TriPlatDs.RefreshType) {
					refreshType = args[i];
					break;
				}
			}
			return refreshType == null ? TriPlatDs.RefreshType.NONE : refreshType;
		},

		_getActionArgsFromArgs: function(args) {
			//The first two strings variables that can not be numeric are the actionGroup and action variables.
			//The next variable after the action variable is the wfParameters. wfParameters variable is optional and can be string, numeric, array or object.
			var actionArgs = [];
			for (var i = 0; i < args.length; i++) {
				if (actionArgs.length==2){
					//wfParameters variable
					actionArgs.push(args[i]);
					break;
				}
				if (typeof args[i] !== "string") {
					continue;
				}
				if (this._isNumberOrArray(args[i])) {
					continue;
				}
				actionArgs.push(args[i]);
			}
			return actionArgs;
		},

		_getWFParametersMap: function(wfParameters) {
			if(wfParameters==undefined || wfParameters==null) {
				return null;
			}
			
			var keys = Object.keys(wfParameters);
			if(keys.length == 0) {
				return null;
			}

			var wfParametersMap = {};

			for(var indexKey in keys){
				var paramName = keys[indexKey];
				var paramObject = wfParameters[paramName];
				if(paramObject==null) {
					continue;
				} else if (Array.isArray(paramObject)) {
					var numberValues = [];
					for(var indexValue in paramObject) {
						var value = paramObject[indexValue];
						if (value == null) {
							continue;
						} else if(typeof value === 'object' && value._id != null) {
							var numberValue = parseInt(value._id);
							numberValues.push(numberValue);
						} else if (this._isNumber(value)) {
							var numberValue = parseInt(value);
							numberValues.push(numberValue);
						} else {
							console.warn("Skip non integer workflow parameter value: "+value);
						}
					}
					if(numberValues.length > 0) {
						wfParametersMap[paramName] = numberValues;
					}
				} else if (typeof paramObject === 'object' && paramObject._id != null) {
					var numberValue = parseInt(paramObject._id);
					wfParametersMap[paramName] = numberValue;
				} else if (this._isNumber(paramObject)) {
					var numberValue = parseInt(paramObject);
					wfParametersMap[paramName] = numberValue;
				} else {
					console.warn("Skip mapping workflow parameter name '"+ paramName + "' as its value '" + paramObject + "' is not an instance id integer.");
				}
			}
			
			return wfParametersMap;
		},

		_dsInfoChanged: function(queryTotalSize, dataLength) {
			this.notifyDsInfoChanged({totalSize: queryTotalSize, size: dataLength});
		},
		

		_getContextIdsFromObject: function(contextIdObject) {
			if(contextIdObject==undefined || contextIdObject==null) {
				return null;
			}

			var contextIds = [];
			var single = !Array.isArray(contextIdObject);

			if(single){
				if(typeof contextIdObject === 'object' && contextIdObject._id != null) {
					contextIds.push(parseInt(contextIdObject._id));
				} else if (this._isNumber(contextIdObject)) {
					contextIds.push(parseInt(contextIdObject));
				} else {
					console.warn("Non numeric context id value: "+contextId);
				}
			} else {
				for(var indexContext in contextIdObject) {
					var contextId = contextIdObject[indexContext];
					if (contextId == null) {
						continue;
					} else if(typeof contextId === 'object' && contextId._id != null) {
						contextIds.push(parseInt(contextId._id));
					} else if (this._isNumber(contextId)) {
						contextIds.push(parseInt(contextId));
					} else {
						console.warn("Skip non numeric context id value: "+contextId);
					}
				}
			}
			
			return contextIds;
		},
		
		//Called by triplat-ds-offline
		_getHierarchyPath: function() {
			var hierarchyPath = "";
			var dsContexts = Polymer.dom(this).querySelectorAll("triplat-ds-context");
			for (var i = 0; i < dsContexts.length; i++) {
				var contextObject = dsContexts[i];
				hierarchyPath += "/" + contextObject.name ;
			}
			hierarchyPath += "/" + this.name;
			return hierarchyPath;
		},
		
		//Called by triplat-ds-offline
		_getModelAndView: function() {
			return this._container.modelAndView;
		},
		
		//Called by triplat-ds-offline
		_getDSContext: function(instanceId) {
			var context = "/" + this._container.modelAndView + "/" + this._container.instanceId;
			context += this._getDSPath();			
			if (instanceId != null) {
				context += "/" + instanceId;
			}
			return context;
		},
		
		//Called by triplat-ds-offline
		_getDSPath: function() {
			var dsPath = "";
			for (var i = 0; i < this._contexts.length; i++) {
				var contextObject = this._contexts[i];
				if (contextObject == null || contextObject.contextId == null) {
					return null;
				}
				var name = i == 0 && this.ignoreAppContext ? this._container.modelAndView : contextObject.name;
				dsPath += "/" + name + "/" + contextObject.contextId;
			}
			dsPath += "/" + this.name;
			return dsPath;
		},
		
		_getOfflineMode: function() {
			if (!this._offlineMode) {
				var dsOfflineElement = this.queryEffectiveChildren("triplat-ds-offline");
				if (dsOfflineElement) {
					this._offlineMode = dsOfflineElement.mode;
				}
			}
			return this._offlineMode;
		}
	});
</script><script src="../triplat-ds/triplat-multipart-util.js"></script><script>
	Polymer({

		is: "triplat-ds-impl",

		properties: {

			context: {
				type: String,
				notify: false,
				readOnly: false
			},

			parentContext: {
				type: String,
				notify: false,
				readOnly: false
			},

			query: {
				type: Object,
				notify: false,
				readOnly: false
			},

			appendPage: {
				type: Boolean,
				notify: false,
				readOnly: false
			},

			reserveIncludeUnavailable: {
				type: Boolean,
				value: false
			},

			queryFrom: {
				type: Number,
				notify: false,
				readOnly: true,
				value: 0
			},

			querySize: {
				type: Number,
				notify: false,
				readOnly: true,
				value: 0
			},

			queryTotalSize: {
				type: Number,
				notify: false,
				readOnly: true
			},

			webContextIdElement: {
				type: Object,
				notify: false,
				readOnly: false
			},

			_registry: {
				type: Array,
				notify: false,
				readOnly: true,
				value: function() {
					return [];
				}
			},

			_data: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_transitionInfo: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_urlElement: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_activeRequestCount: {
				type: Number,
				notify: false,
				readOnly: true,
				observer: "_activeRequestCountChanged",
				value: 0
			},

			_getAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_queryAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_createAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_deleteAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_updateAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_addAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_removeAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

            countOnly: {
                type: Boolean,
                value: false
            }

		},

		get isUnregistered() {
			return this._registry.length == 0;
		},

		get _contextUrl() {
			return this._getUrl("/p/webapi/rest/v2" + this.context);
		},

		register: function(element, manual, offlineMode) {
			var doFirstRequest = this.isUnregistered && !manual;
			this.push("_registry", element);

			if (doFirstRequest) {
				this.doGet(offlineMode);
			} else {
				if (this._data) {
					element._setDsData(this._data);
				}
				if (this._activeRequestCount == 0) {
					element._setLoading(false);
				} else {
					element._setLoading(true);
				}
			}

			if (element.reserveIncludeUnavailable) {
				this.reserveIncludeUnavailable = true;
			}
		},

		unregister: function(element) {
			var registryIndex = null;
			for (var i = 0; i < this._registry.length; i++) {
				if (this._registry[i] === element) {
					registryIndex = i;
					break;
				}
			}
			if (registryIndex != null) {
				this.splice("_registry", registryIndex, 1);
			}
			if (this.isUnregistered) {
				this._set_data(null);
				this.set("webContextIdElement", null);
				// TODO do cleanup here
			}
		},

		refresh: function(promiseResolve, promiseReject, offlineMode) {
			if (this.query || this._serverFiltering) {
				var query = this._getRefreshQuery();
				this.doQueryGet(offlineMode, query, true, promiseResolve, promiseReject);
			} else {
				this.doNonQueryGet(offlineMode, promiseResolve, promiseReject);
			}
		},

		doGet: function(offlineMode) {
			if (this.query || this._serverFiltering) {
				this.doQueryGet(offlineMode);
			} else {
				this.doNonQueryGet(offlineMode);
			}
		},

		updateCountOnly: function(source, countOnly) {
			this.set("countOnly", countOnly);
		},

		updateQuery: function(query, manual, offlineMode) {
			if (!this.query.areFiltersEqual(query) || !this.query.areSortsEqual(query)) {
				this._setQueryFrom(0);
				this._setQuerySize(0);
				this._setQueryTotalSize(null);
				this._set_data(null);
				this.set("query", query);
				if (!manual) {
					this.doQueryGet(offlineMode);
				}				
				return;
			}

			if (!this.query.isPageEqual(query)) {
				this.set("query", query);
				if (!manual) {
					this.doQueryGet(offlineMode);
				}
				return;
			}

			if (!this.query.isCalendarEqual(query)) {
				this.set("query", query);
				if (!manual) {
					this.doQueryGet(offlineMode, query,true);
				}
				return;
			}
		},

		doNonQueryGet: function(offlineMode, promiseResolve, promiseReject) {
			this._incrementActiveRequestCount();

			var getAjax = this._getAjax;
			if (!getAjax) {
				getAjax = document.createElement("iron-ajax");
				getAjax.url = this._contextUrl;
				
				var params = (getAjax.params != undefined)? getAjax.params:{};
				params.countOnly = this.countOnly;
				getAjax.params = params;

				this._addMultiContextIdsParam(getAjax);

				getAjax.addEventListener("response", this._onNonQueryGetRespone.bind(this));
				getAjax.addEventListener("error", this._onError.bind(this, "_onGetError"));
				this._set_getAjax(getAjax);
			}

			this._ajaxWithWebContextId(getAjax, offlineMode, null, function() {
				var params = (getAjax.params != undefined)? getAjax.params:{};
				params.countOnly = this.countOnly;
				getAjax.params = params;

				this._reserveIncludeUnavailable(getAjax, null);
				var request = getAjax.generateRequest();
				request._promiseResolve = promiseResolve;
				request._promiseReject = promiseReject;
			});
		},

		_addMultiContextIdsParam: function(ajax) {
			if(this._registry!=undefined && this._registry.length>0){
				var currentDs = this._registry[0];
				var numOfDsContexts = currentDs._contexts.length;
				
				if(numOfDsContexts>0) {
					var parentDsContext = currentDs._contexts[numOfDsContexts-1];
					
					if(parentDsContext.contextIds != undefined && parentDsContext.contextIds.length>1) {
						var params = (ajax.params != undefined)? ajax.params:{};
						params.multiContextIds = parentDsContext.contextIds.join();
						ajax.params = params;
					}
				}
			}
		},

		_onNonQueryGetRespone: function(e) {
			this._updateDataFromResponse(e.detail.response);
			this._notifyComplete("_onGetComplete", e.detail.response);
			var promiseResolve = e.detail._promiseResolve;
			if (promiseResolve) {
				promiseResolve(e.detail.response);
			}

			this._decrementActiveRequestCount();
		},

		doQueryGet: function(offlineMode, query, force, promiseResolve, promiseReject) {

			var query = query || this.query;

			if (!this._data) {
				this._set_data([]);
			}

			if (!force && this.queryTotalSize != null && this.queryTotalSize != undefined) {
				if (query.page.from >= this.queryTotalSize) {
					// nothing more to get
					return;
				}
			}

			var queryLastIndex = query.page.from + query.page.size - 1;
			var dataLastIndex = this.queryFrom + this.querySize - 1;
			if (!force && query.page.from >= this.queryFrom && queryLastIndex <= dataLastIndex) {
				// we already have all the data
				return;
			}

			this._incrementActiveRequestCount();

			var queryAjax = this._queryAjax;
			if (!queryAjax) {
				queryAjax = document.createElement("iron-ajax");
				queryAjax.url = this._contextUrl;

				var params = (queryAjax.params != undefined)? queryAjax.params:{};
				params.countOnly = this.countOnly;
				queryAjax.params = params;
				
				this._addMultiContextIdsParam(queryAjax);

				queryAjax.addEventListener("response", this._onQueryGetRespone.bind(this));
				queryAjax.addEventListener("error", this._onError.bind(this, "_onGetError"));
				queryAjax.method = "POST";
				queryAjax.contentType = "application/json";
				this._set_queryAjax(queryAjax);
			}

			this._ajaxWithWebContextId(queryAjax, offlineMode, null, function() {
				var params = (queryAjax.params != undefined)? queryAjax.params:{};
				params.query = true;
				params.countOnly = this.countOnly;
				queryAjax.params = params;
				this._reserveIncludeUnavailable(queryAjax, params);
				queryAjax.body = JSON.stringify(query);
				var request = queryAjax.generateRequest();
				request._promiseResolve = promiseResolve;
				request._promiseReject = promiseReject;
			});
		},

		_reserveIncludeUnavailable: function(request, params) {
			if (this.reserveIncludeUnavailable) {
				if (params == null) {
					var params = {reserveIncludeUnavailable: true};
					request.params = params;
				} else {
					params.reserveIncludeUnavailable = true;
					request.params = params;
				}
			}
		},

		_onQueryGetRespone: function(e) {
			this._updateDataFromResponse(e.detail.response);

			this._notifyComplete("_onGetComplete", e.detail.response);
			var promiseResolve = e.detail._promiseResolve;
			if (promiseResolve) {
				promiseResolve(e.detail.response);
			}
			this._decrementActiveRequestCount();
		},

		createRecord: function(element, data, refreshType, actionGroup, action, promiseResolve,
				promiseReject, wfParametersMap, offlineMode, appContext) {
			this._incrementActiveRequestCount();

			var createAjax = this._createAjax;
			if (!createAjax) {
				createAjax = document.createElement("iron-ajax");
				createAjax.url = this._contextUrl;
				createAjax.addEventListener("response", this._handleCreateResponse.bind(this));
				createAjax.addEventListener("error", this._onError.bind(this, "_onCreateError"));
				createAjax.method = "POST";
				createAjax.contentType = "application/json";
				this._set_createAjax(createAjax);
			}

			this._ajaxWithWebContextId(createAjax, offlineMode, appContext, function() {
				
				this._updateAjaxWithBody(createAjax, data, refreshType, wfParametersMap);

				var params = {};
				if (actionGroup && action) {
					params.actionGroup = actionGroup;
					params.action = action;
				}
				if (this._isServerRefreshType(refreshType)) {
					params.refresh = true;
				}
				createAjax.params = params;
				var request = createAjax.generateRequest();
				request._promiseResolve = promiseResolve;
				request._promiseReject = promiseReject;

				if (!this._shouldDoClientRefresh(refreshType)) {
					return;
				}

				// client refresh logic
				request._refresh = data;
				request._element = element;

				var dsData = this._data;
				if (Array.isArray(dsData) && Array.isArray(data)) {
					// multi record ds and creating multiple records
					data.forEach(function(record) {
						element.push("data", record);
					});
				} else if (Array.isArray(dsData) && !Array.isArray(data)) {
					// multi record ds and creating single record
					element.push("data", data);
				} else if (!Array.isArray(dsData) && !Array.isArray(data)) {
					// single record ds and creating single record
					this._setDataWithNotify(data);
				} else {
					// single record ds and creating multiple records
					// this shouldn't happen
				}
			});
		},

		_handleCreateResponse: function(e) {
			var createdRecordIdDetails = null;
			var response = e.detail.response;
			if (response.createdRecordId) {
				createdRecordIdDetails = response.createdRecordId;
			} else if (response.createdRecordIds) {
				createdRecordIdDetails = response.createdRecordIds;
			}

			var context = this.context;

			if (response.refresh) {
				this._updateDataFromResponse(response.refresh);
			} else if (e.detail._refresh) {
				var data = this._data;
				if (Array.isArray(data)) {
					var idsToUpdate = Array.isArray(createdRecordIdDetails) ? createdRecordIdDetails : [createdRecordIdDetails];
					var recordsToUpdate = Array.isArray(e.detail._refresh) ? e.detail._refresh : [e.detail._refresh];
					for (var i = 0; i < idsToUpdate.length; i++) {
						var idToUpdate = idsToUpdate[i];
						var recordToUpdate = recordsToUpdate[i];
						var index = this._getRecordIndexByRecord(recordToUpdate);
						if (index != null && index >= 0) {
							e.detail._element.set("data." + index + "._id", idToUpdate);
						}
					}
				} else {
					if (Array.isArray(createdRecordIdDetails)) {
						// this shouldn't happen
					} else {
						e.detail._element.set("data._id", idToUpdate);
					}
				}
			}

			var responseDetail = null;
			if(e.detail.response.wfParametersMap) {
				//response detail includes wf parameters map and the created record id(s) 
				responseDetail = this._getResponseDetail(e);
				responseDetail.createdRecordId = response.createdRecordId;
				responseDetail.createdRecordIds = response.createdRecordIds;
			} else {
				//Backwards competability, if user do not pass wf parameters map to the ds action, 
				//the response detail only includes the created record id(s) 
				responseDetail = createdRecordIdDetails;
			}

			this._notifyComplete("_onCreateComplete", responseDetail); //include responseDetail with fire event
			var promiseResolve = e.detail._promiseResolve;
			promiseResolve(responseDetail); //include responseDetail with promise event
			
			this._decrementActiveRequestCount();
		},

		deleteRecord: function(element, instanceId, refreshType, actionGroup, action, promiseResolve, 
				promiseReject, wfParametersMap, offlineMode, appContext) {
			this._incrementActiveRequestCount();

			var deleteAjax = this._deleteAjax;
			if (!deleteAjax) {
				deleteAjax = document.createElement("iron-ajax");
				deleteAjax.url = this._contextUrl;
				deleteAjax.addEventListener("response", this._handleDeleteResponse.bind(this));
				deleteAjax.addEventListener("error", this._onError.bind(this, "_onDeleteError"));
				deleteAjax.method = "POST";
				deleteAjax.contentType = "application/json";
				this._set_deleteAjax(deleteAjax);
			}

			this._ajaxWithWebContextId(deleteAjax, offlineMode, appContext, function() {
				var params = {};
				params.method = "delete";
				if (actionGroup && action) {
					params.actionGroup = actionGroup;
					params.action = action;
				}
				if (this._isServerRefreshType(refreshType)) {
					params.refresh = true;
				}
				deleteAjax.params = params;

				var instanceIds = Array.isArray(instanceId) ? instanceId : [instanceId];
				var recordIds = [];
				instanceIds.forEach(function(recordId) {
					// TODO check if the record ID is in the data source
					recordIds.push({_id: recordId});
				});

				this._updateAjaxWithBody(deleteAjax, recordIds, refreshType, wfParametersMap);

				var request = deleteAjax.generateRequest();
				request._promiseResolve = promiseResolve;
				request._promiseReject = promiseReject;

				if (!this._shouldDoClientRefresh(refreshType)) {
					return;
				}

				// client refresh logic
				var data = this._data;
				if (Array.isArray(data)) {
					var refreshIds = Array.isArray(instanceId) ? instanceId : [instanceId];
					refreshIds.forEach(function(refreshId) {
						var index = this._getRecordIndexById(refreshId);
						if (index != null && index >= 0) {
							element.splice("data", index, 1);
						}
					}.bind(this));
				} else {
					// TODO make sure the record is the one being deleted?
					this._setDataWithNotify({});
				}
			});
		},

		_handleDeleteResponse: function(e) {
			var registry = this._registry;
			var response = e.detail.response;

			if (response.refresh) {
				this._updateDataFromResponse(response.refresh);
			}

			var responseDetail = this._getResponseDetail(e);
			this._notifyComplete("_onDeleteComplete", responseDetail); //include responseDetail with fire event
			e.detail._promiseResolve(responseDetail); //include responseDetail with promise event

			this._decrementActiveRequestCount();
		},

		updateRecord: function(element, instanceId, refreshType, actionGroup, action, 
				completeFunctionName, errorFunctionName, idsOnly, parentDs, promiseResolve, 
				promiseReject, wfParametersMap, offlineMode, appContext) {
			this._incrementActiveRequestCount();

			var updateAjax = this._updateAjax;
			if (!updateAjax) {
				updateAjax = document.createElement("iron-ajax");
				updateAjax.url = this._contextUrl;
				updateAjax.addEventListener("response", this._handleUpdateResponse.bind(this));
				updateAjax.addEventListener("error", this._onErrorDynamicErrorFunctionName.bind(this));
				updateAjax.contentType = "application/json";
				this._set_updateAjax(updateAjax);
			}
			updateAjax.method = "PUT";

			this._ajaxWithWebContextId(updateAjax, offlineMode, appContext, function() {
				var params = {};
				if (actionGroup && action) {
					params.actionGroup = actionGroup;
					params.action = action;
				}
				if (this._isServerRefreshType(refreshType)) {
					params.refresh = true;
				}
				params.method = "update";
				updateAjax.params = params;

				var single = !Array.isArray(instanceId);
				var instanceIds = single ? [instanceId] : instanceId;
				var data = this._data;
				var recordsToUpdate = [];
				instanceIds.forEach(function(recordId) {
					if (Array.isArray(data)) {
						var record = this._getRecordById(recordId);
						if (record == null) {
							console.warn("Can't update record because no record found with ID [id=" + recordId + "]");
							return;
						}
						recordsToUpdate.push(record);
					} else {
						recordsToUpdate.push(data);
					}
				}.bind(this));

				if (idsOnly) {
					var recordIdsToUpdate = [];
					recordsToUpdate.forEach(function(recordToUpdate) {
						recordIdsToUpdate.push({_id: recordToUpdate._id});
					});
					recordsToUpdate = recordIdsToUpdate;
				}

				if (single) {
					recordsToUpdate = recordsToUpdate[0];
				}

				this._updateAjaxWithBody(updateAjax, recordsToUpdate, refreshType, wfParametersMap);

				var request = updateAjax.generateRequest();
				request._completeFunctionName = completeFunctionName;
				request._errorFunctionName = errorFunctionName;
				request._parentDs = parentDs;
				request._promiseResolve = promiseResolve;
				request._promiseReject = promiseReject;

				if (!this._shouldDoClientRefresh(refreshType) 
						|| !this.parentContext 
						|| Array.isArray(instanceId)
						|| idsOnly) {
					return;
				}

				// Client Refresh for parent data source
				if (!parentDs || !parentDs._data) {
					return;
				}

				var parentDsData = parentDs._data;
				if (Array.isArray(parentDsData)) {
					var index = parentDs._getRecordIndexById(instanceId);
					if (index != null && index >= 0) {
						parentDs._registry[0].set("data." + index, data);
					}
				} else if (parentDsData._id == instanceId) {
					parentDs._registry[0].set("data", data);
				}
			});
		},

		_handleUpdateResponse: function(e) {
			var refresh = e.detail.response.refresh;

			if (refresh) {
				this._updateDataFromResponse(refresh);

				var parentDs = e.detail._parentDs;
				if (parentDs && parentDs._data) {
					var parentDsData = parentDs._data;

					if (Array.isArray(parentDsData)) {
						var index = parentDs._getRecordIndexById(refresh.data._id);
						if (index != null && index >= 0) {
							parentDs._registry[0].set("data." + index, refresh.data);
						}
					} else if (parentDsData._id == refresh.data._id) {
						parentDs._registry[0].set("data", refresh.data);
					}
				}
			}

			var completeFunctionName = e.detail._completeFunctionName;
			var responseDetail = this._getResponseDetail(e);
			this._notifyComplete(completeFunctionName, responseDetail); //include responseDetail with fire event
			e.detail._promiseResolve(responseDetail); //include responseDetail with promise event

			this._decrementActiveRequestCount();
		},

		addRecord: function(element, data, refreshType, actionGroup, action, promiseResolve, 
				promiseReject, wfParametersMap, offlineMode, appContext) {
			this._incrementActiveRequestCount();

			var addAjax = this._addAjax;
			if (!addAjax) {
				addAjax = document.createElement("iron-ajax");
				addAjax.url = this._contextUrl;
				addAjax.addEventListener("response", this._handleAddResponse.bind(this));
				addAjax.addEventListener("error", this._onError.bind(this, "_onAddError"));
				addAjax.method = "PUT";
				addAjax.contentType = "application/json";
				this._set_addAjax(addAjax);
			}

			this._ajaxWithWebContextId(addAjax, offlineMode, appContext, function() {
				var params = {type: "add"};
				if (actionGroup && action) {
					params.actionGroup = actionGroup;
					params.action = action;
				}
				if (this._isServerRefreshType(refreshType)) {
					params.refresh = true;
				}
				addAjax.params = params;

				this._updateAjaxWithBody(addAjax, data, refreshType, wfParametersMap);

				var request = addAjax.generateRequest();
				request._promiseResolve = promiseResolve;
				request._promiseReject = promiseReject;

				if (!this._shouldDoClientRefresh(refreshType)) {
					return;
				}

				// Refresh Logic
				var dsData = this._data;
				if (Array.isArray(dsData)) {
					var dataArray = Array.isArray(data) ? data : [data];
					dataArray.forEach(function(record) {
						// check if it is in the ds already
						var foundIndex = this._getRecordIndexById(record._id);
						var found = foundIndex != null && foundIndex >= 0;
						if (!found) {
							element.push("data", record);
						}
					}.bind(this));
				} else {
					if (Array.isArray(data)) {
						// this shouldn't happen
					} else {
						this._setDataWithNotify(data);
					}
				}
			});
		},

		_handleAddResponse: function(e) {
			var refresh = e.detail.response.refresh;

			if (refresh) {
				this._updateDataFromResponse(refresh);
			}

			var responseDetail = this._getResponseDetail(e);
			this._notifyComplete("_onAddComplete", responseDetail); //include responseDetail with fire event
			e.detail._promiseResolve(responseDetail); //include responseDetail with promise event

			this._decrementActiveRequestCount();
		},

		removeRecord: function(element, data, refreshType, actionGroup, action, promiseResolve,
				promiseReject, wfParametersMap, offlineMode, appContext) {
			this._incrementActiveRequestCount();

			var removeAjax = this._removeAjax;
			if (!removeAjax) {
				removeAjax = document.createElement("iron-ajax");
				removeAjax.url = this._contextUrl;
				removeAjax.addEventListener("response", this._handleRemoveResponse.bind(this));
				removeAjax.addEventListener("error", this._onError.bind(this, "_onRemoveError"));
				removeAjax.method = "PUT";
				removeAjax.contentType = "application/json";
				this._set_removeAjax(removeAjax);
			}

			this._ajaxWithWebContextId(removeAjax, offlineMode, appContext, function() {
				var params = {type: "remove"};
				if (actionGroup && action) {
					params.actionGroup = actionGroup;
					params.action = action;
				}
				if (this._isServerRefreshType(refreshType)) {
					params.refresh = true;
				}
				removeAjax.params = params;

				this._updateAjaxWithBody(removeAjax, data, refreshType, wfParametersMap);

				var request = removeAjax.generateRequest();
				request._promiseResolve = promiseResolve;
				request._promiseReject = promiseReject;

				if (!this._shouldDoClientRefresh(refreshType)) {
					return;
				}

				// Client Refresh Logic
				var dsData = this._data;
				if (Array.isArray(dsData)) {
					var dataArray = Array.isArray(data) ? data : [data];
					dataArray.forEach(function(record) {
						var index = this._getRecordIndexById(record._id);
						if (index != null && index >= 0) {
							element.splice("data", index, 1);
						}
					}.bind(this));
				} else {
					if (Array.isArray(data)) {
						// this shouldn't happen
					} else {
						this._setDataWithNotify({});
					}
				}
			});
		},

		_handleRemoveResponse: function(e) {
			var refresh = e.detail.response.refresh;

			if (refresh) {
				this._updateDataFromResponse(refresh);
			}

			var responseDetail = this._getResponseDetail(e);
			this._notifyComplete("_onRemoveComplete", responseDetail); //include responseDetail with fire event
			e.detail._promiseResolve(responseDetail); //include responseDetail with promise event

			this._decrementActiveRequestCount();
		},

		_getResponseDetail: function(e) {
			var responseDetail = {};
			responseDetail.wfParametersMap = e.detail.response.wfParametersMap;
			responseDetail.actionGroupName = e.detail.response.actionGroupName;
			responseDetail.actionName = e.detail.response.actionName;
			return responseDetail;			
		},
		
		dsChanged: function(source, data) {
			this._set_data(data);
			this._registry.forEach(function(element) {
				if (element !== source) {
					element._setDsData(data);
				}
			});
		},

		dataChanged: function(source, change) {
			this._registry.forEach(function(element) {
				if (element !== source) {
					element._notifyDsDataChange(change);
				}
			});
		},

		_shouldDoClientRefresh: function(refreshType) {
			if (!this._isClientRefreshType(refreshType)) {
				return false;
			}
			if (this.query) {
				console.warn("Paginated data sources cannot do client refreshing.");
				return false;
			} else {
				return true;
			}
		},

		_isServerRefreshType: function(refreshType) {
			return refreshType === TriPlatDs.RefreshType.SERVER || refreshType === TriPlatDs.RefreshType.BOTH;
		},

		_isClientRefreshType: function(refreshType) {
			return refreshType === TriPlatDs.RefreshType.CLIENT || refreshType === TriPlatDs.RefreshType.BOTH;
		},

		_getRecordById: function(recordId) {
			var recordInfo = this._getRecordInfoById(recordId);
			return recordInfo == null ? null : recordInfo.record;
		},

		_getRecordIndexById: function(recordId) {
			var recordInfo = this._getRecordInfoById(recordId);
			return recordInfo == null ? null : recordInfo.index;
		},

		_getRecordIndexByRecord: function(record) {
			var records = this._data;
			if (!records) {
				return -1;
			}

			if (!Array.isArray(records)) {
				if (record === records) {
					return 0;
				} else {
					return -1;
				}
			}

			return records.indexOf(record);
		},

		_getRecordInfoById: function(recordId) {
			var records = this._data;
			if (!records) {
				return null;
			}
			
			if (!Array.isArray(records)) {
				if (records._id == recordId) {
					return {
						record: records,
						index: -1
					};
				} else {
					return null;
				}
			}

			var foundInfo = null;
			for (var i = 0; i < records.length; i++) {
				if (records[i]._id == recordId) {
					foundInfo = {
						record: records[i],
						index: i
					};
					break;
				}
			}

			return foundInfo;
		},

		_incrementActiveRequestCount: function() {
			this._set_activeRequestCount(this._activeRequestCount + 1);
		},

		_decrementActiveRequestCount: function() {
			this._set_activeRequestCount(this._activeRequestCount - 1);
		},

		_activeRequestCountChanged: function(activeRequestCount) {
			if (activeRequestCount == 0) {
				this._registry.forEach(function(element) {
					element._setLoading(false);
				});
			} else if (activeRequestCount == 1) {
				this._registry.forEach(function(element) {
					element._setLoading(true);
				});
			}
		},

		_updateDataWithNotify: function(records) {
			for (var i = 0; i < records.length; i++) {
				this._data.push(records[i]);
			}

			this._registry.forEach(function(element) {
				element._notifyDsDataAppended(records);
			});
		},


		_setDataWithNotify: function(data) {
			this._set_data(data);
			this._registry.forEach(function(element) {
				element._setDsData(data);
			});
		},

		_setTransitionInfoWithNotify: function(transitionInfo) {
			this._set_transitionInfo(transitionInfo);
			this._registry.forEach(function(element) {
				element._setDsTransitionInfo(transitionInfo);
			});
		},

		_setQueryTotalSizeWithNotify: function(totalSize) {
			this._setQueryTotalSize(totalSize);
			this._registry.forEach(function(element) {
				element._setQueryTotalSize(totalSize);
			});
		},

		_notifyComplete: function(functionName) {
			var args = null;
			if (arguments.length == 0) {
				console.warn("_notifyComplete no function name");
				return;
			} else if (arguments.length > 1) {
				args = [];
				for (var i = 1; i < arguments.length; i++) {
					args.push(arguments[i]);
				}
			}

			this._registry.forEach(function(element) {
				var completeFunction = element[functionName];
				completeFunction.apply(element, args);
			});
		},

		_onErrorDynamicErrorFunctionName: function(e) {
			var request = e.detail.request;
			var errorFunctionName = request._errorFunctionName;
			this._onError(errorFunctionName, e);
		},

		_onError: function(functionName, e) {
			var request = e.detail.request;
			var xhr = request.xhr;
			var errorCode = xhr.status;
			
			switch (errorCode) {
				
				case 401:
					// Unauthorized - Need to login
					break;
				case 403:
					// Forbidden - User doesn't have correct access
					var errorDialog = document.getElementById("triPlatDsErrorDialog");
					var errorMsg = document.getElementById("triPlatDsErrorMsg");
					var __dictionary__title = "Security Warning";
					var __dictionary__line2 = "Contact your TRIRIGA administrator for assistance.";
					var __dictionary__read = "You do not have permission to access this page.";
					var __dictionary__update = "You do not have permission to update this record.";
					var __dictionary__create = "You do not have permission to create records.";
					var __dictionary__delete = "You do not have permission to delete records.";
					var __dictionary__action = "You do not have permission to perform the action.";
					var __dictionary__context = "Context security check has failed. Verify that your application has the proper security.";
					if(xhr.response && xhr.response.operation)
					{
						var operation = xhr.response.operation;
						var action = xhr.response.action;
						
						errorMsg.titleLabel = __dictionary__title;
						errorMsg.message_line2Label = __dictionary__line2;
						switch(operation)
						{
						case "read":
							errorMsg.message_line1Label = __dictionary__read;
							break;
						case "update":
							errorMsg.message_line1Label = __dictionary__update;
							break;
						case "create":
							errorMsg.message_line1Label = __dictionary__create;
							break;
						case "delete":
							errorMsg.message_line1Label = __dictionary__delete;
							break;
						case "action":
							errorMsg.message_line1Label = __dictionary__action;
							break;
						case "context":
							errorMsg.message_line1Label = __dictionary__context;
							break;
						default:
							//invalid operation
							console.log("Illegal security check operation: "+operation);
						}
					} else {
						errorMsg.title = "Error: " + e.detail.request.status + " : " + e.detail.request.statusText;
						if (xhr.response.message) {
								errorMsg.message_line1 = xhr.response.message;
							}
					}
					errorDialog.opened = true;
					break;
				default:
					// All other errors
			}

			var promiseReject = request._promiseReject;

			var eventDetail = xhr.response != null ? xhr.response : {};
			eventDetail.status = xhr.status;
			this._notifyComplete(functionName,eventDetail);

			if (promiseReject) {
				promiseReject();
				if(eventDetail.message) {
					console.log(eventDetail.message);
				}
			}

			this._decrementActiveRequestCount();
		},

		_getUrl: function(url) {
			var urlElement = this._urlElement;
			if (!urlElement) {
				urlElement = document.createElement("tricore-url");
				this._set_urlElement(urlElement);
			}
			return urlElement.getUrl(url);
		},

		_updateAjaxWithBody: function(ajax, data, refreshType, wfParametersMap) {
			var dataCopy = this._copyData(data);
			var usavedFiles = triplatMultipartUtil.handleUnsavedFiles(dataCopy);
			
			var body = {data: dataCopy};
			if (this.query && this._isServerRefreshType(refreshType)) {
				var query = this._getRefreshQuery();
				body.query = query;
			}
			if(wfParametersMap) {
				body.wfParametersMap = wfParametersMap;
			}
			
			var bodyJson = JSON.stringify(body);
			
			if (usavedFiles == null) {
				ajax.body = bodyJson;
				ajax.contentType = "application/json";
			} else {
				var boundary = triplatMultipartUtil.generateMultipartFormDataBoundary();
				ajax.contentType = "multipart/form-data; boundary=" + boundary;
				var formData = triplatMultipartUtil.buildMultipartFormData(
						ajax.contentType,
						boundary, 
						bodyJson, 
						JSON.stringify(usavedFiles.imageFieldMap), 
						JSON.stringify(usavedFiles.fileFieldMap), 
						usavedFiles.files);
				ajax.body = formData;
				ajax.method = "POST";
			}
		},

		_getRefreshQuery: function() {
			if (!this.query) {
				return null;
			}

			if (!this.queryTotalSize) {
				//It is a first request from this triplat-ds-impl, so just use the query object.
				return this.query;
			}

			var querySize = this.querySize;
			if (this.queryTotalSize==this.querySize) {
			    //The data source queryTotalSize is updated after records retrieved.
				//Therefore, when querySize reached the queryTotalSize, increase requested querySize by one (in case record was added and DS refreshed).
				querySize = querySize+1;
			} else if (this.queryTotalSize> 0 && this.querySize==0) {
				//It is a first request from this triplat-ds-impl after countOnly was change to false, so just use the query object.
				return this.query;
			}
			
			var page = {
				from: this.queryFrom,
				size: querySize
			};
			var query = new TriplatQuery.Query(page, this.query.filters, this.query.sorts, this.query.calendar);
			return query;
		},

		_ajaxWithWebContextId: function(ajax, offlineMode, appContext, callback) {
			this.webContextIdElement.getWebContextId().then(function(webContextId) {
				ajax.headers = {"triWebContextId": webContextId};
				if (offlineMode) {
					ajax.headers["tri-offline-mode"] = offlineMode;
				}
				if (appContext && (typeof appContext === "string")) {
					ajax.headers["app-context"] = this._encodeAppContext(appContext);
				}
				callback.call(this);
			}.bind(this));
		},
		
		_encodeAppContext: function(str) {
			// first encodeURIComponent to get percent-encoded UTF-8,
			// then convert the percent encodings into raw bytes
			// then convert the raw bytes into BASE64 string
			return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
				function toSolidBytes(match, p1) {
					return String.fromCharCode('0x' + p1);
			}));
		},

		_updateDataFromResponse: function(payload) {
			if (this.query) {
				this._updateDataFromResponseQuery(payload);
			} else {
				this._updateDataFromResponseNonQuery(payload);
			}
		},

		_updateDataFromResponseNonQuery: function(payload) {
			this._setDataWithNotify(payload.data);
			this._setTransitionInfoWithNotify(payload.transitionInfo);
			this._setQueryTotalSizeWithNotify(payload.totalSize);
		},

		_updateDataFromResponseQuery: function(payload) {
			var records = payload.data;
			var from = payload.from;
			var size = payload.size;
			this._setQueryTotalSizeWithNotify(payload.totalSize);

			if (this.appendPage) {
				var firstIndex = Math.min(this.queryFrom, from);
				var lastIndex = Math.max(this.queryFrom + this.querySize, from + size) - 1;
				var newSize = lastIndex - firstIndex + 1;

				this._setQueryFrom(firstIndex);
				this._setQuerySize(newSize);
				
				if (this.queryFrom == 0 && from == 0) {
					this._setDataWithNotify(records);
				} else {
					this._updateDataWithNotify(records);
				}
			} else {
				this._setQueryFrom(from);
				this._setQuerySize(size);
				this._setDataWithNotify(records);
			}
		},
		
		_copyData: function(data) {
			if (data == null) {
				return null;
			}
			var copy = null;
			if (Array.isArray(data)) {
				copy = data.map(this._copyRecord);				
			} else {
				copy = this._copyRecord(data);
			}			
			return copy;
		},
		
		_copyRecord: function(record) {
			var copy = {};
			for (var attr in record) {
				copy[attr] = record[attr];
			}
			return copy;
		}
	});
</script><script>
	Polymer.TriplatDsContainerBehavior = {

		isTriplatDsContainer: true,

		properties: {

			_dsImplsByContext: {
				type: Object,
				notify: false,
				readOnly: true,
				value: function() { return {}; }
			},

			_queryDsElements: {
				type: Array,
				notify: false,
				readOnly: true,
				value: function() { return []; }
			},

			_queryDsImpls: {
				type: Array,
				notify: false,
				readOnly: true,
				value: function() { return []; }
			}

		},

		// called by triplat-ds
		registerContext: function(element, context, parentContext, manual, query, appendPage, offlineMode, countOnly) {
			var dsImpl = null;
			if (query) {
				dsImpl = this._getQueryDsImpl(element);
			} else {
				dsImpl = this._getNonQueryDsImpl(context);
			}
			if (!dsImpl) {
				dsImpl = document.createElement("triplat-ds-impl");
				dsImpl.context = context;
				dsImpl.parentContext = parentContext;
				dsImpl.query = query;
				dsImpl.countOnly = countOnly;
				dsImpl.appendPage = appendPage;
				dsImpl.webContextIdElement = this;
				if (query) {
					this.push("_queryDsElements", element);
					this.push("_queryDsImpls", dsImpl);
				} else {
					this.set("_dsImplsByContext." + context, dsImpl);
				}
			}

			dsImpl.register(element, manual, offlineMode);
		},

		unregisterContext: function(element, context) {
			var dsImpl = this._getDsImpl(element, context);
			if (!dsImpl) {
				return;
			}
			
			dsImpl.unregister(element);

			if (dsImpl.isUnregistered) {
				var queryDsImplIndex = this._queryDsElements.indexOf(element);
				if (queryDsImplIndex > -1) {
					this.splice("_queryDsElements", queryDsImplIndex, 1);
					this.splice("_queryDsImpls", queryDsImplIndex, 1);
				} else {
					this.set("_dsImplsByContext." + context, null);
				}
			}
		},

		refresh: function(element, context, promiseResolve, promiseReject, offlineMode) {
			var dsImpl = this._getDsImpl(element, context);
			if (!dsImpl) {
				return;
			}
			dsImpl.refresh(promiseResolve, promiseReject, offlineMode);
		},

		updateQuery: function(element, context, query, manual, offlineMode) {
			var dsImpl = this._getDsImpl(element, context);
			if (!dsImpl) {
				return;
			}

			dsImpl.updateQuery(query, manual, offlineMode);
		},

		createRecord: function(element, context, data, refreshType, actionGroup, action, promiseResolve, 
				promiseReject, wfParametersMap, offlineMode, appContext) {
			var dsImpl = this._getDsImpl(element, context);
			if (!dsImpl) {
				return;
			}
					
			if(this.markDataSourceClean) {
				this.markDataSourceClean(context);
			}
			
			dsImpl.createRecord(element, data, refreshType, actionGroup, action, promiseResolve, promiseReject, 
					wfParametersMap, offlineMode, appContext);
		},

		deleteRecord: function(element, context, instanceId, refreshType, actionGroup, action, promiseResolve,
				promiseReject, wfParametersMap, offlineMode, appContext) {
			var dsImpl = this._getDsImpl(element, context);
			if (!dsImpl) {
				return;
			}

			dsImpl.deleteRecord(element, instanceId, refreshType, actionGroup, action, promiseResolve, promiseReject, 
					wfParametersMap, offlineMode, appContext);
		},

		updateRecord: function(element, context, instanceId, refreshType, actionGroup, action, 
				completeFunctionName, errorFunctionName, idsOnly, promiseResolve, promiseReject, wfParametersMap, 
				offlineMode, appContext) {
			var dsImpl = this._getDsImpl(element, context);
			if (!dsImpl) {
				return;
			}

			var parentDs = null;
			if (dsImpl.parentContext) {
				var parentContext = dsImpl.parentContext;
				parentDs = this._dsImplsByContext[parentContext];
			}
			
			if(this.markDataSourceClean) {
				this.markDataSourceClean(context);
			}

			dsImpl.updateRecord(element, instanceId, refreshType, actionGroup, action, 
				completeFunctionName, errorFunctionName, idsOnly, parentDs, promiseResolve, 
				promiseReject, wfParametersMap, offlineMode, appContext);
		},

		addRecord: function(element, context, data, refreshType, actionGroup, action, promiseResolve, 
				promiseReject, wfParametersMap, offlineMode, appContext) {
			var dsImpl = this._getDsImpl(element, context);
			if (!dsImpl) {
				return;
			}

			dsImpl.addRecord(element, data, refreshType, actionGroup, action, promiseResolve, 
					promiseReject, wfParametersMap, offlineMode, appContext);
		},

		removeRecord: function(element, context, data, refreshType, actionGroup, action, promiseResolve, 
				promiseReject, wfParametersMap, offlineMode, appContext) {
			var dsImpl = this._getDsImpl(element, context);
			if (!dsImpl) {
				return;
			}

			dsImpl.removeRecord(element, data, refreshType, actionGroup, action, promiseResolve, 
					promiseReject, wfParametersMap, offlineMode, appContext);
		},

		// called by triplat-ds
		dsChanged: function(source, context, data) {
			var dsImpl = this._getDsImpl(source, context);
			if (!dsImpl) {
				return;
			}

			dsImpl.dsChanged(source, data);
		},

		// called by triplat-ds
		dataChanged: function(source, context, change) {
			var dsImpl = this._getDsImpl(source, context);
			if (!dsImpl) {
				return;
			}
			dsImpl.dataChanged(source, change);
		},

		// called by triplat-ds
		updateCountOnly: function(source, context, change) {
			var dsImpl = this._getDsImpl(source, context);
			if (!dsImpl) {
				return;
			}
			dsImpl.updateCountOnly(source, change);
		},

		_getDsImpl: function(element, context) {
			return this._getQueryDsImpl(element) || this._getNonQueryDsImpl(context);
		},

		_getQueryDsImpl: function(element) {
			var queryDsImplIndex = this._queryDsElements.indexOf(element);
			if (queryDsImplIndex > -1) {
				return this._queryDsImpls[queryDsImplIndex];
			}
			return null;
		},

		_getNonQueryDsImpl: function(context) {
			return this._dsImplsByContext[context];
		}

	};
</script><script>
(function() {

	var trackValue = {};
	var changeStatus = {};
	var customMessage = "Unsaved data";
	var checkEnable = true;
	var _useModernDialog = null;
	var _availableDs = {};

	TriPlatChangeTrackerBehavior = {
		
		_getDataSourceFromContext: function(context) {
			var contextParts = context.split('/');
			var retDsName;
			var indexValue = -1;
			for(dsName in _availableDs) {
				if (contextParts.indexOf(dsName) > indexValue) {
					retDsName = dsName;
					indexValue = contextParts.indexOf(dsName)
				}
			}
			if (indexValue != -1) return retDsName;
			//console.log("can't find data source in context (" + context +")");
			return "";
		},
		
		_markDataSourceDirty: function(context) {
			var dataSource = this._getDataSourceFromContext(context);
			changeStatus[dataSource] = true;
			//console.log("_markDataSourceDirty: " + dataSource + " is marked dirty");
		},
		
		_isPageStatusDirty: function(routeName) {
			for(dataSource in changeStatus) {
				if (changeStatus[dataSource]) return true;
			}
			return false;
		},
		
		_resetPageStatus: function() {
			for(item in changeStatus) {
				changeStatus[item] = false;
			}
			for(item in trackValue) {
				delete trackValue[item];
			}
			for(item in _availableDs) {
				delete _availableDs[item];
			}
		},
		
		_setCheckEnable: function(value) {
			checkEnable = value;
		},
		
		_isUnsaveCheckEnable: function() {
			return checkEnable;
		},
		
		_setCustomMessage: function(message) {
			customMessage = message;
		},
		
		_getCustomMessage: function() {
			return customMessage;
		},
		
		_isDeepPathValueChange: function(dataName, value) {
			if (JSON.stringify(value.base) === JSON.stringify(value.value)) {
				// init load
				if (dataName.localeCompare(value.path) == 0) {
					// clone the object
					trackValue[dataName] = JSON.parse(JSON.stringify(value.base));
				}
				return false;
			} else {
				var rootPath = value.path.split('.')[0];
				if (rootPath.localeCompare(dataName)) {
					console.log("error: _trackChange dataName(" + dataName + ") cannot be found in value = " + rootPath);
					return false;
				}
				if (JSON.stringify(trackValue[rootPath]) !== JSON.stringify(value.base)) {
					// clone the object
					trackValue[rootPath] = JSON.parse(JSON.stringify(value.base));
					return true;
				} else {
					return false;
				}
			}		
		},
		
		_notEqualOperator: function(oldValue, newValue, valueType) {
			if (valueType === 'object') 
				return (JSON.stringify(newValue) !== JSON.stringify(oldValue));
			if (valueType === 'string')
				return (newValue.localeCompare(oldValue) !== 0);
			return (newValue !== oldValue);
		},
		
		_copyValue: function(value, valueType) {
			if (valueType === 'object')
				return JSON.parse(JSON.stringify(value));
			if (valueType === 'string')
				return value.toString();
			return value;
		},
		
		_isSinglePathValueChange: function(dataName, value) {
			if (typeof value === 'undefined') {
				// exit page
				delete trackValue[dataName];
				return false;
			}
			if (dataName in trackValue) {
				if (this._notEqualOperator(trackValue[dataName], value, typeof value)) {
					trackValue[dataName] = this._copyValue(value, typeof value);
					return true;
				}
				return false;
			} else {
				// init load
				trackValue[dataName] = this._copyValue(value, typeof value);
				return false;
			}
		},
		
		_isDeepPathValue: function(value) {
			if (value 
				&& (typeof value.base !== 'undefined') 
				&& (typeof value.path !== 'undefined') 
				&& (typeof value.value !== 'undefined')) return true;
			return false;
		},
		
		_isValueChange: function(dataName, value) {
			if (typeof dataName === 'undefined') {
				error.log("error in _trackChange argument");
				return false;
			}
			if (this._isDeepPathValue(value)) {
				return this._isDeepPathValueChange(dataName, value);
			} else {
				return this._isSinglePathValueChange(dataName, value);
			}
		},
		
		/**
          * Called by app
          * useCustomChanges: if true it will use a custom validation 
          * customChanges: if true it means that there're unsaved changes 
          */
		trackChange: function(dataSourceName, dataName, value, useCustomChanges, customChanges) {
			_availableDs[dataSourceName] = true;
			if (this._isUnsaveCheckEnable()) {
				if (useCustomChanges) {
					if(customChanges) {
						this._markDataSourceDirty(dataSourceName);
					} else {
						this._resetPageStatus();
					}
				} else {
					if (this._isValueChange(dataName, value)) {
						this._markDataSourceDirty(dataSourceName);
					}
				}
			}
		},
		
		// called by triplat-ds-container-behavior
		markDataSourceClean: function(context) {
			if (this._isUnsaveCheckEnable()) {
				var dataSource = this._getDataSourceFromContext(context);
				if (dataSource in changeStatus) {
					changeStatus[dataSource] = false;
					//console.log("_markDataSourceClean: " + dataSource + " is marked clean");
				}
			}
		},
		
		// called by triplat-route using javascript built-in confirm method
		// return false when there is unsaved data and user confirm cancel
		unsaveCheck: function() {
			var retValue = true;
			if (this._isUnsaveCheckEnable()) {
				if (this._isPageStatusDirty()) {
					var message = this._getCustomMessage();
					var res = confirm(message);
					if (res) {
						this._resetPageStatus();
					} else {
						retValue = false;
					}
				}
			}
			return retValue;
		},
		
		// return true for using paper-dialog
		// return false for using built-in confirm dialog
		_isDialogPromiseRegister: function() {
			if (_useModernDialog) {
				return true;
			} else {
				return false;
			}
		},
		
		_registerDialogPromise: function(dialogInfo) {
			_useModernDialog= dialogInfo;
		},
		
		/**
          * useCustomDialog: if true it will use a custom dialog, otherwise it will try to use triplat-change-tracker
          * customDialogId: the ID of the custom dialog 
          * Important: if a customDialogId is not set, it will look for a dialog with ID 'alertDialog'. 
          * Also, the confirm and dismiss button must have, respectivelly, the IDs: 'confirm' and 'dismiss' 
          */
		setupDialogPromise: function(node, useCustomDialog, customDialogId) {
			var dialogId = (customDialogId) ? customDialogId : "alertDialog";
			var queryElement = (useCustomDialog) ? node.querySelector("#" + dialogId) : node.querySelector("triplat-change-tracker");
			if (queryElement) {
				var disabled = queryElement.hasAttribute("disabled");
				if (disabled) {
					this._setCheckEnable(false);
				}
				var dialogIdData = {
					'node': node,
					'dialogId': dialogId,
					'dismissButtonId': 'dismiss',
					'confirmButtonId': 'confirm'
				};
				this._registerDialogPromise(dialogIdData);
			} 
		},
		
		getDialogPromise: function() {
			var _dialogPromise = new Promise(function(resolve, reject) {
				var dialogElement = _useModernDialog.node.querySelector("#" + _useModernDialog.dialogId);
				var dismissButton = _useModernDialog.node.querySelector("#" + _useModernDialog.dismissButtonId);
				var confirmButton = _useModernDialog.node.querySelector("#" + _useModernDialog.confirmButtonId);
				var _rejectFunction = function() { 
					reject();
					dismissButton.removeEventListener('tap', _rejectFunction);
				}
				var _resolveFunction = function() {
					resolve();
					confirmButton.removeEventListener('tap', _resolveFunction);
				}
				dismissButton.addEventListener('tap', _rejectFunction);
				confirmButton.addEventListener('tap', _resolveFunction);
				dialogElement.opened = true;
			});
			return _dialogPromise;
		},
		
		// called by TriplatWebContextIdBehavior._endContext
		unsaveCheckBeforeUnload: function() {
			var message = "";
			if (this._isUnsaveCheckEnable()) {
				if (this._isPageStatusDirty()) {
					message = this._getCustomMessage();
				}
			}
			return message;
		},
		
		// api to allow force clean dirty view
		forceClean: function() {
			this._resetPageStatus();
		},
		
		// called by triplat-route-selector to reset dialog promise
		resetDialogPromise: function() {
			this._setCheckEnable(true);
			this._registerDialogPromise(null);
		}
	};
})();

</script><script>
	TriPlatViewBehaviorImpl = {

		properties: {

			modelAndView: {
				type: String,
				notify: false,
				readOnly: false
			},

			instanceId: {
				type: String,
				notify: false,
				readOnly: false
			},

			contextUrl: {
				type: String,
				notify: false,
				readOnly: false
			},
			numberpatternInteger: { 
				type: String, 
				value: "[0-9]*",
				readonly: true 
			},
			numberinvalidmsgInteger: { 
				type: String, 
				value: "Invalid value entered. Expected an integer value.",
				readonly: true 
			},
			numberpatternCurrency: { 
				type: String, 
				value: "[0-9]*\.?[0-9][0-9]|[0-9]",
				readonly: true
			},
			numberinvalidmsgCurrency: { 
				type: String, 
				value: "Invalid value entered. Expect a currency value with either zero or 2 decimals of precision.",
				readonly: true 
			},

			numberpatternFloat: { 
				type: String, 
				value: "[0-9]*\.?[0-9]*",
				readonly: true
			},
			numberinvalidmsgFloat: { 
				type: String, 
				value: "Invalid value entered. Expect a floating point value.",
				readonly: true 
			}

 		},

		view: null,

		ready: function() {
			this.view = Polymer.dom(this.root).querySelector("tri-view");
			if (this.view == null) {
				// console.warn("No tri-view element found");
			}
			this._hideAppLoadingIndicator();
		},

		action: function(e) {
			if (this.view == null) {
				console.warn("Cannot process action as no tri-view element was found on this view.");
				return;
			}

			var targetElement = e.target;
			if (!targetElement) {
				console.warn("No target on action event.");
				return;
			}
			
			var actionElement = null;
			while (targetElement != null) {
				if (targetElement.hasAttribute("data-source-name")
						&& targetElement.hasAttribute("action-group-name")
						&& targetElement.hasAttribute("action-name")) {
					actionElement = targetElement;
					break;	
				}
				
				targetElement = targetElement.parentNode;
			}

			if (actionElement == null) {
				console.warn("No action element found with required attribures (data-source-name, action-group-name, action-name)");
				return;
			}

			var dataSourceName = actionElement.getAttribute("data-source-name");
			var actionGroupName = actionElement.getAttribute("action-group-name");
			var actionName = actionElement.getAttribute("action-name");

			this.view.performAction(dataSourceName, actionGroupName, actionName);
		},

		_getPattern: function(val) {
			var rc = "";
			if (val == "integer") {
				rc = "[0-9]*";
			}
			return rc
		},

		_hideAppLoadingIndicator: function() {
			document.querySelector("#app-loading-indicator").hidden = true;
		}

	};

	TriPlatViewBehavior = [
		TriPlatViewBehaviorImpl,
		Polymer.TriplatWebContextIdBehavior,
		Polymer.TriplatDsContainerBehavior,
		TriPlatChangeTrackerBehavior
	];
</script>

<script>
	/**
	 * `TriBlockNavIronPagesContainerBehavior` propagates the value of the `iron-pages-id` property to all the navigation items.
	 *	
	 *	<div style="background-color:#FFFFCC">
	 *	    <div style="padding:20px;">
	 *	        <b>Note:</b> Implementors of this behavior should override `_getElementsToApplyIronPagesId()` method to return a list of navigation items to apply the value of `iron-pages-id` property.
	 *	    </div>
	 *	</div>
	 * 
	 * @polymerBehavior
	 */
	TriBlockNavIronPagesContainerBehavior = {

	    properties: {
			/**
			 * The ID of the `iron-pages` used by all of the navigation items when switching different views in it.
			 */
			ironPagesId: String
	    },
	
	   	observers: [
			'_handleIronPagesIdChanged(ironPagesId)'
		],
	
		/**
		 * Sets the value of the `iron-pages-id` property of all the navigation items based of the value of the `iron-pages-id` property in this container behavior. 
		 * 
		 * @param {string} ironPagesId The id of the `iron-pages` to set to. 
		 */
		_handleIronPagesIdChanged: function(ironPagesId) {
			var children = this._getElementsToApplyIronPagesId(); 
			children.forEach(function(child){
				child.ironPagesId = ironPagesId;
			});
		},
		
		/**
		 * Returns the navigation items to apply the default value of the `iron-pages-id` property. </br>
		 * 
		 *	<div style="background-color:#FFFFCC">
		 *	    <div style="padding:20px;">
		 *	        <b>Note:</b> Implementors of this behavior should override this method to return a list of navigation items to apply the value of `iron-pages-id` property.
		 *	    </div>
		 *	</div>
		 * 
		 * @return {Array<HTMLElement>} 
		 */
		_getElementsToApplyIronPagesId: function() {
			console.error("_getElementsToApplyIronPagesId method should be implemented.  The method is expected to return an array of elements that has ironPagesId attribute and which value of this.ironPagesId attribute be set to.");
		}

	};
</script>

<dom-module id="paper-toolbar" assetpath="../paper-toolbar/">
  <template>
    <style>
      :host {
        --calculated-paper-toolbar-height: var(--paper-toolbar-height, 64px);
        --calculated-paper-toolbar-sm-height: var(--paper-toolbar-sm-height, 56px);

        /* technical */
        display: block;
        position: relative;
        box-sizing: border-box;
        -moz-box-sizing: border-box;

        /* size */
        height: var(--calculated-paper-toolbar-height);

        background: var(--paper-toolbar-background, --primary-color);
        color: var(--paper-toolbar-color, --dark-theme-text-color);

        @apply(--paper-toolbar);
      }

      :host(.animate) {
        /* transition */
        transition: var(--paper-toolbar-transition, height 0.18s ease-in);
      }

      :host(.medium-tall) {
        height: calc(var(--calculated-paper-toolbar-height) * 2);
        @apply(--paper-toolbar-medium);
      }

      :host(.tall) {
        height: calc(var(--calculated-paper-toolbar-height) * 3);
        @apply(--paper-toolbar-tall);
      }

      .toolbar-tools {
        position: relative;
        height: var(--calculated-paper-toolbar-height);
        padding: 0 16px;
        pointer-events: none;
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--paper-toolbar-content);
      }

      /*
       * TODO: Where should media query breakpoints live so they can be shared between elements?
       */

      @media (max-width: 600px) {
        :host {
          height: var(--calculated-paper-toolbar-sm-height);
        }

        :host(.medium-tall) {
          height: calc(var(--calculated-paper-toolbar-sm-height) * 2);
        }

        :host(.tall) {
          height: calc(var(--calculated-paper-toolbar-sm-height) * 3);
        }

        .toolbar-tools {
          height: var(--calculated-paper-toolbar-sm-height);
        }
      }

      #topBar {
        position: relative;
      }

      /* middle bar */
      #middleBar {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
      }

      :host(.tall) #middleBar,
      :host(.medium-tall) #middleBar {
        -webkit-transform: translateY(100%);
        transform: translateY(100%);
      }

      /* bottom bar */
      #bottomBar {
        position: absolute;
        right: 0;
        bottom: 0;
        left: 0;
      }

      /*
       * make elements (e.g. buttons) respond to mouse/touch events
       *
       * `.toolbar-tools` disables touch events so multiple toolbars can stack and not
       * absorb events. All children must have pointer events re-enabled to work as
       * expected.
       */
      .toolbar-tools > ::content > *:not([disabled]) {
        pointer-events: auto;
      }

      .toolbar-tools > ::content .title {
        @apply(--paper-font-common-base);

        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 20px;
        font-weight: 400;
        line-height: 1;
        pointer-events: none;

        @apply(--layout-flex);
      }

      .toolbar-tools > ::content > .title {
        margin-left: 56px;
      }

      .toolbar-tools > ::content > paper-icon-button + .title {
        margin-left: 0;
      }

      /**
       * The --paper-toolbar-title mixin is applied here instead of above to
       * fix the issue with margin-left being ignored due to css ordering.
       */
      .toolbar-tools > ::content .title {
        @apply(--paper-toolbar-title);
      }

      .toolbar-tools > ::content paper-icon-button[icon=menu] {
        margin-right: 24px;
      }

      .toolbar-tools > ::content > .fit {
        position: absolute;
        top: auto;
        right: 0;
        bottom: 0;
        left: 0;
        width: auto;
        margin: 0;
      }

      /* TODO(noms): Until we have a better solution for classes that don't use
       * /deep/ create our own.
       */
      .start-justified {
        @apply(--layout-start-justified);
      }

      .center-justified {
        @apply(--layout-center-justified);
      }

      .end-justified {
        @apply(--layout-end-justified);
      }

      .around-justified {
        @apply(--layout-around-justified);
      }

      .justified {
        @apply(--layout-justified);
      }
    </style>

    <div id="topBar" class$="toolbar-tools [[_computeBarExtraClasses(justify)]]">
      <content select=":not(.middle):not(.bottom)"></content>
    </div>

    <div id="middleBar" class$="toolbar-tools [[_computeBarExtraClasses(middleJustify)]]">
      <content select=".middle"></content>
    </div>

    <div id="bottomBar" class$="toolbar-tools [[_computeBarExtraClasses(bottomJustify)]]">
      <content select=".bottom"></content>
    </div>
  </template>

  <script>
    Polymer({
      is: 'paper-toolbar',

      hostAttributes: {
        'role': 'toolbar'
      },

      properties: {
        /**
         * Controls how the items are aligned horizontally when they are placed
         * at the bottom.
         * Options are `start`, `center`, `end`, `justified` and `around`.
         */
        bottomJustify: {
          type: String,
          value: ''
        },

        /**
         * Controls how the items are aligned horizontally.
         * Options are `start`, `center`, `end`, `justified` and `around`.
         */
        justify: {
          type: String,
          value: ''
        },

        /**
         * Controls how the items are aligned horizontally when they are placed
         * in the middle.
         * Options are `start`, `center`, `end`, `justified` and `around`.
         */
        middleJustify: {
          type: String,
          value: ''
        }

      },

      attached: function() {
        this._observer = this._observe(this);
        this._updateAriaLabelledBy();
      },

      detached: function() {
        if (this._observer) {
          this._observer.disconnect();
        }
      },

      _observe: function(node) {
        var observer = new MutationObserver(function() {
          this._updateAriaLabelledBy();
        }.bind(this));
        observer.observe(node, {
          childList: true,
          subtree: true
        });
        return observer;
      },

      _updateAriaLabelledBy: function() {
        var labelledBy = [];
        var contents = Polymer.dom(this.root).querySelectorAll('content');
        for (var content, index = 0; content = contents[index]; index++) {
          var nodes = Polymer.dom(content).getDistributedNodes();
          for (var node, jndex = 0; node = nodes[jndex]; jndex++) {
            if (node.classList && node.classList.contains('title')) {
              if (node.id) {
                labelledBy.push(node.id);
              } else {
                var id = 'paper-toolbar-label-' + Math.floor(Math.random() * 10000);
                node.id = id;
                labelledBy.push(id);
              }
            }
          }
        }
        if (labelledBy.length > 0) {
          this.setAttribute('aria-labelledby', labelledBy.join(' '));
        }
      },

      _computeBarExtraClasses: function(barJustify) {
        if (!barJustify) return '';

        return barJustify + (barJustify === 'justified' ? '' : '-justified');
      }
    });
  </script>
</dom-module>




<script>

  Polymer({

    is: 'iron-media-query',

    properties: {

      /**
       * The Boolean return value of the media query.
       */
      queryMatches: {
        type: Boolean,
        value: false,
        readOnly: true,
        notify: true
      },

      /**
       * The CSS media query to evaluate.
       */
      query: {
        type: String,
        observer: 'queryChanged'
      },

      /**
       * If true, the query attribute is assumed to be a complete media query
       * string rather than a single media feature.
       */
      full: {
        type: Boolean,
        value: false
      },

      /**
       * @type {function(MediaQueryList)}
       */
      _boundMQHandler: {
        value: function() {
          return this.queryHandler.bind(this);
        }
      },

      /**
       * @type {MediaQueryList}
       */
      _mq: {
        value: null
      }
    },

    attached: function() {
      this.style.display = 'none';
      this.queryChanged();
    },

    detached: function() {
      this._remove();
    },

    _add: function() {
      if (this._mq) {
        this._mq.addListener(this._boundMQHandler);
      }
    },

    _remove: function() {
      if (this._mq) {
        this._mq.removeListener(this._boundMQHandler);
      }
      this._mq = null;
    },

    queryChanged: function() {
      this._remove();
      var query = this.query;
      if (!query) {
        return;
      }
      if (!this.full && query[0] !== '(') {
        query = '(' + query + ')';
      }
      this._mq = window.matchMedia(query);
      this._add();
      this.queryHandler(this._mq);
    },

    queryHandler: function(mq) {
      this._setQueryMatches(mq.matches);
    }

  });

</script><script>

  /**
   * @param {!Function} selectCallback
   * @constructor
   */
  Polymer.IronSelection = function(selectCallback) {
    this.selection = [];
    this.selectCallback = selectCallback;
  };

  Polymer.IronSelection.prototype = {

    /**
     * Retrieves the selected item(s).
     *
     * @method get
     * @returns Returns the selected item(s). If the multi property is true,
     * `get` will return an array, otherwise it will return
     * the selected item or undefined if there is no selection.
     */
    get: function() {
      return this.multi ? this.selection.slice() : this.selection[0];
    },

    /**
     * Clears all the selection except the ones indicated.
     *
     * @method clear
     * @param {Array} excludes items to be excluded.
     */
    clear: function(excludes) {
      this.selection.slice().forEach(function(item) {
        if (!excludes || excludes.indexOf(item) < 0) {
          this.setItemSelected(item, false);
        }
      }, this);
    },

    /**
     * Indicates if a given item is selected.
     *
     * @method isSelected
     * @param {*} item The item whose selection state should be checked.
     * @returns Returns true if `item` is selected.
     */
    isSelected: function(item) {
      return this.selection.indexOf(item) >= 0;
    },

    /**
     * Sets the selection state for a given item to either selected or deselected.
     *
     * @method setItemSelected
     * @param {*} item The item to select.
     * @param {boolean} isSelected True for selected, false for deselected.
     */
    setItemSelected: function(item, isSelected) {
      if (item != null) {
        if (isSelected !== this.isSelected(item)) {
          // proceed to update selection only if requested state differs from current
          if (isSelected) {
            this.selection.push(item);
          } else {
            var i = this.selection.indexOf(item);
            if (i >= 0) {
              this.selection.splice(i, 1);
            }
          }
          if (this.selectCallback) {
            this.selectCallback(item, isSelected);
          }
        }
      }
    },

    /**
     * Sets the selection state for a given item. If the `multi` property
     * is true, then the selected state of `item` will be toggled; otherwise
     * the `item` will be selected.
     *
     * @method select
     * @param {*} item The item to select.
     */
    select: function(item) {
      if (this.multi) {
        this.toggle(item);
      } else if (this.get() !== item) {
        this.setItemSelected(this.get(), false);
        this.setItemSelected(item, true);
      }
    },

    /**
     * Toggles the selection state for `item`.
     *
     * @method toggle
     * @param {*} item The item to toggle.
     */
    toggle: function(item) {
      this.setItemSelected(item, !this.isSelected(item));
    }

  };

</script><script>

  /** @polymerBehavior */
  Polymer.IronSelectableBehavior = {

      /**
       * Fired when iron-selector is activated (selected or deselected).
       * It is fired before the selected items are changed.
       * Cancel the event to abort selection.
       *
       * @event iron-activate
       */

      /**
       * Fired when an item is selected
       *
       * @event iron-select
       */

      /**
       * Fired when an item is deselected
       *
       * @event iron-deselect
       */

      /**
       * Fired when the list of selectable items changes (e.g., items are
       * added or removed). The detail of the event is a mutation record that
       * describes what changed.
       *
       * @event iron-items-changed
       */

    properties: {

      /**
       * If you want to use an attribute value or property of an element for
       * `selected` instead of the index, set this to the name of the attribute
       * or property. Hyphenated values are converted to camel case when used to
       * look up the property of a selectable element. Camel cased values are
       * *not* converted to hyphenated values for attribute lookup. It's
       * recommended that you provide the hyphenated form of the name so that
       * selection works in both cases. (Use `attr-or-property-name` instead of
       * `attrOrPropertyName`.)
       */
      attrForSelected: {
        type: String,
        value: null
      },

      /**
       * Gets or sets the selected element. The default is to use the index of the item.
       * @type {string|number}
       */
      selected: {
        type: String,
        notify: true
      },

      /**
       * Returns the currently selected item.
       *
       * @type {?Object}
       */
      selectedItem: {
        type: Object,
        readOnly: true,
        notify: true
      },

      /**
       * The event that fires from items when they are selected. Selectable
       * will listen for this event from items and update the selection state.
       * Set to empty string to listen to no events.
       */
      activateEvent: {
        type: String,
        value: 'tap',
        observer: '_activateEventChanged'
      },

      /**
       * This is a CSS selector string.  If this is set, only items that match the CSS selector
       * are selectable.
       */
      selectable: String,

      /**
       * The class to set on elements when selected.
       */
      selectedClass: {
        type: String,
        value: 'iron-selected'
      },

      /**
       * The attribute to set on elements when selected.
       */
      selectedAttribute: {
        type: String,
        value: null
      },

      /**
       * Default fallback if the selection based on selected with `attrForSelected`
       * is not found.
       */
      fallbackSelection: {
        type: String,
        value: null
      },

      /**
       * The list of items from which a selection can be made.
       */
      items: {
        type: Array,
        readOnly: true,
        notify: true,
        value: function() {
          return [];
        }
      },

      /**
       * The set of excluded elements where the key is the `localName`
       * of the element that will be ignored from the item list.
       *
       * @default {template: 1}
       */
      _excludedLocalNames: {
        type: Object,
        value: function() {
          return {
            'template': 1
          };
        }
      }
    },

    observers: [
      '_updateAttrForSelected(attrForSelected)',
      '_updateSelected(selected)',
      '_checkFallback(fallbackSelection)'
    ],

    created: function() {
      this._bindFilterItem = this._filterItem.bind(this);
      this._selection = new Polymer.IronSelection(this._applySelection.bind(this));
    },

    attached: function() {
      this._observer = this._observeItems(this);
      this._updateItems();
      if (!this._shouldUpdateSelection) {
        this._updateSelected();
      }
      this._addListener(this.activateEvent);
    },

    detached: function() {
      if (this._observer) {
        Polymer.dom(this).unobserveNodes(this._observer);
      }
      this._removeListener(this.activateEvent);
    },

    /**
     * Returns the index of the given item.
     *
     * @method indexOf
     * @param {Object} item
     * @returns Returns the index of the item
     */
    indexOf: function(item) {
      return this.items.indexOf(item);
    },

    /**
     * Selects the given value.
     *
     * @method select
     * @param {string|number} value the value to select.
     */
    select: function(value) {
      this.selected = value;
    },

    /**
     * Selects the previous item.
     *
     * @method selectPrevious
     */
    selectPrevious: function() {
      var length = this.items.length;
      var index = (Number(this._valueToIndex(this.selected)) - 1 + length) % length;
      this.selected = this._indexToValue(index);
    },

    /**
     * Selects the next item.
     *
     * @method selectNext
     */
    selectNext: function() {
      var index = (Number(this._valueToIndex(this.selected)) + 1) % this.items.length;
      this.selected = this._indexToValue(index);
    },

    /**
     * Selects the item at the given index.
     *
     * @method selectIndex
     */
    selectIndex: function(index) {
      this.select(this._indexToValue(index));
    },

    /**
     * Force a synchronous update of the `items` property.
     *
     * NOTE: Consider listening for the `iron-items-changed` event to respond to
     * updates to the set of selectable items after updates to the DOM list and
     * selection state have been made.
     *
     * WARNING: If you are using this method, you should probably consider an
     * alternate approach. Synchronously querying for items is potentially
     * slow for many use cases. The `items` property will update asynchronously
     * on its own to reflect selectable items in the DOM.
     */
    forceSynchronousItemUpdate: function() {
      this._updateItems();
    },

    get _shouldUpdateSelection() {
      return this.selected != null;
    },

    _checkFallback: function() {
      if (this._shouldUpdateSelection) {
        this._updateSelected();
      }
    },

    _addListener: function(eventName) {
      this.listen(this, eventName, '_activateHandler');
    },

    _removeListener: function(eventName) {
      this.unlisten(this, eventName, '_activateHandler');
    },

    _activateEventChanged: function(eventName, old) {
      this._removeListener(old);
      this._addListener(eventName);
    },

    _updateItems: function() {
      var nodes = Polymer.dom(this).queryDistributedElements(this.selectable || '*');
      nodes = Array.prototype.filter.call(nodes, this._bindFilterItem);
      this._setItems(nodes);
    },

    _updateAttrForSelected: function() {
      if (this._shouldUpdateSelection) {
        this.selected = this._indexToValue(this.indexOf(this.selectedItem));
      }
    },

    _updateSelected: function() {
      this._selectSelected(this.selected);
    },

    _selectSelected: function(selected) {
      this._selection.select(this._valueToItem(this.selected));
      // Check for items, since this array is populated only when attached
      // Since Number(0) is falsy, explicitly check for undefined
      if (this.fallbackSelection && this.items.length && (this._selection.get() === undefined)) {
        this.selected = this.fallbackSelection;
      }
    },

    _filterItem: function(node) {
      return !this._excludedLocalNames[node.localName];
    },

    _valueToItem: function(value) {
      return (value == null) ? null : this.items[this._valueToIndex(value)];
    },

    _valueToIndex: function(value) {
      if (this.attrForSelected) {
        for (var i = 0, item; item = this.items[i]; i++) {
          if (this._valueForItem(item) == value) {
            return i;
          }
        }
      } else {
        return Number(value);
      }
    },

    _indexToValue: function(index) {
      if (this.attrForSelected) {
        var item = this.items[index];
        if (item) {
          return this._valueForItem(item);
        }
      } else {
        return index;
      }
    },

    _valueForItem: function(item) {
      var propValue = item[Polymer.CaseMap.dashToCamelCase(this.attrForSelected)];
      return propValue != undefined ? propValue : item.getAttribute(this.attrForSelected);
    },

    _applySelection: function(item, isSelected) {
      if (this.selectedClass) {
        this.toggleClass(this.selectedClass, isSelected, item);
      }
      if (this.selectedAttribute) {
        this.toggleAttribute(this.selectedAttribute, isSelected, item);
      }
      this._selectionChange();
      this.fire('iron-' + (isSelected ? 'select' : 'deselect'), {item: item});
    },

    _selectionChange: function() {
      this._setSelectedItem(this._selection.get());
    },

    // observe items change under the given node.
    _observeItems: function(node) {
      return Polymer.dom(node).observeNodes(function(mutation) {
        this._updateItems();

        if (this._shouldUpdateSelection) {
          this._updateSelected();
        }

        // Let other interested parties know about the change so that
        // we don't have to recreate mutation observers everywhere.
        this.fire('iron-items-changed', mutation, {
          bubbles: false,
          cancelable: false
        });
      });
    },

    _activateHandler: function(e) {
      var t = e.target;
      var items = this.items;
      while (t && t != this) {
        var i = items.indexOf(t);
        if (i >= 0) {
          var value = this._indexToValue(i);
          this._itemActivate(value, t);
          return;
        }
        t = t.parentNode;
      }
    },

    _itemActivate: function(value, item) {
      if (!this.fire('iron-activate',
          {selected: value, item: item}, {cancelable: true}).defaultPrevented) {
        this.select(value);
      }
    }

  };

</script><script>
  /** @polymerBehavior Polymer.IronMultiSelectableBehavior */
  Polymer.IronMultiSelectableBehaviorImpl = {
    properties: {

      /**
       * If true, multiple selections are allowed.
       */
      multi: {
        type: Boolean,
        value: false,
        observer: 'multiChanged'
      },

      /**
       * Gets or sets the selected elements. This is used instead of `selected` when `multi`
       * is true.
       */
      selectedValues: {
        type: Array,
        notify: true
      },

      /**
       * Returns an array of currently selected items.
       */
      selectedItems: {
        type: Array,
        readOnly: true,
        notify: true
      },

    },

    observers: [
      '_updateSelected(selectedValues.splices)'
    ],

    /**
     * Selects the given value. If the `multi` property is true, then the selected state of the
     * `value` will be toggled; otherwise the `value` will be selected.
     *
     * @method select
     * @param {string|number} value the value to select.
     */
    select: function(value) {
      if (this.multi) {
        if (this.selectedValues) {
          this._toggleSelected(value);
        } else {
          this.selectedValues = [value];
        }
      } else {
        this.selected = value;
      }
    },

    multiChanged: function(multi) {
      this._selection.multi = multi;
    },

    get _shouldUpdateSelection() {
      return this.selected != null ||
        (this.selectedValues != null && this.selectedValues.length);
    },

    _updateAttrForSelected: function() {
      if (!this.multi) {
        Polymer.IronSelectableBehavior._updateAttrForSelected.apply(this);
      } else if (this._shouldUpdateSelection) {
        this.selectedValues = this.selectedItems.map(function(selectedItem) {
          return this._indexToValue(this.indexOf(selectedItem));
        }, this).filter(function(unfilteredValue) {
          return unfilteredValue != null;
        }, this);
      }
    },

    _updateSelected: function() {
      if (this.multi) {
        this._selectMulti(this.selectedValues);
      } else {
        this._selectSelected(this.selected);
      }
    },

    _selectMulti: function(values) {
      if (values) {
        var selectedItems = this._valuesToItems(values);
        // clear all but the current selected items
        this._selection.clear(selectedItems);
        // select only those not selected yet
        for (var i = 0; i < selectedItems.length; i++) {
          this._selection.setItemSelected(selectedItems[i], true);
        }
        // Check for items, since this array is populated only when attached
        if (this.fallbackSelection && this.items.length && !this._selection.get().length) {
          var fallback = this._valueToItem(this.fallbackSelection);
          if (fallback) {
            this.selectedValues = [this.fallbackSelection];
          }
        }
      } else {
        this._selection.clear();
      }
    },

    _selectionChange: function() {
      var s = this._selection.get();
      if (this.multi) {
        this._setSelectedItems(s);
      } else {
        this._setSelectedItems([s]);
        this._setSelectedItem(s);
      }
    },

    _toggleSelected: function(value) {
      var i = this.selectedValues.indexOf(value);
      var unselected = i < 0;
      if (unselected) {
        this.push('selectedValues',value);
      } else {
        this.splice('selectedValues',i,1);
      }
    },

    _valuesToItems: function(values) {
      return (values == null) ? null : values.map(function(value) {
        return this._valueToItem(value);
      }, this);
    }
  };

  /** @polymerBehavior */
  Polymer.IronMultiSelectableBehavior = [
    Polymer.IronSelectableBehavior,
    Polymer.IronMultiSelectableBehaviorImpl
  ];

</script><script>
  /**
  `iron-selector` is an element which can be used to manage a list of elements
  that can be selected.  Tapping on the item will make the item selected.  The `selected` indicates
  which item is being selected.  The default is to use the index of the item.

  Example:

      <iron-selector selected="0">
        <div>Item 1</div>
        <div>Item 2</div>
        <div>Item 3</div>
      </iron-selector>

  If you want to use the attribute value of an element for `selected` instead of the index,
  set `attrForSelected` to the name of the attribute.  For example, if you want to select item by
  `name`, set `attrForSelected` to `name`.

  Example:

      <iron-selector attr-for-selected="name" selected="foo">
        <div name="foo">Foo</div>
        <div name="bar">Bar</div>
        <div name="zot">Zot</div>
      </iron-selector>

  You can specify a default fallback with `fallbackSelection` in case the `selected` attribute does
  not match the `attrForSelected` attribute of any elements.

  Example:

        <iron-selector attr-for-selected="name" selected="non-existing"
                       fallback-selection="default">
          <div name="foo">Foo</div>
          <div name="bar">Bar</div>
          <div name="default">Default</div>
        </iron-selector>

  Note: When the selector is multi, the selection will set to `fallbackSelection` iff
  the number of matching elements is zero.

  `iron-selector` is not styled. Use the `iron-selected` CSS class to style the selected element.

  Example:

      <style>
        .iron-selected {
          background: #eee;
        }
      </style>

      ...

      <iron-selector selected="0">
        <div>Item 1</div>
        <div>Item 2</div>
        <div>Item 3</div>
      </iron-selector>

  @demo demo/index.html
  */

  Polymer({

    is: 'iron-selector',

    behaviors: [
      Polymer.IronMultiSelectableBehavior
    ]

  });

</script><dom-module id="paper-drawer-panel" assetpath="../paper-drawer-panel/">
  <template>
    <style>
      :host {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      iron-selector > #drawer {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        background-color: white;

        -moz-box-sizing: border-box;
        box-sizing: border-box;

        @apply(--paper-drawer-panel-drawer-container);
      }

      .transition > #drawer {
        transition: -webkit-transform ease-in-out 0.3s, width ease-in-out 0.3s, visibility 0.3s;
        transition: transform ease-in-out 0.3s, width ease-in-out 0.3s, visibility 0.3s;
      }

      .left-drawer > #drawer {
        @apply(--paper-drawer-panel-left-drawer-container);
      }

      .right-drawer > #drawer {
        left: auto;
        right: 0;

        @apply(--paper-drawer-panel-right-drawer-container);
      }

      iron-selector > #main {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;

        @apply(--paper-drawer-panel-main-container);
      }

      .transition > #main {
        transition: left ease-in-out 0.3s, padding ease-in-out 0.3s;
      }

      .right-drawer > #main {
        left: 0;
      }

      .right-drawer.transition > #main {
        transition: right ease-in-out 0.3s, padding ease-in-out 0.3s;
      }

      #main > ::content > [main] {
        height: 100%;
      }

      #drawer > ::content > [drawer] {
        height: 100%;
      }

      #scrim {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        visibility: hidden;
        opacity: 0;
        transition: opacity ease-in-out 0.38s, visibility ease-in-out 0.38s;
        background-color: rgba(0, 0, 0, 0.3);

        @apply(--paper-drawer-panel-scrim);
      }

      .narrow-layout > #drawer {
        will-change: transform;
      }

      .narrow-layout > #drawer.iron-selected {
        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.15);
      }

      .right-drawer.narrow-layout > #drawer.iron-selected {
        box-shadow: -2px 2px 4px rgba(0, 0, 0, 0.15);
      }

      .narrow-layout > #drawer > ::content > [drawer] {
        border: 0;
      }

      .left-drawer.narrow-layout > #drawer:not(.iron-selected) {
        visibility: hidden;

        -webkit-transform: translateX(-100%);
        transform: translateX(-100%);
      }

      .right-drawer.narrow-layout > #drawer:not(.iron-selected) {
        left: auto;
        visibility: hidden;

        -webkit-transform: translateX(100%);
        transform: translateX(100%);
      }

      .left-drawer.dragging > #drawer:not(.iron-selected),
      .left-drawer.peeking > #drawer:not(.iron-selected),
      .right-drawer.dragging > #drawer:not(.iron-selected),
      .right-drawer.peeking > #drawer:not(.iron-selected) {
        visibility: visible;
      }

      .narrow-layout > #main {
        padding: 0;
      }

      .right-drawer.narrow-layout > #main {
        left: 0;
        right: 0;
      }

      .narrow-layout > #main:not(.iron-selected) > #scrim,
      .dragging > #main > #scrim {
        visibility: visible;
        opacity: var(--paper-drawer-panel-scrim-opacity, 1);
      }

      .narrow-layout > #main > * {
        margin: 0;
        min-height: 100%;
        left: 0;
        right: 0;

        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }

      iron-selector:not(.narrow-layout) ::content [paper-drawer-toggle] {
        display: none;
      }
    </style>

    <iron-media-query id="mq" on-query-matches-changed="_onQueryMatchesChanged" query="[[_computeMediaQuery(forceNarrow, responsiveWidth)]]">
    </iron-media-query>

    <iron-selector attr-for-selected="id" class$="[[_computeIronSelectorClass(narrow, _transition, dragging, rightDrawer, peeking)]]" activate-event="" selected="[[selected]]">

      <div id="main" style$="[[_computeMainStyle(narrow, rightDrawer, drawerWidth)]]">
        <content select="[main]"></content>
        <div id="scrim" on-tap="closeDrawer"></div>
      </div>

      <div id="drawer" style$="[[_computeDrawerStyle(drawerWidth)]]">
        <content id="drawerContent" select="[drawer]"></content>
      </div>

    </iron-selector>
  </template>

  <script>
    (function() {
      'use strict';

      // this would be the only `paper-drawer-panel` in
      // the whole app that can be in `dragging` state
      var sharedPanel = null;

      function classNames(obj) {
        var classes = [];
        for (var key in obj) {
          if (obj.hasOwnProperty(key) && obj[key]) {
            classes.push(key);
          }
        }

        return classes.join(' ');
      }

      Polymer({

        is: 'paper-drawer-panel',

        behaviors: [Polymer.IronResizableBehavior],

        /**
         * Fired when the narrow layout changes.
         *
         * @event paper-responsive-change {{narrow: boolean}} detail -
         *     narrow: true if the panel is in narrow layout.
         */

        /**
         * Fired when the a panel is selected.
         *
         * Listening for this event is an alternative to observing changes in the `selected` attribute.
         * This event is fired both when a panel is selected.
         *
         * @event iron-select {{item: Object}} detail -
         *     item: The panel that the event refers to.
         */

        /**
         * Fired when a panel is deselected.
         *
         * Listening for this event is an alternative to observing changes in the `selected` attribute.
         * This event is fired both when a panel is deselected.
         *
         * @event iron-deselect {{item: Object}} detail -
         *     item: The panel that the event refers to.
         */
        properties: {

          /**
           * The panel to be selected when `paper-drawer-panel` changes to narrow
           * layout.
           */
          defaultSelected: {
            type: String,
            value: 'main'
          },

          /**
           * If true, swipe from the edge is disabled.
           */
          disableEdgeSwipe: {
            type: Boolean,
            value: false
          },

          /**
           * If true, swipe to open/close the drawer is disabled.
           */
          disableSwipe: {
            type: Boolean,
            value: false
          },

          /**
           * Whether the user is dragging the drawer interactively.
           */
          dragging: {
            type: Boolean,
            value: false,
            readOnly: true,
            notify: true
          },

          /**
           * Width of the drawer panel.
           */
          drawerWidth: {
            type: String,
            value: '256px'
          },

          /**
           * How many pixels on the side of the screen are sensitive to edge
           * swipes and peek.
           */
          edgeSwipeSensitivity: {
            type: Number,
            value: 30
          },

          /**
           * If true, ignore `responsiveWidth` setting and force the narrow layout.
           */
          forceNarrow: {
            type: Boolean,
            value: false
          },

          /**
           * Whether the browser has support for the transform CSS property.
           */
          hasTransform: {
            type: Boolean,
            value: function() {
              return 'transform' in this.style;
            }
          },

          /**
           * Whether the browser has support for the will-change CSS property.
           */
          hasWillChange: {
            type: Boolean,
            value: function() {
              return 'willChange' in this.style;
            }
          },

          /**
           * Returns true if the panel is in narrow layout.  This is useful if you
           * need to show/hide elements based on the layout.
           */
          narrow: {
            reflectToAttribute: true,
            type: Boolean,
            value: false,
            readOnly: true,
            notify: true
          },

          /**
           * Whether the drawer is peeking out from the edge.
           */
          peeking: {
            type: Boolean,
            value: false,
            readOnly: true,
            notify: true
          },

          /**
           * Max-width when the panel changes to narrow layout.
           */
          responsiveWidth: {
            type: String,
            value: '768px'
          },

          /**
           * If true, position the drawer to the right.
           */
          rightDrawer: {
            type: Boolean,
            value: false
          },

          /**
           * The panel that is being selected. `drawer` for the drawer panel and
           * `main` for the main panel.
           *
           * @type {string|null}
           */
          selected: {
            reflectToAttribute: true,
            notify: true,
            type: String,
            value: null
          },

          /**
           * The attribute on elements that should toggle the drawer on tap, also elements will
           * automatically be hidden in wide layout.
           */
          drawerToggleAttribute: {
            type: String,
            value: 'paper-drawer-toggle'
          },

          /**
           * The CSS selector for the element that should receive focus when the drawer is open.
           * By default, when the drawer opens, it focuses the first tabbable element. That is,
           * the first element that can receive focus.
           *
           * To disable this behavior, you can set `drawerFocusSelector` to `null` or an empty string.
           *
           */
          drawerFocusSelector: {
            type: String,
            value:
                'a[href]:not([tabindex="-1"]),'+
                'area[href]:not([tabindex="-1"]),'+
                'input:not([disabled]):not([tabindex="-1"]),'+
                'select:not([disabled]):not([tabindex="-1"]),'+
                'textarea:not([disabled]):not([tabindex="-1"]),'+
                'button:not([disabled]):not([tabindex="-1"]),'+
                'iframe:not([tabindex="-1"]),'+
                '[tabindex]:not([tabindex="-1"]),'+
                '[contentEditable=true]:not([tabindex="-1"])'
          },

          /**
           * Whether the transition is enabled.
           */
          _transition: {
            type: Boolean,
            value: false
          },

        },

        listeners: {
          tap: '_onTap',
          track: '_onTrack',
          down: '_downHandler',
          up: '_upHandler',
          transitionend: '_onTransitionEnd'
        },

        observers: [
          '_forceNarrowChanged(forceNarrow, defaultSelected)',
          '_toggleFocusListener(selected)'
        ],

        ready: function() {
          // Avoid transition at the beginning e.g. page loads and enable
          // transitions only after the element is rendered and ready.
          this._transition = true;
          this._boundFocusListener = this._didFocus.bind(this);
        },

        /**
         * Toggles the panel open and closed.
         *
         * @method togglePanel
         */
        togglePanel: function() {
          if (this._isMainSelected()) {
            this.openDrawer();
          } else {
            this.closeDrawer();
          }
        },

        /**
         * Opens the drawer.
         *
         * @method openDrawer
         */
        openDrawer: function() {
          this.selected = 'drawer';
        },

        /**
         * Closes the drawer.
         *
         * @method closeDrawer
         */
        closeDrawer: function() {
          this.selected = 'main';
        },

        _onTransitionEnd: function (e) {
          var target = Polymer.dom(e).localTarget;
          if (target !== this) {
            // ignore events coming from the light dom
            return;
          }
          if (e.propertyName === 'left' || e.propertyName === 'right') {
            this.notifyResize();
          }
          if (e.propertyName === 'transform' && this.selected === 'drawer') {
            var focusedChild = this._getAutoFocusedNode();
            focusedChild && focusedChild.focus();
          }
        },

        _computeIronSelectorClass: function(narrow, transition, dragging, rightDrawer, peeking) {
          return classNames({
            dragging: dragging,
            'narrow-layout': narrow,
            'right-drawer': rightDrawer,
            'left-drawer': !rightDrawer,
            transition: transition,
            peeking: peeking
          });
        },

        _computeDrawerStyle: function(drawerWidth) {
          return 'width:' + drawerWidth + ';';
        },

        _computeMainStyle: function(narrow, rightDrawer, drawerWidth) {
          var style = '';

          style += 'left:' + ((narrow || rightDrawer) ? '0' : drawerWidth) + ';';

          if (rightDrawer) {
            style += 'right:' + (narrow ? '' : drawerWidth) + ';';
          }

          return style;
        },

        _computeMediaQuery: function(forceNarrow, responsiveWidth) {
          return forceNarrow ? '' : '(max-width: ' + responsiveWidth + ')';
        },

        _computeSwipeOverlayHidden: function(narrow, disableEdgeSwipe) {
          return !narrow || disableEdgeSwipe;
        },

        _onTrack: function(event) {
          if (sharedPanel && this !== sharedPanel) {
            return;
          }
          switch (event.detail.state) {
            case 'start':
              this._trackStart(event);
              break;
            case 'track':
              this._trackX(event);
              break;
            case 'end':
              this._trackEnd(event);
              break;
          }
        },

        _responsiveChange: function(narrow) {
          this._setNarrow(narrow);

          this.selected = this.narrow ? this.defaultSelected : null;

          this.setScrollDirection(this._swipeAllowed() ? 'y' : 'all');
          this.fire('paper-responsive-change', {narrow: this.narrow});
        },

        _onQueryMatchesChanged: function(event) {
          this._responsiveChange(event.detail.value);
        },

        _forceNarrowChanged: function() {
          // set the narrow mode only if we reached the `responsiveWidth`
          this._responsiveChange(this.forceNarrow || this.$.mq.queryMatches);
        },

        _swipeAllowed: function() {
          return this.narrow && !this.disableSwipe;
        },

        _isMainSelected: function() {
          return this.selected === 'main';
        },

        _startEdgePeek: function() {
          this.width = this.$.drawer.offsetWidth;
          this._moveDrawer(this._translateXForDeltaX(this.rightDrawer ?
              -this.edgeSwipeSensitivity : this.edgeSwipeSensitivity));
          this._setPeeking(true);
        },

        _stopEdgePeek: function() {
          if (this.peeking) {
            this._setPeeking(false);
            this._moveDrawer(null);
          }
        },

        _downHandler: function(event) {
          if (!this.dragging && this._isMainSelected() && this._isEdgeTouch(event) && !sharedPanel) {
            this._startEdgePeek();
            // cancel selection
            event.preventDefault();
            // grab this panel
            sharedPanel = this;
          }
        },

        _upHandler: function() {
          this._stopEdgePeek();
          // release the panel
          sharedPanel = null;
        },

        _onTap: function(event) {
          var targetElement = Polymer.dom(event).localTarget;
          var isTargetToggleElement = targetElement &&
            this.drawerToggleAttribute &&
            targetElement.hasAttribute(this.drawerToggleAttribute);

          if (isTargetToggleElement) {
            this.togglePanel();
          }
        },

        _isEdgeTouch: function(event) {
          var x = event.detail.x;

          return !this.disableEdgeSwipe && this._swipeAllowed() &&
            (this.rightDrawer ?
              x >= this.offsetWidth - this.edgeSwipeSensitivity :
              x <= this.edgeSwipeSensitivity);
        },

        _trackStart: function(event) {
          if (this._swipeAllowed()) {
            sharedPanel = this;
            this._setDragging(true);

            if (this._isMainSelected()) {
              this._setDragging(this.peeking || this._isEdgeTouch(event));
            }

            if (this.dragging) {
              this.width = this.$.drawer.offsetWidth;
              this._transition = false;
            }
          }
        },

        _translateXForDeltaX: function(deltaX) {
          var isMain = this._isMainSelected();

          if (this.rightDrawer) {
            return Math.max(0, isMain ? this.width + deltaX : deltaX);
          } else {
            return Math.min(0, isMain ? deltaX - this.width : deltaX);
          }
        },

        _trackX: function(event) {
          if (this.dragging) {
            var dx = event.detail.dx;

            if (this.peeking) {
              if (Math.abs(dx) <= this.edgeSwipeSensitivity) {
                // Ignore trackx until we move past the edge peek.
                return;
              }
              this._setPeeking(false);
            }

            this._moveDrawer(this._translateXForDeltaX(dx));
          }
        },

        _trackEnd: function(event) {
          if (this.dragging) {
            var xDirection = event.detail.dx > 0;

            this._setDragging(false);
            this._transition = true;
            sharedPanel = null;
            this._moveDrawer(null);

            if (this.rightDrawer) {
              this[xDirection ? 'closeDrawer' : 'openDrawer']();
            } else {
              this[xDirection ? 'openDrawer' : 'closeDrawer']();
            }
          }
        },

        _transformForTranslateX: function(translateX) {
          if (translateX === null) {
            return '';
          }
          return this.hasWillChange ? 'translateX(' + translateX + 'px)' :
              'translate3d(' + translateX + 'px, 0, 0)';
        },

        _moveDrawer: function(translateX) {
          this.transform(this._transformForTranslateX(translateX), this.$.drawer);
        },

        _getDrawerContent: function() {
          return Polymer.dom(this.$.drawerContent).getDistributedNodes()[0];
        },

        _getAutoFocusedNode: function() {
          var drawerContent = this._getDrawerContent();

          return this.drawerFocusSelector ?
              Polymer.dom(drawerContent).querySelector(this.drawerFocusSelector) || drawerContent : null;
        },

        _toggleFocusListener: function(selected) {
          if (selected === 'drawer') {
            this.addEventListener('focus', this._boundFocusListener, true);
          } else {
            this.removeEventListener('focus', this._boundFocusListener, true);
          }
        },

        _didFocus: function(event) {
          var autoFocusedNode = this._getAutoFocusedNode();
          if (!autoFocusedNode) {
            return;
          }

          var path = Polymer.dom(event).path;
          var focusedChild = path[0];
          var drawerContent = this._getDrawerContent();
          var focusedChildCameFromDrawer = path.indexOf(drawerContent) !== -1;

          if (!focusedChildCameFromDrawer) {
            event.stopPropagation();
            autoFocusedNode.focus();
          }
        },

        _isDrawerClosed: function(narrow, selected) {
          return !narrow || selected !== 'drawer';
        }
      });

    }());
  </script>
</dom-module>


<dom-module id="paper-header-panel" assetpath="../paper-header-panel/">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);

        position: relative;
        height: 100%;

        @apply(--paper-header-panel);
      }

      #mainContainer {
        @apply(--layout-flex);

        position: relative;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
      }

      #mainPanel {
        @apply(--layout-vertical);
        @apply(--layout-flex);

        position: relative;
        min-height: 0;

        @apply(--paper-header-panel-body);
      }

      #mainContainer {
        @apply(--paper-header-panel-container);
      }

      /*
       * mode: scroll
       */
      :host([mode=scroll]) #mainContainer {
        @apply(--paper-header-panel-scroll-container);

        overflow: visible;
      }

      :host([mode=scroll]) {
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
      }

      /*
       * mode: cover
       */
      :host([mode=cover]) #mainContainer {
        @apply(--paper-header-panel-cover-container);

        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }

      :host([mode=cover]) #mainPanel {
        position: static;
      }

      /*
       * mode: standard
       */
      :host([mode=standard]) #mainContainer {
        @apply(--paper-header-panel-standard-container);
      }

      /*
       * mode: seamed
       */
      :host([mode=seamed]) #mainContainer {
        @apply(--paper-header-panel-seamed-container);
      }


      /*
       * mode: waterfall
       */
      :host([mode=waterfall]) #mainContainer {
        @apply(--paper-header-panel-waterfall-container);
      }

      /*
       * mode: waterfall-tall
       */
      :host([mode=waterfall-tall]) #mainContainer {
        @apply(--paper-header-panel-waterfall-tall-container);
      }

      #dropShadow {
        transition: opacity 0.5s;
        height: 6px;
        box-shadow: inset 0px 5px 6px -3px rgba(0, 0, 0, 0.4);

        @apply(--paper-header-panel-shadow);

        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        opacity: 0;
        pointer-events: none;
      }

      #dropShadow.has-shadow {
        opacity: 1;
      }
    </style>

    <content id="headerContent" select="paper-toolbar, .paper-header"></content>

    <div id="mainPanel">
      <div id="mainContainer" class$="[[_computeMainContainerClass(mode)]]">
        <content id="mainContent" select="*"></content>
      </div>
      <div id="dropShadow"></div>
    </div>
  </template>

  <script>
    (function() {
      'use strict';

      var SHADOW_WHEN_SCROLLING = 1;
      var SHADOW_ALWAYS = 2;
      var MODE_CONFIGS = {
        outerScroll: {
          'scroll': true
        },

        shadowMode: {
          'standard': SHADOW_ALWAYS,
          'waterfall': SHADOW_WHEN_SCROLLING,
          'waterfall-tall': SHADOW_WHEN_SCROLLING
        },

        tallMode: {
          'waterfall-tall': true
        }
      };

      Polymer({
        is: 'paper-header-panel',

        /**
         * Fired when the content has been scrolled.  `event.detail.target` returns
         * the scrollable element which you can use to access scroll info such as
         * `scrollTop`.
         *
         *     <paper-header-panel on-content-scroll="scrollHandler">
         *       ...
         *     </paper-header-panel>
         *
         *
         *     scrollHandler: function(event) {
         *       var scroller = event.detail.target;
         *       console.log(scroller.scrollTop);
         *     }
         *
         * @event content-scroll
         */

        properties: {
          /**
           * Controls header and scrolling behavior. Options are
           * `standard`, `seamed`, `waterfall`, `waterfall-tall`, `scroll` and
           * `cover`. Default is `standard`.
           *
           * `standard`: The header is a step above the panel. The header will consume the
           * panel at the point of entry, preventing it from passing through to the
           * opposite side.
           *
           * `seamed`: The header is presented as seamed with the panel.
           *
           * `waterfall`: Similar to standard mode, but header is initially presented as
           * seamed with panel, but then separates to form the step.
           *
           * `waterfall-tall`: The header is initially taller (`tall` class is added to
           * the header).  As the user scrolls, the header separates (forming an edge)
           * while condensing (`tall` class is removed from the header).
           *
           * `scroll`: The header keeps its seam with the panel, and is pushed off screen.
           *
           * `cover`: The panel covers the whole `paper-header-panel` including the
           * header. This allows user to style the panel in such a way that the panel is
           * partially covering the header.
           *
           *     <paper-header-panel mode="cover">
           *       <paper-toolbar class="tall">
           *         <paper-icon-button icon="menu"></paper-icon-button>
           *       </paper-toolbar>
           *       <div class="content"></div>
           *     </paper-header-panel>
           */
          mode: {
            type: String,
            value: 'standard',
            observer: '_modeChanged',
            reflectToAttribute: true
          },

          /**
           * If true, the drop-shadow is always shown no matter what mode is set to.
           */
          shadow: {
            type: Boolean,
            value: false
          },

          /**
           * The class used in waterfall-tall mode.  Change this if the header
           * accepts a different class for toggling height, e.g. "medium-tall"
           */
          tallClass: {
            type: String,
            value: 'tall'
          },

          /**
           * If true, the scroller is at the top
           */
          atTop: {
            type: Boolean,
            value: true,
            notify: true,
            readOnly: true,
            reflectToAttribute: true
          }
        },

        observers: [
          '_computeDropShadowHidden(atTop, mode, shadow)'
        ],

        ready: function() {
          this.scrollHandler = this._scroll.bind(this);
        },

        attached: function() {
          this._addListener();
          // Run `scroll` logic once to initialize class names, etc.
          this._keepScrollingState();
        },

        detached: function() {
          this._removeListener();
        },

        /**
         * Returns the header element
         *
         * @property header
         * @type Object
         */
        get header() {
          return Polymer.dom(this.$.headerContent).getDistributedNodes()[0];
        },

        /**
         * Returns the scrollable element.
         *
         * @property scroller
         * @type Object
         */
        get scroller() {
          return this._getScrollerForMode(this.mode);
        },

        /**
         * Returns true if the scroller has a visible shadow.
         *
         * @property visibleShadow
         * @type Boolean
         */
        get visibleShadow() {
          return this.$.dropShadow.classList.contains('has-shadow');
        },

        _computeDropShadowHidden: function(atTop, mode, shadow) {
          var shadowMode = MODE_CONFIGS.shadowMode[mode];

          if (this.shadow) {
            this.toggleClass('has-shadow', true, this.$.dropShadow);
          } else if (shadowMode === SHADOW_ALWAYS) {
            this.toggleClass('has-shadow', true, this.$.dropShadow);
          } else if (shadowMode === SHADOW_WHEN_SCROLLING && !atTop) {
            this.toggleClass('has-shadow', true, this.$.dropShadow);
          } else {
            this.toggleClass('has-shadow', false, this.$.dropShadow);
          }
        },

        _computeMainContainerClass: function(mode) {
          // TODO:  It will be useful to have a utility for classes
          // e.g. Polymer.Utils.classes({ foo: true });

          var classes = {};

          classes['flex'] = mode !== 'cover';

          return Object.keys(classes).filter(
            function(className) {
              return classes[className];
            }).join(' ');
        },

        _addListener: function() {
          this.scroller.addEventListener('scroll', this.scrollHandler, false);
        },

        _removeListener: function() {
          this.scroller.removeEventListener('scroll', this.scrollHandler);
        },

        _modeChanged: function(newMode, oldMode) {
          var configs = MODE_CONFIGS;
          var header = this.header;
          var animateDuration = 200;

          if (header) {
            // in tallMode it may add tallClass to the header; so do the cleanup
            // when mode is changed from tallMode to not tallMode
            if (configs.tallMode[oldMode] && !configs.tallMode[newMode]) {
              header.classList.remove(this.tallClass);
              this.async(function() {
                header.classList.remove('animate');
              }, animateDuration);
            } else {
              this.toggleClass('animate', configs.tallMode[newMode], header);
            }
          }
          this._keepScrollingState();
        },

        _keepScrollingState: function() {
          var main = this.scroller;
          var header = this.header;

          this._setAtTop(main.scrollTop === 0);

          if (header && this.tallClass && MODE_CONFIGS.tallMode[this.mode]) {
            this.toggleClass(this.tallClass, this.atTop ||
                header.classList.contains(this.tallClass) &&
                main.scrollHeight < this.offsetHeight, header);
          }
        },

        _scroll: function() {
          this._keepScrollingState();
          this.fire('content-scroll', {target: this.scroller}, {bubbles: false});
        },

        _getScrollerForMode: function(mode) {
          return MODE_CONFIGS.outerScroll[mode] ?
              this : this.$.mainContainer;
        }
      });
    })();
  </script>
</dom-module>


<script>

  /**
   * `Polymer.IronMenuBehavior` implements accessible menu behavior.
   *
   * @demo demo/index.html
   * @polymerBehavior Polymer.IronMenuBehavior
   */
  Polymer.IronMenuBehaviorImpl = {

    properties: {

      /**
       * Returns the currently focused item.
       * @type {?Object}
       */
      focusedItem: {
        observer: '_focusedItemChanged',
        readOnly: true,
        type: Object
      },

      /**
       * The attribute to use on menu items to look up the item title. Typing the first
       * letter of an item when the menu is open focuses that item. If unset, `textContent`
       * will be used.
       */
      attrForItemTitle: {
        type: String
      }
    },

    _SEARCH_RESET_TIMEOUT_MS: 1000,

    hostAttributes: {
      'role': 'menu',
      'tabindex': '0'
    },

    observers: [
      '_updateMultiselectable(multi)'
    ],

    listeners: {
      'focus': '_onFocus',
      'keydown': '_onKeydown',
      'iron-items-changed': '_onIronItemsChanged'
    },

    keyBindings: {
      'up': '_onUpKey',
      'down': '_onDownKey',
      'esc': '_onEscKey',
      'shift+tab:keydown': '_onShiftTabDown'
    },

    attached: function() {
      this._resetTabindices();
    },

    /**
     * Selects the given value. If the `multi` property is true, then the selected state of the
     * `value` will be toggled; otherwise the `value` will be selected.
     *
     * @param {string|number} value the value to select.
     */
    select: function(value) {
      // Cancel automatically focusing a default item if the menu received focus
      // through a user action selecting a particular item.
      if (this._defaultFocusAsync) {
        this.cancelAsync(this._defaultFocusAsync);
        this._defaultFocusAsync = null;
      }
      var item = this._valueToItem(value);
      if (item && item.hasAttribute('disabled')) return;
      this._setFocusedItem(item);
      Polymer.IronMultiSelectableBehaviorImpl.select.apply(this, arguments);
    },

    /**
     * Resets all tabindex attributes to the appropriate value based on the
     * current selection state. The appropriate value is `0` (focusable) for
     * the default selected item, and `-1` (not keyboard focusable) for all
     * other items.
     */
    _resetTabindices: function() {
      var selectedItem = this.multi ? (this.selectedItems && this.selectedItems[0]) : this.selectedItem;

      this.items.forEach(function(item) {
        item.setAttribute('tabindex', item === selectedItem ? '0' : '-1');
      }, this);
    },

    /**
     * Sets appropriate ARIA based on whether or not the menu is meant to be
     * multi-selectable.
     *
     * @param {boolean} multi True if the menu should be multi-selectable.
     */
    _updateMultiselectable: function(multi) {
      if (multi) {
        this.setAttribute('aria-multiselectable', 'true');
      } else {
        this.removeAttribute('aria-multiselectable');
      }
    },

    /**
     * Given a KeyboardEvent, this method will focus the appropriate item in the
     * menu (if there is a relevant item, and it is possible to focus it).
     *
     * @param {KeyboardEvent} event A KeyboardEvent.
     */
    _focusWithKeyboardEvent: function(event) {
      this.cancelDebouncer('_clearSearchText');

      var searchText = this._searchText || '';
      var key = event.key && event.key.length == 1 ? event.key :
          String.fromCharCode(event.keyCode);
      searchText += key.toLocaleLowerCase();

      var searchLength = searchText.length;

      for (var i = 0, item; item = this.items[i]; i++) {
        if (item.hasAttribute('disabled')) {
          continue;
        }

        var attr = this.attrForItemTitle || 'textContent';
        var title = (item[attr] || item.getAttribute(attr) || '').trim();

        if (title.length < searchLength) {
          continue;
        }

        if (title.slice(0, searchLength).toLocaleLowerCase() == searchText) {
          this._setFocusedItem(item);
          break;
        }
      }

      this._searchText = searchText;
      this.debounce('_clearSearchText', this._clearSearchText,
                    this._SEARCH_RESET_TIMEOUT_MS);
    },

    _clearSearchText: function() {
      this._searchText = '';
    },

    /**
     * Focuses the previous item (relative to the currently focused item) in the
     * menu, disabled items will be skipped.
     * Loop until length + 1 to handle case of single item in menu.
     */
    _focusPrevious: function() {
      var length = this.items.length;
      var curFocusIndex = Number(this.indexOf(this.focusedItem));

      for (var i = 1; i < length + 1; i++) {
        var item = this.items[(curFocusIndex - i + length) % length];
        if (!item.hasAttribute('disabled')) {
          var owner = Polymer.dom(item).getOwnerRoot() || document;
          this._setFocusedItem(item);

          // Focus might not have worked, if the element was hidden or not
          // focusable. In that case, try again.
          if (Polymer.dom(owner).activeElement == item) {
            return;
          }
        }
      }
    },

    /**
     * Focuses the next item (relative to the currently focused item) in the
     * menu, disabled items will be skipped.
     * Loop until length + 1 to handle case of single item in menu.
     */
    _focusNext: function() {
      var length = this.items.length;
      var curFocusIndex = Number(this.indexOf(this.focusedItem));

      for (var i = 1; i < length + 1; i++) {
        var item = this.items[(curFocusIndex + i) % length];
        if (!item.hasAttribute('disabled')) {
          var owner = Polymer.dom(item).getOwnerRoot() || document;
          this._setFocusedItem(item);

          // Focus might not have worked, if the element was hidden or not
          // focusable. In that case, try again.
          if (Polymer.dom(owner).activeElement == item) {
            return;
          }
        }
      }
    },

    /**
     * Mutates items in the menu based on provided selection details, so that
     * all items correctly reflect selection state.
     *
     * @param {Element} item An item in the menu.
     * @param {boolean} isSelected True if the item should be shown in a
     * selected state, otherwise false.
     */
    _applySelection: function(item, isSelected) {
      if (isSelected) {
        item.setAttribute('aria-selected', 'true');
      } else {
        item.removeAttribute('aria-selected');
      }
      Polymer.IronSelectableBehavior._applySelection.apply(this, arguments);
    },

    /**
     * Discretely updates tabindex values among menu items as the focused item
     * changes.
     *
     * @param {Element} focusedItem The element that is currently focused.
     * @param {?Element} old The last element that was considered focused, if
     * applicable.
     */
    _focusedItemChanged: function(focusedItem, old) {
      old && old.setAttribute('tabindex', '-1');
      if (focusedItem) {
        focusedItem.setAttribute('tabindex', '0');
        focusedItem.focus();
      }
    },

    /**
     * A handler that responds to mutation changes related to the list of items
     * in the menu.
     *
     * @param {CustomEvent} event An event containing mutation records as its
     * detail.
     */
    _onIronItemsChanged: function(event) {
      if (event.detail.addedNodes.length) {
        this._resetTabindices();
      }
    },

    /**
     * Handler that is called when a shift+tab keypress is detected by the menu.
     *
     * @param {CustomEvent} event A key combination event.
     */
    _onShiftTabDown: function(event) {
      var oldTabIndex = this.getAttribute('tabindex');

      Polymer.IronMenuBehaviorImpl._shiftTabPressed = true;

      this._setFocusedItem(null);

      this.setAttribute('tabindex', '-1');

      this.async(function() {
        this.setAttribute('tabindex', oldTabIndex);
        Polymer.IronMenuBehaviorImpl._shiftTabPressed = false;
        // NOTE(cdata): polymer/polymer#1305
      }, 1);
    },

    /**
     * Handler that is called when the menu receives focus.
     *
     * @param {FocusEvent} event A focus event.
     */
    _onFocus: function(event) {
      if (Polymer.IronMenuBehaviorImpl._shiftTabPressed) {
        // do not focus the menu itself
        return;
      }

      // Do not focus the selected tab if the deepest target is part of the
      // menu element's local DOM and is focusable.
      var rootTarget = /** @type {?HTMLElement} */(
          Polymer.dom(event).rootTarget);
      if (rootTarget !== this && typeof rootTarget.tabIndex !== "undefined" && !this.isLightDescendant(rootTarget)) {
        return;
      }

      // clear the cached focus item
      this._defaultFocusAsync = this.async(function() {
        // focus the selected item when the menu receives focus, or the first item
        // if no item is selected
        var selectedItem = this.multi ? (this.selectedItems && this.selectedItems[0]) : this.selectedItem;

        this._setFocusedItem(null);

        if (selectedItem) {
          this._setFocusedItem(selectedItem);
        } else if (this.items[0]) {
          // We find the first none-disabled item (if one exists)
          this._focusNext();
        }
      });
    },

    /**
     * Handler that is called when the up key is pressed.
     *
     * @param {CustomEvent} event A key combination event.
     */
    _onUpKey: function(event) {
      // up and down arrows moves the focus
      this._focusPrevious();
      event.detail.keyboardEvent.preventDefault();
    },

    /**
     * Handler that is called when the down key is pressed.
     *
     * @param {CustomEvent} event A key combination event.
     */
    _onDownKey: function(event) {
      this._focusNext();
      event.detail.keyboardEvent.preventDefault();
    },

    /**
     * Handler that is called when the esc key is pressed.
     *
     * @param {CustomEvent} event A key combination event.
     */
    _onEscKey: function(event) {
      // esc blurs the control
      this.focusedItem.blur();
    },

    /**
     * Handler that is called when a keydown event is detected.
     *
     * @param {KeyboardEvent} event A keyboard event.
     */
    _onKeydown: function(event) {
      if (!this.keyboardEventMatchesKeys(event, 'up down esc')) {
        // all other keys focus the menu item starting with that character
        this._focusWithKeyboardEvent(event);
      }
      event.stopPropagation();
    },

    // override _activateHandler
    _activateHandler: function(event) {
      Polymer.IronSelectableBehavior._activateHandler.call(this, event);
      event.stopPropagation();
    }
  };

  Polymer.IronMenuBehaviorImpl._shiftTabPressed = false;

  /** @polymerBehavior Polymer.IronMenuBehavior */
  Polymer.IronMenuBehavior = [
    Polymer.IronMultiSelectableBehavior,
    Polymer.IronA11yKeysBehavior,
    Polymer.IronMenuBehaviorImpl
  ];

</script><dom-module id="paper-menu-shared-styles" assetpath="../paper-menu/">
  <template>
    <style>
      /* need a wrapper element to make this higher specificity than the :host rule in paper-item */
      .selectable-content > ::content > .iron-selected {
        font-weight: bold;

        @apply(--paper-menu-selected-item);
      }

      .selectable-content > ::content > [disabled] {
        color: var(--paper-menu-disabled-color, --disabled-text-color);
      }

      .selectable-content > ::content > *:focus {
        position: relative;
        outline: 0;

        @apply(--paper-menu-focused-item);
      }

      .selectable-content > ::content > *:focus:after {
        @apply(--layout-fit);
        background: currentColor;
        opacity: var(--dark-divider-opacity);
        content: '';
        pointer-events: none;

        @apply(--paper-menu-focused-item-after);
      }

      .selectable-content > ::content > *[colored]:focus:after {
        opacity: 0.26;
      }
    </style>
  </template>
</dom-module>
<dom-module id="paper-menu" assetpath="../paper-menu/">
  <template>
    <style include="paper-menu-shared-styles"></style>
    <style>
      :host {
        display: block;
        padding: 8px 0;

        background: var(--paper-menu-background-color, --primary-background-color);
        color: var(--paper-menu-color, --primary-text-color);

        @apply(--paper-menu);
      }
    </style>

    <div class="selectable-content">
      <content></content>
    </div>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'paper-menu',

        behaviors: [
          Polymer.IronMenuBehavior
        ]
      });
    })();
  </script>
</dom-module>




<script>
  /** @polymerBehavior Polymer.PaperItemBehavior */
  Polymer.PaperItemBehaviorImpl = {
    hostAttributes: {
      role: 'option',
      tabindex: '0'
    }
  };

  /** @polymerBehavior */
  Polymer.PaperItemBehavior = [
    Polymer.IronButtonState,
    Polymer.IronControlState,
    Polymer.PaperItemBehaviorImpl
  ];
</script><dom-module id="paper-item-shared-styles" assetpath="../paper-item/">
  <template>
    <style>
      :host, .paper-item {
        display: block;
        position: relative;
        min-height: var(--paper-item-min-height, 48px);
        padding: 0px 16px;
      }

      .paper-item {
        @apply(--paper-font-subhead);
        border:none;
        outline: none;
        background: white;
        width: 100%;
        text-align: left;
      }

      :host([hidden]), .paper-item[hidden] {
        display: none !important;
      }

      :host(.iron-selected), .paper-item.iron-selected {
        font-weight: var(--paper-item-selected-weight, bold);

        @apply(--paper-item-selected);
      }

      :host([disabled]), .paper-item[disabled] {
        color: var(--paper-item-disabled-color, --disabled-text-color);

        @apply(--paper-item-disabled);
      }

      :host(:focus), .paper-item:focus {
        position: relative;
        outline: 0;

        @apply(--paper-item-focused);
      }

      :host(:focus):before, .paper-item:focus:before {
        @apply(--layout-fit);

        background: currentColor;
        content: '';
        opacity: var(--dark-divider-opacity);
        pointer-events: none;

        @apply(--paper-item-focused-before);
      }
    </style>
  </template>
</dom-module>
<dom-module id="paper-item" assetpath="../paper-item/">
  <template>
    <style include="paper-item-shared-styles"></style>
    <style>
      :host {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--paper-font-subhead);

        @apply(--paper-item);
      }
    </style>

    <content></content>
  </template>

  <script>
    Polymer({
      is: 'paper-item',

      behaviors: [
        Polymer.PaperItemBehavior
      ]
    });
  </script>
</dom-module>


<dom-module id="iron-icon" assetpath="../iron-icon/">
  <template>
    <style>
      :host {
        @apply(--layout-inline);
        @apply(--layout-center-center);
        position: relative;

        vertical-align: middle;

        fill: var(--iron-icon-fill-color, currentcolor);
        stroke: var(--iron-icon-stroke-color, none);

        width: var(--iron-icon-width, 24px);
        height: var(--iron-icon-height, 24px);
        @apply(--iron-icon);
      }
    </style>
  </template>

  <script>

    Polymer({

      is: 'iron-icon',

      properties: {

        /**
         * The name of the icon to use. The name should be of the form:
         * `iconset_name:icon_name`.
         */
        icon: {
          type: String
        },

        /**
         * The name of the theme to used, if one is specified by the
         * iconset.
         */
        theme: {
          type: String
        },

        /**
         * If using iron-icon without an iconset, you can set the src to be
         * the URL of an individual icon image file. Note that this will take
         * precedence over a given icon attribute.
         */
        src: {
          type: String
        },

        /**
         * @type {!Polymer.IronMeta}
         */
        _meta: {
          value: Polymer.Base.create('iron-meta', {type: 'iconset'})
        }

      },

      observers: [
        '_updateIcon(_meta, isAttached)',
        '_updateIcon(theme, isAttached)',
        '_srcChanged(src, isAttached)',
        '_iconChanged(icon, isAttached)'
      ],

      _DEFAULT_ICONSET: 'icons',

      _iconChanged: function(icon) {
        var parts = (icon || '').split(':');
        this._iconName = parts.pop();
        this._iconsetName = parts.pop() || this._DEFAULT_ICONSET;
        this._updateIcon();
      },

      _srcChanged: function(src) {
        this._updateIcon();
      },

      _usesIconset: function() {
        return this.icon || !this.src;
      },

      /** @suppress {visibility} */
      _updateIcon: function() {
        if (this._usesIconset()) {
          if (this._img && this._img.parentNode) {
            Polymer.dom(this.root).removeChild(this._img);
          }
          if (this._iconName === "") {
            if (this._iconset) {
              this._iconset.removeIcon(this);
            }
          } else if (this._iconsetName && this._meta) {
            this._iconset = /** @type {?Polymer.Iconset} */ (
              this._meta.byKey(this._iconsetName));
            if (this._iconset) {
              this._iconset.applyIcon(this, this._iconName, this.theme);
              this.unlisten(window, 'iron-iconset-added', '_updateIcon');
            } else {
              this.listen(window, 'iron-iconset-added', '_updateIcon');
            }
          }
        } else {
          if (this._iconset) {
            this._iconset.removeIcon(this);
          }
          if (!this._img) {
            this._img = document.createElement('img');
            this._img.style.width = '100%';
            this._img.style.height = '100%';
            this._img.draggable = false;
          }
          this._img.src = this.src;
          Polymer.dom(this.root).appendChild(this._img);
        }
      }

    });

  </script>

</dom-module>
<script>
  /**
   * The `iron-iconset-svg` element allows users to define their own icon sets
   * that contain svg icons. The svg icon elements should be children of the
   * `iron-iconset-svg` element. Multiple icons should be given distinct id's.
   *
   * Using svg elements to create icons has a few advantages over traditional
   * bitmap graphics like jpg or png. Icons that use svg are vector based so
   * they are resolution independent and should look good on any device. They
   * are stylable via css. Icons can be themed, colorized, and even animated.
   *
   * Example:
   *
   *     <iron-iconset-svg name="my-svg-icons" size="24">
   *       <svg>
   *         <defs>
   *           <g id="shape">
   *             <rect x="12" y="0" width="12" height="24" />
   *             <circle cx="12" cy="12" r="12" />
   *           </g>
   *         </defs>
   *       </svg>
   *     </iron-iconset-svg>
   *
   * This will automatically register the icon set "my-svg-icons" to the iconset
   * database.  To use these icons from within another element, make a
   * `iron-iconset` element and call the `byId` method
   * to retrieve a given iconset. To apply a particular icon inside an
   * element use the `applyIcon` method. For example:
   *
   *     iconset.applyIcon(iconNode, 'car');
   *
   * @element iron-iconset-svg
   * @demo demo/index.html
   * @implements {Polymer.Iconset}
   */
  Polymer({
    is: 'iron-iconset-svg',

    properties: {

      /**
       * The name of the iconset.
       */
      name: {
        type: String,
        observer: '_nameChanged'
      },

      /**
       * The size of an individual icon. Note that icons must be square.
       */
      size: {
        type: Number,
        value: 24
      },

      /**
       * Set to true to enable mirroring of icons where specified when they are
       * stamped. Icons that should be mirrored should be decorated with a
       * `mirror-in-rtl` attribute.
       */
      rtlMirroring: {
        type: Boolean,
        value: false
      }
    },

    _targetIsRTL: function(target) {
      if (target && target.nodeType !== Node.ELEMENT_NODE) {
        target = target.host;
      }

      return target && window.getComputedStyle(target)['direction'] === 'rtl';
    },

    attached: function() {
      this.style.display = 'none';
    },

    /**
     * Construct an array of all icon names in this iconset.
     *
     * @return {!Array} Array of icon names.
     */
    getIconNames: function() {
      this._icons = this._createIconMap();
      return Object.keys(this._icons).map(function(n) {
        return this.name + ':' + n;
      }, this);
    },

    /**
     * Applies an icon to the given element.
     *
     * An svg icon is prepended to the element's shadowRoot if it exists,
     * otherwise to the element itself.
     *
     * @method applyIcon
     * @param {Element} element Element to which the icon is applied.
     * @param {string} iconName Name of the icon to apply.
     * @return {?Element} The svg element which renders the icon.
     */
    applyIcon: function(element, iconName) {
      // insert svg element into shadow root, if it exists
      element = element.root || element;
      // Remove old svg element
      this.removeIcon(element);
      // install new svg element
      var svg = this._cloneIcon(iconName,
          this.rtlMirroring && this._targetIsRTL(element));
      if (svg) {
        var pde = Polymer.dom(element);
        pde.insertBefore(svg, pde.childNodes[0]);
        return element._svgIcon = svg;
      }
      return null;
    },

    /**
     * Remove an icon from the given element by undoing the changes effected
     * by `applyIcon`.
     *
     * @param {Element} element The element from which the icon is removed.
     */
    removeIcon: function(element) {
      // Remove old svg element
      element = element.root || element;
      if (element._svgIcon) {
        Polymer.dom(element).removeChild(element._svgIcon);
        element._svgIcon = null;
      }
    },

    /**
     *
     * When name is changed, register iconset metadata
     *
     */
    _nameChanged: function() {
      new Polymer.IronMeta({type: 'iconset', key: this.name, value: this});
      this.async(function() {
        this.fire('iron-iconset-added', this, {node: window});
      });
    },

    /**
     * Create a map of child SVG elements by id.
     *
     * @return {!Object} Map of id's to SVG elements.
     */
    _createIconMap: function() {
      // Objects chained to Object.prototype (`{}`) have members. Specifically,
      // on FF there is a `watch` method that confuses the icon map, so we
      // need to use a null-based object here.
      var icons = Object.create(null);
      Polymer.dom(this).querySelectorAll('[id]')
        .forEach(function(icon) {
          icons[icon.id] = icon;
        });
      return icons;
    },

    /**
     * Produce installable clone of the SVG element matching `id` in this
     * iconset, or `undefined` if there is no matching element.
     *
     * @return {Element} Returns an installable clone of the SVG element
     * matching `id`.
     */
    _cloneIcon: function(id, mirrorAllowed) {
      // create the icon map on-demand, since the iconset itself has no discrete
      // signal to know when it's children are fully parsed
      this._icons = this._icons || this._createIconMap();
      return this._prepareSvgClone(this._icons[id], this.size, mirrorAllowed);
    },

    /**
     * @param {Element} sourceSvg
     * @param {number} size
     * @param {Boolean} mirrorAllowed
     * @return {Element}
     */
    _prepareSvgClone: function(sourceSvg, size, mirrorAllowed) {
      if (sourceSvg) {
        var content = sourceSvg.cloneNode(true),
            svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg'),
            viewBox = content.getAttribute('viewBox') || '0 0 ' + size + ' ' + size,
            cssText = 'pointer-events: none; display: block; width: 100%; height: 100%;';

        if (mirrorAllowed && content.hasAttribute('mirror-in-rtl')) {
          cssText += '-webkit-transform:scale(-1,1);transform:scale(-1,1);';
        }

        svg.setAttribute('viewBox', viewBox);
        svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
        // TODO(dfreedm): `pointer-events: none` works around https://crbug.com/370136
        // TODO(sjmiles): inline style may not be ideal, but avoids requiring a shadow-root
        svg.style.cssText = cssText;
        svg.appendChild(content).removeAttribute('id');
        return svg;
      }
      return null;
    }

  });

</script><iron-iconset-svg name="icons" size="24">
<svg><defs>
<g id="3d-rotation"><path d="M7.52 21.48C4.25 19.94 1.91 16.76 1.55 13H.05C.56 19.16 5.71 24 12 24l.66-.03-3.81-3.81-1.33 1.32zm.89-6.52c-.19 0-.37-.03-.52-.08-.16-.06-.29-.13-.4-.24-.11-.1-.2-.22-.26-.37-.06-.14-.09-.3-.09-.47h-1.3c0 .36.07.68.21.95.14.27.33.5.56.69.24.18.51.32.82.41.3.1.62.15.96.15.37 0 .72-.05 1.03-.15.32-.1.6-.25.83-.44s.42-.43.55-.72c.13-.29.2-.61.2-.97 0-.19-.02-.38-.07-.56-.05-.18-.12-.35-.23-.51-.1-.16-.24-.3-.4-.43-.17-.13-.37-.23-.61-.31.2-.09.37-.2.52-.33.15-.13.27-.27.37-.42.1-.15.17-.3.22-.46.05-.16.07-.32.07-.48 0-.36-.06-.68-.18-.96-.12-.28-.29-.51-.51-.69-.2-.19-.47-.33-.77-.43C9.1 8.05 8.76 8 8.39 8c-.36 0-.69.05-1 .16-.3.11-.57.26-.79.45-.21.19-.38.41-.51.67-.12.26-.18.54-.18.85h1.3c0-.17.03-.32.09-.45s.14-.25.25-.34c.11-.09.23-.17.38-.22.15-.05.3-.08.48-.08.4 0 .7.1.89.31.19.2.29.49.29.86 0 .18-.03.34-.08.49-.05.15-.14.27-.25.37-.11.1-.25.18-.41.24-.16.06-.36.09-.58.09H7.5v1.03h.77c.22 0 .42.02.6.07s.33.13.45.23c.12.11.22.24.29.4.07.16.1.35.1.57 0 .41-.12.72-.35.93-.23.23-.55.33-.95.33zm8.55-5.92c-.32-.33-.7-.59-1.14-.77-.43-.18-.92-.27-1.46-.27H12v8h2.3c.55 0 1.06-.09 1.51-.27.45-.18.84-.43 1.16-.76.32-.33.57-.73.74-1.19.17-.47.26-.99.26-1.57v-.4c0-.58-.09-1.1-.26-1.57-.18-.47-.43-.87-.75-1.2zm-.39 3.16c0 .42-.05.79-.14 1.13-.1.33-.24.62-.43.85-.19.23-.43.41-.71.53-.29.12-.62.18-.99.18h-.91V9.12h.97c.72 0 1.27.23 1.64.69.38.46.57 1.12.57 1.99v.4zM12 0l-.66.03 3.81 3.81 1.33-1.33c3.27 1.55 5.61 4.72 5.96 8.48h1.5C23.44 4.84 18.29 0 12 0z"></path></g>
<g id="accessibility"><path d="M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm9 7h-6v13h-2v-6h-2v6H9V9H3V7h18v2z"></path></g>
<g id="accessible"><circle cx="12" cy="4" r="2"></circle><path d="M19 13v-2c-1.54.02-3.09-.75-4.07-1.83l-1.29-1.43c-.17-.19-.38-.34-.61-.45-.01 0-.01-.01-.02-.01H13c-.35-.2-.75-.3-1.19-.26C10.76 7.11 10 8.04 10 9.09V15c0 1.1.9 2 2 2h5v5h2v-5.5c0-1.1-.9-2-2-2h-3v-3.45c1.29 1.07 3.25 1.94 5 1.95zm-6.17 5c-.41 1.16-1.52 2-2.83 2-1.66 0-3-1.34-3-3 0-1.31.84-2.41 2-2.83V12.1c-2.28.46-4 2.48-4 4.9 0 2.76 2.24 5 5 5 2.42 0 4.44-1.72 4.9-4h-2.07z"></path></g>
<g id="account-balance"><path d="M4 10v7h3v-7H4zm6 0v7h3v-7h-3zM2 22h19v-3H2v3zm14-12v7h3v-7h-3zm-4.5-9L2 6v2h19V6l-9.5-5z"></path></g>
<g id="account-balance-wallet"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"></path></g>
<g id="account-box"><path d="M3 5v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.11 0-2 .9-2 2zm12 4c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zm-9 8c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1H6v-1z"></path></g>
<g id="account-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"></path></g>
<g id="add"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></g>
<g id="add-alert"><path d="M10.01 21.01c0 1.1.89 1.99 1.99 1.99s1.99-.89 1.99-1.99h-3.98zm8.87-4.19V11c0-3.25-2.25-5.97-5.29-6.69v-.72C13.59 2.71 12.88 2 12 2s-1.59.71-1.59 1.59v.72C7.37 5.03 5.12 7.75 5.12 11v5.82L3 18.94V20h18v-1.06l-2.12-2.12zM16 13.01h-3v3h-2v-3H8V11h3V8h2v3h3v2.01z"></path></g>
<g id="add-box"><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"></path></g>
<g id="add-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"></path></g>
<g id="add-circle-outline"><path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></g>
<g id="add-shopping-cart"><path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-9.83-3.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4h-.01l-1.1 2-2.76 5H8.53l-.13-.27L6.16 6l-.95-2-.94-2H1v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25z"></path></g>
<g id="alarm"><path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path></g>
<g id="alarm-add"><path d="M7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm1-11h-2v3H8v2h3v3h2v-3h3v-2h-3V9z"></path></g>
<g id="alarm-off"><path d="M12 6c3.87 0 7 3.13 7 7 0 .84-.16 1.65-.43 2.4l1.52 1.52c.58-1.19.91-2.51.91-3.92 0-4.97-4.03-9-9-9-1.41 0-2.73.33-3.92.91L9.6 6.43C10.35 6.16 11.16 6 12 6zm10-.28l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM2.92 2.29L1.65 3.57 2.98 4.9l-1.11.93 1.42 1.42 1.11-.94.8.8C3.83 8.69 3 10.75 3 13c0 4.97 4.02 9 9 9 2.25 0 4.31-.83 5.89-2.2l2.2 2.2 1.27-1.27L3.89 3.27l-.97-.98zm13.55 16.1C15.26 19.39 13.7 20 12 20c-3.87 0-7-3.13-7-7 0-1.7.61-3.26 1.61-4.47l9.86 9.86zM8.02 3.28L6.6 1.86l-.86.71 1.42 1.42.86-.71z"></path></g>
<g id="alarm-on"><path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm-1.46-5.47L8.41 12.4l-1.06 1.06 3.18 3.18 6-6-1.06-1.06-4.93 4.95z"></path></g>
<g id="all-out"><path d="M16.21 4.16l4 4v-4zm4 12l-4 4h4zm-12 4l-4-4v4zm-4-12l4-4h-4zm12.95-.95c-2.73-2.73-7.17-2.73-9.9 0s-2.73 7.17 0 9.9 7.17 2.73 9.9 0 2.73-7.16 0-9.9zm-1.1 8.8c-2.13 2.13-5.57 2.13-7.7 0s-2.13-5.57 0-7.7 5.57-2.13 7.7 0 2.13 5.57 0 7.7z"></path></g>
<g id="android"><path d="M6 18c0 .55.45 1 1 1h1v3.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V19h2v3.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V19h1c.55 0 1-.45 1-1V8H6v10zM3.5 8C2.67 8 2 8.67 2 9.5v7c0 .83.67 1.5 1.5 1.5S5 17.33 5 16.5v-7C5 8.67 4.33 8 3.5 8zm17 0c-.83 0-1.5.67-1.5 1.5v7c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-7c0-.83-.67-1.5-1.5-1.5zm-4.97-5.84l1.3-1.3c.2-.2.2-.51 0-.71-.2-.2-.51-.2-.71 0l-1.48 1.48C13.85 1.23 12.95 1 12 1c-.96 0-1.86.23-2.66.63L7.85.15c-.2-.2-.51-.2-.71 0-.2.2-.2.51 0 .71l1.31 1.31C6.97 3.26 6 5.01 6 7h12c0-1.99-.97-3.75-2.47-4.84zM10 5H9V4h1v1zm5 0h-1V4h1v1z"></path></g>
<g id="announcement"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 9h-2V5h2v6zm0 4h-2v-2h2v2z"></path></g>
<g id="apps"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"></path></g>
<g id="archive"><path d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"></path></g>
<g id="arrow-back"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></g>
<g id="arrow-downward"><path d="M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"></path></g>
<g id="arrow-drop-down"><path d="M7 10l5 5 5-5z"></path></g>
<g id="arrow-drop-down-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 12l-4-4h8l-4 4z"></path></g>
<g id="arrow-drop-up"><path d="M7 14l5-5 5 5z"></path></g>
<g id="arrow-forward"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"></path></g>
<g id="arrow-upward"><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"></path></g>
<g id="aspect-ratio"><path d="M19 12h-2v3h-3v2h5v-5zM7 9h3V7H5v5h2V9zm14-6H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16.01H3V4.99h18v14.02z"></path></g>
<g id="assessment"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path></g>
<g id="assignment"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"></path></g>
<g id="assignment-ind"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1V19z"></path></g>
<g id="assignment-late"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-6 15h-2v-2h2v2zm0-4h-2V8h2v6zm-1-9c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"></path></g>
<g id="assignment-return"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm4 12h-4v3l-5-5 5-5v3h4v4z"></path></g>
<g id="assignment-returned"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm0 15l-5-5h3V9h4v4h3l-5 5z"></path></g>
<g id="assignment-turned-in"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"></path></g>
<g id="attachment"><path d="M2 12.5C2 9.46 4.46 7 7.5 7H18c2.21 0 4 1.79 4 4s-1.79 4-4 4H9.5C8.12 15 7 13.88 7 12.5S8.12 10 9.5 10H17v2H9.41c-.55 0-.55 1 0 1H18c1.1 0 2-.9 2-2s-.9-2-2-2H7.5C5.57 9 4 10.57 4 12.5S5.57 16 7.5 16H17v2H7.5C4.46 18 2 15.54 2 12.5z"></path></g>
<g id="autorenew"><path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"></path></g>
<g id="backspace"><path d="M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-3 12.59L17.59 17 14 13.41 10.41 17 9 15.59 12.59 12 9 8.41 10.41 7 14 10.59 17.59 7 19 8.41 15.41 12 19 15.59z"></path></g>
<g id="backup"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"></path></g>
<g id="block"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z"></path></g>
<g id="book"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"></path></g>
<g id="bookmark"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"></path></g>
<g id="bookmark-border"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"></path></g>
<g id="bug-report"><path d="M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z"></path></g>
<g id="build"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"></path></g>
<g id="cached"><path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"></path></g>
<g id="camera-enhance"><path d="M9 3L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2h-3.17L15 3H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-1l1.25-2.75L16 13l-2.75-1.25L12 9l-1.25 2.75L8 13l2.75 1.25z"></path></g>
<g id="cancel"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"></path></g>
<g id="card-giftcard"><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"></path></g>
<g id="card-membership"><path d="M20 2H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h4v5l4-2 4 2v-5h4c1.11 0 2-.89 2-2V4c0-1.11-.89-2-2-2zm0 13H4v-2h16v2zm0-5H4V4h16v6z"></path></g>
<g id="card-travel"><path d="M20 6h-3V4c0-1.11-.89-2-2-2H9c-1.11 0-2 .89-2 2v2H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zM9 4h6v2H9V4zm11 15H4v-2h16v2zm0-5H4V8h3v2h2V8h6v2h2V8h3v6z"></path></g>
<g id="change-history"><path d="M12 7.77L18.39 18H5.61L12 7.77M12 4L2 20h20L12 4z"></path></g>
<g id="check"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></g>
<g id="check-box"><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></g>
<g id="check-box-outline-blank"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"></path></g>
<g id="check-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></g>
<g id="chevron-left"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></g>
<g id="chevron-right"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></g>
<g id="chrome-reader-mode"><path d="M13 12h7v1.5h-7zm0-2.5h7V11h-7zm0 5h7V16h-7zM21 4H3c-1.1 0-2 .9-2 2v13c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 15h-9V6h9v13z"></path></g>
<g id="class"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"></path></g>
<g id="clear"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></g>
<g id="close"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></g>
<g id="cloud"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"></path></g>
<g id="cloud-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.5 14H8c-1.66 0-3-1.34-3-3s1.34-3 3-3l.14.01C8.58 8.28 10.13 7 12 7c2.21 0 4 1.79 4 4h.5c1.38 0 2.5 1.12 2.5 2.5S17.88 16 16.5 16z"></path></g>
<g id="cloud-done"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM10 17l-3.5-3.5 1.41-1.41L10 14.17 15.18 9l1.41 1.41L10 17z"></path></g>
<g id="cloud-download"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"></path></g>
<g id="cloud-off"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-1.48 0-2.85.43-4.01 1.17l1.46 1.46C10.21 6.23 11.08 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3 0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.96zM3 5.27l2.75 2.74C2.56 8.15 0 10.77 0 14c0 3.31 2.69 6 6 6h11.73l2 2L21 20.73 4.27 4 3 5.27zM7.73 10l8 8H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h1.73z"></path></g>
<g id="cloud-queue"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h.71C7.37 7.69 9.48 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3s-1.34 3-3 3z"></path></g>
<g id="cloud-upload"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"></path></g>
<g id="code"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></g>
<g id="compare-arrows"><path d="M9.01 14H2v2h7.01v3L13 15l-3.99-4v3zm5.98-1v-3H22V8h-7.01V5L11 9l3.99 4z"></path></g>
<g id="content-copy"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></g>
<g id="content-cut"><path d="M9.64 7.64c.23-.5.36-1.05.36-1.64 0-2.21-1.79-4-4-4S2 3.79 2 6s1.79 4 4 4c.59 0 1.14-.13 1.64-.36L10 12l-2.36 2.36C7.14 14.13 6.59 14 6 14c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4c0-.59-.13-1.14-.36-1.64L12 14l7 7h3v-1L9.64 7.64zM6 8c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2zm0 12c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2zm6-7.5c-.28 0-.5-.22-.5-.5s.22-.5.5-.5.5.22.5.5-.22.5-.5.5zM19 3l-6 6 2 2 7-7V3z"></path></g>
<g id="content-paste"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"></path></g>
<g id="copyright"><path d="M10.08 10.86c.05-.33.16-.62.3-.87s.34-.46.59-.62c.24-.15.54-.22.91-.23.23.01.44.05.63.13.2.09.38.21.52.36s.25.33.34.53.13.42.14.64h1.79c-.02-.47-.11-.9-.28-1.29s-.4-.73-.7-1.01-.66-.5-1.08-.66-.88-.23-1.39-.23c-.65 0-1.22.11-1.7.34s-.88.53-1.2.92-.56.84-.71 1.36S8 11.29 8 11.87v.27c0 .58.08 1.12.23 1.64s.39.97.71 1.35.72.69 1.2.91 1.05.34 1.7.34c.47 0 .91-.08 1.32-.23s.77-.36 1.08-.63.56-.58.74-.94.29-.74.3-1.15h-1.79c-.01.21-.06.4-.15.58s-.21.33-.36.46-.32.23-.52.3c-.19.07-.39.09-.6.1-.36-.01-.66-.08-.89-.23-.25-.16-.45-.37-.59-.62s-.25-.55-.3-.88-.08-.67-.08-1v-.27c0-.35.03-.68.08-1.01zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></g>
<g id="create"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path></g>
<g id="create-new-folder"><path d="M20 6h-8l-2-2H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-1 8h-3v3h-2v-3h-3v-2h3V9h2v3h3v2z"></path></g>
<g id="credit-card"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"></path></g>
<g id="dashboard"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"></path></g>
<g id="date-range"><path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"></path></g>
<g id="delete"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path></g>
<g id="description"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path></g>
<g id="dns"><path d="M20 13H4c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h16c.55 0 1-.45 1-1v-6c0-.55-.45-1-1-1zM7 19c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM20 3H4c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zM7 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"></path></g>
<g id="done"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"></path></g>
<g id="done-all"><path d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"></path></g>
<g id="donut-large"><path d="M11 5.08V2c-5 .5-9 4.81-9 10s4 9.5 9 10v-3.08c-3-.48-6-3.4-6-6.92s3-6.44 6-6.92zM18.97 11H22c-.47-5-4-8.53-9-9v3.08C16 5.51 18.54 8 18.97 11zM13 18.92V22c5-.47 8.53-4 9-9h-3.03c-.43 3-2.97 5.49-5.97 5.92z"></path></g>
<g id="donut-small"><path d="M11 9.16V2c-5 .5-9 4.79-9 10s4 9.5 9 10v-7.16c-1-.41-2-1.52-2-2.84s1-2.43 2-2.84zM14.86 11H22c-.48-4.75-4-8.53-9-9v7.16c1 .3 1.52.98 1.86 1.84zM13 14.84V22c5-.47 8.52-4.25 9-9h-7.14c-.34.86-.86 1.54-1.86 1.84z"></path></g>
<g id="drafts"><path d="M21.99 8c0-.72-.37-1.35-.94-1.7L12 1 2.95 6.3C2.38 6.65 2 7.28 2 8v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2l-.01-10zM12 13L3.74 7.84 12 3l8.26 4.84L12 13z"></path></g>
<g id="eject"><path d="M5 17h14v2H5zm7-12L5.33 15h13.34z"></path></g>
<g id="error"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path></g>
<g id="error-outline"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></g>
<g id="event"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"></path></g>
<g id="event-seat"><path d="M4 18v3h3v-3h10v3h3v-6H4zm15-8h3v3h-3zM2 10h3v3H2zm15 3H7V5c0-1.1.9-2 2-2h6c1.1 0 2 .9 2 2v8z"></path></g>
<g id="exit-to-app"><path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"></path></g>
<g id="expand-less"><path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"></path></g>
<g id="expand-more"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></g>
<g id="explore"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path></g>
<g id="extension"><path d="M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"></path></g>
<g id="face"><path d="M9 11.75c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25zm6 0c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8 0-.29.02-.58.05-.86 2.36-1.05 4.23-2.98 5.21-5.37C11.07 8.33 14.05 10 17.42 10c.78 0 1.53-.09 2.25-.26.21.71.33 1.47.33 2.26 0 4.41-3.59 8-8 8z"></path></g>
<g id="favorite"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path></g>
<g id="favorite-border"><path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"></path></g>
<g id="feedback"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 12h-2v-2h2v2zm0-4h-2V6h2v4z"></path></g>
<g id="file-download"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path></g>
<g id="file-upload"><path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"></path></g>
<g id="filter-list"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"></path></g>
<g id="find-in-page"><path d="M20 19.59V8l-6-6H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c.45 0 .85-.15 1.19-.4l-4.43-4.43c-.8.52-1.74.83-2.76.83-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5c0 1.02-.31 1.96-.83 2.75L20 19.59zM9 13c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3z"></path></g>
<g id="find-replace"><path d="M11 6c1.38 0 2.63.56 3.54 1.46L12 10h6V4l-2.05 2.05C14.68 4.78 12.93 4 11 4c-3.53 0-6.43 2.61-6.92 6H6.1c.46-2.28 2.48-4 4.9-4zm5.64 9.14c.66-.9 1.12-1.97 1.28-3.14H15.9c-.46 2.28-2.48 4-4.9 4-1.38 0-2.63-.56-3.54-1.46L10 12H4v6l2.05-2.05C7.32 17.22 9.07 18 11 18c1.55 0 2.98-.51 4.14-1.36L20 21.49 21.49 20l-4.85-4.86z"></path></g>
<g id="fingerprint"><path d="M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 3 12.01 3c-1.98 0-3.86.47-5.57 1.41-.24.13-.54.04-.68-.2-.13-.24-.04-.55.2-.68C7.82 2.52 9.86 2 12.01 2c2.13 0 3.99.47 6.03 1.52.25.13.34.43.21.67-.09.18-.26.28-.44.28zM3.5 9.72c-.1 0-.2-.03-.29-.09-.23-.16-.28-.47-.12-.7.99-1.4 2.25-2.5 3.75-3.27C9.98 4.04 14 4.03 17.15 5.65c1.5.77 2.76 1.86 3.75 3.25.16.22.11.54-.12.7-.23.16-.54.11-.7-.12-.9-1.26-2.04-2.25-3.39-2.94-2.87-1.47-6.54-1.47-9.4.01-1.36.7-2.5 1.7-3.4 2.96-.08.14-.23.21-.39.21zm6.25 12.07c-.13 0-.26-.05-.35-.15-.87-.87-1.34-1.43-2.01-2.64-.69-1.23-1.05-2.73-1.05-4.34 0-2.97 2.54-5.39 5.66-5.39s5.66 2.42 5.66 5.39c0 .28-.22.5-.5.5s-.5-.22-.5-.5c0-2.42-2.09-4.39-4.66-4.39-2.57 0-4.66 1.97-4.66 4.39 0 1.44.32 2.77.93 3.85.64 1.15 1.08 1.64 1.85 2.42.19.2.19.51 0 .71-.11.1-.24.15-.37.15zm7.17-1.85c-1.19 0-2.24-.3-3.1-.89-1.49-1.01-2.38-2.65-2.38-4.39 0-.28.22-.5.5-.5s.5.22.5.5c0 1.41.72 2.74 1.94 3.56.71.48 1.54.71 2.54.71.24 0 .64-.03 1.04-.1.27-.05.53.13.58.41.05.27-.13.53-.41.58-.57.11-1.07.12-1.21.12zM14.91 22c-.04 0-.09-.01-.13-.02-1.59-.44-2.63-1.03-3.72-2.1-1.4-1.39-2.17-3.24-2.17-5.22 0-1.62 1.38-2.94 3.08-2.94 1.7 0 3.08 1.32 3.08 2.94 0 1.07.93 1.94 2.08 1.94s2.08-.87 2.08-1.94c0-3.77-3.25-6.83-7.25-6.83-2.84 0-5.44 1.58-6.61 4.03-.39.81-.59 1.76-.59 2.8 0 .78.07 2.01.67 3.61.1.26-.03.55-.29.64-.26.1-.55-.04-.64-.29-.49-1.31-.73-2.61-.73-3.96 0-1.2.23-2.29.68-3.24 1.33-2.79 4.28-4.6 7.51-4.6 4.55 0 8.25 3.51 8.25 7.83 0 1.62-1.38 2.94-3.08 2.94s-3.08-1.32-3.08-2.94c0-1.07-.93-1.94-2.08-1.94s-2.08.87-2.08 1.94c0 1.71.66 3.31 1.87 4.51.95.94 1.86 1.46 3.27 1.85.27.07.42.35.35.61-.05.23-.26.38-.47.38z"></path></g>
<g id="flag"><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"></path></g>
<g id="flight-land"><path d="M2.5 19h19v2h-19zm7.18-5.73l4.35 1.16 5.31 1.42c.8.21 1.62-.26 1.84-1.06.21-.8-.26-1.62-1.06-1.84l-5.31-1.42-2.76-9.02L10.12 2v8.28L5.15 8.95l-.93-2.32-1.45-.39v5.17l1.6.43 5.31 1.43z"></path></g>
<g id="flight-takeoff"><path d="M2.5 19h19v2h-19zm19.57-9.36c-.21-.8-1.04-1.28-1.84-1.06L14.92 10l-6.9-6.43-1.93.51 4.14 7.17-4.97 1.33-1.97-1.54-1.45.39 1.82 3.16.77 1.33 1.6-.43 5.31-1.42 4.35-1.16L21 11.49c.81-.23 1.28-1.05 1.07-1.85z"></path></g>
<g id="flip-to-back"><path d="M9 7H7v2h2V7zm0 4H7v2h2v-2zm0-8c-1.11 0-2 .9-2 2h2V3zm4 12h-2v2h2v-2zm6-12v2h2c0-1.1-.9-2-2-2zm-6 0h-2v2h2V3zM9 17v-2H7c0 1.1.89 2 2 2zm10-4h2v-2h-2v2zm0-4h2V7h-2v2zm0 8c1.1 0 2-.9 2-2h-2v2zM5 7H3v12c0 1.1.89 2 2 2h12v-2H5V7zm10-2h2V3h-2v2zm0 12h2v-2h-2v2z"></path></g>
<g id="flip-to-front"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"></path></g>
<g id="folder"><path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"></path></g>
<g id="folder-open"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"></path></g>
<g id="folder-shared"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-5 3c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm4 8h-8v-1c0-1.33 2.67-2 4-2s4 .67 4 2v1z"></path></g>
<g id="font-download"><path d="M9.93 13.5h4.14L12 7.98zM20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-4.05 16.5l-1.14-3H9.17l-1.12 3H5.96l5.11-13h1.86l5.11 13h-2.09z"></path></g>
<g id="forward"><path d="M12 8V4l8 8-8 8v-4H4V8z"></path></g>
<g id="fullscreen"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></g>
<g id="fullscreen-exit"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></g>
<g id="gavel"><path d="M1 21h12v2H1zM5.245 8.07l2.83-2.827 14.14 14.142-2.828 2.828zM12.317 1l5.657 5.656-2.83 2.83-5.654-5.66zM3.825 9.485l5.657 5.657-2.828 2.828-5.657-5.657z"></path></g>
<g id="gesture"><path d="M4.59 6.89c.7-.71 1.4-1.35 1.71-1.22.5.2 0 1.03-.3 1.52-.25.42-2.86 3.89-2.86 6.31 0 1.28.48 2.34 1.34 2.98.75.56 1.74.73 2.64.46 1.07-.31 1.95-1.4 3.06-2.77 1.21-1.49 2.83-3.44 4.08-3.44 1.63 0 1.65 1.01 1.76 1.79-3.78.64-5.38 3.67-5.38 5.37 0 1.7 1.44 3.09 3.21 3.09 1.63 0 4.29-1.33 4.69-6.1H21v-2.5h-2.47c-.15-1.65-1.09-4.2-4.03-4.2-2.25 0-4.18 1.91-4.94 2.84-.58.73-2.06 2.48-2.29 2.72-.25.3-.68.84-1.11.84-.45 0-.72-.83-.36-1.92.35-1.09 1.4-2.86 1.85-3.52.78-1.14 1.3-1.92 1.3-3.28C8.95 3.69 7.31 3 6.44 3 5.12 3 3.97 4 3.72 4.25c-.36.36-.66.66-.88.93l1.75 1.71zm9.29 11.66c-.31 0-.74-.26-.74-.72 0-.6.73-2.2 2.87-2.76-.3 2.69-1.43 3.48-2.13 3.48z"></path></g>
<g id="get-app"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path></g>
<g id="gif"><path d="M11.5 9H13v6h-1.5zM9 9H6c-.6 0-1 .5-1 1v4c0 .5.4 1 1 1h3c.6 0 1-.5 1-1v-2H8.5v1.5h-2v-3H10V10c0-.5-.4-1-1-1zm10 1.5V9h-4.5v6H16v-2h2v-1.5h-2v-1z"></path></g>
<g id="grade"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></g>
<g id="group-work"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM8 17.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zM9.5 8c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5S9.5 9.38 9.5 8zm6.5 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></g>
<g id="help"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"></path></g>
<g id="help-outline"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"></path></g>
<g id="highlight-off"><path d="M14.59 8L12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41 14.59 8zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></g>
<g id="history"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"></path></g>
<g id="home"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></g>
<g id="hourglass-empty"><path d="M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2H6zm10 14.5V20H8v-3.5l4-4 4 4zm-4-5l-4-4V4h8v3.5l-4 4z"></path></g>
<g id="hourglass-full"><path d="M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2H6z"></path></g>
<g id="http"><path d="M4.5 11h-2V9H1v6h1.5v-2.5h2V15H6V9H4.5v2zm2.5-.5h1.5V15H10v-4.5h1.5V9H7v1.5zm5.5 0H14V15h1.5v-4.5H17V9h-4.5v1.5zm9-1.5H18v6h1.5v-2h2c.8 0 1.5-.7 1.5-1.5v-1c0-.8-.7-1.5-1.5-1.5zm0 2.5h-2v-1h2v1z"></path></g>
<g id="https"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"></path></g>
<g id="important-devices"><path d="M23 11.01L18 11c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h5c.55 0 1-.45 1-1v-9c0-.55-.45-.99-1-.99zM23 20h-5v-7h5v7zM20 2H2C.89 2 0 2.89 0 4v12c0 1.1.89 2 2 2h7v2H7v2h8v-2h-2v-2h2v-2H2V4h18v5h2V4c0-1.11-.9-2-2-2zm-8.03 7L11 6l-.97 3H7l2.47 1.76-.94 2.91 2.47-1.8 2.47 1.8-.94-2.91L15 9h-3.03z"></path></g>
<g id="inbox"><path d="M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10z"></path></g>
<g id="indeterminate-check-box"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"></path></g>
<g id="info"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"></path></g>
<g id="info-outline"><path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"></path></g>
<g id="input"><path d="M21 3.01H3c-1.1 0-2 .9-2 2V9h2V4.99h18v14.03H3V15H1v4.01c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98v-14c0-1.11-.9-2-2-2zM11 16l4-4-4-4v3H1v2h10v3z"></path></g>
<g id="invert-colors"><path d="M17.66 7.93L12 2.27 6.34 7.93c-3.12 3.12-3.12 8.19 0 11.31C7.9 20.8 9.95 21.58 12 21.58c2.05 0 4.1-.78 5.66-2.34 3.12-3.12 3.12-8.19 0-11.31zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"></path></g>
<g id="label"><path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path></g>
<g id="label-outline"><path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16zM16 17H5V7h11l3.55 5L16 17z"></path></g>
<g id="language"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"></path></g>
<g id="launch"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></g>
<g id="lightbulb-outline"><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6C7.8 12.16 7 10.63 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"></path></g>
<g id="line-style"><path d="M3 16h5v-2H3v2zm6.5 0h5v-2h-5v2zm6.5 0h5v-2h-5v2zM3 20h2v-2H3v2zm4 0h2v-2H7v2zm4 0h2v-2h-2v2zm4 0h2v-2h-2v2zm4 0h2v-2h-2v2zM3 12h8v-2H3v2zm10 0h8v-2h-8v2zM3 4v4h18V4H3z"></path></g>
<g id="line-weight"><path d="M3 17h18v-2H3v2zm0 3h18v-1H3v1zm0-7h18v-3H3v3zm0-9v4h18V4H3z"></path></g>
<g id="link"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></g>
<g id="list"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"></path></g>
<g id="lock"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"></path></g>
<g id="lock-open"><path d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm0 12H6V10h12v10z"></path></g>
<g id="lock-outline"><path d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM8.9 6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2H8.9V6zM18 20H6V10h12v10z"></path></g>
<g id="loyalty"><path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7zm11.77 8.27L13 19.54l-4.27-4.27C8.28 14.81 8 14.19 8 13.5c0-1.38 1.12-2.5 2.5-2.5.69 0 1.32.28 1.77.74l.73.72.73-.73c.45-.45 1.08-.73 1.77-.73 1.38 0 2.5 1.12 2.5 2.5 0 .69-.28 1.32-.73 1.77z"></path></g>
<g id="mail"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path></g>
<g id="markunread"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path></g>
<g id="markunread-mailbox"><path d="M20 6H10v6H8V4h6V0H6v6H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2z"></path></g>
<g id="menu"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></g>
<g id="more-horiz"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></g>
<g id="more-vert"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></g>
<g id="motorcycle"><path d="M19.44 9.03L15.41 5H11v2h3.59l2 2H5c-2.8 0-5 2.2-5 5s2.2 5 5 5c2.46 0 4.45-1.69 4.9-4h1.65l2.77-2.77c-.21.54-.32 1.14-.32 1.77 0 2.8 2.2 5 5 5s5-2.2 5-5c0-2.65-1.97-4.77-4.56-4.97zM7.82 15C7.4 16.15 6.28 17 5 17c-1.63 0-3-1.37-3-3s1.37-3 3-3c1.28 0 2.4.85 2.82 2H5v2h2.82zM19 17c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"></path></g>
<g id="move-to-inbox"><path d="M19 3H4.99c-1.11 0-1.98.9-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10zm-3-5h-2V7h-4v3H8l4 4 4-4z"></path></g>
<g id="next-week"><path d="M20 7h-4V5c0-.55-.22-1.05-.59-1.41C15.05 3.22 14.55 3 14 3h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM10 5h4v2h-4V5zm1 13.5l-1-1 3-3-3-3 1-1 4 4-4 4z"></path></g>
<g id="note-add"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 14h-3v3h-2v-3H8v-2h3v-3h2v3h3v2zm-3-7V3.5L18.5 9H13z"></path></g>
<g id="offline-pin"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm5 16H7v-2h10v2zm-6.7-4L7 10.7l1.4-1.4 1.9 1.9 5.3-5.3L17 7.3 10.3 14z"></path></g>
<g id="opacity"><path d="M17.66 8L12 2.35 6.34 8C4.78 9.56 4 11.64 4 13.64s.78 4.11 2.34 5.67 3.61 2.35 5.66 2.35 4.1-.79 5.66-2.35S20 15.64 20 13.64 19.22 9.56 17.66 8zM6 14c.01-2 .62-3.27 1.76-4.4L12 5.27l4.24 4.38C17.38 10.77 17.99 12 18 14H6z"></path></g>
<g id="open-in-browser"><path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"></path></g>
<g id="open-in-new"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></g>
<g id="open-with"><path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"></path></g>
<g id="pageview"><path d="M11.5 9C10.12 9 9 10.12 9 11.5s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5S12.88 9 11.5 9zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-3.21 14.21l-2.91-2.91c-.69.44-1.51.7-2.39.7C9.01 16 7 13.99 7 11.5S9.01 7 11.5 7 16 9.01 16 11.5c0 .88-.26 1.69-.7 2.39l2.91 2.9-1.42 1.42z"></path></g>
<g id="pan-tool"><path d="M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29.22 0 .42.06.6.16.04.01 4.31 2.46 4.31 2.46V4c0-.83.67-1.5 1.5-1.5S11 3.17 11 4v7h1V1.5c0-.83.67-1.5 1.5-1.5S15 .67 15 1.5V11h1V2.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V11h1V5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5z"></path></g>
<g id="payment"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"></path></g>
<g id="perm-camera-mic"><path d="M20 5h-3.17L15 3H9L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7v-2.09c-2.83-.48-5-2.94-5-5.91h2c0 2.21 1.79 4 4 4s4-1.79 4-4h2c0 2.97-2.17 5.43-5 5.91V21h7c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-6 8c0 1.1-.9 2-2 2s-2-.9-2-2V9c0-1.1.9-2 2-2s2 .9 2 2v4z"></path></g>
<g id="perm-contact-calendar"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H6v-1c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1z"></path></g>
<g id="perm-data-setting"><path d="M18.99 11.5c.34 0 .67.03 1 .07L20 0 0 20h11.56c-.04-.33-.07-.66-.07-1 0-4.14 3.36-7.5 7.5-7.5zm3.71 7.99c.02-.16.04-.32.04-.49 0-.17-.01-.33-.04-.49l1.06-.83c.09-.08.12-.21.06-.32l-1-1.73c-.06-.11-.19-.15-.31-.11l-1.24.5c-.26-.2-.54-.37-.85-.49l-.19-1.32c-.01-.12-.12-.21-.24-.21h-2c-.12 0-.23.09-.25.21l-.19 1.32c-.3.13-.59.29-.85.49l-1.24-.5c-.11-.04-.24 0-.31.11l-1 1.73c-.06.11-.04.24.06.32l1.06.83c-.02.16-.03.32-.03.49 0 .17.01.33.03.49l-1.06.83c-.09.08-.12.21-.06.32l1 1.73c.06.11.19.15.31.11l1.24-.5c.26.2.54.37.85.49l.19 1.32c.02.12.12.21.25.21h2c.12 0 .23-.09.25-.21l.19-1.32c.3-.13.59-.29.84-.49l1.25.5c.11.04.24 0 .31-.11l1-1.73c.06-.11.03-.24-.06-.32l-1.07-.83zm-3.71 1.01c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"></path></g>
<g id="perm-device-information"><path d="M13 7h-2v2h2V7zm0 4h-2v6h2v-6zm4-9.99L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"></path></g>
<g id="perm-identity"><path d="M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4z"></path></g>
<g id="perm-media"><path d="M2 6H0v5h.01L0 20c0 1.1.9 2 2 2h18v-2H2V6zm20-2h-8l-2-2H6c-1.1 0-1.99.9-1.99 2L4 16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7 15l4.5-6 3.5 4.51 2.5-3.01L21 15H7z"></path></g>
<g id="perm-phone-msg"><path d="M20 15.5c-1.25 0-2.45-.2-3.57-.57-.35-.11-.74-.03-1.02.24l-2.2 2.2c-2.83-1.44-5.15-3.75-6.59-6.58l2.2-2.21c.28-.27.36-.66.25-1.01C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1zM12 3v10l3-3h6V3h-9z"></path></g>
<g id="perm-scan-wifi"><path d="M12 3C6.95 3 3.15 4.85 0 7.23L12 22 24 7.25C20.85 4.87 17.05 3 12 3zm1 13h-2v-6h2v6zm-2-8V6h2v2h-2z"></path></g>
<g id="pets"><circle cx="4.5" cy="9.5" r="2.5"></circle><circle cx="9" cy="5.5" r="2.5"></circle><circle cx="15" cy="5.5" r="2.5"></circle><circle cx="19.5" cy="9.5" r="2.5"></circle><path d="M17.34 14.86c-.87-1.02-1.6-1.89-2.48-2.91-.46-.54-1.05-1.08-1.75-1.32-.11-.04-.22-.07-.33-.09-.25-.04-.52-.04-.78-.04s-.53 0-.79.05c-.11.02-.22.05-.33.09-.7.24-1.28.78-1.75 1.32-.87 1.02-1.6 1.89-2.48 2.91-1.31 1.31-2.92 2.76-2.62 4.79.29 1.02 1.02 2.03 2.33 2.32.73.15 3.06-.44 5.54-.44h.18c2.48 0 4.81.58 5.54.44 1.31-.29 2.04-1.31 2.33-2.32.31-2.04-1.3-3.49-2.61-4.8z"></path></g>
<g id="picture-in-picture"><path d="M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2zm0 16.01H3V4.98h18v14.03z"></path></g>
<g id="picture-in-picture-alt"><path d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"></path></g>
<g id="play-for-work"><path d="M11 5v5.59H7.5l4.5 4.5 4.5-4.5H13V5h-2zm-5 9c0 3.31 2.69 6 6 6s6-2.69 6-6h-2c0 2.21-1.79 4-4 4s-4-1.79-4-4H6z"></path></g>
<g id="polymer"><path d="M19 4h-4L7.11 16.63 4.5 12 9 4H5L.5 12 5 20h4l7.89-12.63L19.5 12 15 20h4l4.5-8z"></path></g>
<g id="power-settings-new"><path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"></path></g>
<g id="pregnant-woman"><path d="M9 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm7 9c-.01-1.34-.83-2.51-2-3 0-1.66-1.34-3-3-3s-3 1.34-3 3v7h2v5h3v-5h3v-4z"></path></g>
<g id="print"><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"></path></g>
<g id="query-builder"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"></path></g>
<g id="question-answer"><path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"></path></g>
<g id="radio-button-checked"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></g>
<g id="radio-button-unchecked"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></g>
<g id="receipt"><path d="M18 17H6v-2h12v2zm0-4H6v-2h12v2zm0-4H6V7h12v2zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2v20z"></path></g>
<g id="record-voice-over"><circle cx="9" cy="9" r="4"></circle><path d="M9 15c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4zm7.76-9.64l-1.68 1.69c.84 1.18.84 2.71 0 3.89l1.68 1.69c2.02-2.02 2.02-5.07 0-7.27zM20.07 2l-1.63 1.63c2.77 3.02 2.77 7.56 0 10.74L20.07 16c3.9-3.89 3.91-9.95 0-14z"></path></g>
<g id="redeem"><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"></path></g>
<g id="redo"><path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"></path></g>
<g id="refresh"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path></g>
<g id="remove"><path d="M19 13H5v-2h14v2z"></path></g>
<g id="remove-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"></path></g>
<g id="remove-circle-outline"><path d="M7 11v2h10v-2H7zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></g>
<g id="reorder"><path d="M3 15h18v-2H3v2zm0 4h18v-2H3v2zm0-8h18V9H3v2zm0-6v2h18V5H3z"></path></g>
<g id="reply"><path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"></path></g>
<g id="reply-all"><path d="M7 8V5l-7 7 7 7v-3l-4-4 4-4zm6 1V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"></path></g>
<g id="report"><path d="M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27L15.73 3zM12 17.3c-.72 0-1.3-.58-1.3-1.3 0-.72.58-1.3 1.3-1.3.72 0 1.3.58 1.3 1.3 0 .72-.58 1.3-1.3 1.3zm1-4.3h-2V7h2v6z"></path></g>
<g id="report-problem"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"></path></g>
<g id="restore"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"></path></g>
<g id="room"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></g>
<g id="rounded-corner"><path d="M19 19h2v2h-2v-2zm0-2h2v-2h-2v2zM3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm0-4h2V3H3v2zm4 0h2V3H7v2zm8 16h2v-2h-2v2zm-4 0h2v-2h-2v2zm4 0h2v-2h-2v2zm-8 0h2v-2H7v2zm-4 0h2v-2H3v2zM21 8c0-2.76-2.24-5-5-5h-5v2h5c1.65 0 3 1.35 3 3v5h2V8z"></path></g>
<g id="rowing"><path d="M8.5 14.5L4 19l1.5 1.5L9 17h2l-2.5-2.5zM15 1c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 20.01L18 24l-2.99-3.01V19.5l-7.1-7.09c-.31.05-.61.07-.91.07v-2.16c1.66.03 3.61-.87 4.67-2.04l1.4-1.55c.19-.21.43-.38.69-.5.29-.14.62-.23.96-.23h.03C15.99 6.01 17 7.02 17 8.26v5.75c0 .84-.35 1.61-.92 2.16l-3.58-3.58v-2.27c-.63.52-1.43 1.02-2.29 1.39L16.5 18H18l3 3.01z"></path></g>
<g id="save"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"></path></g>
<g id="schedule"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"></path></g>
<g id="search"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></g>
<g id="select-all"><path d="M3 5h2V3c-1.1 0-2 .9-2 2zm0 8h2v-2H3v2zm4 8h2v-2H7v2zM3 9h2V7H3v2zm10-6h-2v2h2V3zm6 0v2h2c0-1.1-.9-2-2-2zM5 21v-2H3c0 1.1.9 2 2 2zm-2-4h2v-2H3v2zM9 3H7v2h2V3zm2 18h2v-2h-2v2zm8-8h2v-2h-2v2zm0 8c1.1 0 2-.9 2-2h-2v2zm0-12h2V7h-2v2zm0 8h2v-2h-2v2zm-4 4h2v-2h-2v2zm0-16h2V3h-2v2zM7 17h10V7H7v10zm2-8h6v6H9V9z"></path></g>
<g id="send"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></g>
<g id="settings"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"></path></g>
<g id="settings-applications"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm7-7H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-1.75 9c0 .23-.02.46-.05.68l1.48 1.16c.13.11.17.3.08.45l-1.4 2.42c-.09.15-.27.21-.43.15l-1.74-.7c-.36.28-.76.51-1.18.69l-.26 1.85c-.03.17-.18.3-.35.3h-2.8c-.17 0-.32-.13-.35-.29l-.26-1.85c-.43-.18-.82-.41-1.18-.69l-1.74.7c-.16.06-.34 0-.43-.15l-1.4-2.42c-.09-.15-.05-.34.08-.45l1.48-1.16c-.03-.23-.05-.46-.05-.69 0-.23.02-.46.05-.68l-1.48-1.16c-.13-.11-.17-.3-.08-.45l1.4-2.42c.09-.15.27-.21.43-.15l1.74.7c.36-.28.76-.51 1.18-.69l.26-1.85c.03-.17.18-.3.35-.3h2.8c.17 0 .32.13.35.29l.26 1.85c.43.18.82.41 1.18.69l1.74-.7c.16-.06.34 0 .43.15l1.4 2.42c.09.15.05.34-.08.45l-1.48 1.16c.03.23.05.46.05.69z"></path></g>
<g id="settings-backup-restore"><path d="M14 12c0-1.1-.9-2-2-2s-2 .9-2 2 .9 2 2 2 2-.9 2-2zm-2-9c-4.97 0-9 4.03-9 9H0l4 4 4-4H5c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.51 0-2.91-.49-4.06-1.3l-1.42 1.44C8.04 20.3 9.94 21 12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9z"></path></g>
<g id="settings-bluetooth"><path d="M11 24h2v-2h-2v2zm-4 0h2v-2H7v2zm8 0h2v-2h-2v2zm2.71-18.29L12 0h-1v7.59L6.41 3 5 4.41 10.59 10 5 15.59 6.41 17 11 12.41V20h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 3.83l1.88 1.88L13 7.59V3.83zm1.88 10.46L13 16.17v-3.76l1.88 1.88z"></path></g>
<g id="settings-brightness"><path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16.01H3V4.99h18v14.02zM8 16h2.5l1.5 1.5 1.5-1.5H16v-2.5l1.5-1.5-1.5-1.5V8h-2.5L12 6.5 10.5 8H8v2.5L6.5 12 8 13.5V16zm4-7c1.66 0 3 1.34 3 3s-1.34 3-3 3V9z"></path></g>
<g id="settings-cell"><path d="M7 24h2v-2H7v2zm4 0h2v-2h-2v2zm4 0h2v-2h-2v2zM16 .01L8 0C6.9 0 6 .9 6 2v16c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V2c0-1.1-.9-1.99-2-1.99zM16 16H8V4h8v12z"></path></g>
<g id="settings-ethernet"><path d="M7.77 6.76L6.23 5.48.82 12l5.41 6.52 1.54-1.28L3.42 12l4.35-5.24zM7 13h2v-2H7v2zm10-2h-2v2h2v-2zm-6 2h2v-2h-2v2zm6.77-7.52l-1.54 1.28L20.58 12l-4.35 5.24 1.54 1.28L23.18 12l-5.41-6.52z"></path></g>
<g id="settings-input-antenna"><path d="M12 5c-3.87 0-7 3.13-7 7h2c0-2.76 2.24-5 5-5s5 2.24 5 5h2c0-3.87-3.13-7-7-7zm1 9.29c.88-.39 1.5-1.26 1.5-2.29 0-1.38-1.12-2.5-2.5-2.5S9.5 10.62 9.5 12c0 1.02.62 1.9 1.5 2.29v3.3L7.59 21 9 22.41l3-3 3 3L16.41 21 13 17.59v-3.3zM12 1C5.93 1 1 5.93 1 12h2c0-4.97 4.03-9 9-9s9 4.03 9 9h2c0-6.07-4.93-11-11-11z"></path></g>
<g id="settings-input-component"><path d="M5 2c0-.55-.45-1-1-1s-1 .45-1 1v4H1v6h6V6H5V2zm4 14c0 1.3.84 2.4 2 2.82V23h2v-4.18c1.16-.41 2-1.51 2-2.82v-2H9v2zm-8 0c0 1.3.84 2.4 2 2.82V23h2v-4.18C6.16 18.4 7 17.3 7 16v-2H1v2zM21 6V2c0-.55-.45-1-1-1s-1 .45-1 1v4h-2v6h6V6h-2zm-8-4c0-.55-.45-1-1-1s-1 .45-1 1v4H9v6h6V6h-2V2zm4 14c0 1.3.84 2.4 2 2.82V23h2v-4.18c1.16-.41 2-1.51 2-2.82v-2h-6v2z"></path></g>
<g id="settings-input-composite"><path d="M5 2c0-.55-.45-1-1-1s-1 .45-1 1v4H1v6h6V6H5V2zm4 14c0 1.3.84 2.4 2 2.82V23h2v-4.18c1.16-.41 2-1.51 2-2.82v-2H9v2zm-8 0c0 1.3.84 2.4 2 2.82V23h2v-4.18C6.16 18.4 7 17.3 7 16v-2H1v2zM21 6V2c0-.55-.45-1-1-1s-1 .45-1 1v4h-2v6h6V6h-2zm-8-4c0-.55-.45-1-1-1s-1 .45-1 1v4H9v6h6V6h-2V2zm4 14c0 1.3.84 2.4 2 2.82V23h2v-4.18c1.16-.41 2-1.51 2-2.82v-2h-6v2z"></path></g>
<g id="settings-input-hdmi"><path d="M18 7V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v3H5v6l3 6v3h8v-3l3-6V7h-1zM8 4h8v3h-2V5h-1v2h-2V5h-1v2H8V4z"></path></g>
<g id="settings-input-svideo"><path d="M8 11.5c0-.83-.67-1.5-1.5-1.5S5 10.67 5 11.5 5.67 13 6.5 13 8 12.33 8 11.5zm7-5c0-.83-.67-1.5-1.5-1.5h-3C9.67 5 9 5.67 9 6.5S9.67 8 10.5 8h3c.83 0 1.5-.67 1.5-1.5zM8.5 15c-.83 0-1.5.67-1.5 1.5S7.67 18 8.5 18s1.5-.67 1.5-1.5S9.33 15 8.5 15zM12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9zm5.5-11c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm-2 5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"></path></g>
<g id="settings-overscan"><path d="M12.01 5.5L10 8h4l-1.99-2.5zM18 10v4l2.5-1.99L18 10zM6 10l-2.5 2.01L6 14v-4zm8 6h-4l2.01 2.5L14 16zm7-13H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16.01H3V4.99h18v14.02z"></path></g>
<g id="settings-phone"><path d="M13 9h-2v2h2V9zm4 0h-2v2h2V9zm3 6.5c-1.25 0-2.45-.2-3.57-.57-.35-.11-.74-.03-1.02.24l-2.2 2.2c-2.83-1.44-5.15-3.75-6.59-6.58l2.2-2.21c.28-.27.36-.66.25-1.01C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1zM19 9v2h2V9h-2z"></path></g>
<g id="settings-power"><path d="M7 24h2v-2H7v2zm4 0h2v-2h-2v2zm2-22h-2v10h2V2zm3.56 2.44l-1.45 1.45C16.84 6.94 18 8.83 18 11c0 3.31-2.69 6-6 6s-6-2.69-6-6c0-2.17 1.16-4.06 2.88-5.12L7.44 4.44C5.36 5.88 4 8.28 4 11c0 4.42 3.58 8 8 8s8-3.58 8-8c0-2.72-1.36-5.12-3.44-6.56zM15 24h2v-2h-2v2z"></path></g>
<g id="settings-remote"><path d="M15 9H9c-.55 0-1 .45-1 1v12c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V10c0-.55-.45-1-1-1zm-3 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM7.05 6.05l1.41 1.41C9.37 6.56 10.62 6 12 6s2.63.56 3.54 1.46l1.41-1.41C15.68 4.78 13.93 4 12 4s-3.68.78-4.95 2.05zM12 0C8.96 0 6.21 1.23 4.22 3.22l1.41 1.41C7.26 3.01 9.51 2 12 2s4.74 1.01 6.36 2.64l1.41-1.41C17.79 1.23 15.04 0 12 0z"></path></g>
<g id="settings-voice"><path d="M7 24h2v-2H7v2zm5-11c1.66 0 2.99-1.34 2.99-3L15 4c0-1.66-1.34-3-3-3S9 2.34 9 4v6c0 1.66 1.34 3 3 3zm-1 11h2v-2h-2v2zm4 0h2v-2h-2v2zm4-14h-1.7c0 3-2.54 5.1-5.3 5.1S6.7 13 6.7 10H5c0 3.41 2.72 6.23 6 6.72V20h2v-3.28c3.28-.49 6-3.31 6-6.72z"></path></g>
<g id="shop"><path d="M16 6V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H2v13c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6h-6zm-6-2h4v2h-4V4zM9 18V9l7.5 4L9 18z"></path></g>
<g id="shop-two"><path d="M3 9H1v11c0 1.11.89 2 2 2h14c1.11 0 2-.89 2-2H3V9zm15-4V3c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H5v11c0 1.11.89 2 2 2h14c1.11 0 2-.89 2-2V5h-5zm-6-2h4v2h-4V3zm0 12V8l5.5 3-5.5 4z"></path></g>
<g id="shopping-basket"><path d="M17.21 9l-4.38-6.56c-.19-.28-.51-.42-.83-.42-.32 0-.64.14-.83.43L6.79 9H2c-.55 0-1 .45-1 1 0 .09.01.18.04.27l2.54 9.27c.23.84 1 1.46 1.92 1.46h13c.92 0 1.69-.62 1.93-1.46l2.54-9.27L23 10c0-.55-.45-1-1-1h-4.79zM9 9l3-4.4L15 9H9zm3 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"></path></g>
<g id="shopping-cart"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"></path></g>
<g id="sort"><path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"></path></g>
<g id="speaker-notes"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 14H6v-2h2v2zm0-3H6V9h2v2zm0-3H6V6h2v2zm7 6h-5v-2h5v2zm3-3h-8V9h8v2zm0-3h-8V6h8v2z"></path></g>
<g id="spellcheck"><path d="M12.45 16h2.09L9.43 3H7.57L2.46 16h2.09l1.12-3h5.64l1.14 3zm-6.02-5L8.5 5.48 10.57 11H6.43zm15.16.59l-8.09 8.09L9.83 16l-1.41 1.41 5.09 5.09L23 13l-1.41-1.41z"></path></g>
<g id="star"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></g>
<g id="star-border"><path d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"></path></g>
<g id="star-half"><path d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4V6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"></path></g>
<g id="stars"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm4.24 16L12 15.45 7.77 18l1.12-4.81-3.73-3.23 4.92-.42L12 5l1.92 4.53 4.92.42-3.73 3.23L16.23 18z"></path></g>
<g id="store"><path d="M20 4H4v2h16V4zm1 10v-2l-1-5H4l-1 5v2h1v6h10v-6h4v6h2v-6h1zm-9 4H6v-4h6v4z"></path></g>
<g id="subdirectory-arrow-left"><path d="M11 9l1.42 1.42L8.83 14H18V4h2v12H8.83l3.59 3.58L11 21l-6-6 6-6z"></path></g>
<g id="subdirectory-arrow-right"><path d="M19 15l-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9l6 6z"></path></g>
<g id="subject"><path d="M14 17H4v2h10v-2zm6-8H4v2h16V9zM4 15h16v-2H4v2zM4 5v2h16V5H4z"></path></g>
<g id="supervisor-account"><path d="M16.5 12c1.38 0 2.49-1.12 2.49-2.5S17.88 7 16.5 7C15.12 7 14 8.12 14 9.5s1.12 2.5 2.5 2.5zM9 11c1.66 0 2.99-1.34 2.99-3S10.66 5 9 5C7.34 5 6 6.34 6 8s1.34 3 3 3zm7.5 3c-1.83 0-5.5.92-5.5 2.75V19h11v-2.25c0-1.83-3.67-2.75-5.5-2.75zM9 13c-2.33 0-7 1.17-7 3.5V19h7v-2.25c0-.85.33-2.34 2.37-3.47C10.5 13.1 9.66 13 9 13z"></path></g>
<g id="swap-horiz"><path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"></path></g>
<g id="swap-vert"><path d="M16 17.01V10h-2v7.01h-3L15 21l4-3.99h-3zM9 3L5 6.99h3V14h2V6.99h3L9 3z"></path></g>
<g id="swap-vertical-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM6.5 9L10 5.5 13.5 9H11v4H9V9H6.5zm11 6L14 18.5 10.5 15H13v-4h2v4h2.5z"></path></g>
<g id="system-update-alt"><path d="M12 16.5l4-4h-3v-9h-2v9H8l4 4zm9-13h-6v1.99h6v14.03H3V5.49h6V3.5H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2v-14c0-1.1-.9-2-2-2z"></path></g>
<g id="tab"><path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h10v4h8v10z"></path></g>
<g id="tab-unselected"><path d="M1 9h2V7H1v2zm0 4h2v-2H1v2zm0-8h2V3c-1.1 0-2 .9-2 2zm8 16h2v-2H9v2zm-8-4h2v-2H1v2zm2 4v-2H1c0 1.1.9 2 2 2zM21 3h-8v6h10V5c0-1.1-.9-2-2-2zm0 14h2v-2h-2v2zM9 5h2V3H9v2zM5 21h2v-2H5v2zM5 5h2V3H5v2zm16 16c1.1 0 2-.9 2-2h-2v2zm0-8h2v-2h-2v2zm-8 8h2v-2h-2v2zm4 0h2v-2h-2v2z"></path></g>
<g id="text-format"><path d="M5 17v2h14v-2H5zm4.5-4.2h5l.9 2.2h2.1L12.75 4h-1.5L6.5 15h2.1l.9-2.2zM12 5.98L13.87 11h-3.74L12 5.98z"></path></g>
<g id="theaters"><path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"></path></g>
<g id="thumb-down"><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v1.91l.01.01L1 14c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"></path></g>
<g id="thumb-up"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z"></path></g>
<g id="thumbs-up-down"><path d="M12 6c0-.55-.45-1-1-1H5.82l.66-3.18.02-.23c0-.31-.13-.59-.33-.8L5.38 0 .44 4.94C.17 5.21 0 5.59 0 6v6.5c0 .83.67 1.5 1.5 1.5h6.75c.62 0 1.15-.38 1.38-.91l2.26-5.29c.07-.17.11-.36.11-.55V6zm10.5 4h-6.75c-.62 0-1.15.38-1.38.91l-2.26 5.29c-.07.17-.11.36-.11.55V18c0 .55.45 1 1 1h5.18l-.66 3.18-.02.24c0 .31.13.59.33.8l.79.78 4.94-4.94c.27-.27.44-.65.44-1.06v-6.5c0-.83-.67-1.5-1.5-1.5z"></path></g>
<g id="timeline"><path d="M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"></path></g>
<g id="toc"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"></path></g>
<g id="today"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"></path></g>
<g id="toll"><path d="M15 4c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zM3 12c0-2.61 1.67-4.83 4-5.65V4.26C3.55 5.15 1 8.27 1 12s2.55 6.85 6 7.74v-2.09c-2.33-.82-4-3.04-4-5.65z"></path></g>
<g id="touch-app"><path d="M9 11.24V7.5C9 6.12 10.12 5 11.5 5S14 6.12 14 7.5v3.74c1.21-.81 2-2.18 2-3.74C16 5.01 13.99 3 11.5 3S7 5.01 7 7.5c0 1.56.79 2.93 2 3.74zm9.84 4.63l-4.54-2.26c-.17-.07-.35-.11-.54-.11H13v-6c0-.83-.67-1.5-1.5-1.5S10 6.67 10 7.5v10.74l-3.43-.72c-.08-.01-.15-.03-.24-.03-.31 0-.59.13-.79.33l-.79.8 4.94 4.94c.27.27.65.44 1.06.44h6.79c.75 0 1.33-.55 1.44-1.28l.75-5.27c.01-.07.02-.14.02-.2 0-.62-.38-1.16-.91-1.38z"></path></g>
<g id="track-changes"><path d="M19.07 4.93l-1.41 1.41C19.1 7.79 20 9.79 20 12c0 4.42-3.58 8-8 8s-8-3.58-8-8c0-4.08 3.05-7.44 7-7.93v2.02C8.16 6.57 6 9.03 6 12c0 3.31 2.69 6 6 6s6-2.69 6-6c0-1.66-.67-3.16-1.76-4.24l-1.41 1.41C15.55 9.9 16 10.9 16 12c0 2.21-1.79 4-4 4s-4-1.79-4-4c0-1.86 1.28-3.41 3-3.86v2.14c-.6.35-1 .98-1 1.72 0 1.1.9 2 2 2s2-.9 2-2c0-.74-.4-1.38-1-1.72V2h-1C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-2.76-1.12-5.26-2.93-7.07z"></path></g>
<g id="translate"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></g>
<g id="trending-down"><path d="M16 18l2.29-2.29-4.88-4.88-4 4L2 7.41 3.41 6l6 6 4-4 6.3 6.29L22 12v6z"></path></g>
<g id="trending-flat"><path d="M22 12l-4-4v3H3v2h15v3z"></path></g>
<g id="trending-up"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"></path></g>
<g id="turned-in"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"></path></g>
<g id="turned-in-not"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"></path></g>
<g id="unarchive"><path d="M20.55 5.22l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.15.55L3.46 5.22C3.17 5.57 3 6.01 3 6.5V19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.49-.17-.93-.45-1.28zM12 9.5l5.5 5.5H14v2h-4v-2H6.5L12 9.5zM5.12 5l.82-1h12l.93 1H5.12z"></path></g>
<g id="undo"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"></path></g>
<g id="unfold-less"><path d="M7.41 18.59L8.83 20 12 16.83 15.17 20l1.41-1.41L12 14l-4.59 4.59zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10l4.59-4.59z"></path></g>
<g id="unfold-more"><path d="M12 5.83L15.17 9l1.41-1.41L12 3 7.41 7.59 8.83 9 12 5.83zm0 12.34L8.83 15l-1.41 1.41L12 21l4.59-4.59L15.17 15 12 18.17z"></path></g>
<g id="update"><path d="M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79 2.73 2.71 7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58 3.51-3.47 9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"></path></g>
<g id="verified-user"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"></path></g>
<g id="view-agenda"><path d="M20 13H3c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h17c.55 0 1-.45 1-1v-6c0-.55-.45-1-1-1zm0-10H3c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h17c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1z"></path></g>
<g id="view-array"><path d="M4 18h3V5H4v13zM18 5v13h3V5h-3zM8 18h9V5H8v13z"></path></g>
<g id="view-carousel"><path d="M7 19h10V4H7v15zm-5-2h4V6H2v11zM18 6v11h4V6h-4z"></path></g>
<g id="view-column"><path d="M10 18h5V5h-5v13zm-6 0h5V5H4v13zM16 5v13h5V5h-5z"></path></g>
<g id="view-day"><path d="M2 21h19v-3H2v3zM20 8H3c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h17c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zM2 3v3h19V3H2z"></path></g>
<g id="view-headline"><path d="M4 15h16v-2H4v2zm0 4h16v-2H4v2zm0-8h16V9H4v2zm0-6v2h16V5H4z"></path></g>
<g id="view-list"><path d="M4 14h4v-4H4v4zm0 5h4v-4H4v4zM4 9h4V5H4v4zm5 5h12v-4H9v4zm0 5h12v-4H9v4zM9 5v4h12V5H9z"></path></g>
<g id="view-module"><path d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z"></path></g>
<g id="view-quilt"><path d="M10 18h5v-6h-5v6zm-6 0h5V5H4v13zm12 0h5v-6h-5v6zM10 5v6h11V5H10z"></path></g>
<g id="view-stream"><path d="M4 18h17v-6H4v6zM4 5v6h17V5H4z"></path></g>
<g id="view-week"><path d="M6 5H3c-.55 0-1 .45-1 1v12c0 .55.45 1 1 1h3c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1zm14 0h-3c-.55 0-1 .45-1 1v12c0 .55.45 1 1 1h3c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1zm-7 0h-3c-.55 0-1 .45-1 1v12c0 .55.45 1 1 1h3c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1z"></path></g>
<g id="visibility"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></g>
<g id="visibility-off"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"></path></g>
<g id="warning"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"></path></g>
<g id="watch-later"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm4.2 14.2L11 13V7h1.5v5.2l4.5 2.7-.8 1.3z"></path></g>
<g id="weekend"><path d="M21 10c-1.1 0-2 .9-2 2v3H5v-3c0-1.1-.9-2-2-2s-2 .9-2 2v5c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2v-5c0-1.1-.9-2-2-2zm-3-5H6c-1.1 0-2 .9-2 2v2.15c1.16.41 2 1.51 2 2.82V14h12v-2.03c0-1.3.84-2.4 2-2.82V7c0-1.1-.9-2-2-2z"></path></g>
<g id="work"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"></path></g>
<g id="youtube-searched-for"><path d="M17.01 14h-.8l-.27-.27c.98-1.14 1.57-2.61 1.57-4.23 0-3.59-2.91-6.5-6.5-6.5s-6.5 3-6.5 6.5H2l3.84 4 4.16-4H6.51C6.51 7 8.53 5 11.01 5s4.5 2.01 4.5 4.5c0 2.48-2.02 4.5-4.5 4.5-.65 0-1.26-.14-1.82-.38L7.71 15.1c.97.57 2.09.9 3.3.9 1.61 0 3.08-.59 4.22-1.57l.27.27v.79l5.01 4.99L22 19l-4.99-5z"></path></g>
<g id="zoom-in"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14zm2.5-4h-2v2H9v-2H7V9h2V7h1v2h2v1z"></path></g>
<g id="zoom-out"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14zM7 9h5v1H7z"></path></g>
</defs></svg>
</iron-iconset-svg>


<iron-iconset-svg name="ibm" size="32">
 


<svg version="1.1" id="access-password-key" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M25,1L12.611,13.388C11.785,13.138,10.908,13,10,13c-4.971,0-9,4.029-9,9s4.029,9,9,9s9-4.029,9-9
		c0-0.909-0.138-1.785-0.389-2.612L21,17v-2h2l8-8V1H25z M29,6.171L22.172,13H21h-2v2v1.171l-1.803,1.802l-0.848,0.848l0.348,1.147
		C16.898,20.63,17,21.313,17,22c0,3.86-3.141,7-7,7s-7-3.14-7-7s3.141-7,7-7c0.686,0,1.37,0.102,2.031,0.302l1.146,0.348
		l0.848-0.848L25.828,3H29V6.171z"></path>
	<circle cx="8" cy="24" r="2"></circle>
	<rect x="19.757" y="7.5" transform="matrix(-0.7071 0.7071 -0.7071 -0.7071 46.6274 -3.3137)" width="8.485" height="1"></rect>
</g>
</svg>


<svg version="1.1" id="activity" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="21,14.414 25.293,18.707 26.707,17.293 21,11.586 11,21.586 6.707,17.293 5.293,18.707 11,24.414 	"></polygon>
	<path d="M1,4v4v20h30V8V4H1z M29,26H3V10h26V26z"></path>
</g>
</svg>

<svg version="1.1" id="add-new" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="17,9 15,9 15,15 9,15 9,17 15,17 15,23 17,23 17,17 23,17 23,15 17,15 	"></polygon>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>


<svg version="1.1" id="admin" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,21c5.523,0,10-4.477,10-10S21.523,1,16,1S6,5.477,6,11S10.477,21,16,21z M16,3c4.411,0,8,3.589,8,8s-3.589,8-8,8
		s-8-3.589-8-8S11.589,3,16,3z"></path>
	<path d="M24,23H8c-2.209,0-4,1.791-4,4v4h24v-4C28,24.791,26.209,23,24,23z"></path>
	<polygon points="21.207,8.707 19.793,7.293 14.5,12.586 12.207,10.293 10.793,11.707 14.5,15.414 	"></polygon>
</g>
</svg>


<svg version="1.1" id="aligncenter" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="5" y="6" width="22" height="2"></rect>
	<rect x="9" y="12" width="14" height="2"></rect>
	<rect x="3" y="18" width="26" height="2"></rect>
	<rect x="9" y="24" width="14" height="2"></rect>
</g>
</svg>


<svg version="1.1" id="alignleft" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="1" y="6" width="22" height="2"></rect>
	<rect x="1" y="12" width="14" height="2"></rect>
	<rect x="1" y="18" width="26" height="2"></rect>
	<rect x="1" y="24" width="14" height="2"></rect>
</g>
</svg>


<svg version="1.1" id="alignright" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="9" y="6" width="22" height="2"></rect>
	<rect x="17" y="12" width="14" height="2"></rect>
	<rect x="5" y="18" width="26" height="2"></rect>
	<rect x="17" y="24" width="14" height="2"></rect>
</g>
</svg>


<svg version="1.1" id="api" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M14.16,15.715c-0.107,0-0.179-0.03-0.215-0.09c-0.037-0.06-0.055-0.16-0.055-0.3v-2.66c0-0.274-0.06-0.505-0.18-0.695
		c-0.12-0.19-0.278-0.345-0.475-0.465c-0.197-0.12-0.419-0.207-0.665-0.26c-0.247-0.053-0.497-0.08-0.75-0.08
		c-0.287,0-0.566,0.027-0.84,0.08c-0.273,0.053-0.519,0.146-0.735,0.28c-0.217,0.134-0.395,0.31-0.535,0.53
		c-0.14,0.22-0.22,0.497-0.24,0.83h1.14c0.027-0.28,0.143-0.487,0.35-0.62c0.207-0.133,0.47-0.2,0.79-0.2
		c0.113,0,0.233,0.009,0.36,0.025c0.126,0.017,0.242,0.05,0.345,0.1c0.103,0.05,0.19,0.122,0.26,0.215
		c0.07,0.093,0.105,0.213,0.105,0.36c0,0.167-0.042,0.292-0.125,0.375c-0.083,0.083-0.197,0.145-0.34,0.185
		c-0.144,0.04-0.309,0.068-0.495,0.085c-0.187,0.017-0.383,0.045-0.59,0.085c-0.24,0.027-0.479,0.065-0.715,0.115
		c-0.237,0.05-0.45,0.132-0.64,0.245c-0.19,0.114-0.344,0.27-0.46,0.47c-0.117,0.2-0.175,0.46-0.175,0.78
		c0,0.253,0.048,0.475,0.145,0.665c0.097,0.19,0.227,0.347,0.39,0.47c0.163,0.124,0.352,0.217,0.565,0.28
		c0.213,0.063,0.436,0.095,0.67,0.095c0.307,0,0.625-0.05,0.955-0.15c0.33-0.1,0.608-0.26,0.835-0.48
		c0.047,0.234,0.147,0.397,0.3,0.49c0.153,0.093,0.346,0.14,0.58,0.14c0.047,0,0.104-0.003,0.17-0.01
		c0.066-0.007,0.133-0.017,0.2-0.03c0.067-0.014,0.132-0.028,0.195-0.045c0.063-0.017,0.115-0.032,0.155-0.045v-0.79
		c-0.06,0.013-0.113,0.02-0.16,0.02C14.233,15.715,14.193,15.715,14.16,15.715z M12.75,14.734c0,0.18-0.043,0.332-0.13,0.455
		c-0.087,0.123-0.195,0.225-0.325,0.305c-0.13,0.08-0.269,0.137-0.415,0.17c-0.146,0.034-0.283,0.05-0.41,0.05
		c-0.1,0-0.211-0.01-0.335-0.03c-0.123-0.02-0.236-0.055-0.34-0.105s-0.192-0.118-0.265-0.205c-0.073-0.086-0.11-0.193-0.11-0.32
		c0-0.146,0.025-0.271,0.075-0.375c0.05-0.104,0.118-0.186,0.205-0.25c0.086-0.063,0.186-0.113,0.3-0.15
		c0.113-0.037,0.23-0.065,0.35-0.085c0.253-0.047,0.506-0.082,0.76-0.105c0.253-0.023,0.467-0.092,0.64-0.205V14.734z"></path>
	<path d="M19.67,11.97c-0.2-0.25-0.452-0.447-0.755-0.59c-0.303-0.143-0.659-0.215-1.065-0.215c-0.333,0-0.644,0.065-0.93,0.195
		c-0.287,0.13-0.51,0.345-0.67,0.645h-0.02v-0.7h-1.08v7.08h1.14v-2.58h0.02c0.086,0.14,0.195,0.262,0.325,0.365
		c0.13,0.104,0.271,0.189,0.425,0.255c0.153,0.066,0.313,0.115,0.48,0.145c0.166,0.03,0.333,0.045,0.5,0.045
		c0.38,0,0.71-0.075,0.99-0.225c0.28-0.15,0.512-0.35,0.695-0.6c0.183-0.25,0.32-0.538,0.41-0.865
		c0.09-0.327,0.135-0.664,0.135-1.01c0-0.38-0.05-0.736-0.15-1.07S19.87,12.22,19.67,11.97z M19.055,14.56
		c-0.05,0.217-0.134,0.41-0.25,0.58c-0.117,0.17-0.265,0.309-0.445,0.415c-0.18,0.106-0.4,0.16-0.66,0.16
		c-0.233,0-0.438-0.047-0.615-0.14c-0.177-0.093-0.329-0.22-0.455-0.38c-0.126-0.16-0.222-0.352-0.285-0.575
		c-0.063-0.223-0.095-0.465-0.095-0.725c0-0.553,0.122-0.997,0.365-1.33c0.243-0.333,0.605-0.5,1.085-0.5
		c0.233,0,0.44,0.052,0.62,0.155c0.18,0.104,0.33,0.24,0.45,0.41c0.12,0.17,0.21,0.365,0.27,0.585c0.06,0.22,0.09,0.446,0.09,0.68
		C19.13,14.121,19.105,14.343,19.055,14.56z"></path>
	<rect x="21.26" y="9.334" width="1.14" height="1.08"></rect>
	<rect x="21.26" y="11.305" width="1.14" height="5.17"></rect>
	<path d="M3,3v22v4h26v-4V3H3z M5,5h22v18H5V5z"></path>
</g>
</svg>


<svg version="1.1" id="applications" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M25.192,16.192l-1.414-1.414c-0.938,0.938-2.029,1.677-3.242,2.221l-2.32-6.671C19.291,9.61,20,8.389,20,7
	c0-1.861-1.278-3.412-3-3.858V1h-2v2.142C13.278,3.588,12,5.139,12,7c0,1.389,0.709,2.61,1.784,3.328L7.056,29.671l1.889,0.657
	l3.747-10.773c1.082,0.283,2.195,0.428,3.309,0.428c1.114,0,2.227-0.145,3.309-0.428l3.747,10.773l1.889-0.657l-3.75-10.783
	C22.692,18.239,24.04,17.345,25.192,16.192z M16,6c0.552,0,1,0.448,1,1s-0.448,1-1,1c-0.552,0-1-0.448-1-1S15.448,6,16,6z
	 M13.351,17.66l2.328-6.692C15.787,10.977,15.89,11,16,11c0.11,0,0.213-0.023,0.321-0.032l2.328,6.692
	C16.913,18.089,15.087,18.089,13.351,17.66z"></path>
</svg>


<svg version="1.1" id="archive-storage" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="13" y="14" width="6" height="2"></rect>
	<path d="M1,5v5h2v16v1h6v-1h14v1h6v-1V10h2V5H1z M5,24V12h22v12H5z"></path>
</g>
</svg>


<svg version="1.1" id="assets" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M29,24L28.963,3H3v21h9v3.015l-2,0.003V29h12v-2l-2,0.003V24H29z M5,5h22v15H5V5z"></path>
</svg>


<svg version="1.1" id="attachment" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M8.003,30c-1.876,0-3.639-0.753-4.963-2.12c-2.711-2.801-2.711-7.358,0-10.16L15.62,4.726C17.321,2.968,19.586,2,21.997,2
	c2.411,0,4.676,0.968,6.377,2.726c3.491,3.606,3.492,9.475,0.001,13.082L18.128,28.392L16.692,27l10.247-10.583
	c2.748-2.839,2.748-7.46-0.001-10.3C25.616,4.752,23.861,4,21.997,4c-1.864,0-3.619,0.752-4.941,2.117L4.477,19.111
	c-1.968,2.034-1.969,5.344,0,7.377C5.42,27.463,6.673,28,8.003,28c1.33,0,2.582-0.537,3.525-1.511l9.409-9.719
	c1.189-1.228,1.188-3.226,0-4.453c-1.131-1.168-3.09-1.169-4.222-0.001L9.64,19.624l-1.437-1.392l7.074-7.307
	c0.945-0.977,2.206-1.515,3.547-1.515c1.342,0,2.602,0.538,3.548,1.515c1.931,1.995,1.932,5.24,0,7.235l-9.408,9.718
	C11.642,29.247,9.879,30,8.003,30z"></path>
</svg>


<svg version="1.1" id="availability" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<rect x="4.9" y="5.2" width="8" height="4"></rect>
		<path d="M11.9,6.2v2h-6v-2H11.9 M13.9,4.2h-10v6h10V4.2L13.9,4.2z"></path>
	</g>
	<rect x="7" y="12.7" width="18" height="6"></rect>
	<rect x="16.1" y="21.2" width="12" height="6"></rect>
	<rect x="1" y="3.5" width="1" height="25"></rect>
	<rect x="30" y="3.5" width="1" height="25"></rect>
</g>
</svg>


<svg version="1.1" id="audio-sound" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M5,1v30h22V1H5z M25,29H7V3h18V29z"></path>
	<path d="M16,27c3.866,0,7-3.134,7-7c0-3.865-3.134-7-7-7s-7,3.135-7,7C9,23.866,12.134,27,16,27z M16,18c1.104,0,2,0.896,2,2
		s-0.896,2-2,2s-2-0.896-2-2S14.896,18,16,18z"></path>
	<circle cx="16" cy="8" r="2"></circle>
</g>
</svg>


<svg version="1.1" id="audio" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M5,10v12h7l9,9V1l-9,9H5z M10,20H7v-8h3V20z"></path>
	<path d="M22,13v6c1.654,0,3-1.346,3-3S23.654,13,22,13z"></path>
</g>
</svg>


<svg version="1.1" id="backward" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve">
<g>
	<polygon points="15.3,9.3 8.6,16 15.3,22.7 16.7,21.3 12.4,17 24,17 24,15 12.4,15 16.7,10.7 	"></polygon>
	<path d="M2,16c0,7.7,6.3,14,14,14s14-6.3,14-14S23.7,2,16,2S2,8.3,2,16z M4,16C4,9.4,9.4,4,16,4s12,5.4,12,12s-5.4,12-12,12
		S4,22.6,4,16z"></path>
</g>
</svg>

<svg version="1.1" id="back-left-previous" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
	<polygon points="16.707,10.707 15.293,9.293 8.586,16 15.293,22.707 16.707,21.293 12.414,17 24,17 24,15 12.414,15 	"></polygon>
</g>
</svg>


<svg version="1.1" id="barchart" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="2,26 2,5 1,5 1,26 1,27 2,27 31,27 31,26 	"></polygon>
	<rect x="4" y="16" width="7" height="8"></rect>
	<path d="M20,8h-7v16h7V8z M18,22h-3V10h3V22z"></path>
	<rect x="22" y="13" width="7" height="1"></rect>
	<rect x="22" y="15" width="7" height="1"></rect>
	<rect x="22" y="17" width="7" height="1"></rect>
	<rect x="22" y="19" width="7" height="1"></rect>
	<rect x="22" y="21" width="7" height="1"></rect>
	<rect x="22" y="23" width="7" height="1"></rect>
</g>
</svg>


<svg version="1.1" id="bee" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M11.843,14h8.313c-0.896-1.205-2.423-2-4.157-2C14.266,12,12.74,12.795,11.843,14z"></path>
	<path d="M11.033,16C11.012,16.164,11,16.331,11,16.5V18h10v-1.5c0-0.169-0.012-0.336-0.033-0.5H11.033z"></path>
	<path d="M11,21.5c0,0.169,0.012,0.336,0.033,0.5h9.935C20.988,21.836,21,21.669,21,21.5V20H11V21.5z"></path>
	<path d="M16,26c1.734,0,3.26-0.795,4.157-2h-8.313C12.74,25.205,14.266,26,16,26z"></path>
	<path d="M3.23,15.049c-0.426,0.178-0.826,0.438-1.172,0.783c-0.347,0.347-0.606,0.746-0.783,1.172
		C1.092,17.446,0.999,17.916,1,18.387c-0.001,0.472,0.092,0.941,0.275,1.383c0.177,0.428,0.436,0.826,0.783,1.173
		c0.346,0.347,0.747,0.606,1.172,0.783C3.669,21.907,4.138,22,4.606,22c0.002,0,0.005,0,0.007,0c0.002,0,0.005,0,0.007,0
		c0.468,0,0.936-0.093,1.376-0.275c0.427-0.176,0.826-0.435,1.172-0.782c0.346-0.347,0.606-0.745,0.783-1.173L11,12L3.23,15.049z
		 M7.027,19.387c-0.132,0.319-0.323,0.606-0.566,0.849c-0.244,0.243-0.528,0.434-0.848,0.565C5.294,20.934,4.961,21,4.606,21
		c-0.341,0-0.675-0.066-0.991-0.197c-0.322-0.135-0.607-0.324-0.85-0.568c-0.243-0.242-0.433-0.527-0.565-0.848
		C2.067,19.067,1.999,18.73,2,18.386c-0.001-0.343,0.067-0.679,0.199-0.999c0.132-0.319,0.323-0.604,0.566-0.848
		c0.243-0.242,0.528-0.434,0.831-0.559l5.636-2.213L7.027,19.387z"></path>
	<path d="M30.725,17.004c-0.177-0.426-0.436-0.825-0.783-1.172c-0.346-0.346-0.747-0.605-1.172-0.783L21,12l3.049,7.77
		c0.177,0.428,0.437,0.826,0.783,1.173c0.346,0.347,0.745,0.606,1.172,0.782C26.444,21.907,26.912,22,27.379,22
		c0.002,0,0.005,0,0.007,0c0.002,0,0.005,0,0.007,0c0.468,0,0.937-0.093,1.376-0.274c0.425-0.177,0.826-0.436,1.172-0.783
		c0.347-0.347,0.606-0.745,0.783-1.173C30.908,19.328,31,18.858,31,18.387C31,17.916,30.908,17.446,30.725,17.004z M29.801,19.388
		c-0.132,0.319-0.323,0.605-0.566,0.849c-0.242,0.242-0.527,0.432-0.846,0.565C28.069,20.934,27.735,21,27.379,21
		c-0.34,0-0.674-0.066-0.994-0.199c-0.318-0.132-0.603-0.322-0.847-0.565c-0.244-0.243-0.434-0.529-0.56-0.831l-2.211-5.637
		l5.618,2.205c0.32,0.133,0.606,0.324,0.849,0.566c0.243,0.243,0.434,0.528,0.566,0.848c0.132,0.32,0.2,0.656,0.199,1.001
		C30,18.73,29.933,19.067,29.801,19.388z"></path>
	<path d="M13.5,11c1.104,0,2-0.894,2-2s-0.896-2-2-2c-1.105,0-2,0.894-2,2S12.395,11,13.5,11z M13.5,8c0.551,0,1,0.449,1,1
		s-0.449,1-1,1c-0.551,0-1-0.449-1-1S12.949,8,13.5,8z"></path>
	<path d="M18.5,11c1.104,0,2-0.894,2-2s-0.896-2-2-2c-1.105,0-2,0.894-2,2S17.395,11,18.5,11z M18.5,8c0.551,0,1,0.449,1,1
		s-0.449,1-1,1c-0.551,0-1-0.449-1-1S17.949,8,18.5,8z"></path>
</g>
</svg>


<svg version="1.1" id="blog" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="15,13 13,13 14,9 12,9 11,13 11,17 15,17 	"></polygon>
	<polygon points="21,13 19,13 20,9 18,9 17,13 17,17 21,17 	"></polygon>
	<path d="M3,3v19v1l6,6h1h19V3H3z M27,27H10v-5H5V5h22V27z"></path>
</g>
</svg>


<svg version="1.1" id="bold" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M23,16c2.126-1.248,4-3.335,4-5.849C27,6.26,24.168,3,20,3H5v26h15c4.168,0,7-3.26,7-7.151C27,19.335,25.126,17.248,23,16z
	 M15,27h-4V17h4c2.98,0,5,2.205,5,5.052C20,24.899,17.98,27,15,27z M15,15h-4V5h4c2.98,0,5,2.205,5,5.052C20,12.899,17.98,15,15,15z
	"></path>
</svg>


<svg version="1.1" id="booklet-guide" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M21,7L11,5L1,7v18v3v1l10-2l10,2l10-2v-1v-3V5L21,7z M20,24.8l-8-1.6V7.239l8,1.601V24.8z M3,8.64l7-1.399V23.2L3,24.6V8.64
	z M22,24.8V8.84l7-1.4V23.4L22,24.8z"></path>
</svg>


<svg version="1.1" id="bookmark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M8,1H4v30h4h20V1H8z M26,29H10V3h6v14l4-4l4,4V3h2V29z"></path>
</svg>

<svg version="1.1" id="bottom" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="6" y="27" width="20" height="4"></rect>
	<polygon points="24.707,13.707 23.293,12.293 17,18.587 17,2 15,2 15,18.585 8.707,12.293 7.293,13.707 16.001,22.414 	"></polygon>
</g>
</svg>

<svg version="1.1" id="buildings" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="10.9" y="5" width="3" height="3"></rect>
	<rect x="15.9" y="5" width="3" height="3"></rect>
	<rect x="21" y="5" width="3" height="3"></rect>
	<rect x="21" y="10" width="3" height="3"></rect>
	<rect x="21" y="15" width="3" height="3"></rect>
	<rect x="21" y="20" width="3" height="3"></rect>
	<path d="M6.9,1v9H4v21h15.1v-3H28V1H6.9z M10.3,28.5h-4v-4h4V28.5z M10.3,22.5h-4v-4h4V22.5z M10.3,16.5h-4v-4h4V16.5z M16.8,28.5
		h-4v-4h4V28.5z M16.8,22.5h-4v-4h4V22.5z M16.8,16.5h-4v-4h4V16.5z M26,26h-6.9V10H8.9V3H26V26z"></path>
</g>
</svg>


<svg version="1.1" id="bulletlist" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="8" y="6" width="23" height="2"></rect>
	<rect x="8" y="15" width="23" height="2"></rect>
	<rect x="8" y="24" width="23" height="2"></rect>
	<circle cx="3" cy="7" r="2"></circle>
	<circle cx="3" cy="16" r="2"></circle>
	<circle cx="3" cy="25" r="2"></circle>
</g>
</svg>


<svg version="1.1" id="calendar" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M17.461,19.279c-0.345,0.303-0.723,0.586-1.135,0.848c-0.412,0.266-0.807,0.535-1.187,0.816
		c-0.79,0.539-1.413,1.172-1.869,1.896c-0.457,0.729-0.692,1.58-0.702,2.557h7.983v-1.715h-5.695c0.078-0.26,0.222-0.5,0.436-0.73
		c0.209-0.23,0.458-0.451,0.74-0.664c0.286-0.213,0.594-0.426,0.928-0.639c0.335-0.213,0.669-0.438,1.004-0.672
		c0.333-0.234,0.657-0.488,0.97-0.76c0.311-0.27,0.588-0.563,0.832-0.881c0.246-0.318,0.441-0.668,0.586-1.049
		c0.146-0.381,0.217-0.809,0.217-1.279c0-0.379-0.062-0.781-0.183-1.201c-0.122-0.42-0.333-0.809-0.628-1.17
		c-0.294-0.357-0.681-0.654-1.16-0.891c-0.478-0.234-1.074-0.352-1.787-0.352c-0.656,0-1.232,0.115-1.728,0.344
		c-0.496,0.229-0.916,0.547-1.263,0.949c-0.345,0.404-0.604,0.883-0.775,1.438c-0.173,0.557-0.26,1.158-0.26,1.809h1.903
		c0.013-0.414,0.054-0.802,0.125-1.16c0.074-0.357,0.185-0.668,0.335-0.934c0.149-0.264,0.351-0.471,0.602-0.623
		c0.25-0.148,0.563-0.227,0.943-0.227c0.41,0,0.744,0.07,1.002,0.211c0.256,0.141,0.457,0.314,0.602,0.521s0.242,0.43,0.293,0.672
		c0.049,0.242,0.074,0.469,0.074,0.68c-0.012,0.459-0.127,0.865-0.352,1.218C18.091,18.648,17.809,18.977,17.461,19.279z"></path>
	<path d="M26,6V3.463c0-0.553-0.447-1-1-1s-1,0.447-1,1V6H8V3.463c0-0.553-0.447-1-1-1s-1,0.447-1,1V6H1v24h23.568L31,23.396V6H26z
		 M29,23h-5v5H3V11h26V23z"></path>
</g>
</svg>


<svg version="1.1" id="calendar-today" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<path d="M26,6V3.463c0-0.553-0.447-1-1-1s-1,0.447-1,1V6H8V3.463c0-0.553-0.447-1-1-1s-1,0.447-1,1V6H1v24h23.568L31,23.396V6H26z
			 M29,23h-5v5H3V11h26V23z"></path>
	</g>
	<polygon points="13.999,21.068 10.706,17.775 9.292,19.189 13.999,23.896 22.707,15.189 21.293,13.775 	"></polygon>
</g>
</svg>


<svg version="1.1" id="camera" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M11,6V4H5v2H1v20h30V6H11z M29,24H3V8h26V24z"></path>
	<path d="M21,22.5c3.592,0,6.5-2.908,6.5-6.5S24.592,9.5,21,9.5c-3.587,0-6.5,2.908-6.5,6.5S17.413,22.5,21,22.5z M21,10.5
		c3.033,0,5.5,2.467,5.5,5.5s-2.467,5.5-5.5,5.5c-3.033,0-5.5-2.467-5.5-5.5S17.967,10.5,21,10.5z"></path>
	<path d="M21,19.5c1.934,0,3.5-1.566,3.5-3.5s-1.566-3.5-3.5-3.5c-1.932,0-3.5,1.566-3.5,3.5S19.068,19.5,21,19.5z M21,15
		c0.552,0,1,0.447,1,1s-0.448,1-1,1c-0.552,0-1-0.447-1-1S20.448,15,21,15z"></path>
</g>
</svg>


<svg version="1.1" id="cart-checkout" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M25.414,12l-6.707-6.707l-1.414,1.414L22.586,12H9.414l5.293-5.293l-1.414-1.414L6.586,12H1v3h2l2,15h22l2-15h2v-3H25.414z
		 M25.249,28H6.751L5.284,17h21.432L25.249,28z"></path>
	<rect x="11" y="19" width="1" height="7"></rect>
	<rect x="14" y="19" width="1" height="7"></rect>
	<rect x="17" y="19" width="1" height="7"></rect>
	<rect x="20" y="19" width="1" height="7"></rect>
</g>
</svg>


<svg version="1.1" id="catalog" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M21,3c-2,0-4,1-5,2c-1-1-3-2-5-2H3v24h8c2,0,4,1,5,2c1-1,3-2,5-2h8V3H21z M16,26.484C14.657,25.649,12.869,25,11,25H5V5h6
	c1.359,0,2.891,0.719,3.586,1.414L16,7.829V26.484z M26,20h-7v-1h7V20z M26,17h-7v-1h7V17z M26,14h-7v-1h7V14z M26,11h-7v-1h7V11z"></path>
</svg>


<svg version="1.1" id="chat-im" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M24.484,4.515C22.313,2.343,19.313,1,16,1S9.686,2.343,7.516,4.515C5.344,6.687,4,9.686,4,13s1.344,6.313,3.516,8.485
		C9.686,23.657,12.686,25,16,25v6l8.484-9.016C26.656,19.685,28,16.508,28,13C28,9.686,26.656,6.687,24.484,4.515z M23.027,20.613
		L18,25.956V25v-2h-2c-2.671,0-5.182-1.04-7.07-2.93C7.041,18.182,6,15.671,6,13s1.041-5.182,2.93-7.071S13.329,3,16,3
		s5.182,1.04,7.07,2.93C24.959,7.818,26,10.329,26,13C26,15.881,24.945,18.583,23.027,20.613z"></path>
	<circle cx="16" cy="13" r="1.5"></circle>
	<circle cx="21" cy="13" r="1.5"></circle>
	<circle cx="11" cy="13" r="1.5"></circle>
</g>
</svg>


<svg version="1.1" id="client" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="19,5 17,6 21,12 17,12 4,12 4,15 17,15 17,16 1,16 1,19 17,19 17,20 4,20 4,23 17,23 17,24 7,24 7,27 17,27 23,27 
		31,25 31,12 	"></polygon>
</g>
</svg>


<svg version="1.1" id="clock-time" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,2C8.268,2,2,8.268,2,16s6.268,14,14,14c7.732,0,14-6.268,14-14S23.732,2,16,2z M16,28C9.383,28,4,22.617,4,16
		S9.383,4,16,4c6.617,0,12,5.383,12,12S22.617,28,16,28z"></path>
	<polygon points="22.646,8.646 16.353,14.939 12.707,11.293 11.293,12.707 14.939,16.354 13.646,17.646 14.353,18.354 15.646,17.06 
		17.293,18.707 18.707,17.293 17.06,15.646 23.353,9.354 	"></polygon>
</g>
</svg>

<svg version="1.1" id="close-cancel-error" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="20.293,10.293 16,14.586 11.707,10.293 10.293,11.707 14.586,16 10.293,20.293 11.707,21.707 16,17.414 
		20.293,21.707 21.707,20.293 17.414,16 21.707,11.707 	"></polygon>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>


<svg version="1.1" id="cloud" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M26.446,12.604C26.003,8.287,22.416,5,18,5c-4.162,0-7.691,3.083-8.374,7.086C9.253,12.029,8.877,12,8.5,12
	C4.364,12,1,15.364,1,19.5S4.364,27,8.5,27h15c4.136,0,7.5-3.364,7.5-7.5C31,16.464,29.196,13.773,26.446,12.604z M23.5,25h-15
	C5.467,25,3,22.533,3,19.5S5.467,14,8.5,14c0.575,0,1.146,0.092,1.699,0.271l1.277,0.416l0.032-1.344C11.592,9.846,14.504,7,18,7
	c3.552,0,6.403,2.784,6.491,6.338l0.017,0.711l0.676,0.217C27.466,14.999,29,17.103,29,19.5C29,22.533,26.533,25,23.5,25z"></path>
</svg>


<svg version="1.1" id="code" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="8.586,8.586 1.171,16 8.586,23.414 11.414,20.586 6.829,16 11.414,11.414 	"></polygon>
	<polygon points="23.414,8.586 20.586,11.414 25.171,16 20.586,20.586 23.414,23.414 30.829,16 	"></polygon>
</g>
</svg>


<svg version="1.1" id="collaborate-group" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M8,23c2.762,0,5-2.238,5-5s-2.238-5-5-5s-5,2.238-5,5S5.238,23,8,23z M8,15c1.654,0,3,1.346,3,3s-1.346,3-3,3s-3-1.346-3-3
		S6.346,15,8,15z"></path>
	<path d="M19,18c0,2.762,2.238,5,5,5s5-2.238,5-5s-2.238-5-5-5S19,15.238,19,18z M24,15c1.654,0,3,1.346,3,3s-1.346,3-3,3
		s-3-1.346-3-3S22.346,15,24,15z"></path>
	<path d="M21,7c0-2.762-2.238-5-5-5s-5,2.238-5,5s2.238,5,5,5S21,9.762,21,7z M16,10c-1.654,0-3-1.346-3-3s1.346-3,3-3s3,1.346,3,3
		S17.654,10,16,10z"></path>
	<path d="M12,25H4c-1.105,0-2,0.896-2,2v3h12v-3C14,25.896,13.104,25,12,25z"></path>
	<path d="M28,25h-8c-1.104,0-2,0.896-2,2v3h12v-3C30,25.896,29.104,25,28,25z"></path>
</g>
</svg>


<svg version="1.1" id="commandline-terminal" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="7.707,23.707 13.414,18 7.707,12.293 6.293,13.707 10.586,18 6.293,22.293 	"></polygon>
	<path d="M1,4v4v20h30V8V4H1z M29,26H3V10h26V26z"></path>
</g>
</svg>


<svg version="1.1" id="compass" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<g>
			<path d="M16,6C10.478,6,6,10.479,6,16c0,5.523,4.478,10,10,10c5.523,0,10-4.477,10-10C26,10.479,21.523,6,16,6z M18,18l-8,4l4-8
				l8-4L18,18z"></path>
		</g>
	</g>
	<g>
		<g>
			<path d="M16,2C8.268,2,2,8.268,2,16s6.268,14,14,14s14-6.268,14-14S23.732,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
				s12,5.383,12,12S22.617,28,16,28z"></path>
		</g>
	</g>
	<g>
		<circle cx="16" cy="16" r="1"></circle>
	</g>
</g>
</svg>


<svg version="1.1" id="compressed" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<path d="M3,3v22v4h26v-4V3H3z M5,5h22v18H5V5z"></path>
	</g>
	<g>
		<rect x="15" y="9" width="2" height="1"></rect>
	</g>
	<g>
		<rect x="15" y="7" width="2" height="1"></rect>
	</g>
	<g>
		<rect x="15" y="11" width="2" height="1"></rect>
	</g>
	<g>
		<rect x="15" y="13" width="2" height="1"></rect>
	</g>
	<g>
		<polygon points="15,15 14,19 14,21 18,21 18,19 17,15 		"></polygon>
	</g>
</g>
</svg>

<svg version="1.1" id="configure-manage" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M12.858,7C12.412,5.278,10.861,4,9,4S5.588,5.278,5.142,7H1v2h4.142C5.588,10.722,7.139,12,9,12s3.412-1.278,3.858-3H31V7
		H12.858z M9,9C8.448,9,8,8.552,8,8s0.448-1,1-1s1,0.448,1,1S9.552,9,9,9z"></path>
	<path d="M23,12c-1.861,0-3.412,1.278-3.858,3H1v2h18.142c0.446,1.722,1.997,3,3.858,3s3.412-1.278,3.858-3H31v-2h-4.142
		C26.412,13.278,24.861,12,23,12z M23,17c-0.552,0-1-0.448-1-1s0.448-1,1-1s1,0.448,1,1S23.552,17,23,17z"></path>
	<path d="M9,20c-1.861,0-3.412,1.278-3.858,3H1v2h4.142C5.588,26.722,7.139,28,9,28s3.412-1.278,3.858-3H31v-2H12.858
		C12.412,21.278,10.861,20,9,20z M9,25c-0.552,0-1-0.448-1-1s0.448-1,1-1s1,0.448,1,1S9.552,25,9,25z"></path>
</g>
</svg>


<svg version="1.1" id="copy" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M21,7V1H5v24h6v6h16V7H21z M11,23H7V3h12v4h-8V23z M25,29H13V9h12V29z"></path>
	<rect x="15" y="13" width="8" height="1"></rect>
	<rect x="15" y="15" width="8" height="1"></rect>
	<rect x="15" y="17" width="8" height="1"></rect>
	<rect x="15" y="19" width="4" height="1"></rect>
</g>
</svg>

<svg version="1.1" id="create-new" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="15,24 17,24 17,19 22,19 22,17 17,17 17,12 15,12 15,17 10,17 10,19 15,19 	"></polygon>
	<path d="M1,4v4v20h30V8V4H1z M29,26H3V10h26V26z"></path>
</g>
</svg>


<svg version="1.1" id="cut" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M27,13H17V8.858C18.722,8.412,20,6.861,20,5c0-2.209-1.791-4-4-4s-4,1.791-4,4c0,1.861,1.278,3.412,3,3.858V13
	c-1.106,0-2,0.895-2,2H8.858C8.412,13.278,6.861,12,5,12c-2.209,0-4,1.791-4,4s1.791,4,4,4c1.861,0,3.412-1.278,3.858-3H13v10l4,4
	V17h14L27,13z M5,18c-1.103,0-2-0.896-2-2s0.897-2,2-2s2,0.896,2,2S6.103,18,5,18z M15,16c-0.553,0-1-0.448-1-1s0.447-1,1-1
	c0.552,0,1,0.448,1,1S15.552,16,15,16z M16,7c-1.104,0-2-0.896-2-2s0.896-2,2-2s2,0.895,2,2S17.104,7,16,7z"></path>
</svg>


<svg version="1.1" id="dashboard" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M12.465,21.535C11.521,20.591,11,19.335,11,18c0-2.757,2.243-5,5-5s5,2.243,5,5c0,1.335-0.521,2.591-1.465,3.535
		l1.414,1.414C22.271,21.627,23,19.87,23,18c0-3.86-3.141-7-7-7s-7,3.14-7,7c0,1.87,0.729,3.627,2.051,4.949L12.465,21.535z"></path>
	<polygon points="15,25 17,25 16,16 	"></polygon>
	<path d="M1,4v4v20h30V8V4H1z M29,26H3V10h26V26z"></path>
</g>
</svg>


<svg version="1.1" id="data" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="1" y="9" width="2" height="14"></rect>
	<path d="M14.061,11.354c-0.365-0.685-0.875-1.25-1.529-1.692C11.877,9.221,11.033,9,10.001,9C8.967,9,8.123,9.221,7.47,9.663
		c-0.655,0.442-1.165,1.007-1.529,1.692c-0.365,0.687-0.613,1.44-0.744,2.26C5.065,14.436,5,15.231,5,16s0.065,1.564,0.196,2.384
		c0.131,0.821,0.379,1.574,0.744,2.26c0.364,0.687,0.874,1.25,1.529,1.692C8.123,22.779,8.967,23,10.001,23
		c1.032,0,1.876-0.221,2.53-0.664c0.654-0.442,1.164-1.006,1.529-1.692c0.364-0.685,0.612-1.439,0.743-2.26
		C14.936,17.564,15,16.769,15,16s-0.064-1.564-0.196-2.385C14.673,12.795,14.425,12.042,14.061,11.354z M12.521,18
		c-0.083,0.627-0.225,1.176-0.424,1.644c-0.199,0.468-0.471,0.84-0.816,1.115c-0.344,0.276-0.771,0.413-1.279,0.413
		c-0.524,0-0.956-0.138-1.292-0.413c-0.338-0.275-0.607-0.647-0.807-1.115c-0.2-0.468-0.341-1.017-0.423-1.644
		c-0.083-0.628-0.124-1.295-0.124-2c0-0.705,0.041-1.369,0.124-1.991c0.082-0.622,0.223-1.17,0.423-1.645
		c0.199-0.474,0.469-0.849,0.807-1.125c0.336-0.276,0.768-0.413,1.292-0.413c0.509,0,0.935,0.138,1.279,0.413
		c0.346,0.275,0.617,0.651,0.816,1.125c0.199,0.475,0.341,1.023,0.424,1.645c0.083,0.622,0.124,1.286,0.124,1.991
		C12.644,16.705,12.604,17.372,12.521,18z"></path>
	<path d="M30.804,13.615c-0.131-0.82-0.379-1.573-0.743-2.26c-0.365-0.685-0.875-1.25-1.529-1.692C27.877,9.221,27.033,9,26.001,9
		c-1.034,0-1.878,0.221-2.531,0.663c-0.655,0.442-1.165,1.007-1.529,1.692c-0.365,0.687-0.613,1.44-0.744,2.26
		C21.065,14.436,21,15.231,21,16s0.065,1.564,0.196,2.384c0.131,0.821,0.379,1.574,0.744,2.26c0.364,0.687,0.874,1.25,1.529,1.692
		C24.123,22.779,24.967,23,26.001,23c1.032,0,1.876-0.221,2.53-0.664c0.654-0.442,1.164-1.006,1.529-1.692
		c0.364-0.685,0.612-1.439,0.743-2.26C30.935,17.564,31,16.769,31,16S30.935,14.436,30.804,13.615z M28.521,18
		c-0.083,0.627-0.225,1.176-0.424,1.644c-0.199,0.468-0.471,0.84-0.816,1.115c-0.344,0.276-0.771,0.413-1.279,0.413
		c-0.524,0-0.956-0.138-1.292-0.413c-0.338-0.275-0.607-0.647-0.807-1.115c-0.2-0.468-0.341-1.017-0.423-1.644
		c-0.083-0.628-0.124-1.295-0.124-2c0-0.705,0.041-1.369,0.124-1.991c0.082-0.622,0.223-1.17,0.423-1.645
		c0.199-0.474,0.469-0.849,0.807-1.125c0.336-0.276,0.768-0.413,1.292-0.413c0.509,0,0.936,0.138,1.279,0.413
		c0.346,0.275,0.617,0.651,0.816,1.125c0.199,0.475,0.341,1.023,0.424,1.645c0.083,0.622,0.124,1.286,0.124,1.991
		C28.645,16.705,28.604,17.372,28.521,18z"></path>
	<rect x="17" y="9" width="2" height="14"></rect>
</g>
</svg>


<svg version="1.1" id="database-server" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M3,3v8v2v6v2v8h26v-8v-2v-6v-2V3H3z M27,27H5v-6h22V27z M27,19H5v-6h22V19z M24,7c0.552,0,1,0.448,1,1s-0.448,1-1,1
		s-1-0.448-1-1S23.448,7,24,7z"></path>
	<circle cx="24" cy="16" r="1"></circle>
	<circle cx="24" cy="24" r="1"></circle>
</g>
</svg>

<svg version="1.1" id="debug" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M31,15h-2.051C28.462,8.621,23.379,3.538,17,3.051V1h-2v2.051C8.621,3.538,3.538,8.621,3.051,15H1v2h2.051
	C3.538,23.379,8.621,28.462,15,28.949V31h2v-2.051c6.379-0.487,11.462-5.57,11.949-11.949H31V15z M26.949,15h-3.018
	C23.479,11.384,20.617,8.521,17,8.069V5.051C22.268,5.528,26.472,9.732,26.949,15z M22.92,17c-0.44,3.059-2.861,5.479-5.92,5.92V19
	h-2v3.92c-3.059-0.44-5.479-2.861-5.92-5.92H13v-2H9.08c0.44-3.059,2.861-5.479,5.92-5.92V13h2V9.08
	c3.059,0.44,5.479,2.861,5.92,5.92H19v2H22.92z M15,5.051v3.018C11.383,8.521,8.521,11.384,8.069,15H5.051
	C5.528,9.732,9.732,5.528,15,5.051z M5.051,17h3.018c0.452,3.616,3.314,6.479,6.931,6.931v3.018C9.732,26.472,5.528,22.268,5.051,17
	z M17,26.949v-3.018c3.617-0.452,6.479-3.315,6.931-6.931h3.018C26.472,22.268,22.268,26.472,17,26.949z"></path>
</svg>

<svg version="1.1" id="deploy" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<path d="M30.707,8.293L24,1.586l-6.707,6.707l1.414,1.414L23,5.414V19c0,5.514-4.486,10-10,10S3,24.514,3,19
			c0-2.671,1.04-5.182,2.929-7.071l-1.414-1.414C2.248,12.782,1,15.795,1,19c0,6.617,5.383,12,12,12s12-5.383,12-12V5.414
			l4.293,4.293L30.707,8.293z"></path>
	</g>
	<g>
		<circle cx="13" cy="19" r="3"></circle>
	</g>
</g>
</svg>


<svg version="1.1" id="details" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M26,23v-1V1H6v30h11h1L26,23z M24,22h-7v7H8V3h16V22z"></path>
	<rect x="10" y="13" width="12" height="1"></rect>
	<rect x="10" y="11" width="12" height="1"></rect>
	<rect x="10" y="9" width="12" height="1"></rect>
	<rect x="10" y="15" width="12" height="1"></rect>
	<rect x="10" y="17" width="6" height="1"></rect>
</g>
</svg>


<svg version="1.1" id="document" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M18,1h-1H6v30h20V10V9L18,1z M24,29H8V3h9v7h7V29z"></path>
	<rect x="10" y="13" width="12" height="1"></rect>
	<rect x="10" y="15" width="12" height="1"></rect>
	<rect x="10" y="17" width="6" height="1"></rect>
</g>
</svg>

<svg version="1.1" id="down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="15" y="9" width="2" height="14"></rect>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>

<svg version="1.1" id="download-import" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="24.708,13.707 23.294,12.292 17,18.587 17,2 15,2 15,18.585 8.708,12.292 7.294,13.707 16.001,22.414 	"></polygon>
	<polygon points="29,19 29,27 3,27 3,19 1,19 1,27 1,31 3,31 29,31 31,31 31,27 31,19 	"></polygon>
</g>
</svg>

<svg version="1.1" id="edit" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="24.379" y="1.257" transform="matrix(0.7071 -0.7071 0.7071 0.7071 3.8726 20.3492)" width="4.243" height="8.485"></rect>
	<path d="M5,21l6,6l15-15l-6-6L5,21z M11,24.171L7.828,21L20,8.829L23.172,12L11,24.171z"></path>
	<polygon points="1,31 6,29 3,26 	"></polygon>
</g>
</svg>


<svg version="1.1" id="email" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M16,4L1,12v1v15h30V13v-1L16,4z M7,11h18v4.2L16,20l-9-4.8V11z M29,26H3V14.066L16,21l13-6.934V26z"></path>
</svg>


<svg version="1.1" id="equipment" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M30.131,9.806c-1.252-2.948-4.152-4.683-7.17-4.6L21.178,1l-4.983,2.115l1.768,4.167c-2.218,2.11-3.023,5.451-1.758,8.435
		l3.838-1.629c0.58,1.245,1.82,2.047,3.201,2.047c0.477,0,0.939-0.095,1.379-0.282c1.756-0.745,2.588-2.751,1.91-4.52L30.131,9.806z
		 M24.246,14.962c-0.328,0.139-0.668,0.205-1.002,0.205c-0.961,0-1.871-0.546-2.309-1.458l4.707-1.998
		C26.113,12.989,25.514,14.425,24.246,14.962z"></path>
	<path d="M18.516,28.855c0-1.852-1.502-3.355-3.358-3.355c-0.15,0-0.293,0.025-0.438,0.045l-8.451-8.451
		c0.057-0.197,0.097-0.401,0.097-0.617c0-0.277-0.057-0.54-0.148-0.786L13.25,8.66c0.25,0.096,0.52,0.155,0.804,0.155
		c1.244,0,2.253-1.007,2.253-2.249c0-1.243-1.009-2.25-2.253-2.25c-1.239,0-2.248,1.007-2.248,2.25c0,0.24,0.048,0.467,0.117,0.684
		l-7.101,7.101c-0.224-0.074-0.457-0.124-0.704-0.124c-1.244,0-2.249,1.007-2.249,2.25c0,1.242,1.005,2.25,2.249,2.25
		c0.309,0,0.603-0.063,0.871-0.176l7.872,7.873c-0.647,0.611-1.056,1.473-1.056,2.432c0,0.072,0.013,0.139,0.018,0.209H8.619V31
		h13.194v-1.936h-3.314C18.504,28.994,18.516,28.928,18.516,28.855z"></path>
</g>
</svg>


<svg version="1.1" id="event-announcement" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M4,13.714V13H3v-1H1v8h2v-1h1v-0.714l2,0.571V22c0,1.104,0.896,2,2,2h4c1.104,0,2-0.896,2-2v-0.857L31,26V6L4,13.714z
	 M12,22H8v-2.571l4,1.143V22z M29,23.349L5,16.491v-0.982l24-6.857V23.349z"></path>
</svg>


<svg version="1.1" id="file" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M18,1h-1H6v30h20V10V9L18,1z M24,29H8V3h9v7h7V29z"></path>
</svg>


<svg version="1.1" id="fileextension" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M13.964,21.424c-0.155-0.203-0.35-0.365-0.584-0.488c-0.235-0.122-0.515-0.183-0.84-0.183
		c-0.256,0-0.491,0.051-0.704,0.152c-0.213,0.102-0.39,0.264-0.528,0.488h-0.016v-0.529h-1.08v5.585h1.136v-1.96h0.016
		c0.139,0.203,0.316,0.355,0.532,0.46c0.216,0.104,0.452,0.155,0.708,0.155c0.304,0,0.569-0.059,0.796-0.176
		c0.227-0.117,0.416-0.274,0.568-0.472c0.152-0.197,0.265-0.424,0.34-0.681c0.075-0.256,0.112-0.521,0.112-0.799
		c0-0.294-0.038-0.575-0.112-0.845C14.233,21.863,14.119,21.627,13.964,21.424z M13.236,23.432c-0.032,0.16-0.087,0.301-0.164,0.42
		c-0.077,0.121-0.179,0.218-0.304,0.293c-0.125,0.074-0.281,0.111-0.468,0.111c-0.181,0-0.336-0.037-0.464-0.111
		c-0.128-0.075-0.231-0.172-0.308-0.293c-0.078-0.119-0.133-0.26-0.168-0.42c-0.035-0.16-0.052-0.322-0.052-0.488
		c0-0.17,0.016-0.336,0.048-0.495c0.032-0.16,0.087-0.302,0.164-0.425c0.077-0.122,0.178-0.223,0.304-0.299
		c0.125-0.078,0.281-0.117,0.468-0.117c0.181,0,0.335,0.039,0.46,0.117c0.125,0.076,0.228,0.178,0.308,0.303
		c0.08,0.126,0.138,0.269,0.172,0.429c0.035,0.16,0.052,0.323,0.052,0.487C13.284,23.109,13.268,23.271,13.236,23.432z"></path>
	<path d="M15.956,20.932c-0.23,0.12-0.42,0.279-0.572,0.477c-0.152,0.197-0.267,0.426-0.344,0.684
		c-0.078,0.259-0.116,0.527-0.116,0.805c0,0.287,0.039,0.564,0.116,0.832c0.077,0.266,0.192,0.502,0.344,0.707
		c0.152,0.206,0.345,0.369,0.58,0.488c0.235,0.12,0.507,0.18,0.816,0.18c0.272,0,0.516-0.049,0.732-0.147
		c0.216-0.099,0.391-0.261,0.524-0.483h0.016V25h1.08v-5.712h-1.136v2.08H17.98c-0.128-0.202-0.303-0.357-0.524-0.46
		c-0.222-0.103-0.455-0.156-0.7-0.156C16.452,20.752,16.185,20.812,15.956,20.932z M17.524,21.721
		c0.123,0.074,0.223,0.172,0.3,0.291c0.078,0.12,0.132,0.259,0.164,0.416c0.032,0.158,0.048,0.322,0.048,0.492
		c0,0.171-0.016,0.336-0.048,0.496c-0.032,0.16-0.085,0.303-0.16,0.428c-0.075,0.125-0.175,0.226-0.3,0.301
		c-0.125,0.074-0.281,0.111-0.468,0.111c-0.176,0-0.327-0.039-0.452-0.115c-0.125-0.078-0.229-0.18-0.312-0.305
		c-0.082-0.125-0.143-0.267-0.18-0.428c-0.038-0.16-0.056-0.32-0.056-0.48c0-0.17,0.017-0.334,0.052-0.492
		c0.035-0.156,0.091-0.297,0.168-0.42c0.078-0.122,0.18-0.221,0.308-0.295c0.128-0.075,0.285-0.113,0.472-0.113
		C17.247,21.607,17.401,21.646,17.524,21.721z"></path>
	<path d="M20.236,25h1.136v-3.376h0.784v-0.761h-0.784v-0.247c0-0.171,0.033-0.292,0.1-0.364c0.066-0.072,0.177-0.108,0.332-0.108
		c0.144,0,0.283,0.008,0.416,0.023V19.32c-0.096-0.006-0.195-0.012-0.296-0.02c-0.101-0.008-0.203-0.012-0.304-0.012
		c-0.464,0-0.81,0.117-1.04,0.353c-0.229,0.234-0.344,0.535-0.344,0.903v0.319h-0.68v0.761h0.68V25z"></path>
	<path d="M18,1h-1H6v30h20V10V9L18,1z M24,29H8V3h9v7h7V29z"></path>
</g>
</svg>

<svg version="1.1" id="filter" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M31,1H1v4l12,12v14l6-6v-3.379C19.733,22.459,20.798,23,22,23c2.21,0,4-1.79,4-4s-1.79-4-4-4
	c-0.423,0-0.822,0.083-1.205,0.205L31,5V1z M24,19c0,1.103-0.898,2-2,2c-1.103,0-2-0.897-2-2s0.897-2,2-2C23.102,17,24,17.897,24,19
	z M17.586,15.586L17,16.171V17v7.171l-2,2V17v-0.829l-0.586-0.585L3.829,5h24.343L17.586,15.586z"></path>
</svg>


<svg version="1.1" id="floorplan" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<polygon points="3,3 3,29 10.346,29 10.346,27 5,27 5,17 9.951,17 9.951,15 5,15 5,5 27,5 27,15 19.947,15 19.947,11.591 
	17.947,11.591 17.947,20.409 19.947,20.409 19.947,17 27,17 27,27 17.897,27 17.897,29 29,29 29,3 "></polygon>
</svg>


<svg version="1.1" id="flow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<g>
			<path d="M24,19c-2.419,0-4.435,1.718-4.899,4h-6.201c-0.13-0.638-0.384-1.23-0.731-1.754l9.078-9.077
				C22.036,12.692,22.981,13,24,13c2.762,0,5-2.238,5-5s-2.238-5-5-5c-2.419,0-4.435,1.718-4.899,4h-6.201
				C12.436,4.718,10.419,3,8,3C5.238,3,3,5.238,3,8s2.238,5,5,5c2.419,0,4.436-1.718,4.899-4h6.201
				c0.13,0.638,0.384,1.23,0.731,1.754l-9.078,9.077C9.964,19.308,9.019,19,8,19c-2.762,0-5,2.238-5,5s2.238,5,5,5
				c2.419,0,4.436-1.718,4.899-4h6.201c0.464,2.282,2.481,4,4.899,4c2.762,0,5-2.238,5-5S26.762,19,24,19z M24,5
				c1.657,0,3,1.343,3,3s-1.343,3-3,3s-3-1.343-3-3S22.343,5,24,5z M8,11c-1.657,0-3-1.343-3-3s1.343-3,3-3s3,1.343,3,3
				S9.657,11,8,11z M8,27c-1.657,0-3-1.343-3-3s1.343-3,3-3s3,1.343,3,3S9.657,27,8,27z"></path>
		</g>
	</g>
</g>
</svg>


<svg version="1.1" id="folder" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M13,8V5H1v3v3v16h30V11V8H13z M29,25H3V11h26V25z"></path>
</svg>


<svg version="1.1" id="forum" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<path d="M27.484,4.515C25.313,2.343,22.313,1,19,1s-6.314,1.343-8.484,3.515C8.344,6.687,7,9.686,7,13
			c0,1.045,0.148,2.054,0.398,3.02C7.267,16.011,7.135,16,7,16c-1.656,0-3.156,0.672-4.242,1.758C1.672,18.843,1,20.343,1,22
			c0,1.754,0.672,3.343,1.758,4.492L7,31v-3c1.656,0,3.156-0.672,4.242-1.758c0.795-0.794,1.363-1.812,1.614-2.948
			C14.654,24.37,16.752,25,19,25v6l8.484-9.016C29.656,19.685,31,16.508,31,13C31,9.686,29.656,6.687,27.484,4.515z M26.027,20.613
			L21,25.956V25v-2h-2c-2.24,0-4.361-0.74-6.104-2.09c-0.225-1.219-0.812-2.311-1.654-3.152c-0.451-0.451-0.977-0.825-1.552-1.115
			C9.242,15.497,9,14.268,9,13c0-2.671,1.041-5.182,2.93-7.071S16.329,3,19,3s5.182,1.04,7.07,2.93C27.959,7.818,29,10.329,29,13
			C29,15.881,27.945,18.583,26.027,20.613z"></path>
	</g>
	<g>
		<circle cx="19" cy="13" r="1.5"></circle>
	</g>
	<g>
		<circle cx="24" cy="13" r="1.5"></circle>
	</g>
	<g>
		<circle cx="14" cy="13" r="1.5"></circle>
	</g>
</g>
</svg>


<svg version="1.1" id="forward" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve">
<g>
	<polygon points="15.293,10.707 19.586,15 8,15 8,17 19.586,17 15.293,21.293 16.707,22.707 23.414,16 16.707,9.293 	"></polygon>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14c7.731,0,14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16
		S9.383,4,16,4c6.617,0,12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>


<svg version="1.1" id="gauge" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,2C8.268,2,2,8.268,2,16s6.268,14,14,14s14-6.268,14-14S23.732,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
	<polygon points="15,17 17,19 23,9 13,15 	"></polygon>
</g>
</svg>


<svg version="1.1" id="glasses" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M31,15h-1.09c-0.478-2.836-2.941-5-5.91-5c-1.176,0-2.27,0.344-3.196,0.93l-0.136-0.136C19.378,9.637,17.721,9,16,9
	s-3.378,0.637-4.707,1.831l-0.098,0.098C10.269,10.344,9.176,10,8,10c-2.97,0-5.433,2.164-5.91,5H1v2h1.09
	C2.567,19.836,5.03,22,8,22c3.311,0,6-2.687,6-6c0-1.413-0.492-2.709-1.31-3.734C13.609,11.451,14.783,11,16,11
	c1.227,0,2.41,0.455,3.293,1.245l0.019,0.019C18.492,13.289,18,14.586,18,16c0,3.313,2.69,6,6,6c2.97,0,5.433-2.164,5.91-5H31V15z
	 M8,20c-2.205,0-4-1.795-4-4s1.795-4,4-4s4,1.795,4,4S10.205,20,8,20z M24,20c-2.205,0-4-1.795-4-4s1.795-4,4-4s4,1.795,4,4
	S26.205,20,24,20z"></path>
</svg>


<svg version="1.1" id="hat" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M28,23v-6v-1c0-6.627-5.375-12-12-12S4,9.373,4,16v1v6H1c0,2.766,2.241,5,4.995,5h20.01C28.759,28,31,25.766,31,23H28z
	 M6,23v-6h20v6H6z"></path>
</svg>


<svg version="1.1" id="headphones" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M27,17v4h2v-4h-1v-1.5c0-6.617-5.383-12-12-12c-6.617,0-12,5.383-12,12V17H3v4h2v-4v-1.5c0-6.065,4.935-11,11-11
		c6.065,0,11,4.935,11,11V17z"></path>
	<rect x="1" y="22" width="4" height="9"></rect>
	<rect x="27" y="22" width="4" height="9"></rect>
</g>
</svg>


<svg version="1.1" id="help" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M23,16c0,0.893-0.174,1.743-0.479,2.528
	c-0.711,1.829-2.164,3.281-3.992,3.992C17.744,22.826,16.893,23,16,23c-0.893,0-1.744-0.174-2.529-0.479
	c-1.828-0.711-3.281-2.164-3.992-3.992C9.174,17.743,9,16.893,9,16c0-0.893,0.174-1.743,0.479-2.527
	c0.711-1.829,2.165-3.283,3.992-3.994C14.257,9.174,15.107,9,16,9c0.893,0,1.743,0.174,2.529,0.479
	c1.827,0.71,3.281,2.165,3.992,3.994C22.826,14.257,23,15.107,23,16z M19.286,8.714C18.282,8.259,17.172,8,16,8
	s-2.282,0.259-3.286,0.714L9.766,5.766C11.586,4.653,13.715,4,16,4s4.414,0.653,6.234,1.766L19.286,8.714z M8.714,19.286
	l-2.948,2.948C4.653,20.415,4,18.285,4,16s0.653-4.415,1.766-6.234l2.948,2.948C8.26,13.718,8,14.828,8,16S8.26,18.282,8.714,19.286
	z M12.714,23.286C13.718,23.741,14.828,24,16,24s2.282-0.259,3.286-0.714l2.948,2.948C20.414,27.347,18.285,28,16,28
	s-4.414-0.653-6.234-1.766L12.714,23.286z M23.286,12.714l2.948-2.948C27.347,11.585,28,13.715,28,16s-0.653,4.415-1.766,6.234
	l-2.948-2.948C23.74,18.282,24,17.172,24,16S23.74,13.718,23.286,12.714z"></path>
</svg>


<svg version="1.1" id="home" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,1L2,15l3,3v13h22V18l3-3L16,1z M25,29H7V16l9-9l9,9V29z"></path>
</g>
</svg>


<svg version="1.1" id="idea" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,1C9.924,1,5,5.924,5,12s4.924,11,11,11s11-4.924,11-11S22.076,1,16,1z M16,21c-4.963,0-9-4.038-9-9s4.037-9,9-9
		s9,4.038,9,9S20.963,21,16,21z"></path>
	<rect x="12" y="24" width="8" height="4"></rect>
	<path d="M16,31c1.104,0,2-0.896,2-2h-4C14,30.104,14.896,31,16,31z"></path>
	<path d="M16,19l4-6h-8L16,19z M16,17.197L13.868,14h4.264L16,17.197z"></path>
</g>
</svg>


<svg version="1.1" id="indent" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="2.293,11.707 6.586,16 2.293,20.293 3.707,21.707 9.414,16 3.707,10.293 	"></polygon>
	<rect x="11" y="6" width="2" height="20"></rect>
	<rect x="15" y="9" width="12" height="2"></rect>
	<rect x="15" y="13" width="8" height="2"></rect>
	<rect x="15" y="17" width="16" height="2"></rect>
	<rect x="15" y="21" width="8" height="2"></rect>
</g>
</svg>


<svg version="1.1" id="industry-factory" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M29,1h-4l-1,15h-7v-4l-8,4v-4l-8,4v15h22h5h3L29,1z M3,29V18h20.867l-0.734,11H3z"></path>
</g>
</svg>

<svg version="1.1" id="info-moreinfo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="18,14 12,14 12,16 14,16 14,22 12,22 12,24 20,24 20,22 18,22 	"></polygon>
	<circle cx="16" cy="10" r="2"></circle>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>


<svg version="1.1" id="insert" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M29.293,22.293L25,26.586V13c0-6.617-5.383-12-12-12S1,6.383,1,13h2C3,7.486,7.486,3,13,3s10,4.486,10,10v13.586
	l-4.293-4.293l-1.414,1.414L24,30.414l6.707-6.707L29.293,22.293z"></path>
</svg>


<svg version="1.1" id="inventory" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M24,15V3H8v12H3v14h26V15H24z M10,5h12v10H10V5z M27,27H5V17h3h16h3V27z"></path>
	<rect x="12" y="9" width="8" height="1"></rect>
	<rect x="12" y="11" width="8" height="1"></rect>
	<polygon points="19,22 13,22 13,21 12,21 12,22 12,23 13,23 19,23 20,23 20,22 20,21 19,21 	"></polygon>
</g>
</svg>


<svg version="1.1" id="italic" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<polygon points="25,5 25,3 13,3 13,5 16.923,5 10.577,27 7,27 7,29 19,29 19,27 14.577,27 20.923,5 "></polygon>
</svg>


<svg version="1.1" id="justify" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="5" y="24" width="22" height="2"></rect>
	<rect x="5" y="18" width="22" height="2"></rect>
	<rect x="5" y="12" width="22" height="2"></rect>
	<rect x="5" y="6" width="22" height="2"></rect>
</g>
</svg>


<svg version="1.1" id="like-heart" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M22,4c-2.551,0-4.776,1.369-6,3.408C14.776,5.369,12.551,4,10,4c-3.866,0-7,3.134-7,7c0,1.933,0.761,3.706,2,5
	c2.815,2.94,11,12,11,12s8.185-9.06,11-12c1.239-1.294,2-3.067,2-5C29,7.134,25.866,4,22,4z M25.556,14.617
	C23.457,16.808,18.499,22.262,16,25.02c-2.499-2.757-7.457-8.211-9.556-10.403C5.513,13.644,5,12.36,5,11c0-2.757,2.243-5,5-5
	c1.768,0,3.369,0.911,4.285,2.437L16,11.294l1.715-2.857C18.631,6.911,20.232,6,22,6c2.757,0,5,2.243,5,5
	C27,12.36,26.487,13.644,25.556,14.617z"></path>
</svg>


<svg version="1.1" id="link-externallink" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M28.95,3.05C27.683,1.784,25.933,1,24,1s-3.683,0.784-4.95,2.05l-3,3C14.784,7.317,14,9.067,14,11
	c0,1.206,0.286,2.359,0.808,3.364l-0.443,0.443C13.359,14.286,12.206,14,11,14c-1.933,0-3.683,0.784-4.95,2.05l-3,3
	C1.784,20.317,1,22.067,1,24s0.784,3.683,2.05,4.95S6.067,31,8,31s3.683-0.784,4.95-2.05l3-3C17.216,24.683,18,22.933,18,21
	c0-1.206-0.286-2.359-0.808-3.364l0.443-0.443C18.641,17.714,19.794,18,21,18c1.933,0,3.683-0.784,4.95-2.05l3-3
	C30.216,11.683,31,9.933,31,8S30.216,4.317,28.95,3.05z M16,21c0,1.335-0.52,2.591-1.464,3.536l-3,3C10.591,28.48,9.335,29,8,29
	s-2.591-0.52-3.536-1.464C3.52,26.591,3,25.335,3,24s0.52-2.591,1.464-3.536l3-3C8.409,16.52,9.665,16,11,16
	c0.642,0,1.264,0.122,1.84,0.332l-4.254,4.254l2.828,2.828l4.254-4.254C15.878,19.736,16,20.358,16,21z M27.536,11.536l-3,3
	C23.591,15.48,22.335,16,21,16c-0.642,0-1.264-0.122-1.84-0.332l4.254-4.254l-2.828-2.828l-4.254,4.254
	C16.122,12.264,16,11.642,16,11c0-1.335,0.52-2.591,1.464-3.536l3-3C21.409,3.52,22.665,3,24,3s2.591,0.52,3.536,1.464
	C28.48,5.409,29,6.665,29,8S28.48,10.591,27.536,11.536z"></path>
</svg>


<svg version="1.1" id="list-view" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M1,4v4v20h30V8V4H1z M29,26H3v-4h26V26z M29,20H3v-4h26V20z M29,14H3v-4h26V14z"></path>
</svg>


<svg version="1.1" id="location" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M24.484,4.515C22.313,2.343,19.313,1,16,1c-3.314,0-6.314,1.343-8.484,3.515C5.344,6.687,4,9.686,4,13
		c0,3.508,1.344,6.685,3.516,8.984L16,31l8.484-9.016C26.656,19.685,28,16.508,28,13C28,9.686,26.656,6.687,24.484,4.515z
		 M23.028,20.613L16,28.081L8.969,20.61C7.055,18.583,6,15.881,6,13c0-2.671,1.04-5.182,2.93-7.071C10.818,4.04,13.329,3,16,3
		c2.671,0,5.182,1.04,7.07,2.93C24.959,7.818,26,10.329,26,13C26,15.881,24.945,18.583,23.028,20.613z"></path>
	<circle cx="16" cy="13" r="4"></circle>
</g>
</svg>


<svg version="1.1" id="location-map" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M24.484,4.515C22.313,2.343,19.313,1,16,1c-3.314,0-6.314,1.343-8.484,3.515C5.344,6.687,4,9.686,4,13
		c0,3.508,1.344,6.685,3.516,8.984L16,31l8.484-9.016C26.656,19.685,28,16.508,28,13C28,9.686,26.656,6.687,24.484,4.515z
		 M23.028,20.613L16,28.081L8.969,20.61C7.055,18.583,6,15.881,6,13c0-2.671,1.04-5.182,2.93-7.071C10.818,4.04,13.329,3,16,3
		c2.671,0,5.182,1.04,7.07,2.93C24.959,7.818,26,10.329,26,13C26,15.881,24.945,18.583,23.028,20.613z"></path>
	<circle cx="16" cy="13" r="4"></circle>
</g>
</svg>


<svg version="1.1" id="lock-secure" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="14.5,21.586 12.207,19.293 10.793,20.707 14.5,24.414 21.207,17.707 19.793,16.293 	"></polygon>
	<path d="M24,12.466V9c0-4.418-3.581-8-8-8S8,4.582,8,9v3.467C6.145,14.436,5,17.082,5,20c0,6.074,4.926,11,11,11
		c6.076,0,11-4.926,11-11C27,17.081,25.855,14.436,24,12.466z M10,9c0-3.309,2.691-6,6-6s6,2.691,6,6v1.788
		C20.273,9.661,18.215,9,16,9c-2.215,0-4.273,0.661-6,1.788V9z M16,29c-4.971,0-9-4.029-9-9s4.029-9,9-9s9,4.029,9,9
		S20.971,29,16,29z"></path>
</g>
</svg>


<svg version="1.1" id="log" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="6" y="29" width="20" height="2"></rect>
	<path d="M6,1v4v22h20V5V1H6z M24,25H8V7h16V25z"></path>
	<rect x="10" y="15" width="12" height="1"></rect>
	<rect x="10" y="11" width="12" height="1"></rect>
	<rect x="10" y="19" width="12" height="1"></rect>
</g>
</svg>

<svg version="1.1" id="maximize" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M1,4v4v20h30V8V4H1z M29,26H3V10h26V26z"></path>
	<polygon points="18.707,21.707 25,15.414 25,20 27,20 27,12 19,12 19,14 23.586,14 17.293,20.293 	"></polygon>
</g>
</svg>


<svg version="1.1" id="menuoverflow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<circle cx="4" cy="16" r="3"></circle>
	<circle cx="16" cy="16" r="3"></circle>
	<circle cx="28" cy="16" r="3"></circle>
</g>
</svg>


<svg version="1.1" id="microphone-recording" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,23c3.865,0,7-3.135,7-7v-2v-1v-2v-1V8c0-3.865-3.135-7-7-7S9,4.135,9,8v2v1v2v1v2C9,19.865,12.135,23,16,23z M13,14h-2
		v-1h2c0.553,0,1-0.447,1-1s-0.447-1-1-1h-2v-1h2c0.553,0,1-0.447,1-1s-0.447-1-1-1h-2c0-2.757,2.243-5,5-5s5,2.243,5,5h-2
		c-0.553,0-1,0.447-1,1s0.447,1,1,1h2v1h-2c-0.553,0-1,0.447-1,1s0.447,1,1,1h2v1h-2c-0.553,0-1,0.447-1,1s0.447,1,1,1h2
		c0,2.757-2.243,5-5,5s-5-2.243-5-5h2c0.553,0,1-0.447,1-1S13.553,14,13,14z"></path>
	<path d="M26,16h-2c0,4.411-3.589,8-8,8s-8-3.589-8-8H6c0,5.177,3.954,9.445,9,9.949V29h-3v2h3h2h3v-2h-3v-3.051
		C22.046,25.445,26,21.177,26,16z"></path>
</g>
</svg>

<svg version="1.1" id="migrate" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M24.707,16.293l-1.414,1.414L26.586,21H21V10V9l-8-8h-1H1v30h20v-8h5.586l-3.293,3.293l1.414,1.414L30.414,22L24.707,16.293
	z M19,29H3V3h9v7h7v11h-7v2h7V29z"></path>
</svg>

<svg version="1.1" id="minimize" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M1,4v20v4h30v-4V4H1z M3,6h26v16H3V6z"></path>
	<polygon points="13.293,10.293 7,16.586 7,12 5,12 5,20 13,20 13,18 8.414,18 14.707,11.707 	"></polygon>
</g>
</svg>


<svg version="1.1" id="mobile" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M7,1v4v22v4h18v-4V5V1H7z M23,7v18H9V7H23z M14,3h4v1h-4V3z"></path>
</svg>

<svg version="1.1" id="monitoring" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<path d="M1,4v4v20h30V8V4H1z M29,26H3V10h26V26z"></path>
	</g>
	<g>
		<path d="M16,24c4.484,0,7.9-2.417,10-6c-2.1-3.583-5.516-6-10-6s-7.9,2.417-10,6C8.1,21.583,11.516,24,16,24z M16,13
			c3.627,0,6.74,1.77,8.826,5c-2.086,3.23-5.199,5-8.826,5s-6.74-1.77-8.826-5C9.26,14.77,12.373,13,16,13z"></path>
	</g>
	<g>
		<path d="M16,21.5c1.934,0,3.5-1.566,3.5-3.5s-1.566-3.5-3.5-3.5c-1.932,0-3.5,1.566-3.5,3.5S14.068,21.5,16,21.5z M16,16.833
			c0.646,0,1.166,0.522,1.166,1.167s-0.52,1.167-1.166,1.167S14.834,18.645,14.834,18S15.354,16.833,16,16.833z"></path>
	</g>
</g>
</svg>

<svg version="1.1" id="move" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="12,17 12,15 5.414,15 7.707,12.707 6.293,11.293 1.586,16 6.293,20.707 7.707,19.293 5.414,17 	"></polygon>
	<polygon points="25.707,11.293 24.293,12.707 26.586,15 20,15 20,17 26.586,17 24.293,19.293 25.707,20.707 30.414,16 	"></polygon>
	<polygon points="17,26.586 17,20 15,20 15,26.586 12.707,24.293 11.293,25.707 16,30.414 20.707,25.707 19.293,24.293 	"></polygon>
	<polygon points="15,5.414 15,12 17,12 17,5.414 19.293,7.707 20.707,6.293 16,1.586 11.293,6.293 12.707,7.707 	"></polygon>
</g>
</svg>


<svg version="1.1" id="move-cart" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M13.35,13.22l3.245,7.673c1.407,0.051,2.69,0.6,3.677,1.482l7.664-3.242L23.602,8.885L13.35,13.22z M19.92,11.938
		l2.762-1.174l0.193,0.457l-2.76,1.176L19.92,11.938z M23.416,12.446l-2.777,1.184l-0.195-0.458l2.775-1.182L23.416,12.446z"></path>
	<path d="M21.295,23.571c0.359,0.555,0.629,1.171,0.783,1.834l8.746-3.698l-0.777-1.837L21.295,23.571z"></path>
	<path d="M13.199,21.833c0.284-0.184,0.582-0.354,0.902-0.488c0.302-0.129,0.614-0.219,0.931-0.294L7.542,3.334L1.97,0.918
		L1.176,2.747l4.84,2.1L13.199,21.833z"></path>
	<path d="M16.359,22.286c-2.399,0.043-4.315,2.027-4.273,4.426s2.026,4.314,4.425,4.273c2.397-0.042,4.315-2.027,4.273-4.426
		S18.757,22.245,16.359,22.286z M16.477,28.995c-1.302,0.023-2.38-1.017-2.403-2.318c-0.022-1.302,1.019-2.379,2.32-2.402
		s2.38,1.018,2.403,2.318C18.819,27.896,17.778,28.974,16.477,28.995z"></path>
</g>
</svg>


<svg version="1.1" id="music" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M11,5v4v1v12.023C10.162,21.39,9.131,21,8,21c-2.761,0-5,2.238-5,5s2.239,5,5,5s5-2.238,5-5V9.556l14-3.111v11.579
	C26.162,17.39,25.131,17,24,17c-2.761,0-5,2.238-5,5s2.239,5,5,5s5-2.238,5-5V6V5V1L11,5z M8,29c-1.654,0-3-1.346-3-3s1.346-3,3-3
	s3,1.346,3,3S9.654,29,8,29z M24,25c-1.654,0-3-1.346-3-3s1.346-3,3-3s3,1.346,3,3S25.654,25,24,25z"></path>
</svg>


<svg version="1.1" id="musicfile" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M3,3v22v4h26v-4V3H3z M5,5h22v18H5V5z"></path>
	<path d="M13,9v2v5.779C12.469,16.3,11.771,16,11,16c-1.655,0-3,1.344-3,3c0,1.656,1.345,3,3,3s3-1.344,3-3v-8.182l9-1.637v5.598
		C22.469,14.3,21.771,14,21,14c-1.655,0-3,1.344-3,3c0,1.656,1.345,3,3,3s3-1.344,3-3V9V7V6L13,8V9z M11,21c-1.102,0-2-0.897-2-2
		s0.898-2,2-2s2,0.897,2,2S12.102,21,11,21z M21,19c-1.103,0-2-0.897-2-2s0.897-2,2-2s2,0.898,2,2S22.103,19,21,19z"></path>
</g>
</svg>

<svg version="1.1" id="new-indicator" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,2C8.27,2,2,8.269,2,16c0,7.729,6.27,14,14,14c7.73,0,14-6.271,14-14C30,8.269,23.73,2,16,2z M16,28
		C9.383,28,4,22.617,4,16S9.383,4,16,4s12,5.383,12,12S22.617,28,16,28z"></path>
	<g>
		<path d="M8.525,14.971l0.701-1.854L15,15.174V9h1.956v6.174l5.769-2.058l0.752,1.854l-5.92,1.957l3.611,4.918L19.564,23
			L15.9,17.982L12.241,23l-1.605-1.154l3.659-4.918L8.525,14.971z"></path>
	</g>
</g>
</svg>

<svg version="1.1" id="next-right-forward" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="15.293,10.707 19.586,15 8,15 8,17 19.586,17 15.293,21.293 16.707,22.707 23.414,16 16.707,9.293 	"></polygon>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14c7.731,0,14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16
		S9.383,4,16,4c6.617,0,12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>

<svg version="1.1" id="not-ready" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon fill="#C7C7C7" points="14,18.586 10.707,15.293 9.293,16.707 14,21.414 22.707,12.707 21.293,11.293 	"></polygon>
	<path d="M16,2C8.269,2,2,8.269,2,16c0,7.73,6.269,14,14,14c7.73,0,14-6.27,14-14C30,8.269,23.73,2,16,2z M16,28
		C9.383,28,4,22.617,4,16S9.383,4,16,4s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>


<svg version="1.1" id="numberlist" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="8" y="6" width="23" height="2"></rect>
	<rect x="8" y="15" width="23" height="2"></rect>
	<rect x="8" y="24" width="23" height="2"></rect>
	<polygon points="3,4 2,4 1,4 1,5 2,5 2,9 1,9 1,10 2,10 3,10 4,10 4,9 3,9 	"></polygon>
	<polygon points="3,15 3,16 4,16 4,15 4,14 3,14 	"></polygon>
	<rect x="2" y="16" width="1" height="1"></rect>
	<polygon points="1,18 1,19 4,19 4,18 2,18 2,17 1,17 	"></polygon>
	<polygon points="2,13 1,13 1,14 2,14 3,14 3,13 	"></polygon>
	<rect x="3" y="23" width="1" height="1"></rect>
	<rect x="2" y="24" width="1" height="1"></rect>
	<polygon points="3,27 4,27 4,26 4,25 3,25 3,26 	"></polygon>
	<polygon points="1,27 1,28 2,28 3,28 3,27 2,27 	"></polygon>
	<polygon points="2,22 1,22 1,23 2,23 3,23 3,22 	"></polygon>
</g>
</svg>


<svg version="1.1" id="outdent" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="7.292,10.292 1.585,16 7.292,21.706 8.706,20.292 4.414,16 8.706,11.707 	"></polygon>
	<rect x="11" y="6" width="2" height="20"></rect>
	<rect x="15" y="9" width="12" height="2"></rect>
	<rect x="15" y="13" width="8" height="2"></rect>
	<rect x="15" y="17" width="16" height="2"></rect>
	<rect x="15" y="21" width="8" height="2"></rect>
</g>
</svg>

<svg version="1.1" id="overview" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M24,9c-1.906,0-3.632,0.764-4.895,2h-1.383c-0.347-0.595-0.984-1-1.723-1s-1.376,0.405-1.723,1h-1.383
	C11.632,9.764,9.906,9,8,9c-3.867,0-7,3.135-7,7s3.133,7,7,7s7-3.135,7-7h2c0,3.865,3.133,7,7,7s7-3.135,7-7S27.867,9,24,9z M8,21
	c-2.757,0-5-2.243-5-5s2.243-5,5-5s5,2.243,5,5S10.757,21,8,21z M24,21c-2.757,0-5-2.243-5-5s2.243-5,5-5s5,2.243,5,5
	S26.757,21,24,21z"></path>
</svg>

<svg version="1.1" id="pan-zoom" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve">
<g>
	<g>
		<g>
			<polygon points="11.9,19.2 11.9,21.2 20.1,21.2 20.1,19.2 			"></polygon>
		</g>
	</g>
	<polygon points="20,12 17,12 17,9 15,9 15,12 12,12 12,14 15,14 15,17 17,17 17,14 20,14 	"></polygon>
	<polygon points="3.7,16 5.1,14.6 7.8,11.9 6.5,10.5 1,16 6.5,21.5 7.8,20.1 5.1,17.4 	"></polygon>
	<polygon points="25.5,10.5 24.2,11.9 26.9,14.6 28.3,16 26.9,17.4 24.2,20.1 25.5,21.5 31,16 	"></polygon>
	<polygon points="17.4,26.9 16,28.3 14.6,26.9 11.9,24.2 10.5,25.5 16,31 21.5,25.5 20.1,24.2 	"></polygon>
	<polygon points="14.6,5.1 16,3.7 17.4,5.1 20.1,7.8 21.5,6.5 16,1 10.5,6.5 11.9,7.8 	"></polygon>
</g>
</svg>


<svg version="1.1" id="paste" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M21,7V1H5v24h6v6h16V7H21z M25,29H13V9h12V29z"></path>
	<rect x="15" y="13" width="8" height="1"></rect>
	<rect x="15" y="15" width="8" height="1"></rect>
	<rect x="15" y="17" width="8" height="1"></rect>
	<rect x="15" y="19" width="4" height="1"></rect>
</g>
</svg>

<svg version="1.1" id="pause" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
	<rect x="11" y="11" width="4" height="10"></rect>
	<rect x="17" y="11" width="4" height="10"></rect>
</g>
</svg>


<svg version="1.1" id="payment-creditcard" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M1,6v20h30V6H1z M29,8v2H3V8H29z M3,24V13h26v11H3z"></path>
	<rect x="5" y="21" width="4" height="1"></rect>
	<rect x="10" y="21" width="4" height="1"></rect>
</g>
</svg>


<svg version="1.1" id="person" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,9c2.209,0,4-1.791,4-4s-1.791-4-4-4s-4,1.791-4,4S13.791,9,16,9z M16,3c1.103,0,2,0.897,2,2s-0.897,2-2,2s-2-0.897-2-2
		S14.898,3,16,3z"></path>
	<path d="M19,11h-6c-1.104,0-2,0.896-2,2v8l2,2v7c0,0.552,0.447,1,1,1h4c0.553,0,1-0.448,1-1v-7l2-2v-8C21,11.896,20.104,11,19,11z"></path>
</g>
</svg>


<svg version="1.1" id="phone-call" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M24,1l-6,7l2,3l-9,9l-3-2l-7,5l3,8c5-2,11-6,16-11S29,9,31,4L24,1z M18.586,18.586c-4.049,4.049-8.952,7.582-13.455,9.733
	l-1.719-4.584l4.627-3.306l1.852,1.234l1.364,0.91l1.159-1.16l9-9l1.159-1.159l-0.909-1.364l-1.159-1.739l4.058-4.734l3.798,1.627
	C26.213,9.571,22.661,14.511,18.586,18.586z"></path>
</svg>


<svg version="1.1" id="picturefile" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M3,3v22v4h26v-4V3H3z M5,5h22v18H5V5z"></path>
	<polygon points="19,17 12,10 7,15 7,21 25,21 25,17 22,14 	"></polygon>
	<circle cx="23" cy="9" r="2"></circle>
</g>
</svg>


<svg version="1.1" id="piechart" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,2v14H2c0,7.731,6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M18,4.167C23.668,5.122,28,10.064,28,16H18V4.167z
		 M16,28c-5.936,0-10.878-4.332-11.833-10H16h2h9.819C26.863,23.666,21.934,28,16,28z"></path>
	<path d="M14,2.159C7.873,3.038,3.038,7.873,2.159,14H14V2.159z"></path>
</g>
</svg>

<svg version="1.1" id="pin" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M31.011,11.131L20.745,0.866l-7.318,9.714c-0.403-0.05-0.81-0.076-1.219-0.076c-2.535,0-5.033,0.983-7.032,2.769
	l-1.578,1.41l6.257,6.255l-8.861,8.86l-0.004,1.325l1.341,0.01l8.859-8.859l6.004,6.003l1.409-1.578
	c2.096-2.346,3.057-5.346,2.693-8.25L31.011,11.131z M19.094,17.604c0.704,2.546,0.084,5.449-1.982,7.763L6.509,14.765
	c1.706-1.524,3.732-2.261,5.699-2.261c0.701,0,1.395,0.094,2.063,0.278l6.687-8.875l7.012,7.011L19.094,17.604z"></path>
</svg>


<svg version="1.1" id="pin-asset" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path fill="#FFFFFF" d="M25.246,3.749C22.778,1.332,19.495,0,16,0c-3.494,0-6.779,1.332-9.248,3.75
	c-2.479,2.419-3.845,5.641-3.845,9.072c0,3.604,1.358,6.996,3.826,9.552L16,32l9.268-9.627c2.466-2.555,3.824-5.947,3.824-9.551
	C29.093,9.392,27.727,6.169,25.246,3.749z"></path>
<path d="M24.558,4.455C22.373,2.315,19.349,0.986,16,0.986c-3.349,0-6.373,1.329-8.558,3.468c-2.19,2.138-3.549,5.098-3.549,8.368
	c0,3.461,1.358,6.598,3.549,8.867L16,30.578l8.558-8.889c2.19-2.27,3.549-5.406,3.549-8.867C28.106,9.552,26.748,6.592,24.558,4.455
	z M16,22.821c-5.2,0-9.415-4.216-9.415-9.416S10.8,3.991,16,3.991c5.2,0,9.415,4.215,9.415,9.415S21.2,22.821,16,22.821z"></path>
<path d="M21.918,17.838l-0.02-10.225H10.082v10.225h4.301v1.087h-1.074v0.524h5.38v-0.537h-1.076v-1.074H21.918z M11.159,8.689h9.68
	v7h-9.68V8.689z"></path>
</svg>


<svg version="1.1" id="pin-equipment" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path fill="#FFFFFF" d="M25.246,3.749C22.778,1.332,19.494,0,16,0S9.221,1.332,6.752,3.75c-2.479,2.419-3.845,5.642-3.845,9.072
	c0,3.604,1.358,6.996,3.825,9.552l8.557,8.888L16,32l0.711-0.738l8.558-8.889c2.466-2.555,3.824-5.947,3.824-9.551
	C29.093,9.392,27.727,6.169,25.246,3.749z"></path>
<g>
	<path d="M24.558,4.455C22.373,2.315,19.349,0.986,16,0.986c-3.349,0-6.373,1.329-8.558,3.468c-2.19,2.138-3.549,5.098-3.549,8.368
		c0,3.461,1.358,6.598,3.549,8.867L16,30.578l8.558-8.889c2.19-2.27,3.549-5.406,3.549-8.867
		C28.106,9.552,26.748,6.592,24.558,4.455z M16,22.535c-5.2,0-9.416-4.216-9.416-9.417c0-5.2,4.215-9.415,9.416-9.415
		s9.415,4.215,9.415,9.415C25.415,18.319,21.2,22.535,16,22.535z"></path>
	<path d="M22.429,9.416c-0.567-1.346-1.89-2.131-3.263-2.1l-0.812-1.91l-2.266,0.965l0.804,1.894
		c-1.01,0.963-1.374,2.475-0.801,3.84l1.6-0.678c0.287,0.622,0.908,1.024,1.602,1.024c0.235,0,0.472-0.045,0.69-0.14
		c0.437-0.182,0.772-0.534,0.951-0.966c0.168-0.419,0.167-0.873,0.003-1.296L22.429,9.416z M19.752,11.76
		c-0.152,0.059-0.305,0.095-0.458,0.095c-0.435,0-0.845-0.25-1.043-0.671l2.135-0.903C20.602,10.863,20.327,11.511,19.752,11.76z"></path>
	<path d="M15.628,16.553l-4.018-4.016c0.002-0.029,0.012-0.058,0.012-0.087c0-0.066-0.012-0.124-0.021-0.185l3.325-3.321
		c0.06,0.014,0.125,0.014,0.193,0.014c0.563,0,1.021-0.457,1.021-1.023c0-0.564-0.458-1.022-1.021-1.022
		c-0.568,0-1.023,0.455-1.023,1.022c0,0.042,0.007,0.084,0.012,0.132l-3.376,3.375c-0.047-0.014-0.089-0.014-0.137-0.014
		c-0.566,0-1.024,0.457-1.024,1.022c0,0.566,0.458,1.023,1.024,1.023c0.076,0,0.15-0.012,0.226-0.025l3.648,3.645
		c-0.218,0.256-0.353,0.566-0.369,0.925h-1.461v1.2h6.008v-1.202H17.14C17.104,17.204,16.443,16.561,15.628,16.553z"></path>
</g>
</svg>


<svg version="1.1" id="pin-multiples" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path fill="#FFFFFF" d="M25.237,3.738C22.77,1.328,19.489,0,16.001,0H16h-0.016c-3.493,0.004-6.775,1.339-9.242,3.759
	c-2.477,2.422-3.839,5.646-3.835,9.077c0.004,3.605,1.366,6.996,3.835,9.549l8.567,8.878L16.021,32l0.71-0.739l8.548-8.898
	c2.464-2.555,3.818-5.948,3.814-9.554C29.089,9.376,27.719,6.155,25.237,3.738z"></path>
<path d="M24.549,4.444c-2.188-2.136-5.214-3.462-8.562-3.458c-3.35,0.004-6.372,1.335-8.554,3.477
	c-2.188,2.139-3.544,5.102-3.54,8.372c0.004,3.462,1.365,6.598,3.558,8.864l8.568,8.879l8.548-8.898
	c2.188-2.271,3.543-5.409,3.539-8.871C28.103,9.54,26.742,6.58,24.549,4.444z M16,22.535c-5.2,0-9.416-4.216-9.416-9.417
	c0-5.2,4.215-9.415,9.416-9.415s9.415,4.215,9.415,9.415C25.415,18.319,21.2,22.535,16,22.535z"></path>
</svg>


<svg version="1.1" id="pin-person" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path fill="#FFFFFF" d="M25.246,3.749C22.777,1.332,19.494,0,16,0S9.221,1.332,6.752,3.75c-2.479,2.419-3.845,5.642-3.845,9.072
	c0,3.604,1.358,6.997,3.825,9.552l8.557,8.888L16,32l0.711-0.738l8.559-8.889c2.465-2.555,3.823-5.947,3.823-9.551
	C29.093,9.392,27.727,6.169,25.246,3.749z"></path>
<g>
	<path d="M24.559,4.455C22.373,2.315,19.35,0.986,16,0.986S9.627,2.315,7.441,4.454c-2.189,2.138-3.549,5.098-3.549,8.368
		c0,3.461,1.358,6.598,3.549,8.868L16,30.578l8.559-8.889c2.189-2.271,3.549-5.406,3.549-8.868
		C28.105,9.552,26.748,6.592,24.559,4.455z M16,22.535c-5.2,0-9.416-4.217-9.416-9.417S10.799,3.703,16,3.703
		s9.415,4.215,9.415,9.415S21.2,22.535,16,22.535z"></path>
	<g>
		<path d="M16.001,5.656c2.424,0,4.391,1.964,4.391,4.393c0,2.421-1.967,4.391-4.391,4.391c-2.428,0-4.395-1.97-4.395-4.391
			C11.607,7.621,13.574,5.656,16.001,5.656z"></path>
	</g>
	<path d="M19.766,15.699h-7.533c-1.012,0-1.883,0.871-1.883,1.888v1.879h11.3v-1.879C21.648,16.568,20.781,15.699,19.766,15.699z"></path>
</g>
</svg>


<svg version="1.1" id="pin-room-function" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path fill="#FFFFFF" d="M25.246,3.749C22.778,1.332,19.494,0,16,0S9.221,1.332,6.752,3.75c-2.479,2.419-3.845,5.642-3.845,9.072
	c0,3.604,1.358,6.996,3.825,9.552l8.557,8.888L16,32l0.711-0.738l8.558-8.889c2.466-2.555,3.824-5.947,3.824-9.551
	C29.093,9.392,27.727,6.169,25.246,3.749z"></path>
<g>
	<path d="M24.558,4.455C22.373,2.315,19.349,0.986,16,0.986c-3.349,0-6.373,1.329-8.558,3.468c-2.19,2.138-3.549,5.098-3.549,8.368
		c0,3.461,1.358,6.598,3.549,8.867L16,30.578l8.558-8.889c2.19-2.27,3.549-5.406,3.549-8.867
		C28.106,9.552,26.748,6.592,24.558,4.455z M16,22.535c-5.2,0-9.416-4.216-9.416-9.417c0-5.2,4.215-9.415,9.416-9.415
		s9.415,4.215,9.415,9.415C25.415,18.319,21.2,22.535,16,22.535z"></path>
	<rect x="10.082" y="11.056" width="11.836" height="4.25"></rect>
	<path d="M11.972,16.207c0.798,0,1.441,0.636,1.441,1.419c0,0.782-0.643,1.418-1.441,1.418c-0.79,0-1.435-0.636-1.435-1.418
		C10.537,16.842,11.182,16.207,11.972,16.207z"></path>
	<path d="M20.167,16.207c0.798,0,1.439,0.636,1.439,1.419c0,0.782-0.642,1.418-1.439,1.418c-0.793,0-1.434-0.636-1.434-1.418
		C18.733,16.842,19.374,16.207,20.167,16.207z"></path>
	<path d="M16.073,16.207c0.792,0,1.436,0.636,1.436,1.419c0,0.782-0.644,1.418-1.436,1.418c-0.797,0-1.441-0.636-1.441-1.418
		C14.632,16.842,15.277,16.207,16.073,16.207z"></path>
	<path d="M11.972,7.208c0.798,0,1.441,0.636,1.441,1.418s-0.643,1.418-1.441,1.418c-0.79,0-1.435-0.636-1.435-1.418
		S11.182,7.208,11.972,7.208z"></path>
	<ellipse cx="20.167" cy="8.626" rx="1.439" ry="1.418"></ellipse>
	<path d="M16.073,7.208c0.792,0,1.436,0.636,1.436,1.418s-0.644,1.418-1.436,1.418c-0.797,0-1.441-0.636-1.441-1.418
		S15.277,7.208,16.073,7.208z"></path>
</g>
</svg>

<svg version="1.1" id="pinned" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M31.011,11.131L20.745,0.866l-7.318,9.714c-0.403-0.05-0.81-0.076-1.219-0.076c-2.535,0-5.033,0.983-7.032,2.769
	l-1.578,1.41l6.257,6.255l-8.861,8.86l-0.004,1.325l1.341,0.01l8.859-8.859l6.004,6.003l1.409-1.578
	c2.096-2.346,3.057-5.346,2.693-8.25L31.011,11.131z"></path>
</svg>

<svg version="1.1" id="play-demo-start" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
	<polygon points="11,22 23,16 11,10 	"></polygon>
</g>
</svg>

<svg version="1.1" id="power-start" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M18,7.18V1h-4v6.18C8.326,8.134,4,13.055,4,19c0,6.628,5.371,12,12,12c6.629,0,12-5.372,12-12
	C28,13.055,23.674,8.134,18,7.18z M16,29c-5.514,0-10-4.486-10-10c0-4.829,3.441-8.869,8-9.798V19h4V9.202
	c4.559,0.929,8,4.969,8,9.798C26,24.514,21.514,29,16,29z"></path>
</svg>


<svg version="1.1" id="presentationfile" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M1,4v4v20h30V8V4H1z M29,26H3V10h26V26z"></path>
	<path d="M16,25c3.865,0,7-3.135,7-7s-3.135-7-7-7v7H9C9,21.865,12.135,25,16,25z M16,19h1v-1v-5.916c2.834,0.477,5,2.948,5,5.916
		c0,3.309-2.691,6-6,6c-2.968,0-5.439-2.166-5.917-5H16z"></path>
	<path d="M15,11.08c-3.064,0.439-5.481,2.856-5.92,5.92H15V11.08z"></path>
</g>
</svg>


<svg version="1.1" id="print" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M26,6V1H6v5H2v12h4v4v1l8,8h1h11V18h4V6H26z M8,3h16v3H8V3z M15,29v-7H8v-8h16v15H15z"></path>
</svg>


<svg version="1.1" id="priority-emergency" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 18 18" style="enable-background:new 0 0 18 18;" xml:space="preserve">
<path d="M17.4,7.6l-7-7c-0.8-0.8-2-0.8-2.8,0l-7,7c-0.8,0.8-0.8,2,0,2.8l7,7c0.8,0.8,2,0.8,2.8,0l7-7C18.2,9.6,18.2,8.4,17.4,7.6z
	 M8,3.4h2v3.2l-0.5,4.9H8.5L8,6.6V3.4z M10.1,14.6H7.9v-2h2.1V14.6z"></path>
</svg>


<svg version="1.1" id="priority-high" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 18 18" style="enable-background:new 0 0 18 18;" xml:space="preserve">
<path d="M9,6.1l4.5,7.9h-9L9,6.1 M9,1C8.6,1,8.3,1.2,8,1.7L0.2,15.3c-0.6,1-0.1,1.7,1.1,1.7h15.4c1.1,0,1.6-0.8,1.1-1.7L10,1.7
	C9.7,1.2,9.4,1,9,1L9,1z"></path>
</svg>


<svg version="1.1" id="priority-low" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 18 18" style="enable-background:new 0 0 18 18;" xml:space="preserve">
<path d="M13.5,4L9,11.9L4.5,4H13.5 M16.7,1H1.3C0.2,1-0.3,1.8,0.2,2.7L8,16.3C8.3,16.8,8.6,17,9,17c0.4,0,0.7-0.2,1-0.7l7.8-13.5
	C18.3,1.8,17.8,1,16.7,1L16.7,1z"></path>
</svg>


<svg version="1.1" id="priority-medium" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 18 18" style="enable-background:new 0 0 18 18;" xml:space="preserve">
<path d="M15,3v12H3V3H15 M16,0H2C0.9,0,0,0.9,0,2v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V2C18,0.9,17.1,0,16,0L16,0z"></path>
</svg>


<svg version="1.1" id="project-planning" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M25,1l-7.646,7.646l-0.707,0.707l-1.293,1.293l-0.707,0.707l-1.293,1.293l-0.707,0.707l-1.293,1.293l-0.707,0.707
		l-1.293,1.293l-0.707,0.707l-1.293,1.293l-0.707,0.707L4,22l-3,3l6,6l3-3L31,7L25,1z M8.586,26.586l-3.172-3.172l2.646-2.647
		l1.586,1.586l0.707-0.707L8.768,20.06l1.293-1.293l1.586,1.586l0.707-0.707l-1.586-1.586l1.293-1.293l1.586,1.586l0.707-0.707
		l-1.586-1.586l1.293-1.293l1.586,1.586l0.707-0.707l-1.586-1.586l1.293-1.293l1.586,1.586l0.707-0.707l-1.586-1.586l1.293-1.293
		l1.586,1.586l0.707-0.707l-1.586-1.586L25,3.829L28.172,7L8.586,26.586z"></path>
	<circle cx="25" cy="7" r="1"></circle>
</g>
</svg>


<svg version="1.1" id="rating-star" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M31,13l-11-1L16,1l-4,11L1,13l9,7L7,31l9-7l9,7l-3-11L31,13z M17.228,22.421L16,21.466l-1.228,0.955l-4.264,3.316
	l1.421-5.211l0.351-1.287l-1.052-0.818l-5-3.889l5.953-0.541l1.265-0.115l0.434-1.193L16,6.852l2.121,5.831l0.434,1.193l1.265,0.115
	l5.953,0.541l-4.999,3.889L19.72,19.24l0.351,1.287l1.421,5.211L17.228,22.421z"></path>
</svg>


<svg version="1.1" id="rating-star-filled" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M31,13l-11-1L16,1l-4,11L1,13l9,7L7,31l9-7l9,7l-3-11L31,13z"></path>
</svg>

<svg version="1.1" id="read" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M16,4L1,12v1v15h30V13v-1L16,4z M7,11h18v4.2L16,20l-9-4.8V11z M29,26H3V14.066L16,21l13-6.934V26z"></path>
</svg>

<svg version="1.1" id="ready" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M16,2C8.269,2,2,8.269,2,16c0,7.73,6.269,14,14,14c7.73,0,14-6.27,14-14C30,8.269,23.73,2,16,2z M14,21.414l-4.707-4.707
	l1.414-1.414L14,18.586l7.293-7.293l1.414,1.414L14,21.414z"></path>
</svg>


<svg version="1.1" id="recommended" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<polygon points="14.5,13.586 12.207,11.293 10.793,12.707 14.5,16.414 21.207,9.707 19.793,8.293 		"></polygon>
	</g>
	<g>
		<path d="M27,12c0-6.074-4.924-11-11-11C9.926,1,5,5.926,5,12c0,4.21,2.369,7.865,5.844,9.714L10,31l6-4l6,4l-0.844-9.286
			C24.632,19.865,27,16.21,27,12z M16,21c-4.971,0-9-4.029-9-9s4.029-9,9-9s9,4.029,9,9S20.971,21,16,21z"></path>
	</g>
</g>
</svg>


<svg version="1.1" id="recurring" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M21.5,1l-1.4,1.4l4.3,4.3h-9.8C8,6.8,2.5,12.2,2.5,18.9c0,1.1,0.2,2.2,0.4,3.2l1.7-1.7c-0.1-0.5-0.1-1-0.1-1.5
		c0-5.6,4.5-10.1,10.1-10.1h9.8l-4.3,4.3l1.4,1.4l6.8-6.8L21.5,1z"></path>
	<path d="M27.3,11.6c0.1,0.5,0.1,1,0.1,1.5c0,5.6-4.5,10.1-10.1,10.1H7.6l4.3-4.3l-1.4-1.4l-6.8,6.8l6.8,6.8l1.4-1.4l-4.3-4.3h9.8
		c6.7,0,12.1-5.4,12.1-12.1c0-1.1-0.2-2.2-0.4-3.2L27.3,11.6z"></path>
</g>
</svg>



<svg version="1.1" id="recurring-exception" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
	<style type="text/css">
		.exception{fill:#E05702;}
	</style>
	<path d="M21.5,1l-1.4,1.4l4.3,4.3h-9.8C8,6.8,2.5,12.2,2.5,18.9c0,1.1,0.2,2.2,0.4,3.2l1.7-1.7c-0.1-0.5-0.1-1-0.1-1.5
		c0-5.6,4.5-10.1,10.1-10.1h9.8l-4.3,4.3l1.4,1.4l6.8-6.8L21.5,1z"></path>
	<g>
		<path d="M26.2,18.1l1.5,1.5c1.2-1.9,1.9-4.1,1.9-6.4c0-1.1-0.2-2.2-0.4-3.2l-1.7,1.7c0.1,0.5,0.1,1,0.1,1.5
			C27.5,14.9,27,16.6,26.2,18.1z"></path>
		<polygon points="15.2,25.2 14.2,24.2 15.2,23.2 7.6,23.2 11.9,18.9 10.5,17.5 3.7,24.2 10.5,31 11.9,29.6 7.6,25.2"></polygon>
	</g>
	<g>
		<rect x="18.8" y="19.8" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -10.3252 23.5218)" class="exception" width="8.8" height="8.8"></rect>
	</g>
</svg>

<svg version="1.1" id="refresh-redo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M17,29c-5.514,0-10-4.486-10-10S11.486,9,17,9h6.586l-4.293,4.293l1.414,1.414L27.414,8l-6.707-6.707l-1.414,1.414L23.586,7
	H17C10.383,7,5,12.383,5,19s5.383,12,12,12c3.205,0,6.218-1.248,8.485-3.515l-1.414-1.414C22.182,27.96,19.671,29,17,29z"></path>
</svg>


<svg version="1.1" id="relationship" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M24,9c2.209,0,4-1.791,4-4s-1.791-4-4-4s-4,1.791-4,4S21.791,9,24,9z M24,3c1.103,0,2,0.897,2,2c0,1.102-0.897,2-2,2
		c-1.104,0-2-0.898-2-2C22,3.897,22.896,3,24,3z"></path>
	<path d="M27,11h-6l-5,5l-5-5H5c-1.105,0-2,0.896-2,2v8l2,2v7c0,0.553,0.447,1,1,1h4c0.553,0,1-0.447,1-1V16l5,5l5-5v14
		c0,0.553,0.447,1,1,1h4c0.553,0,1-0.447,1-1v-7l2-2v-8C29,11.896,28.104,11,27,11z"></path>
	<path d="M8,9c2.209,0,4-1.791,4-4s-1.791-4-4-4S4,2.791,4,5S5.791,9,8,9z M8,3c1.103,0,2,0.897,2,2c0,1.102-0.897,2-2,2
		C6.896,7,6,6.102,6,5C6,3.897,6.896,3,8,3z"></path>
</g>
</svg>

<svg version="1.1" id="remove-delete" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="9" y="15" width="14" height="2"></rect>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>

<svg version="1.1" id="remove-trash" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="12" y="2" width="8" height="2"></rect>
	<path d="M6,5v5h1v20h18V10h1V5H6z M23,28H9V12h14V28z"></path>
	<rect x="11" y="14" width="1" height="12"></rect>
	<rect x="14" y="14" width="1" height="12"></rect>
	<rect x="17" y="14" width="1" height="12"></rect>
	<rect x="20" y="14" width="1" height="12"></rect>
</g>
</svg>


<svg version="1.1" id="report" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="10" y="7" width="5" height="21"></rect>
	<rect x="17" y="17" width="5" height="1"></rect>
	<rect x="17" y="15" width="5" height="1"></rect>
	<rect x="17" y="19" width="5" height="1"></rect>
	<rect x="17" y="21" width="5" height="1"></rect>
	<rect x="17" y="23" width="5" height="1"></rect>
	<rect x="17" y="25" width="5" height="1"></rect>
	<rect x="17" y="27" width="5" height="1"></rect>
	<path d="M6,1v2v28h20V3V1H6z M24,29H8V5h16V29z"></path>
</g>
</svg>


<svg version="1.1" id="repository-archive" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M29,10V8h-1h-1V7V6h-1H6H5v1v1H4H3v2H1v16h30V10H29z M6,7h20v1H6V7z M29,24H3V12h26V24z"></path>
	<polygon points="19,19 20,19 20,18 20,17 19,17 19,18 13,18 13,17 12,17 12,18 12,19 13,19 	"></polygon>
</g>
</svg>

<svg version="1.1" id="reset-revert" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M19,5C12.383,5,7,10.383,7,17v6.586l-4.293-4.293l-1.414,1.414L8,27.414l6.707-6.707l-1.414-1.414L9,23.586V17
	c0-5.514,4.486-10,10-10s10,4.486,10,10c0,2.671-1.04,5.182-2.929,7.071l1.414,1.414C29.752,23.218,31,20.205,31,17
	C31,10.383,25.617,5,19,5z"></path>
</svg>

<svg version="1.1" id="restore" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M19,4C12.383,4,7,9.383,7,16v8.586l-4.293-4.293l-1.414,1.414L8,28.414l6.707-6.707l-1.414-1.414L9,24.586V16
		c0-5.514,4.486-10,10-10s10,4.486,10,10s-4.486,10-10,10v2c6.617,0,12-5.383,12-12S25.617,4,19,4z"></path>
	<polygon points="20.293,18.707 21.707,17.293 20.06,15.646 25.354,10.354 24.646,9.646 19.354,14.939 16.707,12.293 15.293,13.707 
		17.94,16.354 16.646,17.646 17.354,18.354 18.646,17.06 	"></polygon>
</g>
</svg>

<svg version="1.1" id="retrieve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="12" y="23" width="8" height="1"></rect>
	<rect x="12" y="25" width="8" height="1"></rect>
	<path d="M24,29V17H8v12H3v2h5h16h5v-2H24z M10,29V19h12v10H10z"></path>
	<polygon points="15,5.414 15,15 17,15 17,5.414 20.293,8.707 21.707,7.293 16,1.586 10.293,7.293 11.707,8.707 	"></polygon>
</g>
</svg>


<svg version="1.1" id="role" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M18,5V1h-4v4H6v26h20V5H18z M16,2c0.552,0,1,0.448,1,1s-0.448,1-1,1s-1-0.448-1-1S15.448,2,16,2z M24,29H8V7h6v2h4V7h6V29z
		"></path>
	<path d="M16,11c-2.762,0-5,2.238-5,5s2.238,5,5,5s5-2.238,5-5S18.762,11,16,11z M16,19c-1.654,0-3-1.346-3-3s1.346-3,3-3
		s3,1.346,3,3S17.654,19,16,19z"></path>
	<path d="M12,23c-1.104,0-2,0.896-2,2v2h12v-2c0-1.104-0.896-2-2-2H12z"></path>
</g>
</svg>


<svg version="1.1" id="room-function" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="3" y="11.454" width="26" height="9.331"></rect>
	<ellipse cx="7.156" cy="25.881" rx="3.157" ry="3.119"></ellipse>
	<ellipse cx="25.156" cy="25.881" rx="3.158" ry="3.119"></ellipse>
	<ellipse cx="16.156" cy="25.881" rx="3.157" ry="3.119"></ellipse>
	<ellipse cx="7.156" cy="6.119" rx="3.157" ry="3.119"></ellipse>
	<ellipse cx="25.156" cy="6.119" rx="3.158" ry="3.119"></ellipse>
	<ellipse cx="16.156" cy="6.119" rx="3.157" ry="3.119"></ellipse>
</g>
</svg>


<svg version="1.1" id="rss-feed" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M3,3v5c11.598,0,21,9.402,21,21h5C29,14.641,17.359,3,3,3z"></path>
	<path d="M3,13v5c6.076,0,11,4.924,11,11h5C19,20.163,11.837,13,3,13z"></path>
	<circle cx="4.5" cy="27.5" r="3.5"></circle>
</g>
</svg>

<svg version="1.1" id="run-running" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<path d="M11,11c-2.761,0-5,2.239-5,5s2.239,5,5,5c2.761,0,5-2.239,5-5S13.761,11,11,11z M11,18c-1.105,0-2-0.896-2-2s0.895-2,2-2
			c1.104,0,2,0.896,2,2S12.104,18,11,18z"></path>
	</g>
	<g>
		<path d="M30.121,6.879C29.578,6.337,28.828,6,28,6H11C8.239,6,5.739,7.119,3.929,8.929C2.119,10.738,1,13.238,1,16
			s1.119,5.262,2.929,7.071C5.739,24.881,8.239,26,11,26c2.761,0,5.257-1.123,7.071-2.929c0,0,0,0,0,0
			c0.002-0.002,0.003-0.003,0.004-0.005c3.011-2.998,12.045-11.945,12.045-11.945C30.665,10.579,31,9.829,31,9
			S30.665,7.421,30.121,6.879z M16.661,21.652l-0.001,0.001C15.14,23.167,13.13,24,11,24c-2.137,0-4.146-0.832-5.657-2.343
			C3.832,20.146,3,18.137,3,16s0.832-4.146,2.343-5.657C6.854,8.832,8.863,8,11,8c2.049,0,4.097,0.783,5.657,2.343
			C19.774,13.461,19.775,18.533,16.661,21.652z M20.882,17.461c0.444-3.022-0.485-6.206-2.811-8.533
			C17.727,8.585,17.36,8.283,16.982,8h8.2c-0.374,1.056-0.148,2.276,0.697,3.121c0.246,0.246,0.528,0.428,0.824,0.571
			C25.148,13.231,22.924,15.436,20.882,17.461z M28,10c-0.552,0-1-0.448-1-1s0.448-1,1-1c0.552,0,1,0.448,1,1S28.552,10,28,10z"></path>
	</g>
</g>
</svg>


<svg version="1.1" id="satellitedish" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M28,21l-9-9l2.494-4.157C21.645,7.934,21.812,8,22,8c0.553,0,1-0.447,1-1s-0.447-1-1-1s-1,0.447-1,1
		c0,0.188,0.066,0.356,0.157,0.506L17,10L8,1C5.45,3.549,4,7.11,4,11c0,3.891,1.45,7.451,4,10c2.548,2.549,6.109,4,10,4
		C21.89,25,25.451,23.549,28,21z M6,11c0-2.614,0.745-5.053,2.127-7.045l16.918,16.918C23.053,22.255,20.614,23,18,23
		c-3.336,0-6.385-1.213-8.586-3.414C7.213,17.385,6,14.336,6,11z"></path>
	<rect x="11" y="27" width="10" height="4"></rect>
</g>
</svg>


<svg version="1.1" id="save" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M3,3v26h7h12h3l4-4V3H3z M27,24.171L24.172,27H22v-2H10v2H5V5h22V24.171z"></path>
	<path d="M16,22c3.313,0,6-2.687,6-6s-2.687-6-6-6s-6,2.686-6,6S12.686,22,16,22z M16,14c1.104,0,2,0.896,2,2s-0.896,2-2,2
		s-2-0.896-2-2S14.896,14,16,14z"></path>
</g>
</svg>


<svg version="1.1" id="search" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M12,1C5.926,1,1,5.926,1,12c0,6.074,4.926,11,11,11s11-4.926,11-11C23,5.926,18.074,1,12,1z M12,21c-4.962,0-9-4.038-9-9
		s4.038-9,9-9s9,4.038,9,9S16.962,21,12,21z"></path>
	<rect x="23.879" y="21.05" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -10.7696 26)" width="4.243" height="9.899"></rect>
	<circle cx="21" cy="21" r="1"></circle>
</g>
</svg>


<svg version="1.1" id="select-area" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve">
<g>
	<polygon points="3.2,1.2 1.2,1.2 1.2,3.2 3.2,3.2 3.2,1.2 	"></polygon>
	<polygon points="7.2,1.2 5.2,1.2 5.2,3.2 7.2,3.2 7.2,1.2 	"></polygon>
	<polygon points="11.2,1.2 9.2,1.2 9.2,3.2 11.2,3.2 11.2,1.2 	"></polygon>
	<polygon points="15.2,1.2 13.2,1.2 13.2,3.2 15.2,3.2 15.2,1.2 	"></polygon>
	<polygon points="19.2,1.2 17.2,1.2 17.2,3.2 19.2,3.2 19.2,1.2 	"></polygon>
	<polygon points="23.2,1.2 21.2,1.2 21.2,3.2 23.2,3.2 23.2,1.2 	"></polygon>
	<polygon points="27.2,1.2 25.2,1.2 25.2,3.2 27.2,3.2 27.2,1.2 	"></polygon>
	<polygon points="27.2,5.2 25.2,5.2 25.2,7.2 27.2,7.2 27.2,5.2 	"></polygon>
	<polygon points="27.2,9.2 25.2,9.2 25.2,11.2 27.2,11.2 27.2,9.2 	"></polygon>
	<polygon points="27.2,13.2 25.2,13.2 25.2,15.2 27.2,15.2 27.2,13.2 	"></polygon>
	<polygon points="3.2,5.2 1.2,5.2 1.2,7.2 3.2,7.2 3.2,5.2 	"></polygon>
	<polygon points="3.2,9.2 1.2,9.2 1.2,11.2 3.2,11.2 3.2,9.2 	"></polygon>
	<polygon points="3.2,13.2 1.2,13.2 1.2,15.2 3.2,15.2 3.2,13.2 	"></polygon>
	<polygon points="3.2,17.2 1.2,17.2 1.2,19.2 3.2,19.2 3.2,17.2 	"></polygon>
	<polygon points="3.2,21.2 1.2,21.2 1.2,23.2 3.2,23.2 3.2,21.2 	"></polygon>
	<polygon points="3.2,25.2 1.2,25.2 1.2,27.2 3.2,27.2 3.2,25.2 	"></polygon>
	<polygon points="7.2,25.2 5.2,25.2 5.2,27.2 7.2,27.2 7.2,25.2 	"></polygon>
	<polygon points="11.2,25.2 9.2,25.2 9.2,27.2 11.2,27.2 11.2,25.2 	"></polygon>
	<polygon points="15.2,25.2 13.2,25.2 13.2,27.2 15.2,27.2 15.2,25.2 	"></polygon>
	<polygon points="31,28.9 26,23.8 28.8,21 18.5,18.2 21.2,28.5 24,25.7 29.1,30.8 	"></polygon>
</g>
</svg>


<svg version="1.1" id="settings" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M30.366,5.876l-4.245,4.246C25.535,10.707,24.768,11,24,11s-1.535-0.293-2.121-0.879c-1.172-1.171-1.172-3.071-0.001-4.243
		l4.245-4.245C25.164,1.226,24.108,1,23,1c-4.419,0-8,3.582-8,8c0,0.914,0.161,1.789,0.443,2.606L2.025,25.025
		c-1.367,1.367-1.367,3.583,0,4.95C2.709,30.658,3.605,31,4.5,31s1.791-0.342,2.475-1.025l13.418-13.418
		C21.211,16.839,22.086,17,23,17c4.418,0,8-3.582,8-8C31,7.891,30.773,6.835,30.366,5.876z M23,15c-0.654,0-1.312-0.112-1.954-0.334
		l-1.183-0.409l-0.885,0.885L5.561,28.56C5.277,28.844,4.9,29,4.5,29s-0.777-0.156-1.06-0.44C3.156,28.277,3,27.9,3,27.5
		c0-0.401,0.156-0.777,0.44-1.061l13.418-13.418l0.885-0.884l-0.408-1.182C17.112,10.312,17,9.654,17,9
		c0-2.901,2.069-5.328,4.81-5.881l-1.347,1.346c-1.948,1.95-1.947,5.122,0.001,7.07C21.408,12.479,22.664,13,24,13
		c1.335,0,2.591-0.52,3.535-1.465l1.347-1.347C28.328,12.93,25.901,15,23,15z"></path>
	<circle cx="4.5" cy="27.5" r="1"></circle>
</g>
</svg>

<svg version="1.1" id="settings-manage" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<g>
		<path d="M27.5,16c0-0.615-0.062-1.213-0.155-1.802L31,11l-3.105-5.098l-4.359,1.424c-1.042-0.906-2.248-1.623-3.569-2.109L19,1h-6
			l-0.966,4.217c-1.321,0.486-2.527,1.203-3.57,2.11L4.105,5.902L1,11l3.655,3.199C4.562,14.787,4.5,15.386,4.5,16
			c0,0.615,0.062,1.213,0.155,1.802L1,21l3.106,5.098l4.358-1.424c1.042,0.907,2.249,1.624,3.57,2.11L13,31h6l0.966-4.217
			c1.321-0.486,2.527-1.203,3.569-2.109l4.359,1.424L31,21l-3.655-3.197C27.438,17.214,27.5,16.615,27.5,16z M28.416,21.397
			l-1.406,2.308l-2.854-0.932l-1.078-0.352l-0.855,0.744c-0.868,0.755-1.86,1.341-2.947,1.742l-1.017,0.375l-0.242,1.056L17.406,29
			h-2.812l-0.61-2.664l-0.242-1.056l-1.017-0.375c-1.088-0.4-2.08-0.986-2.948-1.742L8.921,22.42l-1.078,0.353L4.99,23.705
			l-1.406-2.308l2.388-2.09l0.83-0.727L6.63,17.49C6.543,16.934,6.5,16.446,6.5,16c0-0.446,0.043-0.934,0.13-1.49l0.172-1.09
			l-0.83-0.727l-2.388-2.091l1.406-2.308l2.854,0.933L8.921,9.58l0.855-0.744c0.869-0.756,1.86-1.342,2.948-1.742l1.017-0.375
			l0.242-1.056L14.594,3h2.812l0.61,2.664l0.242,1.056l1.017,0.375c1.087,0.4,2.079,0.986,2.947,1.742l0.855,0.744l1.078-0.352
			l2.854-0.933l1.406,2.308l-2.388,2.089l-0.831,0.727l0.173,1.091C25.457,15.066,25.5,15.553,25.5,16s-0.043,0.935-0.131,1.49
			l-0.173,1.091l0.831,0.727L28.416,21.397z"></path>
	</g>
	<g>
		<path d="M16,10c-3.314,0-6,2.685-6,6s2.686,6,6,6c3.315,0,6-2.685,6-6S19.315,10,16,10z M16,18c-1.104,0-2-0.896-2-2s0.896-2,2-2
			s2,0.896,2,2S17.104,18,16,18z"></path>
	</g>
</g>
</svg>


<svg version="1.1" id="sign-out" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="22.244,7.32 20.83,8.72 27.123,15 10,15 10,17 27.123,17 20.83,23.307 22.244,24.728 30.952,16.023 	"></polygon>
	<polygon points="3,3 16,3 16,1 1,1 1,31 16,31 16,29 3,29 	"></polygon>
</g>
</svg>


<svg version="1.1" id="sort" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="5.434,13 16.178,1 26.921,13 	"></polygon>
	<polygon points="5.434,19 16.178,31 26.921,19 	"></polygon>
</g>
</svg>


<svg version="1.1" id="sort-ascending" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="5.434,13 16.178,1 26.921,13 	"></polygon>
	<polygon fill="#E0E0E0" points="5.434,19 16.178,31 26.921,19 	"></polygon>
</g>
</svg>


<svg version="1.1" id="sort-descending" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon fill="#E0E0E0" points="5.434,13 16.178,1 26.921,13 	"></polygon>
	<polygon points="5.434,19 16.178,31 26.921,19 	"></polygon>
</g>
</svg>


<svg version="1.1" id="spaces" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M1,6v20h30V6H1z M29,24H3V8h26V24z"></path>
	<path d="M28,9H17v6h11V9z M27,14h-9v-4h9V14z"></path>
	<rect x="4" y="9" width="11" height="6"></rect>
	<path d="M15,17H4v6h11V17z M14,22H5v-4h9V22z"></path>
	<path d="M28,17H17v6h11V17z M27,22h-9v-4h9V22z"></path>
</g>
</svg>


<svg version="1.1" id="spellcheck" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M6.832,16.62v-3.229c0-0.376-0.084-0.678-0.252-0.905c-0.168-0.229-0.384-0.406-0.648-0.534
		c-0.264-0.128-0.556-0.214-0.876-0.258c-0.32-0.044-0.636-0.066-0.948-0.066c-0.344,0-0.686,0.034-1.026,0.103
		c-0.34,0.067-0.646,0.182-0.918,0.342c-0.272,0.16-0.496,0.372-0.672,0.636c-0.176,0.264-0.276,0.596-0.3,0.996h1.704
		c0.032-0.336,0.144-0.576,0.336-0.72c0.192-0.145,0.456-0.217,0.792-0.217c0.152,0,0.294,0.011,0.426,0.03
		c0.132,0.021,0.248,0.061,0.348,0.12c0.1,0.059,0.18,0.143,0.24,0.252c0.06,0.108,0.09,0.254,0.09,0.439
		c0.008,0.176-0.044,0.31-0.156,0.401c-0.112,0.093-0.264,0.162-0.456,0.21c-0.192,0.048-0.412,0.084-0.66,0.108
		c-0.249,0.023-0.5,0.056-0.756,0.096c-0.256,0.04-0.51,0.095-0.762,0.162c-0.252,0.068-0.476,0.17-0.672,0.306
		c-0.196,0.137-0.356,0.318-0.48,0.547C1.062,15.666,1,15.956,1,16.308c0,0.32,0.054,0.597,0.162,0.828
		c0.108,0.233,0.258,0.425,0.45,0.576c0.192,0.152,0.416,0.264,0.672,0.336c0.256,0.072,0.532,0.108,0.828,0.108
		c0.384,0,0.76-0.057,1.128-0.168C4.608,17.876,4.928,17.68,5.2,17.4c0.008,0.104,0.022,0.206,0.042,0.306
		c0.02,0.1,0.046,0.198,0.078,0.294h1.728c-0.08-0.128-0.136-0.32-0.168-0.576C6.848,17.168,6.832,16.9,6.832,16.62z M5.128,15.6
		c0,0.097-0.01,0.225-0.03,0.385c-0.02,0.16-0.074,0.317-0.162,0.474c-0.088,0.156-0.224,0.29-0.408,0.402
		c-0.184,0.111-0.444,0.168-0.78,0.168c-0.136,0-0.268-0.013-0.396-0.036c-0.128-0.024-0.24-0.066-0.336-0.126
		c-0.096-0.06-0.172-0.143-0.228-0.246c-0.056-0.104-0.084-0.232-0.084-0.384c0-0.16,0.028-0.292,0.084-0.396
		c0.056-0.103,0.13-0.189,0.222-0.258c0.092-0.068,0.2-0.122,0.324-0.162c0.124-0.04,0.25-0.072,0.378-0.096
		C3.848,15.3,3.984,15.28,4.12,15.264c0.136-0.016,0.266-0.036,0.39-0.06c0.124-0.024,0.24-0.054,0.348-0.09
		c0.108-0.036,0.198-0.086,0.27-0.15V15.6z"></path>
	<path d="M9.772,17.208h0.024c0.184,0.344,0.456,0.588,0.816,0.732c0.36,0.144,0.768,0.216,1.224,0.216
		c0.312,0,0.62-0.064,0.924-0.192c0.304-0.128,0.578-0.324,0.822-0.588c0.244-0.264,0.442-0.602,0.594-1.014
		c0.152-0.412,0.228-0.902,0.228-1.471c0-0.567-0.076-1.058-0.228-1.47c-0.152-0.412-0.35-0.75-0.594-1.014
		c-0.244-0.265-0.518-0.46-0.822-0.588c-0.304-0.128-0.612-0.192-0.924-0.192c-0.384,0-0.754,0.074-1.11,0.222
		c-0.356,0.148-0.638,0.383-0.846,0.702H9.856v-3.12H8.152V18h1.62V17.208z M9.88,14.148c0.056-0.24,0.144-0.452,0.264-0.637
		c0.12-0.184,0.272-0.33,0.456-0.438c0.184-0.108,0.4-0.162,0.648-0.162c0.256,0,0.474,0.054,0.654,0.162
		c0.18,0.107,0.33,0.254,0.45,0.438c0.12,0.185,0.208,0.397,0.264,0.637c0.056,0.239,0.084,0.491,0.084,0.756
		c0,0.256-0.028,0.504-0.084,0.744c-0.056,0.239-0.144,0.451-0.264,0.636c-0.12,0.184-0.27,0.33-0.45,0.438
		c-0.18,0.108-0.398,0.162-0.654,0.162c-0.248,0-0.464-0.054-0.648-0.162c-0.184-0.107-0.336-0.254-0.456-0.438
		c-0.12-0.185-0.209-0.397-0.264-0.636c-0.056-0.24-0.084-0.488-0.084-0.744C9.796,14.64,9.824,14.388,9.88,14.148z"></path>
	<path d="M16.156,17.268c0.272,0.28,0.602,0.498,0.99,0.654c0.388,0.156,0.814,0.234,1.278,0.234c0.824,0,1.5-0.216,2.028-0.649
		c0.528-0.432,0.848-1.06,0.96-1.884h-1.644c-0.056,0.384-0.194,0.691-0.414,0.918c-0.22,0.228-0.534,0.342-0.942,0.342
		c-0.264,0-0.488-0.06-0.672-0.18c-0.184-0.12-0.33-0.274-0.438-0.462c-0.108-0.189-0.186-0.398-0.234-0.63
		c-0.048-0.232-0.072-0.46-0.072-0.685c0-0.231,0.024-0.466,0.072-0.702c0.048-0.235,0.13-0.451,0.246-0.648
		c0.116-0.196,0.266-0.356,0.45-0.48c0.184-0.124,0.412-0.186,0.684-0.186c0.728,0,1.148,0.356,1.26,1.068h1.668
		c-0.024-0.4-0.12-0.746-0.288-1.038c-0.168-0.292-0.386-0.536-0.654-0.732c-0.268-0.196-0.572-0.342-0.912-0.438
		c-0.34-0.097-0.694-0.145-1.062-0.145c-0.504,0-0.952,0.084-1.344,0.252c-0.392,0.168-0.724,0.402-0.996,0.702
		c-0.272,0.3-0.479,0.656-0.618,1.068c-0.14,0.412-0.21,0.857-0.21,1.338c0,0.464,0.076,0.89,0.228,1.277
		C15.672,16.654,15.884,16.988,16.156,17.268z"></path>
	<polygon points="28,14 17,25 12,20 9,23 17,31 31,17 	"></polygon>
</g>
</svg>


<svg version="1.1" id="spreadsheet-listview" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M1,4v4v20h30V8V4H1z M29,26H3v-4h26V26z M29,20H3v-4h26V20z M29,14H3v-4h26V14z"></path>
</svg>


<svg version="1.1" id="status-error" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="20.293,10.293 16,14.586 11.707,10.293 10.293,11.707 14.586,16 10.293,20.293 11.707,21.707 16,17.414 
		20.293,21.707 21.707,20.293 17.414,16 21.707,11.707 	"></polygon>
	<path d="M16,2C8.269,2,2,8.269,2,16c0,7.73,6.269,14,14,14c7.73,0,14-6.27,14-14C30,8.269,23.73,2,16,2z M16,28
		C9.383,28,4,22.617,4,16S9.383,4,16,4s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>

<svg version="1.1" id="status-info" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="18,14 12,14 12,16 14,16 14,22 12,22 12,24 20,24 20,22 18,22 	"></polygon>
	<circle cx="16" cy="10" r="2"></circle>
	<path d="M16,2C8.269,2,2,8.269,2,16c0,7.73,6.269,14,14,14c7.73,0,14-6.27,14-14C30,8.269,23.73,2,16,2z M16,28
		C9.383,28,4,22.617,4,16S9.383,4,16,4s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>

<svg version="1.1" id="status-success" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="14,18.586 10.707,15.293 9.293,16.707 14,21.414 22.707,12.707 21.293,11.293 	"></polygon>
	<path d="M16,2C8.269,2,2,8.269,2,16c0,7.73,6.269,14,14,14c7.73,0,14-6.27,14-14C30,8.269,23.73,2,16,2z M16,28
		C9.383,28,4,22.617,4,16S9.383,4,16,4s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>

<svg version="1.1" id="status-warning" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,3L1,29h30L16,3z M16,7.002L27.537,27H4.463L16,7.002z"></path>
	<polygon points="15,14 15,16 15.5,21 16.5,21 17,16 17,14 	"></polygon>
	<circle cx="16" cy="23" r="1"></circle>
</g>
</svg>
<svg version="1.1" id="status-warning-major" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M16,29L31,3H1L16,29z M16,24.998L4.463,5h23.074L16,24.998z"></path>
<polygon points="15,8 15,10 15.5,15 16.5,15 17,10 17,8 "></polygon>
<circle cx="16" cy="17" r="1"></circle>
</svg>

<svg version="1.1" id="stop" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
	<rect x="11" y="11" width="10" height="10"></rect>
</g>
</svg>

<svg version="1.1" id="success-confirmation" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="14,18.586 10.707,15.293 9.293,16.707 14,21.414 22.707,12.707 21.293,11.293 	"></polygon>
	<path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
		s12,5.383,12,12S22.617,28,16,28z"></path>
</g>
</svg>


<svg version="1.1" id="table-tables" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M1,4v4v20h30V8V4H1z M19,17H3v-7h16V17z M3,26v-7h16v7H3z M29,26h-8v-7h8V26z M29,17h-8v-7h8V17z"></path>
</svg>


<svg version="1.1" id="tag" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M18,1L4,15l-3,3l13,13l3-3l14-14V1H18z M29,13.172L15.586,26.586L5.414,16.414L18.829,3H29V13.172z"></path>
	<circle cx="24" cy="8" r="2"></circle>
</g>
</svg>


<svg version="1.1" id="task" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
	<rect x="10" y="14" width="11" height="1"></rect>
	<rect x="10" y="16" width="11" height="1"></rect>
	<rect x="10" y="18" width="5" height="1"></rect>
	<path d="M17.621,3c-0.156-1-1.086-1.932-2.218-1.932S13.342,2,13.186,3H5v28h21V3H17.621z M15.403,2.331c0.69,0,1.25,0.56,1.25,1.25
	c0,0.69-0.56,1.25-1.25,1.25s-1.25-0.56-1.25-1.25C14.153,2.891,14.713,2.331,15.403,2.331z M7,24.146L12.456,29H7V24.146z M24,29
	H13.52l-0.001-6H7V5h4v2h9V5h4V29z"></path>
</svg>


<svg version="1.1" id="task-tasks" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M3,3v19v1l6,6h1h19V3H3z M27,27H10v-5H5V5h22V27z"></path>
	<polygon points="22.707,12.707 21.293,11.293 14,18.586 10.707,15.293 9.293,16.707 14,21.414 	"></polygon>
</g>
</svg>


<svg version="1.1" id="template" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M18,11H4v14h14V11z M17,12.707v10.586L11.707,18L17,12.707z M11,17.293L5.707,12h10.586L11,17.293z M10.293,18L5,23.293
		V12.707L10.293,18z M11,18.707L16.293,24H5.707L11,18.707z"></path>
	<rect x="20" y="11" width="8" height="14"></rect>
	<path d="M1,4v4v20h30V8V4H1z M29,26H3V10h26V26z"></path>
</g>
</svg>


<svg version="1.1" id="textcolor" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="6" y="25" width="20" height="6"></rect>
	<path d="M12.4,19H19.6l1.4,4h4L18,3h-4L7,23h4L12.4,19z M16,8.714L18.2,15h-4.4L16,8.714z"></path>
</g>
</svg>


<svg version="1.1" id="tile-tiles-tileview" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="19" y="3" width="10" height="10"></rect>
	<path d="M17,3h-2H3v12v2v12h12h2h12V17v-2H17V3z M15,27H5V17h10V27z M27,17v10H17V17H27z M5,15V5h10v10H5z"></path>
</g>
</svg>


<svg version="1.1" id="tile-view" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="19" y="3" width="10" height="10"></rect>
	<path d="M17,3h-2H3v12v2v12h12h2h12V17v-2H17V3z M15,27H5V17h10V27z M27,17v10H17V17H27z M5,15V5h10v10H5z"></path>
</g>
</svg>


<svg version="1.1" id="timer-complete" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve">
<g>
	<path d="M17.5,28.8c-0.7,0.1-1.4,0.2-2.1,0.2c-6.6,0-12-5.4-12-12c0-6.6,5.4-12,12-12s12,5.4,12,12c0,0.2,0,0.3,0,0.5
		c0.7,0.3,1.3,0.6,1.9,1.1c0.1-0.5,0.1-1.1,0.1-1.6c0-3.5-1.3-6.7-3.4-9.1l1.1-1.1l-2.2-2.2l-1.2,1.2c-2.1-1.5-4.5-2.5-7.3-2.7V2h1
		V1h-4.1v1h1v1.1C7.2,3.7,1.5,9.7,1.5,17c0,7.7,6.3,14,14,14c1.2,0,2.3-0.2,3.4-0.4C18.3,30.1,17.9,29.5,17.5,28.8z"></path>
	<path d="M22.1,11.2l-0.7-0.7l-4.8,4.8c-0.3-0.2-0.7-0.3-1-0.3c-1.1,0-2.1,0.9-2.1,2.1c0,1.1,0.9,2.1,2.1,2.1
		s2.1-0.9,2.1-2.1c0-0.4-0.1-0.7-0.3-1L22.1,11.2z"></path>
	<path fill="#325c80" d="M24.5,19c-3.3,0-6,2.7-6,6s2.7,6,6,6s6-2.7,6-6S27.9,19,24.5,19z M23.8,28.2l-0.7-0.7l-0.7-0.7l-2.1-2.1
		l1.4-1.4l2.1,2.1l3.5-3.5l1.4,1.4L23.8,28.2z"></path>
</g>
</svg>


<svg id="timer-start" viewBox="0 0 31 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
	<g>
		<path d="M26.7232298,19.6285686 L24.4062742,18.4690655 C24.5334523,17.7969047 24.6,17.1035743 24.6,16.395 C24.6,10.2555 19.608,5.262 13.4685,5.262 C7.33,5.262 2.3375,10.256 2.3375,16.395 C2.3375,22.5325 7.3305,27.5255 13.4685,27.5255 C14.7024215,27.5255 15.8899917,27.3237962 17,26.9516439 L17,29.5529444 C15.8945969,29.8446072 14.7338255,30 13.5365,30 C6.0365,30 0,23.8955 0,16.395 C0,9.461 5.0685,3.7325 12.0685,2.9025 L12.0685,1.5 L11.5685,1.5 L11.5685,0 L15.5685,0 L15.5685,1.5 L15.0685,1.5 L15.0685,2.9025 C17.0685,3.135 18.728,3.748 20.286,4.6625 L21.2235,3.536 L23.188,5.101 L22.3685,6.1285 C25.2455,8.624 27.109,12.296 27.1095,16.395 C27.1095,17.5087776 26.9756871,18.5917729 26.7232298,19.6285686 Z M19.9255,10.7 C20.2505,11.0255 20.32,11.4825 20.0815,11.722 L15.8285,15.9745 C15.908,16.191 15.9585,16.4215 15.9585,16.6655 C15.9585,17.769 15.0625,18.666 13.9585,18.666 C12.853,18.666 11.958,17.769 11.958,16.6655 C11.958,15.561 12.853,14.6655 13.9585,14.6655 C14.2025,14.6655 14.4335,14.7155 14.6495,14.796 L18.9025,10.5435 C19.142,10.3045 19.599,10.374 19.9255,10.7 Z M19,18 L31,24.0053101 L19,30 L19,18 Z"></path>
	</g>
</svg>


<svg id="timer-stop" viewBox="0 0 31 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
	<g>
		<path d="M24.6116621,16 C24.3707443,10.102047 19.4985821,5.3785 13.542,5.3785 C7.4315,5.3785 2.4625,10.3485 2.4625,16.458 C2.4625,22.5675 7.4315,27.536 13.542,27.536 C14.5977304,27.536 15.6168317,27.381471 16.5835,27.1014226 L16.5835,29.6529534 C15.6055309,29.8794246 14.5878999,30 13.542,30 C6.075,30 0,23.925 0,16.4585 C0,9.6295 5.0865,3.98 11.6665,3.062 L11.6665,1.6665 L10.8335,1.6665 L10.8335,0 L15.8335,0 L15.8335,1.6665 L15.0005,1.6665 L15.0005,2.9985 C16.943,3.2075 18.757,3.837 20.3665,4.7815 L21.261,3.6605 L23.2155,5.219 L22.401,6.24 C25.1553348,8.63151715 26.9450559,12.1061989 27.0758125,16 L24.6116621,16 Z M19.9675,10.2985487 C20.2925,10.6240487 20.362,11.0810487 20.1235,11.3205487 L15.8705,15.5730487 C15.95,15.7895487 16.0005,16.0200487 16.0005,16.2640487 C16.0005,17.3675487 15.1045,18.2645487 14.0005,18.2645487 C12.895,18.2645487 12,17.3675487 12,16.2640487 C12,15.1595487 12.895,14.2640487 14.0005,14.2640487 C14.2445,14.2640487 14.4755,14.3140487 14.6915,14.3945487 L18.9445,10.1420487 C19.184,9.9030487 19.641,9.9725487 19.9675,10.2985487 Z M18.5835,18 L30.5835,18 L30.5835,30 L18.5835,30 L18.5835,18 Z"></path>
	</g>
</svg>


<svg version="1.1" id="tools-toolbox" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M1,26l4,4l17-17l-4-4L1,26z M5,27.172L3.828,26L18,11.828L19.172,13L5,27.172z"></path>
	<polygon points="30,11 28,11 28,9 21,2 13,2 24,13 26,13 26,15 27,16 31,12 	"></polygon>
</g>
</svg>

<svg version="1.1" id="top" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="6" y="1" width="20" height="4"></rect>
	<polygon points="7.293,18.293 8.707,19.707 15,13.413 15,30 17,30 17,13.415 23.293,19.707 24.707,18.293 15.999,9.586 	"></polygon>
</g>
</svg>


<svg version="1.1" id="traffic" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<circle cx="17" cy="8" r="3"></circle>
	<path d="M17,19c1.656,0,3-1.344,3-3c0-1.656-1.344-3-3-3c-1.656,0-3,1.344-3,3C14,17.656,15.344,19,17,19z M17,14
		c1.103,0,2,0.896,2,2s-0.897,2-2,2s-2-0.896-2-2S15.898,14,17,14z"></path>
	<path d="M17,27c1.656,0,3-1.344,3-3c0-1.656-1.344-3-3-3c-1.656,0-3,1.344-3,3C14,25.656,15.344,27,17,27z M17,22
		c1.103,0,2,0.896,2,2s-0.897,2-2,2s-2-0.896-2-2S15.898,22,17,22z"></path>
	<path d="M28,13h-4v-2l4-6h-4V1H10v4H6l4,6v2H6l4,6v2H6l4,6v4h14v-4l4-6h-4v-2L28,13z M22,29H12V3h10V29z"></path>
</g>
</svg>


<svg version="1.1" id="underline" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<rect x="7" y="27" width="18" height="2"></rect>
	<path d="M21,3v13c0,2.762-2.238,5-5,5s-5-2.238-5-5V3H7v13c0,4.971,4.029,9,9,9s9-4.029,9-9V3H21z"></path>
</g>
</svg>


<svg version="1.1" id="unlock-nonsecure" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="19.293,15.293 16,18.586 12.707,15.293 11.293,16.707 14.586,20 11.293,23.293 12.707,24.707 16,21.414 
		19.293,24.707 20.707,23.293 17.414,20 20.707,16.707 	"></polygon>
	<path d="M16,9c-2.215,0-4.273,0.661-6,1.788V9c0-3.309,2.691-6,6-6c1.654,0,3.154,0.673,4.241,1.759l1.416-1.416
		C20.209,1.895,18.209,1,16,1c-4.419,0-8,3.582-8,8v3.467C6.145,14.436,5,17.082,5,20c0,6.074,4.926,11,11,11
		c6.076,0,11-4.926,11-11S22.076,9,16,9z M16,29c-4.971,0-9-4.029-9-9s4.029-9,9-9c4.971,0,9,4.029,9,9S20.971,29,16,29z"></path>
</g>
</svg>

<svg version="1.1" id="unread" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M1,12v16h30V12H1z M29,26H3V14.066L16,21l13-6.934V26z"></path>
</svg>

<svg version="1.1" id="upload-export" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="15,5.414 15,22 17,22 17,5.414 23.293,11.707 24.707,10.293 16,1.585 7.293,10.293 8.707,11.707 	"></polygon>
	<polygon points="29,19 29,27 3,27 3,19 1,19 1,27 1,31 3,31 29,31 31,31 31,27 31,19 	"></polygon>
</g>
</svg>


<svg version="1.1" id="user" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,21c5.523,0,10-4.477,10-10S21.523,1,16,1S6,5.477,6,11S10.477,21,16,21z M16,3c4.411,0,8,3.589,8,8s-3.589,8-8,8
		s-8-3.589-8-8S11.589,3,16,3z"></path>
	<path d="M24,23H8c-2.209,0-4,1.791-4,4v4h24v-4C28,24.791,26.209,23,24,23z"></path>
</g>
</svg>


<svg version="1.1" id="user-profile" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,21c5.523,0,10-4.477,10-10S21.523,1,16,1S6,5.477,6,11S10.477,21,16,21z M16,3c4.411,0,8,3.589,8,8s-3.589,8-8,8
		s-8-3.589-8-8S11.589,3,16,3z"></path>
	<path d="M24,23H8c-2.209,0-4,1.791-4,4v4h24v-4C28,24.791,26.209,23,24,23z"></path>
</g>
</svg>


<svg version="1.1" id="video" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="11,13 11,23 21,18 	"></polygon>
	<path d="M1,4v4v20h30V8V4H1z M29,26H3V10h26V26z"></path>
</g>
</svg>


<svg version="1.1" id="videofile" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M3,3v22v4h26v-4V3H3z M5,5h22v18H5V5z"></path>
	<polygon points="10,20 22,14 10,8 	"></polygon>
</g>
</svg>

<svg version="1.1" id="view" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,11c-3.314,0-6,2.685-6,6s2.686,6,6,6c3.315,0,6-2.685,6-6S19.315,11,16,11z M16,19c-1.106,0-2-0.895-2-2s0.894-2,2-2
		s2,0.895,2,2S17.105,19,16,19z"></path>
	<path d="M16,8C9.269,8,4.147,11.625,1,17c3.147,5.375,8.269,9,15,9s11.854-3.625,15-9C27.854,11.625,22.73,8,16,8z M16,24
		c-5.164,0-9.612-2.475-12.642-7c3.029-4.525,7.477-7,12.642-7s9.612,2.475,12.642,7C25.612,21.525,21.164,24,16,24z"></path>
</g>
</svg>

<svg version="1.1" id="warning" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M16,3L1,29h30L16,3z M16,7.002L27.537,27H4.463L16,7.002z"></path>
	<polygon points="15,14 15,16 15.5,21 16.5,21 17,16 17,14 	"></polygon>
	<circle cx="16" cy="23" r="1"></circle>
</g>
</svg>


<svg version="1.1" id="watch-clock-time" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<polygon points="21.646,9.646 16.354,14.939 13.707,12.293 12.293,13.707 14.939,16.354 13.646,17.646 14.354,18.354 15.646,17.06 
		17.293,18.707 18.707,17.293 17.06,15.646 22.354,10.354 	"></polygon>
	<path d="M27.949,15C27.652,11.402,25.77,8.263,23,6.268V1H9v5.268C5.977,8.445,4,11.988,4,16s1.977,7.555,5,9.732V31h14v-5.268
		c2.77-1.995,4.652-5.135,4.949-8.732H29v-2H27.949z M16,26c-5.514,0-10-4.486-10-10S10.486,6,16,6s10,4.486,10,10S21.514,26,16,26z
		"></path>
</g>
</svg>

<svg version="1.1" id="watson-globe" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve">
<g>
	<path d="M16,6c0.3,0,0.6-0.3,0.6-0.6V1.6C16.6,1.3,16.4,1,16,1s-0.6,0.3-0.6,0.6v3.8C15.4,5.8,15.7,6.1,16,6z"></path>
	<path d="M22.1,7.5c0.1,0,0.2,0.1,0.3,0c0.2,0,0.5-0.1,0.6-0.3l1.6-3.4c0-0.1,0-0.2,0-0.3c0-0.2-0.1-0.5-0.3-0.6c-0.1,0-0.2,0-0.3,0
		c-0.2,0-0.4,0.1-0.6,0.3l-1.6,3.4c0,0.1,0,0.2,0,0.3C21.8,7.1,21.9,7.4,22.1,7.5z"></path>
	<path d="M8.9,7.2C9,7.4,9.2,7.5,9.4,7.5c0.1,0,0.2,0,0.3,0C9.9,7.4,10,7.2,10,6.9c0-0.1,0-0.2,0-0.3L8.3,3.2C8.2,3,8,2.9,7.8,2.9
		c-0.1,0-0.2,0-0.3,0C7.3,3,7.2,3.3,7.2,3.5c0,0.1,0,0.2,0.1,0.3L8.9,7.2z"></path>
	<path d="M4.9,11.6c0.2,0,0.4-0.1,0.5-0.3c0.1-0.1,0.1-0.2,0.1-0.3c0-0.2-0.1-0.4-0.3-0.5l-3.2-2c-0.1,0-0.2-0.1-0.3-0.1
		c-0.2,0-0.4,0.1-0.5,0.3C1,8.8,1,8.8,1,9c0,0.2,0.1,0.4,0.3,0.5l3.2,2C4.6,11.5,4.7,11.6,4.9,11.6z"></path>
	<path d="M30.9,8.6c-0.1-0.2-0.3-0.3-0.5-0.3c-0.1,0-0.3,0-0.3,0.1l-3.2,2c-0.2,0.1-0.3,0.3-0.3,0.5c0,0.1,0,0.3,0.1,0.3
		c0.1,0.2,0.3,0.3,0.5,0.3c0.1,0,0.3,0,0.3-0.1l3.2-2C30.9,9.4,31,9.2,31,9C31,8.8,31,8.7,30.9,8.6z"></path>
	<path d="M27.5,17.6L27.5,17.6C27.5,17.6,27.5,17.5,27.5,17.6C26.6,12,21.8,7.8,16,7.8C9.6,7.8,4.4,13,4.4,19.4c0,0.6,0,1.2,0.1,1.8
		l0,0c0,0,0,0,0,0.1C5.5,26.8,10.3,31,16,31c3,0,5.8-1.2,7.9-3.1c0.1-0.1,0.3-0.2,0.4-0.4l0,0c2.1-2.1,3.4-5,3.4-8.2
		C27.7,18.8,27.6,18.2,27.5,17.6z M23.7,26.8c-0.1,0.2-0.3,0.3-0.5,0.4c-1.5,1.1-4,1.1-6.6,0.1c1-0.5,2.1-1.1,3.1-1.8
		c0.2,0.2,0.5,0.3,0.9,0.3c0.9,0,1.5-0.7,1.5-1.5c0-0.2-0.1-0.4-0.1-0.6c0.9-0.9,1.6-1.8,2.2-2.7C25,23.3,24.9,25.5,23.7,26.8z
		 M8.4,12c0.1-0.1,0.1-0.1,0.2-0.2c1.4-1.4,4.1-1.4,6.8-0.1c-1.3,0.6-2.5,1.4-3.7,2.4c-0.1,0.1-0.2,0.2-0.3,0.2
		c-0.1-0.1-0.3-0.1-0.5-0.1c-0.5,0-0.8,0.4-0.8,0.8c0,0.1,0,0.3,0.1,0.4c-0.9,1-1.7,2-2.4,3C7,15.8,7.1,13.4,8.4,12z M25,16.3
		c-0.5-0.1-1-0.1-1.5-0.1c-0.1-0.7-0.7-1.3-1.4-1.3c-0.2,0-0.3,0-0.5,0.1c-0.2-0.2-0.4-0.4-0.6-0.6c-0.4-0.4-0.8-0.8-1.2-1.1
		c0-0.8,0-1.6,0-2.2c1.8-0.1,3.4,0.4,4.3,1.4c0.2,0.2,0.4,0.5,0.6,0.7C25.1,14,25.2,15.1,25,16.3z M26,15.7c0.1,0.3,0.2,0.6,0.3,0.9
		c-0.1,0-0.2-0.1-0.4-0.1C26,16.2,26,15.9,26,15.7z M21.3,22.9c-0.2-0.1-0.5-0.2-0.8-0.2c-0.9,0-1.5,0.7-1.5,1.5
		c0,0.2,0,0.4,0.1,0.6c-0.8,0.5-1.5,1-2.3,1.4c0.5-1.3,1.1-2.7,1.5-4.4c1.3-0.3,3.2-0.7,4.9-1.2C22.6,21.4,22,22.2,21.3,22.9z
		 M12.9,25.8c0.6,0.5,1.2,0.9,1.8,1.2c-0.6,0.2-1.2,0.3-1.8,0.4C12.9,27,12.9,26.4,12.9,25.8z M11,23c-0.1,0-0.3,0-0.4,0.1
		c-0.1-0.1-0.2-0.3-0.3-0.4c0.7,0,1.4-0.1,2-0.1c-0.1,0.7-0.2,1.4-0.3,2c-0.1-0.1-0.3-0.2-0.4-0.3c0.1-0.1,0.1-0.2,0.1-0.4
		C11.8,23.4,11.5,23,11,23z M10.5,15.6c0.1,0.1,0.3,0.2,0.5,0.2c0.5,0,0.8-0.4,0.8-0.8c0-0.2,0-0.3-0.1-0.4c0.1-0.1,0.1-0.1,0.2-0.2
		c1.1-0.9,2.2-1.6,3.4-2.1c-0.4,0.9-0.8,1.9-1.2,3.1c-1,0-1.7,0.8-1.7,1.8c0,0.1,0,0.3,0,0.4c-1.3,0.3-2.7,0.6-4.1,1.1
		C8.9,17.5,9.6,16.5,10.5,15.6z M19.3,12.8c-0.7-0.5-1.4-1-2-1.3c0.7-0.2,1.4-0.3,2-0.4C19.3,11.6,19.3,12.2,19.3,12.8z M17,21.1
		c-0.2-0.4-0.7-0.7-1.2-0.7c-0.7,0-1.2,0.5-1.3,1.1c-0.4,0-0.7,0.1-1.1,0.1c0.2-0.9,0.4-1.9,0.6-2.8c1,0,1.7-0.8,1.7-1.7
		c0.4-0.1,0.7-0.1,1-0.1c0.1,0.2,0.3,0.4,0.6,0.4c0.3,0,0.6-0.3,0.6-0.6c0.3,0,0.6-0.1,0.9-0.1c-0.1,0.4-0.1,0.8-0.2,1.2
		c-0.4,0-0.7,0.4-0.7,0.8c0,0.3,0.2,0.6,0.4,0.7c-0.1,0.2-0.1,0.4-0.2,0.7c-0.1,0.3-0.1,0.5-0.2,0.8C17.8,21,17.4,21,17,21.1z
		 M18.8,20L18.8,20c0-0.2,0.1-0.3,0.1-0.5c0.5,0,0.8-0.4,0.8-0.8c0-0.3-0.2-0.6-0.5-0.7c0.1-0.4,0.2-0.9,0.2-1.3
		c0.4,0,0.9,0,1.3-0.1c0.2,0.6,0.7,1.1,1.4,1.1c0.1,0,0.3,0,0.4-0.1c0.4,0.6,0.8,1.2,1.1,1.8c-1.3,0.5-2.9,0.9-4.9,1.3
		C18.7,20.6,18.7,20.3,18.8,20z M20.7,16.3c-0.4,0-0.8,0.1-1.2,0.1c0.1-0.6,0.2-1.2,0.2-1.8c0.2,0.2,0.4,0.4,0.6,0.5
		c0.2,0.2,0.4,0.4,0.5,0.6C20.8,15.8,20.7,16,20.7,16.3z M19,16.4c-0.3,0-0.6,0.1-0.9,0.1c-0.1-0.2-0.3-0.4-0.6-0.4
		c-0.3,0-0.6,0.3-0.6,0.6c-0.5,0.1-0.8,0.1-1,0.1c-0.1-0.5-0.4-0.9-0.8-1.2c0.4-1.2,0.9-2.5,1.3-3.5c1,0.5,1.9,1.2,2.9,1.9
		C19.2,14.8,19.1,15.6,19,16.4z M8.2,19.2c1.1-0.5,2.6-1,4.3-1.4c0.1,0.3,0.4,0.6,0.7,0.8c0,0,0,0.1,0,0.1c-0.2,1.1-0.4,2.1-0.6,3
		c-1.1,0.1-2.1,0.1-2.9,0.1C9,21,8.5,20.1,8.2,19.2z M9.1,21.8c-0.8,0-1.5-0.1-2-0.2c0.1-0.7,0.4-1.4,0.7-2.1
		C8.1,20.3,8.6,21.1,9.1,21.8z M13.3,22.6c0.5,0,1-0.1,1.5-0.2c0.2,0.3,0.6,0.5,1.1,0.5c0.6,0,1-0.4,1.2-0.9c0.2,0,0.4-0.1,0.7-0.1
		c-0.5,1.6-1.2,3.3-1.9,4.6c-0.2,0.1-0.4,0.1-0.6,0.2c-0.8-0.4-1.6-0.9-2.4-1.5C13.1,24.5,13.2,23.5,13.3,22.6z M23.3,17.1
		c0.1-0.1,0.1-0.2,0.2-0.3c0.5,0,1,0.1,1.4,0.2c-0.1,0.6-0.4,1.2-0.6,1.8C24,18.1,23.6,17.6,23.3,17.1z M20.8,10.3
		c-0.3,0-0.7,0-1,0.1c-0.1-0.4-0.1-0.7-0.2-1c0.8,0.3,1.5,0.6,2.2,1C21.4,10.3,21.1,10.3,20.8,10.3z M18.6,9.1L18.6,9.1
		c0.3,0.1,0.4,0.6,0.5,1.3c-0.7,0.1-1.5,0.3-2.3,0.6C17.5,9.8,18.1,9.1,18.6,9.1z M6.4,21.5c-0.5-0.1-0.8-0.3-0.9-0.5l0,0h0
		c-0.2-0.3,0.4-0.8,1.6-1.4C6.9,20.3,6.6,20.9,6.4,21.5z M6.2,22.4c0,0.3-0.1,0.6-0.1,0.8c-0.1-0.3-0.2-0.6-0.3-1
		C5.9,22.3,6.1,22.4,6.2,22.4z M7,22.6c0.8,0.1,1.8,0.2,2.8,0.2c0.2,0.2,0.3,0.4,0.5,0.6c-0.1,0.1-0.2,0.3-0.2,0.5
		c0,0.4,0.3,0.8,0.8,0.8c0.2,0,0.3-0.1,0.5-0.1c0.2,0.2,0.4,0.4,0.6,0.5c-0.1,1-0.1,1.8-0.1,2.5c-1.4,0.1-2.6-0.1-3.4-0.7
		c-0.2-0.2-0.5-0.5-0.7-0.7l0,0C7.1,25.3,6.8,24,7,22.6z M12.1,28.5c0.1,0.3,0.1,0.6,0.2,0.8c-0.6-0.2-1.2-0.5-1.7-0.8
		C11,28.5,11.5,28.6,12.1,28.5z M13.5,29.7L13.5,29.7c-0.3-0.2-0.4-0.6-0.5-1.2c0.7-0.1,1.5-0.3,2.3-0.6
		C14.5,29.1,13.9,29.9,13.5,29.7z M25.8,17.2c0.4,0.1,0.6,0.3,0.7,0.4c0,0.1,0,0.1,0,0.2l0,0c0,0.2-0.4,0.6-1.3,1
		C25.5,18.2,25.7,17.7,25.8,17.2z M17.3,8.8c-0.4,0.4-0.9,1.1-1.4,2c-1.6-0.7-3.1-1-4.5-1c1.4-0.7,3-1.1,4.7-1.1
		C16.5,8.8,16.9,8.8,17.3,8.8z M6.5,14.7c0,1.3,0.3,2.7,0.9,4.2c-0.8,0.3-1.5,0.6-2,1c0-0.2,0-0.3,0-0.5C5.4,17.7,5.8,16.1,6.5,14.7
		z M16,30c-0.5,0-1,0-1.5-0.1c0.5-0.5,1-1.2,1.5-2.2c1.5,0.7,3.1,1.1,4.4,1.2v0c0.1,0,0.2,0,0.3,0C19.4,29.6,17.7,30,16,30z
		 M25.6,24c0-1.2-0.2-2.6-0.8-4c0.7-0.3,1.4-0.6,1.8-1c0,0.1,0,0.2,0,0.4C26.7,21,26.3,22.6,25.6,24z"></path>
</g>
</svg>


<svg version="1.1" id="wikis" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<path d="M16,2C8.268,2,2,8.268,2,16s6.268,14,14,14s14-6.268,14-14S23.732,2,16,2z M20.928,20.221L16.707,16l8.111-8.111
	c0.002,0.002,0.004,0.004,0.006,0.007C25.372,12.539,23.982,16.953,20.928,20.221z M11.072,11.779L15.293,16l-8.111,8.111
	c-0.002-0.002-0.004-0.004-0.006-0.007C6.628,19.461,8.018,15.047,11.072,11.779z M24.111,7.182L16,15.293l-4.225-4.225
	c2.775-2.592,6.443-4.027,10.406-4.027c0.635,0,1.273,0.05,1.91,0.123C24.098,7.17,24.104,7.176,24.111,7.182z M7.889,24.818
	L16,16.707l4.225,4.225c-2.775,2.592-6.443,4.027-10.405,4.027c-0.635,0-1.274-0.05-1.911-0.123
	C7.902,24.83,7.896,24.824,7.889,24.818z M22.723,6.065c-0.181-0.006-0.361-0.024-0.541-0.024c-4.229,0-8.148,1.54-11.113,4.32
	l-3.18-3.18C10.027,5.213,12.871,4,16,4C18.489,4,20.803,4.763,22.723,6.065z M7.182,7.889l3.174,3.174
	c-2.895,3.09-4.421,7.286-4.296,11.652C4.76,20.797,4,18.486,4,16C4,12.871,5.213,10.027,7.182,7.889z M9.277,25.935
	c0.181,0.006,0.362,0.024,0.542,0.024c4.229,0,8.148-1.539,11.112-4.32l3.18,3.18C21.973,26.787,19.129,28,16,28
	C13.511,28,11.197,27.237,9.277,25.935z M24.818,24.111l-3.174-3.174c2.895-3.09,4.421-7.286,4.296-11.652
	C27.24,11.203,28,13.514,28,16C28,19.129,26.787,21.973,24.818,24.111z"></path>
</svg>


<svg version="1.1" id="workspace" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M1,6v2h2v18h12V8h12v18h2V8h2V6H1z M13,14H5v-4h8V14z M5,24v-8h8v8H5z"></path>
	<circle cx="9" cy="12" r="1"></circle>
</g>
</svg>


<svg version="1.1" id="world-globe" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M8.575,18.925C10.625,20.975,13.312,22,16,22c2.531,0,5.055-0.922,7.054-2.74l0.018,0.018l0.707-0.707l-0.018-0.019
		c3.748-4.119,3.645-10.497-0.336-14.477C21.375,2.025,18.688,1,16,1c-2.531,0-5.055,0.922-7.054,2.74L8.929,3.722L8.222,4.429
		l0.018,0.019C4.491,8.567,4.595,14.944,8.575,18.925z M16,3c2.271,0,4.405,0.885,6.011,2.489c3.194,3.195,3.3,8.316,0.335,11.649
		L10.36,5.152C11.917,3.767,13.896,3,16,3z M21.64,17.848C20.083,19.233,18.104,20,16,20c-2.271,0-4.405-0.885-6.011-2.489
		c-3.194-3.194-3.3-8.315-0.335-11.649L21.64,17.848z"></path>
	<path d="M26.253,1.247l-1.414,1.414C27.2,5.022,28.5,8.16,28.5,11.5s-1.3,6.479-3.661,8.839C22.479,22.699,19.34,24,16,24
		s-6.479-1.301-8.839-3.661l-1.414,1.414C8.484,24.492,12.126,26,16,26s7.516-1.508,10.253-4.247
		c2.738-2.738,4.247-6.38,4.247-10.253S28.991,3.985,26.253,1.247z"></path>
	<rect x="11" y="28" width="10" height="3"></rect>
</g>
</svg>

<svg version="1.1" id="zoomin" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M12,1C5.926,1,1,5.926,1,12c0,6.074,4.926,11,11,11c6.074,0,11-4.926,11-11C23,5.926,18.074,1,12,1z M12,21
		c-4.962,0-9-4.038-9-9s4.038-9,9-9c4.962,0,9,4.038,9,9S16.962,21,12,21z"></path>
	<rect x="23.879" y="21.05" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -10.7696 26)" width="4.243" height="9.899"></rect>
	<circle cx="21" cy="21" r="1"></circle>
	<polygon points="13,6 11,6 11,11 6,11 6,13 11,13 11,18 13,18 13,13 18,13 18,11 13,11 	"></polygon>
</g>
</svg>

<svg version="1.1" id="zoomout" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
<g>
	<path d="M12,1C5.926,1,1,5.926,1,12c0,6.074,4.926,11,11,11c6.074,0,11-4.926,11-11C23,5.926,18.074,1,12,1z M12,21
		c-4.963,0-9-4.038-9-9s4.037-9,9-9c4.963,0,9,4.038,9,9S16.963,21,12,21z"></path>
	<rect x="23.879" y="21.05" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -10.7696 26)" width="4.243" height="9.899"></rect>
	<circle cx="21" cy="21" r="1"></circle>
	<rect x="6" y="11" width="12" height="2"></rect>
</g>
</svg>
</iron-iconset-svg><iron-iconset-svg name="ibm-medium" size="64">
 


<svg version="1.1" id="buildings" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="64px" height="64px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
<g>
	<rect x="21.3" y="10" width="6" height="6"></rect>
	<rect x="31.4" y="10" width="6" height="6"></rect>
	<rect x="41.4" y="10" width="6" height="6"></rect>
	<rect x="41.4" y="20" width="6" height="6"></rect>
	<rect x="41.4" y="30" width="6" height="6"></rect>
	<rect x="41.4" y="40" width="6" height="6"></rect>
	<path d="M14.3,2v18H8.5v42h29.2v-6h17.8V2H14.3z M21.1,56h-8v-8h8V56z M21.1,44h-8v-8h8V44z M21.1,32h-8v-8h8V32z M33.1,56h-8v-8h8
		V56z M33.1,44h-8v-8h8V44z M33.1,32h-8v-8h8V32z M52.5,53H37.7V20H17.3V5h35.2V53z"></path>
</g>
</svg>


<svg version="1.1" id="difference-noted" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="64px" height="64px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
<g>
	<path d="M32,5.999L2,58.001h60L32,5.999z M32,10.001l26.537,46H5.463L32,10.001z"></path>
	<polygon points="30,28.001 30,32 31,42.001 33,42.001 34,32 34,28.001 	"></polygon>
	<circle cx="32" cy="46" r="2"></circle>
</g>
</svg>


<svg version="1.1" id="ok" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="64px" height="64px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
<g>
	<polygon points="28,37.172 21.414,30.586 18.586,33.414 28,42.829 45.414,25.415 42.586,22.585 	"></polygon>
	<path d="M32,4C16.538,4,4,16.538,4,32s12.538,28,28,28c15.463,0,28-12.538,28-28S47.463,4,32,4z M32,58.001
		C17.663,58.001,6,46.337,6,32S17.663,6,32,6s26,11.663,26,26S46.337,58.001,32,58.001z"></path>
</g>
</svg>


<svg version="1.1" id="reserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="64px" height="64px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
<g>
	<path d="M52.2,10V7c0-1.1-0.9-2-2-2s-2,0.9-2,2v3h-32V7c0-1.1-0.9-2-2-2s-2,0.9-2,2v3h-10v50h60V10H52.2z M59.2,57h-54V20h54V57z"></path>
	<rect x="11.2" y="24.9" width="12" height="12"></rect>
	<rect x="11.2" y="39.9" width="12" height="12"></rect>
	<path d="M36.2,26.9v8h-8v-8H36.2 M38.2,24.9h-12v12h12V24.9L38.2,24.9z"></path>
	<rect x="26.2" y="39.9" width="12" height="12"></rect>
	<path d="M51.2,26.9v8h-8v-8H51.2 M53.2,24.9h-12v12h12V24.9L53.2,24.9z"></path>
	<rect x="41.2" y="39.9" width="12" height="12"></rect>
</g>
</svg>


<svg version="1.1" id="service-request" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="64px" height="64px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
<g>
	<rect x="2" y="48.1" width="60" height="5.9"></rect>
	<path d="M33,17v-3h5v-4H26v4h5v3C16.1,17.5,4,30,4,45c0.8,0,55.2,0,56,0C60,30,47.9,17.5,33,17z M13.7,26.6
		c4.9-5,11.5-7.7,18.3-7.7s13.4,2.7,18.3,7.7c4.5,4.5,7.1,10.2,7.6,16.4H6.1C6.6,36.9,9.2,31.1,13.7,26.6z"></path>
</g>
</svg>

</iron-iconset-svg><iron-iconset-svg name="ibm-large" size="128">
 


<svg version="1.1" id="graph-in-progress" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="128px" height="128px" viewBox="0 0 128 128" enable-background="new 0 0 128 128" xml:space="preserve">
<g>
	<g>
		<path d="M47.591,47.65c6.678,0,8.616,4.899,8.616,10.77c0,5.6-2.369,10.823-8.616,10.823c-6.516,0-8.723-4.847-8.723-10.662
			C38.868,52.819,40.968,47.65,47.591,47.65z M47.43,66.281c4.093,0,4.738-4.523,4.738-7.861c0-3.178-0.538-7.809-4.577-7.809
			c-3.984,0-4.685,4.631-4.685,7.862C42.906,61.597,43.391,66.281,47.43,66.281z M73.008,46.95h4.577L48.668,87.013h-4.631
			L73.008,46.95z M74.192,64.882c6.677,0,8.615,4.899,8.615,10.77c0,5.6-2.369,10.823-8.615,10.823
			c-6.516,0-8.724-4.847-8.724-10.662C65.469,70.051,67.569,64.882,74.192,64.882z M74.031,83.513c4.092,0,4.738-4.523,4.738-7.861
			c0-3.178-0.539-7.809-4.577-7.809c-3.984,0-4.685,4.631-4.685,7.862C69.508,78.828,69.992,83.513,74.031,83.513z"></path>
	</g>
	<g>
		<path d="M61.136,17.377c27.188,0,49.306,22.119,49.306,49.307c0,27.188-22.118,49.308-49.306,49.308
			c-27.188,0-49.307-22.119-49.307-49.308C11.829,39.496,33.948,17.377,61.136,17.377 M61.136,13.377
			c-29.44,0-53.307,23.867-53.307,53.307c0,29.44,23.866,53.308,53.307,53.308s53.306-23.867,53.306-53.308
			C114.441,37.244,90.576,13.377,61.136,13.377L61.136,13.377z"></path>
	</g>
	<path d="M61,8.009v15.061C85,23.57,104.859,43,105.11,67h15.061C119.919,35,93,8.513,61,8.009z"></path>
</g>
</svg>



<svg version="1.1" id="review" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="128px" height="128px" viewBox="0 0 128 128" enable-background="new 0 0 128 128" xml:space="preserve">
<g>
	<path d="M64,64c-13.254,0-24,10.738-24,24s10.746,24,24,24c13.262,0,24-10.738,24-24S77.262,64,64,64z M64,96c-4.422,0-8-3.58-8-8
		s3.578-8,8-8s8,3.58,8,8S68.422,96,64,96z"></path>
	<rect x="48" y="28.009" width="32" height="4"></rect>
	<rect x="48" y="36.009" width="32" height="4"></rect>
	<path d="M96,59.946V4H32v55.987C20,66.326,10.993,76.084,4.019,88c12.586,21.5,33.069,36,59.991,36c26.921,0,47.428-14.5,60.014-36
		C117.033,76.06,108,66.283,96,59.946z M36,8h56v49.941C84,54.124,74.326,52,64.037,52C53.718,52,44,54.137,36,57.976V8z M64,120
		c-22.888,0-42.451-11.341-55.327-32C21.549,67.341,41.112,56,64,56c22.889,0,42.451,11.341,55.327,32
		C106.451,108.659,86.889,120,64,120z"></path>
</g>
</svg>
</iron-iconset-svg><iron-iconset-svg name="ibm-glyphs" size="24">
 


<svg version="1.1" id="accessibility" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<path d="M21.4,17.7l-0.7,0.7l-3.6-3.6v0H9.8v-1.8h4.1v-1.5H9.8V7.2c1.4-0.3,2.5-1.6,2.5-3.1c0-1.7-1.4-3.2-3.2-3.2S5.9,2.4,5.9,4.2
	c0,1.2,0.7,2.3,1.8,2.8C3.9,7.6,1,10.9,1,14.9C1,19.4,4.6,23,9.1,23c3.8,0,7-2.7,7.8-6.2l3.7,3.7l0,0l0.1,0.1l1.8-1.8L21.4,17.7z
	 M9.1,2.4c1,0,1.8,0.8,1.8,1.8s-0.8,1.8-1.8,1.8S7.3,5.1,7.3,4.2S8.1,2.4,9.1,2.4z M9.1,21.6c-3.7,0-6.7-3-6.7-6.7
	c0-3.4,2.6-6.3,5.9-6.6v8h0.2h1.2h5.8C14.9,19.3,12.2,21.6,9.1,21.6z"></path>
</svg>


<svg version="1.1" id="assets" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<path d="M23,20L22.963,1H1v19h8v2.015l-2,0.003V23h10v-1l-2,0.003V20H23z M3,3h18v13H3V3z"></path>
</svg>


<svg version="1.1" id="back" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<polygon points="16.83,1 18.25,2.421 8.592,12.082 18.092,21.579 16.672,23 5.75,12.082 "></polygon>
</svg>


<svg version="1.1" id="backward" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<polygon points="1,12 12,23 13.4,21.6 4.8,13 23,13 23,11 4.8,11 13.4,2.4 12,1 "></polygon>
</svg>


<svg version="1.1" id="calendar" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<path d="M19,4V2.352c0-0.553-0.447-1-1-1s-1,0.447-1,1V4H7V2.352c0-0.553-0.448-1-1-1s-1,0.447-1,1V4H1v18h16.727L23,17.285V4H19z
		 M21,16h-4v4H3V9h18V16z"></path>
	<path d="M12.828,14.588c-0.254,0.224-0.529,0.43-0.834,0.623c-0.301,0.193-0.591,0.394-0.87,0.598
		c-0.576,0.396-1.035,0.859-1.369,1.391c-0.334,0.536-0.506,1.16-0.515,1.877h5.854v-1.258h-4.176
		c0.056-0.19,0.162-0.366,0.32-0.536c0.152-0.17,0.335-0.331,0.541-0.485c0.211-0.158,0.437-0.313,0.683-0.471
		c0.246-0.154,0.488-0.32,0.735-0.492c0.245-0.172,0.481-0.357,0.71-0.553c0.229-0.201,0.435-0.416,0.611-0.65
		c0.181-0.23,0.322-0.487,0.43-0.767c0.105-0.279,0.159-0.593,0.159-0.936c0-0.279-0.045-0.576-0.133-0.885
		c-0.093-0.306-0.245-0.592-0.46-0.854c-0.217-0.264-0.502-0.482-0.851-0.654c-0.352-0.172-0.791-0.259-1.311-0.259
		c-0.482,0-0.908,0.086-1.271,0.251c-0.361,0.169-0.669,0.403-0.925,0.697c-0.251,0.298-0.442,0.646-0.569,1.054
		c-0.124,0.407-0.188,0.849-0.188,1.327h1.396c0.006-0.307,0.037-0.588,0.09-0.854c0.054-0.261,0.137-0.488,0.246-0.682
		c0.108-0.193,0.258-0.345,0.441-0.458c0.183-0.108,0.415-0.165,0.69-0.165c0.305,0,0.547,0.053,0.737,0.153
		c0.187,0.105,0.335,0.233,0.44,0.383c0.106,0.152,0.176,0.315,0.215,0.494c0.035,0.175,0.055,0.343,0.055,0.497
		c-0.01,0.335-0.095,0.634-0.258,0.893C13.289,14.126,13.083,14.369,12.828,14.588z"></path>
</g>
</svg>


<svg version="1.1" id="catering" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<path d="M13.3,12l2.9-2.9c0.3,0.1,0.6,0.2,0.9,0.2l0,0l0,0l0,0l0,0c0.4,0,0.9-0.1,1.3-0.2l4.4-4.4l-0.5-0.5L18.4,8l0,0
	c-0.5,0-1-0.2-1.5-0.5l4.4-4.4l-0.5-0.5L16.4,7c-0.3-0.4-0.5-0.9-0.5-1.4l3.9-3.9l-0.5-0.5l-4.5,4.4c-0.2,0.4-0.3,0.8-0.2,1.3
	c0,0.2,0.1,0.5,0.1,0.7l-3,3L9,7.7c0.4-0.9,0.2-2.1-0.6-2.8L5.5,2c-1-1-2.7-1-3.8,0s-1,2.7,0,3.8l2.9,2.9c0.8,0.8,1.9,1,2.8,0.6
	l2.8,2.8l-9.1,9.1l0,0c-0.4,0.4-0.4,1.1,0,1.6c0.4,0.4,1.1,0.4,1.6,0l9.1-9.1l9.1,9.1l0,0c0.4,0.4,1.1,0.4,1.6,0
	c0.4-0.4,0.4-1.1,0-1.6L13.3,12z"></path>
</svg>


<svg version="1.1" id="clear-input" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<polygon points="18.801,4.002 12,10.804 5.2,4.002 4,5.2 10.801,12 4,18.8 5.2,19.998 12,13.198 18.801,19.998 20,18.8 13.201,12 
		20,5.2 	"></polygon>
</g>
</svg>


<svg version="1.1" id="close-cancel-error" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<path d="M12,1C5.9,1,1,5.9,1,12c0,6.1,4.9,11,11,11c6.1,0,11-4.9,11-11C23,5.9,18.1,1,12,1z M17.148,15.8l-1.5,1.5l-3.698-3.801
	L8.149,17.3l-1.5-1.5l3.801-3.801L6.749,8.2l1.5-1.5l3.801,3.799L15.852,6.7l1.5,1.5l-3.901,3.799L17.148,15.8z"></path>
</svg>


<svg version="1.1" id="connection-status" width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g fill-rule="evenodd">
        <path d="M12.467,0 C9.415,0 6.827,2.24088717 6.326,5.15044227 C6.053,5.10946262 5.776,5.08947255 5.5,5.08847304 C2.467,5.08847304 0,7.53425846 0,10.5407654 C0,13.5472724 2.467,15.5333017 5.5,15.5333017 L6.75846699,15.5333017 L6.75846699,18.0099487 L4.55133057,18.0099487 L9,22 L13.5356445,18.0099487 L11.25,18.0099487 L11.25,12.0420199 L9,12.0420199 L13.5356445,7.94679822 L18.0855103,12.0420199 L15.7792969,12.0420199 L15.7792969,15.5333017 L16.5,15.5333017 C19.533,15.5333017 22,13.5462729 22,10.5397659 C22,8.34885392 20.683,6.37183572 18.661,5.52625564 C18.335,2.38981321 15.705,0 12.467,0 Z"></path>
    </g>
</svg>


<svg version="1.1" id="details" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g display="none">
	<rect display="inline" fill="#F0F0F0" width="24" height="24"></rect>
</g>
<g>
	<path d="M20,17v-1V1H4v22h9h1L20,17z M18,16h-5v5H6V3h12V16z"></path>
	<rect x="9" y="9" width="6" height="2"></rect>
	<rect x="9" y="6" width="6" height="2"></rect>
	<rect x="9" y="12" width="6" height="2"></rect>
</g>
<g idisplay="none">
	<g display="inline">
		<path fill="#FFCCCC" d="M23,1v22H1V1H23 M24,0H0v24h24V0L24,0z"></path>
	</g>
</g>
</svg>


<svg version="1.1" id="equals" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<rect x="6.5" y="8.5" width="11" height="2"></rect>
	<rect x="6.5" y="13.5" width="11" height="2"></rect>
</g>
</svg>


<svg version="1.1" id="equipment" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<path d="M22.244,7.384c-0.908-2.137-3.012-3.395-5.199-3.336L15.75,1l-3.611,1.533l1.285,3.021
		c-1.61,1.529-2.194,3.949-1.275,6.114l2.546-1.081c0.459,0.996,1.449,1.638,2.553,1.638c0.379,0,0.75-0.076,1.1-0.225
		c0.695-0.295,1.232-0.843,1.516-1.542c0.268-0.669,0.266-1.397,0.004-2.065L22.244,7.384z M17.975,11.12
		c-0.238,0.101-0.484,0.148-0.727,0.148c-0.695,0-1.348-0.399-1.666-1.058l3.406-1.445C19.332,9.691,18.893,10.73,17.975,11.12z"></path>
	<path d="M11.401,18.762l-6.398-6.398c0.004-0.049,0.015-0.096,0.015-0.146c0-0.099-0.012-0.195-0.029-0.289l5.295-5.294
		c0.1,0.02,0.202,0.031,0.309,0.031c0.9,0,1.628-0.73,1.628-1.633c0-0.899-0.728-1.63-1.628-1.63c-0.903,0-1.632,0.73-1.632,1.63
		c0,0.068,0.012,0.134,0.02,0.2l-5.377,5.376c-0.072-0.01-0.143-0.021-0.217-0.021c-0.9,0-1.63,0.73-1.63,1.63
		c0,0.902,0.729,1.631,1.63,1.631c0.122,0,0.241-0.016,0.355-0.041l5.811,5.811c-0.343,0.399-0.558,0.906-0.582,1.469H6.647V23
		h9.566v-1.913h-2.402C13.754,19.798,12.701,18.767,11.401,18.762z"></path>
</g>
</svg>


<svg version="1.1" id="expand-close" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<polygon points="4.213,19.662 19.688,4.299 19.787,19.701 "></polygon>
</svg>


<svg version="1.1" id="expand-open" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<polygon points="7.17,23 5.75,21.579 15.408,11.918 5.908,2.421 7.328,1 18.25,11.918 "></polygon>
</svg>


<svg version="1.1" id="filter" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<path d="M23,1H1v2.934l8.801,8.8L9.8,23l4.402-4.396v-2.48c0.538,0.616,1.313,1.012,2.194,1.011c1.623,0.001,2.938-1.313,2.938-2.93
	c0-1.623-1.313-2.937-2.938-2.937c-0.306,0-0.604,0.061-0.886,0.149l7.487-7.483L23,1L23,1z M17.867,14.202
	c0,0.808-0.658,1.462-1.471,1.462c-0.807,0-1.465-0.654-1.465-1.462c0-0.813,0.657-1.47,1.465-1.468
	C17.21,12.732,17.867,13.391,17.867,14.202z M12.022,12.11L3.757,3.863l16.509,0.006L12.022,12.11z"></path>
</svg>


<svg version="1.1" id="floorplan" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<polygon points="1,1 1,23 7.346,23 7.346,21 3,21 3,13 6.951,13 6.951,11 3,11 3,3 21,3 21,11 14.947,11 14.947,7.591 12.947,7.591 
	12.947,16.409 14.947,16.409 14.947,13 21,13 21,21 12.897,21 12.897,23 23,23 23,1 "></polygon>
</svg>


<svg version="1.1" id="forward" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<polygon points="12,1 10.6,2.4 19.2,11 1,11 1,13 19.2,13 10.6,21.6 12,23 23,12 "></polygon>
</svg>


<svg version="1.1" id="home" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<g>
	<path d="M12.1,0.8L1.2,11.6l2.3,2.3V24h17V13.9l2.3-2.3L12.1,0.8z M19.1,22.5H5.1V12.4l7-7l7,7V22.5z"></path>
</g>
</svg>


<svg version="1.1" id="incremental-input-add" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<polygon points="13,11 13,1 11,1 11,11 1,11 1,13 11,13 11,23 13,23 13,13 23,13 23,11 "></polygon>
</svg>


<svg version="1.1" id="incremental-input-minus" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect x="1" y="11" width="22" height="2"></rect>
</svg>


<svg version="1.1" id="list-view " xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<path d="M1,2v20h22V2H1z M21,20H3v-3h18V20z M21,15H3v-3h18V15z M21,10H3V7h18V10z"></path>
</svg>


<svg version="1.1" id="location" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g display="none">
	<rect display="inline" fill="#F0F0F0" width="24" height="24"></rect>
</g>
<g>
	<g>
		<g>
			<path d="M18.363,3.578C16.738,1.987,14.489,1,12,1S7.262,1.987,5.637,3.578C4.01,5.167,3,7.367,3,9.8
				c0,2.571,1.01,4.904,2.637,6.591L12,23l6.363-6.609C19.99,14.704,21,12.371,21,9.8C21,7.367,19.99,5.167,18.363,3.578z M12,13
				c-1.661,0-3-1.34-3-3.001C9,8.34,10.339,7,12,7s3,1.34,3,2.999C15,11.66,13.661,13,12,13z"></path>
		</g>
	</g>
</g>
<g display="none">
	<g display="inline">
		<path fill="#FFCCCC" d="M23,1v22H1V1H23 M24,0H0v24h24V0L24,0z"></path>
	</g>
</g>
</svg>


<svg version="1.1" id="menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<rect x="2" y="4" width="20" height="3"></rect>
	<rect x="2" y="11" width="20" height="3"></rect>
	<rect x="2" y="18" width="20" height="3"></rect>
</g>
</svg>


<svg version="1.1" id="pan-zoom" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<g>
	<g>
		<g>
			<polygon points="13,7 11,7 11,8.9 9.1,8.9 9.1,10.8 11,10.8 11,12.8 13,12.8 13,10.8 14.9,10.8 14.9,8.9 13,8.9 			"></polygon>
		</g>
	</g>
	<g>
		<g>
			<polygon points="9.1,14.2 9.1,16.1 14.9,16.1 14.9,14.2 			"></polygon>
		</g>
	</g>
	<polygon points="3.8,12 4.5,11.3 6.5,9.2 5.1,7.9 1,12 5.1,16.1 6.5,14.8 4.5,12.7 	"></polygon>
	<polygon points="18.9,7.9 17.5,9.2 19.5,11.3 20.2,12 19.5,12.7 17.5,14.8 18.9,16.1 23,12 	"></polygon>
	<polygon points="12.7,19.5 12,20.2 11.3,19.5 9.2,17.5 7.9,18.9 12,23 16.1,18.9 14.8,17.5 	"></polygon>
	<polygon points="11.3,4.5 12,3.8 12.7,4.5 14.8,6.5 16.1,5.1 12,1 7.9,5.1 9.2,6.5 	"></polygon>
</g>
</svg>


<svg version="1.1" id="phone-call" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g display="none">
	<rect display="inline" fill="#F0F0F0" width="24" height="24"></rect>
</g>
<g>
	<g>
		<path d="M18,1l-4.533,5.133l1.466,2.2l-6.599,6.601l-2.201-1.467L1,17l2,6c3.666-1.466,8.267-4.399,11.933-8.066
			C18.601,11.267,21.533,6.667,23,3L18,1z"></path>
	</g>
</g>
<g display="none">
	<g display="inline">
		<path fill="#FFCCCC" d="M23,1v22H1V1H23 M24,0H0v24h24V0L24,0z"></path>
	</g>
</g>
</svg>


<svg version="1.1" id="popup-close" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<polygon points="17.2,8.2 15.8,6.8 12,10.6 8.2,6.8 6.8,8.2 10.6,12 6.8,15.8 8.2,17.2 12,13.4 15.8,17.2 17.2,15.8 13.4,12 "></polygon>	 
</svg>


<svg version="1.1" id="popup-close-filled" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<path d="M12,1C5.9,1,1,5.9,1,12s4.9,11,11,11s11-4.9,11-11S18.1,1,12,1z"></path>
<polygon fill="white" points="17.2,8.2 15.8,6.8 12,10.6 8.2,6.8 6.8,8.2 10.6,12 6.8,15.8 8.2,17.2 12,13.4 15.8,17.2 17.2,15.8 13.4,12"></polygon>
</svg>


<svg version="1.1" id="projector" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<circle cx="8.556" cy="10.945" r="3"></circle>
	<path d="M1,4v16h2v1h4v-1h10v1h4v-1h2V4H1z M8.555,15.945c-2.763,0-4.999-2.24-4.999-5c0-2.76,2.236-5,4.999-5s5.001,2.241,5.001,5
		C13.557,13.704,11.318,15.945,8.555,15.945z M21,17h-5v-1h5V17z M21,15h-5v-1h5V15z M21,13h-5v-1h5V13z"></path>
</g>
</svg>


<svg version="1.1" id="room-function" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<rect x="1" y="8.153" width="22" height="7.897"></rect>
	<ellipse cx="4.518" cy="20.361" rx="2.672" ry="2.639"></ellipse>
	<ellipse cx="19.748" cy="20.361" rx="2.672" ry="2.639"></ellipse>
	<ellipse cx="12.133" cy="20.361" rx="2.672" ry="2.639"></ellipse>
	<ellipse cx="4.518" cy="3.639" rx="2.672" ry="2.639"></ellipse>
	<ellipse cx="19.748" cy="3.639" rx="2.672" ry="2.639"></ellipse>
	<ellipse cx="12.133" cy="3.639" rx="2.672" ry="2.639"></ellipse>
</g>
</svg>


<svg version="1.1" id="search" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g display="none">
	<rect display="inline" fill="#F0F0F0" width="24" height="24"></rect>
</g>
<g>
	<path d="M9,3c3.309,0,6,2.691,6,6s-2.691,6-6,6s-6-2.691-6-6S5.691,3,9,3 M9,1C4.582,1,1,4.582,1,9c0,4.417,3.582,8,8,8
		s8-3.583,8-8C17,4.582,13.418,1,9,1L9,1z"></path>
	<rect x="16.879" y="15.464" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -7.8701 19)" width="4.243" height="7.071"></rect>
	<path d="M9,3c3.309,0,6,2.691,6,6s-2.691,6-6,6s-6-2.691-6-6S5.691,3,9,3 M9,1C4.582,1,1,4.582,1,9c0,4.417,3.582,8,8,8
		s8-3.583,8-8C17,4.582,13.418,1,9,1L9,1z"></path>
	<rect x="16.879" y="15.464" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -7.8701 19)" width="4.243" height="7.071"></rect>
</g>
<g display="none">
	<g display="inline">
		<path fill="#FFCCCC" d="M23,1v22H1V1H23 M24,0H0v24h24V0L24,0z"></path>
	</g>
</g>
</svg>

<svg version="1.1" id="select-area" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<g>
	<polygon points="19.2,1.4 17.2,1.4 17.2,3.4 19.2,3.4 19.2,1.4 	"></polygon>
	<polygon points="15.2,1.4 13.2,1.4 13.2,3.4 15.2,3.4 15.2,1.4 	"></polygon>
	<polygon points="11.2,1.4 9.2,1.4 9.2,3.4 11.2,3.4 11.2,1.4 	"></polygon>
	<polygon points="7.2,1.4 5.2,1.4 5.2,3.4 7.2,3.4 7.2,1.4 	"></polygon>
	<polygon points="7.2,17.4 5.2,17.4 5.2,19.4 7.2,19.4 7.2,17.4 	"></polygon>
	<polygon points="3.2,1.4 1.2,1.4 1.2,3.4 3.2,3.4 3.2,1.4 	"></polygon>
	<polygon points="3.2,5.4 1.2,5.4 1.2,7.4 3.2,7.4 3.2,5.4 	"></polygon>
	<polygon points="3.2,9.4 1.2,9.4 1.2,11.4 3.2,11.4 3.2,9.4 	"></polygon>
	<polygon points="3.2,13.4 1.2,13.4 1.2,15.4 3.2,15.4 3.2,13.4 	"></polygon>
	<polygon points="3.2,17.4 1.2,17.4 1.2,19.4 3.2,19.4 3.2,17.4 	"></polygon>
	<polygon points="11.2,17.4 9.2,17.4 9.2,19.4 11.2,19.4 11.2,17.4 	"></polygon>
	<polygon points="19.2,9.4 17.2,9.4 17.2,11.4 19.2,11.4 19.2,9.4 	"></polygon>
	<polygon points="19.2,5.4 17.2,5.4 17.2,7.4 19.2,7.4 19.2,5.4 	"></polygon>
	<polygon points="22.8,21.6 19.1,17.9 21.2,15.9 13.8,13.9 15.7,21.3 17.7,19.4 21.4,23 	"></polygon>
</g>
</svg>


<svg version="1.1" id="sign-out" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<polygon points="16.781,6.272 15.367,7.391 19.271,11 7,11 7,13 19.361,13 15.367,17.291 16.781,18.853 23.145,12.563 	"></polygon>
	<polygon points="3,3 12,3 12,1 1,1 1,23 12,23 12,21 3,21 	"></polygon>
</g>
</svg>


<svg version="1.1" id="tile-view" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<rect x="15" y="1" width="8" height="8"></rect>
	<path d="M13,1h-2H1v10v2v10h10h2h10V13v-2H13V1z M11,21H3v-8h8V21z M21,13v8h-8v-8H21z M3,11V3h8v8H3z"></path>
</g>
</svg>


<svg version="1.1" id="user" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g display="none">
	<rect display="inline" fill="#F0F0F0" width="24" height="24"></rect>
</g>
<g>
	<g>
		<circle cx="12" cy="8.001" r="7"></circle>
	</g>
	<path d="M18,17H6c-1.616,0-3,1.382-3,3v3h18v-3C21,18.382,19.617,17,18,17z"></path>
	<g>
		<circle cx="12" cy="8.001" r="7"></circle>
	</g>
	<path d="M18,17H6c-1.616,0-3,1.382-3,3v3h18v-3C21,18.382,19.617,17,18,17z"></path>
</g>
<g display="none">
	<g display="inline">
		<path fill="#FFCCCC" d="M23,1v22H1V1H23 M24,0H0v24h24V0L24,0z"></path>
	</g>
</g>
</svg>


<svg version="1.1" id="video" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g display="none">
	<rect display="inline" fill="#F0F0F0" width="24" height="24"></rect>
</g>
<g>
	<g>
		<g>
			<path d="M1,4v16h22V4H1z M8,16V8l8,4L8,16z"></path>
		</g>
	</g>
</g>
<g display="none">
	<g display="inline">
		<path fill="#FFCCCC" d="M23,1v22H1V1H23 M24,0H0v24h24V0L24,0z"></path>
	</g>
</g>
</svg>

<svg version="1.1" id="watson-globe" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<g>
	<path d="M12,4.7c0.3,0,0.4-0.2,0.4-0.4V1.4C12.5,1.2,12.3,1,12,1s-0.4,0.2-0.4,0.4v2.8C11.6,4.5,11.8,4.7,12,4.7z"></path>
	<path d="M16.5,5.7c0.1,0,0.1,0.1,0.2,0c0.2,0,0.3-0.1,0.4-0.3L18.3,3c0-0.1,0-0.1,0-0.2c0-0.2-0.1-0.3-0.3-0.4c-0.1,0-0.1,0-0.2,0
		c-0.2,0-0.3,0.1-0.4,0.3l-1.2,2.5c0,0.1,0,0.1,0,0.2C16.2,5.5,16.3,5.7,16.5,5.7z"></path>
	<path d="M6.8,5.5C6.8,5.7,7,5.8,7.2,5.8c0.1,0,0.1,0,0.2,0c0.2-0.1,0.3-0.2,0.2-0.4c0-0.1,0-0.1,0-0.2L6.4,2.6
		C6.3,2.5,6.1,2.4,6,2.4c-0.1,0-0.1,0-0.2,0C5.6,2.5,5.5,2.7,5.5,2.8c0,0.1,0,0.1,0.1,0.2L6.8,5.5z"></path>
	<path d="M3.8,8.8c0.2,0,0.3-0.1,0.4-0.2c0.1-0.1,0.1-0.2,0.1-0.3C4.3,8.1,4.2,8,4,7.9L1.7,6.4c-0.1,0-0.2-0.1-0.3-0.1
		c-0.2,0-0.3,0.1-0.4,0.2C1,6.7,1,6.8,1,6.8C1,7,1.1,7.1,1.2,7.2l2.4,1.5C3.7,8.7,3.7,8.8,3.8,8.8z"></path>
	<path d="M22.9,6.6c-0.1-0.2-0.2-0.2-0.4-0.2c-0.1,0-0.2,0-0.3,0.1L20,7.9c-0.2,0.1-0.2,0.2-0.2,0.4c0,0.1,0,0.2,0.1,0.3
		c0.1,0.2,0.2,0.2,0.4,0.2c0.1,0,0.2,0,0.3-0.1l2.4-1.5C22.9,7.2,23,7,23,6.8C23,6.8,23,6.7,22.9,6.6z"></path>
	<path d="M20.4,13.2L20.4,13.2C20.5,13.1,20.4,13.1,20.4,13.2C19.8,9,16.2,6,12,6c-4.7,0-8.5,3.8-8.5,8.5c0,0.4,0,0.9,0.1,1.3l0,0
		c0,0,0,0,0,0C4.3,19.9,7.8,23,12,23c2.2,0,4.2-0.9,5.8-2.3c0.1-0.1,0.2-0.2,0.3-0.3l0,0c1.5-1.5,2.5-3.7,2.5-6
		C20.5,14,20.5,13.6,20.4,13.2z M17.6,19.9c-0.1,0.1-0.2,0.2-0.3,0.3c-1.1,0.8-2.9,0.8-4.9,0.1c0.8-0.3,1.5-0.8,2.3-1.3
		c0.2,0.1,0.4,0.2,0.6,0.2c0.6,0,1.1-0.5,1.1-1.1c0-0.2,0-0.3-0.1-0.5c0.6-0.6,1.2-1.3,1.6-2C18.6,17.3,18.5,19,17.6,19.9z M6.4,9.1
		c0,0,0.1-0.1,0.1-0.1c1.1-1,3-1,5-0.1c-0.9,0.4-1.9,1-2.7,1.8c-0.1,0.1-0.1,0.1-0.2,0.2c-0.1-0.1-0.2-0.1-0.3-0.1
		c-0.3,0-0.6,0.3-0.6,0.6c0,0.1,0,0.2,0.1,0.3C7.1,12.2,6.5,13,6,13.7C5.4,11.8,5.5,10.1,6.4,9.1z M18.6,12.2
		c-0.3,0-0.7-0.1-1.1-0.1c0-0.5-0.5-1-1-1c-0.1,0-0.2,0-0.3,0.1c-0.1-0.1-0.3-0.3-0.4-0.4c-0.3-0.3-0.6-0.6-0.9-0.8
		c0-0.6,0-1.1,0-1.6c1.3-0.1,2.5,0.3,3.2,1c0.1,0.2,0.3,0.3,0.4,0.5C18.7,10.5,18.8,11.3,18.6,12.2z M19.4,11.8
		c0.1,0.2,0.1,0.4,0.2,0.6c-0.1,0-0.2-0.1-0.3-0.1C19.3,12.1,19.3,12,19.4,11.8z M15.9,17.1c-0.2-0.1-0.4-0.2-0.6-0.2
		c-0.6,0-1.1,0.5-1.1,1.1c0,0.1,0,0.3,0.1,0.4c-0.6,0.4-1.1,0.7-1.7,1c0.4-0.9,0.8-2,1.1-3.2c1-0.2,2.3-0.5,3.6-0.9
		C16.9,16,16.4,16.5,15.9,17.1z M9.8,19.2c0.4,0.3,0.9,0.6,1.3,0.9c-0.5,0.1-0.9,0.2-1.3,0.3C9.7,20,9.7,19.6,9.8,19.2z M8.3,17.2
		c-0.1,0-0.2,0-0.3,0.1C8,17.1,7.9,17,7.8,16.9c0.5,0,1,0,1.5-0.1c-0.1,0.5-0.1,1-0.2,1.4C9,18.2,8.9,18.1,8.8,18
		c0-0.1,0.1-0.2,0.1-0.3C8.9,17.4,8.7,17.2,8.3,17.2z M7.9,11.7c0.1,0.1,0.2,0.1,0.4,0.1c0.3,0,0.6-0.3,0.6-0.6c0-0.1,0-0.2-0.1-0.3
		c0.1,0,0.1-0.1,0.2-0.1c0.8-0.6,1.6-1.2,2.5-1.5c-0.3,0.7-0.6,1.4-0.9,2.3c-0.7,0-1.3,0.6-1.3,1.3c0,0.1,0,0.2,0,0.3
		c-0.9,0.2-2,0.5-3,0.8C6.8,13.1,7.3,12.4,7.9,11.7z M14.4,9.7c-0.5-0.4-1-0.7-1.5-1c0.5-0.1,1-0.2,1.5-0.3
		C14.4,8.8,14.4,9.2,14.4,9.7z M12.8,15.7c-0.2-0.3-0.5-0.5-0.8-0.5c-0.5,0-0.9,0.3-0.9,0.8c-0.3,0-0.5,0.1-0.8,0.1
		c0.1-0.7,0.3-1.4,0.4-2c0.7,0,1.2-0.6,1.3-1.3c0.3,0,0.5-0.1,0.8-0.1c0.1,0.2,0.2,0.3,0.4,0.3c0.2,0,0.4-0.2,0.5-0.4
		c0.2,0,0.4,0,0.6-0.1c0,0.3-0.1,0.6-0.1,0.9c-0.3,0-0.5,0.3-0.5,0.6c0,0.2,0.1,0.4,0.3,0.5c0,0.2-0.1,0.3-0.1,0.5
		c0,0.2-0.1,0.4-0.2,0.6C13.3,15.6,13,15.7,12.8,15.7z M14,15L14,15c0-0.1,0.1-0.2,0.1-0.3c0.3,0,0.6-0.3,0.6-0.6
		c0-0.2-0.1-0.4-0.3-0.5c0.1-0.3,0.1-0.6,0.2-1c0.3,0,0.6,0,0.9,0c0.1,0.4,0.5,0.8,1,0.8c0.1,0,0.2,0,0.3,0c0.3,0.4,0.6,0.9,0.8,1.3
		c-0.9,0.3-2.1,0.7-3.6,1C13.9,15.3,14,15.1,14,15z M15.4,12.2c-0.3,0-0.6,0-0.8,0.1c0.1-0.5,0.1-0.9,0.2-1.3
		c0.1,0.1,0.3,0.3,0.4,0.4c0.1,0.1,0.3,0.3,0.4,0.4C15.5,11.9,15.4,12,15.4,12.2z M14.2,12.3c-0.2,0-0.5,0-0.7,0.1
		c-0.1-0.2-0.2-0.3-0.4-0.3c-0.2,0-0.4,0.2-0.5,0.4c-0.4,0-0.6,0.1-0.7,0.1c-0.1-0.4-0.3-0.7-0.6-0.9c0.3-0.9,0.6-1.8,1-2.5
		c0.7,0.4,1.4,0.9,2.1,1.4C14.3,11.1,14.3,11.7,14.2,12.3z M6.2,14.3c0.8-0.3,1.9-0.7,3.2-1c0.1,0.2,0.3,0.4,0.5,0.6c0,0,0,0,0,0.1
		c-0.2,0.8-0.3,1.5-0.5,2.2c-0.8,0.1-1.5,0.1-2.1,0.1C6.9,15.6,6.5,15,6.2,14.3z M6.9,16.3c-0.6,0-1.1-0.1-1.5-0.1
		c0.1-0.5,0.3-1,0.5-1.5C6.2,15.2,6.6,15.7,6.9,16.3z M10,16.8c0.4,0,0.8-0.1,1.1-0.1c0.2,0.2,0.4,0.4,0.8,0.4
		c0.4,0,0.8-0.3,0.9-0.6c0.1,0,0.3-0.1,0.5-0.1c-0.4,1.2-0.9,2.4-1.4,3.4c-0.1,0.1-0.3,0.1-0.4,0.2c-0.6-0.3-1.2-0.7-1.8-1.1
		C9.8,18.2,9.9,17.5,10,16.8z M17.3,12.8c0-0.1,0.1-0.2,0.1-0.2c0.4,0,0.8,0.1,1.1,0.1c-0.1,0.4-0.3,0.9-0.5,1.3
		C17.8,13.6,17.6,13.2,17.3,12.8z M15.5,7.8c-0.2,0-0.5,0-0.8,0c0-0.3-0.1-0.5-0.2-0.8c0.6,0.2,1.1,0.4,1.6,0.8
		C15.9,7.8,15.7,7.8,15.5,7.8z M13.9,7L13.9,7c0.2,0.1,0.3,0.4,0.4,0.9c-0.5,0.1-1.1,0.2-1.7,0.4C13.1,7.5,13.6,6.9,13.9,7z M5,16.1
		c-0.4-0.1-0.6-0.2-0.7-0.3l0,0h0c-0.2-0.2,0.3-0.6,1.2-1C5.3,15.1,5.1,15.6,5,16.1z M4.8,16.7c0,0.2-0.1,0.4-0.1,0.6
		c-0.1-0.2-0.2-0.5-0.2-0.7C4.6,16.6,4.7,16.7,4.8,16.7z M5.4,16.8c0.6,0.1,1.3,0.1,2.1,0.1c0.1,0.1,0.2,0.3,0.4,0.4
		c-0.1,0.1-0.1,0.2-0.1,0.4c0,0.3,0.3,0.6,0.6,0.6c0.1,0,0.2,0,0.3-0.1c0.1,0.1,0.3,0.3,0.4,0.4C9,19.4,9,20,9,20.5
		c-1,0.1-1.9-0.1-2.5-0.5c-0.2-0.2-0.3-0.4-0.5-0.5l0,0C5.5,18.8,5.3,17.9,5.4,16.8z M9.1,21.2c0,0.2,0.1,0.4,0.1,0.6
		c-0.4-0.2-0.9-0.4-1.3-0.6C8.3,21.2,8.7,21.2,9.1,21.2z M10.2,22L10.2,22c-0.2-0.1-0.3-0.5-0.4-0.9c0.5-0.1,1.1-0.2,1.7-0.4
		C10.9,21.6,10.4,22.2,10.2,22z M19.2,12.8c0.3,0.1,0.5,0.2,0.5,0.3c0,0,0,0.1,0,0.1l0,0c0,0.2-0.3,0.5-0.9,0.8
		C19,13.6,19.1,13.2,19.2,12.8z M13,6.7c-0.3,0.3-0.7,0.8-1,1.5c-1.2-0.5-2.3-0.8-3.3-0.7c1-0.5,2.2-0.8,3.4-0.8
		C12.3,6.7,12.7,6.7,13,6.7z M5,11c0,0.9,0.2,2,0.7,3.1c-0.6,0.2-1.1,0.5-1.5,0.7c0-0.1,0-0.2,0-0.3C4.2,13.2,4.5,12.1,5,11z
		 M12,22.3c-0.4,0-0.7,0-1.1-0.1c0.3-0.3,0.7-0.9,1.1-1.6c1.1,0.5,2.2,0.8,3.2,0.8v0c0.1,0,0.2,0,0.2,0C14.5,22,13.3,22.3,12,22.3z
		 M19.1,17.8c0-0.9-0.2-1.9-0.6-2.9c0.5-0.2,1-0.5,1.3-0.7c0,0.1,0,0.2,0,0.3C19.8,15.7,19.6,16.8,19.1,17.8z"></path>
</g>
</svg>


<svg version="1.1" id="whiteboard" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<g>
	<polygon points="11.9,11.3 11.9,12.2 13.5,12.2 14.1,11.8 12.7,10.5 	"></polygon>
	<path d="M19.7,1.3l-3.3,3.3H1v13.2v2.4V23h1.5v-2.7h19V23H23v-2.8v-2.3V4.7L19.7,1.3z M15.4,7.3C15.4,7.3,15.4,7.3,15.4,7.3L19.7,3
		l1.5,1.5l-4.7,4.7l-1.1,0.5l-0.9-0.9L15,7.7L15.4,7.3z M21.5,17.9v0.8h-19v-0.9h0V6.2h12.4l-1,1l-1,2.5l2,2l2.3-1.1l4.3-4.3V17.9z"></path>
</g>
<rect x="2.3" y="15.9" width="19.7" height="1.4"></rect>
</svg>


<svg version="1.1" id="wired" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
<polygon points="14.7,5.7 14.7,4.2 9.2,4.2 9.2,5.7 6.1,5.7 6.1,16 7.3,16 7.3,21.4 11,21.4 11,20.5 8.3,20.5 8.3,16 8.3,16 8.3,16 
	8.3,16 8.3,13.6 10.1,13.6 10.1,11.7 13.8,11.7 13.8,13.6 15.7,13.6 15.7,16 15.7,16 15.7,16 15.7,20.5 12.9,20.5 12.9,21.4 
	16.6,21.4 16.6,16 17.7,16 17.7,5.7 "></polygon>
<rect x="10.1" y="18.5" width="1" height="4.5"></rect>
<rect x="12.9" y="18.5" width="1" height="4.5"></rect>
<polygon points="0.8,0.7 0.8,23.2 6.1,23.2 6.1,22.2 1.7,22.2 1.7,1.7 22.3,1.7 22.3,22.2 17.7,22.2 17.7,23.2 23.2,23.2 23.2,0.7 
	"></polygon>
</svg>


<svg version="1.1" id="maximize" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
	<path d="M23 22V2H1v20h22zM13 8V6h7v7h-2V9.5l-4.75 4.75-1.5-1.5L16.5 8H13z"></path>
</svg>


<svg version="1.1" id="minimize" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
	<path d="M1 2v20h22V2H1zm10 15v2H4v-7h2v3.5l4.75-4.75 1.5 1.5L7.5 17H11z"></path>
</svg>


<svg version="1.1" id="add-new" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
	<path d="M12,1C5.9,1,1,5.9,1,12s4.9,11,11,11s11-4.9,11-11S18.1,1,12,1z M17,13h-4v4h-2v-4H7v-2h4V7h2v4h4V13z"></path>
</svg>


<svg version="1.1" id="remove" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-3557.000000, -649.000000)">
            <g transform="translate(3557.000000, 649.000000)">
                <rect fill="currentColor" fill-rule="nonzero" x="6" y="10" width="10" height="2"></rect>
                <circle stroke="currentColor" stroke-width="2" cx="11" cy="11" r="10"></circle>
            </g>
        </g>
    </g>
</svg>


<svg id="incomplete" width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
	<path d="M11,20 C15.9705627,20 20,15.9705627 20,11 C20,6.02943725 15.9705627,2 11,2 C6.02943725,2 2,6.02943725 2,11 C2,15.9705627 6.02943725,20 11,20 Z M11,22 C4.92486775,22 0,17.0751322 0,11 C0,4.92486775 4.92486775,0 11,0 C17.0751322,0 22,4.92486775 22,11 C22,17.0751322 17.0751322,22 11,22 Z"></path>
</svg>


<svg id="mail" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" version="1.1" width="24px" height="24px">
	<path d="M12 3L1 9v12h22V9L12 3zm0 14.145l-9.486-5.271.972-1.748L12 14.856l8.515-4.729.971 1.748L12 17.145z"></path>
</svg>
</iron-iconset-svg><dom-module id="triplat-icon" assetpath="../triplat-icon/">
    <style>
        :host {
            @apply(--layout-inline);
            @apply(--layout-center-center);
            position: relative;
            vertical-align: middle;
        }
        iron-icon {
            --iron-icon-height: var(--triplat-icon-height);
            --iron-icon-width: var(--triplat-icon-width);
            --iron-icon-fill-color: var(--triplat-icon-fill-color);
            --iron-icon-stroke-color: var(--triplat-icon-stroke-color);
            @apply(--triplat-icon-style);
            @apply(--triplat-icon-iron-icon);
        }

 
    </style>
    <template>
        <iron-meta type="iconset" list="{{iconsets}}"></iron-meta>

        <iron-icon id="triCustomIcon" icon="{{_setIcon(icon,iconsets)}}" class="{{_setClass(class)}}" tabindex$="[[tabIndex]]" role="button" aria-label$="{{description}}" on-keypress="_keyPressHandler"></iron-icon>
    </template>
</dom-module>
<script>
    Polymer({
		is: "triplat-icon",  

        properties: {
             /**
              * Class property to be applied to this element and its children.
              *
              **/
            class: String,
            /**
              * Description property to be applied to aria-label for assistive tool to read out description for this icon.
              *
              **/
            description: String,
            /**
              * Icon from the icon set to be displayed. See demo page for list of valid values. The icon set prefix does not 
              * need to be specified unless the same icon exists in multiple icon sets. 
              *
              **/
            icon: {
            	type: String,
            	reflectToAttribute: true
            },
            /**
              * Mirror property which acts as a flag. When used it will mirror the icon.
              *
              **/
            mirror: {
            	type: Boolean,
            	value: false
            },

            /**
              * Value to be applied to the tabindex attribute.
              *
              */
            tabIndex: Number
        },
        
        attached: function(){
        	if(this.mirror && document.querySelector('body').getAttribute('dir')=="rtl"){
        		this._setStyle("transform: scaleX(-1)");
        	}
        	
        	var svgElement = this.$.triCustomIcon.querySelector("svg");
        	if(svgElement){
            	//Microsoft Edge cause unnecessary tabing on svg elements that inside the triplat-icon.
            	//Setting svg to not focusable avoid duplicated tabbing
    			Polymer.dom(svgElement).setAttribute("focusable", "false");
        	}
        },

		_setIcon: function(val,iconsets) {
            if (!val) {
                return "";
            }

			if(!this.description) {
				this.set("description", val.replace(/-/g," "));
			}

            // if the user already specified an icon set, then just use that
            if (val.indexOf(":") != -1) {
                return val;
            }

            var fulliconname = "ibm:" + val;

            for (var i=0; i < this.iconsets.length; i++) {
                //NOTE: precedent of the search is based on the import order
                if (this.iconsets[i].name.indexOf("ibm") != -1) {
                    var names = this.iconsets[i].getIconNames();
                    var fqval = this.iconsets[i].name + ":" + val;
                    if (names.indexOf(fqval) != -1) {
                        fulliconname = fqval;
                        break;
                    }
                }
            }
            
			return fulliconname;
		},

        _setStyle: function(style){
            this.$.triCustomIcon.style.cssText = style;
        },
        
        _resetClassMap: function() {
        	for (var myclass in this.$.triCustomIcon._classMap) {
        		this.$.triCustomIcon._classMap[myclass] = false;
        	}
        },
        
        _cleanClassMap: function() {
        	var returnClassArray = [];
        	for (var myclass in this.$.triCustomIcon._classMap) {
        		if (!this.$.triCustomIcon._classMap[myclass]) {
        			returnClassArray.push(myclass);
        			delete this.$.triCustomIcon._classMap[myclass];
        		}
        	}
        	return returnClassArray;
        },
        
        _isNewClassInMap: function(newclass) {
        	if (typeof this.$.triCustomIcon._classMap == 'undefined') {
        		this.$.triCustomIcon._classMap = {};
        		this.$.triCustomIcon._classMap[newclass] = true;
        		return true;
        	} else {
        		if (newclass in this.$.triCustomIcon._classMap) {
        			this.$.triCustomIcon._classMap[newclass] = true;
        			return false;
        		} else {
        			this.$.triCustomIcon._classMap[newclass] = true;
        			return true;
        		}
        	}
        },

        _setClass: function(myclass){
            if (!myclass) {
                return;
            }
            this._resetClassMap();
            var arr = myclass.split(" ");
            // add in new addition class
            for (var i=0; i < arr.length; i++) {
                if (this._isNewClassInMap(arr[i])) {
                	this.$.triCustomIcon.classList.add(arr[i]);
                }
            }
            // remove unused class
            var deleteClasses = this._cleanClassMap();
            for (var i=0; i < deleteClasses.length; i++) {
            	this.$.triCustomIcon.classList.remove(deleteClasses[i]);
            }

            this.$.triCustomIcon.classList.remove("flex");
            for (var i=1; i < 13; i++) {
                this.$.triCustomIcon.classList.remove("flex-" + i);
            }
         },
        
        _keyPressHandler: function(event) {
        	var code = event.keyCode;
        	// accept enter or spacebar
        	if (code == 13 || code == 32) {
        		this.fire("tap", event.currentTarget, event);
        	}
        }

    });
</script><script>
	/**
	 * `TriBlockNavBehavior` handles navigating to pages and invoking actions depending on the populated properties.  It can navigate to both route and iron pages and also invoke actions on both tap and event handlers at the same time.  If all properties are specified with values the order of execution are as follows:  
	 *	<ul>
	 * 		<li>Fire `navigate` event</li>
	 * 		<li>Navigate to a route page</li>
	 * 		<li>Navigate to an iron page</li>
	 * 		<li>Invoke tap handler</li>
	 *	</ul>
	 *
	 *
	 * @polymerBehavior
	 */
	TriBlockNavBehavior = {

	    properties: {
		/**
		 * Value of the `id` property of the `triplat-route` to be navigated.
		 */
	      triplatRouteId: String,
		/**
		 * URL parameters when navigating to a `triplat-route`.
		 */
	      triplatRouteParams: Object,
		/**
		 * Value of the `id` property of the `iron-pages` to be navigated.
		 */
	      ironPagesId: String,
		/**
		 * Identifier of the iron page inside `iron-pages` to be navigated.  Value can either be from the `id` property or from the property specified in the `attr-for-selected` property of `iron-pages`. 
		 */
	      ironPageId: String,
		/**
		 * Name of the action or function to call when the navigation is tapped.
		 */
	      tapHandler: String,
	    },
	
		attached: function() {
			if (this._isTriplatRoute()) {
				var routeEl = this._getTriplatRouteElement();
				if (routeEl) {
					this.listen(routeEl, 'route-active', '_onRouteActive');
				}
			}
		},
		
		detached: function() {
			if (this._isTriplatRoute()) {
				var routeEl = this._getTriplatRouteElement();
				if (routeEl) {
					this.unlisten(routeEl, 'route-active', '_onRouteActive');
				}
			}
		},
		
		_onRouteActive: function(e) {
			if (e.detail.active) {
				this.fire("triblock-nav-behavior-route-activated", {triplatRouteId: this.triplatRouteId});
			}
		},
	
	    /**
	     * Navigates to route and/or iron pages and/or invokes an action based on the tap and event handlers.
	     */
	    _navigate: function() {
			/**
			 * Fired when `navigate` is called.  It is fired before pages are routed or a tap handler is invoked.  The element is passed to the event listener as an item, like `e.detail.item`.  
			 *
			 * @event navigate
			 */
	      this.fire("navigate", {item: this});
	      
	      // navigate to triplat route page if needed
	      this._navigateRoutePage();
	
	      // navigate to iron page if needed
	      this._navigateIronPage();
	
	      // navigate to tap handler if needed
	      this._executeTapHandler();
	    },
	
		_isTriplatRoute: function() {
			return this.triplatRouteId && this.triplatRouteId != "";
		},
		
		_getTriplatRouteElement: function() {
			if (this._isTriplatRoute()) {
		        var triplatRouteSelector = "triplat-route#" + this.triplatRouteId;
		        return document.querySelector(triplatRouteSelector);			
			}
			return null;
		},
		
	    _navigateRoutePage: function() {
	      if (this._isTriplatRoute()) {
	        var triplatRoute = this._getTriplatRouteElement();
	        if (triplatRoute) {
						if (!triplatRoute.active) {
							try {
									if (triplatRoute._contextInitialized) {
										 triplatRoute.navigate(this.triplatRouteParams);
									}
							} catch (e) {
								console.error("An error occurred while navigating to route page: " + this.triplatRouteId + " Error: " + e.message);
							}
						}
	        } else {
	          console.warn("Could not find a <triplat-route> element with an `id` value of " + this.triplatRouteId + ".");
	        }
	      }
	    },
	
	    _navigateIronPage: function() {
	      if (this.ironPagesId && this.ironPagesId != "" && this.ironPageId && this.ironPageId != "") {
	        var ironPagesSelector = "iron-pages#" + this.ironPagesId;
	        var domHost = this.domHost || document;
	        var ironPagesContainer = domHost.querySelector(ironPagesSelector);
	        if (ironPagesContainer) {
	        	if (!ironPagesContainer.attrForSelected) {
	        		ironPagesContainer.attrForSelected = "id";
	        	}
	          ironPagesContainer.selected = this.ironPageId;
	        } else {
	           console.warn("Could not find a <iron-pages> element with an `id` value of " + this.ironPagesId + "."); 
	        }
	      }
	    },
	
	    _executeTapHandler: function() {
	      if (this.tapHandler && this.tapHandler != "") {
	        this.domHost[this.tapHandler](this);
	      }
	    },
	};
</script><script>
	Polymer({

		is: "triblock-banner-button",

		behaviors: [TriBlockNavBehavior],

		properties: {
	    	/**
	    	 * Gets or sets the label of the navigation item.
	    	 */
			label: String,
	    	/**
	    	 * Gets or sets the name of the icon of the navigation item.  See the demo pages of `triplat-icon` and `iron-icons` for the list of available icons to use.
	    	 */
			icon: String,
	    	/**
	    	 * Indicates that the banner button is for the Home button.
	    	 */
			home: {
				type: Boolean,
				value: false
			},
	    	/**
	    	 * Indicates that the banner button is for the Back button.
	    	 */
			back: {
				type: Boolean,
				value: false
			},
		},

		observers: [
			'_handleLabelChanged(label)'
		],

		_handleLabelChanged: function(label) {
			this._refreshTabs();
		},
		
		_refreshTabs: function() {
  			/**
 			 * Fired when the properties of a navigation item get updated.  The element is passed to the event listener as an item, like `e.detail.item`.
  			 *
 			 * @event update
  			 */
			this.fire("update", {item: this});
		}
	});
</script><dom-module id="triblock-app-layout" assetpath="../triblock-app-layout/">
	<template>
		<style>

			/* Workaround for iron-overlay-behavior Polymer Issue 155 */
			paper-header-panel > ::content > #mainPanel > #mainContainer {
				-webkit-overflow-scrolling: auto; 
			}
			
			paper-header-panel {
				background-color: var(--triblock-app-layout-body-background-color, --tri-body-background-color);
			}

			paper-toolbar {
				background-color: var(--triblock-app-layout-banner-background-color, --tri-header-background-color);
				color: var(--triblock-app-layout-banner-color, --tri-header-color);
				--paper-toolbar-height: var(--triblock-app-layout-banner-height, 50px);
				--paper-toolbar-sm-height: var(--triblock-app-layout-banner-height, 50px);
				--paper-toolbar-content: {
					padding: 0 0 0 0;
					max-width: var(--triblock-app-layout-content-max-width, 1440px);
					width: 100%;
					margin: 0 auto;
				};
				@apply(--triblock-app-layout-banner);
			}
			
			.ibm {
				font-weight: lighter;
			}

			.app-title {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--paper-font-common-nowrap);
				font-size: 18px;
			}
			
			.app-title-padding {
				padding-left: 15px;
			}
			
			.app-title-padding[dir="rtl"] {
				padding-right: 15px;
			}

			.back-placeholder {
				min-width: 44px;
			}

			.back-button {
				@apply(--triblock-app-layout-banner-mobile-back-button);
			}
			
			.back-label {
				font-size: 18px;
				@apply(--triblock-app-layout-banner-mobile-back-label);
			}
			
			.page-label {
				@apply(--layout-flex);
				@apply(--paper-font-common-nowrap);
				text-align: center;
				font-size: 18px;
				font-weight: normal;

				@apply(--triblock-app-layout-banner-mobile-page-label);
			}

			.toolbar-buttons {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}
			
			.toolbar-button {
				color: var(--triblock-app-layout-banner-button-color, --tri-header-color);
				padding: 8px;
				height: 44px;
				margin: 0px;
				min-width: 0px;
				margin-right: 3px;
			}
			
			.toolbar-button[dir="rtl"]{
				margin: 0px;
				margin-left: 3px;
			}
			
			.toolbar-button:hover {
				color: var(--triblock-app-layout-banner-button-hover-color, --tri-footer-icon-button-hover-color);
			}
			
			.toolbar-button[pressed] {
				color: var(--triblock-app-layout-banner-button-press-color, --tri-footer-icon-button-press-color);
			}
			
			.toolbar-button > iron-icon {
				width: 28px;
				height: 28px;
				padding: 0px;
				color: inherit;
			}
			
			.toolbar-button > span {
				padding: 0px 0px 0px 10px;
				@apply(--triblock-app-layout-banner-button-label);
			}
			
			.toolbar-button[dir="rtl"] > span {
				padding: 0px 10px 0px 0px;
			}
				
			iron-icon[dir="rtl"] {
				transform: scaleX(-1);		
			}
			
			iron-icon {
				flex-shrink: 0;
				padding-right: 10px;
				color: var(--triblock-app-layout-mobile-drawer-icon-color, --tri-header-color);
			}
			
			paper-drawer-panel {
				--paper-drawer-panel-scrim: {
					z-index: var(--triblock-app-layout-scrim-z-index, 3);
				};
				--paper-drawer-panel-drawer-container: {
					z-index: var(--triblock-app-layout-mobile-drawer-z-index, 104);
					background-color: var(--triblock-app-layout-mobile-drawer-background-color, --tri-primary-color-70);
				};

				@apply(--triblock-app-layout-paper-drawer-panel);
			}

			paper-menu {
				--paper-menu-background-color: var(--triblock-app-layout-mobile-drawer-background-color, --tri-primary-color-70);
				--paper-menu-color: var(--triblock-app-layout-mobile-drawer-color, --tri-header-color);
				--paper-menu-selected-item: {
					opacity: 1;
					font-weight: normal;
				};
				--paper-menu-focused-item: {
					background-color: var(--triblock-app-layout-mobile-drawer-hover-background-color, --tri-primary-color-80);
				};
				--paper-menu-focused-item-after: {
					background-color: var(--triblock-app-layout-mobile-drawer-background-color, --tri-primary-color-70);
				};
				--paper-menu: {
					padding: 0 0;
				};
			}

			paper-item {
				--paper-item: {
					cursor: pointer;
					padding: 10px 16px;
				};
				--paper-item-min-height: 40px;
			}
		
			paper-item:hover {
				background-color: var(--triblock-app-layout-mobile-drawer-hover-background-color, --tri-primary-color-80);
			}
			
			paper-item:focus:before {
				background-color: var(--triblock-app-layout-mobile-drawer-hover-background-color, --tri-primary-color-80);
			}

			.drawer-close-container {
				@apply(--layout-horizontal);
				@apply(--layout-end-justified);
			}
			
			.content > ::content [content] {
				@apply(--layout-fit);
				max-width: var(--triblock-app-layout-content-max-width, 1440px);
				margin: 0 auto;
				width: 100%;
			}

			.page-label, .back-label{
				text-overflow: ellipsis;
			} 
			
			.app-title > b{
				overflow:hidden;
				text-overflow: ellipsis;
			}

		</style>

		<template is="dom-if" if="[[disable]]">
			<div class="content">
				<content></content>
			</div>
		</template>
		
		<template is="dom-if" if="[[!disable]]">
			
		<iron-media-query query="{{_computeMediaQuery(responsiveWidth)}}" query-matches="{{_responsiveWidthMet}}"></iron-media-query>

		<content select="triblock-banner-button"></content>
		<triplat-signout id="signout" home-app="[[homeApp]]"></triplat-signout>

		<paper-drawer-panel id="mobileDrawer" right-drawer="[[_computeDrawerPosition(_dir)]]" force-narrow="" disable-swipe="[[_responsiveWidthMet]]" disable-edge-swipe="[[_disableEdgeSwipeDrawer(_responsiveWidthMet, disableEdgeSwipe)]]" drawer-width="[[drawerWidth]]">
			<paper-header-panel main="" mode="seamed">
				<paper-toolbar>
					<div>
						<template is="dom-repeat" items="{{_bannerButtonElements}}" filter="_isHomeButton">
							<paper-button dir="[[_dir]]" noink="" class="toolbar-button tri-disable-theme" on-tap="_handleHomeButtonTapped" aria-label$="[[_computeHomeLabel(item)]]" alt$="[[_computeHomeLabel(item)]]" banner-item="[[item]]" hidden="[[_computeShowBackButton(_responsiveWidthMet, showMobileBackButton)]]">
								<iron-icon dir="[[_dir]]" icon$="[[_computeHomeIcon(item)]]"></iron-icon><span hidden$="[[_computeHideButtonLabel(item, displayButtonLabel)]]">[[item.label]]</span>
							</paper-button>
						</template>
					</div>
					<div class$="[[_computeAppTitleStyleClass(_hasHomeButton)]]" dir="[[_dir]]" hidden$="[[_computeShowBackButton(_responsiveWidthMet, showMobileBackButton)]]">
						<template is="dom-if" if="{{!_hasAppTitle}}">
							<h1 class="app-title"><span class="ibm">IBM&nbsp;</span><b>TRIRIGA [[appLabel]]</b></h1>
						</template>
						<content select="[app-title]"></content>
					</div>
					<div class="back-placeholder" hidden$="{{!_computeShowBackButton(_responsiveWidthMet, showMobileBackButton)}}">
						<template is="dom-repeat" items="{{_bannerButtonElements}}" filter="_isBackButton">
							<paper-button dir="[[_dir]]" noink="" class="back-button toolbar-button tri-disable-theme" on-tap="_handleBackButtonTapped" aria-label$="{{_computeBackLabel(item)}}" alt$="[[_computeBackLabel(item)]]" banner-item="[[item]]">
								<iron-icon dir="[[_dir]]" icon$="[[_computeBackIcon(item)]]"></iron-icon><span class="back-label" hidden$="[[!_computeShowBackLabel(mobilePageLabel)]]">[[item.label]]</span>
							</paper-button>
						</template>
					</div>
					<h1 class="page-label" hidden$="{{!_computeShowBackButton(_responsiveWidthMet, showMobileBackButton)}}">
						[[mobilePageLabel]]
					</h1>
					<div class="toolbar-buttons" hidden$="{{!_responsiveWidthMet}}">
						<template is="dom-repeat" items="{{_bannerButtonElements}}" filter="_isCustomButton">
							<paper-button dir="[[_dir]]" noink="" class="toolbar-button tri-disable-theme" on-tap="_handleCustomButtonTapped" banner-item="[[item]]" aria-label$="[[item.label]]" alt$="[[item.label]]">
								<iron-icon dir="[[_dir]]" icon$="[[item.icon]]"></iron-icon><span hidden$="[[_computeHideButtonLabel(item, displayButtonLabel)]]">[[item.label]]</span>
							</paper-button>
						</template>
						<paper-button dir="[[_dir]]" noink="" class="toolbar-button tri-disable-theme" on-tap="_signout" aria-label="Sign Out" alt="Sign Out" hidden="[[hideSignoutButton]]">
							<iron-icon dir="[[_dir]]" icon="ibm:sign-out"></iron-icon><span hidden$="[[!displayButtonLabel]]">Sign Out</span>
						</paper-button>
					</div>
					<paper-button dir="[[_dir]]" noink="" class="dropdown-trigger toolbar-button tri-disable-theme" on-tap="_openMobileDrawer" banner-item="[[item]]" aria-label="Menu" alt="Menu" hidden$="[[_responsiveWidthMet]]">
						<iron-icon dir="[[_dir]]" icon="ibm-glyphs:menu"></iron-icon>
					</paper-button>
				</paper-toolbar>
				<div class="content">
					<content></content>
				</div>
			</paper-header-panel>
			<div drawer="">
				<paper-menu id="mobileMenu" selected="1">
					<paper-item class="drawer-close-container" on-tap="_closeMobileDrawer" role="menuitemradio">
						<iron-icon icon="ibm:close-cancel-error" class="drawer-close-icon"></iron-icon>
					</paper-item>
					<template is="dom-repeat" items="{{_bannerButtonElements}}" filter="_isCustomButton">
						<paper-item on-tap="_handleCustomButtonDrawerTapped" banner-item="{{item}}" aria-label$="[[item.label]]" role="menuitemradio">
							<iron-icon dir="[[_dir]]" icon$="[[item.icon]]"></iron-icon><span>[[item.label]]</span>
						</paper-item>
					</template>
					<template is="dom-repeat" items="{{_bannerButtonElements}}" filter="_isHomeButton">
						<paper-item on-tap="_handleHomeButtonDrawerTapped" banner-item="{{item}}" aria-label$="{{_computeHomeLabel(item)}}" role="menuitemradio">
							<iron-icon dir="[[_dir]]" icon$="{{_computeHomeIcon(item)}}"></iron-icon><span>{{_computeHomeLabel(item)}}</span>
						</paper-item>
					</template>
					<paper-item hidden$="[[hideSignoutButton]]" on-tap="_signout" aria-label="Sign Out" role="menuitemradio">
						<div class="menu-item-container">
							<iron-icon dir="[[_dir]]" icon="ibm:sign-out"></iron-icon><span class="menu-item-label">Sign Out</span>
						</div>
					</paper-item>
				</paper-menu>
			</div>
		</paper-drawer-panel>
	</template>
		
	</template>
</dom-module>
<script>
	Polymer({

		is: "triblock-app-layout",

		/**
 		 * @polymerBehavior
 		 */
		behaviors: [TriBlockNavIronPagesContainerBehavior],

		properties: {
			/**
	 		 * The name of the home application. 
	 		 * This is used to redirect the user to the home application after signing out from the current application.  
	 		 */
			homeApp: String,
			/**
	 		 * Application label displayed in the toolbar after "IBM TRIRIGA". 
	 		 * You can override this if you have an element with the `app-title` attribute.
	 		 */
			appLabel: {
				type: String,
				observer: '_handleAppLabelChanged'
			},
			/**
	 		 * Hides the Sign Out button.
	 		 */
			hideSignoutButton: {
				type: Boolean,
				value: false
			},
			/**
	 		 * Specifies drawer width. 
	 		 */
			drawerWidth: {
				type: String,
				value: "256px"
			},
			/**
	 		 * Shows the Back button in mobile view and replaces the application label.
	 		 */
			showMobileBackButton: {
				type: Boolean,
				value: false
			},
			/**
	 		 * Max width to enable mobile drawer.
	 		 */
			responsiveWidth: {
				type: String,
				value: "600px"
			},
			/**
	 		 * Page label for mobile view. Only shown when showMobileBackButton is true. Note that the back label will be hidden if a page label is provided.
	 		 */
			mobilePageLabel: {
				type: String,
				value: null
			},
			_hasAppTitle: {
				type: Boolean,
				value: false
			},
			_bannerButtonElements: Array,
			_dir: String,
			/**
	 		 * If true, swipe from the edge to open the mobile drawer is disabled.
	 		 */
			disableEdgeSwipe: {
				type: Boolean,
				value: false
			},
			
			/**
	 		 * If true, this app layout will not be applied to the `content`.
	 		 */
			disable: {
				type: Boolean,
				value: false
			},
			/**
			 * If true, It displays the button labels in the toolbar.
			 */
			displayButtonLabel: {
				type: Boolean,
				value: false
			},
			_hasHomeButton: {
				type: Boolean,
				value: false
			}
		},

		_escKeyDownHandler: null,
		
		attached: function() {
			this._retrieveBannerButtonItems();
			this._handleAppTitleContent();
			this._escKeyDownHandler = this._escKeyHandler.bind(this);
			
			var textDirectionValue = document.querySelector('body').getAttribute('dir');
			this.set('_dir', textDirectionValue ? textDirectionValue : "ltr");
			
			var homeButton = Polymer.dom(this).querySelector("triblock-banner-button[home]");
			if (homeButton) {
				this.set('_hasHomeButton', true);
			} else {
				this.set('_hasHomeButton', false);
			}
		},
		
		_retrieveBannerButtonItems: function() {
			var bannerButtonElements = Polymer.dom(this).querySelectorAll("triblock-banner-button");
			this.set('_bannerButtonElements', bannerButtonElements);
		},
		
		_getElementsToApplyIronPagesId: function() {
			if (!this._bannerButtonElements) {
				this._retrieveBannerButtonItems();
			}
		
			return this._bannerButtonElements;
		},
		
		_computeDrawerPosition: function(dir) {
			if (dir==="rtl") {
				return false;
			} else {
				return true;
			}
		},

		_computeMediaQuery: function(responsiveWidth) {
			return "min-width: " + responsiveWidth;
		},
		
		_escKeyHandler: function(e) {
			if (e.keyCode === 27) {
				e.preventDefault();
				this._closeMobileDrawer();
			}
		},

		_handleAppTitleContent: function() {
			var appTitleContent = Polymer.dom(this).querySelector("[app-title]");
			if (appTitleContent) {
				this.set('_hasAppTitle', true);
				document.title = appTitleContent.title ? appTitleContent.title : appTitleContent.textContent;
			}
		},

		_isCustomButton: function(item) {
			return !this._isBackButton(item) && !this._isHomeButton(item);
		},
		
		_isHomeButton: function(item) {
			return item.home;
		},
		
		_isBackButton: function(item) {
			return item.back;
		},
		
		_computeBackIcon: function(item) {
			return item.icon ? item.icon : "ibm-glyphs:back";
		},

		_computeHomeIcon: function(item) {
			return item.icon ? item.icon : "ibm:home";
		},

		_computeHomeLabel: function(item) {
			var __dictionary__home = "Home";
			return item.label ? item.label : __dictionary__home;
		},
		
		_computeBackLabel: function(item) {
			var __dictionary__back = "Back";
			return item.label ? item.label : __dictionary__back;
		},
		
		_computeShowBackButton: function(responsiveWidthMet, showMobileBackButton) {
			return !responsiveWidthMet && showMobileBackButton;
		},
		
		_computeShowBackLabel: function(pageLabel) {
			return !pageLabel;
		},

		_handleAppLabelChanged: function(appLabel) {
		    if (!this._hasAppTitle) {
				document.title = "IBM TRIRIGA " + appLabel;
		    }
		},

		_handleBackButtonTapped: function(e) { 
			if (e.currentTarget.bannerItem){
				this._navigate(e.currentTarget.bannerItem); 
			}
		},

		_handleHomeButtonTapped: function(e) {
			this._navigate(e.currentTarget.bannerItem); 
		},
		
		_handleHomeButtonDrawerTapped: function(e) {
			this._handleHomeButtonTapped(e);
			this._closeMobileDrawer(); 
		},

		_handleCustomButtonTapped: function(e) {
			this._navigate(e.currentTarget.bannerItem); 
		},

		_handleCustomButtonDrawerTapped: function(e) {
			this._handleCustomButtonTapped(e);
			this._closeMobileDrawer();
		},

		_navigate: function(item) {
			item._navigate(); 
		},

		_openMobileDrawer: function() {
			this._removeEscKeyListener(); //clean-up previous listener before adding
			this._addEscKeyListener();
			this.$$('#mobileDrawer').openDrawer();
		},

		_closeMobileDrawer: function() {
			this._removeEscKeyListener();
			this.$$('#mobileDrawer').closeDrawer();
		},

		_addEscKeyListener: function() {
			this.$$('#mobileMenu').addEventListener('keydown', this._escKeyDownHandler);
		},
		
		_removeEscKeyListener: function() {
			this.$$('#mobileMenu').removeEventListener('keydown', this._escKeyDownHandler);
		},
		
		_signout: function() {
			this.$$('#signout').signout();
		},
		
		_disableEdgeSwipeDrawer: function(responsiveWidthMet, disableEdgeSwipe) {
			return !responsiveWidthMet && disableEdgeSwipe;
		},
		
		_computeAppTitleStyleClass: function(_hasHomeButton) {
			return _hasHomeButton ? "app-title" : "app-title app-title-padding";
		},
		
		_computeHideButtonLabel: function(item, displayButtonLabel) {
			return !item.label || item.label == "" || !displayButtonLabel;
		}
	});
</script>
<script>
	/**
	 * `triblock-app-layout-banner-behavior` contains 2 properties that help with `triblock-app-layout` configuration concerning the mobile page label and back button. 
	 *   
	 * This behavior is specifically used in `triblock-app-layout-banner-routing-behavior` and `triblock-app-layout-banner-popup-behavior` which both manipulate the properties of the same name. 
	 *
	 * Example:
	 * ```html
	 *       <triblock-app-layout
	 *           mobile-page-label="[[mobilePageLabel]]"
	 *           show-mobile-back-button="[[showMobileBackButton]]">
	 *           <triblock-banner-button back></triblock-banner-button>
	 *           ...
	 *       </triblock-app-layout>
	 * ```
	 * @polymerBehavior
	*/

	TriBlockAppLayoutBannerBehavior = {
		properties: {
			/** 
			* Boolean value that shows or hides the mobile back button
			*/
			showMobileBackButton: {
				type: Boolean,
				value: false
			},
			/** 
			* Boolean value that shows or hides the mobile back button
			*/
			mobilePageLabel: {
				type: String,
				value: null
			}
		}
	};
</script><script>
	/**
	 * `TriBlockViewResponsiveBehavior` can be used to detect when a device is on a certain screen width.
	 * @polymerBehavior
	 */

TriBlockViewResponsiveBehavior = {

	properties:{
		/**
		 * `(Deprecated)` True if the screen width is less than or equal to the size specified by the <b>smallScreenMaxWidth</b> property.
		 */
		smallScreen:  {
			type: Boolean,
			readOnly: true,
			notify: true,
			value: false,
			reflectToAttribute: true
		},
		/**
		 * True if the screen width is less than or equal to the size specified by the <b>smallScreenMaxWidth</b> property.
		 */
		smallScreenWidth:  {
			type: Boolean,
			readOnly: true,
			notify: true,
			value: false,
			reflectToAttribute: true
		},
		/**
		 * The maximum width of a small screen.
		 */
		smallScreenMaxWidth: {
			type: String,
			value: "600px",
		},
		/**
		 * True if the screen height is less than or equal to the size specified by the <b>smallScreenMaxHeight</b> property.
		 */
		 smallScreenHeight:  {
			type: Boolean,
			readOnly: true,
			notify: true,
			value: false,
			reflectToAttribute: true
		},
		/**
		 * The maximum height of a small screen.
		 */
		smallScreenMaxHeight: {
			type: String,
			value: "800px",
		}, 
		/**
		 * True if the screen width is greater than or equal to the size specified by the <b>mediumScreenMinWidth</b> property, 
		 * and less than or equal to the size specified by the <b>mediumScreenMaxWidth</b> property.
		 */
		mediumScreenWidth: {
			type: Boolean,
			readOnly: true,
			notify: true,
			value: false,
			reflectToAttribute: true
		}, 
		/**
		 * The maximum width of a medium screen.
		 */
		mediumScreenMaxWidth: {
			type: String,
			value: "1024px",
		},
		/**
		 * The minimum width of a medium screen.
		 */
		mediumScreenMinWidth: {
			type: String,
			value: "601px",
		}

	},

	attached: function(){
		this._setMediaQuery();
	},

	_setMediaQuery: function(){
		if(!this._mediaQueryIsSet){
			this._mediaQuery = document.createElement("iron-media-query");
			Polymer.dom(this.root).appendChild(this._mediaQuery);
			this._mediaQuery.addEventListener("query-matches-changed", this._handleSmallScreen.bind(this));
			this._mediaQuery.query = this.smallScreenMaxWidth ?  "(max-width:"+ this.smallScreenMaxWidth + ")" : "(max-width: 600px)";
			
			this._heightMediaQuery = document.createElement("iron-media-query");
			Polymer.dom(this.root).appendChild(this._heightMediaQuery);
			this._heightMediaQuery.addEventListener("query-matches-changed", this._handleSmallScreenHeight.bind(this));
			this._heightMediaQuery.query = this.smallScreenMaxHeight ?  "(max-height:"+ this.smallScreenMaxHeight + ")" : "(max-height: 800px)";

			this._mediumMediaQuery = document.createElement("iron-media-query");
			Polymer.dom(this.root).appendChild(this._mediumMediaQuery);
			this._mediumMediaQuery.addEventListener("query-matches-changed", this._handleMediumScreenWidth.bind(this));
			this._mediumMediaQuery.query = this.mediumScreenMinWidth && this.mediumScreenMaxWidth ?  "(min-width:"+ this.mediumScreenMinWidth + ") and (max-width:" + this.mediumScreenMaxWidth + ")"  : "(max-width: 601px) and (max-width: 1024px)";
			this._mediaQueryIsSet = true;
		}	
	},

	_handleSmallScreen: function(e){
		var isSmallScreen = e.detail.value;
		this._setSmallScreen(isSmallScreen);
		this._setSmallScreenWidth(isSmallScreen);
	},
	
	_handleSmallScreenHeight: function(e){
		var isSmallScreenHeight = e.detail.value;
		this._setSmallScreenHeight(isSmallScreenHeight);
	},

	_handleMediumScreenWidth: function(e){
		var isMediumScreenWidth = e.detail.value;
		this._setMediumScreenWidth(isMediumScreenWidth);
	},    
}
</script><script>
    /** 
     * Implement `triblock-app-layout-banner-popup-behavior` on your main view element that that contains `triblock-app-layout`. This helps with configuration concerning the mobile page label and back button based on `triblock-popup` behaviors.
     * 
     * @polymerBehavior
     */
    TriBlockAppLayoutBannerPopupBehaviorImpl = {

        properties: {
            _previousPageLabel: String,
            _previousShowMobileBackButton: Boolean,
            _openedPopupElement: {
                type: Object,
                observer: '_manageAppLayoutBannerPopup'
            },
            _stateHistoryTemps: {
                type: Array,
                value: function(){
                    return [];
                },
            },
            _currentState:{
                type: Object,
                value: function(){
                    return window.history.state;
                },
            },
            _currentStateURL: String,
        },

        listeners: {
            'popup-opened': '_setOpenedPopupElement'
        },

        observers: [ '_smallScreenWidthChanged(smallScreenWidth)'],

        _setOpenedPopupElement: function(e) {
            this.set('_openedPopupElement', e.detail.element);
            
            if(this._openedPopupElement && this.smallScreenWidth){
                if(this._openedPopupElement.smallScreenWidth) this._setState();

            }else {
                window.removeEventListener("popstate", this._popstateHandler);
                if(this._stateHistoryTemps.length > 0){
                    this._stateHistoryTemps = [];
                    window.history.replaceState(this._currentState, "currentState", this._currentStateURL);
                }
            }
        },

        _setState: function(){
            this._popstateHandler = this._stopBrowserBack.bind(this); 
            this._currentStateURL = location.href;
            //create a new state
            window.history.pushState(this._currentState, "currentState", this._currentStateURL);
            this._stateHistoryTemps.push({state: this._currentState, url: this._currentStateURL});
            var hashPopup = this._currentStateURL + "#popup";
            //modify the state
            window.history.replaceState(this._currentState, "popupState", hashPopup);
            window.addEventListener('popstate', this._popstateHandler);
        },

        //Handle window resize its width to small or large screen, while the popup is opened.
        _smallScreenWidthChanged: function(smallScreen){
            if(smallScreen && this._openedPopupElement){
                var currentWidth = window.innerWidth;
                popupSmallScreenMaxWidth =  parseInt(this._openedPopupElement.smallScreenMaxWidth, 10);
                if(currentWidth <= popupSmallScreenMaxWidth) this._setState();
            }
            else {
                if(this._popstateHandler && this._stateHistoryTemps.length > 0){
                    this._stateHistoryTemps = [];
                    window.history.back();
                }
            }
        },

        _manageAppLayoutBannerPopup: function() {
            var openedPopupElement = this._openedPopupElement;
            if (openedPopupElement) {
                this.set('_previousShowMobileBackButton', this.showMobileBackButton);
                this.set('_previousPageLabel', this.mobilePageLabel);
                this.set('showMobileBackButton', true);
                this.set('mobilePageLabel', openedPopupElement.title);
            } else {
                this.set('mobilePageLabel', this._previousPageLabel);
                this.set('showMobileBackButton', this._previousShowMobileBackButton);
            }
        },

        /**
        * Handles closing the `triblock-popup`. Note: to prevent the popup from closing, 
        * set `manual-close` attribute in triblock-popup. 
        */
        managePopupBackBehavior: function(){
            if (this._openedPopupElement && !this._openedPopupElement.manualClose) {
                this._openedPopupElement.closePopup();

                if(this.smallScreenWidth && this._stateHistoryTemps.length > 0){
                    this._stateHistoryTemps = [];
                    window.history.back();
                }
            }
        },

        /**
          * Return true when `triblock-popup` is opened, and false when it is closed.
          */
        isPopupOpened: function(){
            return this._openedPopupElement ? true : false;
        },

        _stopBrowserBack: function(){
            if(this._openedPopupElement && this.smallScreenWidth){
                window.history.replaceState(this._currentState, "currentState", this._currentStateURL);
                this._openedPopupElement.closePopup();
            }
           
        },
    };

    TriBlockAppLayoutBannerPopupBehavior = [ TriBlockAppLayoutBannerBehavior, TriBlockAppLayoutBannerPopupBehaviorImpl, TriBlockViewResponsiveBehavior ];

</script><script>
	/**
	 * Implement `triblock-app-layout-banner-routing-behavior` on your main view element that that contains `triblock-app-layout`. This helps with configuration concerning the mobile page label and back button based on `triplat-routing` behaviors. Additional configuration is as follows: 
	 *
     * First, listen for `triplat-route`'s `route-active` event.
     * ```html
	 *	<triplat-route id="newRoute" name="new" path="/new" on-route-active="_handleNewRouteActive"></triplat-route>
     * ```
	 * 
     * Then, set up the custom event needed for the `manageBannerOnRouteChange` function where "New" and `true` values are defined by you.
     * ```javascript
     *   _handleNewRouteActive: function (e) {
     *      var routedPageBannerDetails = { active: e.detail.active, pageLabel: "New", hasBackButton: true };
     *      this.manageBannerOnRouteChange(routedPageBannerDetails);
     *   }
     * ```
	 * @polymerBehavior
	 */
    TriBlockAppLayoutBannerRoutingBehaviorImpl = {
        /**
        * Sets `showMobileBackButton` and `mobilePageLabel` properties based on custom event
        * 
		* @param {object} routedPageBannerDetails must have `active`, `hasBackButton` and `pageLabel` properties (see above documentation for more details)
        */
        manageBannerOnRouteChange: function(routedPageBannerDetails) {
            if (routedPageBannerDetails.active) {
				this.set('showMobileBackButton', routedPageBannerDetails.hasBackButton);
				this.set('mobilePageLabel', routedPageBannerDetails.pageLabel);
            }
        },

        /**
        * Navigates to the previous routed page in the browser's history
        */
		navigateToPreviousRoutedPage: function(e) {
            window.history.back();
		},
    };

    TriBlockAppLayoutBannerRoutingBehavior = [ TriBlockAppLayoutBannerBehavior, TriBlockAppLayoutBannerRoutingBehaviorImpl ];

</script><script>
	/**
	 * Implement `triblock-app-layout-banner-iron-pages-behavior` on your main view element that that contains `triblock-app-layout`. This helps with configuration concerning the mobile page label and back button based on `iron-pages` behaviors. 
	 * @polymerBehavior
	 */
    TriBlockAppLayoutBannerIronPagesBehaviorImpl = {
        /**
        * Sets `showMobileBackButton` and `mobilePageLabel` properties based on custom event
        * 
        * @param {object} ironPages The `iron-pages` component (The child components must have `hasBackButton` and `pageLabel` properties or attributes).
        */
        manageBannerOnIronPagesChange: function(ironPages) {
            if (ironPages.selectedItem) {
                var hasBackButton = ironPages.selectedItem.hasBackButton;
                hasBackButton = !hasBackButton ? ironPages.selectedItem.hasAttribute("has-back-button") : hasBackButton;
                var pageLabel = ironPages.selectedItem.pageLabel;
                pageLabel = !pageLabel ? ironPages.selectedItem.getAttribute("page-label") : pageLabel;

                this.set('showMobileBackButton', hasBackButton);
                this.set('mobilePageLabel', pageLabel);
            }
        },

        /**
        * Navigates to the previous iron pages
        * @param {object} ironPages The `iron-pages` component (The child components must have `hasBackButton` and `pageLabel` properties or attributes).
        */
		navigateToPreviousIronPages: function(ironPages) {
           if(ironPages){
                //Get the backTo of the selected item
                var backTo = ironPages.selectedItem.backTo;
                // For the component that doesn't have backTo property 
                backTo = !backTo ? ironPages.selectedItem.getAttribute("back-to") : backTo;
                if (backTo){
                    ironPages.selected = backTo;
                    this.manageBannerOnIronPagesChange(ironPages);
                }else {
                    this._handleNoPreviousPage();
                }
           }
		},

        _handleNoPreviousPage: function(){
            console.warn("_handleNoPreviousPage method should be implemented. The method allows applying the logic when there is no previous page.");
            return "";
        },

    };

    TriBlockAppLayoutBannerIronPagesBehavior = [ TriBlockAppLayoutBannerBehavior, TriBlockAppLayoutBannerIronPagesBehaviorImpl ];

</script><script>
	/**
	 * Implement `triblock-app-layout-banner-responsive-layout-behavior` on your main view element that that contains `triblock-app-layout`. This helps with configuration concerning the mobile page label and back button based on `triblock-responsive-layout` when `swtichView` and `smallScreenWidth` properties are true behaviors. 
     *
	 * @polymerBehavior
	 */
    TriBlockAppLayoutBannerResponsiveLayoutBehaviorImpl = {
        /**
        * Sets `showMobileBackButton` and `mobilePageLabel` properties based on custom event
        * 
        * @param {object} responsiveLayoutView The `triblock-responsive-layout` currentView component (The component must have `hasBackButton` and `pageLabel` properties or attributes).
        */
        manageBannerOnResponsiveLayoutChange: function(responsiveLayoutView) {
            if (responsiveLayoutView) {
                var hasBackButton = responsiveLayoutView.hasBackButton;
                hasBackButton = !hasBackButton ? responsiveLayoutView.hasAttribute("has-back-button") : hasBackButton;
                var pageLabel = responsiveLayoutView.pageLabel;
                pageLabel = !pageLabel ? responsiveLayoutView.getAttribute("page-label") : pageLabel;

                this.set('showMobileBackButton', hasBackButton);
                this.set('mobilePageLabel', pageLabel);
            }
        },

        /**
        * Navigates to the previous view
        * @param {object} responsiveLayoutView The `triblock-responsive-layout` currentView component (The component must have `hasBackButton` and `pageLabel` properties or attributes).
        */
		navigateToPreviousView: function(responsiveLayoutView) {
           if(responsiveLayoutView){
                //Get the backTo of the view
                var backTo = responsiveLayoutView.backTo;
                // For the component that doesn't have backTo property 
                backTo = !backTo ? responsiveLayoutView.getAttribute("back-to") : backTo;
                var responsiveLayout = responsiveLayoutView.parentNode;
                if (backTo){
                    responsiveLayout.switchToViewId(backTo);
                    this.manageBannerOnResponsiveLayoutChange(responsiveLayout.currentView);
                }else {
                    this._handleNoPreviousView();
                }
           }
		},

        /**
          * Switches to a view based on the given `index`.
          *
          * @param {Object} responsiveLayout The `triblock-responsive-layout` component.  
          * @param {Number} index The index of the child component to display. 
          *
          **/
        switchToViewIndex: function(responsiveLayout, index){
            if(responsiveLayout && index !== undefined){
                responsiveLayout.switchToViewIndex(index);
            }
        },

        /**
          * Switches to a view based on the given `id`.  
          * 
          * @param {Object} responsiveLayout The `triblock-responsive-layout` component.  
          * @param {string} viewId The `id` of the child component to display. 
          *
          **/
        switchToViewId: function(responsiveLayout, viewId){
            if(this.responsiveLayout && viewId){
                this.responsiveLayout.switchToViewId(viewId);
            }
        },

        _handleNoPreviousView: function(){
            console.warn("_handleNoPreviousView method should be implemented. The method allows applying the logic when there is no previous view.");
            return "";
        },
    };

    TriBlockAppLayoutBannerResponsiveLayoutBehavior = [ TriBlockAppLayoutBannerBehavior, TriBlockAppLayoutBannerResponsiveLayoutBehaviorImpl ];

</script>

<dom-module id="iron-pages" assetpath="../iron-pages/">

  <template>
    <style>
      :host {
        display: block;
      }

      :host > ::content > :not(.iron-selected) {
        display: none !important;
      }
    </style>

    <content></content>
  </template>

  <script>
    Polymer({

      is: 'iron-pages',

      behaviors: [
        Polymer.IronResizableBehavior,
        Polymer.IronSelectableBehavior
      ],

      properties: {

        // as the selected page is the only one visible, activateEvent
        // is both non-sensical and problematic; e.g. in cases where a user
        // handler attempts to change the page and the activateEvent
        // handler immediately changes it back
        activateEvent: {
          type: String,
          value: null
        }

      },

      observers: [
        '_selectedPageChanged(selected)'
      ],

      _selectedPageChanged: function(selected, old) {
        this.async(this.notifyResize);
      }
    });

  </script>
</dom-module>


<script>
  /**
   * `Polymer.PaperInkyFocusBehavior` implements a ripple when the element has keyboard focus.
   *
   * @polymerBehavior Polymer.PaperInkyFocusBehavior
   */
  Polymer.PaperInkyFocusBehaviorImpl = {
    observers: [
      '_focusedChanged(receivedFocusFromKeyboard)'
    ],

    _focusedChanged: function(receivedFocusFromKeyboard) {
      if (receivedFocusFromKeyboard) {
        this.ensureRipple();
      }
      if (this.hasRipple()) {
        this._ripple.holdDown = receivedFocusFromKeyboard;
      }
    },

    _createRipple: function() {
      var ripple = Polymer.PaperRippleBehavior._createRipple();
      ripple.id = 'ink';
      ripple.setAttribute('center', '');
      ripple.classList.add('circle');
      return ripple;
    }
  };

  /** @polymerBehavior Polymer.PaperInkyFocusBehavior */
  Polymer.PaperInkyFocusBehavior = [
    Polymer.IronButtonState,
    Polymer.IronControlState,
    Polymer.PaperRippleBehavior,
    Polymer.PaperInkyFocusBehaviorImpl
  ];
</script><dom-module id="paper-icon-button" assetpath="../paper-icon-button/">
  <template strip-whitespace="">
    <style>
      :host {
        display: inline-block;
        position: relative;
        padding: 8px;
        outline: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        cursor: pointer;
        z-index: 0;
        line-height: 1;

        width: 40px;
        height: 40px;

        /* NOTE: Both values are needed, since some phones require the value to be `transparent`. */
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        -webkit-tap-highlight-color: transparent;

        /* Because of polymer/2558, this style has lower specificity than * */
        box-sizing: border-box !important;

        @apply(--paper-icon-button);
      }

      :host #ink {
        color: var(--paper-icon-button-ink-color, --primary-text-color);
        opacity: 0.6;
      }

      :host([disabled]) {
        color: var(--paper-icon-button-disabled-text, --disabled-text-color);
        pointer-events: none;
        cursor: auto;

        @apply(--paper-icon-button-disabled);
      }

      :host(:hover) {
        @apply(--paper-icon-button-hover);
      }

      iron-icon {
        --iron-icon-width: 100%;
        --iron-icon-height: 100%;
      }
    </style>

    <iron-icon id="icon" src="[[src]]" icon="[[icon]]" alt$="[[alt]]"></iron-icon>
  </template>

  <script>
    Polymer({
      is: 'paper-icon-button',

      hostAttributes: {
        role: 'button',
        tabindex: '0'
      },

      behaviors: [
        Polymer.PaperInkyFocusBehavior
      ],

      properties: {
        /**
         * The URL of an image for the icon. If the src property is specified,
         * the icon property should not be.
         */
        src: {
          type: String
        },

        /**
         * Specifies the icon name or index in the set of icons available in
         * the icon's icon set. If the icon property is specified,
         * the src property should not be.
         */
        icon: {
          type: String
        },

        /**
         * Specifies the alternate text for the button, for accessibility.
         */
        alt: {
          type: String,
          observer: "_altChanged"
        }
      },

      _altChanged: function(newValue, oldValue) {
        var label = this.getAttribute('aria-label');

        // Don't stomp over a user-set aria-label.
        if (!label || oldValue == label) {
          this.setAttribute('aria-label', newValue);
        }
      }
    });
  </script>
</dom-module>




<dom-module id="iron-a11y-announcer" assetpath="../iron-a11y-announcer/">
  <template>
    <style>
      :host {
        display: inline-block;
        position: fixed;
        clip: rect(0px,0px,0px,0px);
      }
    </style>
    <div aria-live$="[[mode]]">[[_text]]</div>
  </template>

  <script>

    (function() {
      'use strict';

      Polymer.IronA11yAnnouncer = Polymer({
        is: 'iron-a11y-announcer',

        properties: {

          /**
           * The value of mode is used to set the `aria-live` attribute
           * for the element that will be announced. Valid values are: `off`,
           * `polite` and `assertive`.
           */
          mode: {
            type: String,
            value: 'polite'
          },

          _text: {
            type: String,
            value: ''
          }
        },

        created: function() {
          if (!Polymer.IronA11yAnnouncer.instance) {
            Polymer.IronA11yAnnouncer.instance = this;
          }

          document.body.addEventListener('iron-announce', this._onIronAnnounce.bind(this));
        },

        /**
         * Cause a text string to be announced by screen readers.
         *
         * @param {string} text The text that should be announced.
         */
        announce: function(text) {
          this._text = '';
          this.async(function() {
            this._text = text;
          }, 100);
        },

        _onIronAnnounce: function(event) {
          if (event.detail && event.detail.text) {
            this.announce(event.detail.text);
          }
        }
      });

      Polymer.IronA11yAnnouncer.instance = null;

      Polymer.IronA11yAnnouncer.requestAvailability = function() {
        if (!Polymer.IronA11yAnnouncer.instance) {
          Polymer.IronA11yAnnouncer.instance = document.createElement('iron-a11y-announcer');
        }

        document.body.appendChild(Polymer.IronA11yAnnouncer.instance);
      };
    })();

  </script>
</dom-module>
<dom-module id="paper-toast" assetpath="../paper-toast/">
  <template>
    <style>
      :host {
        display: block;
        position: fixed;
        background-color: var(--paper-toast-background-color, #323232);
        color: var(--paper-toast-color, #f1f1f1);
        min-height: 48px;
        min-width: 288px;
        padding: 16px 24px;
        box-sizing: border-box;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
        border-radius: 2px;
        margin: 12px;
        font-size: 14px;
        cursor: default;
        -webkit-transition: -webkit-transform 0.3s, opacity 0.3s;
        transition: transform 0.3s, opacity 0.3s;
        opacity: 0;
        -webkit-transform: translateY(100px);
        transform: translateY(100px);
        @apply(--paper-font-common-base);
      }

      :host(.capsule) {
        border-radius: 24px;
      }

      :host(.fit-bottom) {
        width: 100%;
        min-width: 0;
        border-radius: 0;
        margin: 0;
      }

      :host(.paper-toast-open) {
        opacity: 1;
        -webkit-transform: translateY(0px);
        transform: translateY(0px);
      }
    </style>

    <span id="label">{{text}}</span>
    <content></content>
  </template>

  <script>
    (function() {
      // Keeps track of the toast currently opened.
      var currentToast = null;

      Polymer({
        is: 'paper-toast',

        behaviors: [
          Polymer.IronOverlayBehavior
        ],

        properties: {
          /**
           * The element to fit `this` into.
           * Overridden from `Polymer.IronFitBehavior`.
           */
          fitInto: {
            type: Object,
            value: window,
            observer: '_onFitIntoChanged'
          },

          /**
           * The orientation against which to align the dropdown content
           * horizontally relative to `positionTarget`.
           * Overridden from `Polymer.IronFitBehavior`.
           */
          horizontalAlign: {
            type: String,
            value: 'left'
          },

          /**
           * The orientation against which to align the dropdown content
           * vertically relative to `positionTarget`.
           * Overridden from `Polymer.IronFitBehavior`.
           */
          verticalAlign: {
            type: String,
            value: 'bottom'
          },

          /**
           * The duration in milliseconds to show the toast.
           * Set to `0`, a negative number, or `Infinity`, to disable the
           * toast auto-closing.
           */
          duration: {
            type: Number,
            value: 3000
          },

          /**
           * The text to display in the toast.
           */
          text: {
            type: String,
            value: ''
          },

          /**
           * Overridden from `IronOverlayBehavior`.
           * Set to false to enable closing of the toast by clicking outside it.
           */
          noCancelOnOutsideClick: {
            type: Boolean,
            value: true
          },

          /**
           * Overridden from `IronOverlayBehavior`.
           * Set to true to disable auto-focusing the toast or child nodes with
           * the `autofocus` attribute` when the overlay is opened.
           */
          noAutoFocus: {
            type: Boolean,
            value: true
          }
        },

        listeners: {
          'transitionend': '__onTransitionEnd'
        },

        /**
         * Read-only. Deprecated. Use `opened` from `IronOverlayBehavior`.
         * @property visible
         * @deprecated
         */
        get visible() {
          Polymer.Base._warn('`visible` is deprecated, use `opened` instead');
          return this.opened;
        },

        /**
         * Read-only. Can auto-close if duration is a positive finite number.
         * @property _canAutoClose
         */
        get _canAutoClose() {
          return this.duration > 0 && this.duration !== Infinity;
        },

        created: function() {
          this._autoClose = null;
          Polymer.IronA11yAnnouncer.requestAvailability();
        },

        /**
         * Show the toast. Without arguments, this is the same as `open()` from `IronOverlayBehavior`.
         * @param {(Object|string)=} properties Properties to be set before opening the toast.
         * e.g. `toast.show('hello')` or `toast.show({text: 'hello', duration: 3000})`
         */
        show: function(properties) {
          if (typeof properties == 'string') {
            properties = { text: properties };
          }
          for (var property in properties) {
            if (property.indexOf('_') === 0) {
              Polymer.Base._warn('The property "' + property + '" is private and was not set.');
            } else if (property in this) {
              this[property] = properties[property];
            } else {
              Polymer.Base._warn('The property "' + property + '" is not valid.');
            }
          }
          this.open();
        },

        /**
         * Hide the toast. Same as `close()` from `IronOverlayBehavior`.
         */
        hide: function() {
          this.close();
        },

        /**
         * Called on transitions of the toast, indicating a finished animation
         * @private
         */
        __onTransitionEnd: function(e) {
          // there are different transitions that are happening when opening and
          // closing the toast. The last one so far is for `opacity`.
          // This marks the end of the transition, so we check for this to determine if this
          // is the correct event.
          if (e && e.target === this && e.propertyName === 'opacity') {
            if (this.opened) {
              this._finishRenderOpened();
            } else {
              this._finishRenderClosed();
            }
          }
        },

        /**
         * Overridden from `IronOverlayBehavior`.
         * Called when the value of `opened` changes.
         */
        _openedChanged: function() {
          if (this._autoClose !== null) {
            this.cancelAsync(this._autoClose);
            this._autoClose = null;
          }
          if (this.opened) {
            if (currentToast && currentToast !== this) {
              currentToast.close();
            }
            currentToast = this;
            this.fire('iron-announce', {
              text: this.text
            });
            if (this._canAutoClose) {
              this._autoClose = this.async(this.close, this.duration);
            }
          } else if (currentToast === this) {
            currentToast = null;
          }
          Polymer.IronOverlayBehaviorImpl._openedChanged.apply(this, arguments);
        },

        /**
         * Overridden from `IronOverlayBehavior`.
         */
        _renderOpened: function() {
          this.classList.add('paper-toast-open');
        },

        /**
         * Overridden from `IronOverlayBehavior`.
         */
        _renderClosed: function() {
          this.classList.remove('paper-toast-open');
        },

        /**
         * @private
         */
        _onFitIntoChanged: function(fitInto) {
          this.positionTarget = fitInto;
        }

        /**
         * Fired when `paper-toast` is opened.
         *
         * @event 'iron-announce'
         * @param {{text: string}} detail Contains text that will be announced.
         */
      });
    })();
  </script>
</dom-module>


<script>

  /** @polymerBehavior */
  Polymer.PaperSpinnerBehavior = {

    listeners: {
      'animationend': '__reset',
      'webkitAnimationEnd': '__reset'
    },

    properties: {
      /**
       * Displays the spinner.
       */
      active: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
        observer: '__activeChanged'
      },

      /**
       * Alternative text content for accessibility support.
       * If alt is present, it will add an aria-label whose content matches alt when active.
       * If alt is not present, it will default to 'loading' as the alt value.
       */
      alt: {
        type: String,
        value: 'loading',
        observer: '__altChanged'
      },

      __coolingDown: {
        type: Boolean,
        value: false
      }
    },

    __computeContainerClasses: function(active, coolingDown) {
      return [
        active || coolingDown ? 'active' : '',
        coolingDown ? 'cooldown' : ''
      ].join(' ');
    },

    __activeChanged: function(active, old) {
      this.__setAriaHidden(!active);
      this.__coolingDown = !active && old;
    },

    __altChanged: function(alt) {
      // user-provided `aria-label` takes precedence over prototype default
      if (alt === this.getPropertyInfo('alt').value) {
        this.alt = this.getAttribute('aria-label') || alt;
      } else {
        this.__setAriaHidden(alt==='');
        this.setAttribute('aria-label', alt);
      }
    },

    __setAriaHidden: function(hidden) {
      var attr = 'aria-hidden';
      if (hidden) {
        this.setAttribute(attr, 'true');
      } else {
        this.removeAttribute(attr);
      }
    },

    __reset: function() {
      this.active = false;
      this.__coolingDown = false;
    }
  };
</script><dom-module id="paper-spinner-styles" assetpath="../paper-spinner/">
  <template>
    <style>
      /*
      /**************************/
      /* STYLES FOR THE SPINNER */
      /**************************/

      /*
       * Constants:
       *      ARCSIZE     = 270 degrees (amount of circle the arc takes up)
       *      ARCTIME     = 1333ms (time it takes to expand and contract arc)
       *      ARCSTARTROT = 216 degrees (how much the start location of the arc
       *                                should rotate each time, 216 gives us a
       *                                5 pointed star shape (it's 360/5 * 3).
       *                                For a 7 pointed star, we might do
       *                                360/7 * 3 = 154.286)
       *      SHRINK_TIME = 400ms
       */

      :host {
        display: inline-block;
        position: relative;
        width: 28px;
        height: 28px;

        /* 360 * ARCTIME / (ARCSTARTROT + (360-ARCSIZE)) */
        --paper-spinner-container-rotation-duration: 1568ms;

        /* ARCTIME */
        --paper-spinner-expand-contract-duration: 1333ms;

        /* 4 * ARCTIME */
        --paper-spinner-full-cycle-duration: 5332ms;

        /* SHRINK_TIME */
        --paper-spinner-cooldown-duration: 400ms;
      }

      #spinnerContainer {
        width: 100%;
        height: 100%;

        /* The spinner does not have any contents that would have to be
         * flipped if the direction changes. Always use ltr so that the
         * style works out correctly in both cases. */
        direction: ltr;
      }

      #spinnerContainer.active {
        -webkit-animation: container-rotate var(--paper-spinner-container-rotation-duration) linear infinite;
        animation: container-rotate var(--paper-spinner-container-rotation-duration) linear infinite;
      }

      @-webkit-keyframes container-rotate {
        to { -webkit-transform: rotate(360deg) }
      }

      @keyframes container-rotate {
        to { transform: rotate(360deg) }
      }

      .spinner-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        white-space: nowrap;
        border-color: var(--paper-spinner-color, --google-blue-500);
      }

      .layer-1 {
        border-color: var(--paper-spinner-layer-1-color, --google-blue-500);
      }

      .layer-2 {
        border-color: var(--paper-spinner-layer-2-color, --google-red-500);
      }

      .layer-3 {
        border-color: var(--paper-spinner-layer-3-color, --google-yellow-500);
      }

      .layer-4 {
        border-color: var(--paper-spinner-layer-4-color, --google-green-500);
      }

      /**
       * IMPORTANT NOTE ABOUT CSS ANIMATION PROPERTIES (keanulee):
       *
       * iOS Safari (tested on iOS 8.1) does not handle animation-delay very well - it doesn't
       * guarantee that the animation will start _exactly_ after that value. So we avoid using
       * animation-delay and instead set custom keyframes for each color (as layer-2undant as it
       * seems).
       */
      .active .spinner-layer {
        -webkit-animation-name: fill-unfill-rotate;
        -webkit-animation-duration: var(--paper-spinner-full-cycle-duration);
        -webkit-animation-timing-function: cubic-bezier(0.4, 0.0, 0.2, 1);
        -webkit-animation-iteration-count: infinite;
        animation-name: fill-unfill-rotate;
        animation-duration: var(--paper-spinner-full-cycle-duration);
        animation-timing-function: cubic-bezier(0.4, 0.0, 0.2, 1);
        animation-iteration-count: infinite;
        opacity: 1;
      }

      .active .spinner-layer.layer-1 {
        -webkit-animation-name: fill-unfill-rotate, layer-1-fade-in-out;
        animation-name: fill-unfill-rotate, layer-1-fade-in-out;
      }

      .active .spinner-layer.layer-2 {
        -webkit-animation-name: fill-unfill-rotate, layer-2-fade-in-out;
        animation-name: fill-unfill-rotate, layer-2-fade-in-out;
      }

      .active .spinner-layer.layer-3 {
        -webkit-animation-name: fill-unfill-rotate, layer-3-fade-in-out;
        animation-name: fill-unfill-rotate, layer-3-fade-in-out;
      }

      .active .spinner-layer.layer-4 {
        -webkit-animation-name: fill-unfill-rotate, layer-4-fade-in-out;
        animation-name: fill-unfill-rotate, layer-4-fade-in-out;
      }

      @-webkit-keyframes fill-unfill-rotate {
        12.5% { -webkit-transform: rotate(135deg) } /* 0.5 * ARCSIZE */
        25%   { -webkit-transform: rotate(270deg) } /* 1   * ARCSIZE */
        37.5% { -webkit-transform: rotate(405deg) } /* 1.5 * ARCSIZE */
        50%   { -webkit-transform: rotate(540deg) } /* 2   * ARCSIZE */
        62.5% { -webkit-transform: rotate(675deg) } /* 2.5 * ARCSIZE */
        75%   { -webkit-transform: rotate(810deg) } /* 3   * ARCSIZE */
        87.5% { -webkit-transform: rotate(945deg) } /* 3.5 * ARCSIZE */
        to    { -webkit-transform: rotate(1080deg) } /* 4   * ARCSIZE */
      }

      @keyframes fill-unfill-rotate {
        12.5% { transform: rotate(135deg) } /* 0.5 * ARCSIZE */
        25%   { transform: rotate(270deg) } /* 1   * ARCSIZE */
        37.5% { transform: rotate(405deg) } /* 1.5 * ARCSIZE */
        50%   { transform: rotate(540deg) } /* 2   * ARCSIZE */
        62.5% { transform: rotate(675deg) } /* 2.5 * ARCSIZE */
        75%   { transform: rotate(810deg) } /* 3   * ARCSIZE */
        87.5% { transform: rotate(945deg) } /* 3.5 * ARCSIZE */
        to    { transform: rotate(1080deg) } /* 4   * ARCSIZE */
      }

      @-webkit-keyframes layer-1-fade-in-out {
        0% { opacity: 1 }
        25% { opacity: 1 }
        26% { opacity: 0 }
        89% { opacity: 0 }
        90% { opacity: 1 }
        to { opacity: 1 }
      }

      @keyframes layer-1-fade-in-out {
        0% { opacity: 1 }
        25% { opacity: 1 }
        26% { opacity: 0 }
        89% { opacity: 0 }
        90% { opacity: 1 }
        to { opacity: 1 }
      }

      @-webkit-keyframes layer-2-fade-in-out {
        0% { opacity: 0 }
        15% { opacity: 0 }
        25% { opacity: 1 }
        50% { opacity: 1 }
        51% { opacity: 0 }
        to { opacity: 0 }
      }

      @keyframes layer-2-fade-in-out {
        0% { opacity: 0 }
        15% { opacity: 0 }
        25% { opacity: 1 }
        50% { opacity: 1 }
        51% { opacity: 0 }
        to { opacity: 0 }
      }

      @-webkit-keyframes layer-3-fade-in-out {
        0% { opacity: 0 }
        40% { opacity: 0 }
        50% { opacity: 1 }
        75% { opacity: 1 }
        76% { opacity: 0 }
        to { opacity: 0 }
      }

      @keyframes layer-3-fade-in-out {
        0% { opacity: 0 }
        40% { opacity: 0 }
        50% { opacity: 1 }
        75% { opacity: 1 }
        76% { opacity: 0 }
        to { opacity: 0 }
      }

      @-webkit-keyframes layer-4-fade-in-out {
        0% { opacity: 0 }
        65% { opacity: 0 }
        75% { opacity: 1 }
        90% { opacity: 1 }
        to { opacity: 0 }
      }

      @keyframes layer-4-fade-in-out {
        0% { opacity: 0 }
        65% { opacity: 0 }
        75% { opacity: 1 }
        90% { opacity: 1 }
        to { opacity: 0 }
      }

      .circle-clipper {
        display: inline-block;
        position: relative;
        width: 50%;
        height: 100%;
        overflow: hidden;
        border-color: inherit;
      }

      /**
       * Patch the gap that appear between the two adjacent div.circle-clipper while the
       * spinner is rotating (appears on Chrome 50, Safari 9.1.1, and Edge).
       */
      .spinner-layer::after {
        left: 45%;
        width: 10%;
        border-top-style: solid;
      }

      .spinner-layer::after,
      .circle-clipper::after {
        content: '';
        box-sizing: border-box;
        position: absolute;
        top: 0;
        border-width: var(--paper-spinner-stroke-width, 3px);
        border-color: inherit;
        border-radius: 50%;
      }

      .circle-clipper::after {
        bottom: 0;
        width: 200%;
        border-style: solid;
        border-bottom-color: transparent !important;
      }

      .circle-clipper.left::after {
        left: 0;
        border-right-color: transparent !important;
        -webkit-transform: rotate(129deg);
        transform: rotate(129deg);
      }

      .circle-clipper.right::after {
        left: -100%;
        border-left-color: transparent !important;
        -webkit-transform: rotate(-129deg);
        transform: rotate(-129deg);
      }

      .active .gap-patch::after,
      .active .circle-clipper::after {
        -webkit-animation-duration: var(--paper-spinner-expand-contract-duration);
        -webkit-animation-timing-function: cubic-bezier(0.4, 0.0, 0.2, 1);
        -webkit-animation-iteration-count: infinite;
        animation-duration: var(--paper-spinner-expand-contract-duration);
        animation-timing-function: cubic-bezier(0.4, 0.0, 0.2, 1);
        animation-iteration-count: infinite;
      }

      .active .circle-clipper.left::after {
        -webkit-animation-name: left-spin;
        animation-name: left-spin;
      }

      .active .circle-clipper.right::after {
        -webkit-animation-name: right-spin;
        animation-name: right-spin;
      }

      @-webkit-keyframes left-spin {
        0% { -webkit-transform: rotate(130deg) }
        50% { -webkit-transform: rotate(-5deg) }
        to { -webkit-transform: rotate(130deg) }
      }

      @keyframes left-spin {
        0% { transform: rotate(130deg) }
        50% { transform: rotate(-5deg) }
        to { transform: rotate(130deg) }
      }

      @-webkit-keyframes right-spin {
        0% { -webkit-transform: rotate(-130deg) }
        50% { -webkit-transform: rotate(5deg) }
        to { -webkit-transform: rotate(-130deg) }
      }

      @keyframes right-spin {
        0% { transform: rotate(-130deg) }
        50% { transform: rotate(5deg) }
        to { transform: rotate(-130deg) }
      }

      #spinnerContainer.cooldown {
        -webkit-animation: container-rotate var(--paper-spinner-container-rotation-duration) linear infinite, fade-out var(--paper-spinner-cooldown-duration) cubic-bezier(0.4, 0.0, 0.2, 1);
        animation: container-rotate var(--paper-spinner-container-rotation-duration) linear infinite, fade-out var(--paper-spinner-cooldown-duration) cubic-bezier(0.4, 0.0, 0.2, 1);
      }

      @-webkit-keyframes fade-out {
        0% { opacity: 1 }
        to { opacity: 0 }
      }

      @keyframes fade-out {
        0% { opacity: 1 }
        to { opacity: 0 }
      }
    </style>
  </template>
</dom-module>
<dom-module id="paper-spinner" assetpath="../paper-spinner/">
  <template strip-whitespace="">
    <style include="paper-spinner-styles"></style>

    <div id="spinnerContainer" class-name="[[__computeContainerClasses(active, __coolingDown)]]">
      <div class="spinner-layer layer-1">
        <div class="circle-clipper left"></div>
        <div class="circle-clipper right"></div>
      </div>

      <div class="spinner-layer layer-2">
        <div class="circle-clipper left"></div>
        <div class="circle-clipper right"></div>
      </div>

      <div class="spinner-layer layer-3">
        <div class="circle-clipper left"></div>
        <div class="circle-clipper right"></div>
      </div>

      <div class="spinner-layer layer-4">
        <div class="circle-clipper left"></div>
        <div class="circle-clipper right"></div>
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'paper-spinner',

      behaviors: [
        Polymer.PaperSpinnerBehavior
      ]
    });
  </script>
</dom-module>

<dom-module id="triplat-debug" assetpath="../triplat-debug/"><template></template></dom-module>
<script>
	Polymer({

		is: "triplat-debug",

		properties: {

			/**
			 * Optional. 
			 * This message will be printed to the console
			 * when the value changes.
			 */
			message: {
				type: String,
				notify: false,
				readOnly: false
			},

			/**
			 * When this value changes, it will output it to
			 * the console.
			 */
			value: {
				type: Object,
				notify: false,
				readOnly: false
			}

		},

		observers: [
			"_handleValueChange(value.*)"
		],

		_handleValueChange: function(value) {
			if (this.message) {
				console.log(this.message);
			}
			console.log(this.value);
		}

	});
</script><script src="../jsTimezoneDetect/jstz.min.js"></script><script src="../moment/moment.js"></script><script src="../moment-timezone/builds/moment-timezone-with-data-2010-2020.js"></script><script src="../moment-jdateformatparser/moment-jdateformatparser.min.js"></script><script src="../moment/min/locales.min.js"></script><script>

/**
TriDateUtilities is a date utility component that allows user to convert and get date/datetime in ISO date string format.

@demo demo/index.html
@polymerBehavior
*/
TriDateUtilities = {

    _getCurrentDateString: function(){
        return this._getDateString(new Date());
    },

    _getCurrentDatetimeString: function(){
        return this._getDateTimeString(new Date());
    },

     /**
        * Returns date string.<br/>
        * @param {Object} date The JavaScript Date Object.
        */
    _getDateString: function(date){
        if(this._isDateObject(date)){
            return moment(date).format("YYYY-MM-DD");
        }
    },

    /**
        * Returns datetime string.<br/>
        * @param {Object} date The JavaScript Date Object.
        */
    _getDateTimeString: function(date){
        if(this._isDateObject(date)){
            return moment(date).format("YYYY-MM-DDTHH:mm:ss"); 
        }
    },

    /**
        * Returns current date in ISO date string.<br/>
        * @param {String} timeZone The string representation of the time zone (e.g. US/Eastern).
        * Notice: if no time zone parameter is passed in, the method will return the current date that is based on browser time zone.
        */
    getCurrentDate: function(timeZone){
        var dateString = this._getCurrentDateString();
        if(timeZone){
            return moment.tz(dateString, timeZone).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
        }else{
            return moment(dateString).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
        }
    },
    /**
        * Returns current datetime in ISO date string.<br/>
        * @param {String} timeZone The string representation of the time zone (e.g. US/Eastern).
        * Notice: if no time zone parameter is passed in, the method will return the current datetime that is based on browser time zone.
        */
    getCurrentDatetime: function(timeZone){
        var datetimeString = this._getCurrentDatetimeString();
        if(timeZone){
            return moment.tz(timeZone).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
        }else{
            return moment(datetimeString).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
        }
    },
    /**
        * Converts to a given time zone by keeping the exact datetime in ISO date string format.<br/>
        * Returns ISO date string.
        * @param {String} isoString The string representation of the ISO date string (e.g. 1970-01-15T22:19:41.000-08:00).
        * @param {String} timeZone The string representation of the time zone (e.g. Canada/Eastern).
        */
    normalizeToTimezone: function(isoString, timeZone){
        if(isoString){
            if(this._isIsoDateStringFormat(isoString)){
                var datetimeString = isoString.substring(0, "YYYY-MM-DDTHH:mm:ss.SSS".length);
                if(timeZone){
                    return moment.tz(datetimeString, timeZone).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
                }else{
                    console.error("Missing timeZone parameter");
                    return;
                }
            }
            console.error("Incorrect ISO date string format");
            return;
        }
        console.error("Missing ISO date string parameter");
        return;
    },

    /**
        * Converts unix timestamp (seconds) to ISO date string.<br/>
        * Return ISO date string.
        * @param {Number} milliseconds The integer representation of the unix timestamp (seconds) (e.g. 1415467435).
        */
    toDateIsoString: function(milliseconds){
        if(typeof milliseconds === 'number'){ 
            // milliseconds = moment(milliseconds).unix();
            // return moment.unix(milliseconds).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
            return moment(milliseconds).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
        }
        console.error("Incorrect milliseconds parameter format");
        return;
    },

    /**
        * Converts ISO date/datetime string to unix timestamp (seconds).<br/>
        * Return unix timestamp (seconds).
        * @param {String} isoString The string representation of the ISO date string (e.g. 2010-01-20T22:00:10.000-08:00).
        */
    toMilliseconds: function(isoString){
        if(isoString){
            //since the time zone offset display in 6 chars (e.g -08:00)
            if(this._isIsoDateStringFormat(isoString)){
                return moment(isoString).valueOf();
            }
            console.error("Incorrect ISO date string format");
            return;
        }
        console.error("Missing ISO date string parameter or incorrect ISO date string");
        return;  
    },

    /**
        * Get client time zone from browser.<br/>
        * Return string (e.g. US/Pacific).
        */
    getBrowserTimeZone: function(){
       return jstz.determine().name(); 
    },
	
    /**
     * Formats the ISO date string to a given time zone and a user date format.<br/>
     * @param {String} isoString The string representation of the ISO date string (e.g. 1970-01-15T22:19:41.000-08:00).
     * @param {String} timeZone The string representation of the time zone (e.g. Canada/Eastern).
     * @param {String} format The user date format as set in the user's profile.
     * @param {Strinh} userLanguageCode The code of the language set in the user's profile.(en-US) 
     */
 	formatDateWithTimeZone: function(isoString, timeZone, userFormat, userLanguageCode) {
 		if(isoString != null && this._isIsoDateStringFormat(isoString)) {
			var fixedFormat = this._convertToFixedMomentTzFormat(userFormat);
			var mDatetime = moment(isoString);
			if (timeZone != null) {
				mDatetime = mDatetime.tz(timeZone);	
			}
			if (userLanguageCode != null) {
				mDatetime = mDatetime.locale(userLanguageCode);
			}
			return mDatetime.formatWithJDF(fixedFormat);
 		}
 	},
    
    /**
        * To check if a string is a ISO date string format.
        * @param {String} isoString The string representation of the ISO date string (e.g. 2010-01-20T22:00:10.000-08:00).
        */
    _isIsoDateStringFormat: function(isoString){
        if(isoString){
            if((isoString.indexOf("T") > -1) && (isoString.length === moment().format("YYYY-MM-DDTHH:mm:ss.SSSZ").length || isoString.length === "YYYY-MM-DDTHH:mm:ss.SSSZ".length)){
                return true;
            }
            return false;
        }
        return false;
    }, 

    /**
        * To check if the object is a JavaScript date object.
        * @param {Object} dateObj The JavaScript Date Object.
        */
    _isDateObject: function(dateObj){
        if({}.toString.call(dateObj)==="[object Date]"){
            if(isNaN(dateObj)){
                return false;
            }else{
                return true;
            }
        }
        return false;
    },

    /**
        * Converts the ISO date string to a given time zone.<br/>
        * Returns ISO date string.
        * @param {String} isoString The string representation of the ISO date string (e.g. 1970-01-15T22:19:41.000-08:00).
        * @param {String} timeZone The string representation of the time zone (e.g. Canada/Eastern).
        * @param {String} format The format of the return string (e.g. YYYY-MM-DDTHH:mm:ss).
        * Notice: The return format is in the ISO date string (YYYY-MM-DDTHH:mm:ss.SSSZ) if no specified format is passed.
        */
    _toTimeZone: function(isoString, timeZone, format){
         if(isoString){
            if(this._isIsoDateStringFormat(isoString)){
                if(timeZone){
                    var toMilliseconds = this.toMilliseconds(isoString);     
                    if(format){
                        return moment(toMilliseconds).tz(timeZone).format(format);
                    }             
                    return moment(toDateObj).tz(timeZone).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
                }else{
                    console.error("Missing timeZone parameter");
                    return;
                }
                console.error("Incorrect ISO date string format");
                return;
            }
        }
    },

    /**
        * Converts the ISO date string to a JavaScript Date Object.<br/>
        * Return JavaScript Date Object.
        * @param {String} isoString The string representation of the ISO date string (e.g. 2010-01-20T22:00:10.000-08:00).
        */
    _toDateObject: function(isoString){
        var toDateObj = new Date(this.toMilliseconds(isoString));   
        return toDateObj;
    },
    
    _convertToFixedMomentTzFormat: function(format){
        format = format || "MM/DD/YYYY hh:mm a";
        if (format.replace(/[^z]/g, "").length===1){
            format = format.replace("z", "zz")
        } 

        else if (format.replace(/[^z]/g, "").length===3){
            format = format.replace("zzz", "zz")
        }
        else if (format.replace(/[^z]/g, "").length===4){
            format = format.replace("zzzz", "zz")
        }

        if(format.replace(/[^M]/g,"").length===5){
            format = format.replace("MMMMM", "MMMM");
        }

        var end = false;
        var fixedFormat = format.replace(/\'/g, function(match) {
          return (end = !end) ? '[' : ']';    
        });
        return fixedFormat;
    }    
}
</script>
<dom-module id="triplat-signout-button" assetpath="../triplat-signout-button/">
    <style>
		.rtl-icon-mirror {
			transform: scaleX(-1);
		}
    </style>
	<template>
		<triplat-signout id="signout"></triplat-signout>
		<paper-icon-button id="signoutIcon" icon="ibm:sign-out" on-tap="_handleTap" alt="signout" on-keypress="_keyPressHandler"></paper-icon-button>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-signout-button",

		attached: function() {
			var textDirectionValue = document.querySelector('body').getAttribute('dir');
			if(textDirectionValue==="rtl"){
				this.$.signoutIcon.classList.add('rtl-icon-mirror');
			}
		},

		_handleTap: function() {
			this.$.signout.signout();
		},
		
		_keyPressHandler: function(event) {
			var keyCode = event.keyCode;
			// accept Enter or Spacebar
			if (code == 13 || code == 32) {
				this._handlerTap();
			}
		}

	});
</script>


<script>

  /**
   * `Polymer.IronMenubarBehavior` implements accessible menubar behavior.
   *
   * @polymerBehavior Polymer.IronMenubarBehavior
   */
  Polymer.IronMenubarBehaviorImpl = {

    hostAttributes: {
      'role': 'menubar'
    },

    keyBindings: {
      'left': '_onLeftKey',
      'right': '_onRightKey'
    },

    _onUpKey: function(event) {
      this.focusedItem.click();
      event.detail.keyboardEvent.preventDefault();
    },

    _onDownKey: function(event) {
      this.focusedItem.click();
      event.detail.keyboardEvent.preventDefault();
    },

    get _isRTL() {
      return window.getComputedStyle(this)['direction'] === 'rtl';
    },

    _onLeftKey: function(event) {
      if (this._isRTL) {
        this._focusNext();
      } else {
        this._focusPrevious();
      }
      event.detail.keyboardEvent.preventDefault();
    },

    _onRightKey: function(event) {
      if (this._isRTL) {
        this._focusPrevious();
      } else {
        this._focusNext();
      }
      event.detail.keyboardEvent.preventDefault();
    },

    _onKeydown: function(event) {
      if (this.keyboardEventMatchesKeys(event, 'up down left right esc')) {
        return;
      }

      // all other keys focus the menu item starting with that character
      this._focusWithKeyboardEvent(event);
    }

  };

  /** @polymerBehavior Polymer.IronMenubarBehavior */
  Polymer.IronMenubarBehavior = [
    Polymer.IronMenuBehavior,
    Polymer.IronMenubarBehaviorImpl
  ];

</script><script>

/**
`iron-a11y-keys` provides a cross-browser interface for processing
keyboard commands. The interface adheres to [WAI-ARIA best
practices](http://www.w3.org/TR/wai-aria-practices/#kbd_general_binding).
It uses an expressive syntax to filter key presses.

## Basic usage

The sample code below is a portion of a custom element. The goal is to call
the `onEnter` method whenever the `paper-input` element is in focus and
the `Enter` key is pressed.

    <iron-a11y-keys id="a11y" target="[[target]]" keys="enter"
                        on-keys-pressed="onEnter"></iron-a11y-keys>
    <paper-input id="input"
                 placeholder="Type something. Press enter. Check console."
                 value="{{userInput::input}}"></paper-input>

The custom element declares an `iron-a11y-keys` element that is bound to a
property called `target`. The `target` property
needs to evaluate to the `paper-input` node. `iron-a11y-keys` registers
an event handler for the target node using Polymer's [annotated event handler
syntax](https://www.polymer-project.org/1.0/docs/devguide/events.html#annotated-listeners). `{{userInput::input}}` sets the `userInput` property to the
user's input on each keystroke.

The last step is to link the two elements within the custom element's
registration.

    ...
    properties: {
      userInput: {
        type: String,
        notify: true,
      },
      target: {
        type: Object,
        value: function() {
          return this.$.input;
        }
      },
    },
    onEnter: function() {
      console.log(this.userInput);
    }
    ...

## The `keys` attribute

The `keys` attribute expresses what combination of keys triggers the event.

The attribute accepts a space-separated, plus-sign-concatenated
set of modifier keys and some common keyboard keys.

The common keys are: `a-z`, `0-9` (top row and number pad), `*` (shift 8 and
number pad), `F1-F12`, `Page Up`, `Page Down`, `Left Arrow`, `Right Arrow`,
`Down Arrow`, `Up Arrow`, `Home`, `End`, `Escape`, `Space`, `Tab`, `Enter`.

The modifier keys are: `Shift`, `Control`, `Alt`, `Meta`.

All keys are expected to be lowercase and shortened. E.g.
`Left Arrow` is `left`, `Page Down` is `pagedown`, `Control` is `ctrl`,
`F1` is `f1`, `Escape` is `esc`, etc.

### Grammar

Below is the [EBNF](http://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_Form)
Grammar of the `keys` attribute.

    modifier = "shift" | "ctrl" | "alt" | "meta";
    ascii = ? /[a-z0-9]/ ? ;
    fnkey = ? f1 through f12 ? ;
    arrow = "up" | "down" | "left" | "right" ;
    key = "tab" | "esc" | "space" | "*" | "pageup" | "pagedown" |
          "home" | "end" | arrow | ascii | fnkey;
    keycombo = { modifier, "+" }, key ;
    keys = keycombo, { " ", keycombo } ;

### Example

Given the following value for `keys`:

`ctrl+shift+f7 up pagedown esc space alt+m`

The event is fired if any of the following key combinations are fired:
`Control` and `Shift` and `F7` keys, `Up Arrow` key, `Page Down` key,
`Escape` key, `Space` key, `Alt` and `M` keys.

### WAI-ARIA Slider Example

The following is an example of the set of keys that fulfills WAI-ARIA's
"slider" role [best
practices](http://www.w3.org/TR/wai-aria-practices/#slider):

    <iron-a11y-keys target="[[target]]" keys="left pagedown down"
                    on-keys-pressed="decrement"></iron-a11y-keys>
    <iron-a11y-keys target="[[target]]" keys="right pageup up"
                    on-keys-pressed="increment"></iron-a11y-keys>
    <iron-a11y-keys target="[[target]]" keys="home"
                    on-keys-pressed="setMin"></iron-a11y-keys>
    <iron-a11y-keys target=""[[target]] keys="end"
                    on-keys-pressed="setMax"></iron-a11y-keys>

The `target` properties must evaluate to a node. See the basic usage
example above.

Each of the values for the `on-keys-pressed` attributes must evalute
to methods. The `increment` method should move the slider a set amount
toward the maximum value. `decrement` should move the slider a set amount
toward the minimum value. `setMin` should move the slider to the minimum
value. `setMax` should move the slider to the maximum value.

@demo demo/index.html
*/



  Polymer({
    is: 'iron-a11y-keys',

    behaviors: [
      Polymer.IronA11yKeysBehavior
    ],

    properties: {
      /** @type {?Node} */
      target: {
        type: Object,
        observer: '_targetChanged'
      },

      keys: {
        type: String,
        reflectToAttribute: true,
        observer: '_keysChanged'
      }
    },

    attached: function() {
      if (!this.target) {
        this.target = this.parentNode;
      }
    },

    _targetChanged: function(target) {
      this.keyEventTarget = target;
    },

    _keysChanged: function() {
      this.removeOwnKeyBindings();
      this.addOwnKeyBinding(this.keys, '_fireKeysPressed');
    },

    _fireKeysPressed: function(event) {
      this.fire('keys-pressed', event.detail, {});
    }
  });
</script><dom-module id="triblock-scroll-container" assetpath="../triblock-scroll-container/">
  <template>
    <style>
      :host {
        @apply(--layout);
        @apply(--layout-center);
        position: relative;
        height: var(--triblock-scroll-container-height, 250px);
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        /* NOTE: Both values are needed, since some phones require the value to be `transparent`. */
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        -webkit-tap-highlight-color: transparent;
      }

      :host,
      :host *,
      :host ::content * {
        box-sizing: border-box;
      }

      #itemsContainer {
        @apply(--layout-flex-auto);
        position: relative;
        height: 100%;
        overflow: hidden;
      }

      #itemsContent {
        @apply(--layout-horizontal);
        position: absolute;
        min-width: 100%;
        -moz-flex-basis: auto;
        -ms-flex-basis: auto;
        flex-basis: auto;
      }
      #itemsContent > ::content > * {
        /* IE - prevent items from compressing when they should scroll. */
        -ms-flex: 1 0 auto;
        -webkit-flex: 1 0 auto;
        flex: 1 0 auto;
      }

      .not-available {
        opacity: 0;
        cursor: default;
      }

      .left {
        left: var(--triblock-scroll-container-left-arrow, 1%);
      }

      .right {
        right: var(--triblock-scroll-container-right-arrow, 1%);
      }

      paper-icon-button {
        @apply(--shadow-elevation-4dp);
        position: absolute;
        top: var(--triblock-scroll-container-button-top, 50%);
        transform: translateY(-50%);
        z-index: 1;
        height: var(--triblock-scroll-container-button-height, 48px);
        width: var(--triblock-scroll-container-button-width, 48px);
        margin: 0 4px;
        border-radius: 100%;
        padding: var(--triblock-scroll-container-button-padding, 2px);
        background: var(--triblock-scroll-container-button-background, rgba(65, 120, 190, 0.7));
        color: var(--triblock-scroll-container-button-color, white);
        transition: 0.4s;
      }
      paper-icon-button:hover {
        background: var(--triblock-scroll-container-button-background-hover, rgba(65, 120, 190, 0.9));
      }
    </style>

    <iron-a11y-keys id="a11yLeftButtonDown" target="[[_leftButton]]" keys="enter:keydown" on-keys-pressed="_onLeftButtonDown" stop-keyboard-event-propagation=""></iron-a11y-keys>
    <iron-a11y-keys id="a11yLeftButtonUp" target="[[_leftButton]]" keys="enter:keyup" on-keys-pressed="_onLeftButtonUp" stop-keyboard-event-propagation=""></iron-a11y-keys>
    <iron-a11y-keys id="a11yRightButtonDown" target="[[_rightButton]]" keys="enter:keydown" on-keys-pressed="_onRightButtonDown" stop-keyboard-event-propagation=""></iron-a11y-keys>
    <iron-a11y-keys id="a11yRightButtonUp" target="[[_rightButton]]" keys="enter:keyup" on-keys-pressed="_onRightButtonUp" stop-keyboard-event-propagation=""></iron-a11y-keys>

    <paper-icon-button id="leftButton" icon="[[iconLeft]]" class$="[[_computeScrollButtonClass('left', _leftHidden)]]" on-up="_onScrollButtonUp" on-down="_onLeftScrollButtonDown" tabindex="0"></paper-icon-button>

    <div id="itemsContainer" on-track="_scroll" on-down="_down">
      <div id="itemsContent">
        <content></content>
      </div>
    </div>

    <paper-icon-button id="rightButton" icon="[[iconRight]]" class$="[[_computeScrollButtonClass('right', _rightHidden)]]" on-up="_onScrollButtonUp" on-down="_onRightScrollButtonDown" tabindex="0"></paper-icon-button>
  </template>
</dom-module>

<script>
    Polymer({
      is: "triblock-scroll-container",

      behaviors: [
        Polymer.IronResizableBehavior,
        Polymer.IronMenubarBehavior
      ],

      properties: {
        /*
        * If true, the element's height will be set to fit the child's height.
        */
   	  	autoHeight: {
          type: Boolean,
          value: false
        },
        
        /*
        * Scroller container element object. This object is also used 
        * to data-bind with the triplat-query-scroll-page scroller attribute.
        */
   	  	scroller: {
          type: Object,
          notify: true
        },
		
        /*
        * The icon that will be displayed inside the left scroll button.
        */
        iconLeft: {
          type: String,
          value: "chevron-left"
        },

        /*
        * The icon that will be displayed inside the right scroll button.
        */
        iconRight: {
          type: String,
          value: "chevron-right"
        },

        _step: {
          type: Number,
          value: 10
        },

        _holdDelay: {
          type: Number,
          value: 1
        },

        _leftHidden: {
          type: Boolean,
          value: false
        },

        _rightHidden: {
          type: Boolean,
          value: false
        },

        _previousItem: {
          type: Object
        },

        _leftButton: {
          type: Object,
          value: function() {
            return this.$.leftButton;
          }
        },

        _leftButtonPressed: {
          type: Boolean,
          value: false
        },

        _rightButton: {
          type: Object,
          value: function() {
            return this.$.rightButton;
          }
        },

        _rightButtonPressed: {
          type: Boolean,
          value: false
        },

        /*
        * True if BIDI is active
        */
        _isBidi: {
          type: Boolean,
          value: function() {
            var direction = getComputedStyle(document.body).direction;

            if (direction === "rtl") {
              return true;
            } else {
              return false;
            }
          }
        },

        /*
        * True if the application is running on Chrome browser
        */
        _isChrome: {
          type: Boolean,
          value: function() {
            var chrome = window.navigator.userAgent.toLowerCase().indexOf('chrome') > -1;
            var edge = window.navigator.userAgent.toLowerCase().indexOf('edge') > -1;

            // It's necessary to check if it's not Edge browser, because `chrome` returns true when running on the Edge 
            return (chrome && !edge);
          }
        },

        /*
        * True if the application is running on Edge browser
        */
        _isEdge: {
          type: Boolean,
          value: function() {
            var edge = window.navigator.userAgent.toLowerCase().indexOf('edge') > -1;

            return (edge);
          }
        }
      },

      listeners: {
        'iron-resize': '_onContentSizingChanged',
        'iron-items-changed': '_onContentSizingChanged',
        'iron-select': '_onIronSelect',
        'iron-deselect': '_onIronDeselect'
      },

      attached: function() {
        this.set("scroller", this.$.itemsContainer);
      },

      created: function() {
        this._holdJob = null;
      },

      ready: function() {
        this.setScrollDirection('y', this.$.itemsContainer);
      },

      _computeScrollButtonClass: function(button, hideThisButton) {
        if (button == "left" && !hideThisButton) {
          return 'left';
        }
        if (button == "right" && !hideThisButton) {
          return 'right';
        }
        if (button == "left" && hideThisButton) {
          return 'left not-available';
        }
        if (button == "right" && hideThisButton) {
          return 'right not-available';
        }
        return '';
      },

      _onContentSizingChanged: function() {
        this.debounce('_onContentSizingChanged', function() {
          this._scroll();

          this._setAutoHeight();
        }, 10);
      },

      _onIronSelect: function(event) {
        this._previousItem = event.detail.item;
        this.cancelDebouncer('tab-changed');
      },

      _onIronDeselect: function(event) {
        this.debounce('tab-changed', function() {
          this._previousItem = null;
        }, 1);
      },

      get _itemContainerScrollSize () {
        return Math.max(
          0,
          this.$.itemsContainer.scrollWidth -
            this.$.itemsContainer.offsetWidth
        );
      },

      _scroll: function(e, detail) {
        var ddx = (detail && -detail.ddx) || 0;
        this._affectScroll(ddx);
      },

      _down: function(e) {
        // go one beat async to defeat IronMenuBehavior
        // autorefocus-on-no-selection timeout
        this.async(function() {
          if (this._defaultFocusAsync) {
            this.cancelAsync(this._defaultFocusAsync);
            this._defaultFocusAsync = null;
          }
        }, 1);
      },

      _affectScroll: function(dx) {
        // When BIDI is activate on Edge the `dx` should be a negative number to scroll to right side
        if (this._isBidi && this._isEdge) {
          this.$.itemsContainer.scrollLeft += (-dx);
        } else {
          this.$.itemsContainer.scrollLeft += dx;
        }

        var scrollLeft = Math.round(this.$.itemsContainer.scrollLeft);

        // When BIDI is active the scroll has different behaviors in different browsers:
        // - On Chrome, the `scrollLeft` has value zero in the left side of the container
        // - On Edge, the `scrollLeft` has value zero in the right side of the container and the value increases when scrolling left
        // - On the other browsers, the `scrollLeft` has value zero in the right side of the container and the value decreases when scrolling left (negative number)
        if (!this._isBidi || (this._isBidi && this._isChrome)) {
          this._leftHidden = scrollLeft === 0;
          this._rightHidden = scrollLeft === this._itemContainerScrollSize;
        } else if (this._isBidi && this._isEdge) {
          this._leftHidden = scrollLeft === this._itemContainerScrollSize;
          this._rightHidden = scrollLeft === 0;
        } else {
          this._leftHidden = scrollLeft === (- this._itemContainerScrollSize);
          this._rightHidden = scrollLeft === 0;
        }
      },

      _onLeftScrollButtonDown: function() {
        this._scrollToLeft();
        this._holdJob = setInterval(this._scrollToLeft.bind(this), this._holdDelay);
      },

      _onRightScrollButtonDown: function() {
        this._scrollToRight();
        this._holdJob = setInterval(this._scrollToRight.bind(this), this._holdDelay);
      },

      _onScrollButtonUp: function() {
        clearInterval(this._holdJob);
        this._holdJob = null;
      },

      _scrollToLeft: function() {
        this._affectScroll(-this._step);
      },

      _scrollToRight: function() {
        this._affectScroll(this._step);
      },

      //=========================================================
      // Function _setAutoHeight
      // Objective: Set the container height to be equal to the content height
      // It's only active when autoHeight is true
      //=========================================================
      _setAutoHeight: function() {
        // If Statement: Check if the autoHeight property is true
          // And if the itemsContent element is already in the dom
        if (this.autoHeight && this.$.itemsContent) {
          var height = this.$.itemsContent.offsetHeight;
          this.customStyle['--triblock-scroll-container-height'] = (height + 5) + 'px';
          this.updateStyles();
        }// end if
      },

      _onLeftButtonDown: function() { 
        if (!this._leftButtonPressed) {
          this._leftButtonPressed = true;
          this._onLeftScrollButtonDown();
        }
      },

      _onLeftButtonUp: function() { 
        this._leftButtonPressed = false;
        this._onScrollButtonUp();
      },

      _onRightButtonDown: function() { 
        if (!this._rightButtonPressed) {
          this._rightButtonPressed = true;
          this._onRightScrollButtonDown();
        }
      },

      _onRightButtonUp: function() { 
        this._rightButtonPressed = false;
        this._onScrollButtonUp();
      }

    });
  </script>
<dom-module id="tricomp-reservation-month-title" assetpath="../triapp-reservation-list/">
	<template>
		<style>
			#title-bar {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--layout-start-justified);
				margin-bottom: 15px;
				padding: 5px 30px;
				font-size: 20px;
			}
			:host([small-screen]) #title-bar {
				padding: 5px 15px;
			}

			#title-label {
				@apply(--paper-font-common-nowrap);
				@apply(--layout-flex);
				margin-right: 10px;
				font-size: 28px;
				font-weight: 100;
			}
			:host([small-screen-width]) #title-label {
				font-size: 22px;
			}

			.title-link {
				@apply(--layout-self-end);
				font-size: 14px;
			}
		</style>

		<iron-a11y-keys id="linkKeys" target="[[_targetLink]]" keys="enter" on-keys-pressed="_handleOpenReserveApp"></iron-a11y-keys>

		<div id="title-bar">
			<span id="title-label">This Month's Reservations</span>

			<span id="showmorelink" class="tri-link title-link" on-tap="_handleOpenReserveApp" tabindex="0" role="link" aria-label="Show more"> Show more &gt;</span>
		</div>
	</template>

	<script>
		Polymer({

			is: "tricomp-reservation-month-title",

			behaviors: [
				TriBlockViewResponsiveBehavior
			],

			properties: {
				mainUrl: String, 

				homeApp: String,

				_targetLink: {
					type: Object,
					value: function() {
						return this.$.showmorelink;
					}
				}
			},

			_handleOpenReserveApp: function() {
				var url = this.mainUrl;
				url += (this.homeApp) ? ("?homeApp=" + this.homeApp) : "";
				this._openUrl(url);
			},

			_openUrl: function(url) {
				this.fire("set-busy");
				this.async(function() {
					location.assign(url);
				});
			}

		});
	</script>
</dom-module>




<script>

  /**
   * Use `Polymer.NeonAnimationBehavior` to implement an animation.
   * @polymerBehavior
   */
  Polymer.NeonAnimationBehavior = {

    properties: {

      /**
       * Defines the animation timing.
       */
      animationTiming: {
        type: Object,
        value: function() {
          return {
            duration: 500,
            easing: 'cubic-bezier(0.4, 0, 0.2, 1)',
            fill: 'both'
          }
        }
      }

    },

    /**
     * Can be used to determine that elements implement this behavior.
     */
    isNeonAnimation: true,

    /**
     * Do any animation configuration here.
     */
    // configure: function(config) {
    // },

    /**
     * Returns the animation timing by mixing in properties from `config` to the defaults defined
     * by the animation.
     */
    timingFromConfig: function(config) {
      if (config.timing) {
        for (var property in config.timing) {
          this.animationTiming[property] = config.timing[property];
        }
      }
      return this.animationTiming;
    },

    /**
     * Sets `transform` and `transformOrigin` properties along with the prefixed versions.
     */
    setPrefixedProperty: function(node, property, value) {
      var map = {
        'transform': ['webkitTransform'],
        'transformOrigin': ['mozTransformOrigin', 'webkitTransformOrigin']
      };
      var prefixes = map[property];
      for (var prefix, index = 0; prefix = prefixes[index]; index++) {
        node.style[prefix] = value;
      }
      node.style[property] = value;
    },

    /**
     * Called when the animation finishes.
     */
    complete: function() {}

  };

</script><script src="../web-animations-js/web-animations-next-lite.min.js"></script>
<script>

  Polymer({

    is: 'opaque-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;
      this._effect = new KeyframeEffect(node, [
        {'opacity': '1'},
        {'opacity': '1'}
      ], this.timingFromConfig(config));
      node.style.opacity = '0';
      return this._effect;
    },

    complete: function(config) {
      config.node.style.opacity = '';
    }

  });

</script><script>
  (function() {
    'use strict';
    // Used to calculate the scroll direction during touch events.
    var LAST_TOUCH_POSITION = {
      pageX: 0,
      pageY: 0
    };
    // Used to avoid computing event.path and filter scrollable nodes (better perf).
    var ROOT_TARGET = null;
    var SCROLLABLE_NODES = [];

    /**
     * The IronDropdownScrollManager is intended to provide a central source
     * of authority and control over which elements in a document are currently
     * allowed to scroll.
     */

    Polymer.IronDropdownScrollManager = {

      /**
       * The current element that defines the DOM boundaries of the
       * scroll lock. This is always the most recently locking element.
       */
      get currentLockingElement() {
        return this._lockingElements[this._lockingElements.length - 1];
      },

      /**
       * Returns true if the provided element is "scroll locked", which is to
       * say that it cannot be scrolled via pointer or keyboard interactions.
       *
       * @param {HTMLElement} element An HTML element instance which may or may
       * not be scroll locked.
       */
      elementIsScrollLocked: function(element) {
        var currentLockingElement = this.currentLockingElement;

        if (currentLockingElement === undefined)
          return false;

        var scrollLocked;

        if (this._hasCachedLockedElement(element)) {
          return true;
        }

        if (this._hasCachedUnlockedElement(element)) {
          return false;
        }

        scrollLocked = !!currentLockingElement &&
          currentLockingElement !== element &&
          !this._composedTreeContains(currentLockingElement, element);

        if (scrollLocked) {
          this._lockedElementCache.push(element);
        } else {
          this._unlockedElementCache.push(element);
        }

        return scrollLocked;
      },

      /**
       * Push an element onto the current scroll lock stack. The most recently
       * pushed element and its children will be considered scrollable. All
       * other elements will not be scrollable.
       *
       * Scroll locking is implemented as a stack so that cases such as
       * dropdowns within dropdowns are handled well.
       *
       * @param {HTMLElement} element The element that should lock scroll.
       */
      pushScrollLock: function(element) {
        // Prevent pushing the same element twice
        if (this._lockingElements.indexOf(element) >= 0) {
          return;
        }

        if (this._lockingElements.length === 0) {
          this._lockScrollInteractions();
        }

        this._lockingElements.push(element);

        this._lockedElementCache = [];
        this._unlockedElementCache = [];
      },

      /**
       * Remove an element from the scroll lock stack. The element being
       * removed does not need to be the most recently pushed element. However,
       * the scroll lock constraints only change when the most recently pushed
       * element is removed.
       *
       * @param {HTMLElement} element The element to remove from the scroll
       * lock stack.
       */
      removeScrollLock: function(element) {
        var index = this._lockingElements.indexOf(element);

        if (index === -1) {
          return;
        }

        this._lockingElements.splice(index, 1);

        this._lockedElementCache = [];
        this._unlockedElementCache = [];

        if (this._lockingElements.length === 0) {
          this._unlockScrollInteractions();
        }
      },

      _lockingElements: [],

      _lockedElementCache: null,

      _unlockedElementCache: null,

      _hasCachedLockedElement: function(element) {
        return this._lockedElementCache.indexOf(element) > -1;
      },

      _hasCachedUnlockedElement: function(element) {
        return this._unlockedElementCache.indexOf(element) > -1;
      },

      _composedTreeContains: function(element, child) {
        // NOTE(cdata): This method iterates over content elements and their
        // corresponding distributed nodes to implement a contains-like method
        // that pierces through the composed tree of the ShadowDOM. Results of
        // this operation are cached (elsewhere) on a per-scroll-lock basis, to
        // guard against potentially expensive lookups happening repeatedly as
        // a user scrolls / touchmoves.
        var contentElements;
        var distributedNodes;
        var contentIndex;
        var nodeIndex;

        if (element.contains(child)) {
          return true;
        }

        contentElements = Polymer.dom(element).querySelectorAll('content');

        for (contentIndex = 0; contentIndex < contentElements.length; ++contentIndex) {

          distributedNodes = Polymer.dom(contentElements[contentIndex]).getDistributedNodes();

          for (nodeIndex = 0; nodeIndex < distributedNodes.length; ++nodeIndex) {

            if (this._composedTreeContains(distributedNodes[nodeIndex], child)) {
              return true;
            }
          }
        }

        return false;
      },

      _scrollInteractionHandler: function(event) {
        // Avoid canceling an event with cancelable=false, e.g. scrolling is in
        // progress and cannot be interrupted.
        if (event.cancelable && this._shouldPreventScrolling(event)) {
          event.preventDefault();
        }
        // If event has targetTouches (touch event), update last touch position.
        if (event.targetTouches) {
          var touch = event.targetTouches[0];
          LAST_TOUCH_POSITION.pageX = touch.pageX;
          LAST_TOUCH_POSITION.pageY = touch.pageY;
        }
      },

      _lockScrollInteractions: function() {
        this._boundScrollHandler = this._boundScrollHandler ||
          this._scrollInteractionHandler.bind(this);
        // Modern `wheel` event for mouse wheel scrolling:
        document.addEventListener('wheel', this._boundScrollHandler, true);
        // Older, non-standard `mousewheel` event for some FF:
        document.addEventListener('mousewheel', this._boundScrollHandler, true);
        // IE:
        document.addEventListener('DOMMouseScroll', this._boundScrollHandler, true);
        // Save the SCROLLABLE_NODES on touchstart, to be used on touchmove.
        document.addEventListener('touchstart', this._boundScrollHandler, true);
        // Mobile devices can scroll on touch move:
        document.addEventListener('touchmove', this._boundScrollHandler, true);
      },

      _unlockScrollInteractions: function() {
        document.removeEventListener('wheel', this._boundScrollHandler, true);
        document.removeEventListener('mousewheel', this._boundScrollHandler, true);
        document.removeEventListener('DOMMouseScroll', this._boundScrollHandler, true);
        document.removeEventListener('touchstart', this._boundScrollHandler, true);
        document.removeEventListener('touchmove', this._boundScrollHandler, true);
      },

      /**
       * Returns true if the event causes scroll outside the current locking
       * element, e.g. pointer/keyboard interactions, or scroll "leaking"
       * outside the locking element when it is already at its scroll boundaries.
       * @param {!Event} event
       * @return {boolean}
       * @private
       */
      _shouldPreventScrolling: function(event) {

        // Update if root target changed. For touch events, ensure we don't
        // update during touchmove.
        var target = Polymer.dom(event).rootTarget;
        if (event.type !== 'touchmove' && ROOT_TARGET !== target) {
          ROOT_TARGET = target;
          SCROLLABLE_NODES = this._getScrollableNodes(Polymer.dom(event).path);
        }

        // Prevent event if no scrollable nodes.
        if (!SCROLLABLE_NODES.length) {
          return true;
        }
        // Don't prevent touchstart event inside the locking element when it has
        // scrollable nodes.
        if (event.type === 'touchstart') {
          return false;
        }
        // Get deltaX/Y.
        var info = this._getScrollInfo(event);
        // Prevent if there is no child that can scroll.
        return !this._getScrollingNode(SCROLLABLE_NODES, info.deltaX, info.deltaY);
      },

      /**
       * Returns an array of scrollable nodes up to the current locking element,
       * which is included too if scrollable.
       * @param {!Array<Node>} nodes
       * @return {Array<Node>} scrollables
       * @private
       */
      _getScrollableNodes: function(nodes) {
        var scrollables = [];
        var lockingIndex = nodes.indexOf(this.currentLockingElement);
        // Loop from root target to locking element (included).
        for (var i = 0; i <= lockingIndex; i++) {
          var node = nodes[i];
          // Skip document fragments.
          if (node.nodeType === 11) {
            continue;
          }
          // Check inline style before checking computed style.
          var style = node.style;
          if (style.overflow !== 'scroll' && style.overflow !== 'auto') {
            style = window.getComputedStyle(node);
          }
          if (style.overflow === 'scroll' || style.overflow === 'auto') {
            scrollables.push(node);
          }
        }
        return scrollables;
      },

      /**
       * Returns the node that is scrolling. If there is no scrolling,
       * returns undefined.
       * @param {!Array<Node>} nodes
       * @param {number} deltaX Scroll delta on the x-axis
       * @param {number} deltaY Scroll delta on the y-axis
       * @return {Node|undefined}
       * @private
       */
      _getScrollingNode: function(nodes, deltaX, deltaY) {
        // No scroll.
        if (!deltaX && !deltaY) {
          return;
        }
        // Check only one axis according to where there is more scroll.
        // Prefer vertical to horizontal.
        var verticalScroll = Math.abs(deltaY) >= Math.abs(deltaX);
        for (var i = 0; i < nodes.length; i++) {
          var node = nodes[i];
          var canScroll = false;
          if (verticalScroll) {
            // delta < 0 is scroll up, delta > 0 is scroll down.
            canScroll = deltaY < 0 ? node.scrollTop > 0 :
              node.scrollTop < node.scrollHeight - node.clientHeight;
          } else {
            // delta < 0 is scroll left, delta > 0 is scroll right.
            canScroll = deltaX < 0 ? node.scrollLeft > 0 :
              node.scrollLeft < node.scrollWidth - node.clientWidth;
          }
          if (canScroll) {
            return node;
          }
        }
      },

      /**
       * Returns scroll `deltaX` and `deltaY`.
       * @param {!Event} event The scroll event
       * @return {{
       *  deltaX: number The x-axis scroll delta (positive: scroll right,
       *                 negative: scroll left, 0: no scroll),
       *  deltaY: number The y-axis scroll delta (positive: scroll down,
       *                 negative: scroll up, 0: no scroll)
       * }} info
       * @private
       */
      _getScrollInfo: function(event) {
        var info = {
          deltaX: event.deltaX,
          deltaY: event.deltaY
        };
        // Already available.
        if ('deltaX' in event) {
          // do nothing, values are already good.
        }
        // Safari has scroll info in `wheelDeltaX/Y`.
        else if ('wheelDeltaX' in event) {
          info.deltaX = -event.wheelDeltaX;
          info.deltaY = -event.wheelDeltaY;
        }
        // Firefox has scroll info in `detail` and `axis`.
        else if ('axis' in event) {
          info.deltaX = event.axis === 1 ? event.detail : 0;
          info.deltaY = event.axis === 2 ? event.detail : 0;
        }
        // On mobile devices, calculate scroll direction.
        else if (event.targetTouches) {
          var touch = event.targetTouches[0];
          // Touch moves from right to left => scrolling goes right.
          info.deltaX = LAST_TOUCH_POSITION.pageX - touch.pageX;
          // Touch moves from down to up => scrolling goes down.
          info.deltaY = LAST_TOUCH_POSITION.pageY - touch.pageY;
        }
        return info;
      }
    };
  })();
</script><dom-module id="iron-dropdown" assetpath="../iron-dropdown/">
  <template>
    <style>
      :host {
        position: fixed;
      }

      #contentWrapper ::content > * {
        overflow: auto;
      }

      #contentWrapper.animating ::content > * {
        overflow: hidden;
      }
    </style>

    <div id="contentWrapper">
      <content id="content" select=".dropdown-content"></content>
    </div>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'iron-dropdown',

        behaviors: [
          Polymer.IronControlState,
          Polymer.IronA11yKeysBehavior,
          Polymer.IronOverlayBehavior,
          Polymer.NeonAnimationRunnerBehavior
        ],

        properties: {
          /**
           * The orientation against which to align the dropdown content
           * horizontally relative to the dropdown trigger.
           * Overridden from `Polymer.IronFitBehavior`.
           */
          horizontalAlign: {
            type: String,
            value: 'left',
            reflectToAttribute: true
          },

          /**
           * The orientation against which to align the dropdown content
           * vertically relative to the dropdown trigger.
           * Overridden from `Polymer.IronFitBehavior`.
           */
          verticalAlign: {
            type: String,
            value: 'top',
            reflectToAttribute: true
          },

          /**
           * An animation config. If provided, this will be used to animate the
           * opening of the dropdown.
           */
          openAnimationConfig: {
            type: Object
          },

          /**
           * An animation config. If provided, this will be used to animate the
           * closing of the dropdown.
           */
          closeAnimationConfig: {
            type: Object
          },

          /**
           * If provided, this will be the element that will be focused when
           * the dropdown opens.
           */
          focusTarget: {
            type: Object
          },

          /**
           * Set to true to disable animations when opening and closing the
           * dropdown.
           */
          noAnimations: {
            type: Boolean,
            value: false
          },

          /**
           * By default, the dropdown will constrain scrolling on the page
           * to itself when opened.
           * Set to true in order to prevent scroll from being constrained
           * to the dropdown when it opens.
           */
          allowOutsideScroll: {
            type: Boolean,
            value: false
          },

          /**
           * Callback for scroll events.
           * @type {Function}
           * @private
           */
          _boundOnCaptureScroll: {
            type: Function,
            value: function() {
              return this._onCaptureScroll.bind(this);
            }
          }
        },

        listeners: {
          'neon-animation-finish': '_onNeonAnimationFinish'
        },

        observers: [
          '_updateOverlayPosition(positionTarget, verticalAlign, horizontalAlign, verticalOffset, horizontalOffset)'
        ],

        /**
         * The element that is contained by the dropdown, if any.
         */
        get containedElement() {
          return Polymer.dom(this.$.content).getDistributedNodes()[0];
        },

        /**
         * The element that should be focused when the dropdown opens.
         * @deprecated
         */
        get _focusTarget() {
          return this.focusTarget || this.containedElement;
        },

        ready: function() {
          // Memoized scrolling position, used to block scrolling outside.
          this._scrollTop = 0;
          this._scrollLeft = 0;
          // Used to perform a non-blocking refit on scroll.
          this._refitOnScrollRAF = null;
        },

        attached: function () {
          if (!this.sizingTarget || this.sizingTarget === this) {
            this.sizingTarget = this.containedElement;
          }
        },

        detached: function() {
          this.cancelAnimation();
          document.removeEventListener('scroll', this._boundOnCaptureScroll);
          Polymer.IronDropdownScrollManager.removeScrollLock(this);
        },

        /**
         * Called when the value of `opened` changes.
         * Overridden from `IronOverlayBehavior`
         */
        _openedChanged: function() {
          if (this.opened && this.disabled) {
            this.cancel();
          } else {
            this.cancelAnimation();
            this._updateAnimationConfig();
            this._saveScrollPosition();
            if (this.opened) {
              document.addEventListener('scroll', this._boundOnCaptureScroll);
              !this.allowOutsideScroll && Polymer.IronDropdownScrollManager.pushScrollLock(this);
            } else {
              document.removeEventListener('scroll', this._boundOnCaptureScroll);
              Polymer.IronDropdownScrollManager.removeScrollLock(this);
            }
            Polymer.IronOverlayBehaviorImpl._openedChanged.apply(this, arguments);
          }
        },

        /**
         * Overridden from `IronOverlayBehavior`.
         */
        _renderOpened: function() {
          if (!this.noAnimations && this.animationConfig.open) {
            this.$.contentWrapper.classList.add('animating');
            this.playAnimation('open');
          } else {
            Polymer.IronOverlayBehaviorImpl._renderOpened.apply(this, arguments);
          }
        },

        /**
         * Overridden from `IronOverlayBehavior`.
         */
        _renderClosed: function() {

          if (!this.noAnimations && this.animationConfig.close) {
            this.$.contentWrapper.classList.add('animating');
            this.playAnimation('close');
          } else {
            Polymer.IronOverlayBehaviorImpl._renderClosed.apply(this, arguments);
          }
        },

        /**
         * Called when animation finishes on the dropdown (when opening or
         * closing). Responsible for "completing" the process of opening or
         * closing the dropdown by positioning it or setting its display to
         * none.
         */
        _onNeonAnimationFinish: function() {
          this.$.contentWrapper.classList.remove('animating');
          if (this.opened) {
            this._finishRenderOpened();
          } else {
            this._finishRenderClosed();
          }
        },

        _onCaptureScroll: function() {
          if (!this.allowOutsideScroll) {
            this._restoreScrollPosition();
          } else {
            this._refitOnScrollRAF && window.cancelAnimationFrame(this._refitOnScrollRAF);
            this._refitOnScrollRAF = window.requestAnimationFrame(this.refit.bind(this));
          }
        },

        /**
         * Memoizes the scroll position of the outside scrolling element.
         * @private
         */
        _saveScrollPosition: function() {
          if (document.scrollingElement) {
            this._scrollTop = document.scrollingElement.scrollTop;
            this._scrollLeft = document.scrollingElement.scrollLeft;
          } else {
            // Since we don't know if is the body or html, get max.
            this._scrollTop = Math.max(document.documentElement.scrollTop, document.body.scrollTop);
            this._scrollLeft = Math.max(document.documentElement.scrollLeft, document.body.scrollLeft);
          }
        },

        /**
         * Resets the scroll position of the outside scrolling element.
         * @private
         */
        _restoreScrollPosition: function() {
          if (document.scrollingElement) {
            document.scrollingElement.scrollTop = this._scrollTop;
            document.scrollingElement.scrollLeft = this._scrollLeft;
          } else {
            // Since we don't know if is the body or html, set both.
            document.documentElement.scrollTop = this._scrollTop;
            document.documentElement.scrollLeft = this._scrollLeft;
            document.body.scrollTop = this._scrollTop;
            document.body.scrollLeft = this._scrollLeft;
          }
        },

        /**
         * Constructs the final animation config from different properties used
         * to configure specific parts of the opening and closing animations.
         */
        _updateAnimationConfig: function() {
          var animations = (this.openAnimationConfig || []).concat(this.closeAnimationConfig || []);
          for (var i = 0; i < animations.length; i++) {
            animations[i].node = this.containedElement;
          }
          this.animationConfig = {
            open: this.openAnimationConfig,
            close: this.closeAnimationConfig
          };
        },

        /**
         * Updates the overlay position based on configured horizontal
         * and vertical alignment.
         */
        _updateOverlayPosition: function() {
          if (this.isAttached) {
            // This triggers iron-resize, and iron-overlay-behavior will call refit if needed.
            this.notifyResize();
          }
        },

        /**
         * Apply focus to focusTarget or containedElement
         */
        _applyFocus: function () {
          var focusTarget = this.focusTarget || this.containedElement;
          if (focusTarget && this.opened && !this.noAutoFocus) {
            focusTarget.focus();
          } else {
            Polymer.IronOverlayBehaviorImpl._applyFocus.apply(this, arguments);
          }
        }
      });
    })();
  </script>
</dom-module>

<dom-module id="triblock-popup" assetpath="../triblock-popup/">
	<template>
		<style include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning">
			:host{
				background: var(--triblock-popup-background-color, --tri-primary-content-background-color);
				@apply(--shadow-elevation-16dp);
				padding: 30px;
				@apply(--triblock-popup);
			}

			:host([small-screen-width]){
				height: auto !important;
				width: auto !important;
			}

			paper-icon-button {
				--paper-icon-button: {
					padding: 0px;
				};
			}

			#xbtn {
				position: absolute;
				right: -11px;
				top: -11px;
				z-index: 999;
				height: 22px;
				width: 22px;
				@apply --triblock-popup-close-button;
			}

			:host-context([dir="rtl"]) #xbtn{
				right: auto;
				left: -11px;
			}

			:host([small-screen-width]) #xbtn {
				display: none;
			}

			#xbtn[focused] {
				color: var(--tri-primary-icon-button-hover-color);
			}
		</style>

		<paper-icon-button id="xbtn" icon="ibm-glyphs:popup-close-filled" on-tap="cancel" alt="Close popup"></paper-icon-button>

		<content></content>

	</template>
</dom-module>
<script>

	Polymer({

		is: "triblock-popup",

		behaviors: [
			TriBlockViewResponsiveBehavior,
			Polymer.PaperDialogBehavior,
		],

		properties: {
			/**
			  * The last node inside the popup that can receive focus.
			  * It is used to cycle the focus from the last node to the first node when `with-backdrop` or `modal` is true.
			  */
			lastNode: {
				type: Object
			},

			/**
			  * The title that will be displayed in the `triblock-app-layout` component banner label when the `smallScreenWidth` property is true. 
			  */
			title: String,

			/**
			  * Set to true, will prevent the popup from close when the application is implemented `triblock-app-layout-banner-popup-behavior` behavior. It can be used to handle the banner back button when is clicked.  
			  */
			manualClose: {
				type: Boolean,
				value: false
			}
		},

		observers: [
			'_onSmallScreenChanged(smallScreenWidth)',
			'_popupClosed(opened)'
		],

		attached: function(){
			this._noCancelOnOutsideClick = this.noCancelOnOutsideClick;
			this._noCancelOnEscKey = this.noCancelOnEscKey;
			this._withBackdrop = this.withBackdrop;
			if(navigator.userAgent.match('CriOS')) this._chromeiOS = true;
		},

		get _focusableNodes() {
			if (this.lastNode) {
				return [
					this.$.xbtn, this.lastNode
				];
			} else {
				// Get the original focusableNodes from IronOverlayBehaviorImpl.
				var propertyDescriptor = Object.getOwnPropertyDescriptor(Polymer.IronOverlayBehaviorImpl, "_focusableNodes");
				var focusableNodes = propertyDescriptor.get.apply(this);
				
				// If there is at least 1 node, add the close button as the first item of the focusableNodes array.
				if (!focusableNodes || focusableNodes.length == 0) {
					return this.$.xbtn;
				} else {
					focusableNodes.unshift(this.$.xbtn);
					return focusableNodes;
				}
			}
		},

		/**
		  * Open the pop-up.
		  **/
		openPopup: function(){
			if(this.smallScreenWidth){
				this._openOnSmallScreen();
			}else{
				this._openOnNotSmallScreen();
			}
		}, 

		_onSmallScreenChanged: function(){
			if(this.smallScreenWidth){
				if (this.opened){
					this._openOnSmallScreen();
				}
			}else{
				if(this.opened){
					this._openOnNotSmallScreen();
				}
			}
		},

		_openOnSmallScreen: function(){
			if(this.modal){ 
				this.set('modal', false); 
				this._modalIsUsed = true;
			}
			this.set('noCancelOnOutsideClick', true);
			this.set('noCancelOnEscKey', true);
			this.set('withBackdrop', false);
			this.classList.add('__triBlockPopupFit');
			this.open();
			this._addHandleScrollingCssClass();
			this._handleChomeiOS();
		},

		_openOnNotSmallScreen: function(){
			if(this._modalIsUsed){
				this.set('modal', true);
			}
			this.set('noCancelOnOutsideClick', this._noCancelOnOutsideClick);
			this.set('noCancelOnEscKey', this._noCancelOnEscKey);
			this.set('withBackdrop', this._withBackdrop);
			this.classList.remove('__triBlockPopupFit');
			this.open();
			this._removeHandleScrollingCssClass();
			this._handleChomeiOS();
		},

		_handleChomeiOS: function(){
			if(this._chromeiOS){
				this.close();
				this.async(function(){
					this.open();
				});
			}
		},

		/**
		  * Close the pop-up.
		  **/
		closePopup: function(){
			this.close();
			this._removeHandleScrollingCssClass();
		},

		_popupClosed: function(e){
			if(!this.opened){
				this.closePopup();
				this.fire("popup-opened", {element:null});
			} else {
				this.fire("popup-opened", {element:this});
			}
		},

		_addHandleScrollingCssClass: function(){
			if(!this._disablePopupMoveClassAdded){
				this._addDisablePopupMoveClass();
			}
			
			var body = document.querySelector('body');
			var flag = true;
			var ancestor;
			var child = this;
			while(flag){
				ancestor = child.parentNode;
				if(body === ancestor){
					flag = false;
					child.classList.add('__triBlockPopupDisablePopupMove');
				}else{
					child = ancestor;
					child.classList.add('__triBlockPopupDisablePopupMove');
				}
			}
		},

		_removeHandleScrollingCssClass: function(){
			if(!this._disablePopupMoveClassAdded) return;
			var body = document.querySelector('body');
			var flag = true;
			var ancestor;
			var child = this;
			while(flag){
				ancestor = child.parentNode;
				if(body === ancestor){
					flag = false;
					child.classList.remove('__triBlockPopupDisablePopupMove');
				}else{
					child = ancestor;
					child.classList.remove('__triBlockPopupDisablePopupMove');
				}
			}
		},

		_addDisablePopupMoveClass: function() {
			var css = '.__triBlockPopupDisablePopupMove {display: relative !important; overflow: hidden !important;} .__triBlockPopupFit {position:absolute; top:0; right:0; bottom:0; left:0}';
			var head = document.getElementsByTagName('head')[0];
			var style = document.createElement('style');
			style.type = 'text/css';
			if (style.styleSheet){
				style.styleSheet.cssText = css;
			} else {
				style.appendChild(document.createTextNode(css));
			}
			head.appendChild(style);
			this._disablePopupMoveClassAdded = true;
		}

	});
</script>



<dom-module id="paper-input-container" assetpath="../paper-input/">
  <template>
    <style>
      :host {
        display: block;
        padding: 8px 0;

        @apply(--paper-input-container);
      }

      :host([inline]) {
        display: inline-block;
      }

      :host([disabled]) {
        pointer-events: none;
        opacity: 0.33;

        @apply(--paper-input-container-disabled);
      }

      :host([hidden]) {
        display: none !important;
      }

      .floated-label-placeholder {
        @apply(--paper-font-caption);
      }

      .underline {
        position: relative;
      }

      .focused-line {
        @apply(--layout-fit);

        background: var(--paper-input-container-focus-color, --primary-color);
        height: 2px;

        -webkit-transform-origin: center center;
        transform-origin: center center;
        -webkit-transform: scale3d(0,1,1);
        transform: scale3d(0,1,1);

        @apply(--paper-input-container-underline-focus);
      }

      .underline.is-highlighted .focused-line {
        -webkit-transform: none;
        transform: none;
        -webkit-transition: -webkit-transform 0.25s;
        transition: transform 0.25s;

        @apply(--paper-transition-easing);
      }

      .underline.is-invalid .focused-line {
        background: var(--paper-input-container-invalid-color, --error-color);
        -webkit-transform: none;
        transform: none;
        -webkit-transition: -webkit-transform 0.25s;
        transition: transform 0.25s;

        @apply(--paper-transition-easing);
      }

      .unfocused-line {
        @apply(--layout-fit);

        background: var(--paper-input-container-color, --secondary-text-color);
        height: 1px;

        @apply(--paper-input-container-underline);
      }

      :host([disabled]) .unfocused-line {
        border-bottom: 1px dashed;
        border-color: var(--paper-input-container-color, --secondary-text-color);
        background: transparent;

        @apply(--paper-input-container-underline-disabled);
      }

      .label-and-input-container {
        @apply(--layout-flex-auto);
        @apply(--layout-relative);

        width: 100%;
        max-width: 100%;
      }

      .input-content {
        @apply(--layout-horizontal);
        @apply(--layout-center);

        position: relative;
      }

      .input-content ::content label,
      .input-content ::content .paper-input-label {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        width: 100%;
        font: inherit;
        color: var(--paper-input-container-color, --secondary-text-color);
        -webkit-transition: -webkit-transform 0.25s, width 0.25s;
        transition: transform 0.25s, width 0.25s;
        -webkit-transform-origin: left top;
        transform-origin: left top;

        @apply(--paper-font-common-nowrap);
        @apply(--paper-font-subhead);
        @apply(--paper-input-container-label);
        @apply(--paper-transition-easing);
      }

      .input-content.label-is-floating ::content label,
      .input-content.label-is-floating ::content .paper-input-label {
        -webkit-transform: translateY(-75%) scale(0.75);
        transform: translateY(-75%) scale(0.75);

        /* Since we scale to 75/100 of the size, we actually have 100/75 of the
        original space now available */
        width: 133%;

        @apply(--paper-input-container-label-floating);
      }

      :host-context([dir="rtl"]) .input-content.label-is-floating ::content label,
      :host-context([dir="rtl"]) .input-content.label-is-floating ::content .paper-input-label {
        /* TODO(noms): Figure out why leaving the width at 133% before the animation
         * actually makes
         * it wider on the right side, not left side, as you would expect in RTL */
        width: 100%;
        -webkit-transform-origin: right top;
        transform-origin: right top;
      }

      .input-content.label-is-highlighted ::content label,
      .input-content.label-is-highlighted ::content .paper-input-label {
        color: var(--paper-input-container-focus-color, --primary-color);

        @apply(--paper-input-container-label-focus);
      }

      .input-content.is-invalid ::content label,
      .input-content.is-invalid ::content .paper-input-label {
        color: var(--paper-input-container-invalid-color, --error-color);
      }

      .input-content.label-is-hidden ::content label,
      .input-content.label-is-hidden ::content .paper-input-label {
        visibility: hidden;
      }

      .input-content ::content input,
      .input-content ::content textarea,
      .input-content ::content iron-autogrow-textarea,
      .input-content ::content .paper-input-input {
        position: relative; /* to make a stacking context */
        outline: none;
        box-shadow: none;
        padding: 0;
        width: 100%;
        max-width: 100%;
        background: transparent;
        border: none;
        color: var(--paper-input-container-input-color, --primary-text-color);
        -webkit-appearance: none;
        text-align: inherit;
        vertical-align: bottom;

        @apply(--paper-font-subhead);
        @apply(--paper-input-container-input);
      }

      ::content [prefix] {
        @apply(--paper-font-subhead);

        @apply(--paper-input-prefix);
        @apply(--layout-flex-none);
      }

      ::content [suffix] {
        @apply(--paper-font-subhead);

        @apply(--paper-input-suffix);
        @apply(--layout-flex-none);
      }

      /* Firefox sets a min-width on the input, which can cause layout issues */
      .input-content ::content input {
        min-width: 0;
      }

      .input-content ::content textarea {
        resize: none;
      }

      .add-on-content {
        position: relative;
      }

      .add-on-content.is-invalid ::content * {
        color: var(--paper-input-container-invalid-color, --error-color);
      }

      .add-on-content.is-highlighted ::content * {
        color: var(--paper-input-container-focus-color, --primary-color);
      }
    </style>

    <template is="dom-if" if="[[!noLabelFloat]]">
      <div class="floated-label-placeholder" aria-hidden="true">&nbsp;</div>
    </template>

    <div class$="[[_computeInputContentClass(noLabelFloat,alwaysFloatLabel,focused,invalid,_inputHasContent)]]">
      <content select="[prefix]" id="prefix"></content>

      <div class="label-and-input-container" id="labelAndInputContainer">
        <content select=":not([add-on]):not([prefix]):not([suffix])"></content>
      </div>

      <content select="[suffix]"></content>
    </div>

    <div class$="[[_computeUnderlineClass(focused,invalid)]]">
      <div class="unfocused-line"></div>
      <div class="focused-line"></div>
    </div>

    <div class$="[[_computeAddOnContentClass(focused,invalid)]]">
      <content id="addOnContent" select="[add-on]"></content>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'paper-input-container',

    properties: {
      /**
       * Set to true to disable the floating label. The label disappears when the input value is
       * not null.
       */
      noLabelFloat: {
        type: Boolean,
        value: false
      },

      /**
       * Set to true to always float the floating label.
       */
      alwaysFloatLabel: {
        type: Boolean,
        value: false
      },

      /**
       * The attribute to listen for value changes on.
       */
      attrForValue: {
        type: String,
        value: 'bind-value'
      },

      /**
       * Set to true to auto-validate the input value when it changes.
       */
      autoValidate: {
        type: Boolean,
        value: false
      },

      /**
       * True if the input is invalid. This property is set automatically when the input value
       * changes if auto-validating, or when the `iron-input-validate` event is heard from a child.
       */
      invalid: {
        observer: '_invalidChanged',
        type: Boolean,
        value: false
      },

      /**
       * True if the input has focus.
       */
      focused: {
        readOnly: true,
        type: Boolean,
        value: false,
        notify: true
      },

      _addons: {
        type: Array
        // do not set a default value here intentionally - it will be initialized lazily when a
        // distributed child is attached, which may occur before configuration for this element
        // in polyfill.
      },

      _inputHasContent: {
        type: Boolean,
        value: false
      },

      _inputSelector: {
        type: String,
        value: 'input,textarea,.paper-input-input'
      },

      _boundOnFocus: {
        type: Function,
        value: function() {
          return this._onFocus.bind(this);
        }
      },

      _boundOnBlur: {
        type: Function,
        value: function() {
          return this._onBlur.bind(this);
        }
      },

      _boundOnInput: {
        type: Function,
        value: function() {
          return this._onInput.bind(this);
        }
      },

      _boundValueChanged: {
        type: Function,
        value: function() {
          return this._onValueChanged.bind(this);
        }
      }
    },

    listeners: {
      'addon-attached': '_onAddonAttached',
      'iron-input-validate': '_onIronInputValidate'
    },

    get _valueChangedEvent() {
      return this.attrForValue + '-changed';
    },

    get _propertyForValue() {
      return Polymer.CaseMap.dashToCamelCase(this.attrForValue);
    },

    get _inputElement() {
      return Polymer.dom(this).querySelector(this._inputSelector);
    },

    get _inputElementValue() {
      return this._inputElement[this._propertyForValue] || this._inputElement.value;
    },

    ready: function() {
      if (!this._addons) {
        this._addons = [];
      }
      this.addEventListener('focus', this._boundOnFocus, true);
      this.addEventListener('blur', this._boundOnBlur, true);
    },

    attached: function() {
      if (this.attrForValue) {
        this._inputElement.addEventListener(this._valueChangedEvent, this._boundValueChanged);
      } else {
        this.addEventListener('input', this._onInput);
      }

      // Only validate when attached if the input already has a value.
      if (this._inputElementValue != '') {
        this._handleValueAndAutoValidate(this._inputElement);
      } else {
        this._handleValue(this._inputElement);
      }
    },

    _onAddonAttached: function(event) {
      if (!this._addons) {
        this._addons = [];
      }
      var target = event.target;
      if (this._addons.indexOf(target) === -1) {
        this._addons.push(target);
        if (this.isAttached) {
          this._handleValue(this._inputElement);
        }
      }
    },

    _onFocus: function() {
      this._setFocused(true);
    },

    _onBlur: function() {
      this._setFocused(false);
      this._handleValueAndAutoValidate(this._inputElement);
    },

    _onInput: function(event) {
      this._handleValueAndAutoValidate(event.target);
    },

    _onValueChanged: function(event) {
      this._handleValueAndAutoValidate(event.target);
    },

    _handleValue: function(inputElement) {
      var value = this._inputElementValue;

      // type="number" hack needed because this.value is empty until it's valid
      if (value || value === 0 || (inputElement.type === 'number' && !inputElement.checkValidity())) {
        this._inputHasContent = true;
      } else {
        this._inputHasContent = false;
      }

      this.updateAddons({
        inputElement: inputElement,
        value: value,
        invalid: this.invalid
      });
    },

    _handleValueAndAutoValidate: function(inputElement) {
      if (this.autoValidate) {
        var valid;
        if (inputElement.validate) {
          valid = inputElement.validate(this._inputElementValue);
        } else {
          valid = inputElement.checkValidity();
        }
        this.invalid = !valid;
      }

      // Call this last to notify the add-ons.
      this._handleValue(inputElement);
    },

    _onIronInputValidate: function(event) {
      this.invalid = this._inputElement.invalid;
    },

    _invalidChanged: function() {
      if (this._addons) {
        this.updateAddons({invalid: this.invalid});
      }
    },

    /**
     * Call this to update the state of add-ons.
     * @param {Object} state Add-on state.
     */
    updateAddons: function(state) {
      for (var addon, index = 0; addon = this._addons[index]; index++) {
        addon.update(state);
      }
    },

    _computeInputContentClass: function(noLabelFloat, alwaysFloatLabel, focused, invalid, _inputHasContent) {
      var cls = 'input-content';
      if (!noLabelFloat) {
        var label = this.querySelector('label');

        if (alwaysFloatLabel || _inputHasContent) {
          cls += ' label-is-floating';
          // If the label is floating, ignore any offsets that may have been
          // applied from a prefix element.
          this.$.labelAndInputContainer.style.position = 'static';

          if (invalid) {
            cls += ' is-invalid';
          } else if (focused) {
            cls += " label-is-highlighted";
          }
        } else {
          // When the label is not floating, it should overlap the input element.
          if (label) {
            this.$.labelAndInputContainer.style.position = 'relative';
          }
        }
      } else {
        if (_inputHasContent) {
          cls += ' label-is-hidden';
        }
      }
      return cls;
    },

    _computeUnderlineClass: function(focused, invalid) {
      var cls = 'underline';
      if (invalid) {
        cls += ' is-invalid';
      } else if (focused) {
        cls += ' is-highlighted'
      }
      return cls;
    },

    _computeAddOnContentClass: function(focused, invalid) {
      var cls = 'add-on-content';
      if (invalid) {
        cls += ' is-invalid';
      } else if (focused) {
        cls += ' is-highlighted'
      }
      return cls;
    }
  });
</script>


<script>

  /**
   * Use `Polymer.PaperInputAddonBehavior` to implement an add-on for `<paper-input-container>`. A
   * add-on appears below the input, and may display information based on the input value and
   * validity such as a character counter or an error message.
   * @polymerBehavior
   */
  Polymer.PaperInputAddonBehavior = {

    hostAttributes: {
      'add-on': ''
    },

    attached: function() {
      this.fire('addon-attached');
    },

    /**
     * The function called by `<paper-input-container>` when the input value or validity changes.
     * @param {{
     *   inputElement: (Element|undefined),
     *   value: (string|undefined),
     *   invalid: boolean
     * }} state -
     *     inputElement: The input element.
     *     value: The input value.
     *     invalid: True if the input value is invalid.
     */
    update: function(state) {
    }

  };

</script><dom-module id="paper-input-error" assetpath="../paper-input/">
  <template>
    <style>
      :host {
        display: inline-block;
        visibility: hidden;

        color: var(--paper-input-container-invalid-color, --error-color);

        @apply(--paper-font-caption);
        @apply(--paper-input-error);
        position: absolute;
        left:0;
        right:0;
      }

      :host([invalid]) {
        visibility: visible;
      };
    </style>

    <content></content>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'paper-input-error',

    behaviors: [
      Polymer.PaperInputAddonBehavior
    ],

    properties: {
      /**
       * True if the error is showing.
       */
      invalid: {
        readOnly: true,
        reflectToAttribute: true,
        type: Boolean
      }
    },

    /**
     * This overrides the update function in PaperInputAddonBehavior.
     * @param {{
     *   inputElement: (Element|undefined),
     *   value: (string|undefined),
     *   invalid: boolean
     * }} state -
     *     inputElement: The input element.
     *     value: The input value.
     *     invalid: True if the input value is invalid.
     */
    update: function(state) {
      this._setInvalid(state.invalid);
    }
  });
</script>
<script src="../moment/moment.js"></script>
<iron-iconset-svg name="device" size="24">
<svg><defs>
<g id="access-alarm"><path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path></g>
<g id="access-alarms"><path d="M22 5.7l-4.6-3.9-1.3 1.5 4.6 3.9L22 5.7zM7.9 3.4L6.6 1.9 2 5.7l1.3 1.5 4.6-3.8zM12.5 8H11v6l4.7 2.9.8-1.2-4-2.4V8zM12 4c-5 0-9 4-9 9s4 9 9 9 9-4 9-9-4-9-9-9zm0 16c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7z"></path></g>
<g id="access-time"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"></path></g>
<g id="add-alarm"><path d="M7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm1-11h-2v3H8v2h3v3h2v-3h3v-2h-3V9z"></path></g>
<g id="airplanemode-active"><path d="M10.18 9"></path><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"></path></g>
<g id="airplanemode-inactive"><path d="M13 9V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5v3.68l7.83 7.83L21 16v-2l-8-5zM3 5.27l4.99 4.99L2 14v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-3.73L18.73 21 20 19.73 4.27 4 3 5.27z"></path></g>
<g id="battery-20"><path d="M7 17v3.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V17H7z"></path><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V17h10V5.33z"></path></g>
<g id="battery-30"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V15h10V5.33z"></path><path d="M7 15v5.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V15H7z"></path></g>
<g id="battery-50"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V13h10V5.33z"></path><path d="M7 13v7.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V13H7z"></path></g>
<g id="battery-60"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V11h10V5.33z"></path><path d="M7 11v9.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V11H7z"></path></g>
<g id="battery-80"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V9h10V5.33z"></path><path d="M7 9v11.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V9H7z"></path></g>
<g id="battery-90"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V8h10V5.33z"></path><path d="M7 8v12.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V8H7z"></path></g>
<g id="battery-alert"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4zM13 18h-2v-2h2v2zm0-4h-2V9h2v5z"></path></g>
<g id="battery-charging-20"><path d="M11 20v-3H7v3.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V17h-4.4L11 20z"></path><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V17h4v-2.5H9L13 7v5.5h2L12.6 17H17V5.33C17 4.6 16.4 4 15.67 4z"></path></g>
<g id="battery-charging-30"><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v9.17h2L13 7v5.5h2l-1.07 2H17V5.33C17 4.6 16.4 4 15.67 4z"></path><path d="M11 20v-5.5H7v6.17C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V14.5h-3.07L11 20z"></path></g>
<g id="battery-charging-50"><path d="M14.47 13.5L11 20v-5.5H9l.53-1H7v7.17C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V13.5h-2.53z"></path><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v8.17h2.53L13 7v5.5h2l-.53 1H17V5.33C17 4.6 16.4 4 15.67 4z"></path></g>
<g id="battery-charging-60"><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V11h3.87L13 7v4h4V5.33C17 4.6 16.4 4 15.67 4z"></path><path d="M13 12.5h2L11 20v-5.5H9l1.87-3.5H7v9.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V11h-4v1.5z"></path></g>
<g id="battery-charging-80"><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V9h4.93L13 7v2h4V5.33C17 4.6 16.4 4 15.67 4z"></path><path d="M13 12.5h2L11 20v-5.5H9L11.93 9H7v11.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V9h-4v3.5z"></path></g>
<g id="battery-charging-90"><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V8h5.47L13 7v1h4V5.33C17 4.6 16.4 4 15.67 4z"></path><path d="M13 12.5h2L11 20v-5.5H9L12.47 8H7v12.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V8h-4v4.5z"></path></g>
<g id="battery-charging-full"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4zM11 20v-5.5H9L13 7v5.5h2L11 20z"></path></g>
<g id="battery-full"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z"></path></g>
<g id="battery-std"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z"></path></g>
<g id="battery-unknown"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4zm-2.72 13.95h-1.9v-1.9h1.9v1.9zm1.35-5.26s-.38.42-.67.71c-.48.48-.83 1.15-.83 1.6h-1.6c0-.83.46-1.52.93-2l.93-.94c.27-.27.44-.65.44-1.06 0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5H9c0-1.66 1.34-3 3-3s3 1.34 3 3c0 .66-.27 1.26-.7 1.69z"></path></g>
<g id="bluetooth"><path d="M17.71 7.71L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88z"></path></g>
<g id="bluetooth-connected"><path d="M7 12l-2-2-2 2 2 2 2-2zm10.71-4.29L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88zM19 10l-2 2 2 2 2-2-2-2z"></path></g>
<g id="bluetooth-disabled"><path d="M13 5.83l1.88 1.88-1.6 1.6 1.41 1.41 3.02-3.02L12 2h-1v5.03l2 2v-3.2zM5.41 4L4 5.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l4.29-4.29 2.3 2.29L20 18.59 5.41 4zM13 18.17v-3.76l1.88 1.88L13 18.17z"></path></g>
<g id="bluetooth-searching"><path d="M14.24 12.01l2.32 2.32c.28-.72.44-1.51.44-2.33 0-.82-.16-1.59-.43-2.31l-2.33 2.32zm5.29-5.3l-1.26 1.26c.63 1.21.98 2.57.98 4.02s-.36 2.82-.98 4.02l1.2 1.2c.97-1.54 1.54-3.36 1.54-5.31-.01-1.89-.55-3.67-1.48-5.19zm-3.82 1L10 2H9v7.59L4.41 5 3 6.41 8.59 12 3 17.59 4.41 19 9 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM11 5.83l1.88 1.88L11 9.59V5.83zm1.88 10.46L11 18.17v-3.76l1.88 1.88z"></path></g>
<g id="brightness-auto"><path d="M10.85 12.65h2.3L12 9l-1.15 3.65zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM14.3 16l-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9z"></path></g>
<g id="brightness-high"><path d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"></path></g>
<g id="brightness-low"><path d="M20 15.31L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"></path></g>
<g id="brightness-medium"><path d="M20 15.31L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18V6c3.31 0 6 2.69 6 6s-2.69 6-6 6z"></path></g>
<g id="data-usage"><path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.48 2.54l2.6 1.53c.56-1.24.88-2.62.88-4.07 0-5.18-3.95-9.45-9-9.95zM12 19c-3.87 0-7-3.13-7-7 0-3.53 2.61-6.43 6-6.92V2.05c-5.06.5-9 4.76-9 9.95 0 5.52 4.47 10 9.99 10 3.31 0 6.24-1.61 8.06-4.09l-2.6-1.53C16.17 17.98 14.21 19 12 19z"></path></g>
<g id="developer-mode"><path d="M7 5h10v2h2V3c0-1.1-.9-1.99-2-1.99L7 1c-1.1 0-2 .9-2 2v4h2V5zm8.41 11.59L20 12l-4.59-4.59L14 8.83 17.17 12 14 15.17l1.41 1.42zM10 15.17L6.83 12 10 8.83 8.59 7.41 4 12l4.59 4.59L10 15.17zM17 19H7v-2H5v4c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-4h-2v2z"></path></g>
<g id="devices"><path d="M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"></path></g>
<g id="dvr"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12zm-2-9H8v2h11V8zm0 4H8v2h11v-2zM7 8H5v2h2V8zm0 4H5v2h2v-2z"></path></g>
<g id="gps-fixed"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path></g>
<g id="gps-not-fixed"><path d="M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path></g>
<g id="gps-off"><path d="M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06c-1.13.12-2.19.46-3.16.97l1.5 1.5C10.16 5.19 11.06 5 12 5c3.87 0 7 3.13 7 7 0 .94-.19 1.84-.52 2.65l1.5 1.5c.5-.96.84-2.02.97-3.15H23v-2h-2.06zM3 4.27l2.04 2.04C3.97 7.62 3.25 9.23 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c1.77-.2 3.38-.91 4.69-1.98L19.73 21 21 19.73 4.27 3 3 4.27zm13.27 13.27C15.09 18.45 13.61 19 12 19c-3.87 0-7-3.13-7-7 0-1.61.55-3.09 1.46-4.27l9.81 9.81z"></path></g>
<g id="graphic-eq"><path d="M7 18h2V6H7v12zm4 4h2V2h-2v20zm-8-8h2v-4H3v4zm12 4h2V6h-2v12zm4-8v4h2v-4h-2z"></path></g>
<g id="location-disabled"><path d="M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06c-1.13.12-2.19.46-3.16.97l1.5 1.5C10.16 5.19 11.06 5 12 5c3.87 0 7 3.13 7 7 0 .94-.19 1.84-.52 2.65l1.5 1.5c.5-.96.84-2.02.97-3.15H23v-2h-2.06zM3 4.27l2.04 2.04C3.97 7.62 3.25 9.23 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c1.77-.2 3.38-.91 4.69-1.98L19.73 21 21 19.73 4.27 3 3 4.27zm13.27 13.27C15.09 18.45 13.61 19 12 19c-3.87 0-7-3.13-7-7 0-1.61.55-3.09 1.46-4.27l9.81 9.81z"></path></g>
<g id="location-searching"><path d="M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path></g>
<g id="network-cell"><path fill-opacity=".3" d="M2 22h20V2z"></path><path d="M17 7L2 22h15z"></path></g>
<g id="network-wifi"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"></path><path d="M3.53 10.95l8.46 10.54.01.01.01-.01 8.46-10.54C20.04 10.62 16.81 8 12 8c-4.81 0-8.04 2.62-8.47 2.95z"></path></g>
<g id="nfc"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 18H4V4h16v16zM18 6h-5c-1.1 0-2 .9-2 2v2.28c-.6.35-1 .98-1 1.72 0 1.1.9 2 2 2s2-.9 2-2c0-.74-.4-1.38-1-1.72V8h3v8H8V8h2V6H6v12h12V6z"></path></g>
<g id="screen-lock-landscape"><path d="M21 5H3c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-2 12H5V7h14v10zm-9-1h4c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1v-1c0-1.11-.9-2-2-2-1.11 0-2 .9-2 2v1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm.8-6c0-.66.54-1.2 1.2-1.2.66 0 1.2.54 1.2 1.2v1h-2.4v-1z"></path></g>
<g id="screen-lock-portrait"><path d="M10 16h4c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1v-1c0-1.11-.9-2-2-2-1.11 0-2 .9-2 2v1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm.8-6c0-.66.54-1.2 1.2-1.2.66 0 1.2.54 1.2 1.2v1h-2.4v-1zM17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 18H7V5h10v14z"></path></g>
<g id="screen-lock-rotation"><path d="M23.25 12.77l-2.57-2.57-1.41 1.41 2.22 2.22-5.66 5.66L4.51 8.17l5.66-5.66 2.1 2.1 1.41-1.41L11.23.75c-.59-.59-1.54-.59-2.12 0L2.75 7.11c-.59.59-.59 1.54 0 2.12l12.02 12.02c.59.59 1.54.59 2.12 0l6.36-6.36c.59-.59.59-1.54 0-2.12zM8.47 20.48C5.2 18.94 2.86 15.76 2.5 12H1c.51 6.16 5.66 11 11.95 11l.66-.03-3.81-3.82-1.33 1.33zM16 9h5c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1v-.5C21 1.12 19.88 0 18.5 0S16 1.12 16 2.5V3c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1zm.8-6.5c0-.94.76-1.7 1.7-1.7s1.7.76 1.7 1.7V3h-3.4v-.5z"></path></g>
<g id="screen-rotation"><path d="M16.48 2.52c3.27 1.55 5.61 4.72 5.97 8.48h1.5C23.44 4.84 18.29 0 12 0l-.66.03 3.81 3.81 1.33-1.32zm-6.25-.77c-.59-.59-1.54-.59-2.12 0L1.75 8.11c-.59.59-.59 1.54 0 2.12l12.02 12.02c.59.59 1.54.59 2.12 0l6.36-6.36c.59-.59.59-1.54 0-2.12L10.23 1.75zm4.6 19.44L2.81 9.17l6.36-6.36 12.02 12.02-6.36 6.36zm-7.31.29C4.25 19.94 1.91 16.76 1.55 13H.05C.56 19.16 5.71 24 12 24l.66-.03-3.81-3.81-1.33 1.32z"></path></g>
<g id="sd-storage"><path d="M18 2h-8L4.02 8 4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-6 6h-2V4h2v4zm3 0h-2V4h2v4zm3 0h-2V4h2v4z"></path></g>
<g id="settings-system-daydream"><path d="M9 16h6.5c1.38 0 2.5-1.12 2.5-2.5S16.88 11 15.5 11h-.05c-.24-1.69-1.69-3-3.45-3-1.4 0-2.6.83-3.16 2.02h-.16C7.17 10.18 6 11.45 6 13c0 1.66 1.34 3 3 3zM21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16.01H3V4.99h18v14.02z"></path></g>
<g id="signal-cellular-0-bar"><path fill-opacity=".3" d="M2 22h20V2z"></path></g>
<g id="signal-cellular-1-bar"><path fill-opacity=".3" d="M2 22h20V2z"></path><path d="M12 12L2 22h10z"></path></g>
<g id="signal-cellular-2-bar"><path fill-opacity=".3" d="M2 22h20V2z"></path><path d="M14 10L2 22h12z"></path></g>
<g id="signal-cellular-3-bar"><path fill-opacity=".3" d="M2 22h20V2z"></path><path d="M17 7L2 22h15z"></path></g>
<g id="signal-cellular-4-bar"><path d="M2 22h20V2z"></path></g>
<g id="signal-cellular-connected-no-internet-0-bar"><path fill-opacity=".3" d="M22 8V2L2 22h16V8z"></path><path d="M20 22h2v-2h-2v2zm0-12v8h2v-8h-2z"></path></g>
<g id="signal-cellular-connected-no-internet-1-bar"><path fill-opacity=".3" d="M22 8V2L2 22h16V8z"></path><path d="M20 10v8h2v-8h-2zm-8 12V12L2 22h10zm8 0h2v-2h-2v2z"></path></g>
<g id="signal-cellular-connected-no-internet-2-bar"><path fill-opacity=".3" d="M22 8V2L2 22h16V8z"></path><path d="M14 22V10L2 22h12zm6-12v8h2v-8h-2zm0 12h2v-2h-2v2z"></path></g>
<g id="signal-cellular-connected-no-internet-3-bar"><path fill-opacity=".3" d="M22 8V2L2 22h16V8z"></path><path d="M17 22V7L2 22h15zm3-12v8h2v-8h-2zm0 12h2v-2h-2v2z"></path></g>
<g id="signal-cellular-connected-no-internet-4-bar"><path d="M20 18h2v-8h-2v8zm0 4h2v-2h-2v2zM2 22h16V8h4V2L2 22z"></path></g>
<g id="signal-cellular-no-sim"><path d="M18.99 5c0-1.1-.89-2-1.99-2h-7L7.66 5.34 19 16.68 18.99 5zM3.65 3.88L2.38 5.15 5 7.77V19c0 1.1.9 2 2 2h10.01c.35 0 .67-.1.96-.26l1.88 1.88 1.27-1.27L3.65 3.88z"></path></g>
<g id="signal-cellular-null"><path d="M20 6.83V20H6.83L20 6.83M22 2L2 22h20V2z"></path></g>
<g id="signal-cellular-off"><path d="M21 1l-8.59 8.59L21 18.18V1zM4.77 4.5L3.5 5.77l6.36 6.36L1 21h17.73l2 2L22 21.73 4.77 4.5z"></path></g>
<g id="signal-wifi-0-bar"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"></path></g>
<g id="signal-wifi-1-bar"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"></path><path d="M6.67 14.86L12 21.49v.01l.01-.01 5.33-6.63C17.06 14.65 15.03 13 12 13s-5.06 1.65-5.33 1.86z"></path></g>
<g id="signal-wifi-1-bar-lock"><path d="M23 16v-1.5c0-1.4-1.1-2.5-2.5-2.5S18 13.1 18 14.5V16c-.5 0-1 .5-1 1v4c0 .5.5 1 1 1h5c.5 0 1-.5 1-1v-4c0-.5-.5-1-1-1zm-1 0h-3v-1.5c0-.8.7-1.5 1.5-1.5s1.5.7 1.5 1.5V16z"></path><path d="M15.5 14.5c0-2.8 2.2-5 5-5 .4 0 .7 0 1 .1L23.6 7c-.4-.3-4.9-4-11.6-4C5.3 3 .8 6.7.4 7L12 21.5l3.5-4.3v-2.7z" opacity=".3"></path><path d="M6.7 14.9l5.3 6.6 3.5-4.3v-2.6c0-.2 0-.5.1-.7-.9-.5-2.2-.9-3.6-.9-3 0-5.1 1.7-5.3 1.9z"></path></g>
<g id="signal-wifi-2-bar"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"></path><path d="M4.79 12.52l7.2 8.98H12l.01-.01 7.2-8.98C18.85 12.24 16.1 10 12 10s-6.85 2.24-7.21 2.52z"></path></g>
<g id="signal-wifi-2-bar-lock"><path d="M23 16v-1.5c0-1.4-1.1-2.5-2.5-2.5S18 13.1 18 14.5V16c-.5 0-1 .5-1 1v4c0 .5.5 1 1 1h5c.5 0 1-.5 1-1v-4c0-.5-.5-1-1-1zm-1 0h-3v-1.5c0-.8.7-1.5 1.5-1.5s1.5.7 1.5 1.5V16z"></path><path d="M15.5 14.5c0-2.8 2.2-5 5-5 .4 0 .7 0 1 .1L23.6 7c-.4-.3-4.9-4-11.6-4C5.3 3 .8 6.7.4 7L12 21.5l3.5-4.3v-2.7z" opacity=".3"></path><path d="M4.8 12.5l7.2 9 3.5-4.4v-2.6c0-1.3.5-2.5 1.4-3.4C15.6 10.5 14 10 12 10c-4.1 0-6.8 2.2-7.2 2.5z"></path></g>
<g id="signal-wifi-3-bar"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"></path><path d="M3.53 10.95l8.46 10.54.01.01.01-.01 8.46-10.54C20.04 10.62 16.81 8 12 8c-4.81 0-8.04 2.62-8.47 2.95z"></path></g>
<g id="signal-wifi-3-bar-lock"><path opacity=".3" d="M12 3C5.3 3 .8 6.7.4 7l3.2 3.9L12 21.5l3.5-4.3v-2.6c0-2.2 1.4-4 3.3-4.7.3-.1.5-.2.8-.2.3-.1.6-.1.9-.1.4 0 .7 0 1 .1L23.6 7c-.4-.3-4.9-4-11.6-4z"></path><path d="M23 16v-1.5c0-1.4-1.1-2.5-2.5-2.5S18 13.1 18 14.5V16c-.5 0-1 .5-1 1v4c0 .5.5 1 1 1h5c.5 0 1-.5 1-1v-4c0-.5-.5-1-1-1zm-1 0h-3v-1.5c0-.8.7-1.5 1.5-1.5s1.5.7 1.5 1.5V16zm-10 5.5l3.5-4.3v-2.6c0-2.2 1.4-4 3.3-4.7C17.3 9 14.9 8 12 8c-4.8 0-8 2.6-8.5 2.9"></path></g>
<g id="signal-wifi-4-bar"><path d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"></path></g>
<g id="signal-wifi-4-bar-lock"><path d="M23 16v-1.5c0-1.4-1.1-2.5-2.5-2.5S18 13.1 18 14.5V16c-.5 0-1 .5-1 1v4c0 .5.5 1 1 1h5c.5 0 1-.5 1-1v-4c0-.5-.5-1-1-1zm-1 0h-3v-1.5c0-.8.7-1.5 1.5-1.5s1.5.7 1.5 1.5V16zm-6.5-1.5c0-2.8 2.2-5 5-5 .4 0 .7 0 1 .1L23.6 7c-.4-.3-4.9-4-11.6-4C5.3 3 .8 6.7.4 7L12 21.5l3.5-4.4v-2.6z"></path></g>
<g id="signal-wifi-off"><path d="M23.64 7c-.45-.34-4.93-4-11.64-4-1.5 0-2.89.19-4.15.48L18.18 13.8 23.64 7zm-6.6 8.22L3.27 1.44 2 2.72l2.05 2.06C1.91 5.76.59 6.82.36 7l11.63 14.49.01.01.01-.01 3.9-4.86 3.32 3.32 1.27-1.27-3.46-3.46z"></path></g>
<g id="storage"><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"></path></g>
<g id="usb"><path d="M15 7v4h1v2h-3V5h2l-3-4-3 4h2v8H8v-2.07c.7-.37 1.2-1.08 1.2-1.93 0-1.21-.99-2.2-2.2-2.2-1.21 0-2.2.99-2.2 2.2 0 .85.5 1.56 1.2 1.93V13c0 1.11.89 2 2 2h3v3.05c-.71.37-1.2 1.1-1.2 1.95 0 1.22.99 2.2 2.2 2.2 1.21 0 2.2-.98 2.2-2.2 0-.85-.49-1.58-1.2-1.95V15h3c1.11 0 2-.89 2-2v-2h1V7h-4z"></path></g>
<g id="wallpaper"><path d="M4 4h7V2H4c-1.1 0-2 .9-2 2v7h2V4zm6 9l-4 5h12l-3-4-2.03 2.71L10 13zm7-4.5c0-.83-.67-1.5-1.5-1.5S14 7.67 14 8.5s.67 1.5 1.5 1.5S17 9.33 17 8.5zM20 2h-7v2h7v7h2V4c0-1.1-.9-2-2-2zm0 18h-7v2h7c1.1 0 2-.9 2-2v-7h-2v7zM4 13H2v7c0 1.1.9 2 2 2h7v-2H4v-7z"></path></g>
<g id="widgets"><path d="M13 13v8h8v-8h-8zM3 21h8v-8H3v8zM3 3v8h8V3H3zm13.66-1.31L11 7.34 16.66 13l5.66-5.66-5.66-5.65z"></path></g>
<g id="wifi-lock"><path d="M20.5 9.5c.28 0 .55.04.81.08L24 6c-3.34-2.51-7.5-4-12-4S3.34 3.49 0 6l12 16 3.5-4.67V14.5c0-2.76 2.24-5 5-5zM23 16v-1.5c0-1.38-1.12-2.5-2.5-2.5S18 13.12 18 14.5V16c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h5c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1zm-1 0h-3v-1.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V16z"></path></g>
<g id="wifi-tethering"><path d="M12 11c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 2c0-3.31-2.69-6-6-6s-6 2.69-6 6c0 2.22 1.21 4.15 3 5.19l1-1.74c-1.19-.7-2-1.97-2-3.45 0-2.21 1.79-4 4-4s4 1.79 4 4c0 1.48-.81 2.75-2 3.45l1 1.74c1.79-1.04 3-2.97 3-5.19zM12 3C6.48 3 2 7.48 2 13c0 3.7 2.01 6.92 4.99 8.65l1-1.73C5.61 18.53 4 15.96 4 13c0-4.42 3.58-8 8-8s8 3.58 8 8c0 2.96-1.61 5.53-4 6.92l1 1.73c2.99-1.73 5-4.95 5-8.65 0-5.52-4.48-10-10-10z"></path></g>
</defs></svg>
</iron-iconset-svg>


<script>

  Polymer({

    is: 'slide-from-left-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;

      this._effect = new KeyframeEffect(node, [
        {'transform': 'translateX(-100%)'},
        {'transform': 'none'}
      ], this.timingFromConfig(config));

      if (config.transformOrigin) {
        this.setPrefixedProperty(node, 'transformOrigin', config.transformOrigin);
      } else {
        this.setPrefixedProperty(node, 'transformOrigin', '0 50%');
      }

      return this._effect;
    }

  });

</script>

<script>

  Polymer({

    is: 'slide-from-right-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;

      this._effect = new KeyframeEffect(node, [
        {'transform': 'translateX(100%)'},
        {'transform': 'none'}
      ], this.timingFromConfig(config));

      if (config.transformOrigin) {
        this.setPrefixedProperty(node, 'transformOrigin', config.transformOrigin);
      } else {
        this.setPrefixedProperty(node, 'transformOrigin', '0 50%');
      }

      return this._effect;
    }

  });

</script>

<script>

  Polymer({

    is: 'fade-in-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;
      this._effect = new KeyframeEffect(node, [
        {'opacity': '0'},
        {'opacity': '1'}
      ], this.timingFromConfig(config));
      return this._effect;
    }

  });

</script><script>
Polymer.TriPlatCalendarBehavior = {

  addDays: function(d, days) {
   var newDate = this.clone(d);
   newDate.setDate(d.getDate() + days);
   return newDate;
 },

 addMonths: function(d, months) {
   var newDate = this.clone(d);
   newDate.setMonth(d.getMonth() + months);
   return newDate;
 },

 clone: function(d) {
   var year = d.getFullYear(), 
    month = d.getMonth();
    d = new Date(year, month, 1);
   return new Date(d.getTime());
 },

 getDaysInMonth: function(d) {
   var resultDate = this.getFirstDayOfMonth(d);
   resultDate.setMonth(resultDate.getMonth() + 1);
   resultDate.setDate(resultDate.getDate() - 1);
   return resultDate.getDate();
 },

 getFirstDayOfMonth: function(d) {
   return new Date(d.getFullYear(), d.getMonth(), 1);
 },

 getWeekArray: function(d) {
   var dayArray = [];
   var daysInMonth = this.getDaysInMonth(d);
   var daysInWeek;
   var emptyDays;
   var firstDayOfWeek;
   var week;
   var weekArray = [];

   for (var i = 1; i <= daysInMonth; i++) {
     dayArray.push(new Date(d.getFullYear(), d.getMonth(), i));
   };

   while (dayArray.length) {
    firstDayOfWeek = dayArray[0].getDay();
    daysInWeek = 7 - firstDayOfWeek;
    emptyDays = 7 - daysInWeek;
    week = dayArray.splice(0, daysInWeek);

    for (var i = 0; i < emptyDays; i++) {
      week.unshift(null);
    };

    weekArray.push(week);
  }

  return weekArray;
},

  isEqualDate: function(d1, d2) {
 return d1 && d2 &&
 (d1.getFullYear() === d2.getFullYear()) &&
 (d1.getMonth() === d2.getMonth()) &&
 (d1.getDate() === d2.getDate());
},

isEqualMonth: function(d1, d2) {
 return d1 && d2 &&
 (d1.getFullYear() === d2.getFullYear()) &&
 (d1.getMonth() === d2.getMonth());
},

monthDiff: function(d1, d2) {
  var m;
  m = (d1.getFullYear() - d2.getFullYear()) * 12;
  m += d1.getMonth();
  m -= d2.getMonth();
  return m;
}
}
</script><dom-module id="triplat-calendar-weeks" assetpath="../triplat-date-picker/">
<style include="iron-flex iron-flex-alignment">

	#days {
		position: relative;
		overflow: hidden;
	}

	.weeks {
		padding: 0 12px;
	}

	.day {
		width: 30px;
		height: 25.5px;
		margin:5.5px 3px 5px 3px;
		position: relative;
		cursor: pointer;
		background-color: white;
		font-weight: 500;
	} 

	.day[disabled] {
		cursor: not-allowed;
		color: var(--triplat-date-picker-disabled-color, --ibm-gray-50);
	}

	.day[selected]:after {
		content: '';
		/*border-radius: 5px;*/
		position: absolute;
		top: 3px;
		right: 3px;
		bottom: 3px;
		left: 3px;
		z-index: 0;
		background: var(--triplat-date-picker-selected-bg-color, --tri-primary-color-10);
	}

	.day div {
		z-index: 1;
		transition: all .2s;
		-webkit-transition: all .2s;
	}

	.day[selected] {
		font-weight: 500;
	}

	.day:hover {
		background: var(--ibm-gray-10);
	}

	.day[today]:not([selected]) {
		color: rgb(255, 255, 255);
	}

	.day[today]:not([selected]):after {
		content:'';
		position: absolute;
		top: 3px;
		right: 3px;
		bottom: 3px;
		left: 3px;
		z-index: 0;
		background-color: var(--tri-primary-color-70);
	}

	.inner-day{
		user-select: none;
	}

	@media all and (min-width: 1280px) {

	  ._day {
	  	width: 90px;
	  	font-size: 20px;
	  	height: 36px;
	  	margin: 5px;
	  }
	}
	@media all and (min-width: 800px) and (max-width: 1279px) {

	  ._day {
	  	width: 65px;
	  	font-size: 16px;
	  	height: 30px;
	  	margin: 5px;
	  }
	}
	@media all and (max-width: 799px) {

	  ._day {
	  	width: 40px;
	  	font-size: 14px;
	  	height: 24px;
	  	margin: 5px;
	  }
	}

</style>
<template>

	<div id="days">
		<div class="weeks">
			<div class="layout horizontal wrap">
				<template id="weeksDomRepeat" is="dom-repeat" as="week" index-as="w">
					<template is="dom-repeat" items="{{week}}" as="day" index-as="d" on-dom-change="_handleDomChange">
						<div class="layout horizontal center-justified day" disabled$="{{!_computeDaySelectable(w, d, week)}}" selected$="{{_computeIsSelected(w, d, week, selectedDate)}}" today$="{{_computeIsToday(w, d, week)}}" data-w$="{{w}}" data-d$="{{d}}" on-tap="_selectDay" tabindex$="{{_computeTabIndex(w, d, week,selectedDate)}}">
							<div class="inner-day layout horizontal center">{{day}}</div>
						</div>
					</template>
				</template>
			</div>

		</div>
	</div>

</template>
</dom-module>
<script>
Polymer({
	
	is: "triplat-calendar-weeks",

	/**
	  * Fired when the calendar changes.
	  *
	  * @event calendar-weeks-changed
	  */

	
	behaviors: [
		Polymer.TriPlatCalendarBehavior
	],

	listeners: {
    'track': '_handleTrack',
  	},
	
	properties: {
		date: {
			type: String,
			observer: "_handleDateChanged"
		},

		selectedDate: {
			type: Date
		},

		selectedBox: {
			type: Object
		},

		weeks: {
			type: Array
		},

		disallowPastDates: {
			type: Boolean,
			value: false,
		},

		disallowWeekends: {
			type: Boolean,
			value: false,
		},

		restrictToDateList: {
			type: Boolean,
			value: false,
		},

		validDateList: {
			type: Array
		},

		validDateListForMonth: {
			type: Array
		},

		confirmButtons:{
			type: Boolean,
			value: false
		}
	},

	created: function() {
		this.nowDate = new Date();
	},
	
	_handleDateChanged: function(date) {
		this.$.weeksDomRepeat.items = this._getWeeks(date);
		this.$.weeksDomRepeat.render();
	},

	_handleDomChange: function() {
		this.fire('calendar-weeks-changed');
	},

	isSameDay: function(d1, d2) {
		return this.isEqualDate(d1, d2);
	},

	isSameMonth: function(d1, d2) {
		return this.isEqualMonth(d1, d2);
	},

	_computeDaySelectable: function(week, day) {
		var thisDate = this.weeksFull[week][day];
		if (thisDate == null)
			return false;

		var isDaySelectable = true;

		if (this.disallowPastDates)
			isDaySelectable = this._isDayInFuture(thisDate);

		if (this.restrictToDateList) {
			if (isDaySelectable) {
				isDaySelectable = this._isValidMoveDate(thisDate);
			}
		} else {
			if (isDaySelectable && this.disallowWeekends) {
				isDaySelectable = !this._isWeekendDay(thisDate);
			}
		}

		if(this.triplatCalendarContainer){
			var dayDOMs = Polymer.dom(this.root).querySelectorAll(".day");
			this.async(function(){
				for(var i=0; i<dayDOMs.length; i++){
					dayDOMs[i].classList.add("_day");
				}
			});
		}

		return isDaySelectable;
	},

	_isDayInFuture: function(thisDate) {
		var nowDate = this.nowDate;
		var isDayInFuture = false;

		if (thisDate && nowDate) {
			isDayInFuture = thisDate.getFullYear() > nowDate.getFullYear() ||
							(thisDate.getFullYear() == nowDate.getFullYear() &&
								thisDate.getMonth() > nowDate.getMonth()) ||
							(thisDate.getFullYear() == nowDate.getFullYear() &&
								thisDate.getMonth() == nowDate.getMonth() &&
								thisDate.getDate() > nowDate.getDate());
		}

		return isDayInFuture;
	},

	_isWeekDay: function(thisDate) {
		var isWeekDay = false;

		if (thisDate) {
			isWeekDay = (thisDate.getDay() > 0 && thisDate.getDay() < 6);
		}

		return isWeekDay;
	},

	_isWeekendDay: function(thisDate) {
		var isWeekendDay = false;

		if (thisDate) {
			isWeekendDay = (thisDate.getDay() == 0 || thisDate.getDay() == 6);
		}

		return isWeekendDay;
	},

	_isValidMoveDate: function(thisDate) {
		var isValidMoveDate = false;
		var moveDates = this.validDateListForMonth;
		if (!moveDates || moveDates.length == 0)
			return false;

		if (thisDate) {
			for(i=0;i<moveDates.length;i++) {
				var moveDate = moveDates[i];
				if (this.isSameDay(thisDate, moveDate))
					return true;
			}
		}

		return isValidMoveDate;
	},

	_computeIsSelected: function(week, day) {
		if (!this.weeksFull)
			this.weeksFull = this.getWeekArray(this.date);

		var thisDate = this.weeksFull[week][day];
		if (this.selectedDate == null || thisDate == null)
			return false;

		var isSameDay = this.isSameDay(thisDate, this.selectedDate);
		return isSameDay;
	},

	_computeIsToday: function(week, day) {
		if (!this.weeksFull)
			this.weeksFull = this.getWeekArray(this.date);

		var thisDate = this.weeksFull[week][day];
		if (this.nowDate == null || thisDate == null)
			return false;

		var isSameDay = this.isSameDay(thisDate, this.nowDate);
		return isSameDay;
	},

	_getWeeks: function(date) {
		this.weeksFull = this.getWeekArray(this.date);
		var weeks = this.getWeekArray(this.date).map(function(week) {
			if (!week || week == null) return null;
			
			return week.map(function(day) {
				return day ? day.getDate() : null;
			})
		});
		this.async(function(){
			if (this.restrictToDateList) {
				this.validDateListForMonth = this._getValidDateListForMonth(date.getMonth());
			}
		});
		return weeks;
	},

	_getValidDateListForMonth: function(month) {
		var validDateListForMonth = [];
		var validDateList = this.validDateList;
		if (validDateList) {
			validDateList.forEach(function(date) {
				if (date && date.getMonth() == month) {
					validDateListForMonth.push(date);
				}
			});
		}

		return validDateListForMonth;
	},

	_selectDay: function(e) {
		var target = ( e.target.getAttribute("data-w") ) ? e.target : e.target.parentElement;
		var wIndex = target.getAttribute("data-w");
		var dIndex = target.getAttribute("data-d");

		var isDisabled = target.getAttribute("disabled");
		if (isDisabled != undefined)
			return;

		var selectedDate = this.weeksFull[wIndex][dIndex];
		if (selectedDate) {
			this.set("selectedDate", selectedDate);
			this.fire('triplat-calendar-date-selected', {date: selectedDate});
			if(!this.confirmButtons){
				this.fire('triplat-calendar-date-selected-without-confirm-buttons', {date: selectedDate});
			}
		}
	},

	_handleTrack: function(e){
		switch(e.detail.state) {
	      case 'track':
	        this.transform('translate3d(' + e.detail.dx + 'px, 0, 0)', this.target);
	        break;
	      case 'end':
	      	var direction = e.detail.dx > 0 ? 1 : -1;
	        if (Math.abs(e.detail.dx) >= 0) {
		      this._swipe(direction);
		    }
	        break;
    	}
	}, 

	_computeTabIndex: function(w, d, week, selectedDate) {
		var isSelected = this._computeIsSelected(w, d, week, selectedDate);
		if (isSelected) {
			return 0;
		}
		var isSelectable = this._computeDaySelectable(w, d, week);
		if (isSelectable) {
			return 0;
		} 
		return -1;
	},

	_swipe: function(_direction) {
	    this.transform('translate3d(0px, 0, 0)', this.target);
	    this.fire('swipe-away', {direction: _direction});
 	 },
});
</script><dom-module id="triplat-calendar-years" assetpath="../triplat-date-picker/">
<style include="iron-flex iron-flex-alignment">
#header {
  position: relative;
  overflow: hidden;
} 
#years {
  box-sizing: border-box;
  height: 200px;
  max-width: 100%;
  padding: 6px;
  overflow: auto; 
}
.year {
  width: 33.333%;
  text-align: center;
  font-weight: 500;
  font-size: 14px;
  line-height: 36px;
}
.year paper-button {
  display: block;
  width: 100%;
  margin: 0;
  font-size: 16px;
  font-family: var(--tri-font-family);
}
.year paper-button:hover {
  background-color: var(--ibm-gray-10);
}
#viewingMonthYear {
  overflow: hidden;
}
.viewingMonthYear {
  margin: 0;
  font-size: 20px;
  font-weight: normal;
  line-height: 48px;
  letter-spacing: 0.02em;
  text-align: center;
}

.selectedYear:after {
  content: '';
  /*border-radius: 50%;*/
  /*border-radius: 5px;*/
  position: absolute;
  top: 3px;
  right: 3px;
  bottom: 3px;
  left: 3px;
  z-index: 0;
  background-color: var(--triplat-date-picker-selected-bg-color, --tri-primary-color-10);
  opacity: 0.5;
}

.selectedYear {
  font-weight: bold;
}

.actionButton{
  color: var(--triplat-date-picker-button-color, --tri-primary-button-background-color);
  background-color: rgb(255, 255, 255);
  font-weight: bold;
}

paper-button.actionButton {
  color: var(--triplat-date-picker-button-color, --tri-primary-button-background-color);
  background-color: rgb(255, 255, 255);
      --paper-button-flat-keyboard-focus: {
      border-style: solid;
      border-color: var(--triplat-date-picker-button-color, --tri-primary-button-background-color);
      border-width: 1px;
    }

}

paper-button:not([raised]).paper-button-2.keyboard-focus{
    color: var(--triplat-date-picker-button-color, --tri-primary-button-background-color);
    background-color: rgb(255, 255, 255);
    --paper-button-flat-keyboard-focus: {
      border-width: 1px;
      border-style: solid;
      border-color: black;
    }
}

paper-button[year] {
  background-color: rgb(255, 255, 255);
  color: black;
  --paper-button-flat-keyboard-focus: {
    border-width: 1px;
    border-style: solid;
    border-color: black;
  }
}

.paper-icon-button-rtl {
	transform: scaleX(-1);
}

#nextYearArrow, #previousYearArrow {
  --iron-icon-fill-color: var(--triplat-date-picker-icon-color, --tri-primary-icon-button-color);
}

</style>

<template> 
  <div id="header" class="layout horizontal">
    <paper-icon-button id="previousYearArrow" icon="ibm-glyphs:backward" title="previous years" on-tap="_prevAction"></paper-icon-button>
    <div class="flex relative" id="viewingMonthYear">
      <h4 class="viewingMonthYear">
        <span>Year</span>
      </h4>
    </div>
    <paper-icon-button id="nextYearArrow" icon="ibm-glyphs:forward" title="next years" on-tap="_nextAction"></paper-icon-button>
  </div>

  <div id="years" class="layout horizontal wrap">
    <template is="dom-repeat" items="{{yearsArray}}" as="year">
      <div class="year layout horizontal center center-justified" year="{{year}}">
          <paper-button year$="{{year}}" class$="{{_currentlySelectedYear(year)}}" on-tap="_yearSelected" recenteringtouch="">{{year}}</paper-button>
      </div>  
    </template>
  </div>
<template is="dom-if" if="{{confirmButtons}}">
 <template is="dom-if" if="{{!triplatCalendarContainer}}">
  <div class="buttons layout horizontal end-justified">
    <paper-button class="actionButton" on-tap="_handleOk">OK</paper-button>
    <paper-button class="actionButton" on-tap="_handleCancel">Cancel</paper-button>
  </div>
   </template>
</template>

</template>

</dom-module>
<script>
Polymer({

  is: "triplat-calendar-years",
 
  behaviors: [ Polymer.TriPlatCalendarBehavior,
               Polymer.NeonAnimationRunnerBehavior
   ],

  listeners: {
    'track': '_handleTrack',
  },

  properties : {
    
    startYear: {
      type: String
    },
  
    /* number of years to display simultaneously in the panel where you can select a year
     */
    years: {
      type: String
    },
  
    yearsArray: {
      type: Array,
      notify: true,
      value: []
    },
  
    viewingYear: {
      type: String,
      observer: "currentYearChanged"
    },

    selectedYear: {
      type: String
    },

    prevSelectedElement: {
      type: Object,
      value: null
    },

    selectedElement: {
      type: Object,
      value: null
    },

    triplatCalendarContainer: {
      type: Boolean,
      value: false
    },

    confirmButtons: {
      type: Boolean,
      value: false
    },

    animationConfig: {
        value: function() {
          return {
            'previous': [
              {
                name: 'slide-from-left-animation',
                node: this.$.years,
              },
              {
                name: 'fade-in-animation',
                node: this.$.years,
              }
            ],
            'next': [ 
              {
                name: 'slide-from-right-animation',
                node: this.$.years,
              },
              {
                name: 'fade-in-animation',
                node: this.$.years,
              }
            ]
          }
        }
    }

  },


_prevAction: function() {
  this.startYear = this.startYear - this.years;
  this._buildYearsArray(this.startYear);
  this.playAnimation('previous'); 
},

_nextAction: function() {
  this.startYear = this.startYear + this.years;
  this._buildYearsArray(this.startYear);
  this.playAnimation('next'); 
},

_returnAction: function() {
  this.fire('triplat-calendar-date-selected');
},

_handleCancel: function() {
  this.fire('triplat-calendar-date-selected', {view: 'dateView'});
  this.startYear = this.viewingYear - 2;
  this._buildYearsArray(this.startYear);
 },

_handleOk: function() {
  this.fire('triplat-calendar-year-selected', {year: this.selectedYear});
},

_buildYearsArray: function(firstYear) {
  for (var i = 0; i < this.years; i++) {
      this.pop('yearsArray');
  }
  for (var i = 0; i < this.years; i++) {
    this.push('yearsArray', firstYear + i);
  }
  this._setSelectedYear(this.selectedElement, this.viewingYear);
},

ready: function(){
 var now = this.viewingYear || new Date().getFullYear();
 this.startYear = this.startYear || now - 2;
 this.years = this.years || 9;
 this._buildYearsArray(this.startYear);
},

attached: function(){
  var _tempYearsArray = this.yearsArray;
  this.yearsArray = [];
  this.yearsArray = _tempYearsArray;
  var textDirectionValue = document.querySelector('body').getAttribute('dir');
  if(textDirectionValue==="rtl"){
		this.$.previousYearArrow.classList.add('paper-icon-button-rtl');
		this.$.nextYearArrow.classList.add('paper-icon-button-rtl');
	}
},

yearsChanged: function() {
 this.yearsArray = Array(this.years);
},

_setSelectedYear: function(newElement, newYear) {
  this.prevSelectedElement =  this.$$(".selectedYear");
  this.selectedElement = newElement;
  if (this.prevSelectedElement != null) {
    this.prevSelectedElement.classList.remove("selectedYear");
  }
  if (this.selectedElement != null) {
    if(Number(newYear) === Number(this.selectedElement.getAttribute('year'))){
       this.selectedElement.classList.add("selectedYear");
    }
  }
  this.selectedYear = newYear;
},

/* function is called when the user selects a year
 */
_yearSelected: function(e) {
  var yr = e.currentTarget.getAttribute("year");
  var element = this.$$('[year="' + yr + '"]');
  if(this.triplatCalendarContainer || !this.confirmButtons){
    if(Number(element.getAttribute("year")) === this.selectedYear){
      this._handleCancel();
      return false;
    }else{
        
      this._setSelectedYear(element, yr);
      this._handleOk();
    }
    
  }

  this._setSelectedYear(element, yr);

},

/* function is used to determine whether the value input is the year currently selected
 */
_currentlySelectedYear: function(val) {
  if (val == this.viewingYear) {
    return "selectedYear tri-disable-theme";
  } 
  return "tri-disable-theme";
},

currentYearChanged: function() {
  var newElement = this.$$('[year="' + this.viewingYear + '"]');
  if(!this.selectedYear){
    this.selectedYear = new Date().getFullYear();
  }
  this.startYear = this.selectedYear - 2;
  this._buildYearsArray(this.startYear);
  this._setSelectedYear(newElement, this.viewingYear);


},
_resetToCurrentYear: function(year){
  this.selectedYear = year;
  this.viewingYear = year;
  this.fire('triplat-calendar-year-selected', {year: this.selectedYear});
  this.startYear = year - 2;
  this._buildYearsArray(this.startYear);

},

_handleTrack: function(e){
  this.debounce('_handleTrack', function() {
    switch(e.detail.state) {
      case 'start':
      case 'end':
          var direction = e.detail.dx > 0 ? 1 : -1;
          if (direction >= 0) {
            this._prevAction();
          } else {
            this._nextAction();
          }
          break;
  }}, 100);
} 

});
</script><script src="../moment/moment.js"></script>




<script>
  /**
  Polymer.IronFormElementBehavior enables a custom element to be included
  in an `iron-form`.

  @demo demo/index.html
  @polymerBehavior
  */
  Polymer.IronFormElementBehavior = {

    properties: {
      /**
       * Fired when the element is added to an `iron-form`.
       *
       * @event iron-form-element-register
       */

      /**
       * Fired when the element is removed from an `iron-form`.
       *
       * @event iron-form-element-unregister
       */

      /**
       * The name of this element.
       */
      name: {
        type: String
      },

      /**
       * The value for this element.
       */
      value: {
        notify: true,
        type: String
      },

      /**
       * Set to true to mark the input as required. If used in a form, a
       * custom element that uses this behavior should also use
       * Polymer.IronValidatableBehavior and define a custom validation method.
       * Otherwise, a `required` element will always be considered valid.
       * It's also strongly recommended to provide a visual style for the element
       * when its value is invalid.
       */
      required: {
        type: Boolean,
        value: false
      },

      /**
       * The form that the element is registered to.
       */
      _parentForm: {
        type: Object
      }
    },

    attached: function() {
      // Note: the iron-form that this element belongs to will set this
      // element's _parentForm property when handling this event.
      this.fire('iron-form-element-register');
    },

    detached: function() {
      if (this._parentForm) {
        this._parentForm.fire('iron-form-element-unregister', {target: this});
      }
    }

  };

</script><script>
  /**
   * Singleton IronMeta instance.
   */
  Polymer.IronValidatableBehaviorMeta = null;

  /**
   * `Use Polymer.IronValidatableBehavior` to implement an element that validates user input.
   * Use the related `Polymer.IronValidatorBehavior` to add custom validation logic to an iron-input.
   *
   * By default, an `<iron-form>` element validates its fields when the user presses the submit button.
   * To validate a form imperatively, call the form's `validate()` method, which in turn will
   * call `validate()` on all its children. By using `Polymer.IronValidatableBehavior`, your
   * custom element will get a public `validate()`, which
   * will return the validity of the element, and a corresponding `invalid` attribute,
   * which can be used for styling.
   *
   * To implement the custom validation logic of your element, you must override
   * the protected `_getValidity()` method of this behaviour, rather than `validate()`.
   * See [this](https://github.com/PolymerElements/iron-form/blob/master/demo/simple-element.html)
   * for an example.
   *
   * ### Accessibility
   *
   * Changing the `invalid` property, either manually or by calling `validate()` will update the
   * `aria-invalid` attribute.
   *
   * @demo demo/index.html
   * @polymerBehavior
   */
  Polymer.IronValidatableBehavior = {

    properties: {

      /**
       * Name of the validator to use.
       */
      validator: {
        type: String
      },

      /**
       * True if the last call to `validate` is invalid.
       */
      invalid: {
        notify: true,
        reflectToAttribute: true,
        type: Boolean,
        value: false
      },

      /**
       * This property is deprecated and should not be used. Use the global
       * validator meta singleton, `Polymer.IronValidatableBehaviorMeta` instead.
       */
      _validatorMeta: {
        type: Object
      },

      /**
       * Namespace for this validator. This property is deprecated and should
       * not be used. For all intents and purposes, please consider it a
       * read-only, config-time property.
       */
      validatorType: {
        type: String,
        value: 'validator'
      },

      _validator: {
        type: Object,
        computed: '__computeValidator(validator)'
      }
    },

    observers: [
      '_invalidChanged(invalid)'
    ],

    registered: function() {
      Polymer.IronValidatableBehaviorMeta = new Polymer.IronMeta({type: 'validator'});
    },

    _invalidChanged: function() {
      if (this.invalid) {
        this.setAttribute('aria-invalid', 'true');
      } else {
        this.removeAttribute('aria-invalid');
      }
    },

    /**
     * @return {boolean} True if the validator `validator` exists.
     */
    hasValidator: function() {
      return this._validator != null;
    },

    /**
     * Returns true if the `value` is valid, and updates `invalid`. If you want
     * your element to have custom validation logic, do not override this method;
     * override `_getValidity(value)` instead.

     * @param {Object} value The value to be validated. By default, it is passed
     * to the validator's `validate()` function, if a validator is set.
     * @return {boolean} True if `value` is valid.
     */
    validate: function(value) {
      this.invalid = !this._getValidity(value);
      return !this.invalid;
    },

    /**
     * Returns true if `value` is valid.  By default, it is passed
     * to the validator's `validate()` function, if a validator is set. You
     * should override this method if you want to implement custom validity
     * logic for your element.
     *
     * @param {Object} value The value to be validated.
     * @return {boolean} True if `value` is valid.
     */

    _getValidity: function(value) {
      if (this.hasValidator()) {
        return this._validator.validate(value);
      }
      return true;
    },

    __computeValidator: function() {
      return Polymer.IronValidatableBehaviorMeta &&
          Polymer.IronValidatableBehaviorMeta.byKey(this.validator);
    }
  };

</script><script>

/*
`<iron-input>` adds two-way binding and custom validators using `Polymer.IronValidatorBehavior`
to `<input>`.

### Two-way binding

By default you can only get notified of changes to an `input`'s `value` due to user input:

    <input value="{{myValue::input}}">

`iron-input` adds the `bind-value` property that mirrors the `value` property, and can be used
for two-way data binding. `bind-value` will notify if it is changed either by user input or by script.

    <input is="iron-input" bind-value="{{myValue}}">

### Custom validators

You can use custom validators that implement `Polymer.IronValidatorBehavior` with `<iron-input>`.

    <input is="iron-input" validator="my-custom-validator">

### Stopping invalid input

It may be desirable to only allow users to enter certain characters. You can use the
`prevent-invalid-input` and `allowed-pattern` attributes together to accomplish this. This feature
is separate from validation, and `allowed-pattern` does not affect how the input is validated.

    <!-- only allow characters that match [0-9] -->
    <input is="iron-input" prevent-invalid-input allowed-pattern="[0-9]">

@hero hero.svg
@demo demo/index.html
*/

  Polymer({

    is: 'iron-input',

    extends: 'input',

    behaviors: [
      Polymer.IronValidatableBehavior
    ],

    properties: {

      /**
       * Use this property instead of `value` for two-way data binding.
       */
      bindValue: {
        observer: '_bindValueChanged',
        type: String
      },

      /**
       * Set to true to prevent the user from entering invalid input. If `allowedPattern` is set,
       * any character typed by the user will be matched against that pattern, and rejected if it's not a match.
       * Pasted input will have each character checked individually; if any character
       * doesn't match `allowedPattern`, the entire pasted string will be rejected.
       * If `allowedPattern` is not set, it will use the `type` attribute (only supported for `type=number`).
       */
      preventInvalidInput: {
        type: Boolean
      },

      /**
       * Regular expression that list the characters allowed as input.
       * This pattern represents the allowed characters for the field; as the user inputs text,
       * each individual character will be checked against the pattern (rather than checking
       * the entire value as a whole). The recommended format should be a list of allowed characters;
       * for example, `[a-zA-Z0-9.+-!;:]`
       */
      allowedPattern: {
        type: String,
        observer: "_allowedPatternChanged"
      },

      _previousValidInput: {
        type: String,
        value: ''
      },

      _patternAlreadyChecked: {
        type: Boolean,
        value: false
      }

    },

    listeners: {
      'input': '_onInput',
      'keypress': '_onKeypress'
    },

    /** @suppress {checkTypes} */
    registered: function() {
      // Feature detect whether we need to patch dispatchEvent (i.e. on FF and IE).
      if (!this._canDispatchEventOnDisabled()) {
        this._origDispatchEvent = this.dispatchEvent;
        this.dispatchEvent = this._dispatchEventFirefoxIE;
      }
    },

    created: function() {
      Polymer.IronA11yAnnouncer.requestAvailability();
    },

    _canDispatchEventOnDisabled: function() {
      var input = document.createElement('input');
      var canDispatch = false;
      input.disabled = true;

      input.addEventListener('feature-check-dispatch-event', function() {
        canDispatch = true;
      });

      try {
        input.dispatchEvent(new Event('feature-check-dispatch-event'));
      } catch(e) {}

      return canDispatch;
    },

    _dispatchEventFirefoxIE: function() {
      // Due to Firefox bug, events fired on disabled form controls can throw
      // errors; furthermore, neither IE nor Firefox will actually dispatch
      // events from disabled form controls; as such, we toggle disable around
      // the dispatch to allow notifying properties to notify
      // See issue #47 for details
      var disabled = this.disabled;
      this.disabled = false;
      this._origDispatchEvent.apply(this, arguments);
      this.disabled = disabled;
    },

    get _patternRegExp() {
      var pattern;
      if (this.allowedPattern) {
        pattern = new RegExp(this.allowedPattern);
      } else {
        switch (this.type) {
          case 'number':
            pattern = /[0-9.,e-]/;
            break;
        }
      }
      return pattern;
    },

    ready: function() {
      this.bindValue = this.value;
    },

    /**
     * @suppress {checkTypes}
     */
    _bindValueChanged: function() {
      if (this.value !== this.bindValue) {
        this.value = !(this.bindValue || this.bindValue === 0 || this.bindValue === false) ? '' : this.bindValue;
      }
      // manually notify because we don't want to notify until after setting value
      this.fire('bind-value-changed', {value: this.bindValue});
    },

    _allowedPatternChanged: function() {
      // Force to prevent invalid input when an `allowed-pattern` is set
      this.preventInvalidInput = this.allowedPattern ? true : false;
    },

    _onInput: function() {
      // Need to validate each of the characters pasted if they haven't
      // been validated inside `_onKeypress` already.
      if (this.preventInvalidInput && !this._patternAlreadyChecked) {
        var valid = this._checkPatternValidity();
        if (!valid) {
          this._announceInvalidCharacter('Invalid string of characters not entered.');
          this.value = this._previousValidInput;
        }
      }

      this.bindValue = this.value;
      this._previousValidInput = this.value;
      this._patternAlreadyChecked = false;
    },

    _isPrintable: function(event) {
      // What a control/printable character is varies wildly based on the browser.
      // - most control characters (arrows, backspace) do not send a `keypress` event
      //   in Chrome, but the *do* on Firefox
      // - in Firefox, when they do send a `keypress` event, control chars have
      //   a charCode = 0, keyCode = xx (for ex. 40 for down arrow)
      // - printable characters always send a keypress event.
      // - in Firefox, printable chars always have a keyCode = 0. In Chrome, the keyCode
      //   always matches the charCode.
      // None of this makes any sense.

      // For these keys, ASCII code == browser keycode.
      var anyNonPrintable =
        (event.keyCode == 8)   ||  // backspace
        (event.keyCode == 9)   ||  // tab
        (event.keyCode == 13)  ||  // enter
        (event.keyCode == 27);     // escape

      // For these keys, make sure it's a browser keycode and not an ASCII code.
      var mozNonPrintable =
        (event.keyCode == 19)  ||  // pause
        (event.keyCode == 20)  ||  // caps lock
        (event.keyCode == 45)  ||  // insert
        (event.keyCode == 46)  ||  // delete
        (event.keyCode == 144) ||  // num lock
        (event.keyCode == 145) ||  // scroll lock
        (event.keyCode > 32 && event.keyCode < 41)   || // page up/down, end, home, arrows
        (event.keyCode > 111 && event.keyCode < 124); // fn keys

      return !anyNonPrintable && !(event.charCode == 0 && mozNonPrintable);
    },

    _onKeypress: function(event) {
      if (!this.preventInvalidInput && this.type !== 'number') {
        return;
      }
      var regexp = this._patternRegExp;
      if (!regexp) {
        return;
      }

      // Handle special keys and backspace
      if (event.metaKey || event.ctrlKey || event.altKey)
        return;

      // Check the pattern either here or in `_onInput`, but not in both.
      this._patternAlreadyChecked = true;

      var thisChar = String.fromCharCode(event.charCode);
      if (this._isPrintable(event) && !regexp.test(thisChar)) {
        event.preventDefault();
        this._announceInvalidCharacter('Invalid character ' + thisChar + ' not entered.');
      }
    },

    _checkPatternValidity: function() {
      var regexp = this._patternRegExp;
      if (!regexp) {
        return true;
      }
      for (var i = 0; i < this.value.length; i++) {
        if (!regexp.test(this.value[i])) {
          return false;
        }
      }
      return true;
    },

    /**
     * Returns true if `value` is valid. The validator provided in `validator` will be used first,
     * then any constraints.
     * @return {boolean} True if the value is valid.
     */
    validate: function() {
      // First, check what the browser thinks. Some inputs (like type=number)
      // behave weirdly and will set the value to "" if something invalid is
      // entered, but will set the validity correctly.
      var valid =  this.checkValidity();

      // Only do extra checking if the browser thought this was valid.
      if (valid) {
        // Empty, required input is invalid
        if (this.required && this.value === '') {
          valid = false;
        } else if (this.hasValidator()) {
          valid = Polymer.IronValidatableBehavior.validate.call(this, this.value);
        }
      }

      this.invalid = !valid;
      this.fire('iron-input-validate');
      return valid;
    },

    _announceInvalidCharacter: function(message) {
      this.fire('iron-announce', { text: message });
    }
  });

  /*
  The `iron-input-validate` event is fired whenever `validate()` is called.
  @event iron-input-validate
  */

</script><script>

  // Generate unique, monotonically increasing IDs for labels (needed by
  // aria-labelledby) and add-ons.
  Polymer.PaperInputHelper = {};
  Polymer.PaperInputHelper.NextLabelID = 1;
  Polymer.PaperInputHelper.NextAddonID = 1;

  /**
   * Use `Polymer.PaperInputBehavior` to implement inputs with `<paper-input-container>`. This
   * behavior is implemented by `<paper-input>`. It exposes a number of properties from
   * `<paper-input-container>` and `<input is="iron-input">` and they should be bound in your
   * template.
   *
   * The input element can be accessed by the `inputElement` property if you need to access
   * properties or methods that are not exposed.
   * @polymerBehavior Polymer.PaperInputBehavior
   */
  Polymer.PaperInputBehaviorImpl = {

    properties: {
      /**
       * Fired when the input changes due to user interaction.
       *
       * @event change
       */

      /**
       * The label for this input. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to
       * `<label>`'s content and `hidden` property, e.g.
       * `<label hidden$="[[!label]]">[[label]]</label>` in your `template`
       */
      label: {
        type: String
      },

      /**
       * The value for this input. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to
       * the `<input is="iron-input">`'s `bindValue`
       * property, or the value property of your input that is `notify:true`.
       */
      value: {
        notify: true,
        type: String
      },

      /**
       * Set to true to disable this input. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to
       * both the `<paper-input-container>`'s and the input's `disabled` property.
       */
      disabled: {
        type: Boolean,
        value: false
      },

      /**
       * Returns true if the value is invalid. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to both the
       * `<paper-input-container>`'s and the input's `invalid` property.
       *
       * If `autoValidate` is true, the `invalid` attribute is managed automatically,
       * which can clobber attempts to manage it manually.
       */
      invalid: {
        type: Boolean,
        value: false,
        notify: true
      },

      /**
       * Set to true to prevent the user from entering invalid input. If you're
       * using PaperInputBehavior to  implement your own paper-input-like element,
       * bind this to `<input is="iron-input">`'s `preventInvalidInput` property.
       */
      preventInvalidInput: {
        type: Boolean
      },

      /**
       * Set this to specify the pattern allowed by `preventInvalidInput`. If
       * you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `allowedPattern`
       * property.
       */
      allowedPattern: {
        type: String
      },

      /**
       * The type of the input. The supported types are `text`, `number` and `password`.
       * If you're using PaperInputBehavior to implement your own paper-input-like element,
       * bind this to the `<input is="iron-input">`'s `type` property.
       */
      type: {
        type: String
      },

      /**
       * The datalist of the input (if any). This should match the id of an existing `<datalist>`.
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `list` property.
       */
      list: {
        type: String
      },

      /**
       * A pattern to validate the `input` with. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to
       * the `<input is="iron-input">`'s `pattern` property.
       */
      pattern: {
        type: String
      },

      /**
       * Set to true to mark the input as required. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to
       * the `<input is="iron-input">`'s `required` property.
       */
      required: {
        type: Boolean,
        value: false
      },

      /**
       * The error message to display when the input is invalid. If you're using
       * PaperInputBehavior to implement your own paper-input-like element,
       * bind this to the `<paper-input-error>`'s content, if using.
       */
      errorMessage: {
        type: String
      },

      /**
       * Set to true to show a character counter.
       */
      charCounter: {
        type: Boolean,
        value: false
      },

      /**
       * Set to true to disable the floating label. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to
       * the `<paper-input-container>`'s `noLabelFloat` property.
       */
      noLabelFloat: {
        type: Boolean,
        value: false
      },

      /**
       * Set to true to always float the label. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to
       * the `<paper-input-container>`'s `alwaysFloatLabel` property.
       */
      alwaysFloatLabel: {
        type: Boolean,
        value: false
      },

      /**
       * Set to true to auto-validate the input value. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to
       * the `<paper-input-container>`'s `autoValidate` property.
       */
      autoValidate: {
        type: Boolean,
        value: false
      },

      /**
       * Name of the validator to use. If you're using PaperInputBehavior to
       * implement your own paper-input-like element, bind this to
       * the `<input is="iron-input">`'s `validator` property.
       */
      validator: {
        type: String
      },

      // HTMLInputElement attributes for binding if needed

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `autocomplete` property.
       */
      autocomplete: {
        type: String,
        value: 'off'
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `autofocus` property.
       */
      autofocus: {
        type: Boolean,
        observer: '_autofocusChanged'
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `inputmode` property.
       */
      inputmode: {
        type: String
      },

      /**
       * The minimum length of the input value.
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `minlength` property.
       */
      minlength: {
        type: Number
      },

      /**
       * The maximum length of the input value.
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `maxlength` property.
       */
      maxlength: {
        type: Number
      },

      /**
       * The minimum (numeric or date-time) input value.
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `min` property.
       */
      min: {
        type: String
      },

      /**
       * The maximum (numeric or date-time) input value.
       * Can be a String (e.g. `"2000-01-01"`) or a Number (e.g. `2`).
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `max` property.
       */
      max: {
        type: String
      },

      /**
       * Limits the numeric or date-time increments.
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `step` property.
       */
      step: {
        type: String
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `name` property.
       */
      name: {
        type: String
      },

      /**
       * A placeholder string in addition to the label. If this is set, the label will always float.
       */
      placeholder: {
        type: String,
        // need to set a default so _computeAlwaysFloatLabel is run
        value: ''
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `readonly` property.
       */
      readonly: {
        type: Boolean,
        value: false
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `size` property.
       */
      size: {
        type: Number
      },

      // Nonstandard attributes for binding if needed

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `autocapitalize` property.
       */
      autocapitalize: {
        type: String,
        value: 'none'
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `autocorrect` property.
       */
      autocorrect: {
        type: String,
        value: 'off'
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `autosave` property,
       * used with type=search.
       */
      autosave: {
        type: String
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `results` property,
       * used with type=search.
       */
      results: {
        type: Number
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the `<input is="iron-input">`'s `accept` property,
       * used with type=file.
       */
      accept: {
        type: String
      },

      /**
       * If you're using PaperInputBehavior to implement your own paper-input-like
       * element, bind this to the`<input is="iron-input">`'s `multiple` property,
       * used with type=file.
       */
      multiple: {
        type: Boolean
      },

      _ariaDescribedBy: {
        type: String,
        value: ''
      },

      _ariaLabelledBy: {
        type: String,
        value: ''
      }

    },

    listeners: {
      'addon-attached': '_onAddonAttached',
    },

    keyBindings: {
      'shift+tab:keydown': '_onShiftTabDown'
    },

    hostAttributes: {
      tabindex: 0
    },

    /**
     * Returns a reference to the input element.
     */
    get inputElement() {
      return this.$.input;
    },

    /**
     * Returns a reference to the focusable element.
     */
    get _focusableElement() {
      return this.inputElement;
    },

    registered: function() {
      // These types have some default placeholder text; overlapping
      // the label on top of it looks terrible. Auto-float the label in this case.
      this._typesThatHaveText = ["date", "datetime", "datetime-local", "month",
          "time", "week", "file"];
    },

    attached: function() {
      this._updateAriaLabelledBy();

      if (this.inputElement &&
          this._typesThatHaveText.indexOf(this.inputElement.type) !== -1) {
        this.alwaysFloatLabel = true;
      }
    },

    _appendStringWithSpace: function(str, more) {
      if (str) {
        str = str + ' ' + more;
      } else {
        str = more;
      }
      return str;
    },

    _onAddonAttached: function(event) {
      var target = event.path ? event.path[0] : event.target;
      if (target.id) {
        this._ariaDescribedBy = this._appendStringWithSpace(this._ariaDescribedBy, target.id);
      } else {
        var id = 'paper-input-add-on-' + Polymer.PaperInputHelper.NextAddonID++;
        target.id = id;
        this._ariaDescribedBy = this._appendStringWithSpace(this._ariaDescribedBy, id);
      }
    },

    /**
     * Validates the input element and sets an error style if needed.
     *
     * @return {boolean}
     */
    validate: function() {
      return this.inputElement.validate();
    },

    /**
     * Forward focus to inputElement. Overriden from IronControlState.
     */
    _focusBlurHandler: function(event) {
      Polymer.IronControlState._focusBlurHandler.call(this, event);

      // Forward the focus to the nested input.
      if (this.focused && !this._shiftTabPressed)
        this._focusableElement.focus();
    },

    /**
     * Handler that is called when a shift+tab keypress is detected by the menu.
     *
     * @param {CustomEvent} event A key combination event.
     */
    _onShiftTabDown: function(event) {
      var oldTabIndex = this.getAttribute('tabindex');
      this._shiftTabPressed = true;
      this.setAttribute('tabindex', '-1');
      this.async(function() {
        this.setAttribute('tabindex', oldTabIndex);
        this._shiftTabPressed = false;
      }, 1);
    },

    /**
     * If `autoValidate` is true, then validates the element.
     */
    _handleAutoValidate: function() {
      if (this.autoValidate)
        this.validate();
    },

    /**
     * Restores the cursor to its original position after updating the value.
     * @param {string} newValue The value that should be saved.
     */
    updateValueAndPreserveCaret: function(newValue) {
      // Not all elements might have selection, and even if they have the
      // right properties, accessing them might throw an exception (like for
      // <input type=number>)
      try {
        var start = this.inputElement.selectionStart;
        this.value = newValue;

        // The cursor automatically jumps to the end after re-setting the value,
        // so restore it to its original position.
        this.inputElement.selectionStart = start;
        this.inputElement.selectionEnd = start;
      } catch (e) {
        // Just set the value and give up on the caret.
        this.value = newValue;
      }
    },

    _computeAlwaysFloatLabel: function(alwaysFloatLabel, placeholder) {
      return placeholder || alwaysFloatLabel;
    },

    _updateAriaLabelledBy: function() {
      var label = Polymer.dom(this.root).querySelector('label');
      if (!label) {
        this._ariaLabelledBy = '';
        return;
      }
      var labelledBy;
      if (label.id) {
        labelledBy = label.id;
      } else {
        labelledBy = 'paper-input-label-' + Polymer.PaperInputHelper.NextLabelID++;
        label.id = labelledBy;
      }
      this._ariaLabelledBy = labelledBy;
    },

    _onChange:function(event) {
      // In the Shadow DOM, the `change` event is not leaked into the
      // ancestor tree, so we must do this manually.
      // See https://w3c.github.io/webcomponents/spec/shadow/#events-that-are-not-leaked-into-ancestor-trees.
      if (this.shadowRoot) {
        this.fire(event.type, {sourceEvent: event}, {
          node: this,
          bubbles: event.bubbles,
          cancelable: event.cancelable
        });
      }
    },

    _autofocusChanged: function() {
      // Firefox doesn't respect the autofocus attribute if it's applied after
      // the page is loaded (Chrome/WebKit do respect it), preventing an
      // autofocus attribute specified in markup from taking effect when the
      // element is upgraded. As a workaround, if the autofocus property is set,
      // and the focus hasn't already been moved elsewhere, we take focus.
      if (this.autofocus && this._focusableElement) {

        // In IE 11, the default document.activeElement can be the page's
        // outermost html element, but there are also cases (under the
        // polyfill?) in which the activeElement is not a real HTMLElement, but
        // just a plain object. We identify the latter case as having no valid
        // activeElement.
        var activeElement = document.activeElement;
        var isActiveElementValid = activeElement instanceof HTMLElement;

        // Has some other element has already taken the focus?
        var isSomeElementActive = isActiveElementValid &&
            activeElement !== document.body &&
            activeElement !== document.documentElement; /* IE 11 */
        if (!isSomeElementActive) {
          // No specific element has taken the focus yet, so we can take it.
          this._focusableElement.focus();
        }
      }
    }
  }

  /** @polymerBehavior */
  Polymer.PaperInputBehavior = [
    Polymer.IronControlState,
    Polymer.IronA11yKeysBehavior,
    Polymer.PaperInputBehaviorImpl
  ];
</script>

<dom-module id="paper-input-char-counter" assetpath="../paper-input/">
  <template>
    <style>
      :host {
        display: inline-block;
        float: right;

        @apply(--paper-font-caption);
        @apply(--paper-input-char-counter);
      }

      :host([hidden]) {
        display: none !important;
      }

      :host-context([dir="rtl"]) {
        float: left;
      }
    </style>

    <span>[[_charCounterStr]]</span>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'paper-input-char-counter',

    behaviors: [
      Polymer.PaperInputAddonBehavior
    ],

    properties: {
      _charCounterStr: {
        type: String,
        value: '0'
      }
    },

    /**
     * This overrides the update function in PaperInputAddonBehavior.
     * @param {{
     *   inputElement: (Element|undefined),
     *   value: (string|undefined),
     *   invalid: boolean
     * }} state -
     *     inputElement: The input element.
     *     value: The input value.
     *     invalid: True if the input value is invalid.
     */
    update: function(state) {
      if (!state.inputElement) {
        return;
      }

      state.value = state.value || '';

      var counter = state.value.toString().length.toString();

      if (state.inputElement.hasAttribute('maxlength')) {
        counter += '/' + state.inputElement.getAttribute('maxlength');
      }

      this._charCounterStr = counter;
    }
  });
</script>
<dom-module id="paper-input" assetpath="../paper-input/">
  <template>
    <style>
      :host {
        display: block;
      }

      :host([focused]) {
        outline: none;
      }

      :host([hidden]) {
        display: none !important;
      }

      input::-webkit-input-placeholder {
        color: var(--paper-input-container-color, --secondary-text-color);
      }

      input:-moz-placeholder {
        color: var(--paper-input-container-color, --secondary-text-color);
      }

      input::-moz-placeholder {
        color: var(--paper-input-container-color, --secondary-text-color);
      }

      input:-ms-input-placeholder {
        color: var(--paper-input-container-color, --secondary-text-color);
      }

      label {
        pointer-events: none;
      }
    </style>

    <paper-input-container no-label-float="[[noLabelFloat]]" always-float-label="[[_computeAlwaysFloatLabel(alwaysFloatLabel,placeholder)]]" auto-validate$="[[autoValidate]]" disabled$="[[disabled]]" invalid="[[invalid]]">

      <content select="[prefix]"></content>

      <label hidden$="[[!label]]" aria-hidden="true" for="input">[[label]]</label>

      <input is="iron-input" id="input" aria-labelledby$="[[_ariaLabelledBy]]" aria-describedby$="[[_ariaDescribedBy]]" disabled$="[[disabled]]" title$="[[title]]" bind-value="{{value}}" invalid="{{invalid}}" prevent-invalid-input="[[preventInvalidInput]]" allowed-pattern="[[allowedPattern]]" validator="[[validator]]" type$="[[type]]" pattern$="[[pattern]]" required$="[[required]]" autocomplete$="[[autocomplete]]" autofocus$="[[autofocus]]" inputmode$="[[inputmode]]" minlength$="[[minlength]]" maxlength$="[[maxlength]]" min$="[[min]]" max$="[[max]]" step$="[[step]]" name$="[[name]]" placeholder$="[[placeholder]]" readonly$="[[readonly]]" list$="[[list]]" size$="[[size]]" autocapitalize$="[[autocapitalize]]" autocorrect$="[[autocorrect]]" on-change="_onChange" tabindex$="[[tabindex]]" autosave$="[[autosave]]" results$="[[results]]" accept$="[[accept]]" multiple$="[[multiple]]">

      <content select="[suffix]"></content>

      <template is="dom-if" if="[[errorMessage]]">
        <paper-input-error aria-live="assertive">[[errorMessage]]</paper-input-error>
      </template>

      <template is="dom-if" if="[[charCounter]]">
        <paper-input-char-counter></paper-input-char-counter>
      </template>

    </paper-input-container>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'paper-input',

    behaviors: [
      Polymer.IronFormElementBehavior,
      Polymer.PaperInputBehavior
    ]
  });
</script>

<script>
	/**
	 *	`TriBlockScrollFieldIntoViewBehavior` configures fields to scroll into view on a focus event when the user is on an Android device. When the user taps on the field, the screen will scroll the field to the top of the screen, allowing space for the on-screen keyboard to display. 
	 *
	 * To use, add the behavior to the view and add `tri-scroll-into-view` to the field you want to scroll into view (i.e. paper-input, paper-textarea, textarea). `triplat-date-picker`, `triplat-datetime-picker`, `triplat-number-input`, `triplat-incremental-input` are components with this feature enabled by default. `triplat-select-input` has it's own implementation, see its component documentation.
	 *
	 * <div style="background-color:#FFFFCC">
	 *   <div style="padding:20px;">
	 *       <b>Note:</b> iOS already has built in scroll into view so this is specifically for Android.
	 *   </div>
	 * </div>
	 *
	 * @polymerBehavior 
	 */
	TriBlockScrollFieldIntoViewBehavior = {

		properties: {

			_isAndroidDevice: {
				type: Boolean,
				value: function() {
					return navigator.userAgent.match(/Android/i);
				}
			},

			_scrollSelectInputIntoView: {
				type: Boolean,
				computed: "_computeScrollSelectInputIntoView(smallScreen, smallScreenHeight)"
			}
		},

		_handleFieldFocus: function(event) {
			// Add a delay for the Android virtual keyboard be displayed.
			this.async(this._scrollFieldIntoView.bind(this, event.target), 500);
		},

		_scrollFieldIntoView: function(field) {
			field.scrollIntoView(true);
		},

		attached: function() {
			if (!this._isAndroidDevice) {
				return;
			}
			var fields = Polymer.dom(this.root).querySelectorAll("[tri-scroll-into-view]");
			if (fields != null) {
				for (var index = 0; index < fields.length; index++) {
					var element = fields[index];
					element = element.inputElement || element.textarea || element;
					// Polymer 2.x
					if (element.inputElement)
						element  = element.inputElement; 
					this.listen(element, 'focus', '_handleFieldFocus');

				}
			}
		},

		detached: function() {
			if (!this._isAndroidDevice) {
				return;
			}
			var fields = this.$$("[tri-scroll-into-view]");
			if (fields != null) {
				if (!Array.isArray(fields)) {
					fields = [fields];
				}
				for (var index = 0; index < fields.length; index++) {
					var element = fields[index];
					this.unlisten(element, 'focus', '_handleFieldFocus');
				}
			}
		},

		_computeScrollSelectInputIntoView: function (smallScreen, smallScreenHeight) {
			return smallScreen || smallScreenHeight;
 		}
	};
</script><dom-module id="triplat-incremental-input" assetpath="../triplat-incremental-input/">
	<template>
	<style include="iron-flex iron-flex-alignment">

   	 	.main{
    			@apply --triplat-increment-input-main; 
   	 	}

		.incremental-label{
			font-size: .85em;
			color: var(--tri-secondary-color);
    			@apply --triplat-increment-input-label; 
		}
			
		.incremental-counter{
    			@apply --triplat-increment-input-counter; 
		}
			
	    paper-input {
	        text-align: center;
	     	padding-left: 4px;
	     	padding-right: 4px;
    			@apply --triplat-increment-input-paper; 

			--paper-input-container-underline: {
				z-index: 1;
			};
	    }

		paper-icon-button {
	    		height: 44px;
	    		width: 44px; 
	    		padding: 6px;
	    		color: var(--tri-actionable-color, var(--tri-primary-color));
	    		background-color: var(--tri-actionable-color-contrast);
	    		@apply --triplat-duration-period-counter-icon; 
	    	}

		:host([reverse-icons]) paper-icon-button {
			transform: rotate(90deg);
		}
		
		.counters-only-value {
			font-size: 28px;
			@apply --triplat-increment-input-counters-only-value;
		}

	</style>

   	<div class="main">
   		<div hidden$="[[showLabelUnder]]">
   			<span class="incremental-label">{{label}}<content id="labelContent" select="[label]"></content></span>
   		</div>
   		<div class="incremental-counter">
   			
   			<template is="dom-if" if="{{!reverseIcons}}">
	    		<paper-icon-button icon="ibm-glyphs:back" disabled$="[[_disableDecrementButton(loop, value, readonly)]]" on-tap="decreaseValue" aria-label$="[[decreaseAriaLabel]]"></paper-icon-button>
   			</template>
   			<template is="dom-if" if="{{reverseIcons}}">
    			<paper-icon-button icon="ibm-glyphs:back" disabled$="[[_disableIncrementButton(loop, value, readonly)]]" on-tap="increaseValue" aria-label$="[[increaseAriaLabel]]"></paper-icon-button>
   			</template>

	    	<paper-input id="input" invalid="[[invalid]]" value="{{_displayValue(value, minDigits)}}" on-change="_handleEdit" on-input="_handleEdit" allowed-pattern="[[_computeAllowedPattern(preventNegative)]]" prevent-invalid-input="" error-message="[[errorMessage]]" readonly$="[[readonly]]" no-label-float="" hidden$="[[countersOnly]]" tri-scroll-into-view="">
    		</paper-input>
		
		<span class="counters-only-value" hidden$="[[!countersOnly]]">[[_displayValue(value, minDigits)]]</span>

   		<div hidden$="[[!showLabelUnder]]">
   			<span class="incremental-label">{{label}}<div id="labelContentUnder"></div></span>
   		</div>

   			<template is="dom-if" if="{{!reverseIcons}}">
	    		<paper-icon-button icon="ibm-glyphs:expand-open" disabled$="[[_disableIncrementButton(loop, value, readonly)]]" on-tap="increaseValue" aria-label$="[[increaseAriaLabel]]"></paper-icon-button>
   			</template>
   			<template is="dom-if" if="{{reverseIcons}}">
	    		<paper-icon-button icon="ibm-glyphs:expand-open" disabled$="[[_disableDecrementButton(loop, value, readonly)]]" on-tap="decreaseValue" aria-label$="[[decreaseAriaLabel]]"></paper-icon-button>
   			</template>

   		</div>
   	</div>
        
	</template>
</dom-module>
<script>

	Polymer({
		is: "triplat-incremental-input",
		
		behaviors: [
			TriBlockScrollFieldIntoViewBehavior
		],

		/**
		 * Fired whenever the user changes the input value, either by selecting the increase or decrease icon, or by typing in the input field.
		 *
		 * @event triplat-incremental-input-change-by-user
		 */

		properties: {

			/**
			 * Numeric value for the incremental input field. 
			 */
	  		value: {
	  			type: Number,
	  			notify: true
	  		},

			/*
			 * Indicates invalid input (when using flexValidation).
			 */
			invalid: {
				type: Boolean,
				notify: false,
			},

			/*
			 * Error message to be displayed when input is invalid (not a positive number, < min, or > max).
			 */
			errorMessage: {
				type: String,
				value: ""
			},

	  		/**
	  		  * String value to be used for the incremental label.
	  		  */
			label: String,
			
			/**
	  		  * Show the label underneath the value instead of above the value. Use this only when the component is vertical.
	  		  */
			showLabelUnder: {
				type: Boolean,
				value: false
			},

			/*
			 * String value to be used for the ARIA label of the increase icon.
			 */
			increaseAriaLabel: String,

			/*
			 * String value to be used for the ARIA label of the decrease icon.
			 */
			decreaseAriaLabel: String,

			/*
			 * Optional minimum allowed for a value when a value is decreased. If a value is smaller than min, the value will immediately be changed to min (unless flexValidation is true).
			 */
			min: {
				type: Number,
				value: 0
			},

			/*
			 * Optional maximum allowed for a value when a value is increased. If a value is greater than max, the value will immediately be changed to max (unless flexValidation is true).
			 */
			max: {
				type: Number
			},

			/*
			 * Prevent user from typing in '-'. This will be automatically set to true if minimum is set to zero or above.
			 */
			preventNegative: {
				type: Boolean
			},

			/*
			 * Optional minimum number of digits when displaying a value. If a value length is smaller than the minimum digits number, preceding zeros will be added to the value.
			 */
			minDigits: {
				type: Number,
				value: 0
			},

			/*
			 * Optional loop when a value is increased or decreased (between min and max like a spinner wheel). Requires max value.
			 */
			loop: {
				type: Boolean,
				value: false
			},

			/*
			 * Optional flex validation. If this option is selected, any invalid entered value is not forced into min or max.
			 * Instead, the input is marked as invalid.
			 */
			flexValidation: {
				type: Boolean,
				value: false
			},

			/*
			 * Optional reverse order of the increase and decrease icons. By default, the decrease icon displays first. Enable this property if you are planning planning to layout the icons and input vertically.
			 */
			reverseIcons: {
				type: Boolean,
				reflectToAttribute: true,
				value: false
			},

			/*
			 * Amount to add or subtract when increasing or decreasing a value.
			 */
			step: {
				type: Number,
				value: 1
			},
			
			/*
			 * Value to indicate that the component is read-only.
			 */
			readonly: {
				type: Boolean,
				value: false
			},
			
			/*
			 * The user can edit the values with the period counters only. The input will be read-only.
			 */
			countersOnly: {
				type: Boolean,
				value: false
			}
		},
		
		get paperInputElement() {
			return this.$.input;
		},

		ready: function(){
			//initialize preventNegative base on the minimum setting
			if(this.preventNegative == undefined && this.min != undefined && this.min >= 0) {
				this.set("preventNegative", true);
			}
			
        	//check init value and set validation.
			this._initValidation();
			var distributedNodes = Polymer.dom(this.$$('#labelContent')).getDistributedNodes();
       		if (distributedNodes.length >0){
				this.label=" ";
				if (this.showLabelUnder) {
					for (var node of distributedNodes) {
						this.$.labelContentUnder.appendChild(node);
					}
				}
			}
		},

		_computeAllowedPattern: function(preventNegative) {
			return preventNegative? "[0-9]":"[0-9-]";
		},
		
		_displayValue: function(value, minDigits){
			//display value includes preceding zeros, if needed.
			return this._handleDigits();
		},

		/**
		  * Increase the value by a given step.
		  * If max value is set, value cannot exceed it.
		  * If loop is set and value exceeds max, then set the value to min.
		  */
		increaseValue: function(){
			var newValue = Number(this.min);
			
			if(isNaN(this.value)){
				//Initial none numeric value can exist with flexValidation. Therefore, when user click the icon we value is set to minimum.
			} else {
				newValue = Number(this.value);
				var numSteps = Number(this.step);

				if(this.max != null) {
					if(this.loop){
						//number of times to increase value by 1 (as if user click increase icon numSteps times)
						for (var i=0; i<numSteps; i++) {
							newValue = newValue + 1;
							if(newValue > this.max){
								//higher then max, set to min and continue to increase from the min value
								newValue = Number(this.min);
							}						
						}
					} else {
						newValue = newValue + numSteps;

						if (newValue > this.max) {
							//value no bigger then max
							newValue = Number(this.max);
						}
						if (newValue < this.min) {
							//value no smaller then min (can happen with flexValidation)
							newValue = Number(this.min);
						}
					}
				} else {
					//there is no max limit
					newValue = newValue + numSteps;
				}
			}
			
			//update value
			this.value = newValue;
			
			if(this.invalid == true) {
				this.invalid = false;
			}

			this.fire("triplat-incremental-input-change-by-user", {"value": this.value});
		},

		/**
		  * Decrease the value by a given step.
		  * Value cannot be smaller than min.
		  * If loop is set and value is smaller than min, then set the value to max.
		  */
		decreaseValue: function(){
			var newValue = Number(this.min);
			
			if(isNaN(this.value)){
				//Initial none numeric value can exist with flexValidation. Therefore, when user click the icon value is set to minimum.
			} else {
				newValue = Number(this.value);
				var numSteps = Number(this.step);

				if(this.max != null && this.loop) {
					//number of times to reduce value by 1 (as if user click decrease icon numSteps times)
					for (var i=0; i<numSteps; i++) {
						newValue = newValue - 1;
						if(newValue < this.min){
							//lower then min, set to max and continue to reduce from the max value
							newValue = Number(this.max);
						}						
					}
					
					if(newValue > this.max) {
						//value no bigger then max (can happen with flexValidation)
						newValue = Number(this.max);
					}
				} else {
					newValue = newValue - numSteps;
					
					if (newValue < this.min) {
						//value no smaller then min
						newValue = Number(this.min);
					}
					if (this.max != null && newValue > this.max){
						//value no bigger then max (can happen with flexValidation)
						newValue = Number(this.max);
					}
				}
			}

			//update value
			this.value = newValue;

			if(this.invalid == true) {
				this.invalid = false;
			}

			this.fire("triplat-incremental-input-change-by-user", {"value": this.value});
		},

		_disableDecrementButton: function(loop, value, readonly) {
			if (readonly) return true;
			if (loop) return false;

			var value = Number(value);
			if (isNaN(value)) return true;
			if (value <= Number(this.min)) return true;

			return false;
		},

		_disableIncrementButton: function(loop, value, readonly) {
			if (readonly) return true;
			if (loop) return false;

			var value = Number(value);
			if (isNaN(value)) return true;
			if (value >= Number(this.max)) return true;

			return false;
		},

		_initValidation: function(){
			if(this.flexValidation == true) {
				this._handleFlexValidation();
			} else {
				this._handleForceValidation();
			}
		},

		_handleEdit: function(e){
			if(this._isNumber(e.target.value)){
				this.value = Number(e.target.value);
			} else {
				this.value = e.target.value;
			}
			if(this.flexValidation == true) {
				this._handleFlexValidation();
			} else {
				this._handleForceValidation();
			}

			this.fire("triplat-incremental-input-change-by-user", {"value": this.value});
		},

		_handleFlexValidation: function(){
			var numberValue = Number(this.value);
			if(isNaN(numberValue) 
				|| this.value < this.min 
				|| (this.max != null && this.value > this.max)) {
					//invalid value mark invalid
					this.invalid = true;
			} else {
					this.invalid = false;
			}
		},

		_handleForceValidation: function(){
			var numberValue = parseInt(this.value);
			if(isNaN(numberValue)) {
				//value not a number, set value to the min
				this.value = this.min;
			} else {
				//Set typed value as numeric instead of string.
				//It also handle the case of value contains mix of letter and number, set to number value
				if(this.value != numberValue) {
					this.value = numberValue;
				}
			}

			if(this.value < this.min) {
				this.value = Number(this.min);
			} else if(this.max != null && this.value > this.max) {
				this.value = Number(this.max);
			}
		},

		_handleDigits: function(){
			var formattedValue =  this.value;
			
			if(this.minDigits < 1 || !this._isNumber(this.value) || Number(this.value)<0){
				return formattedValue;
			}

			var stringValue = '' + Number(this.value);//without preceding zeros
			var stringOriginalValue = '' + this.value;//with preceding zeros, if exist
			
			var valueLength = stringValue.length;
			if(valueLength < this.minDigits){
				var digitsToAdd = this.minDigits - valueLength;
				var leadingZeros = "";
				for (var i=0; i<digitsToAdd; i++) {
					leadingZeros = leadingZeros + "0";
				};
				
				var newValue = leadingZeros + Number(this.value);
				if(newValue != stringOriginalValue) {
					//update value only if different
					formattedValue = newValue;
				}
			} else {
				if(stringOriginalValue.length > valueLength) {
					formattedValue = stringValue; //remove preceding zeros if length is more then minDigits
				}
			}
			
			return formattedValue;
		},

		_isNumber: function(value) {
			var numberValue = parseInt(value);
			return !isNaN(numberValue);
		}
		
	});
</script><dom-module id="triplat-calendar-times" assetpath="../triplat-date-picker/">
	<style include="iron-flex iron-flex-alignment">
		#times {
			box-sizing: border-box;
			max-width: 100%;
			padding: 6px;
			overflow: auto; 
			font-size: 14px;
			font-weight: bold;
			padding-left: 28px;
			padding-right: 24px;
			@apply --layout-horizontal;
			@apply --layout-center;
			@apply --layout-around-justified;
			@apply --triplat-calendar-times-time-section;
		}

		#viewingMonthYear {
			overflow: hidden;
		}
		.viewingMonthYear {
			margin: 0;
			font-size: 16px;
			font-weight: bold;
			line-height: 48px;
			letter-spacing: 0.02em;
			margin-left: 12px;
			margin-right: 12px;
			height: 35px;
		}

		#amPmButton {
			font-size: 14px;
			font-weight: bold;
			font-family: var(--tri-font-family);
			margin: 0px;
			padding: 0px;
			min-width: 2.14em !important;
			color: var(--ibm-gray-60) !important;
		}

		#separator{
			border: solid rgb(230, 230, 230);
			border-width: 2px;
			margin: 0px 12px 0px 12px;
			@apply --triplat-calendar-times-separator;
		}
		
		#header {
			@apply --triplat-calendar-times-header;
		}

		triplat-incremental-input.timepicker {
			--triplat-increment-input-label: {
				padding-bottom: 5px;
			};

			--triplat-increment-input-paper: { 
				width: 30px;
				margin-top: -12px;
					margin-bottom: -5px;
				};

			--triplat-increment-input-main: {
				padding-right:  var(--tri-calendar-time-counter-padding-right, 18px); 
				padding-left: var(--tri-calendar-time-counter-padding-left, 18px); 
				@apply --layout;
				@apply --layout-vertical;
				@apply --layout-center-center;
			};

			--triplat-increment-input-counter: { 
				@apply --layout;
				@apply --layout-vertical;
				@apply --layout-center-center;
			};

			--triplat-duration-period-counter-icon: {
				height: 40px; 
				width: 40px;
				color: var(--triplat-date-picker-icon-color, var(--tri-primary-content-color));
			} 
		}
		
		:host([show-label-under]) triplat-incremental-input.timepicker {
			--triplat-increment-input-label: {
				padding: 5px 0px;
			};
		}

		#time-counter paper-icon-button{
				height: 40px;
				width: 40px; 
				padding: 6px;
				color: var(--triplat-date-picker-icon-color);
			}

			#time-counter {
				margin-top: 2px;
				padding-right:  var(--triplat-calendar-time-counter-padding-right, 18px); 
			padding-left: var(--tri-calendar-time-counter-padding-left, 18px); 
			}
		
			.colon {
				font-size: 28px;
				padding-bottom: 18px;
				@apply --triplat-calendar-times-colon;
			}

	</style>
	<template>
		<hr id="separator">
		<div id="header" class="layout horizontal">
			<div class="flex relative" id="viewingMonthYear">
				<h4 class="viewingMonthYear">
				<span>Time</span>
				</h4>
			</div>
		</div>
		<div>
			<div id="times">
				<triplat-incremental-input reverse-icons="" class="timepicker" label="Hour" increase-aria-label="Increase hour" decrease-aria-label="Decrease hour" value="{{hour}}" min="{{_minHour}}" max="{{_maxHour}}" min-digits="[[hourMinDigits]]" step="{{stepHour}}" loop="[[!noLoop]]" show-label-under="[[showLabelUnder]]" counters-only="[[countersOnly]]">
				</triplat-incremental-input>
				<template is="dom-if" if="[[showColonSeparator]]">
					<span class="colon">:</span>
				</template>
				<triplat-incremental-input reverse-icons="" class="timepicker" label="Minute" increase-aria-label="Increase minute" decrease-aria-label="Decrease minute" value="{{minute}}" min="0" max="59" min-digits="2" step="{{stepMinute}}" loop="[[!noLoop]]" show-label-under="[[showLabelUnder]]" counters-only="[[countersOnly]]">
				</triplat-incremental-input>
				
				<template is="dom-if" if="{{displaySeconds}}">
					<template is="dom-if" if="[[showColonSeparator]]">
						<span class="colon">:</span>
					</template>
					<triplat-incremental-input reverse-icons="" class="timepicker" label="Second" increase-aria-label="Increase second" decrease-aria-label="Decrease second" value="{{second}}" min="0" max="59" min-digits="2" step="{{stepSecond}}" loop="[[!noLoop]]" show-label-under="[[showLabelUnder]]" counters-only="[[countersOnly]]">
					</triplat-incremental-input>
				</template>
				<template is="dom-if" if="{{isAmPmFormat}}">
					<div id="time-counter">
					<span>&nbsp;</span>
					<div id="amPm-counter" class="layout vertical">
						<paper-icon-button icon="icons:arrow-drop-up" on-tap="_toggleAmPm" aria-label$="{{_amPmAriaLabel}}"></paper-icon-button>
						<paper-button id="amPmButton" class="tri-disable-theme" on-tap="_toggleAmPm" tabindex="0" aria-label$="{{_amPmAriaLabel}}">{{_translatedAmPm}}</paper-button>
						<paper-icon-button icon="icons:arrow-drop-down" on-tap="_toggleAmPm" aria-label$="{{_amPmAriaLabel}}"></paper-icon-button>
					</div>
					</div>
				</template>
			</div>
		</div>
	</template>
</dom-module>
<script>
	Polymer({
		is: "triplat-calendar-times",

		behaviors: [TriDateUtilities],

		properties: {
			
			/* 
				* Display in 12-hour clock time convention with AM and PM time periods.
				*/
			isAmPmFormat: {
				type: Boolean,
				value: false,
				observer:"_isAmPmChanged"
			},

			/*
				* Display the seconds counter.
				*/
			displaySeconds: {
				type: Boolean,
				value: false,
				observer: "_displayChanged"
			},

			/*
				* Hour value.
				*/
			hour: {
				type: Number,
				value: 0,
			},

			/*
				* Minute value.
				*/
			minute: {
				type: Number,
				value: 0
			},

			/*
				* Second value.
				*/
			second: {
				type: Number,
				value: 0
			},

			/*
				* True if the time is in the PM.
				*/
			isPm: {
				type: Boolean,
				value: false
			},

			/*
				* The date value for the component. The time portion is the main concern.
				*/
			date: {
				type: Object,
				value: new Date(),
				observer: "_dateChanged"
			},
			
			/*
				* Show colon separators between the period counters.
				*/
			showColonSeparator: {
				type: Boolean,
				value: false
			},
			
			/*
				* Show the label underneath the value instead of above the value.
				*/
			showLabelUnder: {
				type: Boolean,
				reflectToAttribute: true,
				value: false
			},
			
			/*
				* The user can edit the values with the period counters only. The input will be read-only.
				*/
			countersOnly: {
					type: Boolean,
					value: false
				},
				
				/*
					* The number of minimum digits to display for the hours period.
					*/
			hourMinDigits: {
					type: Number,
					value: 2
			},
			
			/*
				* The period counters will not loop when a value is increased or decreased.
				*/
			noLoop: {
					type: Boolean,
					value: false
			},

			/*
			 * Amount to add or subtract when increasing or decreasing hours.
			 */
			stepHour: {
				type: Number
			},

			/*
			 * Amount to add or subtract when increasing or decreasing minutes.
			 */
			stepMinute: {
				type: Number
			},

			/*
			 * Amount to add or subtract when increasing or decreasing steps.
			 */
			stepSecond: {
				type: Number
			},


			_maxHour: Number,
			_minHour: Number,

			_toggleFontSize: {
				type: Boolean,
				value: false,
				readOnly: false
			},
		},

		observers: [
			'_updateTimePropsChanged(hour, minute, second, isPm)'
		],

		_dateChanged: function(newDate){
			if(this._isDateObject(newDate)){
				this._updateTimeProps(newDate);
			}
		},

		_updateTimeProps: function(date){
			this._minHour = this.isAmPmFormat ? 1 : 0;
			this._maxHour = this.isAmPmFormat ? 12 : 23;
			var hour = this.isAmPmFormat ? moment(date).format("hh") : moment(date).hour();
			if (!isNaN(hour)) {
				this.hour = Number(hour);
			} else {
				// For Arabic (and perhaps other langages) moment(date).format("hh") will not necessarily return a number
				// so use hour() and preform the military time conversion
				hour = Number(moment(date).hour());
				if (this.isAmPmFormat && hour > 12) {
					hour = hour - 12;
				}
				this.hour = hour;
			}
			this._hour = moment(date).hour();
			this.minute = moment(date).minute();
			this.second = moment(date).second();
			this.isPm = (Number(this._hour >= 12)) ? true : false;
		},

		_updateTimePropsChanged: function(hour, minute, second, isPm){
			var _hour = this.isAmPmFormat ? this._getConvertedHour(hour, isPm) : hour;
			var _mDate = moment(this.date).hour(_hour).minute(minute).second(second);
			this.fire('triplat-calendar-time-updated', {
						updatedDatetime: _mDate.toDate()
						});
			this._translatedAmPm = this._handleTranslation();	
			
		},

		_isAmPmChanged: function(){
			if(!this.date){
				var dateString = this._getCurrentDateString();
				this.date = moment(dateString).toDate();
				this._updateTimeProps(this.date);
			}
		},

		_getConvertedHour: function(hour, isPm){
			hour = Number(hour);
			hour = (hour === 12) ? 0 : hour; 
			var _hour = isPm ? (Number(hour) + 12) : hour;
			return _hour;
		},

		_toggleAmPm: function(){
			if(this.isPm){
				this.set("isPm", false);
			}else{
				this.set("isPm", true);
			}
			this._translatedAmPm = this._handleTranslation();
			this._forceAmPmRender();

		},

		_handleTranslation: function(){
			var __dictionary__am = "AM";
			var __dictionary__pm = "PM";
			var __dictionary__toggleToAM = "toggle to AM";
			var __dictionary__toggleToPM = "toggle to PM";
			var _translatedAmPm = this.isPm ? __dictionary__pm : __dictionary__am;
			this._amPmAriaLabel = this.isPm ? __dictionary__toggleToAM : __dictionary__toggleToPM;
			return _translatedAmPm;
		},

		_displayChanged: function(){
			if(this.displaySeconds){
				this.customStyle['--tri-calendar-time-counter-padding-right'] = '9px';
				this.customStyle['--tri-calendar-time-counter-padding-left'] = '9px';
				this.updateStyles();
			}
		},

		_forceAmPmRender: function(){
			/*
				* In Microsoft Edge the paper-button nested as it is in this component does not render the changed am/pm value, 
				* changing the font-size forces a render. 
				*/
			if (this._toggleFontSize) {
				this.$$('#amPmButton').style.fontSize = "100%";
			} else {
				this.$$('#amPmButton').style.fontSize = "101%";
			}
			this._toggleFontSize = !this._toggleFontSize;
		}
			
	});
</script><dom-module id="triplat-calendar" assetpath="../triplat-date-picker/">
<style include="iron-flex iron-flex-alignment">

:host { 
  font-size: 12px;
  line-height: 24px;
  background-color: #fff;
  border: 1px solid #ccc;
  font-family: var(--tri-font-family);
} 

#selectedWeekdayHeader {
  height: 36px;
  overflow: hidden;
}

#selectedDateHeader {
  box-sizing: border-box;
  padding: 12px 0;
  background-color: var(--triplat-date-picker-header-bg-color, --tri-primary-color-40);
}

#selectedDateHeader > div {
  width: 100%;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.selectedWeekday {
  font-size: 14px;
  line-height: 36px;
  text-align: center;
  margin: 0;
  font-weight: 400;
  color: white;
  background-color: var(--triplat-date-picker-header-sec-bg-color, --tri-primary-color-30);
}

#selectedMonth,
#selectedYear {
  height: 30px;
}
#selectedDay {
  height: 60px;
}
.selectedMonth,
.selectedYear {
  font-size: 22px;
  font-weight: 400;
  line-height: 30px;
  letter-spacing: 0.05em;
}
.selectedDay {
  font-size: 60px;
  line-height: 60px;
}
.selectedYear {
  color: rgba(255, 255, 255, 0.6);
}


#calendar {
  overflow: hidden;
}

#header {
  position: relative;
  overflow: hidden;
  padding-left: 3.5px;
  padding-right:3.5px;
} 

#viewingMonthYear {
  overflow: hidden;
}
.viewingMonthYear {
  margin: 0;
  font-size: 20px;
  font-weight: normal;
  line-height: 32px;
  letter-spacing: 0.02em;
  text-align: center;
  height: 40px;
}

.viewingMonthYear span {
  vertical-align: middle;
}

.weekday-name {
  font-weight: 500;
  width: 36px;
  text-align: center;
  color: black;
}
:host .weekday-name{
  color: var(--triplat-date-picker-weekday-color, --ibm-gray-60);
}

.views {
  width: 276px;
  overflow: hidden;
}

.calendarSelection {
  width: 276px;
  color: #fff;
}

.weekday {
  margin: 0px 12px 0px 12px;
}

#weekday {
  padding-top: 5px;
  padding-bottom: 5px;
  background-color: rgb(230, 230, 230);
}

.buttons{
  margin: 0px 12px;
}

.yearselection {
  color: var(--tri-primary-color);
}

#confirmButtons #cancelBtn, #confirmButtons #doneBtn {
  padding: 0px 0px;
  height: 30px;

}

#doneBtn {
  @apply(--tri-primary-button);
  color: white;
  -moz-border-radius: 0px;
  -webkit-border-radius: 0px;
  border-radius: 0px;
  text-transform: none;
  @apply(--triplat-date-picker-done-button);  
}

#doneBtn:hover {
  @apply(--tri-primary-button-hover);
}

#doneBtn[pressed] {
  @apply(--tri-primary-button-press);
}

#cancelBtn {
  @apply(--tri-secondary-button);
  font-weight: bold;
  -moz-border-radius: 0px;
  -webkit-border-radius: 0px;
  text-transform: none;
  --paper-button-flat-keyboard-focus: {
      border-width: 3px !important;
    };
  @apply(--triplat-date-picker-cancel-button);  
}

#cancelBtn:hover {
  @apply(--tri-secondary-button-hover);
}

#cancelBtn[pressed] {
  @apply(--tri-secondary-button-press);
}

paper-icon-button[view=timeView] {
  padding: 0px;
}

.landscape{
  background-color: var(--triplat-date-picker-landscape-bg-color, --tri-primary-color-30) !important;
  width: 100px !important;
}
.time{
  padding-top: .75em;
}

paper-button:not([raised]).paper-button-2.keyboard-focus{
    border-style: none;
}

.paper-icon-button-rtl {
	transform: scaleX(-1);
}
.space-between {
  justify-content: space-between;
}
@media all and (min-width: 1280px) {
    ._views {
      width: 766px;
    }
    ._calendarSelection{
      width: 766px;
    }
    ._selectedWeekdayHeader{
      height: 36px;
    }
    ._weekdayName {
      width: 100px;
      font-size: 20px;
    }
}
@media all and (min-width: 800px) and (max-width: 1279px) {
    ._views {
      width: 574px;
    }
    ._calendarSelection{
      width: 574px;
    }
    ._selectedWeekdayHeader{
      height: 30px;
    }
    ._weekdayName {
      width: 75px;
      font-size: 15px;
    }
}
@media all and (max-width: 799px) {
    ._views {
      width: 383px;
    }
    ._calendarSelection{
      width: 383px;
    }
    ._selectedWeekdayHeader{
      height: 24px;
    }
     ._weekdayName {
      width: 50px;
      font-size: 14px;
    }
}

#confirmButtons{
    padding-bottom: 10px;
    @apply(--layout-horizontal);
    @apply(--layout-justified);
}

#nextMonthArrow, #previousMonthArrow {
  --iron-icon-fill-color: var(--triplat-date-picker-icon-color, --tri-primary-icon-button-color);

} 
#space-between-confirmBtn {
  height: 1em;
}

</style>

<template id="template">
  <iron-media-query query="max-height: 550px" query-matches="{{landscape}}"></iron-media-query>
 
  <div id="wrapper" class="layout">

    <template is="dom-if" if="{{header}}">

      <template is="dom-if" if="{{landscape}}" on-dom-change="_handleDomChange"><span>{{_detectedLandscape(landscape)}}</span>
        <div id="calendarSelection" class="layout vertical center center-justified selectedDay landscape">
          <div id="selectedWeekdayHeader" class="layout horizontal">
            <div class="relative flex" id="selectedWeekday">
              <div class="selectedWeekday">{{selectedWeekday}}</div>
            </div>
          </div>

        <div id="selectedDateHeader" class="layout vertical center center-justified landscape">
          <div id="selectedMonth">
            <div class="selectedMonth slideup animate landscape" style="text-transform: uppercase">{{selectedMonth}}</div>
          </div>
          <div id="selectedDay">
            <div class="selectedDay landscape" view="dateView" on-tap="viewSelectAction">{{selectedDay}}</div>
          </div>
          <div id="selectedYear">
            <div class=" landscape selectedYear" view="yearView" on-tap="viewSelectAction">{{selectedYear}}</div>
          </div>
        </div>
      </div>
      </template>
      
      <template is="dom-if" if="{{!landscape}}" on-dom-change="_handleDomChange">
        <div id="calendarSelection">
        <div id="selectedWeekdayHeader" class="layout horizontal">
          <div class="relative flex" id="selectedWeekday">
            <div class="selectedWeekday">{{selectedWeekday}}</div>
            </div>
          </div>

          <div id="selectedDateHeader" class="layout vertical center center-justified">
            <div id="selectedMonth">
              <div class="selectedMonth slideup animate" style="text-transform: uppercase">{{selectedMonth}}</div>
            </div>
            <div id="selectedDay">
              <div class="selectedDay" view="dateView" on-tap="viewSelectAction">{{selectedDay}}</div>
            </div>
            <div id="selectedYear">
              <div class="selectedYear" view="yearView" on-tap="viewSelectAction">{{selectedYear}}</div>
            </div>
            <div id="selectTime">
              <div class=" landscape selectedTime" view="timeView" on-tap="viewSelectAction">{{selectedTime}}</div>
            </div>
          </div>
        </div>
      </template>
      
    </template>

    <div id="calendar" class="layout vertical" on-trackx="trackx" on-trackstart="trackstart" on-trackend="trackend">

      <iron-pages id="views" selected="{{selectedView}}" attr-for-selected="name">
      <section name="dateView">

        <div id="header" class="layout horizontal">
          <paper-icon-button id="previousMonthArrow" icon="ibm-glyphs:backward" on-tap="prevAction" aria-label="Previous Month"></paper-icon-button>
          <div class="flex relative" id="viewingMonthYear">
            <h4 class="viewingMonthYear">
              <span>{{viewingMonth}}</span>
              <span id="yearSelectionSpan" style="cursor: pointer; " class="yearselection" view="yearView" on-tap="viewSelectAction" tabindex="0" aria-label$="{{_viewingMonthYear}}" role="button">{{viewingYear}}</span>
            </h4>
          </div>
          <paper-icon-button id="nextMonthArrow" icon="ibm-glyphs:forward" on-tap="nextAction" aria-label="Next Month"></paper-icon-button>
        </div>
        <div class="weekday">
          <div id="weekday" class="layout horizontal center">
            <template is="dom-repeat" items="{{weekdays}}" as="weekday">
              <div class="weekday-name">{{weekday}}</div>
            </template>
          </div>
        </div>
    		<div id="calendarWeeks">
            <triplat-calendar-weeks id="calendarWeek" date="{{viewingDate}}" picker-date="{{_currentDate}}" initiated-date="{{initiatedDate}}" selected-date="{{selectedDate}}" disallow-past-dates$="{{disallowPastDates}}" disallow-weekends$="{{disallowWeekends}}" restrict-to-date-list$="{{restrictToDateList}}" valid-date-list="{{validDateList}}" triplat-calendar-container="{{triplatCalendarContainer}}" confirm-buttons="{{confirmButtons}}" on-triplat-calendar-date-selected="dateSelectAction" on-triplat-calendar-date-selected-without-confirm-buttons="_returnSelectedDayWithoutConfirmButtons" on-swipe-away="_handleSwipe">
            	</triplat-calendar-weeks>
    		</div>

        <template is="dom-if" if="{{time}}">
         <triplat-calendar-times id="timeSelection" confirm-buttons="{{confirmButtons}}" is-am-pm-format="{{_isAmPmFormat}}" on-triplat-calendar-time-updated="timeUpdateAction" on-triplat-calendar-date-selected="_returnAction" display-seconds$="{{displaySeconds}}" date="[[currentDate]]" step-hour$="{{stepHour}}" step-minute$="{{stepMinute}}" step-second$="{{stepSecond}}">
        </triplat-calendar-times>
      </template>

      <template is="dom-if" if="{{!time}}">
          <div id="space-between-confirmBtn"></div>
      </template>

      <template is="dom-if" if="{{confirmButtons}}">
        <template is="dom-if" if="{{!triplatCalendarContainer}}">
          <div id="confirmButtons" class="buttons layout horizontal">
            <paper-button id="cancelBtn" on-tap="_handleCancel" tabindex="0">Cancel</paper-button>
            <paper-button id="doneBtn" on-tap="_handleOk" tabindex="0">Done</paper-button>
          </div>
        </template>
      </template>
      </section>

      <section name="yearView">
        <triplat-calendar-years id="yearSelection" on-triplat-calendar-year-selected="yearSelectAction" on-triplat-calendar-date-selected="_returnAction" triplat-calendar-container="" viewing-year="{{viewingYear}}">
        </triplat-calendar-years>
      </section>

      </iron-pages>
    </div>
  </div></template>

</dom-module>
<script>
Polymer({

  is: "triplat-calendar",

  behaviors: [
    Polymer.TriPlatCalendarBehavior, 
    Polymer.IronOverlayBehavior,
    Polymer.NeonAnimationRunnerBehavior
  ],

  listeners: {
    'iron-overlay-opened':'_calendarOpened',
    'calendar-weeks-changed':'_handleFitWidthToParentForDays' 
  },

  properties: {

    currentDate: {
      type: Date,
      value: null,
      notify: true,
      observer: "currentDateChanged"
    },


    disallowPastDates: {
      type: Boolean,
    },

    disallowWeekends: {
      type: Boolean,
    },

    restrictToDateList: {
      type: Boolean,
    },

    validDateList: {
      type: Array,
    },

    selectedDate: {
      type: Date,
      observer: "selectedDateChanged"
    },

    selectedView: {
      type: String,
      value: 'dateView'
    },

    disableSelectYear: {
      type: Boolean,
      value: false
    },

    _language: {
      type: String,
      value: "en"
    },

    locale: {
      type: Object,
      value: function() {
        var locale = {
          'en': {
            monthNames: [
            'January',
            'February',
            'March',
            'April',
            'May',
            'June',
            'July',
            'August',
            'September',
            'October',
            'November',
            'December'
            ],
            shortMonthNames: [
            'Jan',
            'Feb',
            'Mar',
            'Apr',
            'May',
            'Jun',
            'Jul',
            'Aug',
            'Sep',
            'Oct',
            'Nov',
            'Dec'
            ],      
            dayNames: [
            'Sunday',
            'Monday',
            'Tuesday',
            'Wednesday',
            'Thursday',
            'Friday',
            'Saturday'
            ],      
            shortDayNames: [
            'S',
            'M',
            'T',
            'W',
            'T',
            'F',
            'S'
            ]
          }
        }
        return locale;
      }
    },

    date: {
      type: Date
    },

    header: {
      type: Boolean,
      value: false
    },

    viewingDate: {
      type: String,
      observer: "viewingDateChanged"
    },

    viewingYear: {
      type: String,
      notify: true
    },

    _viewingMonthYear: {
      type: String,
      computed: '_computeMonthYear(viewingMonth, viewingYear)'
    },

    noCancelOnOutsideClick: {
      type: Boolean,
      value: true
    }, 

    initiatedDate:{
      type: Boolean
    },

    viewingTime:{
      type: String,
      value: "00:00:00",
      notify: true
    },

    time: {
      type: Boolean,
      value: false
    },

    triplatCalendarContainer:{
      type: Boolean,
      value: false
    },

    confirmButtons:{
      type: Boolean,
      value: false
    },

    displayFormat:{
      type: String,
      observer: "_changeDisplayFormat"
    },

    _isAmPmFormat:{
      type: Boolean,
      value: false
    },

    displaySeconds:{
      type: Boolean,
      value: false
    },

    widthOfParent: {
      type: Number,
      value: null,
      observer: "_handleFitWidthToParent"
    },

    _dayWidth: {
      type: Number,
      value: 65
    },

    animationConfig: {
        value: function() {
          return {
            'previous': [
              {
                name: 'slide-from-left-animation',
                node: this.$.calendarWeeks,
              },
              {
                name: 'fade-in-animation',
                node: this.$.calendarWeeks,
              }
            ],
            'next': [ 
              {
                name: 'slide-from-right-animation',
                node: this.$.calendarWeeks,
              },
              {
                name: 'fade-in-animation',
                node: this.$.calendarWeeks,
              }
            ]
          }
        }
    }

  },

  _computeMonthYear: function(month, year) {
    if(this.disableSelectYear){
      this.$.yearSelectionSpan.setAttribute('role', '');
    }
    return month + ' ' + year;
  },

  getFullMonth: function(d) {
    return this.locale[this._language].monthNames[d.getMonth()];
  },

  getShortMonth: function(d) {
    return this.locale[this._language].shortMonthNames[d.getMonth()];
  },

  getDayOfWeek: function(d) {
    return this.locale[this._language].dayNames[d.getDay()];
  },

  getShortDayNames: function() {
    return this.locale[this._language].shortDayNames;
  },

  attached: function() {
    if(this.landscape){
      this.$.wrapper.className = "layout horizontal";
    }
    if (!this.currentDate){
      this.set("selectedDate", new Date());
    } else {
      this.set("selectedDate", new Date(this.currentDate));
    }
    this._setTranslation();
    this.weekdays = this.getShortDayNames();
    this.viewingDate = this.viewingDate || new Date(this.selectedDate);
    this.viewingDate.setDate(1);
    this.nowDate = new Date();
    this.async(function() {
      this._handleTriplatCalendarContainer();
    }, 10);
    this._handleTriplatCalendarBidi();
    this.confirmButtons = this.time ? true : this.confirmButtons;
    this.addEventListener('keyup', this.keyup.bind(this));
  },

  ready: function() {
    this.async(function() {
      this._handleFitWidthToParent();
    }, 10);
  }, 

  _handleFitWidthToParent: function() {
     if (!this.widthOfParent) { return; }

    // in landscape mode, the header is on the left side of the calendar so it needs to be accounted for in the width calculation
    var landscapeHeaderWidth = 100; // set default, in case the landscape dom tree has not been built yet
    if (Polymer.dom(this.root).querySelector("#calendarSelection.landscape") != null) {
       landscapeHeaderWidth = Polymer.dom(this.root).querySelector("#calendarSelection.landscape").offsetWidth;
    }
    var minCalendarWidth = 270; // based on the font used in the small media query, we look ok down to 270px, but then
                                // the days wrap and cause 6 days per week 

    var newWidthPortrait = this.widthOfParent < minCalendarWidth ? minCalendarWidth : this.widthOfParent; // enforce the min width

    var newWidthLandscape = newWidthPortrait;
  
    if (this.header) {
      newWidthLandscape = newWidthLandscape - landscapeHeaderWidth; // subtract the width that the header will consume
      newWidthLandscape = newWidthLandscape < minCalendarWidth ? minCalendarWidth : newWidthLandscape; // enforce min width 
    }

    var newWidth = this.landscape ? newWidthLandscape : newWidthPortrait;

    if (Polymer.dom(this.root).querySelector("#calendarSelection:not(.landscape)") != null) {
      Polymer.dom(this.root).querySelector("#calendarSelection:not(.landscape)").style.width = newWidthPortrait + "px";
      Polymer.dom(this.root).querySelector(":not(.landscape)>#selectedWeekdayHeader").style.width = newWidthPortrait + "px";
    }
    Polymer.dom(this.root).querySelector("#views").style.width = newWidth + "px";
    // match how the media query-based calculations are done, the 
    // width of the weekday name is one-seventh of 91% of the full width.
    var weekdayWidth = (newWidth * 0.91)/7;
    // match how the media query-based calculations are done, the 
    // width of each day is 10 less than the width of the weekday header
    this._dayWidth = weekdayWidth - 10;
    var weekdayNames = Polymer.dom(this.root).querySelectorAll(".weekday-name");
    for (var i=0; i < weekdayNames.length; i++) {
      weekdayNames[i].style.width = weekdayWidth + "px";
    }

    this._handleFitWidthToParentForDays();
  },

  _handleFitWidthToParentForDays: function() {
     if (!this.widthOfParent) { return; }

    var days = Polymer.dom(this.$.calendarWeek.root).querySelectorAll(".day");
    for (var i=0; i < days.length; i++) {
      days[i].style.width = this._dayWidth + "px";
    }
  },

  _handleDomChange: function(){
    this._handleTriplatCalendarContainer();
  },

  _handleTriplatCalendarBidi: function(){
    var textDirectionValue = document.querySelector('body').getAttribute('dir');
    if(textDirectionValue==="rtl"){
      this.$.previousMonthArrow.classList.add('paper-icon-button-rtl');
      this.$.nextMonthArrow.classList.add('paper-icon-button-rtl');
    }
  },

  _handleTriplatCalendarContainer: function(){
    if(this.triplatCalendarContainer) {
      this.$.views.classList.add("_views");
      if(this.$$('#calendarSelection')){
        this.$$('#calendarSelection').classList.add("_calendarSelection");
      }
      if(this.$$('#selectedWeekdayHeader')){
        this.$$('#selectedWeekdayHeader').classList.add("_selectedWeekdayHeader");
      }
      var weekdayName = Polymer.dom(this.root).querySelectorAll(".weekday-name");
      this.async(function(){
         for (var i = 0; i < weekdayName.length; i++){
          weekdayName[i].classList.add("_weekdayName");           
        }
      });
    }else{
      this.$.views.classList.add("views");
      if(this.$$('#calendarSelection')){
        this.$$('#calendarSelection').classList.add("calendarSelection");
      }
      if(this.$$('#selectedWeekdayHeader')){
        this.$$('#selectedWeekdayHeader').classList.add("selectedWeekdayHeader");
      }
    }
  },

  _changeDisplayFormat: function(format){
    if(format){
       if(format.indexOf("a") >-1){
          this.set("_isAmPmFormat", true);       
       }else {
          this.set("_isAmPmFormat", false);
       }
    }
  },

  _init: function() {
    if (!this.currentDate) {
    } else {
        this.set("selectedDate", new Date(this.currentDate));
    }

    this.nowDate = new Date();
    this.weekdays = this.getShortDayNames();
    this.viewingDate = this._getDefaultViewingDate();
    this.addEventListener('keyup', this.keyup.bind(this));
  },

  _getDefaultViewingDate: function() {
    var viewingDate = this.viewingDate;
    if (viewingDate) {
    } else if (this.selectedDate) {
      viewingDate = new Date(this.selectedDate);
    } else {
      viewingDate = this.nowDate;
    }

    viewingDate.setDate(1);

    return viewingDate;
  },

  currentDateChanged: function() {
    if (this.currentDate){
        this.set("selectedDate", new Date(this.currentDate)); 
        this.hour = this.hour ? this.hour : this.currentDate.getHours();
        this.minute = this.minute ? this.minute : this.currentDate.getMinutes();
        this.second = this.second ? this.second : this.currentDate.getSeconds();
        this.viewingDate = new Date(this.selectedDate);
        this._currentDate = this.currentDate;
    }
  },

  selectedDateChanged: function() {
    this.async(this.updateSelectedDateProps);
  },

  viewingDateChanged: function(olddate, newdate) {
    this.async(this.updateViewingDateProps)
  },

  updateSelectedDateProps: function() {
    this.selectedWeekday = this.getDayOfWeek(this.selectedDate);
    this.selectedMonth = this.getShortMonth(this.selectedDate);
    this.selectedDay = this.selectedDate.getDate();
    this.selectedYear = this.selectedDate.getFullYear();
  },

  updateViewingDateProps: function() {
    this.viewingMonth = this.getFullMonth(this.viewingDate);
    this.viewingYear = this.viewingDate.getFullYear();
    this.viewingMonthYear = this.viewingMonth + ' ' + this.viewingYear;
  },

  nextAction: function() {
    this.viewingDate = this.addMonths(this.viewingDate, 1);  
    this.playAnimation('next'); 
  },

  prevAction: function() {
    this.viewingDate = this.addMonths(this.viewingDate, -1);
    this.playAnimation('previous'); 
  },

  viewSelectAction: function(e) {
    if(this.disableSelectYear) return false;
    var target = e.target;
    this.async(function(){
       this.selectedView = target.getAttribute("view");
      // sometimes e.target is paper-ripple, so we need to get the parent
      if (!this.selectedView) {
        this.selectedView = target.parentElement.getAttribute("view");
      }
      this._setFocus(this.selectedView);
    }, 10);
   

  },

  dateSelectAction: function(e) {
    var year = e.detail.date.getFullYear(), 
        month= e.detail.date.getMonth(), 
        date = e.detail.date.getDate();
        this.hour = this.hour ? this.hour : 0;
        this.minute = this.minute ? this.minute : 0;
        this.second = this.second ? this.second : 0;

    this.set("selectedDate", new Date(year, month, date, this.hour, this.minute, this.second));
    this.set("currentDate", this.selectedDate);
    this._handleNoConfirmButtoms();
  },

  _handleNoConfirmButtoms: function(){
    if(this.triplatCalendarContainer) return false;
    if(!this.confirmButtons) {
      this.async(function(){
        this.close();
      }, 10); 
    }
  },

  yearSelectAction: function(e) {
    var year = e.detail.year;
    this.disablePropertyAnimations = true;
    this.viewingDate = new Date(year, this.viewingDate.getMonth(), this.viewingDate.getDay());
    this.viewingYear = year;
    this.async(function(){
      this.$.views.selected = "dateView";
      this._setFocus("dateView");
      this.disablePropertyAnimations = false;
    }, null, 280);
  },

   timeUpdateAction: function(e) {
    if(!this.selectedDate) return;
    var updatedDatetime = e.detail.updatedDatetime;
    this.hour = moment(updatedDatetime).hour();
    this.minute = moment(updatedDatetime).minute();
    this.second = moment(updatedDatetime).second();
    this.set("viewingDate", updatedDatetime)
    this.initiatedDate = true;
    this.set("selectedDate", updatedDatetime);
  },

  _returnAction: function(e) {
    var view = e.detail.view;
    this.selectedView = view;
    this._setFocus(view);
  },

  keyup: function(e){
    var month = this.selectedDate.getMonth();
    switch (e.keyCode) {
      case 37:
          this.prevAction()
          break;
      case 39:
          this.nextAction()
          break;
      case 13:
      case 32:
          // paper elements handle spacebar and enter themselves, so exclude them here
          if (e.target.nodeName.indexOf("PAPER") != 0) {
            e.target.click();
          }
          break;
    }
  },

  _handleOk: function(){
    this.fire("calendar-date-selected", {datetime: this.selectedDate});
    this.set("currentDate", this.selectedDate);
    if(this.time){
      this.set("currentDate", new Date(this.selectedDate.getFullYear(), this.selectedDate.getMonth(), this.selectedDate.getDate(), this.hour, this.minute, this.second));
    }
     this.initiatedDate = true;
    this.async(function(){
      this.close();
    }, 10); 
  },

  _handleCancel: function(){
    if(!this.currentDate){
      this.async(function(){
        this.set("viewingDate", new Date());
      }, 10);
      
      this._currentDate = new Date();
      this.selectedDate = new Date();

      this.hour = 0, this.minute = 0, this.second = 0;
    }
    this.async(function(){
      this.cancel();
    }, 10);
  },

  _detectedLandscape: function(landscape){
    if(landscape){
      Polymer.dom(this.$.wrapper).classList.remove("vertical");
      Polymer.dom(this.$.wrapper).classList.add("horizontal");
    }
    else{
      Polymer.dom(this.$.wrapper).classList.remove("horizontal");
      Polymer.dom(this.$.wrapper).classList.add("vertical");
    }
    this._handleFitWidthToParent();
  }, 

  _handleSwipe: function(e){
    var swipeDirection = e.detail.direction;
    switch(swipeDirection){
      case 1: this.prevAction();
      break;
      case -1: this.nextAction();
      break;
    }
  },

  _setFocus: function(view) {
    var focusElement = null;

    if (view == "dateView") {
      focusElement = this.$.previousMonthArrow;
    } if (view == "yearView") {
      focusElement = this.$.yearSelection.$.previousYearArrow;
    } if (view == "timeView") {
      focusElement = this.$.timeSelection.$.timeViewFirstElement;
    }
    if (focusElement) {
      focusElement.focus();
    }

  }, 

  _resetCalendar: function(){
    if(this.currentDate){
        this.selectedView = "dateView";
        this.set("viewingDate", this.currentDate);
        this.$.yearSelection._resetToCurrentYear(this.currentDate.getFullYear());
    } else{
        this.viewingDate = new Date();
        this.selectedView = "dateView";
        this.$.yearSelection._resetToCurrentYear(new Date().getFullYear());
    }
  },


  _setTranslation: function(){
    var __dictionary__January = "January";
    var __dictionary__February = "February";
    var __dictionary__March = "March";
    var __dictionary__April = "April";
    var __dictionary__May = "May";
    var __dictionary__June = "June";
    var __dictionary__July = "July";
    var __dictionary__August = "August";
    var __dictionary__September = "September";
    var __dictionary__October = "October";
    var __dictionary__November = "November";
    var __dictionary__December = "December";

    var __dictionary__Jan = "Jan";
    var __dictionary__Feb = "Feb";
    var __dictionary__Mar = "Mar";
    var __dictionary__Apr = "Apr";
    var __dictionary__May = "May";
    var __dictionary__Jun = "Jun";
    var __dictionary__Jul = "Jul";
    var __dictionary__Aug = "Aug";
    var __dictionary__Sep = "Sep";
    var __dictionary__Oct = "Oct";
    var __dictionary__Nov = "Nov";
    var __dictionary__Dec = "Dec";

    var __dictionary__Monday = "Monday";
    var __dictionary__Tuesday = "Tuesday";
    var __dictionary__Wednesday = "Wednesday";
    var __dictionary__Thursday = "Thursday";
    var __dictionary__Friday = "Friday";
    var __dictionary__Saturday = "Saturday";
    var __dictionary__Sunday = "Sunday";

    
    

    var __dictionary__M = "M - Short for Monday in Calendar";
    var __dictionary__T = "T - Short for Tuesday in Calendar";
    var __dictionary__W = "W - Short for Wednesday in Calendar";
    var __dictionary__Th = "T - Short for Thursday in Calendar";
    var __dictionary__F = "F - Short for Friday in Calendar";
    var __dictionary__Sa = "S - Short for Saturday in Calendar";
    var __dictionary__Su = "S - Short for Sunday in Calendar";

    this.locale[this._language].monthNames[0] = __dictionary__January; 
    this.locale[this._language].monthNames[1] = __dictionary__February; 
    this.locale[this._language].monthNames[2] = __dictionary__March;
    this.locale[this._language].monthNames[3] = __dictionary__April;
    this.locale[this._language].monthNames[4] = __dictionary__May;
    this.locale[this._language].monthNames[5] = __dictionary__June;
    this.locale[this._language].monthNames[6] = __dictionary__July;
    this.locale[this._language].monthNames[7] = __dictionary__August;
    this.locale[this._language].monthNames[8] = __dictionary__September;
    this.locale[this._language].monthNames[9] = __dictionary__October;
    this.locale[this._language].monthNames[10] = __dictionary__November;
    this.locale[this._language].monthNames[11] = __dictionary__December;

    this.locale[this._language].shortMonthNames[0] = __dictionary__Jan; 
    this.locale[this._language].shortMonthNames[1] = __dictionary__Feb; 
    this.locale[this._language].shortMonthNames[2] = __dictionary__Mar;
    this.locale[this._language].shortMonthNames[3] = __dictionary__Apr;
    this.locale[this._language].shortMonthNames[4] = __dictionary__May;
    this.locale[this._language].shortMonthNames[5] = __dictionary__Jun;
    this.locale[this._language].shortMonthNames[6] = __dictionary__Jul;
    this.locale[this._language].shortMonthNames[7] = __dictionary__Aug;
    this.locale[this._language].shortMonthNames[8] = __dictionary__Sep;
    this.locale[this._language].shortMonthNames[9] = __dictionary__Oct;
    this.locale[this._language].shortMonthNames[10] = __dictionary__Nov;
    this.locale[this._language].shortMonthNames[11] = __dictionary__Dec;

    this.locale[this._language].dayNames[0] = __dictionary__Sunday; 
    this.locale[this._language].dayNames[1] = __dictionary__Monday;
    this.locale[this._language].dayNames[2] = __dictionary__Tuesday; 
    this.locale[this._language].dayNames[3] = __dictionary__Wednesday;
    this.locale[this._language].dayNames[4] = __dictionary__Thursday;
    this.locale[this._language].dayNames[5] = __dictionary__Friday;
    this.locale[this._language].dayNames[6] = __dictionary__Saturday;
    
    this.locale[this._language].shortDayNames[0] = ("S - Short for Sunday in Calendar" !== __dictionary__Su ) ? __dictionary__Su : "S";
    this.locale[this._language].shortDayNames[1] = ("M - Short for Monday in Calendar" !== __dictionary__M ) ? __dictionary__M : "M";
    this.locale[this._language].shortDayNames[2] = ("T - Short for Tuesday in Calendar" !== __dictionary__T) ? __dictionary__T :"T" ;
    this.locale[this._language].shortDayNames[3] = ("W - Short for Wednesday in Calendar"  !== __dictionary__W) ? __dictionary__W : "W";
    this.locale[this._language].shortDayNames[4] = ("T - Short for Thursday in Calendar" !== __dictionary__Th) ? __dictionary__Th : "T";
    this.locale[this._language].shortDayNames[5] = ("F - Short for Friday in Calendar" !== __dictionary__F) ? __dictionary__F : "F"; 
    this.locale[this._language].shortDayNames[6] = ("S - Short for Saturday in Calendar" !==__dictionary__Sa) ? __dictionary__Sa : "S";

  },
  
  _returnSelectedDayWithoutConfirmButtons: function(e){
    this.fire("calendar-date-selected", {datetime: this.selectedDate});
  },

  _calendarOpened: function(){
    this.$.previousMonthArrow.focus();
  },

});
</script><script>
Polymer.TriPlatDateTimePickerBehavior = {
    properties: {
        _hightLighted : {
            type: String,
            value: ""
        },

        dateinvalidMsg:{
            type: String,
            computed: 'computeDateInvalidMsg(displayFormat)'
        },

        dateinvalidMsgViolateRestriction:{
            type: String,
            computed: 'computeDateInvalidMsgViolateRestriction(disallowWeekends, disallowPastDates)'
        }


    },

    formatDate: function (input, format, tz) {
        format = format ? format : this.displayFormat;
        if(!input || Object.prototype.toString.call(input) ==="[object Object]" || !this._hasIsoDateLength(this.value))
            return "";

        var fixedFormat = this._convertToFixedMomentTzFormat(format);
        tz = tz ? tz : this._currentTimeZone;

        var mDatetime = moment(input).tz(tz);
        var translatedMDatetime = mDatetime.locale(this._lang);  
        var formatedDate = translatedMDatetime.formatWithJDF(fixedFormat);
        return formatedDate;
    },

    _convertToFixedMomentTzFormat: function(format){
        format = format || "MM/DD/YYYY hh:mm a";
        if (format.replace(/[^z]/g, "").length===1){
            format = format.replace("z", "zz")
        } 

        else if (format.replace(/[^z]/g, "").length===3){
            format = format.replace("zzz", "zz")
        }
        else if (format.replace(/[^z]/g, "").length===4){
            format = format.replace("zzzz", "zz")
        }

        if(format.replace(/[^M]/g,"").length===5){
            format = format.replace("MMMMM", "MMMM");
        }

        var end = false;
        var fixedFormat = format.replace(/\'/g, function(match) {
          return (end = !end) ? '[' : ']';    
        });
        return fixedFormat;
    },

    _convertStringToDate: function(val, nullDateInvalid) {
        var dataEntryErrorMsg = null;
        var formatedDate;
        
        this._enteredDateValue = val;

        if(!val){
            if(nullDateInvalid) {
                dataEntryErrorMsg = this.dateinvalidMsg; 
                this.value = null;   
            }
            this.set("_errorMsg" , dataEntryErrorMsg);
            var __dictionary__empty = "Empty";
            this.set("_enteredDateValue" , __dictionary__empty);
            return null; 
        }
        var fixedFormat = this._convertToFixedMomentTzFormat(this.displayFormat);
        var momentFormat = moment().toMomentFormatString(fixedFormat);

        moment.locale(this._lang);
        var fieldValueToMoment = moment(val, momentFormat).format();

        if(fieldValueToMoment === "Invalid date"){
            dataEntryErrorMsg = this.dateinvalidMsg;
            this.set("_errorMsg" , dataEntryErrorMsg);
            this.set("_enteredDateValue" , val);
            return null;
        }

        var mDatetime = moment(fieldValueToMoment);
        var datetimeInMillisec = mDatetime.valueOf();
        if(moment.locale() !== 'en') moment.locale('en');

        var datetimeWithoutTz = moment(datetimeInMillisec).format("YYYY-MM-DDTHH:mm:ss");
        var datetimeBasedOnUserTimezone = moment.tz(datetimeWithoutTz, this.timeZone).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
 
        return datetimeBasedOnUserTimezone;
       
    },

    openTriCalendar: function(picker, calendar,phone, header){
        calendar.style.overflow = "auto";
        if(phone || this._isMobileDevice()){
            this._openInMobileDevice(calendar);
        }else{
            this._openInNonMobileDevice(calendar, picker, header);
        }
        calendar.open();
    },

    _openInMobileDevice: function(calendar){
        calendar.resetFit();
        calendar.style.position = '';
        calendar.style.top = '';
        calendar.style.left = '';

        var _top = calendar.style.top;
        var _left= calendar.style.left;
        var _position = calendar.style.position;
        this._handleTriPlatDatetimePickerCalendarPosition(_top, _left, _position);
    },

    _openInNonMobileDevice: function(calendar, picker, header){
        calendar.style.position = "fixed";
        calendar.style.top = picker.getBoundingClientRect().top+"px";
        calendar.style.left = picker.getBoundingClientRect().left+"px";

        var calendarHeight = 512;
        var calendarWidth = 290;
        var _top = calendar.style.top;
        var _left= calendar.style.left;
        var _position = calendar.style.position;

        if (window.innerWidth - picker.getBoundingClientRect().left < calendarWidth){
            var newWPosition = picker.getBoundingClientRect().left - calendarWidth;
            calendar.style.left = newWPosition + "px";
            _left = calendar.style.left;

            if(picker.getBoundingClientRect().left <= calendarWidth){
                calendar.style.left = "0px";
                _left = calendar.style.left;
            }
        }
        if (window.innerHeight - picker.getBoundingClientRect().top <= calendarHeight){
            var newHPosition = picker.getBoundingClientRect().top - calendarHeight;
            newHPosition = newHPosition < 0 ? 0 : newHPosition;
            calendar.style.top = newHPosition + "px";
            _top = calendar.style.top;

            if(picker.getBoundingClientRect().top <= calendarHeight/2){
                calendar.style.top = "0px";
                _top = calendar.style.top;
            }
        }
        if (header){
            var headerHeight = 180;
            if (window.innerHeight - picker.getBoundingClientRect().top <= (calendarHeight + headerHeight)  ){
                    var newHPosition = window.innerHeight/3;
                    calendar.style.top = newHPosition + "px";
                    _top = calendar.style.top;

                if(picker.getBoundingClientRect().top <= (calendarHeight +180)){
                    calendar.style.top = "0px";
                    _top = calendar.style.top;
                }
            }
        }
        this._handleTriPlatDatetimePickerCalendarPosition(_top, _left, _position);
    },

    _isMobileDevice: function () {
        if( navigator.userAgent.match(/Android/i)
             || navigator.userAgent.match(/webOS/i)
             || navigator.userAgent.match(/iPhone/i)
             || navigator.userAgent.match(/iPad/i)
             || navigator.userAgent.match(/iPod/i)
             || navigator.userAgent.match(/BlackBerry/i)
             || navigator.userAgent.match(/Windows Phone/i)
        ){
            return true;
        }
        else {
            return false;
        }
    },

    _directEditRestrictedDateCheck: function(momentDate) {
        var dateObj =  new Date(moment(momentDate).format("YYYY-MM-DDTHH:mm:ss.SSSZ"));
        if (!this._isDateObject(dateObj)) {
            // For Arabic (and perhaps other languages), format("YYYY-MM-DDTHH:mm:ss.SSSZ") does not work, so use toISOString()
            dateObj =  new Date(moment(momentDate).toISOString());
            if(!this._isDateObject(dateObj)){
                dateObj = null; 
            }
        }
        if (this.disallowWeekends) {
            var day = dateObj.getDay();
            if (day == 0 || day == 6) {
                this.set("_errorMsg" , this.dateinvalidMsgViolateRestriction);
            }
        }
        if (this.disallowPastDates) {
            var today = new Date();
            if (dateObj.getTime() < today.getTime()) {
                this.set("_errorMsg" , this.dateinvalidMsgViolateRestriction);
            }
        }
      },

    computeDateInvalidMsg: function(displayFormat){
        var __dictionary__erroMsg = "The expected format is {dateFormat}. For example, {example}.";
        
		var d = new Date();
        var fixedFormat = this._convertToFixedMomentTzFormat(this.displayFormat);
        var momentFormat = moment().toMomentFormatString(fixedFormat);
        var example = moment(d).tz(this._currentTimeZone).format(momentFormat);
        displayFormat = "\""+displayFormat+"\"";
        var _temp = __dictionary__erroMsg.replace("{dateFormat}", displayFormat).replace("{example}", example);
        __dictionary__erroMsg = _temp;
        return __dictionary__erroMsg;
    },

    computeDateInvalidMsgViolateRestriction: function(disallowWeekends, disallowPastDates){
        var __dictionary__erroMsgViolateRestriction = "The date violates one or more of the restrictions specified by {restrictionAttributes}.";
        var restrictionAttributes = null;

        if (disallowPastDates && disallowWeekends) {
            restrictionAttributes = "disallow-weekends and disallow-past-dates";
        } else if (disallowWeekends) {
            restrictionAttributes = "disallow-weekends"
        } else if (disallowPastDates) {
            restrictionAttributes = "disallow-past-dates";
        }

        var _temp = __dictionary__erroMsgViolateRestriction.replace("{restrictionAttributes}", restrictionAttributes);
        __dictionary__erroMsgViolateRestriction = _temp;
        return __dictionary__erroMsgViolateRestriction;
    },

    _handleTriPlatDatetimePickerCalendarPosition: function(_top, _left, _position){
        this.customStyle['--tri-datetime-picker-calendar-position-top'] = _top + " !important";
        this.customStyle['--tri-datetime-picker-calendar-position-left'] = _left + " !important";
        this.customStyle['--tri-datetime-picker-calendar-position'] = _position + " !important";
        this.updateStyles();
    },

    _hasIsoDateLength: function(date) {
        return date.length === this._isoDateLength || date.length === this._isoUTCDateLength;   
    } 
}
</script><script>
	TriplatInputContainerBehavior = {

		properties: {
			/**
   		 * Internally set to a unique value so that aria will work properly
   		 */
			_labelId: {
  			type: String,
  			readOnly: true
  		},
			/**
   		 * Internally set to a unique value so that label will work properly
   		 */
  		_inputId: {
  			type: String,
  			readOnly: true
  		}
		},

		ready: function() {
			this._set_labelId(this._generateInputId());
			this._set_inputId(this._generateInputId());
		},

		_generateInputId: function(){ 
	    var d = new Date().getTime();
	    var uid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, 
	    	function(c) {
	        var r = (d + Math.random()*16)%16 | 0;
	        d = Math.floor(d/16);
	        return (c == 'x' ? r : (r&0x7|0x8)).toString(16);
	    });
	    return 'input'+uid;
		}
	}
</script><script src="../jsTimezoneDetect/jstz.min.js"></script><script src="../moment/moment.js"></script><script src="../moment-timezone/builds/moment-timezone-with-data-2010-2020.js"></script><script src="../moment-jdateformatparser/moment-jdateformatparser.min.js"></script><script src="../moment/min/locales.min.js"></script><dom-module id="triplat-datetime-picker" assetpath="../triplat-datetime-picker/">
	<style include="iron-flex iron-flex-alignment">

	paper-icon-button {
     	padding: 0px;
        height: var(--triplat-date-picker-icon-size, 24px);
        width: var(--triplat-date-picker-icon-size, 24px);
        --iron-icon-fill-color: var(--triplat-date-picker-icon-color, --tri-primary-content-color);
        bottom:3px;
        @apply(--triplat-date-picker-icon);
	}

	paper-input {
		width: var(--triplat-date-picker-width);
	}

	paper-dialog {
		position: fixed;
		width: 60%;
		margin: 0px;	
	}

	.__triPlatDatetimePickerCalendar {
		top: var(--tri-datetime-picker-calendar-position-top);
		left: var(--tri-datetime-picker-calendar-position-left);
		position: var(--tri-datetime-picker-calendar-position);
	}

	#content {
		display:none;
	}
	</style>
	<template>

		<iron-media-query query="max-width: 414px" query-matches="{{phone}}"></iron-media-query>
		<paper-input-container hidden="{{_readonlyNoDisabledNoLabel(disabled,readonly,label)}}" class="flex" on-change="_directEdit" invalid="[[invalid]]" aria-label$="[[label]]" always-float-label$="[[alwaysFloatLabel]]" disabled$="[[disabled]]" no-label-float$="[[noLabelFloat]]" focused="{{focused}}">
  			<label id="[[_labelId]]" for$="[[_inputId]]">[[label]]<content id="labelContent" select="[label]"></content></label>
  			<input is="iron-input" id="[[_inputId]]" aria-labelledby$="[[_labelId]]" pattern$="[[_datetimePattern]]" readonly$="[[readonly]]" disabled$="[[disabled]]" bind-value$="{{formatDate(value, displayFormat, timeZone)}}" on-input="_fireInputChanged" tri-scroll-into-view="">
			<template is="dom-if" if="{{_notDisabledReadonly(disabled,readonly)}}">
			  	<paper-icon-button suffix="" icon="ibm:calendar" id="picker" on-tap="_openTriCalendar" aria-label$="{{_setPickerAriaLabel(label)}}">
		  		</paper-icon-button>
		  	</template>
	  		<paper-input-error>[[_hightLighted]]</paper-input-error>
  		</paper-input-container>
		<template is="dom-if" if="{{_readonlyNoDisabledNoLabel(disabled,readonly,label)}}">
			<span>{{formatDate(value, displayFormat, timeZone)}}</span>
		</template>
		<template is="dom-if" if="{{_notDisabledReadonly(disabled,readonly)}}">
			<triplat-calendar id="calendar" class="__triPlatDatetimePickerCalendar" no-cancel-on-esc-key="{{_noCancelOnEscKey}}" no-cancel-on-outside-click="{{_noCancelOnOutsideClick}}" header="{{header}}" current-date="{{_changeToBrowserTimeZone(_dateValue)}}" initiated-date="{{_initiatedDate}}" time="{{_time}}" military-time="{{_militaryTime}}" disallow-past-dates$="{{disallowPastDates}}" disallow-weekends$="{{disallowWeekends}}" restrict-to-date-list$="{{restrictToDateList}}" valid-date-list="{{validDateList}}" on-calendar-date-selected="_getDateTime" display-format="{{displayFormat}}" display-seconds$="{{displaySeconds}}" disable-select-year$="{{disableSelectYear}}" on-iron-overlay-opened="_openCalendar" on-iron-overlay-closed="_closeCalendar" step-hour="{{stepHour}}" step-minute="{{stepMinute}}" step-second="{{stepSecond}}">
			</triplat-calendar>
		</template>
		<paper-dialog id="directentryerror" no-cancel-on-outside-click="" role="alertdialog">
			<h2>Invalid value: <span>{{_enteredDateValue}}</span></h2>
			<div>{{_errorMsg}}</div>
		    <div class="buttons">
		        <paper-button id="triCloseButton" dialog-dismiss="">Close</paper-button>
		    </div>

		</paper-dialog>
	</template>
</dom-module>
<script>
	Polymer({

	  is: "triplat-datetime-picker",

	  /**
       * Fired when the datetime-picker value changes.
       *
       * @event datetime-picker-change
       */

       /**
       * Fired when the datetime-picker input changes due to user interaction.
       *
       * @event datetime-picker-user-change
       */

       /**
       *  Fired every time the value is typed into the datetime-picker input field.
       *
       * @event datetime-picker-input-change
       */

	  behaviors: [ 
			Polymer.TriPlatDateTimePickerBehavior,
			TriDateUtilities,
			TriplatInputContainerBehavior,
			TriBlockScrollFieldIntoViewBehavior
	  ],

	  listeners: {
			'calendar-date-selected': '_calendarDateSelected',
	  },

	  properties: {

			/**
			 * The ISO date format 
			 */
	  		value: {
	  			type: String,
	  			notify: true,
	  			observer: "_valueChanged"
	  		},

	  		/**
	  		 * Representation of the value as a java.util.Date object
	  		 */
	  		_dateValue: {
	  			type: Date,
	  			observer: "_dateValueChanged"
	  		},

	  		/**
	  		  * Flag indicating whether to display a block above the calendar containing
	  		  * the day of the week, month, day, and year of the currently selected value.<br>
	  		  * <b>true</b> means display the header above the calendar.<br>
	  		  * <b>false</b> means just display the calendar without the header block.<br>
	  		  */
	  		header: {
	  			type: Boolean,
	  			value: false
	  		},

	  		/**
	  		  * String value to be used for the label.
	  		  */
	  		label: {
	  			type: String,
	  			value: null
	  		},

	  		/** 
	  		  * Boolean value to indicate that this is a disabled date value input field. Show
	  		  * the value, but not the datetime picker. The value will be grayed out and not editable.
	  		  * The value will be underlined to indicate it is an input field.
	  		  */
	  		disabled: {
	  			type: Boolean,
	  			value: false
	  		},

	  		/** 
	  		  * Boolean value to indicate that this is a readonly date value. Show
	  		  * the value, but not the datetime picker.
	  		  */
	  		readonly: {
	  			type: Boolean,
	  			value: false
	  		}, 

	  		/** 
	  		  * Boolean value to indicate that a null date should be considered as invalid.
	  		  */
	  		nullDateInvalid: {
	  			type: Boolean,
	  			value: false
	  		}, 

	  		/**
	  		  * String value that is null when no error exists or it contains the current error
	  		  * message if the existing value is invalid.
	  		  */
	  		_errorMsg: {
	  			type: String,
	  			value: null,
	  			notify: true
	  		},

	  		/**
	  		  * Flag indicating whether to display time in the calendar.<br>
	  		  * <b>true</b> means display the time in the calendar.<br>
	  		  * <b>false</b> means just display the calendar without the time.<br>
	  		  */
	  		_time: {
	  			type: Boolean,
	  			value: true
	  		},

	  		_militaryTime: {
	  			type: Object,
	  			value: true
	  		},

	  		/**
	  		  * String value to be used for the time zone.
	  		  */ 
	  		timeZone:{
	  			type: String,
	  			observer: "_timeZoneChanged"
	  		},

	  		_currentTimeZone:{
	  			type: String
	  		},

	  		_initiatedDate:{
	  			type: Boolean
	  		},

	  		_datetimeInvlidmsg:{
	  			type: String
	  		},

	  		_datetimePattern:{
	  			type: String
	  		},
	  		_enteredDateValue:{
	  			type: String
	  		},

	  		/**
	  		  * Flag indicating whether to disable weekends and make them become gray color and unselectable in the calendar.<br>
	  		  */
	  		disallowWeekends: {
		      	type: Boolean,
		      	value: false
		    },
		    /**
			  * Flag that indicates whether to allow the user to select any date, or just select dates 
			  * in the future. If this is specified, then only dates in the future, excluding today's date, will be able 
			  * to be selected. Even if the specific hour is in the future, the user still cannot select today's date.
			  **/
		    disallowPastDates:{
		    	type: Boolean,
		      	value: false
		    },
		    /**
				*Datetime format strings
		     */
		    displayFormat: {
		    	type: String,
		    	value: "MM/DD/YYYY hh:mm a"
		    },

		    _noCancelOnOutsideClick:{
		    	type: Boolean,
		    	value: false
		    },

		    _noCancelOnEscKey:{
		    	type: Boolean,
		    	value: false
		    },

			/**
			 * True if the input has focus.
			 */
			focused: {
				type: Boolean,
				value: false,
				notify: true
			},

			/**
			 * True if the input is invalid.
			 */
			invalid: {
				type: Boolean,
				value: false,
				notify: true,
				reflectToAttribute: true
			},

		    _isoDateLength: {
		    	type: Number,
		    	value: (moment().format("YYYY-MM-DDTHH:mm:ss.SSSZ")).length
		    },
			/**
		     * Returns the length of a datetime using the UTC time zone.
		     * For example "2016-06-08T23:30:00.000Z" is a datetime with the UTC timezone.
		     */
		    _isoUTCDateLength: {
		    	type: Number,
		    	value: ("YYYY-MM-DDTHH:mm:ss.SSSZ").length
		    },
			
		    /**
			  * Flag that indicates whether to allow the message to alert when the user enters an invalid datetime.
			  **/
		    disableErrorMsg: {
		    	type: Boolean,
		    	value: false
		    }, 

		    /**
	  		  * Set to true to always float the label.
	  		  */
		    alwaysFloatLabel: {
		    	type: Boolean,
		    	value: false
		    },

		    /**
			  * Set to true to disable the floating label.
			  **/
		    noLabelFloat: {
		    	type: Boolean,
		    	value: false
		    },

		    /**
			  * Set to true to disable select year.
			  **/
		    disableSelectYear: {
		    	type: Boolean,
		    	value: false
		    },

		    /**
			  * Set to true to display seconds.
			  **/
		    displaySeconds: {
		    	type: Boolean,
		    	value: false
		    },

		    /*
			 * Amount to add or subtract when increasing or decreasing hours.
			 */
			stepHour: {
				type: Number,
				value: 1
			},

		    /*
			 * Amount to add or subtract when increasing or decreasing minutes.
			 */
			stepMinute: {
				type: Number,
				value: 1
			},

		    /*
			 * Amount to add or subtract when increasing or decreasing seconds.
			 */
			stepSecond: {
				type: Number,
				value: 1
			},

			_userValueChange: {
		    	type: String,
		    	observer: "_fireUserChanged"
		    }, 

		    _lang: String,
	  },

	  _calendarDateSelected: function() {
    		this.set("_errorMsg" , null);
	  },

	  /* Neither disabled nor readonly flag were set
	  */
	  _notDisabledReadonly: function(disabled,readonly) {
	  	return !disabled && !readonly;
	  },

	  /* readonly flag was set, but disabled was not set
	  */
	  _readonlyNoDisableLabel: function(disabled,readonly, label) {
	  	return !disabled && readonly && label;
	  },

	  _readonlyNoDisabledNoLabel: function(disabled,readonly,label) {
	  	return !disabled && readonly && !label;
	  },

	  _dateValueChanged: function() {
	  	this._initiatedDate = false;
	  	if(this._calendarIconIsTapped) {
	  		this._calendarIconIsTapped = false; 
	  		return;
	  	}

		// When the input field holds an invalid value, set an empty string before setting the selected value.
		if (this.invalid) { this.set("value", ""); }

	  	if (this._dateValue) {
	  		this.set("value", moment(this._dateValue).tz(this.timeZone).format("YYYY-MM-DDTHH:mm:ss.SSSZ"));
	  	}
	  },

	  /**
	    * Handle user directly entering a new value into the input field
	    * without using the calendar.
	    */
	  _directEdit: function(e) {
	  	this.set("_errorMsg" , null);
	  	var newDate = this._convertStringToDate(e.target.value, this.nullDateInvalid);
	  	if (this._errorMsg ===null) {
	  		this._directEditRestrictedDateCheck(newDate);
	  	}
		if (this._errorMsg===null) {
			if (newDate === null) {
				this.invalid = false;
				this.set("value", null);
				
			} else {
				this.invalid = false;
				this.set("value", newDate);				
				this.currentTime = newDate;

			}
		} else {
			this.invalid = true;
			if(!this.disableErrorMsg){
				this.$.directentryerror.style.top = this.getBoundingClientRect().top + "px";
				this.$.directentryerror.style.left = this.getBoundingClientRect().left + "px";
				this.$.directentryerror.toggle();
			}
		}
		this._userValueChange = this.value;
	  }, 

	  _openTriCalendar: function(){
	  	this._calendarIconIsTapped = true;
	  	var dateObj = null; 
	  	if(this.value){
        	this.value = String(this.value);
        	if(this.value.replace(/[^T]/g, "").length > 0){
	       		var withoutTimeIndex = this.value.indexOf("T");
	        	var dateString = this.value.substring(0, withoutTimeIndex);
	        	dateObj =  new Date(moment(this.value).tz(this.timeZone).format("YYYY-MM-DDTHH:mm:ss.SSSZ"));
	        	if (!this._isDateObject(dateObj)){ 
		        	// For Arabic (and perhaps other languages), format("YYYY-MM-DDTHH:mm:ss.SSSZ") does not work, so use toISOString()
	        		dateObj =  new Date(moment(this.value).tz(this.timeZone).toISOString());
	        		if(!this._isDateObject(dateObj)){
	        			dateObj =  new Date(moment(dateString).tz(this.timeZone));
	        			if (!this._isDateObject(dateObj)) {
					   	dateObj = null; 
						}
	        		}
	        	}
        	}else{
        		dateObj = null;
        	}
        	
        } else{
        	dateObj = null;
        }

	  	this.set("_dateValue", dateObj);

	  	this.openTriCalendar(this.$$("#picker"), this.$$("#calendar"), this.phone, this.header);
	  },

	  created: function(){
	  	this._currentTimeZone = jstz.determine().name();
	  	this._handleLocale();
	  },

	  attached: function(){
	  	this.timeZone = this.timeZone ? this.timeZone : this._currentTimeZone;
	  	this.allowPastDates = true;
	  	this._initiatedDate = this.value ? true : false;
	  	this._convertedToLocalTimeZone();	
	  	this._handleCustomLabel();
	  }, 

	  _handleLocale: function(){
	  	var lang = document.querySelector('html').getAttribute("lang") || 'en';
	  	//TODO to remove this later when have a better way/implementation to handle mock user.
	  	this._lang = (lang === "mock-USER") ? "en" : lang;
	  	moment.locale('en');
	  },

	   _convertedToLocalTimeZone: function(){
	   	if(this.timeZone){
	   		if (this.value && this._hasIsoDateLength(this.value)){
	  			var currentTimeZone = (moment.tz(this.value, this.timeZone)).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
	  			this.value = currentTimeZone;
	  		}
	   	}else{
	   		if (this.value && this._hasIsoDateLength(this.value)){
	  			var currentTimeZone = (moment.tz(this.value, this._currentTimeZone)).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
	  			this.value = currentTimeZone;
	  		}
	   	}

	  },

	  _timeZoneChanged: function(newtz, oldtz){
		  	if (this.value && this._hasIsoDateLength(this.value) && newtz && oldtz ){
		  		var currentTimeZone = moment.tz(this.value, oldtz); 
			  	var newTimeZone = (currentTimeZone.clone().tz(newtz)).format("YYYY-MM-DDTHH:mm:ss.SSSZ"); 
			  	this.value = newTimeZone;
		  			
		  	}
	  }, 
	 
	  _getDateTime: function(e){
	  	var calendarDatetime = e.detail.datetime;
	  	// as is but in the different timezone based on user's profile
	  	var year = calendarDatetime.getFullYear(), 
	  		month = calendarDatetime.getMonth() + 1, month = month <= 9  ? "0" + month : month;
	  	var date = calendarDatetime.getDate() <= 9 ? "0" + calendarDatetime.getDate() : calendarDatetime.getDate(),
	  		hour = calendarDatetime.getHours() <= 9 ? "0" + calendarDatetime.getHours() : calendarDatetime.getHours(),
	  		minute = calendarDatetime.getMinutes() <= 9 ? "0" + calendarDatetime.getMinutes() : calendarDatetime.getMinutes(),
	  		second = calendarDatetime.getSeconds() <= 9 ? "0" + calendarDatetime.getSeconds() : calendarDatetime.getSeconds(); 
	  	moment.locale('en');
	  	var dateTimeInCurrentUserTz = moment.tz( year + "-" + month + "-" + date  + " " + hour  + ":" + minute  + ":" + second, this.timeZone).format();
	  	this._calendarIconIsTapped = false;
	  	this.set("_dateValue", dateTimeInCurrentUserTz);
	  	this.invalid = false; 
	  	this._userValueChange = this.value;
	  },
	  
	  _setPickerAriaLabel: function(val){
        if (!val) {
           return "";
        }

		return "Select " + val;
 	  },

 	  _closeCalendar: function(e){
 	  	this.$$("#calendar")._resetCalendar();	
 	  	this.$$("#"+this._inputId).focus();
 	  },

 	  _openCalendar: function(){
	  	this._calendarState = true;
	  	this._handleBrowserResize();
	  },

 	  _changeToBrowserTimeZone: function(val){
	  	// return the date object of the browser timezone
	  	if (val){
	  		this.timeZone = this.timeZone ? this.timeZone : this._currentTimeZone;
		  	var valueTz = moment(val).tz(this.timeZone);

		  	var browerTimeZone = new Date(valueTz.year(), valueTz.month(), valueTz.date(), valueTz.hour(), valueTz.minute(), valueTz.second());
		  	return browerTimeZone;
	  	}
	  	return moment(this._getCurrentDateString()).toDate();
	  },

	  /**
	    * Handle clear value from the input field.
	    */
	  clearDatetimeValue: function(){
	  	this.value = null;
	  	this._userValueChange = this.value;
	  	this.$$('input').bindValue = null;
	  	this.$.directentryerror.close();
	  	this.invalid = false;

	  	var todayDate = moment().format("YYYY-MM-DD");
	  	this.$$("triplat-calendar").currentDate = moment(todayDate).toDate();
	  },

	  _valueChanged:function(){
	  	this.fire("datetime-picker-change", {date: this.value});
	  },

	  _handleCustomLabel: function(){
		if(Polymer.dom(this.$$('#labelContent')).getDistributedNodes().length >0){
			this.label=" ";
		}
	  },

	  _handleBrowserResize: function(){
	  	var self = this;
	  	window.onresize = function(){
	  		self._openInMobileDevice(self.$$("#calendar"));
	  	} 
	  },

	  _fireInputChanged: function(){
	  	this.fire('datetime-picker-input-change');
	  },

	  // This event get fired when user edit or input a new date string value in the field and tab out
	  // or click on the date from the calendar 
	  _fireUserChanged: function(){
	  	this.fire('datetime-picker-user-change', {value: this.value});
	  },

	});
</script><script>

(function () {

	TriReservationUtilitiesBehavior = {

		properties: {
			isBusy: {
				type: Boolean,
				notify: true,
				value: false
			},

			currentReservationId: {
				type: String,
				value: null,
			},

			reservationManagerSpecId: {
				type: String,
				value: null,
				notify: true
			},

			isOutlookEmbedded: {
				type: Boolean,
				value: false
			},

			occurrenceStart: {
				type: String,
				value: null
			},

			occurrenceEnd: {
				type: String,
				value: null
			}
		},

		listeners: {
			"action-toggle-room-favorite": "_handleToggleRoomFavorite",
		},

		/**
			* Room Favorite
			*/
		_handleToggleRoomFavorite: function (e) {
			var roomId = e.detail.roomId;
			if (!roomId) {
				return;
			}

			var isFavorite = e.detail.isFavorite;
			var selectedRoom = { _id: roomId };

			if (isFavorite) {
				this.$.favoriteRooms.addRecord(selectedRoom, TriPlatDs.RefreshType.CLIENT).then(function () {
				}.bind(this));
			} else {
				this.$.favoriteRooms.removeRecord(selectedRoom, TriPlatDs.RefreshType.CLIENT).then(function () {
				}.bind(this));
			}
		},

		/**
			* Reservation Manager Functions
			*/

		/**
			* Used to determine whether to create/fetch a Reservation Manager or to reset the context
			*/
		_getRM: function (reservationId, buildingId) {
			return new Promise(function (resolve) {
				if (!this.reservationManager) {
					this._createRM(reservationId, buildingId).then(function () {
						resolve();
					}.bind(this));
				} else {
					this._resetContext(reservationId, buildingId).then(function () {
						resolve();
					}.bind(this));
				}
			}.bind(this));
		},

		_createRM: function (reservationId, buildingId) {
			return new Promise(function (resolve) {

				if (this.isOutlookEmbedded) {

				} else {
					var preCreate = {
						start: this._getDefaultStartDate(),
						end: this._getDefaultEndDate(),
						isUX: true,
						searchBuilding: buildingId ? { id: buildingId } : {}
					};

					this._cleanupOldRMs();

					this.$.myReservationManagers.refresh().then(function () {
						if (this.myReservationManagers && this.myReservationManagers.length > 0) {
							var existingReservationManager = this.myReservationManagers[0];

							if (existingReservationManager && existingReservationManager._id) {
								this._initRM(existingReservationManager._id, reservationId, true).then(function () {
									resolve();
								}.bind(this));
							} else {
								this.$.myReservationManagers.createRecord(preCreate, TriPlatDs.RefreshType.SERVER, "actions", "preCreate").then(function (newId) {
									this._initRM(newId, reservationId, false).then(function () {
										resolve();
									}.bind(this));
								}.bind(this));
							}
						} else {
							this.$.myReservationManagers.createRecord(preCreate, TriPlatDs.RefreshType.SERVER, "actions", "preCreate").then(function (newId) {
								this._initRM(newId, reservationId, false).then(function () {
									resolve();
								}.bind(this));
							}.bind(this));
						}
					}.bind(this));
				}
			}.bind(this));
		},

		/**
			* Used to reset the reservation manager context (when creating new or opening existing reservations)
			*/
		_resetContext: function (reservationId, buildingId) {
			return new Promise(function (resolve) {
				this.reservationManager.userMessage = "";
				this.reservationManager.reservationStartTime = this.occurrenceStart;
				this.reservationManager.reservationEndTime = this.occurrenceEnd;

				var wfParams = {};
				wfParams.reservation = reservationId;

				this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "resetContext", wfParams).then(function () {
					this.$.reservationLocations.refresh().then(function () {
						this.$.exceptionOccurrences.refresh().then(function () {
							this.$.reservationManagerInstance.refresh().then(function () {
								resolve();
							}.bind(this));
						}.bind(this));
					}.bind(this));
				}.bind(this));
			}.bind(this));
		},

		/**
			* Used to cancel a reservation (via the Reservation Manager)
			*/
		_cancelRM: function () {
			return new Promise(function (resolve) {
				this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "cancel").then(function () {
					this.set("currentReservationId", null);

					resolve();
				}.bind(this));
			}.bind(this));
		},

		/**
			* Cleanup any old Reservation Managers (see myOldReservationManagers datasource)
			*/
		_cleanupOldRMs: function () {
			return new Promise(function (resolve) {
				this.$.myOldReservationManagers.refresh().then(function () {
					var myOldReservationManagers = this.myOldReservationManagers;
					var RMsToDelete = [];
					for (var index = 0; index < myOldReservationManagers.length; index++) {
						var oldReservationManager = myOldReservationManagers[index];

						RMsToDelete.push(oldReservationManager._id);
					}

					if (RMsToDelete.length > 0) {
						this.$.myOldReservationManagers.deleteRecord(RMsToDelete, TriPlatDs.RefreshType.NONE).then(function () {
							resolve();
						})
					} else {
						resolve();
					}
				}.bind(this));
			}.bind(this));
		},

		/**
			* Used to initialize a Reservation Manager
			*/
		_initRM: function (id, reservationId, isReinit) {
			return new Promise(function (resolve) {
				this.reservationManagerSpecId = id;

				this.$.reservationManager.refresh().then(function () {
					if (reservationId) {
						this._resetContext(reservationId).then(function () {
							resolve();
						}.bind(this));
					} else {
						if (isReinit) {
							this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "resetContext").then(function () {
								this.$.reservationLocations.refresh().then(function () {
									this.$.exceptionOccurrences.refresh().then(function () {
										this.$.reservationManagerInstance.refresh().then(function () {
											resolve();
										}.bind(this));
									}.bind(this));
								}.bind(this));
							}.bind(this));
						} else {
							resolve();
						}
					}
				}.bind(this));
			}.bind(this));
		},

		_goReservationList: function () {
			if (this.reservationManager) {
				this._setBusy();
				this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "cleanup").then(function () {
					this._clearBusy();

					this._refreshReservationList();
					this.fire("navigate-reservation-list");
				}.bind(this));
			} else {
				this._refreshReservationList();
				this.fire("navigate-reservation-list");
			}
		},

		// TODO: Refactor - centralized datasource management?
		_refreshReservationList: function () {
			this._setBusy();

			this.$.reservationInstances.refresh().then(function () {
				this._clearBusy();

				if (this.$.reservationListPage) this.$.reservationListPage._refreshReservationList();
				if (this.$.myReservationEvents) this.$.myReservationEvents.refresh();
			}.bind(this));
		},

		// TODO: Refactor?
		_getDefaultStartDate: function () {
			var returnValue = null;

			if (this.isOutlookEmbedded) {
				if (this.outlookDataObserver && this.outlookDataObserver.startDate) {
					returnValue = this.outlookDataObserver.startDate;
				} else {
					// Generating a new date because there is no outlookDataObserver.startDate
					returnValue = new Date();
				}
			} else {
				returnValue = new Date();
			}

			return returnValue;
		},

		// TODO: Refactor?
		_getDefaultEndDate: function () {
			var returnValue = null;

			if (this.isOutlookEmbedded) {
				if (this.outlookDataObserver && this.outlookDataObserver.endDate) {
					returnValue = this.outlookDataObserver.endDate;
				} else {
					// Generating a new date because there is no outlookDataObserver.endDate
					returnValue = new Date();
				}
			} else {
				returnValue = new Date();
			}

			return returnValue;
		},

		_setToastMsg: function (msg) {
			if (this.$.toast) {
				this.$.toast.text = msg;
				this.$.toast.show();
			}
		},

		_cancelSuccess: function () {
			var __dictionary__toastCancelText = "Reservation Cancelled";
			this._setToastMsg(__dictionary__toastCancelText);
		},

		_checkinSuccess: function () {
			var __dictionary__toastCheckinText = "You are checked-in.";
			this._setToastMsg(__dictionary__toastCheckinText);
		},

		_checkoutSuccess: function () {
			var __dictionary__toastCheckoutText = "You have been checked-out.";
			this._setToastMsg(__dictionary__toastCheckoutText);
		},

		_earlyendSuccess: function () {
			var __dictionary__toastEarlyendText = "Your meeting has been ended early.";
			this._setToastMsg(__dictionary__toastEarlyendText);
		},

		_setBusy: function () {
			this.set("isBusy", true);
		},

		_clearBusy: function () {
			this.set("isBusy", false);
		},

		_isBusy: function () {
			return this.isBusy;
		},

		_isSameDate: function (timezone, datetime1, datetime2) {
			if (!datetime2) {
				datetime2 = new Date();
			}

			var d1Mo = moment(datetime1).tz(timezone);
			var d2Mo = moment(datetime2).tz(timezone);

			return d1Mo.isSame(d2Mo, 'day');
		},

		_isSeries: function (eventItem) {
			return eventItem._Part_of_Recurring_Event;
		},

		_computeImageUrl: function (img, baseUrl) {
			if (!img) {
				return "";
			}

			var url = baseUrl + img;

			return url;
		},

		// Determine if this is an outlook reservation being opened outside an outlook embedded scenario.
		_isOutsideOutlook: function(isOutlookEmbedded, reservationManager) {
			return !isOutlookEmbedded && this._isOutlookMeeting(reservationManager);
		},

		// Determine if this should be read-only due to the fact that this is an outlook meeting being opened outside of outlook.
		_isReadOnlyOutlook: function(isOutlookEmbedded, reservationManager) {
			return this._isOutsideOutlook(isOutlookEmbedded, reservationManager);
		},

		// Determine if this should be read-only (like trying to edit from non-outlook embedded scenarios).
		_isOutlookMeeting: function(reservationManager) {
			return reservationManager != null && reservationManager.iCalUID != null && reservationManager.iCalUID.length > 0;
		}

	}

})();

</script><dom-module id="tricomp-reservation-date" assetpath="../triapp-reservation-list/">
    <template>
        <style>
            :host[disabled] {
                visibility: hidden;
            }
            
            p {
                margin: 0;
                font-size: 22px;
                white-space: nowrap;
            }
            
            .day-header {
                font-weight: bold;
                color: black;
            }
            
            .today {
                color: var(--ibm-teal-40);
            }
            
            .date {
                text-transform: uppercase;
                font-size: 20px;
                font-weight: 300;
            }
        </style>

        <p class$="[[_computeHeaderClass(datetime, currentUser._TimeZoneId)]]">[[day]]</p>
        <p class="date">
            <triplat-datetime-picker value="[[date]]" display-format="[[_computeDateDisplayFormat(currentUser._DateTimeFormat)]]" time-zone="[[currentUser._TimeZoneId]]" readonly=""></triplat-datetime-picker>
        </p>
    </template>
    <script>
        
        Polymer({

            is: "tricomp-reservation-date",

            behaviors: [TriReservationUtilitiesBehavior],

            properties: {
                day: String,
                date: String,
                datetime: Date,
                currentUser: Object,
                disabled: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                }
            },

            _computeHeaderClass: function (datetime, timezone) {
                if (this._isSameDate(timezone, datetime)) {
                    return "day-header today";
                } else {
                    return "day-header";
                }
            },

            _computeDateDisplayFormat: function (userDateTimeFormat) {
                if (userDateTimeFormat) {
                    var dateTimeFormatSplit = userDateTimeFormat.trim().split(" ");
                    return dateTimeFormatSplit[0].startsWith("dd") || dateTimeFormatSplit[0].endsWith("dd") ? "DD MMM" : "MMM DD";
                }
            }

        });

    </script>
</dom-module><dom-module id="tricomp-reservation-duration" assetpath="../triapp-reservation-list/">
    <template>
        <style>
            .time-duration-container {
                @apply(--layout-horizontal);
            }
            
            .time-duration-container * {
                font-size: 14px;
            }
            
            .times-container {
                @apply(--layout-horizontal);
                @apply(--layout-wrap);
                min-width: 0;
            }
            
            .multi-day-times-container {
                @apply(--layout-vertical);
                min-width: 0;
                padding-bottom: 6px;
            }
            
            .time-box {
                @apply(--layout-horizontal);
                @apply(--layout-center);
                @apply(--paper-font-common-nowrap);
                min-width: 0;
            }
            
            .recurring-icon-container {
                @apply(--layout-vertical);
                @apply(--layout-center-center);
                padding-left: 5px;
            }
            
            .recurring-icon {
                width: 16px;
                height: 16px;
                color: var(--ibm-gray-50);
            }
        </style>

        <div class="time-duration-container">
            <div class$="[[_computeTimesContainerClass(eventItem._Start_Datetime, eventItem._End_Datetime, currentUser._TimeZoneId)]]" hidden$="[[eventItem._All_Day]]">
                <div class="time-box">
                    <triplat-datetime-picker value="[[eventItem._Start_Datetime]]" display-format="[[_computeTimeDisplayFormat(currentUser._DateTimeFormat)]]" time-zone="[[currentUser._TimeZoneId]]" readonly=""></triplat-datetime-picker>
                    <div>&nbsp;-&nbsp;</div>
                    <triplat-datetime-picker hidden$="[[_isSameDate(currentUser._TimeZoneId, eventItem._Start_Datetime, eventItem._End_Datetime)]]" value="[[eventItem._Start_Datetime]]" display-format="[[_computeDateDisplayFormat(currentUser._DateTimeFormat)]]" time-zone="[[currentUser._TimeZoneId]]" readonly=""></triplat-datetime-picker>
                </div>

                <div class="time-box">
                    <triplat-datetime-picker value="[[eventItem._End_Datetime]]" display-format="[[_computeTimeDisplayFormat(currentUser._DateTimeFormat)]]" time-zone="[[currentUser._TimeZoneId]]" readonly=""></triplat-datetime-picker>
                    <div hidden$="[[_isSameDate(currentUser._TimeZoneId, eventItem._Start_Datetime, eventItem._End_Datetime)]]">
                        &nbsp;-&nbsp;
                        <triplat-datetime-picker value="[[eventItem._End_Datetime]]" display-format="[[_computeDateDisplayFormat(currentUser._DateTimeFormat)]]" time-zone="[[currentUser._TimeZoneId]]" readonly=""></triplat-datetime-picker>
                    </div>
                </div>
            </div>

            <div class="recurring-icon-container" hidden$="[[!_isSeries(eventItem)]]">
                <iron-icon icon="ibm:recurring" class="recurring-icon" hidden$="[[_isSeriesException(eventItem)]]"></iron-icon>
                <iron-icon icon="ibm:recurring-exception" class="recurring-icon" hidden$="[[!_isSeriesException(eventItem)]]"></iron-icon>
            </div>
        </div>
    </template>
    <script>
        
        Polymer({

            is: "tricomp-reservation-duration",

            behaviors: [TriReservationUtilitiesBehavior],

            properties: {
                eventItem: Object,
                currentUser: Object,
                isCard: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                }
            },

            _computeTimesContainerClass: function (startDateTime, endDateTime, timezone) {
                if (this._isSameDate(timezone, startDateTime, endDateTime)) {
                    return "times-container";
                } else {
                    return "multi-day-times-container";
                }
            },

            _computeTimeDisplayFormat: function (userDateTimeFormat) {
                if (userDateTimeFormat) {
                    var dateTimeFormatSplit = userDateTimeFormat.trim().split(" ");
                    var time = dateTimeFormatSplit[1];
                    var amPm = dateTimeFormatSplit.length > 2 ? dateTimeFormatSplit[2] : null;

                    return amPm && amPm.indexOf("a") > -1 ? time + amPm : time;
                }
            },

            _computeDateDisplayFormat: function (userDateTimeFormat) {
                if (userDateTimeFormat) {
                    var dateTimeFormatSplit = userDateTimeFormat.trim().split(" ");
                    return dateTimeFormatSplit[0].startsWith("dd") || dateTimeFormatSplit[0].endsWith("dd") ? "ddd DD MMM" : "ddd, MMM DD";
                }
            },

            _isSeriesException: function (eventItem) {
                return eventItem._Recurring_Event_Exception;
            }

        });

    </script>
</dom-module>
<dom-module id="tricomp-multiline-overflow-text" assetpath="../triapp-reservation-list/">
    <template>
        <style>
            .ellipsis {
                position: absolute;
                right: 0;
                bottom: 0;
                width: 3em;
                line-height: var(--multiline-overflow-text-ellipsis-line-height, normal);
                text-align: right;
                background-size: 100% 100%;
                background: -webkit-gradient(linear, left top, right top, from(rgba(255, 255, 255, 0)), to(white), color-stop(50%, white));
                background: -moz-linear-gradient(to right, rgba(255, 255, 255, 0), white 50%, white);			
                background: -o-linear-gradient(to right, rgba(255, 255, 255, 0), white 50%, white);
                background: -ms-linear-gradient(to right, rgba(255, 255, 255, 0), white 50%, white);
                background: linear-gradient(to right, rgba(255, 255, 255, 0), white 50%, white);
            }
            :host[no-gradient] .ellipsis {
                width: 1.5em;
                background: var(--multiline-overflow-text-ellipsis-background, white);
            }
        </style>

        <div id="innerBox">
            <template id="domRepeat" is="dom-repeat" items="[[_textArray]]">
                <template is="dom-if" if="[[item]]">[[item]]</template>
            </template>

            <content></content>
        </div>

        <div class="ellipsis" hidden="[[_hideEllipsis]]">…</div>
    </template>
    <script>
        
        Polymer({

            is: "tricomp-multiline-overflow-text",

            behaviors: [ Polymer.IronResizableBehavior ],

            properties: {
                /**
                * String value to be used as the text content.
                */	
                text: {
                    type: String,
                    value: ""
                },

                /**
                * Object value that should indicate the parent element
                * of this component
                */	
                parentElement: Object,

                /**
                * Boolean value that indicate if a gradient should not 
                * be displayed in the ellipsis container
                */	
                noGradient: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },

                _textArray: {
                    type: Array,
                    value: []
                },

                _hideEllipsis: {
                    type: Boolean,
                    value: true
                }
            },

            observers: [
                "_observeText(text)"
            ],

            listeners: {
                "iron-resize": "_handleResize",
                "domRepeat.dom-change": "_handleDomChange"
            },

            _observeText: function(text) {
                this.set("_textArray", []);

                if (text && text !== "") {
                    this.push("_textArray", text);
                }
            },

            _checkOverflowText: function() {
                var outerBox = this.parentElement;
                var innerBox = outerBox.querySelector("#innerBox");

                if (outerBox && innerBox) {
                    var outerBoxHeight = outerBox.offsetHeight;
                    var innerBoxHeight = innerBox.offsetHeight;

                    this._hideEllipsis = (innerBoxHeight > outerBoxHeight) ? false : true;
                }
            },

            _handleResize: function() {
                this.debounce(
                    "resize",
                    function() {
                        this._checkOverflowText();
                    },
                    200
                );
            },

            _asyncCheckOverflowText: function() {
                this.async(function() {
                    this._checkOverflowText();
                }, 200);
            },

            _handleDomChange: function() {
                this._asyncCheckOverflowText();
            },

            verifyContent: function() {
                this._asyncCheckOverflowText();
            }

        });

    </script>
</dom-module>
<dom-module id="tricomp-reservation-title" assetpath="../triapp-reservation-list/">
	<template>
		<style>
			:host {
				@apply(--layout-self-start);
			}
			
			.subject {
				position: relative;
				max-height: 2.4em;
				margin-top: 4px;
				line-height: 1.2em;
				font-size: 18px;
				color: var(--ibm-blue-50);
				overflow: hidden;
			}
			
			 :host[is-card] .subject {
				margin-top: 10px;
			}
		</style>

		<div id="subject" class="subject" hidden$="[[!eventItem.subject]]">
			<tricomp-multiline-overflow-text text="[[eventItem.subject]]" parentelement="[[subjectEl]]">
			</tricomp-multiline-overflow-text>
		</div>
	</template>
	<script>
		
		Polymer({

			is: "tricomp-reservation-title",

			properties: {
				eventItem: Object,
				isCard: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				}
			},

			attached: function() {
				this.set("subjectEl", this.$.subject);
			}

		});

	</script>
</dom-module>


<dom-module id="iron-image" assetpath="../iron-image/">
  <template>
    <style>
      :host {
        display: inline-block;
        overflow: hidden;
        position: relative;
      }

      #sizedImgDiv {
        @apply(--layout-fit);

        display: none;
      }

      #img {
        display: block;
        width: var(--iron-image-width, auto);
        height: var(--iron-image-height, auto);
      }

      :host([sizing]) #sizedImgDiv {
        display: block;
      }

      :host([sizing]) #img {
        display: none;
      }

      #placeholder {
        @apply(--layout-fit);

        background-color: inherit;
        opacity: 1;

        @apply(--iron-image-placeholder);
      }

      #placeholder.faded-out {
        transition: opacity 0.5s linear;
        opacity: 0;
      }
    </style>

    <div id="sizedImgDiv" role="img" hidden$="[[_computeImgDivHidden(sizing)]]" aria-hidden$="[[_computeImgDivARIAHidden(alt)]]" aria-label$="[[_computeImgDivARIALabel(alt, src)]]"></div>
    <img id="img" alt$="[[alt]]" hidden$="[[_computeImgHidden(sizing)]]">
    <div id="placeholder" hidden$="[[_computePlaceholderHidden(preload, fade, loading, loaded)]]" class$="[[_computePlaceholderClassName(preload, fade, loading, loaded)]]"></div>
  </template>

  <script>
    Polymer({
      is: 'iron-image',

      properties: {
        /**
         * The URL of an image.
         */
        src: {
          observer: '_srcChanged',
          type: String,
          value: ''
        },

        /**
         * A short text alternative for the image.
         */
        alt: {
          type: String,
          value: null
        },

        /**
         * When true, the image is prevented from loading and any placeholder is
         * shown.  This may be useful when a binding to the src property is known to
         * be invalid, to prevent 404 requests.
         */
        preventLoad: {
          type: Boolean,
          value: false,
          observer: '_preventLoadChanged'
        },

        /**
         * Sets a sizing option for the image.  Valid values are `contain` (full
         * aspect ratio of the image is contained within the element and
         * letterboxed) or `cover` (image is cropped in order to fully cover the
         * bounds of the element), or `null` (default: image takes natural size).
         */
        sizing: {
          type: String,
          value: null,
          reflectToAttribute: true
        },

        /**
         * When a sizing option is used (`cover` or `contain`), this determines
         * how the image is aligned within the element bounds.
         */
        position: {
          type: String,
          value: 'center'
        },

        /**
         * When `true`, any change to the `src` property will cause the `placeholder`
         * image to be shown until the new image has loaded.
         */
        preload: {
          type: Boolean,
          value: false
        },

        /**
         * This image will be used as a background/placeholder until the src image has
         * loaded.  Use of a data-URI for placeholder is encouraged for instant rendering.
         */
        placeholder: {
          type: String,
          value: null,
          observer: '_placeholderChanged'
        },

        /**
         * When `preload` is true, setting `fade` to true will cause the image to
         * fade into place.
         */
        fade: {
          type: Boolean,
          value: false
        },

        /**
         * Read-only value that is true when the image is loaded.
         */
        loaded: {
          notify: true,
          readOnly: true,
          type: Boolean,
          value: false
        },

        /**
         * Read-only value that tracks the loading state of the image when the `preload`
         * option is used.
         */
        loading: {
          notify: true,
          readOnly: true,
          type: Boolean,
          value: false
        },

        /**
         * Read-only value that indicates that the last set `src` failed to load.
         */
        error: {
          notify: true,
          readOnly: true,
          type: Boolean,
          value: false
        },

        /**
         * Can be used to set the width of image (e.g. via binding); size may also be
         * set via CSS.
         */
        width: {
          observer: '_widthChanged',
          type: Number,
          value: null
        },

        /**
         * Can be used to set the height of image (e.g. via binding); size may also be
         * set via CSS.
         *
         * @attribute height
         * @type number
         * @default null
         */
        height: {
          observer: '_heightChanged',
          type: Number,
          value: null
        },
      },

      observers: [
        '_transformChanged(sizing, position)'
      ],

      ready: function() {
        var img = this.$.img;

        img.onload = function() {
          if (this.$.img.src !== this._resolveSrc(this.src)) return;

          this._setLoading(false);
          this._setLoaded(true);
          this._setError(false);
        }.bind(this);

        img.onerror = function() {
          if (this.$.img.src !== this._resolveSrc(this.src)) return;

          this._reset();

          this._setLoading(false);
          this._setLoaded(false);
          this._setError(true);
        }.bind(this);

        this._resolvedSrc = '';
      },

      _load: function(src) {
        if (src) {
          this.$.img.src = src;
        } else {
          this.$.img.removeAttribute('src');
        }
        this.$.sizedImgDiv.style.backgroundImage = src ? 'url("' + src + '")' : '';

        this._setLoading(!!src);
        this._setLoaded(false);
        this._setError(false);
      },

      _reset: function() {
        this.$.img.removeAttribute('src');
        this.$.sizedImgDiv.style.backgroundImage = '';

        this._setLoading(false);
        this._setLoaded(false);
        this._setError(false);
      },

      _computePlaceholderHidden: function() {
        return !this.preload || (!this.fade && !this.loading && this.loaded);
      },

      _computePlaceholderClassName: function() {
        return (this.preload && this.fade && !this.loading && this.loaded) ? 'faded-out' : '';
      },

      _computeImgDivHidden: function() {
        return !this.sizing;
      },

      _computeImgDivARIAHidden: function() {
        return this.alt === '' ? 'true' : undefined;
      },

      _computeImgDivARIALabel: function() {
        if (this.alt !== null) {
          return this.alt;
        }

        // Polymer.ResolveUrl.resolveUrl will resolve '' relative to a URL x to
        // that URL x, but '' is the default for src.
        if (this.src === '') {
          return '';
        }

        var pathComponents = (new URL(this._resolveSrc(this.src))).pathname.split("/");
        return pathComponents[pathComponents.length - 1];
      },

      _computeImgHidden: function() {
        return !!this.sizing;
      },

      _widthChanged: function() {
        this.style.width = isNaN(this.width) ? this.width : this.width + 'px';
      },

      _heightChanged: function() {
        this.style.height = isNaN(this.height) ? this.height : this.height + 'px';
      },

      _preventLoadChanged: function() {
        if (this.preventLoad || this.loaded) return;

        this._reset();
        this._load(this.src);
      },

      _srcChanged: function(newSrc, oldSrc) {
        var newResolvedSrc = this._resolveSrc(newSrc);
        if (newResolvedSrc === this._resolvedSrc) return;
        this._resolvedSrc = newResolvedSrc;

        this._reset();
        if (!this.preventLoad) {
          this._load(newSrc);
        }
      },

      _placeholderChanged: function() {
        this.$.placeholder.style.backgroundImage =
          this.placeholder ? 'url("' + this.placeholder + '")' : '';
      },

      _transformChanged: function() {
        var sizedImgDivStyle = this.$.sizedImgDiv.style;
        var placeholderStyle = this.$.placeholder.style;

        sizedImgDivStyle.backgroundSize =
        placeholderStyle.backgroundSize =
          this.sizing;

        sizedImgDivStyle.backgroundPosition =
        placeholderStyle.backgroundPosition =
          this.sizing ? this.position : '';

        sizedImgDivStyle.backgroundRepeat =
        placeholderStyle.backgroundRepeat =
          this.sizing ? 'no-repeat' : '';
      },

      _resolveSrc: function(testSrc) {
        var baseURI = /** @type {string} */(this.ownerDocument.baseURI);
        return (new URL(Polymer.ResolveUrl.resolveUrl(testSrc, baseURI), baseURI)).href;
      }
    });
  </script>
</dom-module>
<dom-module id="tricomp-reservation-room" assetpath="../triapp-reservation-list/">
    <template>
        <style>
             :host {
                @apply(--layout-horizontal);
                @apply(--layout-center);
            }
            
            .image-container {
                padding-right: 20px;
            }
            
            iron-image {
                width: 64px;
                height: 64px;
            }
            
            .box-room-icon {
                @apply(--layout-horizontal);
                @apply(--layout-center-center);
                overflow: hidden;
                height: 64px;
                width: 64px;
                border-radius: 100%;
                background-color: var(--ibm-gray-50);
            }
            
            .room-image-placeholder-icon {
                --triplat-icon-height: 30px;
                --triplat-icon-width: 30px;
                --triplat-icon-fill-color: white;
            }
            
            .room-details-container {
                @apply(--layout-vertical);
                @apply(--layout-flex);
                min-width: 0;
            }
            
            .room-container {
                @apply(--layout-horizontal);
                @apply(--layout-center);
                margin-bottom: 5px;
            }
            :host[is-card] .room-container {
                margin-bottom: 0;
            }
             :host[small-screen-width] .room-container,
             :host[is-card] .room-container {
                @apply(--layout-justified);
            }
            
            .room {
                max-height: 2.4em;
                line-height: 1.2em;
                font-size: var(--room-name-font-size, 18px);
                font-weight: var(--room-name-font-weight, normal);
                overflow: hidden;
            }
            :host[is-card] .room {
                max-height: none;
                line-height: normal;
                font-size: 14px;
                font-weight: bold;
            }

            .room-count {
                font-weight: normal;
                white-space: nowrap;
            }
            
            .box-icon {
                @apply(--layout-horizontal);
                @apply(--layout-center);
            }
            
             :host[no-icon] .box-icon {
                display: none;
            }
            
            .divider-line {
                height: 24px;
                width: 1px;
                margin-right: 10px;
                margin-left: 10px;
                background: var(--ibm-gray-10);
            }
            :host[is-card] .divider-line {
                height: 18px;
            }
            
            .location-icon {
                flex-shrink: 0;
                height: 22px;
                width: 22px;
                padding: 0px;
                color: var(--ibm-blue-50);
            }
            
            .building,
            .floor {
                @apply(--paper-font-common-nowrap);
            }
            
            .building {
                font-size: var(--room-building-font-size, 14px);
            }
            
            .floor {
                font-size: var(--room-floor-font-size, 14px);
            }
            
            .bookingStatus {
                color: red;
            }
        </style>

        <tricore-url raw-url="/getCompanyFile.jsp?fileLoc=" bind-url="{{imgUrl}}"></tricore-url>

        <template is="dom-if" if="[[_showImage(applicationSettings, isCard)]]">
            <div class="image-container">
                <iron-image src="[[_computeImageUrl(eventItem.image, imgUrl)]]" sizing="cover" hidden$="[[!eventItem.image]]"></iron-image>
                <div class="box-room-icon" hidden$="[[eventItem.image]]">
                    <triplat-icon class="room-image-placeholder-icon" icon="picturefile"></triplat-icon>
                </div>
            </div>
        </template>

        <div class="room-details-container">
            <div class="room-container">
                <span class="room">
                    [[eventItem.location]]
                    <template is="dom-if" if="[[_computeDisplayTotalRooms(totalRooms)]]">
                        <span class="room-count">(1 of [[totalRooms]])</span>
                    </template>
                </span>
                <div class="box-icon">
                    <span class="divider-line"></span>
                    <triplat-icon class="location-icon" icon="ibm-glyphs:location" on-tap="_handleOpenRoomDetails"></triplat-icon>
                </div>
            </div>
            <div class="floor">[[eventItem.floor.value]]</div>
            <div class="building">[[eventItem.building]]</div>
            <div hidden$="[[!eventItem.bookingStatus]]" class="bookingStatus">[[eventItem.bookingStatus]]</div>
        </div>
    </template>
    <script>

        Polymer({

            is: "tricomp-reservation-room",

            behaviors: [TriBlockViewResponsiveBehavior, TriReservationUtilitiesBehavior],

            properties: {
                eventItem: Object,
                applicationSettings: Object,
                isCard: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },
                noIcon: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },
                totalRooms: {
                    type: Number,
                    value: 0
                }
            },

            _showImage: function (applicationSettings, isCard) {
                if (isCard) {
                    return false;
                } else if (applicationSettings) {
                    return !applicationSettings.disableImages;
                } else {
                    return false;
                }
            },

            _handleOpenRoomDetails: function (e) {
                e.stopPropagation();
                // TODO: Workaround for room details
                var details = {
                    eventItem: this.eventItem,
                    applicationSettings: this.applicationSettings
                };
                this.fire("reservation-room-detail-open", details);
            },

            _computeDisplayTotalRooms: function(total) {
                return (total > 1) ? true : false;
            } 

        });

    </script>
</dom-module>
<dom-module id="triplat-countdown" assetpath="../triplat-countdown/">

	<style>

		.container {
			@apply(--layout-horizontal);
			@apply(--layout-wrap);
			text-align: center;

			@apply(--countdown-container);
		}

		.countdown {
			@apply(--countdown);
		}

		.countdown-days {
			@apply(--countdown-days);
		}

		.countdown-hours {
			@apply(--countdown-hours);
		}

		.countdown-minutes {
			@apply(--countdown-minutes);
		}

		.countdown-seconds {
			@apply(--countdown-seconds);
		}

		.expired {
			@apply(--countdown-expired);
		}

		.expired-text {
			@apply(--countdown-expired-text);
		}

	</style>

	<template>
		<div class="container" hidden$="[[!deadline]]">
			<div class="countdown" hidden$="[[!_computeShowCountdown(isExpired, countdown.total)]]">
				<span hidden$="[[!label]]">[[label]]</span> <span class="countdown-days" hidden$="[[!_showDays]]">[[countdown.daysText]]:</span><span class="countdown-hours" hidden$="[[!_showHours]]">[[countdown.hoursText]]:</span><span class="countdown-minutes" hidden$="[[!_showMinutes]]">[[countdown.minutesText]]:</span><span class="countdown-seconds" hidden$="[[!_showSeconds]]">[[countdown.secondsText]]</span>
			</div>

			<div class="expired" hidden$="[[!_computeShowExpired(isExpired, countdown.total)]]">
				<span class="expired-text">[[expiredText]]</span>
			</div>
		</div>
	</template>

</dom-module>

<script>
	Polymer({

		is: "triplat-countdown",

		properties: {

			/**
			  * String value to be used as a label for the countdown field.
			  */
			label: String,

			/** 
			  * Boolean value to indicate if the logging method is active.
			  * The logging method logs messages in the browser console.
			  */
			loggingEnabled: {
				type: Boolean,
				value: false
			},

			/** 
			  * Boolean value to indicate that this is a disabled countdown. Show
			  * the countdown numbers as zeros.
			  */
			disabled: {
				type: Boolean,
				value: false
			},

			/** 
			  * Boolean value to indicate that it should wait before initializing 
			  * the countdown.
			  */
			waiting: {
				type: Boolean,
				value: false
			},

			/**
			  * String value to be used as the countdown name.
			  */
			name: {
				type: String,
				value: null
			},

			/**
			  * Date value to be used as a deadline. Used for the component to 
			  * calculate the amount of time between the current date and the date
			  * it will be counting down.
			  */
			deadline: {
				type: Date,
			},

			/**
			  * Number value in milliseconds to determine the amount of time to wait 
			  * before calling a new countdown checker.
			  */
			interval: {
				type: Number,
				value: 1000
			},

			/**
			  * String value to indicate the user time zone.
			  */
			timezone:  {
				type: String,
			},

			/**
			  * Date value to determine the amount of time to wait before activating
			  * the countdown.
			  */
			waitUntil: {
				type: Date,
				value: null
			},

			/**
			  * Countdown object.
			  */
			countdown: {
				type: Object,
				notify: true,
				value: {
					'name': '',
					'total': -1,
					'days': 0,
					'daysText': "0",
					'hours': 0,
					'hoursText': "00",
					'minutes': 0,
					'minutesText': "00",
					'seconds': 0,
					'secondsText': "00",},
			},

			/** 
			  * Boolean value to indicate that the countdown is expired.
			  */
			isExpired: {
				type: Boolean,
				value: false,
				notify: true,
				computed: "_computeIsExpired(deadline, countdown, disabled)"
			},

			/**
			  * String value to be used as the expired text.
			  */
			expiredText: {
				type: String,
				value: "Expired!",
			},

			_showDays: {
				type: Boolean,
				value: false
			},

			_showHours: {
				type: Boolean,
				value: true
			},

			_showMinutes: {
				type: Boolean,
				value: true
			},

			_showSeconds: {
				type: Boolean,
				value: true
			},

			_waitHandle: Object

		},

		observers: [
			"_initCountdown(deadline, timezone, disabled, waiting)",
		],

		detached: function() {
			this._cancelWait();
		},

		_computeShowCountdown: function(isExpired) {
			if (isExpired == undefined)
				return false;

			return !isExpired;
		},

		_computeShowExpired: function(isExpired) {
			if (isExpired == undefined)
				return false;

			return isExpired;
		},

		_computeIsExpired: function(deadline, countdown, disabled) {
			if (countdown.total == -1)
				return undefined;

			var isExpired = !disabled && deadline && countdown && countdown.total < 1;

			if (isExpired) {
				this._logInfo("countdown" + (this.name ? " [" + this.name + "]" : "") + " has expired");
			}

			return isExpired;
		},

		_initCountdown: function(deadline, timezone, disabled, waiting) {
			if ((!disabled || !waiting) && deadline && timezone) {
				this._countdown();
			}
		},

		_countdownWaitWakeUp: function() {
			this._logInfo("countdown" + (this.name ? " [" + this.name + "]" : "") + " waking up");

			// this should trigger the _initCountdown based on bindings
			this.async(function() {
				this.set("waiting", false);
			});
		},

		_cancelWait: function() {
			var waitHandle = this._waitHandle;
			if (waitHandle) {
				this.cancelAsync(waitHandle);
			}
		},

		_countdown: function() {
			var disabled = this.disabled;
			if (disabled) {
				this._logInfo("countdown" + (this.name ? " [" + this.name + "]" : "") + " is disabled");
				return;
			}

			var deadline = this.deadline;
			var timezone = this.timezone;
			var waitUntil = this.waitUntil;

			if (this.waiting) {
				this._logInfo("countdown" + (this.name ? " [" + this.name + "]" : "") + " is waiting");
				return;
			}

			if (deadline) {
				var deadlineMS = Date.parse(deadline);
				var nowDT = new Date();
				var nowMS = nowDT.getTime();

				var waitUntilDT = waitUntil ? Date.parse(waitUntil) : null;
				if (waitUntilDT && nowMS <= waitUntilDT) {
					var waitPeriodMS = waitUntilDT-nowMS;
					this._logInfo("countdown" + (this.name ? " [" + this.name + "]" : "") + " waiting for " + (waitPeriodMS / 1000) + " seconds");

					var waitHandle = this.async(function() {
						this._countdownWaitWakeUp();
					}, waitPeriodMS);

					this.set("_waitHandle", waitHandle);

					this.waiting = true;

					var countdown = this._getCountdown(deadlineMS, nowDT);
					this.set("countdown", countdown);
				} else {
					var countdown = this._getCountdown(deadlineMS, nowDT);
					if (countdown.total > 0) {
						this.async(function() {
							this._countdown();
						}, this.interval);
					} else {
						this._logInfo("countdown" + (this.name ? " [" + this.name + "]" : "") + " has run out");

						countdown = {
							'name': this.name,
							'total': 0,
							'days': 0,
							'daysText': "0",
							'hours': 0,
							'hoursText': "00",
							'minutes': 0,
							'minutesText': "00",
							'seconds': 0,
							'secondsText': "00",};
					}

					this.set("countdown", countdown);
				}
			} else {
				this._logInfo("countdown" + (this.name ? " [" + this.name + "]" : "") + " deadline is not set");
			}
		},

		_getCountdown: function(deadlineDT, nowDT) {
			var remaining = deadlineDT - nowDT;
			var seconds = Math.floor((remaining / 1000) % 60);
			var minutes = Math.floor((remaining / 1000 / 60) % 60);
			var hours = Math.floor((remaining / (1000 * 60 * 60)) % 24);
			var days = Math.floor(remaining / (1000 * 60 * 60 * 24));

			this.set("_showDays", days > 0);
			this.set("_showHours", days > 0 || hours > 0);
			this.set("_showMinutes", days > 0 || hours > 0 || minutes > 0);
			this.set("_showSeconds", days > 0 || hours > 0 || minutes > 0 || seconds > 0);

			return {
				'name': this.name,
				'total': remaining,
				'days': days,
				'daysText': "" + days,
				'hours': hours,
				'hoursText': "" + (hours < 10 ? "0" : "") + hours,
				'minutes': minutes,
				'minutesText': "" + (minutes < 10 ? "0" : "") + minutes,
				'seconds': seconds,
				'secondsText': "" + (seconds < 10 ? "0" : "") + seconds
			};
		},

		_logInfo: function(msg) {
			if (this.loggingEnabled) {
				console.log(msg);
			}
		}

	});
</script>
<iron-iconset-svg name="communication" size="24">
<svg><defs>
<g id="business"><path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"></path></g>
<g id="call"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"></path></g>
<g id="call-end"><path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"></path></g>
<g id="call-made"><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"></path></g>
<g id="call-merge"><path d="M17 20.41L18.41 19 15 15.59 13.59 17 17 20.41zM7.5 8H11v5.59L5.59 19 7 20.41l6-6V8h3.5L12 3.5 7.5 8z"></path></g>
<g id="call-missed"><path d="M19.59 7L12 14.59 6.41 9H11V7H3v8h2v-4.59l7 7 9-9z"></path></g>
<g id="call-missed-outgoing"><path d="M3 8.41l9 9 7-7V15h2V7h-8v2h4.59L12 14.59 4.41 7 3 8.41z"></path></g>
<g id="call-received"><path d="M20 5.41L18.59 4 7 15.59V9H5v10h10v-2H8.41z"></path></g>
<g id="call-split"><path d="M14 4l2.29 2.29-2.88 2.88 1.42 1.42 2.88-2.88L20 10V4zm-4 0H4v6l2.29-2.29 4.71 4.7V20h2v-8.41l-5.29-5.3z"></path></g>
<g id="chat"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"></path></g>
<g id="chat-bubble"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"></path></g>
<g id="chat-bubble-outline"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"></path></g>
<g id="clear-all"><path d="M5 13h14v-2H5v2zm-2 4h14v-2H3v2zM7 7v2h14V7H7z"></path></g>
<g id="comment"><path d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"></path></g>
<g id="contact-mail"><path d="M21 8V7l-3 2-3-2v1l3 2 3-2zm1-5H2C.9 3 0 3.9 0 5v14c0 1.1.9 2 2 2h20c1.1 0 1.99-.9 1.99-2L24 5c0-1.1-.9-2-2-2zM8 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H2v-1c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1zm8-6h-8V6h8v6z"></path></g>
<g id="contact-phone"><path d="M22 3H2C.9 3 0 3.9 0 5v14c0 1.1.9 2 2 2h20c1.1 0 1.99-.9 1.99-2L24 5c0-1.1-.9-2-2-2zM8 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H2v-1c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1zm3.85-4h1.64L21 16l-1.99 1.99c-1.31-.98-2.28-2.38-2.73-3.99-.18-.64-.28-1.31-.28-2s.1-1.36.28-2c.45-1.62 1.42-3.01 2.73-3.99L21 8l-1.51 2h-1.64c-.22.63-.35 1.3-.35 2s.13 1.37.35 2z"></path></g>
<g id="contacts"><path d="M20 0H4v2h16V0zM4 24h16v-2H4v2zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 2.75c1.24 0 2.25 1.01 2.25 2.25s-1.01 2.25-2.25 2.25S9.75 10.24 9.75 9 10.76 6.75 12 6.75zM17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5V17z"></path></g>
<g id="dialer-sip"><path d="M17 3h-1v5h1V3zm-2 2h-2V4h2V3h-3v3h2v1h-2v1h3V5zm3-2v5h1V6h2V3h-3zm2 2h-1V4h1v1zm0 10.5c-1.25 0-2.45-.2-3.57-.57-.35-.11-.74-.03-1.01.24l-2.2 2.2c-2.83-1.44-5.15-3.75-6.59-6.59l2.2-2.21c.27-.26.35-.65.24-1C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1z"></path></g>
<g id="dialpad"><path d="M12 19c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 1c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12-8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-6 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></g>
<g id="email"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path></g>
<g id="forum"><path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"></path></g>
<g id="import-contacts"><path d="M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1zm0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5v11.5z"></path></g>
<g id="import-export"><path d="M9 3L5 6.99h3V14h2V6.99h3L9 3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99h-3z"></path></g>
<g id="invert-colors-off"><path d="M20.65 20.87l-2.35-2.35-6.3-6.29-3.56-3.57-1.42-1.41L4.27 4.5 3 5.77l2.78 2.78c-2.55 3.14-2.36 7.76.56 10.69C7.9 20.8 9.95 21.58 12 21.58c1.79 0 3.57-.59 5.03-1.78l2.7 2.7L21 21.23l-.35-.36zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59c0-1.32.43-2.57 1.21-3.6L12 14.77v4.82zM12 5.1v4.58l7.25 7.26c1.37-2.96.84-6.57-1.6-9.01L12 2.27l-3.7 3.7 1.41 1.41L12 5.1z"></path></g>
<g id="live-help"><path d="M19 2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h4l3 3 3-3h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-6 16h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 11.9 13 12.5 13 14h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"></path></g>
<g id="location-off"><path d="M12 6.5c1.38 0 2.5 1.12 2.5 2.5 0 .74-.33 1.39-.83 1.85l3.63 3.63c.98-1.86 1.7-3.8 1.7-5.48 0-3.87-3.13-7-7-7-1.98 0-3.76.83-5.04 2.15l3.19 3.19c.46-.52 1.11-.84 1.85-.84zm4.37 9.6l-4.63-4.63-.11-.11L3.27 3 2 4.27l3.18 3.18C5.07 7.95 5 8.47 5 9c0 5.25 7 13 7 13s1.67-1.85 3.38-4.35L18.73 21 20 19.73l-3.63-3.63z"></path></g>
<g id="location-on"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></g>
<g id="mail-outline"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"></path></g>
<g id="message"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"></path></g>
<g id="no-sim"><path d="M18.99 5c0-1.1-.89-2-1.99-2h-7L7.66 5.34 19 16.68 18.99 5zM3.65 3.88L2.38 5.15 5 7.77V19c0 1.1.9 2 2 2h10.01c.35 0 .67-.1.96-.26l1.88 1.88 1.27-1.27L3.65 3.88z"></path></g>
<g id="phone"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"></path></g>
<g id="phonelink-erase"><path d="M13 8.2l-1-1-4 4-4-4-1 1 4 4-4 4 1 1 4-4 4 4 1-1-4-4 4-4zM19 1H9c-1.1 0-2 .9-2 2v3h2V4h10v16H9v-2H7v3c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2z"></path></g>
<g id="phonelink-lock"><path d="M19 1H9c-1.1 0-2 .9-2 2v3h2V4h10v16H9v-2H7v3c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm-8.2 10V9.5C10.8 8.1 9.4 7 8 7S5.2 8.1 5.2 9.5V11c-.6 0-1.2.6-1.2 1.2v3.5c0 .7.6 1.3 1.2 1.3h5.5c.7 0 1.3-.6 1.3-1.2v-3.5c0-.7-.6-1.3-1.2-1.3zm-1.3 0h-3V9.5c0-.8.7-1.3 1.5-1.3s1.5.5 1.5 1.3V11z"></path></g>
<g id="phonelink-ring"><path d="M20.1 7.7l-1 1c1.8 1.8 1.8 4.6 0 6.5l1 1c2.5-2.3 2.5-6.1 0-8.5zM18 9.8l-1 1c.5.7.5 1.6 0 2.3l1 1c1.2-1.2 1.2-3 0-4.3zM14 1H4c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 19H4V4h10v16z"></path></g>
<g id="phonelink-setup"><path d="M11.8 12.5v-1l1.1-.8c.1-.1.1-.2.1-.3l-1-1.7c-.1-.1-.2-.2-.3-.1l-1.3.4c-.3-.2-.6-.4-.9-.5l-.2-1.3c0-.1-.1-.2-.3-.2H7c-.1 0-.2.1-.3.2l-.2 1.3c-.3.1-.6.3-.9.5l-1.3-.5c-.1 0-.2 0-.3.1l-1 1.7c-.1.1 0 .2.1.3l1.1.8v1l-1.1.8c-.1.2-.1.3-.1.4l1 1.7c.1.1.2.2.3.1l1.4-.4c.3.2.6.4.9.5l.2 1.3c-.1.1.1.2.2.2h2c.1 0 .2-.1.3-.2l.2-1.3c.3-.1.6-.3.9-.5l1.3.5c.1 0 .2 0 .3-.1l1-1.7c.1-.1 0-.2-.1-.3l-1.1-.9zM8 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM19 1H9c-1.1 0-2 .9-2 2v3h2V4h10v16H9v-2H7v3c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2z"></path></g>
<g id="portable-wifi-off"><path d="M17.56 14.24c.28-.69.44-1.45.44-2.24 0-3.31-2.69-6-6-6-.79 0-1.55.16-2.24.44l1.62 1.62c.2-.03.41-.06.62-.06 2.21 0 4 1.79 4 4 0 .21-.02.42-.05.63l1.61 1.61zM12 4c4.42 0 8 3.58 8 8 0 1.35-.35 2.62-.95 3.74l1.47 1.47C21.46 15.69 22 13.91 22 12c0-5.52-4.48-10-10-10-1.91 0-3.69.55-5.21 1.47l1.46 1.46C9.37 4.34 10.65 4 12 4zM3.27 2.5L2 3.77l2.1 2.1C2.79 7.57 2 9.69 2 12c0 3.7 2.01 6.92 4.99 8.65l1-1.73C5.61 17.53 4 14.96 4 12c0-1.76.57-3.38 1.53-4.69l1.43 1.44C6.36 9.68 6 10.8 6 12c0 2.22 1.21 4.15 3 5.19l1-1.74c-1.19-.7-2-1.97-2-3.45 0-.65.17-1.25.44-1.79l1.58 1.58L10 12c0 1.1.9 2 2 2l.21-.02.01.01 7.51 7.51L21 20.23 4.27 3.5l-1-1z"></path></g>
<g id="present-to-all"><path d="M21 3H3c-1.11 0-2 .89-2 2v14c0 1.11.89 2 2 2h18c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2zm0 16.02H3V4.98h18v14.04zM10 12H8l4-4 4 4h-2v4h-4v-4z"></path></g>
<g id="ring-volume"><path d="M23.71 16.67C20.66 13.78 16.54 12 12 12 7.46 12 3.34 13.78.29 16.67c-.18.18-.29.43-.29.71 0 .28.11.53.29.71l2.48 2.48c.18.18.43.29.71.29.27 0 .52-.11.7-.28.79-.74 1.69-1.36 2.66-1.85.33-.16.56-.5.56-.9v-3.1c1.45-.48 3-.73 4.6-.73s3.15.25 4.6.72v3.1c0 .39.23.74.56.9.98.49 1.87 1.12 2.66 1.85.18.18.43.28.7.28.28 0 .53-.11.71-.29l2.48-2.48c.18-.18.29-.43.29-.71 0-.27-.11-.52-.29-.7zM21.16 6.26l-1.41-1.41-3.56 3.55 1.41 1.41s3.45-3.52 3.56-3.55zM13 2h-2v5h2V2zM6.4 9.81L7.81 8.4 4.26 4.84 2.84 6.26c.11.03 3.56 3.55 3.56 3.55z"></path></g>
<g id="screen-share"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.11-.9-2-2-2H4c-1.11 0-2 .89-2 2v10c0 1.1.89 2 2 2H0v2h24v-2h-4zm-7-3.53v-2.19c-2.78 0-4.61.85-6 2.72.56-2.67 2.11-5.33 6-5.87V7l4 3.73-4 3.74z"></path></g>
<g id="speaker-phone"><path d="M7 7.07L8.43 8.5c.91-.91 2.18-1.48 3.57-1.48s2.66.57 3.57 1.48L17 7.07C15.72 5.79 13.95 5 12 5s-3.72.79-5 2.07zM12 1C8.98 1 6.24 2.23 4.25 4.21l1.41 1.41C7.28 4 9.53 3 12 3s4.72 1 6.34 2.62l1.41-1.41C17.76 2.23 15.02 1 12 1zm2.86 9.01L9.14 10C8.51 10 8 10.51 8 11.14v9.71c0 .63.51 1.14 1.14 1.14h5.71c.63 0 1.14-.51 1.14-1.14v-9.71c.01-.63-.5-1.13-1.13-1.13zM15 20H9v-8h6v8z"></path></g>
<g id="stay-current-landscape"><path d="M1.01 7L1 17c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2H3c-1.1 0-1.99.9-1.99 2zM19 7v10H5V7h14z"></path></g>
<g id="stay-current-portrait"><path d="M17 1.01L7 1c-1.1 0-1.99.9-1.99 2v18c0 1.1.89 2 1.99 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"></path></g>
<g id="stay-primary-landscape"><path d="M1.01 7L1 17c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2H3c-1.1 0-1.99.9-1.99 2zM19 7v10H5V7h14z"></path></g>
<g id="stay-primary-portrait"><path d="M17 1.01L7 1c-1.1 0-1.99.9-1.99 2v18c0 1.1.89 2 1.99 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"></path></g>
<g id="stop-screen-share"><path d="M21.22 18.02l2 2H24v-2h-2.78zm.77-2l.01-10c0-1.11-.9-2-2-2H7.22l5.23 5.23c.18-.04.36-.07.55-.1V7.02l4 3.73-1.58 1.47 5.54 5.54c.61-.33 1.03-.99 1.03-1.74zM2.39 1.73L1.11 3l1.54 1.54c-.4.36-.65.89-.65 1.48v10c0 1.1.89 2 2 2H0v2h18.13l2.71 2.71 1.27-1.27L2.39 1.73zM7 15.02c.31-1.48.92-2.95 2.07-4.06l1.59 1.59c-1.54.38-2.7 1.18-3.66 2.47z"></path></g>
<g id="swap-calls"><path d="M18 4l-4 4h3v7c0 1.1-.9 2-2 2s-2-.9-2-2V8c0-2.21-1.79-4-4-4S5 5.79 5 8v7H2l4 4 4-4H7V8c0-1.1.9-2 2-2s2 .9 2 2v7c0 2.21 1.79 4 4 4s4-1.79 4-4V8h3l-4-4z"></path></g>
<g id="textsms"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z"></path></g>
<g id="voicemail"><path d="M18.5 6C15.46 6 13 8.46 13 11.5c0 1.33.47 2.55 1.26 3.5H9.74c.79-.95 1.26-2.17 1.26-3.5C11 8.46 8.54 6 5.5 6S0 8.46 0 11.5 2.46 17 5.5 17h13c3.04 0 5.5-2.46 5.5-5.5S21.54 6 18.5 6zm-13 9C3.57 15 2 13.43 2 11.5S3.57 8 5.5 8 9 9.57 9 11.5 7.43 15 5.5 15zm13 0c-1.93 0-3.5-1.57-3.5-3.5S16.57 8 18.5 8 22 9.57 22 11.5 20.43 15 18.5 15z"></path></g>
<g id="vpn-key"><path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"></path></g>
</defs></svg>
</iron-iconset-svg>
<iron-iconset-svg name="hardware" size="24">
<svg><defs>
<g id="cast"><path d="M21 3H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11z"></path></g>
<g id="cast-connected"><path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm18-7H5v1.63c3.96 1.28 7.09 4.41 8.37 8.37H19V7zM1 10v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"></path></g>
<g id="computer"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"></path></g>
<g id="desktop-mac"><path d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7l-2 3v1h8v-1l-2-3h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 12H3V4h18v10z"></path></g>
<g id="desktop-windows"><path d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7v2H8v2h8v-2h-2v-2h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H3V4h18v12z"></path></g>
<g id="developer-board"><path d="M22 9V7h-2V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-2h2v-2h-2v-2h2v-2h-2V9h2zm-4 10H4V5h14v14zM6 13h5v4H6zm6-6h4v3h-4zM6 7h5v5H6zm6 4h4v6h-4z"></path></g>
<g id="device-hub"><path d="M17 16l-4-4V8.82C14.16 8.4 15 7.3 15 6c0-1.66-1.34-3-3-3S9 4.34 9 6c0 1.3.84 2.4 2 2.82V12l-4 4H3v5h5v-3.05l4-4.2 4 4.2V21h5v-5h-4z"></path></g>
<g id="devices-other"><path d="M3 6h18V4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4v-2H3V6zm10 6H9v1.78c-.61.55-1 1.33-1 2.22s.39 1.67 1 2.22V20h4v-1.78c.61-.55 1-1.34 1-2.22s-.39-1.67-1-2.22V12zm-2 5.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM22 8h-6c-.5 0-1 .5-1 1v10c0 .5.5 1 1 1h6c.5 0 1-.5 1-1V9c0-.5-.5-1-1-1zm-1 10h-4v-8h4v8z"></path></g>
<g id="dock"><path d="M8 23h8v-2H8v2zm8-21.99L8 1c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM16 15H8V5h8v10z"></path></g>
<g id="gamepad"><path d="M15 7.5V2H9v5.5l3 3 3-3zM7.5 9H2v6h5.5l3-3-3-3zM9 16.5V22h6v-5.5l-3-3-3 3zM16.5 9l-3 3 3 3H22V9h-5.5z"></path></g>
<g id="headset"><path d="M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7c0-4.97-4.03-9-9-9z"></path></g>
<g id="headset-mic"><path d="M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h4v1h-7v2h6c1.66 0 3-1.34 3-3V10c0-4.97-4.03-9-9-9z"></path></g>
<g id="keyboard"><path d="M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"></path></g>
<g id="keyboard-arrow-down"><path d="M7.41 7.84L12 12.42l4.59-4.58L18 9.25l-6 6-6-6z"></path></g>
<g id="keyboard-arrow-left"><path d="M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"></path></g>
<g id="keyboard-arrow-right"><path d="M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"></path></g>
<g id="keyboard-arrow-up"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></g>
<g id="keyboard-backspace"><path d="M21 11H6.83l3.58-3.59L9 6l-6 6 6 6 1.41-1.41L6.83 13H21z"></path></g>
<g id="keyboard-capslock"><path d="M12 8.41L16.59 13 18 11.59l-6-6-6 6L7.41 13 12 8.41zM6 18h12v-2H6v2z"></path></g>
<g id="keyboard-hide"><path d="M20 3H4c-1.1 0-1.99.9-1.99 2L2 15c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-9 3h2v2h-2V6zm0 3h2v2h-2V9zM8 6h2v2H8V6zm0 3h2v2H8V9zm-1 2H5V9h2v2zm0-3H5V6h2v2zm9 7H8v-2h8v2zm0-4h-2V9h2v2zm0-3h-2V6h2v2zm3 3h-2V9h2v2zm0-3h-2V6h2v2zm-7 15l4-4H8l4 4z"></path></g>
<g id="keyboard-return"><path d="M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z"></path></g>
<g id="keyboard-tab"><path d="M11.59 7.41L15.17 11H1v2h14.17l-3.59 3.59L13 18l6-6-6-6-1.41 1.41zM20 6v12h2V6h-2z"></path></g>
<g id="keyboard-voice"><path d="M12 15c1.66 0 2.99-1.34 2.99-3L15 6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.42 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"></path></g>
<g id="laptop"><path d="M20 18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"></path></g>
<g id="laptop-chromebook"><path d="M22 18V3H2v15H0v2h24v-2h-2zm-8 0h-4v-1h4v1zm6-3H4V5h16v10z"></path></g>
<g id="laptop-mac"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2H0c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2h-4zM4 5h16v11H4V5zm8 14c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"></path></g>
<g id="laptop-windows"><path d="M20 18v-1c1.1 0 1.99-.9 1.99-2L22 5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2v1H0v2h24v-2h-4zM4 5h16v10H4V5z"></path></g>
<g id="memory"><path d="M15 9H9v6h6V9zm-2 4h-2v-2h2v2zm8-2V9h-2V7c0-1.1-.9-2-2-2h-2V3h-2v2h-2V3H9v2H7c-1.1 0-2 .9-2 2v2H3v2h2v2H3v2h2v2c0 1.1.9 2 2 2h2v2h2v-2h2v2h2v-2h2c1.1 0 2-.9 2-2v-2h2v-2h-2v-2h2zm-4 6H7V7h10v10z"></path></g>
<g id="mouse"><path d="M13 1.07V9h7c0-4.08-3.05-7.44-7-7.93zM4 15c0 4.42 3.58 8 8 8s8-3.58 8-8v-4H4v4zm7-13.93C7.05 1.56 4 4.92 4 9h7V1.07z"></path></g>
<g id="phone-android"><path d="M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3.25-3H6.75V4h10.5v14z"></path></g>
<g id="phone-iphone"><path d="M15.5 1h-8C6.12 1 5 2.12 5 3.5v17C5 21.88 6.12 23 7.5 23h8c1.38 0 2.5-1.12 2.5-2.5v-17C18 2.12 16.88 1 15.5 1zm-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5-4H7V4h9v14z"></path></g>
<g id="phonelink"><path d="M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"></path></g>
<g id="phonelink-off"><path d="M22 6V4H6.82l2 2H22zM1.92 1.65L.65 2.92l1.82 1.82C2.18 5.08 2 5.52 2 6v11H0v3h17.73l2.35 2.35 1.27-1.27L3.89 3.62 1.92 1.65zM4 6.27L14.73 17H4V6.27zM23 8h-6c-.55 0-1 .45-1 1v4.18l2 2V10h4v7h-2.18l3 3H23c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1z"></path></g>
<g id="power-input"><path d="M2 9v2h19V9H2zm0 6h5v-2H2v2zm7 0h5v-2H9v2zm7 0h5v-2h-5v2z"></path></g>
<g id="router"><path d="M20.2 5.9l.8-.8C19.6 3.7 17.8 3 16 3s-3.6.7-5 2.1l.8.8C13 4.8 14.5 4.2 16 4.2s3 .6 4.2 1.7zm-.9.8c-.9-.9-2.1-1.4-3.3-1.4s-2.4.5-3.3 1.4l.8.8c.7-.7 1.6-1 2.5-1 .9 0 1.8.3 2.5 1l.8-.8zM19 13h-2V9h-2v4H5c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-4c0-1.1-.9-2-2-2zM8 18H6v-2h2v2zm3.5 0h-2v-2h2v2zm3.5 0h-2v-2h2v2z"></path></g>
<g id="scanner"><path d="M19.8 10.7L4.2 5l-.7 1.9L17.6 12H5c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-5.5c0-.8-.5-1.6-1.2-1.8zM7 17H5v-2h2v2zm12 0H9v-2h10v2z"></path></g>
<g id="security"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"></path></g>
<g id="sim-card"><path d="M19.99 4c0-1.1-.89-2-1.99-2h-8L4 8v12c0 1.1.9 2 2 2h12.01c1.1 0 1.99-.9 1.99-2l-.01-16zM9 19H7v-2h2v2zm8 0h-2v-2h2v2zm-8-4H7v-4h2v4zm4 4h-2v-4h2v4zm0-6h-2v-2h2v2zm4 2h-2v-4h2v4z"></path></g>
<g id="smartphone"><path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"></path></g>
<g id="speaker"><path d="M17 2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 1.99 2 1.99L17 22c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 2c1.1 0 2 .9 2 2s-.9 2-2 2c-1.11 0-2-.9-2-2s.89-2 2-2zm0 16c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></g>
<g id="speaker-group"><path d="M18.2 1H9.8C8.81 1 8 1.81 8 2.8v14.4c0 .99.81 1.79 1.8 1.79l8.4.01c.99 0 1.8-.81 1.8-1.8V2.8c0-.99-.81-1.8-1.8-1.8zM14 3c1.1 0 2 .89 2 2s-.9 2-2 2-2-.89-2-2 .9-2 2-2zm0 13.5c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"></path><circle cx="14" cy="12.5" r="2.5"></circle><path d="M6 5H4v16c0 1.1.89 2 2 2h10v-2H6V5z"></path></g>
<g id="tablet"><path d="M21 4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 1.99-.9 1.99-2L23 6c0-1.1-.9-2-2-2zm-2 14H5V6h14v12z"></path></g>
<g id="tablet-android"><path d="M18 0H6C4.34 0 3 1.34 3 3v18c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V3c0-1.66-1.34-3-3-3zm-4 22h-4v-1h4v1zm5.25-3H4.75V3h14.5v16z"></path></g>
<g id="tablet-mac"><path d="M18.5 0h-14C3.12 0 2 1.12 2 2.5v19C2 22.88 3.12 24 4.5 24h14c1.38 0 2.5-1.12 2.5-2.5v-19C21 1.12 19.88 0 18.5 0zm-7 23c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm7.5-4H4V3h15v16z"></path></g>
<g id="toys"><path d="M12 12c0-3 2.5-5.5 5.5-5.5S23 9 23 12H12zm0 0c0 3-2.5 5.5-5.5 5.5S1 15 1 12h11zm0 0c-3 0-5.5-2.5-5.5-5.5S9 1 12 1v11zm0 0c3 0 5.5 2.5 5.5 5.5S15 23 12 23V12z"></path></g>
<g id="tv"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"></path></g>
<g id="videogame-asset"><path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"></path></g>
<g id="watch"><path d="M20 12c0-2.54-1.19-4.81-3.04-6.27L16 0H8l-.95 5.73C5.19 7.19 4 9.45 4 12s1.19 4.81 3.05 6.27L8 24h8l.96-5.73C18.81 16.81 20 14.54 20 12zM6 12c0-3.31 2.69-6 6-6s6 2.69 6 6-2.69 6-6 6-6-2.69-6-6z"></path></g>
</defs></svg>
</iron-iconset-svg>
<iron-iconset-svg name="av" size="24">
<svg><defs>
<g id="add-to-queue"><path d="M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.11-.9-2-2-2zm0 14H3V5h18v12zm-5-7v2h-3v3h-2v-3H8v-2h3V7h2v3h3z"></path></g>
<g id="airplay"><path d="M6 22h12l-6-6zM21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4v-2H3V5h18v12h-4v2h4c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"></path></g>
<g id="album"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path></g>
<g id="art-track"><path d="M22 13h-8v-2h8v2zm0-6h-8v2h8V7zm-8 10h8v-2h-8v2zm-2-8v6c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V9c0-1.1.9-2 2-2h6c1.1 0 2 .9 2 2zm-1.5 6l-2.25-3-1.75 2.26-1.25-1.51L3.5 15h7z"></path></g>
<g id="av-timer"><path d="M11 17c0 .55.45 1 1 1s1-.45 1-1-.45-1-1-1-1 .45-1 1zm0-14v4h2V5.08c3.39.49 6 3.39 6 6.92 0 3.87-3.13 7-7 7s-7-3.13-7-7c0-1.68.59-3.22 1.58-4.42L12 13l1.41-1.41-6.8-6.8v.02C4.42 6.45 3 9.05 3 12c0 4.97 4.02 9 9 9 4.97 0 9-4.03 9-9s-4.03-9-9-9h-1zm7 9c0-.55-.45-1-1-1s-1 .45-1 1 .45 1 1 1 1-.45 1-1zM6 12c0 .55.45 1 1 1s1-.45 1-1-.45-1-1-1-1 .45-1 1z"></path></g>
<g id="closed-caption"><path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"></path></g>
<g id="equalizer"><path d="M10 20h4V4h-4v16zm-6 0h4v-8H4v8zM16 9v11h4V9h-4z"></path></g>
<g id="explicit"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4 6h-4v2h4v2h-4v2h4v2H9V7h6v2z"></path></g>
<g id="fast-forward"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"></path></g>
<g id="fast-rewind"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"></path></g>
<g id="fiber-dvr"><path d="M17.5 10.5h2v1h-2zm-13 0h2v3h-2zM21 3H3c-1.11 0-2 .89-2 2v14c0 1.1.89 2 2 2h18c1.11 0 2-.9 2-2V5c0-1.11-.89-2-2-2zM8 13.5c0 .85-.65 1.5-1.5 1.5H3V9h3.5c.85 0 1.5.65 1.5 1.5v3zm4.62 1.5h-1.5L9.37 9h1.5l1 3.43 1-3.43h1.5l-1.75 6zM21 11.5c0 .6-.4 1.15-.9 1.4L21 15h-1.5l-.85-2H17.5v2H16V9h3.5c.85 0 1.5.65 1.5 1.5v1z"></path></g>
<g id="fiber-manual-record"><circle cx="12" cy="12" r="8"></circle></g>
<g id="fiber-new"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zM8.5 15H7.3l-2.55-3.5V15H3.5V9h1.25l2.5 3.5V9H8.5v6zm5-4.74H11v1.12h2.5v1.26H11v1.11h2.5V15h-4V9h4v1.26zm7 3.74c0 .55-.45 1-1 1h-4c-.55 0-1-.45-1-1V9h1.25v4.51h1.13V9.99h1.25v3.51h1.12V9h1.25v5z"></path></g>
<g id="fiber-pin"><path d="M5.5 10.5h2v1h-2zM20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zM9 11.5c0 .85-.65 1.5-1.5 1.5h-2v2H4V9h3.5c.85 0 1.5.65 1.5 1.5v1zm3.5 3.5H11V9h1.5v6zm7.5 0h-1.2l-2.55-3.5V15H15V9h1.25l2.5 3.5V9H20v6z"></path></g>
<g id="fiber-smart-record"><g><circle cx="9" cy="12" r="8"></circle><path d="M17 4.26v2.09c2.33.82 4 3.04 4 5.65s-1.67 4.83-4 5.65v2.09c3.45-.89 6-4.01 6-7.74s-2.55-6.85-6-7.74z"></path></g></g>
<g id="forward-10"><path d="M4 13c0 4.4 3.6 8 8 8s8-3.6 8-8h-2c0 3.3-2.7 6-6 6s-6-2.7-6-6 2.7-6 6-6v4l5-5-5-5v4c-4.4 0-8 3.6-8 8zm6.8 3H10v-3.3L9 13v-.7l1.8-.6h.1V16zm4.3-1.8c0 .3 0 .6-.1.8l-.3.6s-.3.3-.5.3-.4.1-.6.1-.4 0-.6-.1-.3-.2-.5-.3-.2-.3-.3-.6-.1-.5-.1-.8v-.7c0-.3 0-.6.1-.8l.3-.6s.3-.3.5-.3.4-.1.6-.1.4 0 .6.1.3.2.5.3.2.3.3.6.1.5.1.8v.7zm-.8-.8v-.5s-.1-.2-.1-.3-.1-.1-.2-.2-.2-.1-.3-.1-.2 0-.3.1l-.2.2s-.1.2-.1.3v2s.1.2.1.3.1.1.2.2.2.1.3.1.2 0 .3-.1l.2-.2s.1-.2.1-.3v-1.5z"></path></g>
<g id="forward-30"><path d="M9.6 13.5h.4c.2 0 .4-.1.5-.2s.2-.2.2-.4v-.2s-.1-.1-.1-.2-.1-.1-.2-.1h-.5s-.1.1-.2.1-.1.1-.1.2v.2h-1c0-.2 0-.3.1-.5s.2-.3.3-.4.3-.2.4-.2.4-.1.5-.1c.2 0 .4 0 .6.1s.3.1.5.2.2.2.3.4.1.3.1.5v.3s-.1.2-.1.3-.1.2-.2.2-.2.1-.3.2c.2.1.4.2.5.4s.2.4.2.6c0 .2 0 .4-.1.5s-.2.3-.3.4-.3.2-.5.2-.4.1-.6.1c-.2 0-.4 0-.5-.1s-.3-.1-.5-.2-.2-.2-.3-.4-.1-.4-.1-.6h.8v.2s.1.1.1.2.1.1.2.1h.5s.1-.1.2-.1.1-.1.1-.2v-.5s-.1-.1-.1-.2-.1-.1-.2-.1h-.6v-.7zm5.7.7c0 .3 0 .6-.1.8l-.3.6s-.3.3-.5.3-.4.1-.6.1-.4 0-.6-.1-.3-.2-.5-.3-.2-.3-.3-.6-.1-.5-.1-.8v-.7c0-.3 0-.6.1-.8l.3-.6s.3-.3.5-.3.4-.1.6-.1.4 0 .6.1.3.2.5.3.2.3.3.6.1.5.1.8v.7zm-.9-.8v-.5s-.1-.2-.1-.3-.1-.1-.2-.2-.2-.1-.3-.1-.2 0-.3.1l-.2.2s-.1.2-.1.3v2s.1.2.1.3.1.1.2.2.2.1.3.1.2 0 .3-.1l.2-.2s.1-.2.1-.3v-1.5zM4 13c0 4.4 3.6 8 8 8s8-3.6 8-8h-2c0 3.3-2.7 6-6 6s-6-2.7-6-6 2.7-6 6-6v4l5-5-5-5v4c-4.4 0-8 3.6-8 8z"></path></g>
<g id="forward-5"><path d="M4 13c0 4.4 3.6 8 8 8s8-3.6 8-8h-2c0 3.3-2.7 6-6 6s-6-2.7-6-6 2.7-6 6-6v4l5-5-5-5v4c-4.4 0-8 3.6-8 8zm6.7.9l.2-2.2h2.4v.7h-1.7l-.1.9s.1 0 .1-.1.1 0 .1-.1.1 0 .2 0h.2c.2 0 .4 0 .5.1s.3.2.4.3.2.3.3.5.1.4.1.6c0 .2 0 .4-.1.5s-.1.3-.3.5-.3.2-.5.3-.4.1-.6.1c-.2 0-.4 0-.5-.1s-.3-.1-.5-.2-.2-.2-.3-.4-.1-.3-.1-.5h.8c0 .2.1.3.2.4s.2.1.4.1c.1 0 .2 0 .3-.1l.2-.2s.1-.2.1-.3v-.6l-.1-.2-.2-.2s-.2-.1-.3-.1h-.2s-.1 0-.2.1-.1 0-.1.1-.1.1-.1.1h-.6z"></path></g>
<g id="games"><path d="M15 7.5V2H9v5.5l3 3 3-3zM7.5 9H2v6h5.5l3-3-3-3zM9 16.5V22h6v-5.5l-3-3-3 3zM16.5 9l-3 3 3 3H22V9h-5.5z"></path></g>
<g id="hd"><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path></g>
<g id="hearing"><path d="M17 20c-.29 0-.56-.06-.76-.15-.71-.37-1.21-.88-1.71-2.38-.51-1.56-1.47-2.29-2.39-3-.79-.61-1.61-1.24-2.32-2.53C9.29 10.98 9 9.93 9 9c0-2.8 2.2-5 5-5s5 2.2 5 5h2c0-3.93-3.07-7-7-7S7 5.07 7 9c0 1.26.38 2.65 1.07 3.9.91 1.65 1.98 2.48 2.85 3.15.81.62 1.39 1.07 1.71 2.05.6 1.82 1.37 2.84 2.73 3.55.51.23 1.07.35 1.64.35 2.21 0 4-1.79 4-4h-2c0 1.1-.9 2-2 2zM7.64 2.64L6.22 1.22C4.23 3.21 3 5.96 3 9s1.23 5.79 3.22 7.78l1.41-1.41C6.01 13.74 5 11.49 5 9s1.01-4.74 2.64-6.36zM11.5 9c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5-1.12-2.5-2.5-2.5-2.5 1.12-2.5 2.5z"></path></g>
<g id="high-quality"><path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 11H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm7-1c0 .55-.45 1-1 1h-.75v1.5h-1.5V15H14c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v4zm-3.5-.5h2v-3h-2v3z"></path></g>
<g id="library-add"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z"></path></g>
<g id="library-books"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"></path></g>
<g id="library-music"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 5h-3v5.5c0 1.38-1.12 2.5-2.5 2.5S10 13.88 10 12.5s1.12-2.5 2.5-2.5c.57 0 1.08.19 1.5.51V5h4v2zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6z"></path></g>
<g id="loop"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"></path></g>
<g id="mic"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"></path></g>
<g id="mic-none"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2.66 0 1.2.54 1.2 1.2l-.01 6.2c0 .66-.53 1.2-1.19 1.2-.66 0-1.2-.54-1.2-1.2V4.9zm6.5 6.1c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"></path></g>
<g id="mic-off"><path d="M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"></path></g>
<g id="movie"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"></path></g>
<g id="music-video"><path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM8 15c0-1.66 1.34-3 3-3 .35 0 .69.07 1 .18V6h5v2h-3v7.03c-.02 1.64-1.35 2.97-3 2.97-1.66 0-3-1.34-3-3z"></path></g>
<g id="new-releases"><path d="M23 12l-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68L23 12zm-10 5h-2v-2h2v2zm0-4h-2V7h2v6z"></path></g>
<g id="not-interested"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"></path></g>
<g id="pause"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></g>
<g id="pause-circle-filled"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z"></path></g>
<g id="pause-circle-outline"><path d="M9 16h2V8H9v8zm3-14C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm1-4h2V8h-2v8z"></path></g>
<g id="play-arrow"><path d="M8 5v14l11-7z"></path></g>
<g id="play-circle-filled"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"></path></g>
<g id="play-circle-outline"><path d="M10 16.5l6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></g>
<g id="playlist-add"><path d="M14 10H2v2h12v-2zm0-4H2v2h12V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM2 16h8v-2H2v2z"></path></g>
<g id="playlist-add-check"><path d="M14 10H2v2h12v-2zm0-4H2v2h12V6zM2 16h8v-2H2v2zm19.5-4.5L23 13l-6.99 7-4.51-4.5L13 14l3.01 3 5.49-5.5z"></path></g>
<g id="playlist-play"><path d="M19 9H2v2h17V9zm0-4H2v2h17V5zM2 15h13v-2H2v2zm15-2v6l5-3-5-3z"></path></g>
<g id="queue"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z"></path></g>
<g id="queue-music"><path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"></path></g>
<g id="queue-play-next"><path d="M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h2v-2H3V5h18v8h2V5c0-1.11-.9-2-2-2zm-8 7V7h-2v3H8v2h3v3h2v-3h3v-2h-3zm11 8l-4.5 4.5L18 21l3-3-3-3 1.5-1.5L24 18z"></path></g>
<g id="radio"><path d="M3.24 6.15C2.51 6.43 2 7.17 2 8v12c0 1.1.89 2 2 2h16c1.11 0 2-.9 2-2V8c0-1.11-.89-2-2-2H8.3l8.26-3.34L15.88 1 3.24 6.15zM7 20c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-8h-2v-2h-2v2H4V8h16v4z"></path></g>
<g id="recent-actors"><path d="M21 5v14h2V5h-2zm-4 14h2V5h-2v14zM14 5H2c-.55 0-1 .45-1 1v12c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1zM8 7.75c1.24 0 2.25 1.01 2.25 2.25S9.24 12.25 8 12.25 5.75 11.24 5.75 10 6.76 7.75 8 7.75zM12.5 17h-9v-.75c0-1.5 3-2.25 4.5-2.25s4.5.75 4.5 2.25V17z"></path></g>
<g id="remove-from-queue"><path d="M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.11-.9-2-2-2zm0 14H3V5h18v12zm-5-7v2H8v-2h8z"></path></g>
<g id="repeat"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"></path></g>
<g id="repeat-one"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4zm-4-2V9h-1l-2 1v1h1.5v4H13z"></path></g>
<g id="replay"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"></path></g>
<g id="replay-10"><path d="M12 5V1L7 6l5 5V7c3.3 0 6 2.7 6 6s-2.7 6-6 6-6-2.7-6-6H4c0 4.4 3.6 8 8 8s8-3.6 8-8-3.6-8-8-8zm-1.1 11H10v-3.3L9 13v-.7l1.8-.6h.1V16zm4.3-1.8c0 .3 0 .6-.1.8l-.3.6s-.3.3-.5.3-.4.1-.6.1-.4 0-.6-.1-.3-.2-.5-.3-.2-.3-.3-.6-.1-.5-.1-.8v-.7c0-.3 0-.6.1-.8l.3-.6s.3-.3.5-.3.4-.1.6-.1.4 0 .6.1c.2.1.3.2.5.3s.2.3.3.6.1.5.1.8v.7zm-.9-.8v-.5s-.1-.2-.1-.3-.1-.1-.2-.2-.2-.1-.3-.1-.2 0-.3.1l-.2.2s-.1.2-.1.3v2s.1.2.1.3.1.1.2.2.2.1.3.1.2 0 .3-.1l.2-.2s.1-.2.1-.3v-1.5z"></path></g>
<g id="replay-30"><path d="M12 5V1L7 6l5 5V7c3.3 0 6 2.7 6 6s-2.7 6-6 6-6-2.7-6-6H4c0 4.4 3.6 8 8 8s8-3.6 8-8-3.6-8-8-8zm-2.4 8.5h.4c.2 0 .4-.1.5-.2s.2-.2.2-.4v-.2s-.1-.1-.1-.2-.1-.1-.2-.1h-.5s-.1.1-.2.1-.1.1-.1.2v.2h-1c0-.2 0-.3.1-.5s.2-.3.3-.4.3-.2.4-.2.4-.1.5-.1c.2 0 .4 0 .6.1s.3.1.5.2.2.2.3.4.1.3.1.5v.3s-.1.2-.1.3-.1.2-.2.2-.2.1-.3.2c.2.1.4.2.5.4s.2.4.2.6c0 .2 0 .4-.1.5s-.2.3-.3.4-.3.2-.5.2-.4.1-.6.1c-.2 0-.4 0-.5-.1s-.3-.1-.5-.2-.2-.2-.3-.4-.1-.4-.1-.6h.8v.2s.1.1.1.2.1.1.2.1h.5s.1-.1.2-.1.1-.1.1-.2v-.5s-.1-.1-.1-.2-.1-.1-.2-.1h-.6v-.7zm5.7.7c0 .3 0 .6-.1.8l-.3.6s-.3.3-.5.3-.4.1-.6.1-.4 0-.6-.1-.3-.2-.5-.3-.2-.3-.3-.6-.1-.5-.1-.8v-.7c0-.3 0-.6.1-.8l.3-.6s.3-.3.5-.3.4-.1.6-.1.4 0 .6.1.3.2.5.3.2.3.3.6.1.5.1.8v.7zm-.8-.8v-.5c0-.1-.1-.2-.1-.3s-.1-.1-.2-.2-.2-.1-.3-.1-.2 0-.3.1l-.2.2s-.1.2-.1.3v2s.1.2.1.3.1.1.2.2.2.1.3.1.2 0 .3-.1l.2-.2s.1-.2.1-.3v-1.5z"></path></g>
<g id="replay-5"><path d="M12 5V1L7 6l5 5V7c3.3 0 6 2.7 6 6s-2.7 6-6 6-6-2.7-6-6H4c0 4.4 3.6 8 8 8s8-3.6 8-8-3.6-8-8-8zm-1.3 8.9l.2-2.2h2.4v.7h-1.7l-.1.9s.1 0 .1-.1.1 0 .1-.1.1 0 .2 0h.2c.2 0 .4 0 .5.1s.3.2.4.3.2.3.3.5.1.4.1.6c0 .2 0 .4-.1.5s-.1.3-.3.5-.3.2-.4.3-.4.1-.6.1c-.2 0-.4 0-.5-.1s-.3-.1-.5-.2-.2-.2-.3-.4-.1-.3-.1-.5h.8c0 .2.1.3.2.4s.2.1.4.1c.1 0 .2 0 .3-.1l.2-.2s.1-.2.1-.3v-.6l-.1-.2-.2-.2s-.2-.1-.3-.1h-.2s-.1 0-.2.1-.1 0-.1.1-.1.1-.1.1h-.7z"></path></g>
<g id="shuffle"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"></path></g>
<g id="skip-next"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"></path></g>
<g id="skip-previous"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path></g>
<g id="slow-motion-video"><path d="M13.05 9.79L10 7.5v9l3.05-2.29L16 12zm0 0L10 7.5v9l3.05-2.29L16 12zm0 0L10 7.5v9l3.05-2.29L16 12zM11 4.07V2.05c-2.01.2-3.84 1-5.32 2.21L7.1 5.69c1.11-.86 2.44-1.44 3.9-1.62zM5.69 7.1L4.26 5.68C3.05 7.16 2.25 8.99 2.05 11h2.02c.18-1.46.76-2.79 1.62-3.9zM4.07 13H2.05c.2 2.01 1 3.84 2.21 5.32l1.43-1.43c-.86-1.1-1.44-2.43-1.62-3.89zm1.61 6.74C7.16 20.95 9 21.75 11 21.95v-2.02c-1.46-.18-2.79-.76-3.9-1.62l-1.42 1.43zM22 12c0 5.16-3.92 9.42-8.95 9.95v-2.02C16.97 19.41 20 16.05 20 12s-3.03-7.41-6.95-7.93V2.05C18.08 2.58 22 6.84 22 12z"></path></g>
<g id="snooze"><path d="M7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm-3-9h3.63L9 15.2V17h6v-2h-3.63L15 10.8V9H9v2z"></path></g>
<g id="sort-by-alpha"><path d="M14.94 4.66h-4.72l2.36-2.36zm-4.69 14.71h4.66l-2.33 2.33zM6.1 6.27L1.6 17.73h1.84l.92-2.45h5.11l.92 2.45h1.84L7.74 6.27H6.1zm-1.13 7.37l1.94-5.18 1.94 5.18H4.97zm10.76 2.5h6.12v1.59h-8.53v-1.29l5.92-8.56h-5.88v-1.6h8.3v1.26l-5.93 8.6z"></path></g>
<g id="stop"><path d="M6 6h12v12H6z"></path></g>
<g id="subscriptions"><path d="M20 8H4V6h16v2zm-2-6H6v2h12V2zm4 10v8c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2v-8c0-1.1.9-2 2-2h16c1.1 0 2 .9 2 2zm-6 4l-6-3.27v6.53L16 16z"></path></g>
<g id="subtitles"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM4 12h4v2H4v-2zm10 6H4v-2h10v2zm6 0h-4v-2h4v2zm0-4H10v-2h10v2z"></path></g>
<g id="surround-sound"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.76 16.24l-1.41 1.41C4.78 16.1 4 14.05 4 12c0-2.05.78-4.1 2.34-5.66l1.41 1.41C6.59 8.93 6 10.46 6 12s.59 3.07 1.76 4.24zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm5.66 1.66l-1.41-1.41C17.41 15.07 18 13.54 18 12s-.59-3.07-1.76-4.24l1.41-1.41C19.22 7.9 20 9.95 20 12c0 2.05-.78 4.1-2.34 5.66zM12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></g>
<g id="video-library"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z"></path></g>
<g id="videocam"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"></path></g>
<g id="videocam-off"><path d="M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"></path></g>
<g id="volume-down"><path d="M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"></path></g>
<g id="volume-mute"><path d="M7 9v6h4l5 5V4l-5 5H7z"></path></g>
<g id="volume-off"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></g>
<g id="volume-up"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></g>
<g id="web"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"></path></g>
<g id="web-asset"><path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm0 14H5V8h14v10z"></path></g>
</defs></svg>
</iron-iconset-svg>
<dom-module id="tricomp-reservation-lifecycle-events" assetpath="../triapp-reservation-list/">
	<template>
		<style>
			:host {
				display: inline-block;
			}
			
			.buttons-container {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
			}
			
			#checkin {
				background: var(--checkin-background), var(--ibm-green-50);
				color: var(--checkin-color);
				@apply(--checkin-mixin);
			}
			
			#checkout {
				background: var(--checkout-background);
				color: var(--checkout-color);
				@apply(--checkout-mixin);
			}
			
			#earlyend {
				background: var(--earlyend-background);
				color: var(--earlyend-color);
				@apply(--earlyend-mixin);
			}
			
			triplat-countdown {
				margin: 0 0.29em; /* matching paper-button margin */
				
				--countdown-container: {
					@apply(--layout-center-center);
					padding: 0.7em 0.57em; /* matching paper-button padding */
				};
			}

			.force-one-line {
				box-sizing: content-box;
				white-space: nowrap;
			}
		</style>

		<template is="dom-if" if="[[enableCountdown]]">
			<div class="buttons-container">
				<template is="dom-if" if="[[checkInRequired]]">
					<template is="dom-if" if="[[_computeShowCheckIn(checkInRequired, checkInCountdown, checkInCountdownExpired, meetingEndCountdownExpired)]]">
						<paper-button id="checkin" class="force-one-line" hidden$="[[!_isCheckInAvailable(checkInRequired, actualStart, checkInCountdownExpired)]]" title="Check In" icon="icons:zoom-in" on-tap="_handleCheckIn" noink="">Check In</paper-button>
					</template>

					<template is="dom-if" if="[[_computeShowCheckOut(checkInRequired, checkInCountdownExpired, meetingStartCountdownExpired, meetingEndCountdownExpired)]]">
						<paper-button id="checkout" class="force-one-line" hidden$="[[!_isCheckOutAvailable(checkInRequired, actualStart, actualEnd, meetingStartCountdownExpired, meetingEndCountdownExpired)]]" title="Check Out" icon="icons:zoom-out" on-tap="_handleCheckOut" noink="">Check Out</paper-button>
					</template>

					<triplat-countdown zname="checkin" name="[[_computeCheckInName(plannedStart)]]" label="Check In: " hidden="{{!_computeShowCheckInCountdown(isStarted, checkInCountdownExpired, checkInRequired)}}" zwait-until="[[_computeMeetingCheckInCountdownDeadline(checkInReminder)]]" disabled="[[_computeCountdownDisabled(disabled, checkInCountdown)]]" countdown="{{checkInCountdown}}" deadline="[[_computeMeetingCheckInCountdownDeadline(checkInReminder)]]" timezone="[[timezone]]" is-expired="{{checkInCountdownExpired}}">
					</triplat-countdown>
					<triplat-countdown zname="autocancel" hidden="" name="[[_computeAutoCancelName(plannedStart)]]" disabled="[[_computeCountdownDisabled(disabled, autoCancelCountdown)]]" countdown="{{autoCancelCountdown}}" deadline="[[_computeMeetingAutoCancelCountdownDeadline(checkInAutoCancel)]]" timezone="[[timezone]]" is-expired="{{autoCancelCountdownExpired}}">
					</triplat-countdown>
				</template>

				<template is="dom-if" if="[[!checkInRequired]]">
					<template is="dom-if" if="[[_computeShowEarlyEnd(checkInRequired, meetingEndCountdown, meetingStartCountdownExpired, meetingEndCountdownExpired)]]">
						<paper-button secondary="" id="earlyend" class="force-one-line" disabled$="[[!_isEarlyEndAvailable(checkInRequired, actualStart, actualEnd, meetingStartCountdownExpired, meetingEndCountdownExpired)]]" title="Early End" icon="icons:exit-to-app" on-tap="_handleEarlyEnd" noink="">End Early</paper-button>
					</template>
				</template>

				<triplat-countdown zname="start" name="[[_computeStartName(plannedStart)]]" label="Starts in: " hidden="{{!_computeShowStartCountdown(isStarted, meetingStartCountdownExpired, checkInRequired)}}" zwait-until="[[_computeMeetingStartCountdownDeadline(plannedStart)]]" disabled="[[_computeCountdownDisabled(disabled, meetingStartCountdown, checkInCountdownExpired)]]" countdown="{{meetingStartCountdown}}" deadline="[[_computeMeetingStartCountdownDeadline(plannedStart)]]" timezone="[[timezone]]" is-expired="{{meetingStartCountdownExpired}}">
				</triplat-countdown>
				<triplat-countdown zname="end" name="[[_computeEndName(plannedStart)]]" hidden="" disabled="[[_computeCountdownDisabled(disabled, meetingEndCountdown, meetingStartCountdownExpired)]]" countdown="{{meetingEndCountdown}}" deadline="[[_computeMeetingEndCountdownDeadline(actualStart, actualEnd, plannedEnd, meetingStartCountdownExpired)]]" timezone="[[timezone]]" is-expired="{{meetingEndCountdownExpired}}">
				</triplat-countdown>
			</div>
		</template>

	</template>
	<script>

		Polymer({

			is: "tricomp-reservation-lifecycle-events",

			behaviors: [TriDateUtilities],

			properties: {
				disabled: {
					type: Boolean,
					value: false
				},

				enableCountdown: {
					type: Boolean,
					value: false
				},

				/**
				* Is check-in required.  This will determine if the Check-In/Check-Out OR the Early-End
				* buttons are dispalyed.
				*
				**/
				checkInRequired: {
					type: Boolean,
				},

				/**
				* A date/time value (BEFORE the planned start time) used to determine an early check-in.
				*
				**/
				checkInReminder: {
					type: Date
				},

				/**
				* A date/time value (AFTER the start time) used to determine when the meeting will be
				* automatically cancelled.
				*
				**/
				checkInAutoCancel: {
					type: Date
				},

				/**
				* A date/time value denotiing the planned start time of the meeting.  When this time has
				* been reached, a "start" event will be fired.
				*
				**/
				plannedStart: {
					type: Date
				},

				/**
				* A date/time value denotiing the planned end time of the meeting.  When this time has
				* been reached, an "end" event will be fired.
				*
				**/
				plannedEnd: {
					type: Date
				},

				/**
				* A date/time value denotiing the actual start time of the meeting.
				*
				**/
				actualStart: {
					type: Date
				},

				reservationInstance: {
					type: Object
				},

				/**
				* A date/time value denotiing the actual end time of the meeting.
				*
				**/
				actualEnd: {
					type: Date
				},

				/**
				* A value denotiing the timezone of the user.
				*
				**/
				timezone: {
					type: String
				},

				// checkInCountdownExpired: Boolean,
				// meetingStartCountdownExpired: Boolean,
				// meetingEndCountdownExpired: Boolean,
				// countdown: Boolean,

				isStarted: {
					type: Boolean,
					notify: true,
					value: false
					// computed: '_computeIsStarted(checkInRequired, checkInCountdownExpired, meetingStartCountdownExpired, meetingEndCountdownExpired, countdown)'
				}
			},

			observers: [
				"_computeEnableCountdown(disabled, plannedStart, plannedEnd, timezone, reservationInstance)",
				"_start(meetingStartCountdownExpired)",
				"_end(meetingEndCountdownExpired)",
				"_autocancel(autoCancelCountdownExpired)",
			],


			_computeShowCheckInCountdown: function (isStarted, checkInCountdownExpired, checkInRequired) {
				return checkInRequired && !isStarted && !checkInCountdownExpired;
			},

			_computeShowStartCountdown: function (isStarted, meetingStartCountdownExpired, checkInRequired) {
				return Boolean(!checkInRequired && !isStarted && !meetingStartCountdownExpired);
			},

			_computeIsStarted: function (checkOutEarlyEndResult) {
				this.set('isStarted', checkOutEarlyEndResult);
			},

			_computeCheckInName: function (name) {
				return name + " - Check In";
			},

			_computeAutoCancelName: function (name) {
				return name + " - Auto Cancel";
			},

			_computeStartName: function (name) {
				return name + " - Start";
			},

			_computeEndName: function (name) {
				return name + " - End";
			},

			_computeEnableCountdown: function (disabled, plannedStart, plannedEnd, timezone, reservationInstance) {
				if (!reservationInstance || Object.keys(reservationInstance).length === 0) {
					// New reservation - disabling countdown
					this.set("enableCountdown", false);
					return false;
				}

				if (plannedStart) {
					if (this._getDateString(new Date(plannedStart)) != this._getCurrentDateString()) {
						// Reservation start time is not today - disabling countdown
						this.set("enableCountdown", false);
						return false;
					}
				}

				var value = Boolean(!disabled && plannedStart && plannedEnd && timezone);
				this.set("enableCountdown", value);
			},

			_computeShowCheckIn: function (checkInRequired, countdown, checkInCountdownExpired, meetingEndCountdownExpired) {
				return checkInRequired && ((checkInCountdownExpired && !meetingEndCountdownExpired) || (countdown && countdown.total == 0));
			},

			_computeShowCheckOut: function (checkInRequired, checkInCountdownExpired, meetingStartCountdownExpired, meetingEndCountdownExpired) {
				var showCheckOut = checkInRequired && (checkInCountdownExpired && meetingStartCountdownExpired && !meetingEndCountdownExpired);
				this._computeIsStarted(showCheckOut);

				return showCheckOut;
			},

			_computeShowEarlyEnd: function (checkInRequired, countdown, meetingStartCountdownExpired, meetingEndCountdownExpired) {
				var showEarlyEnd = !checkInRequired && (meetingStartCountdownExpired && !meetingEndCountdownExpired);
				this._computeIsStarted(showEarlyEnd);

				return showEarlyEnd;
			},

			_computeMeetingStartCountdownDeadline: function (plannedStart) {
				var value = null;
				if (plannedStart) {
					value = plannedStart;
				}

				return value;
			},

			_computeMeetingEndCountdownDeadline: function (actualStart, actualEnd, plannedEnd, meetingStartCountdownExpired) {
				var value = null;
				if (meetingStartCountdownExpired == undefined) {
					if (actualStart && !actualEnd)
						value = plannedEnd;
				} else {
					// since actualStart is updated via a future event workflow, 
					// we can't assume that value is updated on the client when the timer
					// is finished, so let's exclude it from the condition in the
					// scenerio where we have a client-side timer
					if (!actualEnd)
						value = plannedEnd;
				}

				return value;
			},

			_computeMeetingCheckInCountdownDeadline: function (checkInReminder) {
				var value = null;
				if (checkInReminder) {
					value = checkInReminder;
				}

				return value;
			},

			_computeMeetingAutoCancelCountdownDeadline: function (checkInAutoCancel) {
				var value = null;
				if (checkInAutoCancel) {
					value = checkInAutoCancel;
				}

				return value;
			},

			// disable the countdown if;
			//
			// 1) the component is disabled OR
			// 2) there is a dependent countdown and it hasn't yet expired OR
			// 3) we are outside of the countdown period
			_computeCountdownDisabled: function (disabled, countdown, dependsOnExpired) {
				var rtn = (disabled || dependsOnExpired === false) || this._isOutsideCountdownPeriod(countdown);

				return rtn;
			},

			// used to determine if a counter should be disabled based on the
			// fact that it is far enough into the future for the UI to care about
			// counting down.
			_isOutsideCountdownPeriod: function (countdown) {
				return (countdown.total != -1 &&
					countdown.total > 0 &&
					countdown.days > 0 &&
					countdown.hours > 1 &&
					countdown.minutes > 0);
			},

			_isCheckInAvailable: function (checkInRequired, actualStart, checkInCountdownExpired) {
				// TODO: consider auto-cancellation deadline

				return checkInRequired && !actualStart && (checkInCountdownExpired || checkInCountdownExpired == undefined);
			},

			_isCheckOutAvailable: function (checkInRequired, actualStart, actualEnd, meetingStartCountdownExpired, meetingEndCountdownExpired) {
				return checkInRequired && actualStart && !actualEnd && (!meetingEndCountdownExpired || meetingEndCountdownExpired == undefined) && (meetingStartCountdownExpired || meetingStartCountdownExpired == undefined);
			},

			_isEarlyEndAvailable: function (checkInRequired, actualStart, actualEnd, meetingStartCountdownExpired, meetingEndCountdownExpired) {
				var value = false;

				if (!checkInRequired) {
					if (meetingStartCountdownExpired == undefined) {
						value = actualStart && !actualEnd;
					} else {
						// since actualStart is updated via a future event workflow, 
						// we can't assume that value is updated on the client when the timer
						// is finished, so let's exclude it from the condition in the
						// scenerio where we have a client-side timer

						value = !actualEnd && !meetingEndCountdownExpired && meetingStartCountdownExpired;
					}
				}

				return value;
			},

			_start: function (meetingStartCountdownExpired) {
				if (meetingStartCountdownExpired)
					this.fire("start");
			},

			_end: function (meetingEndCountdownExpired) {
				if (meetingEndCountdownExpired)
					this.fire("end");
			},

			_autocancel: function (autoCancelCountdownExpired) {
				if (autoCancelCountdownExpired)
					this.fire("autocancel");
			},

			_handleCheckIn: function (e) {
				e.stopPropagation();

				var elem = e.currentTarget;
				elem.disabled = true;

				this.fire("checkin");
			},

			_handleCheckOut: function (e) {
				e.stopPropagation();

				var elem = e.currentTarget;
				elem.disabled = true;

				this.fire("checkout");
			},

			_handleEarlyEnd: function (e) {
				e.stopPropagation();

				var elem = e.currentTarget;
				elem.disabled = true;

				this.fire("earlyend");
			}

		});

	</script>
</dom-module>
<dom-module id="tricomp-reservation-list-item" assetpath="../triapp-reservation-list/">
	<template>
		<style>
			:host {
				position: relative;
				cursor: pointer;
				background-color: white;
			}
			:host[is-card] {
				@apply(--layout-vertical);
				min-width: 308px;
				max-width: 308px;
				margin-right: 20px;
				border: 1px solid var(--ibm-gray-10);
			}
			:host[is-card]:hover {
				@apply(--shadow-elevation-3dp);
				border-color: var(--ibm-blue-50);
			}

			.reservation-item-container {
				@apply(--layout-horizontal);
				max-width: 100%;
				padding: 20px 0;
			}
			:host[small-screen] .reservation-item-container {
				@apply(--layout-vertical);
			}
			:host[is-card] .reservation-item-container {
				@apply(--layout-vertical);
				flex: 1;
				height: 100%;
				padding: 20px;
			}
			:host(:not([is-card])) .reservation-item-container {
				border-bottom: 1px solid var(--ibm-gray-10);
			}
			:host(:not([is-card])):first-of-type .reservation-item-container {
				padding-top: 5px;
			}
			:host(:not([is-card])):last-of-type .reservation-item-container {
				border-bottom: none;
				padding-bottom: 0;
			}

			.reservation-details-container {
				@apply(--layout-vertical);
				@apply(--layout-center-justified);
				min-width: 0px;
				flex: 1;
			}
			:host[small-screen] .reservation-details-container,
			:host[is-card] .reservation-details-container {
				padding-bottom: 20px;
			}

			.room-item-container {
				@apply(--layout-horizontal);
				flex: 1;
			}

			.actions-container {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
			}
			:host(:not([small-screen]):not([is-card])) .actions-container {
				margin-left: 20px;
			}
			:host(:not([small-screen]):not([is-card])) .actions-container-multi {
				@apply(--layout-start);
				padding-top: 3em;
			}

			.dialog-buttons {
				@apply(--layout-horizontal);
				@apply(--layout-end-justified);
			}

			.date-session {
				@apply(--layout-vertical);
				margin-right: 20px;
			}

			.reservation-session {
				@apply(--layout-vertical);
				flex: 1;
				min-width: 0;
			}

			tricomp-reservation-title {
				max-width: 100%;
			}

			tricomp-reservation-room {
				flex: 1;
				margin-top: 10px;
			}

			.openReservationDialog {
				@apply(--layout-vertical);
				font-size: 14px;
				height: 190px;
				width: 250px;
			}

			iron-dropdown paper-button {
				align-items: flex-start !important;
				margin: 0;
				border-width: 0 !important;
			}
			iron-dropdown paper-button:hover {
				padding: 10px 22px !important;
			}

			iron-dropdown {
				border: 1px solid var(--ibm-gray-50);
				background: white;
			}

			.loading-indicator {
				margin: 20px;
				text-align: center;
			}

			.force-one-line {
				box-sizing: content-box;
				white-space: nowrap;
			}
		</style>

		<triplat-ds name="applicationSettings" data="{{applicationSettings}}"></triplat-ds>

		<tricore-url raw-url="/getCompanyFile.jsp?fileLoc=" bind-url="{{imgUrl}}"></tricore-url>

		<triplat-ds id="reservationResources" name="reservationResources" data="{{reservationResources}}" loading="{{reservationResourcesLoading}}" on-ds-get-complete="_onReservationResourcesGetComplete">
			<triplat-ds-context name="reservationDefinition" context-id="[[eventItem.recordId]]"></triplat-ds-context>
		</triplat-ds>

		<tricomp-array-comparator source="{{reservationResources}}" source-match-field="roomId" compare-to="{{favoriteRooms}}" match-flag="isFavorite" update-source="">
		</tricomp-array-comparator>

		<iron-a11y-keys id="tapKeys" target="[[_targetItem]]" keys="enter" on-keys-pressed="_handleOpenReservationTap"></iron-a11y-keys>

		<div id="reservationItem" class="reservation-item-container" on-tap="_handleOpenReservationTap">
			<div class="reservation-details-container">
				<div class="room-item-container">
					<div class="date-session" hidden$="[[_computeDateHidden(smallScreen, isCard)]]">
						<tricomp-reservation-date day="[[day]]" date="[[eventItem._Start_Datetime]]" datetime="[[datetime]]" current-user="[[currentUser]]" disabled="[[_computeDateDisabled(itemIndex)]]"></tricomp-reservation-date>
					</div>

					<div class="reservation-session">
						<template is="dom-if" if="[[!_reservationHasLocations(reservationResources)]]">
							<tricomp-reservation-duration event-item="[[eventItem]]" current-user="[[currentUser]]" is-card="[[isCard]]"></tricomp-reservation-duration>
						</template>

						<tricomp-reservation-duration event-item="[[eventItem]]" current-user="[[currentUser]]" is-card="[[isCard]]"></tricomp-reservation-duration>

						<tricomp-reservation-title id="reservationTitle" event-item="[[eventItem]]" is-card="[[isCard]]"></tricomp-reservation-title>

						
						<template is="dom-if" if="[[!isCard]]">
							<template is="dom-repeat" items="[[reservationResources]]">
								<tricomp-reservation-room event-item="[[item]]" application-settings="[[applicationSettings]]" is-card="[[isCard]]"></tricomp-reservation-room>
							</template>
						</template>
						<template is="dom-if" if="[[isCard]]">
							<tricomp-reservation-room event-item="[[_computeFirstReservationResource(reservationResources)]]" application-settings="[[applicationSettings]]" is-card="[[isCard]]" total-rooms="[[_computeReservationResourcesLength(reservationResources)]]"></tricomp-reservation-room>
						</template>

						<div class="loading-indicator" hidden="[[!_isLoading]]">
							<paper-spinner active=""></paper-spinner>
						</div>
					</div>
				</div>
			</div>

			<div class$="[[_computeActionsContainerClass(reservationResources)]]">
				<paper-button id="delete" class="force-one-line" hidden$="[[!_isShowDelete(eventItem, isStarted, reservationResources, isOutlookEmbedded)]]" on-tap="_handleCancelTap" danger-outline="" noink="">Cancel</paper-button>
				<tricomp-reservation-lifecycle-events id="lifecyle" is-started="{{isStarted}}" disabled="[[_computeLifeCycleDisabled(reservationResources)]]" timezone="[[currentUser._TimeZoneId]]" check-in-required="[[reservationInstance.checkInRequired]]" check-in-reminder="[[reservationInstance.checkInReminderDateTime]]" check-in-auto-cancel="[[reservationInstance.cancellationAutoDateTime]]" planned-start="[[reservationInstance.startDateTime]]" planned-end="[[reservationInstance.endDateTime]]" actual-start="[[reservationInstance.actualStart]]" actual-end="[[reservationInstance.actualEnd]]" reservation-instance="[[reservationInstance]]" on-checkin="_handleCheckIn" on-checkout="_handleCheckOut" on-earlyend="_handleEarlyEnd" on-start="_handleStart" on-end="_handleEnd" on-autocancel="_handleAutoCancel">
				</tricomp-reservation-lifecycle-events>
			</div>
		</div>

		<paper-dialog id="cancelDialog" with-backdrop="">
			<p>Are you sure you want to cancel this reservation?</p>
			<div class="dialog-buttons">
				<paper-button secondary="" dialog-dismiss="">No</paper-button>
				<paper-button dialog-confirm="" on-tap="_doCancel">Yes</paper-button>
			</div>
		</paper-dialog>

		<triblock-popup id="cancelSeriesReservationDialog" class="cancelReservationDialog" small-screen-max-width="1">
			<div>This is a recurring reservation.</div>
			<br>
			<paper-button id="cancelButton" on-tap="_doCancel" danger-outline="" noink="">Cancel Occurrence</paper-button>
			<br>
			<paper-button id="cancelSeriesButton" on-tap="_doCancelSeriesReservation" danger-outline="" noink="">Cancel Series</paper-button>
		</triblock-popup>

		<triblock-popup id="openReservationDialog" class="openReservationDialog" small-screen-max-width="1">
			<div>This is a recurring reservation.</div>
			<br>
			<paper-button id="openButton" on-tap="_handleOpenReservation" secondary="" noink="">Open Occurrence</paper-button>
			<br>
			<paper-button id="openSeriesButton" on-tap="_handleOpenSeriesReservation" secondary="" noink="">Open Series</paper-button>
		</triblock-popup>

		<iron-dropdown id="openReservationDropdown" horizontal-align="left" horizontal-offset="[[_openDropdownWidth]]" vertical-align="top" vertical-offset="[[_openDropdownHeight]]" position-target="[[_openDropdownTarget]]">
			<div class="dropdown-content">
				<paper-button on-tap="_handleOpenReservation" secondary="" noink="">Open Occurrence</paper-button>
				<paper-button on-tap="_handleOpenSeriesReservation" secondary="" noink="">Open Series</paper-button>
			</div>
		</iron-dropdown>

		<iron-dropdown id="cancelReservationDropdown" horizontal-align="right" vertical-align="[[_computeCancelDropdownVerticalAlign(isLastGroup, isLastItem)]]" vertical-offset="49" position-target="[[_cancelDropdownTarget]]">
			<div class="dropdown-content">
				<paper-button on-tap="_doCancel" secondary="" noink="">Cancel Occurrence</paper-button>
				<paper-button on-tap="_doCancelSeriesReservation" secondary="" noink="">Cancel Series</paper-button>
			</div>
		</iron-dropdown>

	</template>
	<script>
		Polymer({

			is: "tricomp-reservation-list-item",

			behaviors: [TriDateUtilities, TriReservationUtilitiesBehavior, TriBlockViewResponsiveBehavior],

			properties: {
				favoriteRooms: Array,
				eventItem: {
					type: Object,
					value: null,
					observer: '_eventItemChanged'
				},
				reservationInstance: {
					type: Object,
				},
				disabled: {
					type: Boolean,
					value: false
				},
				enableCountdown: {
					type: Boolean,
					value: true
				},
				isStarted: {
					type: Boolean,
					value: false
				},
				day: String,
				datetime: Date,
				isCard: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},
				itemIndex: {
					type: Number,
					value: 0
				},
				isLastGroup: {
					type: Boolean,
					value: false
				},
				isLastItem: {
					type: Boolean,
					value: false
				},
				_isLoading: {
					type: Boolean,
					computed: "_isBusy(isBusy, reservationResourcesLoading)"
				},
				_targetItem: {
					type: Object,
					value: function() {
						return this;
					}
				}
			},

			observers: [
				'_setDateAndDay(eventItem, currentUser._TimeZoneId)'
			],

			listeners: {},

			attached: function() {
				this._cancelDropdownTarget = this.$.delete;
				this._openDropdownTarget = this.$.reservationTitle;
			},

			_setDateAndDay: function(eventItem, timezone) {
				if (eventItem && timezone) {
					var mo = moment().tz(timezone)

					var startMo = moment(eventItem._Start_Datetime).tz(timezone);
					var lang = document.querySelector('html').getAttribute("lang") || 'en';
					startMo.locale(lang);
					var resultMo = startMo.locale(this.currentUser._Locale);

					if (startMo.isBefore(mo, 'day')) {
						resultMo = mo;
					}

					this.set('datetime', resultMo.toDate());
					this.set('day', resultMo.format("ddd").toUpperCase());
				}
			},

			_computeIsPendingApproval: function(status) {
				return status == 'Review In Progress';
			},

			_computeIsDeclined: function(status) {
				return status == 'Declined';
			},

			_reservationHasLocations: function(reservationResources) {
				return Boolean(reservationResources) && reservationResources.length > 0;
			},

			_computeLifeCycleDisabled: function(reservationResources) {
				var disableLifeCycle = false;
				if (reservationResources && reservationResources.length > 0) {
					for (var i = 0; i < reservationResources.length; i++) {
						var room = reservationResources[i];
						if (this._computeIsDeclined(room.status) || this._computeIsPendingApproval(room.status)) {
							disableLifeCycle = true;
							break;
						}
					}
				}
				return disableLifeCycle;
			},

			_isBusy: function(isBusy, reservationResourcesLoading) {
				return isBusy || reservationResourcesLoading;
			},

			_isShowDelete: function(eventItem, isStarted, reservationResources, isOutlookEmbedded) {
				var isPendingApproval = false;
				if (reservationResources && reservationResources.length > 0) {
					for (var i = 0; i < reservationResources.length; i++) {
						var resource = reservationResources[i];
						if (this._computeIsPendingApproval(resource.status)) {
							isPendingApproval = true;
							break;
						}
					}
				}

				return !this._isReadOnlyOutlook(isOutlookEmbedded, eventItem) && (isPendingApproval || (!eventItem.iCalUID && !isStarted));
			},

			_isShowSeriesDelete: function(eventItem, iCalUID, isStarted) {
				return this._isSeries(eventItem) && !iCalUID && !isStarted;
			},

			_eventItemChanged: function(value, oldValue) {
				if (!this.reservationInstance) {
					this.set("reservationInstance", value.reservationInstance);
				}
			},

			_handleCancel: function(e) {
				e.stopPropagation();

				this.$.cancelDialog.open();
			},

			_handleCancelTap: function(e) {
				e.stopPropagation();

				if (this._isSeries(this.eventItem)) {
					if (this.isCard) {
						if (this.$.openReservationDialog.opened) {
							this.$.openReservationDialog.closePopup();
						}
						this.$.cancelSeriesReservationDialog.fitInto = this;
						this.$.cancelSeriesReservationDialog.openPopup();
					} else {
						if (this.$.openReservationDropdown.opened) {
							this.$.openReservationDropdown.close();
						}
						this.$.cancelReservationDropdown.toggle();
					}
				} else {
					this._handleCancel(e);
				}
			},

			_doCancel: function(e) {
				e.stopPropagation();

				if (this.$.cancelDialog.opened) {
					this.$.cancelDialog.close()
				};

				var occurrenceStart = null;
				var occurrenceEnd = null;
				if (this._isSeries(this.eventItem)) {
					occurrenceStart = this.eventItem._Start_Datetime;
					occurrenceEnd = this.eventItem._End_Datetime;
				}

				this.fire("action-cancel-from-list", { 'reservationId' : this._getReservationDefinitionSpecId(),
														'occurrenceStart' : occurrenceStart,
														'occurrenceEnd' : occurrenceEnd});
			},


			_doCancelSeriesReservation: function(e) {
				e.stopPropagation();

				this.fire("action-cancel-from-list", { 'reservationId' : this._getReservationDefinitionSeriesSpecId(),
														'occurrenceStart' : null,
														'occurrenceEnd' : null});
			},

			_handleToggleRoomFavorite: function(e) {
				e.stopPropagation();

				var roomId = e.model.item.roomId;
				var isFavorite = e.model.item.isFavorite;
				this.fire("action-toggle-room-favorite", { 'roomId': roomId, 'isFavorite': !isFavorite });
			},

			_computeFavIcon: function(isFav) {
				return isFav ? "ibm:rating-star-filled" : "ibm:rating-star";
			},

			_handleCheckIn: function(e) {
				e.stopPropagation();

				this.fire("action-checkin-from-list", { 'instanceId' : this._getReservationInstanceSpecId()});
			},

			_handleCheckOut: function(e) {
				e.stopPropagation();

				this.fire("action-checkout-from-list", { 'instanceId' : this._getReservationInstanceSpecId()});
			},

			_handleEarlyEnd: function(e) {
				e.stopPropagation();

				this.fire("action-earlyend-from-list", { 'instanceId' : this._getReservationInstanceSpecId()});
			},

			_handleStart: function(e) {
				// Meeting has started
				if (this.reservationInstance.cancellationAutoDateTime) {
					// This meeting has an auto-cancellation policy - skipping auto start
				} else {
					this.set("instance.actualStart", new Date());
				}
			},

			_handleEnd: function(e) {
				// Meeting has ended
				this.set("instance.actualEnd", new Date());
				this.async(function() {
				}, 5000);
			},

			_handleAutoCancel: function(e) {
				// Meeting has been auto cancelled.
				if (this.reservationInstance.cancellationAutoDateTime) {
					this.set("instance.actualStart", "-1");
					this.set("instance.actualEnd", "-1");
				}
			},

			_getReservationInstanceSpecId: function() {
				if (this.reservationInstance)
					return this.reservationInstance._id;

				return null;
			},

			_getReservationDefinitionSpecId: function() {
				return this.eventItem.recordId;
			},

			_getReservationDefinitionSeriesSpecId: function() {
				return this.eventItem.seriesId ? this.eventItem.seriesId : this._getReservationDefinitionSpecId();
			},

			_setOpenDropdownPosition: function() {
				if (this.smallScreenWidth) {
					this._openDropdownWidth = 0;
					this._openDropdownHeight = this.$.reservationTitle.offsetHeight;
				} else {
					this._openDropdownWidth = this.$.reservationTitle.offsetWidth;
					this._openDropdownHeight = 0;
				}
			},

			_handleOpenReservationTap: function(e) {
				e.stopPropagation();

				if (this._isSeries(this.eventItem)) {
					if (this.isCard) {
						if (this.$.cancelSeriesReservationDialog.opened) {
							this.$.cancelSeriesReservationDialog.closePopup();
						}
						this.$.openReservationDialog.fitInto = this;
						this.$.openReservationDialog.openPopup();
					} else {
						if (this.$.cancelReservationDropdown.opened) {
							this.$.cancelReservationDropdown.close();
						}
						this._setOpenDropdownPosition();
						this.$.openReservationDropdown.toggle();
					}
				} else {
					this._handleOpenReservation(e);
				}
			},

			_handleOpenReservation: function(e) {
				e.stopPropagation();

				var occurrenceStart = null;
				var occurrenceEnd = null;
				if (this._isSeries(this.eventItem)) {
					occurrenceStart = this.eventItem._Start_Datetime;
					occurrenceEnd = this.eventItem._End_Datetime;
				}

				this.fire("navigate-reservation-open", { 'reservationId' : this._getReservationDefinitionSpecId(),
														'occurrenceStart' : occurrenceStart,
														'occurrenceEnd' : occurrenceEnd,
														'iCalUID' : this.eventItem.iCalUID});
			},

			_handleOpenSeriesReservation: function(e) {
				e.stopPropagation();

				// ACM TODO: e.stopPropagation() if it's tapping on the heart icon
				// if possible, find a way to make the heart icon invulnerable to this
				this.fire("navigate-reservation-open", { 'reservationId' : this._getReservationDefinitionSeriesSpecId(),
														'occurrenceStart' : null,
														'occurrenceEnd' : null,
														'iCalUID' : this.eventItem.iCalUID});
			},

			_onReservationResourcesGetComplete: function() {
				this.fire("reservation-resources-change");
			},

			_computeActionsContainerClass: function(resources) {
				return (resources && resources.length && resources.length > 1) ? "actions-container actions-container-multi" : "actions-container";
			},

			_computeDateDisabled: function(index) {
				return (index === 0) ? false : true;
			},

			_computeCancelDropdownVerticalAlign: function(lastGroup, lastItem) {
				return (lastGroup && lastItem) ? "bottom" : "top";
			},

			_computeDateHidden: function(smallScreen, isCard) {
				return (!smallScreen && !isCard) ? true : false;
			},

			_computeFirstReservationResource: function(resource) {
				return (resource && resource.length > 0) ? resource[0] : {};
			},

			_computeReservationResourcesLength: function(resource) {
				return (resource) ? resource.length : 0;
			}

		});
	</script>
</dom-module>
<dom-module id="tricomp-reservation-list-group" assetpath="../triapp-reservation-list/">
    <template>
        <style>
            :host(:not([is-card])) {
                border-bottom: 1px solid var(--ibm-gray-30);
                padding: 20px 0;
            }
            
            :host(:not([is-card])):first-of-type {
                padding-top: 0;
            }
            
            :host(:not([is-card])):last-of-type {
                border: 0;
            }
            
            :host(:not([small-screen-width]):not([is-card])) {
                @apply(--layout-horizontal);
                @apply(--layout-flex);
                flex-basis: 100%;
            }
            
            :host([small-screen-width]:not([is-card])):last-of-type {
                padding-bottom: 80px;
            }
            
            tricomp-reservation-date {
                margin-right: 20px;
                padding-top: 5px;
            }
            
            :host(:not([small-screen-width]):not([is-card])) .reservations-container {
                @apply(--layout-flex);
            }
        </style>

        <tricomp-reservation-date day="[[day]]" date="[[date]]" datetime="[[datetime]]" current-user="[[currentUser]]" hidden="[[_computeDateHidden(smallScreen, isCard)]]"></tricomp-reservation-date>

        <div class="reservations-container">
            <template is="dom-repeat" items="[[group]]">
                <tricomp-reservation-list-item event-item="[[item]]" current-user="[[currentUser]]" item-index="[[index]]" is-card="[[isCard]]" is-last-group="[[isLastGroup]]" is-last-item="[[_computeIsLastItem(index)]]">
                </tricomp-reservation-list-item>
            </template>
        </div>

    </template>
    <script>

        Polymer({

            is: "tricomp-reservation-list-group",

            behaviors: [TriBlockViewResponsiveBehavior],

            properties: {
                group: Array,
                currentUser: Object,
                isCard: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },
                isLastGroup: {
                    type: Boolean,
                    value: false
                },
                day: String,
                date: String,
                datetime: Date
            },

            observers: [
                '_setDateAndDay(group, currentUser._TimeZoneId)'
            ],

            _setDateAndDay: function (group, timezone) {
                if (group && timezone) {
                    var reservation = group[0];

                    var mo = moment().tz(timezone);
                    var startMo = moment(reservation._Start_Datetime).tz(timezone);
                    var lang = document.querySelector('html').getAttribute("lang") || 'en';
                    startMo.locale(lang);
                    var resultMo = startMo;
                    if (startMo.isBefore(mo, 'day')) {
                        resultMo = mo;
                    }

                    this.set('datetime', resultMo.toDate());
                    this.set('day', resultMo.format("ddd").toUpperCase());
                    this.set('date', reservation._Start_Datetime);
                }
            },

            _computeIsLastItem: function (index) {
                if (this.group.length - 1 === index) {
                    return true;
                } else {
                    return false;
                }
            },

            _computeDateHidden: function (smallScreen, isCard) {
                return (smallScreen || isCard) ? true : false;
            }

        });

    </script>
</dom-module>

<dom-module id="triplat-graphic-pin-classes" assetpath="../triplat-graphic/">
 	<template>
    	<style>
    		.tri-pin-icon-1 {
				fill: var(--triplat-graphic-pin-color-1, --ibm-gray-60);
			}

			.tri-pin-icon-2 {
				fill: var(--triplat-graphic-pin-color-2, --ibm-gray-60);
			}

			.tri-pin-icon-3 {
				fill: var(--triplat-graphic-pin-color-3, --ibm-gray-60);
			}

			.tri-pin-icon-4 {
				fill: var(--triplat-graphic-pin-color-4, --ibm-gray-60);
			}

			.tri-pin-icon-5 {
				fill: var(--triplat-graphic-pin-color-5, --ibm-gray-60);
			}

			.tri-pin-tooltip {
			    --internal-pin-tooltip-bg-color: var(--triplat-graphic-pin-tooltip-bg-color, 
			    	                                 --tri-primary-content-background-color);
			    --internal-pin-tooltip-text-color: var(--triplat-graphic-pin-tooltip-text-color, 
			    	                                   --ibm-gray-60);
			    --internal-pin-tooltip-border-color: var(--triplat-graphic-pin-tooltip-border-color, --tri-primary-light-color);
			    --internal-pin-tooltip-close-button-color: var(--triplat-graphic-pin-tooltip-close-button-color,--ibm-gray-60);
			    --internal-pin-tooltip-divider-line-color: var(--triplat-graphic-pin-tooltip-divider-line-color,--ibm-gray-10);
			    --internal-pin-tooltip: {
			    	@apply(--triplat-graphic-pin-tooltip);
			    };
			    --internal-pin-tooltip-container: {
			    	@apply(--triplat-graphic-pin-tooltip-container);
			    };
			}

			.tri-pin-outline[selected] {
				stroke: var(--triplat-graphic-pin-tooltip-border-color, --tri-primary-light-color);
    			stroke-width: 2px;
			}
    	</style>
	</template>
</dom-module><script>
/**
 * `TriPlatGraphicUtilitiesBehavior` is a behavior to support the use of the `triplat-graphic` component.
 * @polymerBehavior
 */

TriPlatGraphicUtilitiesBehavior = {
	properties: {
		_drawingIdAjax: {
			type: Object,
			notify: false,
			readOnly: true
		},

		_tricoreEl: {
			type: Object,
			notify: false,
			readOnly: true
		}
	},

	/**
	 * Returns a promise that resolves to the drawing ID associated to a floor record.
	 * @param {string} recordId The `ID` of the floor.
	 * @return {Promise}
	 */
	getDrawingId: function(recordId) {
		var url = this._getDrawingUrl(recordId);
		var drawingIdAjax = this._drawingIdAjax;

		if (!drawingIdAjax) {
			drawingIdAjax = document.createElement("iron-ajax");
			this._set_drawingIdAjax(drawingIdAjax);
		}
		drawingIdAjax.url = url;

		var request = drawingIdAjax.generateRequest();
		return request.completes
			.then(function() {
				if (request.response) {
					return request.response.drawingId;
				}
				return null;
			}.bind(this))
			.catch(function() {
				return null;
			}.bind(this));
	},

	/**
	 * Checks if the current floor has a graphic svg.
	 * It returns a promise that resolves to a boolean value.
	 * @param {string} recordId The `ID` of the floor.
	 * @return {Promise}
	 */
	hasGraphic: function(recordId) {
		return this.getDrawingId(recordId)
			.then(function(drawingId) {
				return drawingId != null;
			})
			.catch(function() {
				return false;
			});
	},

	_getDrawingUrl: function(recordId) {
		var tricoreEl = this._tricoreEl;
		if (!tricoreEl) {
			tricoreEl = document.createElement("tricore-url");
			this._set_tricoreEl(tricoreEl);
		}
		var floorUrl = "/p/floorplans?recordId=" + recordId;
		return tricoreEl.getUrl(floorUrl);
	},
}
</script><dom-module id="triplat-graphic-base" assetpath="../triplat-graphic/">
	<template>
        <style include="triplat-graphic-pin-classes">
            :host {
                display: block;
                height: 100%;
                @apply(--layout-flex);
                @apply(--layout);
                @apply(--layout-vertical);
                position: relative;
    			overflow: hidden;
            }
            #svgContainer {
                @apply(--layout-flex);
                @apply(--layout);
                @apply(--layout-vertical);
                height: inherit; /* Set the height to the triplat-graphic-base height. 
                                  * It solves a issue in EDGE when the svgContainer overflows the triplat-graphic-base
                                  */
            }

            svg {
            	@apply(--layout-flex);
            	height: 100%;
            	width: 100%;
            	overflow: hidden;
            	fill-rule: evenodd;
            }

            div {
                -webkit-tap-highlight-color: rgba(0,0,0,0);
            }
            
            svg .tri-attached.selectable {
            	@apply(--triplat-graphic-base-selectable);
            }
            svg .tri-interactive.selectable:not(.selected) {
            	@apply(--triplat-graphic-base-interactive-selectable);
            }
            svg .tri-attached.selectable.selected {
            	@apply(--triplat-graphic-base-selected);
            }
            svg .tri-interactive.selectable.selected {
            	@apply(--triplat-graphic-base-interactive-selected);
            }
            svg .tri-attached:not(.selectable){
            	@apply(--triplat-graphic-base-non-selectable);
            }
            svg .tri-attached.tri-highlight-1 {
            	@apply(--triplat-graphic-base-highlight-1);
            }
            svg .tri-attached.tri-highlight-2 {
            	@apply(--triplat-graphic-base-highlight-2);
            }
            svg .tri-attached.tri-highlight-3 {
            	@apply(--triplat-graphic-base-highlight-3);
            }
            svg .tri-attached.tri-highlight-4 {
            	@apply(--triplat-graphic-base-highlight-4);
            }
            svg .tri-attached.tri-highlight-5 {
            	@apply(--triplat-graphic-base-highlight-5);
            }
            svg .tri-attached.tri-highlight-group-1 {
            	@apply(--triplat-graphic-base-highlight-group-1);
            }
            svg .tri-attached.tri-highlight-group-2 {
            	@apply(--triplat-graphic-base-highlight-group-2);
            }
            svg .tri-attached.tri-highlight-group-3 {
            	@apply(--triplat-graphic-base-highlight-group-3);
            }
            svg .tri-attached.tri-highlight-group-4 {
            	@apply(--triplat-graphic-base-highlight-group-4);
            }
            svg .tri-attached.tri-highlight-group-5 {
            	@apply(--triplat-graphic-base-highlight-group-5);
            }
            svg .tri-interactive.tri-highlight-1 {
            	@apply(--triplat-graphic-base-highlight-1);
            }
            svg .tri-interactive.tri-highlight-2 {
            	@apply(--triplat-graphic-base-highlight-2);
            }
            svg .tri-interactive.tri-highlight-3 {
            	@apply(--triplat-graphic-base-highlight-3);
            }
            svg .tri-interactive.tri-highlight-4 {
            	@apply(--triplat-graphic-base-highlight-4);
            }
            svg .tri-interactive.tri-highlight-5 {
            	@apply(--triplat-graphic-base-highlight-5);
            }
            svg .tri-interactive.tri-highlight-group-1 {
            	@apply(--triplat-graphic-base-highlight-group-1);
            }
            svg .tri-interactive.tri-highlight-group-2 {
            	@apply(--triplat-graphic-base-highlight-group-2);
            }
            svg .tri-interactive.tri-highlight-group-3 {
            	@apply(--triplat-graphic-base-highlight-group-3);
            }
            svg .tri-interactive.tri-highlight-group-4 {
            	@apply(--triplat-graphic-base-highlight-group-4);
            }
            svg .tri-interactive.tri-highlight-group-5 {
            	@apply(--triplat-graphic-base-highlight-group-5);
            }
            svg .tri-interactive.drop-enter {
            	@apply(--triplat-graphic-base-interactive-drop-enter);
            }
            svg .tri-interactive.drop-done {
            	@apply(--triplat-graphic-base-interactive-drop-done);
            }
		</style>

		<tricore-url raw-url="{{_computeGetSvgUrl(drawingId)}}" bind-url="{{_svgUrl}}"></tricore-url>
		<iron-ajax id="getSvgAjax" url="{{_svgUrl}}" handle-as="text" on-response="_handleGetDrawingSvgResponse"></iron-ajax>
		<tricore-url raw-url="[[_computeGetCenterPointsUrl(drawingId)]]" bind-url="{{_centerPointsUrl}}"></tricore-url>
		<div id="svgContainer" on-tap="_svgTapped"></div>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-base",

		behaviors: [
			Polymer.IronResizableBehavior,
			TriPlatGraphicUtilitiesBehavior
		],

		properties: {

			drawingId: {
				type: Number,
				notify: false,
				readOnly: false,
				observer: "_handleDrawingIdChange"
			},

			recordId: {
				type: Number,
				notify: false,
				readOnly: false,
				observer: "_handleRecordIdChange"
			},

			svgLoaded: {
				type: Boolean,
				notify: true,
				readOnly: true,
				value: false,
				observer: "_handleSvgLoadedChanged"
			},

			svgElement: {
				type: Object,
				notify: true,
				readOnly: true
			},

			hasGraphic: {
				type: Boolean,
				readOnly: true,
				notify: true,
				value: false
			},

			units: {
				type: String,
				notify: true,
				readOnly: true
			},

			unitScaleFactor: {
				type: Number,
				notify: true,
				readOnly: true
			},

			/**
			 * Aria-label value for the svg.
			 */
			svgAriaLabel: {
				type: String,
				value: ""
			},

			svgElements: {
				type: Array,
				readOnly: true,
			},

			attachedElementsByRecordId: {
				type: Object,
				notify: true,
				readOnly: true
			},

			interactiveElementsByRecordId: {
				type: Object,
				notify: true,
				readOnly: true
			},

			drawingIdLoading: {
				type: Boolean,
				notify: true,
				readOnly: true,
				value: false,
			},

			loading: {
				type: Boolean,
				notify: true,
				readOnly: true,
				value: false,
				computed: "_computeLoading(drawingIdLoading, _svgLoading)"
			},

			_centerPointsByRecordId: {
				type: Object,
				readOnly: true
			},

			_viewPort: {
				type: Object,
				notify: true,
				readOnly: true
			},

			_calculatedWidth: {
				type: Number,
				notify: false,
				readOnly: true
			},

			_calculatedHeight: {
				type: Number,
				notify: false,
				readOnly: true
			},

			_svgLoading: {
				type: Boolean,
				readOnly: true,
				value: false
			}

		},

		observers: [
			"_handleViewPortChange(_viewPort.*, svgLoaded)"
		],

		listeners: {
			"iron-resize": "_onIronResize"
		},

		clearAllAttachedClasses: function(className) {
			Polymer.dom(this.svgElement).querySelectorAll("." + className).forEach(function(element) {
				this._removeClassSvg(element, className);
			}, this);
		},

		addClass: function(recordId, className, interactiveLayer) {
			if (interactiveLayer) {
				var interactiveEl = this.interactiveElementsByRecordId[recordId];
				if (interactiveEl) {
					this._addClassSvg(interactiveEl, className);
				}
			} else {
				var element = this.attachedElementsByRecordId[recordId];
				if (element) {
					this._addClassSvg(element, className);
				}
			}
		},

		addAttachedClass: function(recordId, className) {
			var element = this.attachedElementsByRecordId[recordId];
			if (element) {
				this._addClassSvg(element, className);
			}

			var interactiveEl = this.interactiveElementsByRecordId[recordId];
			if (interactiveEl) {
				this._addClassSvg(interactiveEl, className);
			}
		},

		addAttachedClassHGroup: function(recordId, className, color, interactiveLayer) {
			var element = null;
			if (interactiveLayer) {
				element = this.interactiveElementsByRecordId[recordId];
			} else {
				element = this.attachedElementsByRecordId[recordId];
			}
			
			if (element) {
				element.style.fill = color;
				this._addClassSvg(element, className);
			}
		},

		removeAttachedClass: function(recordId, className) {
			var element = this.attachedElementsByRecordId[recordId];
			if (element) {
				this._removeClassSvg(element, className);
			}

			var interactiveEl = this.interactiveElementsByRecordId[recordId];
			if (interactiveEl) {
				this._removeClassSvg(interactiveEl, className);
			}
		},

		getSvgContainer: function() {
			return this.$.svgContainer;
		},

		_addClassSvg: function(element, className) {
			var currentClasses = element.getAttribute("class");
			element.setAttribute("class", currentClasses + " " + className);
		},

		_removeClassSvg: function(element, className) {
			var currentClasses = element.getAttribute("class");
			var currentClassesArray = currentClasses.split(/\s/);
			var classToRemoveIndex = currentClassesArray.indexOf(className);
			if (classToRemoveIndex < 0) {
				return;
			}
			currentClassesArray.splice(classToRemoveIndex, 1);
			element.setAttribute("class", currentClassesArray.join(" "));
		},

		_handleRecordIdChange: function(newValue) {
			this.set("drawingId", null);
			this._setHasGraphic(false);
			if (newValue) {
				this._setDrawingIdLoading(true);
				this.getDrawingId(newValue).then(function(drawingId) {
					this._setDrawingIdLoading(false);
					if (!drawingId) {
						this._removeCurrentSvg();
						this._setHasGraphic(false);
					} else {
						this._setHasGraphic(true);
					}
					this.set("drawingId", drawingId);
				}.bind(this));
			}
		},

		_handleDrawingIdChange: function(newValue) {
			this._resetDrawing();
			this._setSvgLoaded(false);
			if (newValue) {
				this._set_svgLoading(true); 
				this.$.getSvgAjax.generateRequest();
			}
		},

		_handleSvgLoadedChanged: function(svgLoaded) {
			this.fire("svg-loaded", svgLoaded);
		},

		_computeGetSvgUrl: function(drawingId) {
			return "/p/floorplans/" + drawingId;
		},

		_removeCurrentSvg: function(){
			var container = this.$.svgContainer;
			var firstChild = Polymer.dom(container).firstChild;
			while (firstChild) {
				Polymer.dom(container).removeChild(firstChild);
				firstChild = Polymer.dom(container).firstChild;
			}
		},

		_handleGetDrawingSvgResponse: function(e) {
			var detail = e.detail;
			var xhr = detail.xhr;
			this._setUnits(xhr.getResponseHeader("X-Tri-Drawing-Units"));
			this._setUnitScaleFactor(parseFloat(xhr.getResponseHeader("X-TRI-Drawing-Scale-Factor")));
			var svg = detail.response;

			Polymer.dom(this.$.svgContainer).innerHTML = svg;
			var svgElement = Polymer.dom(this.$.svgContainer).querySelector("svg");
			Polymer.dom(svgElement).setAttribute("preserveAspectRatio", "xMidYMid");

			Polymer.dom(svgElement).setAttribute('aria-label', this.svgAriaLabel);

			this._setSvgElements([]);
			this._setAttachedElementsByRecordId({});
			var attachedElementsByRecordId = {};
			Polymer.dom(svgElement).querySelectorAll("[tri-record-id].tri-attached").forEach(function(element) {
				var recordId = element.getAttribute("tri-record-id");
				var bBox = null;
				if (recordId && recordId.length > 0) {
					try {
						bBox = element.getBBox();
					} catch(e) {
						//Firefox Bug 612118 - workaround
						// getBBox() fail if svg is hidden. For example, svg in hidden page of neon-animated-pages. 
						// Catch the exception and continue so svgLoad is set to true else elements that depend on this flag will fail (for example, tri-loading-indicator keep spinning).
						//console.warn(e);	
					}
					this.svgElements.push({recordId: recordId, bbox: bBox});
					attachedElementsByRecordId[recordId] = element;
				}
			}, this);
			this._setAttachedElementsByRecordId(attachedElementsByRecordId);

			this._setInteractiveElementsByRecordId({});
			var interactiveElementsByRecordId = {};
			Polymer.dom(svgElement).querySelectorAll("[tri-record-id].tri-interactive").forEach(function(element) {
				var recordId = element.getAttribute("tri-record-id");
				if (recordId && recordId.length > 0) {
					interactiveElementsByRecordId[recordId] = element;
				}
			}, this);
			this._setInteractiveElementsByRecordId(interactiveElementsByRecordId);

			try {
				this._extents = svgElement.getBBox();
			} catch(e) {
				//Firefox Bug 612118 - workaround
				// Catch the exception and continue so svgLoad is set to true else elements that depend on this flag will fail (for example, tri-loading-indicator keep spinning).
				//console.warn(e);	
				this._extents = {height: 0, width: 0, x: 0, y: 0};
			}
			this._setViewPort(this._extents);
			this._setSvgElement(svgElement);
			this._setSvgLoaded(true);
			this._set_svgLoading(false);

			this.async(this._updateStrokeWidthsExecute, 1);
		},

		_handleViewPortChange: function(viewPortChange, svgLoaded) {
			if (!svgLoaded) {
				return;
			}
			
			if (!this._viewPort) {
				return;
			}
			
			if (!this._viewPort.scale) {
				return;
			}

			this._updateStrokeWidths();

			this._setViewBox(
				this._viewPort.x,
				this._viewPort.y, 
				this._extents.width * this._viewPort.scale, 
				this._extents.height * this._viewPort.scale);
			this.fire("view-port-change", viewPortChange);
		},

		_updateStrokeWidths: function() {
			if (this._updateStrokeWidthsHandle) {
				this.cancelAsync(this._updateStrokeWidthsHandle);
			}
			this._updateStrokeWidthsHandle = this.async(this._updateStrokeWidthsExecute, 100);
		},

		_updateStrokeWidthsExecute: function() {
			if (!this.svgElement) {
				return;
			}

			var matrix = this.svgElement.getCTM() || this.svgElement.getScreenCTM();
			//Firefox Bug 612118 - workaround
			// hidden svg return null matrix, therefore return default scale of "1".
			var scale = matrix? matrix.a:"1";

			// Story 220077 - supporrt multiple triplat-graphic with different floor plan on the same page
			// hijack this method to send out event for triplatg-graphic-drag-drop
			if (this.matrixTransform(matrix)) {
				this.fire("refresh-ctm");
			}

			if (this._currentStrokeWidthScale === scale) {
				this._updateStrokeWidthsHandle = null;
				return;
			}
			this._currentStrokeWidthScale = scale;

			Polymer.dom(this.svgElement).querySelectorAll("g [stroke-width]").forEach(function(element) {
				var transformScale = 1.0;
				if (element.hasAttribute("sf")) {
					transformScale = parseFloat(element.getAttribute("sf"));
				}

				var strokeWidth = 1.0 / transformScale;
				var newStrokeWidth = strokeWidth / scale;
				element.setAttribute("stroke-width", newStrokeWidth);
			}, this);

			this._updateStrokeWidthsHandle = null;
		},

		_setViewBox: function(x, y, width, height) {
			Polymer.dom(this.svgElement).setAttribute("viewBox", x + " " + y + " " + width + " " + height);
		},

		_setViewPort: function(extents){
			this._set_viewPort({
				scale: 1.0,
				x: extents.x,
				y: extents.y,
				width: extents.width,
				height: extents.height
			});
		},

		_resetDrawing: function() {
			this._setSvgElement(null);
			this.set("_extents", null);
			Polymer.dom(this.$.svgContainer).innerHTML = "";
			this._setSvgElements([]);
			this._setAttachedElementsByRecordId({});
			this._setInteractiveElementsByRecordId({});
			this._currentStrokeWidthScale = null;
			this._set_centerPointsByRecordId(null);
		},

		_onIronResize: function() {
			var width = this.$.svgContainer.offsetWidth;
			var height = this.$.svgContainer.offsetHeight;
			this._set_calculatedWidth(width);
			this._set_calculatedHeight(height);
			this._updateStrokeWidths();
		},

		refreshViewBox: function(){
			if(this.svgElement) {
				//reseset the ViewBox before getBBox() is calculated so refresh return same BBox and init
				//(the ViewBox will be updated as ViewPort is set) 
				this._setViewBox(0,0,0,0);
				this._extents = this.svgElement.getBBox();
				this._setViewPort(this._extents);
			}
		},
		
		matrixTransform: function(matrix) {
			if (matrix) {
				if (matrix.a !== 1) return true;
				if (matrix.b !== 0) return true;
				if (matrix.c !== 0) return true;
				if (matrix.d !== 1) return true;
				if (matrix.e !== 0) return true;
				if (matrix.f !== 0) return true;
				return false;
			} else 
				return false;
		},

		appendChild: function(node) {
			Polymer.dom(this.root).appendChild(node);
		},

		_computeGetCenterPointsUrl: function(drawingId) {
			return "/p/floorplans/spaceCenterPoints?drawingId=" + drawingId;
		},

		/**
		 * Asynchronously gets the center points for all spaces in the floor plan.
		 * It returns a promise that resolves when all the center points
		 * are returned from the server. 
		 */
		getCenterPointsByRecordId: function() {
			var promiseResolve, promiseReject;
			var promise = new Promise(
				function(resolve, reject) {
					promiseResolve = resolve;
					promiseReject = reject;
				}
			);

			this.async(
				this._runGetCenterPointsByRecordId.bind(this, promiseResolve, promiseReject),
				1
			);

			return promise;
		},

		/**
		 * Executor method for the promise returned by
		 * the getCenterPointsByRecordId method
		 */
		_runGetCenterPointsByRecordId: function(promiseResolve, promiseReject) {
			if (this.drawingId) {
				if (!this._centerPointsByRecordId) {
					var request = document.createElement('iron-request');
					var requestOptions = {
						url: this._centerPointsUrl,
						method: "GET",
						handleAs: "json"
					};
	
					request.completes.then(
						this._handleGetCenterPointsResponse.bind(this, promiseResolve)
					).catch(
						promiseReject
					);
				
					request.send(requestOptions);
				} else {
					promiseResolve(this._centerPointsByRecordId);
				}
			} else {
				promiseReject();
			}
		},

		_handleGetCenterPointsResponse: function(promiseResolve, request) {
			var centerPoints = request.response;
			var centerPointsByRecordId = {};
			if (centerPoints && centerPoints.length > 0) {
				for (var i = 0; i < centerPoints.length; i++) {
					centerPointsByRecordId[centerPoints[i].recordId] = centerPoints[i];
				}
			}
			this._set_centerPointsByRecordId(centerPointsByRecordId);
			promiseResolve(this._centerPointsByRecordId);
		},

		_computeLoading: function(drawingIdLoading, _svgLoading) {
			return drawingIdLoading || _svgLoading;
		},

		_svgTapped: function(e) {
			e.stopPropagation();
			var target = e.target;
			this.fire("graphic-tapped", {"triRecordId": target.getAttribute("tri-record-id"), "class": target.getAttribute("class")});
		}
	});
</script>
<script>
    /**
     * A behavior to support defining the selectable spaces in a graphic. 
     *
     * @polymerBehavior Polymer.TriplatGraphicSelectableBehavior
     *
     */
    Polymer.TriplatGraphicSelectableBehavior = {
        
        properties: {
            /**
             * An array of shapes that can be selected by the user.
             * 
             * The SVG document generated will add the attached ID to the spaces.
             * This selected array must contain a value of _id that matches the 
             * attached ID.
             */
            selectable: {
                type: Array,
                notify: false,
                readOnly: false,
                observer: "_handleSelectableChanged"
            },

            _selectableById: {
                type: Object,
                notify: false,
                readOnly: true
            }
        },

        _handleSelectableChanged: function(selectable) {
            if(selectable){
                var selectableById = {};
                selectable.forEach(function(select) {
                    selectableById[select._id] = select;
                });
                this._set_selectableById(selectableById);
            } else {
                this._set_selectableById(null);
            }
        }
    }
</script><dom-module id="triplat-graphic-selectable" assetpath="../triplat-graphic/">
	<template></template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-selectable",

		behaviors: [
			Polymer.TriplatGraphicSelectableBehavior
		],

		properties: {

			/**
			 * The graphic on which the selectable shapes will perform actions against. 
			 * 
			 * Usually, this is automatically set by triplat-graphic.
			 */
			graphic: Object,

			/**
			 * If the multi option is not present, this will give access to the 
			 * selected record.
			 *
			 * If the multi option is present, this will give access to an array
			 * of selected records.
			 */
			selected: {
				type: Object,
				notify: true,
				readOnly: false
			},

			/**
			 * A flag to enable multi select of shapes. If this is omitted it will be 
			 * single select.
			 */
			multi: {
				type: Boolean,
				nofity: false,
				readOnly: false
			},
            
            /**
			 * A flag that will indicate if the selectable spaces are loaded. 
			 */
            selectableLoaded: {
                type: Boolean,
				readOnly: true,
                value: false,
                notify: true
            },
            
            /**
			 * A flag to enable this plugin. If this is omitted it will be 
			 * true and the plugin will be enabled.
			 */
			enabled: {
				type: Boolean,
				readOnly: false,
				value: true,
				observer: "_enabledChanged"
			},
            
            /**
			 * A flag to indicate the selectable styles will be
			 * maintained even though this plugin is disabled
			 */
            keepSelectableStyle: {
                type: Boolean,
                value: false
            },
            
            _svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false,
            },
            
		},

		observers: [
			"_initializeGraphic(graphic)",
			"_initializeSelected(selected.*, _svgLoaded)",
			"_handleSelectableByIdChanged(_selectableById, _svgLoaded)",
		],

		ready: function() {
			if (this.multi) {
				this.set("selected", []);
			}
		},

		_initializeGraphic: function(graphic) {
            this.listen(graphic, "svg-loaded", "_handleSvgLoadedChanged");
		},

		_handleSelectableByIdChanged: function(_selectableById, svgLoaded) {
            
            this._setSelectableLoaded(false);
            
			if (!svgLoaded || !this.enabled) {
				return;
			}
			this.graphic.clearAllAttachedClasses("selectable");
			if (!_selectableById || Object.keys(_selectableById).length == 0) {
				return;
			}

			for (var recordId  in _selectableById) {
				this.graphic.addAttachedClass(recordId, "selectable");
			}
            
            this._setSelectableLoaded(true);
		},

		_initializeSelected: function(selected, svgLoaded) {
            
			if (!svgLoaded || !this.enabled) {
				return;
			}
			if (this.multi) {
				this._initializeMultiSelected(selected);
			} else {
				var selectedValue = selected.value;
				this._initializeSingleSelected(selectedValue);
			}
		},

		_initializeSingleSelected: function(selected) {
			this._selectSingle(selected);
		},

		_initializeMultiSelected: function(selected) {
			this._selectMulti(selected);
		},

		_selectSingle: function(selected) {
			this.graphic.clearAllAttachedClasses("selected");
			if (selected) {
				this.graphic.addAttachedClass(selected._id, "selected");
			}
		},

		_selectMulti: function(selected) {
			
			if (selected.path == "selected.splices") {
				var indexSplice = selected.value.indexSplices[0];
				indexSplice.removed.forEach(function(removed) {
					this.graphic.removeAttachedClass(removed._id, "selected");
				}, this);
				for (var i = 0; i < indexSplice.addedCount; i++) {
					var added = indexSplice.object[indexSplice.index + i];
					this.graphic.addAttachedClass(added._id, "selected");
				}
			} else if(selected.path == "selected" && selected.value && selected.value.length > 0){
                
                if(selected.value[selected.value.length-1]._isBoundSelected){
                	selected.value.forEach(function(elem){
                        if(elem._isBoundSelected){
                            var index = this.selected.indexOf(elem);
                            this._handleTapByRecordId(elem._id, index);
                        }
                    }, this);
                   return;
                }
                
                this.graphic.clearAllAttachedClasses("selected");
                selected.value.forEach(function(elem){
                    this.graphic.addAttachedClass(elem._id, "selected");
                }, this);
            }
		},

		handleTap: function(target) {
			if (!this.enabled) {
				return;
			}

			if (!target.triRecordId) {
				return;
			}
			if (target.class.indexOf("tri-interactive") < 0) {
				return;
			}

			this._handleTapByRecordId(target.triRecordId);
		},
		
		_handleTapByRecordId: function(recordId, boundingIndex){
			if (!(recordId in this._selectableById)) {
				return;
			}

			var selectedValue = this._selectableById[recordId];

			if (this.multi) {
				var index = this.selected.indexOf(selectedValue);
				if (index < 0) {
                    if(boundingIndex >= 0){
                        this.splice("selected", boundingIndex, 1, selectedValue);
                    } else {
					   this.push("selected", selectedValue);
                    }
				} else {
					this.splice("selected", index, 1);
				}
			} else {
				if (this.selected && this.selected._id == recordId) {
					this.set("selected", null);
				} else {
					this.set("selected", selectedValue);
				}
			}
		},
        
        _handleSvgLoadedChanged: function(e){
            this._set_svgLoaded(e.detail);
        },
        
        _enabledChanged: function(value){
            if(!this.graphic){
				return;
			}
            if(value){
                this._handleSelectableByIdChanged(this._selectableById, this._svgLoaded);
                this._initializeSelected(this.selected, this._svgLoaded);
			} else {
                if(!this.keepSelectableStyle){
                    this.graphic.clearAllAttachedClasses("selectable");
                }
                this.graphic.clearAllAttachedClasses("selected");
			} 
        }
	});

</script><dom-module id="triplat-graphic-zoomable" assetpath="../triplat-graphic/">
	<template></template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-zoomable",

		properties: {
			/**
			 * The graphic on which the zoomable will perform actions against. 
			 * 
			 * Usually, this is automatically set by triplat-graphic
			 */
			graphic: {
				type: Object,
				observer: "_graphicChanged"
			},
			
			/**
			 * A flag to enable this plugin. If this is omitted it will be 
			 * true and the plugin will be enabled.
			 */
			enabled: {
				type: Boolean,
				notify: true,
				readOnly: false,
				value: true
			},
			
			/**
			 * A flag to enable the caching of pan and zoom. If this is omitted, it will be 
			 * false and the pan and zoom will not be persisted when switching between different graphics
			 * or when the graphic is reloaded. When cached is on, the last pan and zoom location will be preserved 
			 * until either this property is turned off or the component is detached.
			 */
			cached: {
				type: Boolean,
				notify: true,
				readOnly: false,
				reflectToAttribute: true,
				value: false,
				observer: "_cachedChanged"
			},
			
			/**
			 * Gets or sets the zoom factor for this graphic.
			 * By increasing this number, the graphic will be zoomed out, while the decrease will zoom in.
			 * It accepts a value between 0.01 and 1.5.
			 * When the graphic is first loaded the scale will have the value 1.0.
			 */
			scale: {
            	type: Number,
            	value: 1.0,
            	notify: true,
            	observer: "_handleScaleChanged"
            },
			
			_cacheViewPortMap: {
				type: Object,
				value: {}
			},
			
			_svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false
            },
            
            _mouseWheelModifier: {
            	type: Object,
            	value: {
            		0: 0.0002,	// deltaMode.DOM_DELTA_PIXEL
            		1: 0.008	// deltaMode.DOM_DELTA_LINE
            	}
            },
            
            _lastScale: {
            	type: Number,
            	value: 1.0
            }
		},
		
		observers: [
            "_initializeGraphic(graphic)",
            "_setCachedViewPort(_svgLoaded)",
            "_handleEnabledChanged(_svgLoaded, enabled)"
		],
        
        _initializeGraphic: function(graphic) {
            this.listen(graphic, "svg-loaded", "_handleSvgLoadedChanged");
		},
		
		_handleSvgLoadedChanged: function(e){
            this._set_svgLoaded(e.detail);
        },

		_graphicChanged: function(){
			this._handleEnabledChanged();
		},
		
		_handleEnabledChanged: function(){
			if(this.enabled && this._svgLoaded) {
				this._handleEnable();
			} else {
				this._handleDisable();
			}
		},
		
		_cachedChanged: function(newValue) {
			if (!newValue) {
				if (this._cacheViewPortMap) {
					this._clearCacheViewPortMap();
				}
			}
		},

		_handleTrackZoomPlugin: function(e) {
			var detail = e.detail;
			switch(detail.state) {
				case "start":
                    var ctm = this.graphic.svgElement.getCTM() || this.graphic.svgElement.getScreenCTM();
					var matrix = ctm.inverse();
					this._panStart = {
						matrix: matrix,
						start: this._getNormalizedPoint(detail.x, detail.y),
						orig: {x: this.graphic._viewPort.x, y: this.graphic._viewPort.y}
					};
					e.preventDefault();
				break;
				case "track":
					if (this._pinchInfo != null) {
						break;
					}
					var mousePoint = this._getNormalizedPoint(detail.x, detail.y, this._panStart.matrix);
					var x = this._panStart.orig.x + (this._panStart.start.x - mousePoint.x);
					this.graphic.set("_viewPort.x", x);
					var y = this._panStart.orig.y + (this._panStart.start.y - mousePoint.y);
					this.graphic.set("_viewPort.y", y);
					if (this.cached) {
						this._setViewPortCache(x, y, this.graphic._viewPort.scale);
					}
					e.preventDefault();
				break;
				case "end":
					this._panStart = null;
				break;
			}
		},

		_handleTouchStart: function(e) {
			if (e.touches.length != 2) {
				return;
			}
			e.preventDefault();
			this._pinchInfo = {
				startScale: this.graphic._viewPort.scale,
				startDistance: this._getMultiTouchDistance(e),
				width: this.graphic.offsetWidth,
				height: this.graphic.offsetHeight
			};
		},

		_handleTouchMove: function(e) {
			if (e.touches.length != 2) {
				return;
			}
			e.preventDefault();
			var distance = this._getMultiTouchDistance(e);
			var delta = (distance - this._pinchInfo.startDistance) * 0.001;
			this._handleZoom(this._pinchInfo.startScale - delta, this._pinchInfo.width, this._pinchInfo.height);
		},

		_handlePointerMove: function(e) {
			if (e.pointerType != "touch") {
				return;
			}
			e.preventDefault();
			if (this._pointerA && e.pointerId == this._pointerA.pointerId) {
				this._pointerA.clientX = e.clientX;
				this._pointerA.clientY = e.clientY;
			} else if (this._pointerB && e.pointerId == this._pointerB.pointerId) {
				this._pointerB.clientX = e.clientX;
				this._pointerB.clientY = e.clientY;
			}
			if (this._pointerA && this._pointerB) {
				var distance = this._getLineDistance(this._pointerB.clientX, this._pointerB.clientY, this._pointerA.clientX, this._pointerA.clientY);
				var delta = (distance - this._pinchInfo.startDistance) * 0.001;
				this._handleZoom(this._pinchInfo.startScale - delta, this._pinchInfo.width, this._pinchInfo.height);
			}
		},

		_handleTouchEnd: function(e) {
			this._pinchInfo = null;
		},

		_handleMouseWheel: function(e) {
			var deltaModifier = this._mouseWheelModifier[e.deltaMode];
			var delta = e.deltaY * deltaModifier;
			if (delta !== 0) {
				var newScale = this.graphic._viewPort.scale + delta;
				this._handleZoom(newScale, this.graphic._calculatedWidth, this.graphic._calculatedHeight);
			}
			e.preventDefault();
		},

		_handleZoom: function(newScale, width, height) {
			// prevent zooming too far out or too far in or same scale
			if (newScale > 1.5) {
				newScale = 1.5;	
			} 
			if (newScale < 0.01) {
				newScale = 0.01;
			}
			if (newScale == this._lastScale) {
				return;
			}
			this._lastScale = newScale;
			this.scale = newScale;
			var viewPort = {};
			viewPort.x = this.graphic._viewPort.x + 
				(((this.graphic._extents.width * this.graphic._viewPort.scale) - (this.graphic._extents.width * newScale)) / 2);
			viewPort.y = this.graphic._viewPort.y + 
				(((this.graphic._extents.height * this.graphic._viewPort.scale) - (this.graphic._extents.height * newScale)) / 2);
			viewPort.scale = newScale;
			this.graphic._set_viewPort(viewPort);
			if (this.cached) {
				this._setViewPortCache(viewPort.x, viewPort.y, viewPort.scale);
			}
		},
		
		_handleScaleChanged: function(newScale, oldScale) {
			if (this.graphic == null || !this._svgLoaded) {
				return;
			}
			this.debounce(
					"zoomable-handleScaleChanged",
					this._handleZoom.bind(this, newScale, this.graphic._calculatedWidth, this.graphic._calculatedHeight),
					20);
		},

		_handlePointerDown: function(e) {
			if (e.pointerType != "touch") {
				return;
			}

			if (!this._pointerA || e.pointerId == this._pointerA.pointerId) {
				this._pointerA = {
					pointerId: e.pointerId,
					clientX: e.clientX,
					clientY: e.clientY
				}
			} else  if (!this._pointerB || e.pointerId == this._pointerB.pointerId) {
				this._pointerB = {
					pointerId: e.pointerId,
					clientX: e.clientX,
					clientY: e.clientY
				}
			} 

			if (this._pointerA && this._pointerB) {
				var distance = this._getLineDistance(this._pointerB.clientX, this._pointerB.clientY, this._pointerA.clientX, this._pointerA.clientY);
				this._pinchInfo = {
					startScale: this.graphic._viewPort.scale,
					startDistance: distance,
					width: this.graphic.offsetWidth,
					height: this.graphic.offsetHeight
				};
			}
		},

		_handlePointerUp: function(e) {
			if (e.pointerType != "touch") {
				return;
			}
			if (this._pointerA && e.pointerId == this._pointerA.pointerId) {
				this._pointerA = null;
			}
			if (this._pointerB && e.pointerId == this._pointerB.pointerId) {
				this._pointerB = null;
			}
			if (!this._pointerA && !this._pointerB) {
				this._pinchInfo = null;
			}
		},

		_getMultiTouchDistance: function(e) {
			return this._getLineDistance(e.touches[0].clientX, e.touches[0].clientY, 
				e.touches[1].clientX, e.touches[1].clientY);
		},

		_getLineDistance: function(x1, y1, x2, y2) {
			var xdiff = x2 - x1;
			var ydiff = y2 - y1;
			return Math.sqrt((xdiff * xdiff) + (ydiff * ydiff));
		},

		_getNormalizedPoint: function(x, y, matrix) {
			if (!matrix) {
				var ctm = this.graphic.svgElement.getCTM() || this.graphic.svgElement.getScreenCTM();
				matrix = ctm.inverse();
			}
			var point = this.graphic.svgElement.createSVGPoint();
			point.x = x;
			point.y = y;
			return point.matrixTransform(matrix);
		},
		
		/**
		 * Calling this method will enable this plugin
		 */
		enable: function(){
			this.set("enabled", true);
		},
		
		/**
		 * Calling this method will disable this plugin
		 */
		disable: function(){
			this.set("enabled", false);
		},
		
		_handleEnable: function(){
			if(!this.graphic){
				return;
			}
			this.listen(this.graphic, "track", "_handleTrackZoomPlugin");
			this.listen(this.graphic, "wheel", "_handleMouseWheel");
			this.listen(this.graphic, "touchstart", "_handleTouchStart");
			this.listen(this.graphic, "pointerdown", "_handlePointerDown");
			this.listen(this.graphic, "touchmove", "_handleTouchMove");
			this.listen(this.graphic, "pointermove", "_handlePointerMove");
			this.listen(this.graphic, "touchend", "_handleTouchEnd");
			this.listen(this.graphic, "pointerup", "_handlePointerUp");
		},
		
		_handleDisable: function(){
			if(!this.graphic){
				return;
			}
			this.unlisten(this.graphic, "track", "_handleTrackZoomPlugin");
			this.unlisten(this.graphic, "wheel", "_handleMouseWheel");
			this.unlisten(this.graphic, "touchstart", "_handleTouchStart");
			this.unlisten(this.graphic, "pointerdown", "_handlePointerDown");
			this.unlisten(this.graphic, "touchmove", "_handleTouchMove");
			this.unlisten(this.graphic, "pointermove", "_handlePointerMove");
			this.unlisten(this.graphic, "touchend", "_handleTouchEnd");
			this.unlisten(this.graphic, "pointerup", "_handlePointerUp");
		},
		
		_clearCacheViewPortMap: function() {
			this._cacheViewPortMap = {};
		},
		
		_setViewPortCache: function(x, y, scale) {
			var cacheViewPort = {};
			cacheViewPort.x = x;
			cacheViewPort.y = y;
			cacheViewPort.scale = scale;
			this._cacheViewPortMap[this.graphic.drawingId] = cacheViewPort;
		},
		
		_setCachedViewPort: function(svgLoaded) {		
			if (!svgLoaded || !this.cached) {
				return;
			}
			var cacheViewPort = this._cacheViewPortMap[this.graphic.drawingId];
			if (cacheViewPort && cacheViewPort.scale) {
				this._lastScale = cacheViewPort.scale;
				this.scale = cacheViewPort.scale;
				this.graphic._set_viewPort(cacheViewPort);
			} else {
				this._lastScale = 1;
				this.scale = 1;
			}
		},
		
		_isCached: function() {
			return (this.cached && this._cacheViewPortMap[this.graphic.drawingId]);
		}
	});

</script><dom-module id="triplat-graphic-highlight" assetpath="../triplat-graphic/">
	<template></template>
</dom-module>
<script>
	TriplatHighlightLayers = {};
    TriplatHighlightLayers.INTERACTIVE = "INTERACTIVE";
    TriplatHighlightLayers.ATTACHED = "ATTACHED";

	Polymer({

		is: "triplat-graphic-highlight",

		properties: {

			/**
			 * The graphic on which the shapes will be highlighted. 
			 * 
			 * Usually, this is automatically set by triplat-graphic
			 */
			graphic: Object,

			/**
			 * NOTE: this property is deprecated.
			 * A css class to be applied to the highlighted shapes.
			 */
			classname: {
				type: String,
				readOnly: false,
				notify: false,
				observer: "_onClassnameChange"
			},

			/**
			 * The number used for styling using a mixin. See above.
			 */
			classNumber: {
				type: Number,
				readOnly: false,
				notify: false,
				value: 1,
				observer: "_onClassNumberChange"
			},

			/**
			 * An object containing the shapes to be highlighted.
			 * It can be either an array or a single element
			 */
			highlighted: {
				type: Object,
				notify: false,
				readOnly: false,
			},
			
			/**
             * Sets the spaces layer that will be highlighted by this plugin.
             * There are two options:
             * - INTERACTIVE: highlights the interactive (top) layer of the graphic.
             * - ATTACHED: highlights the attached layer of the graphic.
             */
            highlightLayer: {
                type: String,
                value: TriplatHighlightLayers.ATTACHED
            },
            
            _svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false
            }
		},

		observers: [
            "_initializeGraphic(graphic)",
			"_changeHighlighted(highlighted.*, _svgLoaded)"
		],
        
        _initializeGraphic: function(graphic) {
            this.listen(graphic, "svg-loaded", "_handleSvgLoadedChanged");
		},

		_changeHighlighted: function(change, svgLoaded){
			if (!svgLoaded) {
				return;
			}
			if(change.path == "highlighted"){
                this._clearClasses();
                this._addHighlight(change.value);
			}
			if(change.path == "highlighted.splices"){
				var indexSplice = change.value.indexSplices[0];
				indexSplice.removed.forEach(function(removed) {
					this._removeClass(removed._id);
				}, this);
				for (var i = 0; i < indexSplice.addedCount; i++) {
					var added = indexSplice.object[indexSplice.index + i];
					this._addClass(added._id);
				}
                this._forceMicrosoftStyleUpdate();
			}
		},
        
        _forceMicrosoftStyleUpdate: function() {
            /*
             * In IE and Edge sometimes the style is not applied, accessing the offsetWidth forces 
             * the browser to update the styles.
             */
            this.graphic.getSvgContainer().offsetWidth;
        },

		_clearClasses: function() {
			if (this.classname) {
            	this.graphic.clearAllAttachedClasses(this.classname);
            }
            this.graphic.clearAllAttachedClasses(this._getClassName());
		},

		_addClass: function(id) {
			var interactiveLayer = this.highlightLayer == TriplatHighlightLayers.INTERACTIVE;
			if (this.classname) {
				this.graphic.addClass(id, this.classname, interactiveLayer);
			}
			this.graphic.addClass(id, this._getClassName(), interactiveLayer);
		},

		_removeClass: function(id) {
			if (this.classname) {
				this.graphic.removeAttachedClass(id, this.classname);
			}
			this.graphic.removeAttachedClass(id, "tri-highlight-" + this.classNumber);
		},

		_getClassName: function() {
			return "tri-highlight-" + this.classNumber;
		},
        
        _handleSvgLoadedChanged: function(e){
            this._set_svgLoaded(e.detail);
        },

        _onClassNumberChange: function(classNumber, oldClassNumber) {
        	if (!classNumber || classNumber < 1 || classNumber > 5) {
        		console.warn("triplat-graphic-highlight: the classNumber must be a number from 1 to 5 inclusive. [classNumber=" + classNumber + "]");
        	}
            if(oldClassNumber){
                this.graphic.clearAllAttachedClasses("tri-highlight-" + oldClassNumber);
                this._addHighlight(this.highlighted);
            }
        },
        
        _addHighlight: function(highlighted){
            if(Array.isArray(highlighted)){
                highlighted.forEach(function(highlight){
					this._addClass(highlight._id);
				}, this);
            } else if(highlighted){
                this._addClass(highlighted._id);
            }
            this._forceMicrosoftStyleUpdate();    
        },

        _onClassnameChange: function() {
        	console.warn("triplat-graphic-highlight: classname is deprecated.");
        }
	});

</script>
<dom-module id="triplat-graphic-label" assetpath="../triplat-graphic/">
	<template>
		<iron-ajax id="getLabelAjax" handle-as="text" on-response="_handleGetLabelResponse"></iron-ajax>
    </template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-label",

		properties: {

			/**
			 * The graphic on which the label will be applied. 
			 * 
			 * Usually, this is automatically set by triplat-graphic
			 */
			graphic: Object,
            
            /**
			 * The labelId of a Label record
			 * 
			 * It can come from a query datasource with 
             * module = triGraphics and BO = triLabelStyle or
             * module = triGraphics and BO = triLabelFilter
			 */
            labelId: {
                type: Number,
                readOnly: false
            },
            
            _svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false
            }

		},
        
        observers: [
            "_initializeGraphic(graphic)",
			"_changeLabelId(labelId, _svgLoaded)",
		],
        
        _initializeGraphic: function(graphic) {
            this.listen(graphic, "svg-loaded", "_handleSvgLoadedChanged");
		},
        
        _handleGetLabelResponse: function(e) {
            if (!this.graphic.svgElement) {
                return;
            }
            var labelLayerEl = Polymer.dom(this.graphic.svgElement).querySelector("#_triLabelLayer");
            if (!labelLayerEl) {
                return;
            }

            var container = document.createElement("div");
            var svgToAdd = "<svg>" + e.detail.response + "</svg>";
            container.innerHTML=""+svgToAdd;
            var nodes = Array.prototype.slice.call(container.childNodes[0].childNodes);
            nodes.forEach(function(el){
                labelLayerEl.appendChild(el);
            });
        },
        
        _changeLabelId: function(labelId, svgLoaded){
            if(!svgLoaded){
                return;
            }
            
            this._clearCurrentLabels();

            if(labelId){
                var url = document.createElement("tricore-url");
				this.$.getLabelAjax.url = 
                    url.getUrl("/p/floorplans/labellayers?drawingId="+this.graphic.drawingId +"&labelId="+labelId);
                this.$.getLabelAjax.generateRequest();
            }
        },
        
        _handleSvgLoadedChanged: function(e){
            this._set_svgLoaded(e.detail);
        },

        _clearCurrentLabels: function() {
            if (!this.graphic.svgElement) {
                return;
            }
            var labelLayerEl = Polymer.dom(this.graphic.svgElement).querySelector("#_triLabelLayer");
            if (labelLayerEl) {
                Polymer.dom(labelLayerEl).innerHTML = "";
            }
        },
        
        _refreshLabel: function() {
            this._changeLabelId(this.labelId, this._svgLoaded);
        },
        
        refreshLabel: function(delay) {
        	if (!delay) {
        		delay = 1000;
        	}
        	this.async(this._refreshLabel, delay);
        }

	});

</script>
<dom-module id="triplat-graphic-bounding-selection" assetpath="../triplat-graphic/"> 
	<template></template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-bounding-selection",

		behaviors: [
			Polymer.TriplatGraphicSelectableBehavior
		],

		properties: {

			/**
			 * The graphic on which the shapes will be highlighted. 
			 * 
			 * Usually, this is automatically set by triplat-graphic
			 */
			graphic: Object,

			/**
			 * This will give access to an array of selected records.
			 */
			selected: {
				type: Object,
				notify: true,
				readOnly: false
			},
			
			/**
			 * A flag to enable this plugin. If this is ommitted it will be 
			 * true and the plugin will be enabled.
			 */
			enabled: {
				type: Boolean,
				notify: true,
				readOnly: false,
				value: true
			},

            _svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false
            },

            _svgPath: {
            	type: Object,
            	readOnly: true
            },
		},

		observers: [
            "_initializeGraphic(graphic)",
            "_handleEnabledChanged(_svgLoaded, enabled)"
		],
        
        _initializeGraphic: function() {
        	this.listen(this.graphic, "svg-loaded", "_handleSvgLoadedChanged");
        	this._handleEnabledChanged();
		},	
		
		_handleEnabledChanged: function(){
			if(this.enabled && this._svgLoaded) {
				this._handleEnable();
			} else {
				this._handleDisable();
			}
		},
        
        _handleSvgLoadedChanged: function(e){
            this._set_svgLoaded(e.detail);
        },

        _handleTrackBounding: function(e) {
        	var detail = e.detail;
			switch(detail.state) {
				case "start":
					this._set_svgPath(this._createSvgElement("rect"));
				  	this._svgPath.setAttribute("fill", "blue");
				  	this._svgPath.setAttribute("fill-opacity", "0.2");
				  	this._svgPath.setAttribute("stroke", "#000000");
                    
				  	this._trackStart = {
						start: this._getSVGCoordinate(detail.x, detail.y, this.graphic.svgElement),
					};

					this._svgPath.setAttribute("x", this._trackStart.start.x);
                    this._svgPath.setAttribute("width", 0);
					this._svgPath.setAttribute("y", this._trackStart.start.y);
                    this._svgPath.setAttribute("height", 0);
                    
				  	this.graphic.svgElement.appendChild(this._svgPath);
				  	e.preventDefault();
				break;
				case "track":
					if (this._svgPath){
						this._setSvgPathAttrs(detail);
					}
					e.preventDefault();
				break;
				case "end":
					if (this._svgPath){
						this._setSvgPathAttrs(detail);
						
						this.graphic.svgElement.removeChild(this._svgPath);
						this._trackStart = null;
						
						var intX = parseInt(this._svgPath.getAttribute("x"));
						var intY = parseInt(this._svgPath.getAttribute("y"))
						
						var calcX2 = intX + parseInt(this._svgPath.getAttribute("width"));
						var calcY2 = intY + parseInt(this._svgPath.getAttribute("height"));
						var bbox = {
							x: intX,
							x2: calcX2,
							y: intY,
							y2: calcY2,
						}
						this._set_svgPath(null);
						this._doSelections(bbox);
		    		}
		    		e.preventDefault();
				break;
			}
		},
		
		_setSvgPathAttrs: function(detail){
			var mousePoint = this._getSVGCoordinate(detail.x, detail.y, this.graphic.svgElement);
            
            var diffX = 0;
            var pathW = 0;
            var pathX = parseInt(this._svgPath.getAttribute("x"));
            if(mousePoint.x < pathX){
                pathW = parseInt(this._svgPath.getAttribute("width"));
                diffX = pathW + (pathX - mousePoint.x);
                this._svgPath.setAttribute("x", Math.ceil(mousePoint.x));
            } else if(this._trackStart.start.x > mousePoint.x){
                pathW = parseInt(this._svgPath.getAttribute("width"));
                diffX = pathW - (mousePoint.x - pathX);
                this._svgPath.setAttribute("x", Math.ceil(mousePoint.x));
            } else {
                diffX = mousePoint.x - this._trackStart.start.x;
            }
            
            var diffY = 0;
            var pathH = 0;
            var pathY = parseInt(this._svgPath.getAttribute("y"));
            if(mousePoint.y < pathY){
                pathH = parseInt(this._svgPath.getAttribute("height"));
                this._svgPath.setAttribute("y", Math.ceil(mousePoint.y));
                diffY = pathH + (pathY - mousePoint.y);
            } else if(this._trackStart.start.y > mousePoint.y){
                pathH = parseInt(this._svgPath.getAttribute("height"));
                diffY = pathH - (mousePoint.y - pathY);
                this._svgPath.setAttribute("y", Math.ceil(mousePoint.y));
            } else {
                diffY = mousePoint.y - this._trackStart.start.y;
            }
            
            this._svgPath.setAttribute("width", diffX);
            this._svgPath.setAttribute("height", diffY);
		},

        _createSvgElement: function(tagName){
	        return document.createElementNS("http://www.w3.org/2000/svg", tagName);
		},
		
		_doSelections: function(selectionBBox){
            
            var previousSelection = {};
            var records = [];
            this.selected.forEach(function(elem){
                previousSelection[elem._id] = elem;
                records.push(elem);
            });
            
			this.graphic.svgElements.forEach(function(svgElement){
                
                if(svgElement.recordId == this.graphic.recordId || previousSelection[svgElement.recordId]){
                    return;
                }

                if (this._selectableById && !(svgElement.recordId in this._selectableById)) {
					return;
				}

				var bbox = svgElement.bbox;
				bbox.x2 = bbox.x + bbox.width;
				bbox.y2 = bbox.y + bbox.height;

                if ( ((bbox.x >= selectionBBox.x && bbox.x <= selectionBBox.x2)
                    && (bbox.x2 <= selectionBBox.x2)) 
                    && ((bbox.y >= selectionBBox.y && bbox.y <= selectionBBox.y2)
                    && (bbox.y2 <= selectionBBox.y2))
                   )
                {
                    records.push({_id: svgElement.recordId, _isBoundSelected: true});   
                }
			}, this);
            
            
			this.selected = records;
		},
		
		/**
		 * Calling this method will enable this plugin
		 */
		enable: function(){
			this.set("enabled", true);
		},
		
		/**
		 * Calling this method will disable this plugin
		 */
		disable: function(){
			this.set("enabled", false);
		},
		
		_handleEnable: function(){
			if(!this.graphic){
				return;
			}
	        this.listen(this.graphic, "track", "_handleTrackBounding");
		},
		
		_handleDisable: function(){
			if(!this.graphic){
				return;
			}
	        this.unlisten(this.graphic, "track", "_handleTrackBounding");
		},
		
		_getSVGCoordinate: function (x, y, svgElement) {
			var svgPoint = null;
			var screenCTM = svgElement.getScreenCTM();
			if (screenCTM) {
				var screenPoint = svgElement.createSVGPoint();
				screenPoint.x = x;
				screenPoint.y = y;
				svgPoint = screenPoint.matrixTransform( screenCTM.inverse() );
			}
			return svgPoint;
		}
	});

</script>

<dom-module id="triplat-graphic-layer-manager" assetpath="../triplat-graphic/">
	<template>
		<iron-ajax id="getLayersAjax" on-response="_handleGetLayerResponse">
		</iron-ajax>
		<iron-ajax id="getLayerSVGAjax" handle-as="text" on-response="_handleGetLayerSVGResponse">
		</iron-ajax>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-layer-manager",

		properties: {

			/**
			 * The graphic on which the layers will be excluded. 
			 * 
			 * Typically, this is automatically set by triplat-graphic.
			 */
			graphic: Object,

			/**
			 * Object containing a list of available layers for
			 * the current drawing. Each element has information
			 * about the layer name and its visibility.
			 */
			layers: {
				type: Object,
				notify: true,
				value: []
			},

			/**
			 * Optional object that contains the layer names to be turned on
			 * when rendering the graphic. It can be either an array of
			 * layer names or a single string.
			 */
			turnOn: {
				type: Object,
				notify: true
			},

			/**
			 * Optional object that contains the layer names to be turned off
			 * when rendering the graphic. It can be either an array of
			 * layer names or a single string.
			 */
			turnOff: {
				type: Object,
				notify: true
			},
            
            _svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false
            },

            _layersLoaded: {
            	type: Boolean,
            	readOnly: true,
            	value: false
            }
		},

		observers: [
            "_initializeGraphic(graphic)",
            "_mapLayers(_svgLoaded)",
            "_handleLayers(layers.*)",
			"_turnOffChanged(_layersLoaded, turnOff.*)",
			"_turnOnChanged(_layersLoaded, turnOn.*)"
		],
        
        _initializeGraphic: function(graphic) {
            this.listen(graphic, "svg-loaded", "_handleSvgLoadedChanged");
		},

		_handleSvgLoadedChanged: function(e){
            this._set_svgLoaded(e.detail);
        },

		_mapLayers: function(svgLoaded){
			if (!svgLoaded) {
				return;
			}
			this._set_layersLoaded(false);
			var url = document.createElement("tricore-url");
			this.$.getLayersAjax.url = 
				url.getUrl("/p/floorplans/"+this.graphic.drawingId+"/layers");
            this.$.getLayersAjax.generateRequest();

		},

		_handleGetLayerResponse: function(e) {
            this.set("layers", e.detail.response);
            this._set_layersLoaded(true);
        },

		_handleLayers: function(change){
			var visibleSubpath = change.path.indexOf('.visible');
			if(visibleSubpath != -1){
				var itempath = change.path.substring(0, visibleSubpath);
    			var item = this.get(itempath);
    			var layers = Polymer.dom(this.graphic.svgElement).querySelectorAll("g[id='"+item.name+"']");
    			if(layers.length == 0 && item.visible){
    				// Layer is not retrieved yet
    				var url = document.createElement("tricore-url");
					this.$.getLayerSVGAjax.url = 
						url.getUrl("/p/floorplans/"+this.graphic.drawingId+"/layers/"+item.name);
		            this.$.getLayerSVGAjax.generateRequest();
    			}
    			
    			layers.forEach(function(layer){
    				layer.style.display = item.visible ? "block" : "none";
    			});
			}
		},

        _handleGetLayerSVGResponse: function(e) {
        	var container = document.createElement("div");
            var svgToAdd = "<svg>" + e.detail.response + "</svg>";
            container.innerHTML=""+svgToAdd;
            var nodes = Array.prototype.slice.call(container.childNodes[0].childNodes);
            nodes.forEach(function(el){
                Polymer.dom(this.graphic.svgElement).appendChild(el);
            }, this);
        },

		_turnOffChanged: function(layersLoaded, change){
			if (!layersLoaded) {
				return;
			}
			this._handleVisibilityArrayChange(change, false);
		},

		_turnOnChanged: function(layersLoaded, change){
			if (!layersLoaded) {
				return;
			}
			this._handleVisibilityArrayChange(change, true);
		},

		_handleVisibilityArrayChange: function(change, visible){
			var arrayName = visible ? "turnOn" : "turnOff";
			if(change.path == arrayName+".splices"){
				var indexSplice = change.value.indexSplices[0];
				indexSplice.removed.forEach(function(removed) {
					this._toggleLayer(removed, !visible);
				}, this);
				for (var i = 0; i < indexSplice.addedCount; i++) {
					var added = indexSplice.object[indexSplice.index + i];
					this._toggleLayer(added, visible);
				}
			}

			if(change.path == arrayName){
				if(Array.isArray(change.value)){
					change.value.forEach(function(layerName){
						this._toggleLayer(layerName, visible);
					}, this);
				} else if(change.value){
					this._toggleLayer(change.value, visible);
				}	
			}
		},

		_toggleLayer: function(layerName, visible){
			var index = -1;
			for(var i=0; i<this.layers.length; i++){
				var layer = this.layers[i];
				if(layer.name == layerName){
					if(layer.visible == !visible){
						index = this.layers.indexOf(layer);
					}
					break;
				}
			}
			if(index != -1){
				this.set("layers."+index+".visible", visible);
	   		}
		}
	});

</script><dom-module id="triplat-graphic-def" assetpath="../triplat-graphic/">
	<template>
		<content></content>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-def",

		properties: {

			/**
			 * The graphic on which the layers will be excluded. 
			 * 
			 * Usually, this is automatically set by triplat-graphic
			 */
			graphic: {
				type: Object,
				observer: "_onGraphicChange"
			}

		},

		_onGraphicChange: function(graphic) {
			this.listen(graphic, "svg-loaded", "_onSvgLoaded");
		},

		_onSvgLoaded: function(e) {
			var svgLoaded = e.detail;
			if (!svgLoaded) {
				return;
			}

			this._applyDefToSvg();
		},

		_applyDefToSvg: function() {
			var svgEl = this.graphic.svgElement;
			if (!svgEl) {
				return;
			}

			var svgNS = "http://www.w3.org/2000/svg";
			var defs = document.createElementNS(svgNS, "defs");
			defs.innerHTML = Polymer.dom(this).innerHTML;
			Polymer.dom(svgEl).appendChild(defs);
		}

	});
</script>
<dom-module id="triplat-graphic-drag-drop" assetpath="../triplat-graphic/">
	<template>
		<tricore-context-path get-path="{{_contextPath}}"></tricore-context-path>
		<triplat-drop id="triDrop" selector="{{selector}}" accept-selector="{{acceptSelector}}" no-setup="" in-graphic=""></triplat-drop>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-drag-drop",
		
		/**
	     * Fired when drag target drops into space.
	     *
	     * @event drop
	     */
	     
		properties: {

			/**
			 * The graphic on which the drag & drop will apply to. 
			 * 
			 * Usually, this is automatically set by <b>triplat-graphic</b>.
			 */
			graphic: Object,
			
			/*
			 * CSS selector for the element to interact with. 
			 * The default value (polyline.tri-interactive) will make all spaces in the floor plan become dropzones.
			 */
			selector: {
				type: String,
				value: "polyline.tri-interactive",
				reflectToAttribute: true,
				observer: '_updateSelector'
			},
			/**
			 * An array of the droppable spaces used to lookup space info when drop is successful
			 * 
			 * This data is usually from <b>triplat-ds</b> for all the spaces in the floor
			 */
			dropSpaces: {
				type: Array,
				notify: false,
				readOnly: false,
				observer: "_handleDropSpacesChanged"
			},
			
			/**
			 * This property can be useds as data bridge between <b>triplat-graphic-drag-drop</b> and <b>triplat-graphic-select</b>.
			 * When a successful drop occurs, this data array will be updated with the space as selected.
			 */
			spaceSelected: {
				type: Object,
				notify: true,
				readOnly: false
			},
			
			/*
			 * CSS selector for the accept element(s). 
			 * If using multiple triplat-graphic and default selector with different acceptSelector values,
			 * only the last one will succeed. Make sure to put all accept selectors in this property for that scenario.
			 */
			acceptSelector: {
				type: String,
				value: null,
				reflectToAttribute: true,
				observer: '_updateAcceptSelector'
			},
			
			/*
			 * Declaratively enable/disable graphic drop interaction
			 */
			enabled: {
				type: Boolean,
				value: true,
				readOnly: false,
				observer: 'updateEnabled'
			},

            _svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false
            },
            
            _dropSpaceById: {
				type: Object,
				notify: false,
				readOnly: true
			},
			
			_matrix: {
				type: Object,
				value: null
			},
			
			_position: {
				type: Object,
				value: null
			}
            
		},

		observers: [
            "_initializeGraphic(graphic)",
			"_setupDragdrop(_svgLoaded)"
		],
		
		listeners: {
			"drag-enter" : "_dropEnterHandler",
			"drag-leave" : "_dropLeaveHandler",
			"_drop" : "_dropDoneHandler"
		},
        
        _initializeGraphic: function(graphic) {
            this.listen(graphic, "svg-loaded", "_handleSvgLoadedChanged");
            this.listen(graphic, "refresh-ctm", "_handleCtmRefresh");
		},
		
		_updateSelector: function(newValue, oldValue) {
		},
		
		_updateAcceptSelector: function(newValue, oldValue) {
		},

		_handleDropSpacesChanged: function(dropSpaces) {
            if(dropSpaces){
                var dropSpaceById = {};
                dropSpaces.forEach(function(space) {
                    dropSpaceById[space._id] = space;
                });
                this._set_dropSpaceById(dropSpaceById);
            }
		},
		
		_computeOffset: function(obj) {
            var offsetleft = 0;
            var offsetTop = 0;
            if (obj.offsetParent) {
                do {
                    offsetleft += obj.offsetLeft;
                    offsetTop += obj.offsetTop;
                } while (obj = obj.offsetParent);
            }
            return {
                left : offsetleft,
                top : offsetTop
            };
        },

		_setupDragdrop: function(svgLoaded) {
			if (!svgLoaded) {
				return;
			}
			if (this.enabled) {
				this.$.triDrop.removeAttribute("no-setup");
				var matrix = this.graphic.svgElement.getCTM() || this.graphic.svgElement.getScreenCTM();
				var position = this._computeOffset(this.graphic);
				if (this._sameCoordinate(matrix, position)) return;
				var svgContainer = {};
				svgContainer.position = position;
				svgContainer.element = this.graphic.svgElement;
				this._matrix = matrix;
				this._position = position;
				/* Good info keeps for future debugging
					var graphicId = this.parentElement.getAttribute("id");
					console.log("_setupDragdrop: graphic id = " + graphicId + ", matrix = (" + matrix.a +"," + matrix.b + "," + matrix.c +
							"," + matrix.d + "," + matrix.e + "," + matrix.f +"), position = (left: " +
							position.left +", top: " + position.top + ")");
				*/
				this.$.triDrop.setSvgContainer(svgContainer);
				this.$.triDrop.setupDropZone();
			}
		},
        
        _handleSvgLoadedChanged: function(e) {
            this._set_svgLoaded(e.detail);
        },
        
        _dropEnterHandler: function(e) {
        	var dropTarget = e.detail.dropTarget;
        	if (!dropTarget || !dropTarget.hasAttribute("tri-record-id")) {
				return;
			}
			if (dropTarget.getAttribute("class").indexOf("tri-interactive") < 0) {
				return;
			}
			var recordId = dropTarget.getAttribute("tri-record-id");
			this.graphic.clearAllAttachedClasses("drop-enter");
			this.graphic.addAttachedClass(recordId, "drop-enter");	
        },
        
        _dropLeaveHandler: function(e) {
        	var dropTarget = e.detail.dropTarget;
        	if (!dropTarget || !dropTarget.hasAttribute("tri-record-id")) {
				return;
			}
			if (dropTarget.getAttribute("class").indexOf("tri-interactive") < 0) {
				return;
			}
			this.graphic.clearAllAttachedClasses("drop-enter");        	
        },
        
        _dropDoneHandler: function(e) {
        	var dropTarget = e.detail.dropTarget;
        	if (!dropTarget || !dropTarget.hasAttribute("tri-record-id")) {
				return;
			}
			if (dropTarget.getAttribute("class").indexOf("tri-interactive") < 0) {
				return;
			}
			var recordId = dropTarget.getAttribute("tri-record-id");
			this.graphic.clearAllAttachedClasses("drop-done");
			this.graphic.clearAllAttachedClasses("drop-enter");
			this.graphic.addAttachedClass(recordId, "drop-done");
			
			var dropSpaceValue = this._dropSpaceById[recordId];
			this.fire('drop', {dropTarget: dropSpaceValue,
							   dragTarget: e.detail.dragTarget});
							   
			if (this.spaceSelected) {
				var index = this.spaceSelected.indexOf(dropSpaceValue);
				if (index < 0) {
					this.push("spaceSelected", dropSpaceValue);
				} else {
					this.splice("spaceSelected", index, 1);
				}
			}
        },
        
        _handleCtmRefresh: function(e) {
        	if (this.graphic.svgElement) {
				this._setupDragdrop(this._svgLoaded);
        	}
        },
        
        _sameCoordinate: function(matrix, position) {
        	if (this._matrix == null) return false;
        	if (this._position == null) return false;
        	if (this._matrix.a != matrix.a) return false;
        	if (this._matrix.b != matrix.b) return false;
        	if (this._matrix.c != matrix.c) return false;
        	if (this._matrix.d != matrix.d) return false;
        	if (this._matrix.e != matrix.e) return false;
        	if (this._matrix.f != matrix.f) return false;
        	if (this._position.left != position.left) return false;
        	if (this._position.top != position.top) return false;
        	return true;
        },

		/*
	 	 * Programmatically enable/disable graphic drop interaction.
	 	 * Parameter value is true to enable, false to disable
	 	 */
        updateEnabled: function(newValue, oldValue) {
        	if ((typeof newValue != 'undefined') && (typeof oldValue != 'undefined')) {
        		this.$.triDrop.updateEnabled(value);
        	}	
        },
        
        ready: function() {
        	var triplatGraphic = Polymer.dom(this).parentNode;
        	var drag_drop_plugin = triplatGraphic._findPlugin("triplat-graphic-drag-drop");
        	if (drag_drop_plugin) {
        		if (Polymer.isInstance(this.$.triDrop)) {
        			//console.log("==== triplat-drop.html has been imported, no need for lazy loading...");
        		} else {
        			//console.log("==== lazy loading triplat-drop.html inside triplat-graphic-drag-drop.html");
					var link = this.importHref(this.resolveUrl("../triplat-drag-drop/triplat-drop.html"),
						function() {
							//console.log(link.href + " import successfully");
						},
						function() {
							console.error(link.href + " import failed!!");
						}
					);
        		}
        	}
        }
	});

</script><dom-module id="triplat-graphic-highlight-group" assetpath="../triplat-graphic/">
	<template>
    </template>
</dom-module>
<script>
    TriplatHighlightGroupLayers = {};
    TriplatHighlightGroupLayers.INTERACTIVE = "INTERACTIVE";
    TriplatHighlightGroupLayers.ATTACHED = "ATTACHED";

	Polymer({

		is: "triplat-graphic-highlight-group",

		properties: {

			/**
			 * The graphic on which the shapes will be highlighted. 
			 * Usually, this is automatically set by triplat-graphic.
			 */
			graphic: Object,

			/**
			 * An object containing the shapes to be grouped and highlighted.
			 */
			spaces: {
				type: Object,
				notify: false,
				readOnly: false,
			},
            
            /**
			 * The property of a space on which the groups will be created.
			 */
            groupBy: String,
            
             /**
			 * The property of a space that will provide the color value for
             * each space.
			 */
            colorBy: String,
            
            /**
			 * The opacity value that will be applied to a mask over every
             * other space other than the ones under the grouping.
             * A higher value will make the spaces more visible.
			 */
            maskOpacity: {
                type: Number,
                value: 0.9
            },
            
            /**
             * Sets an array of spaces to be highlighted by this plugin. This property is supposed to receive the array of 
             * spaces generated by the triplat-graphic-legend component.
             * The spaces in this array are already grouped and filtered by the legend component.
             */
            legendSpaces: {
                type: Array,
                notify: false,
                readOnly: false,
            },

            /**
             * Sets the spaces layer that will be highlighted by this plugin.
             * There are two options:
             * - INTERACTIVE: highlights the interactive (top) layer of the graphic.
             * - ATTACHED: highlights the attached layer of the graphic. If this option is used, the 
             * <b>maskOpacity</b> will be applied to the whole floorplan.
             */
            highlightLayer: {
                type: String,
                value: TriplatHighlightGroupLayers.INTERACTIVE
            },

            _svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false
            },
            
            _groups: {
                type: Object,
                value: {}
            },

            _rectElementAppended: {
                type: Boolean,
                value: false
            }
		},

		observers: [
            "_initializeGraphic(graphic)",
			"_changeSpaces(spaces.*, _svgLoaded)",
            "_setMaskElement(_svgLoaded)",
            "_changeLegendSpaces(legendSpaces.*, _svgLoaded)"
		],
        
        _initializeGraphic: function(graphic) {
            this.listen(graphic, "svg-loaded", "_handleSvgLoadedChanged");
		},
        
        ready: function(){
            this._observer = Polymer.dom(this).observeNodes(function(info) {
                var groups = this.queryAllEffectiveChildren("triplat-graphic-highlight-class");
                groups.forEach(function(group){
                    this._groups[group.value.toLowerCase()] = group.classNumber;       
                }, this);
            });
        },

        // Refreshes the mask element.
        refreshMaskElement: function() {
            this._setMaskElement(this._svgLoaded);
        },

        // Check if an element is visible.
        _isVisible: function(el) {
            return !!( el.offsetWidth || el.offsetHeight || el.getClientRects().length );
        },
        
        _setMaskElement: function(svgLoaded) {
            var isGraphicVisisble = (this.graphic) ? this._isVisible(this.graphic) : false;

            if (!svgLoaded || !isGraphicVisisble || this._rectElementAppended) {
                return;   
            }

            var svgElement = this.graphic.svgElement;
            var extents = svgElement.getBBox();
            var maskGroup = Polymer.dom(svgElement).querySelector("#_triMaskLayer");
            var rectElement = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rectElement.setAttribute("x", extents.x);
            rectElement.setAttribute("y", extents.y);
            rectElement.setAttribute("width", extents.width);
            rectElement.setAttribute("height", extents.height);
            rectElement.setAttribute("fill", "rgb(255,255,255)");
            rectElement.setAttribute("fill-opacity", 1 - this.maskOpacity);
            Polymer.dom(maskGroup).appendChild(rectElement);
            this._rectElementAppended = true;
        },

		_changeSpaces: function(change, svgLoaded){
			if (!svgLoaded) {
				return;
			}
            
			if(change.path == "spaces"){
                this._clearAllAttachedClasses();
                if(change.value){
                    change.value.forEach(function(space){
                        var groupValue = this._getGroupValue(space[this.groupBy]);
                        var classNumber = this._groups[groupValue];
                        this._addClass(space._id, classNumber, space[this.colorBy]);
                    }, this);
                }
                this._forceMicrosoftStyleUpdate();
			}

			if(change.path == "spaces.splices"){
				var indexSplice = change.value.indexSplices[0];
				indexSplice.removed.forEach(function(removed) {
                    var groupValue = this._getGroupValue(removed[this.groupBy]);
                    var classNumber = this._groups[groupValue];
					this._removeClass(removed._id, classNumber);
				}, this);
				for (var i = 0; i < indexSplice.addedCount; i++) {
                    var added = indexSplice.object[indexSplice.index + i];
                    var groupValue = this._getGroupValue(added[this.groupBy]);
                    var classNumber = this._groups[groupValue];
				    this._addClass(added._id, classNumber, added[this.colorBy]);
				}
                
                this._forceMicrosoftStyleUpdate();
			}
		},
        
        _forceMicrosoftStyleUpdate: function() {
            /*
             * In IE and Edge sometimes the style is not applied, accessing the offsetWidth forces 
             * the browser to update the styles.
             */
            this.graphic.getSvgContainer().offsetWidth;
        },
        
        _clearAllAttachedClasses: function(){
            for(var i=1; i<=5; i++){
                this.graphic.clearAllAttachedClasses(this._getClassName(i));    
            }    
        },
        
        _getGroupValue: function(groupValue){
            return groupValue.value ? groupValue.value.toLowerCase() : groupValue.toLowerCase();        
        },

		_addClass: function(id, classNumber, defaultColor) {
            var interactiveLayer = this.highlightLayer == TriplatHighlightGroupLayers.INTERACTIVE;
            this.graphic.addAttachedClassHGroup(id, this._getClassName(classNumber), 
                    defaultColor, interactiveLayer);
		},

		_removeClass: function(id, classNumber) {
			this.graphic.removeAttachedClass(id, this._getClassName(classNumber));
		},

		_getClassName: function(classNumber) {
			return "tri-highlight-group-" + classNumber;
		},
        
        _handleSvgLoadedChanged: function(e){
            this._set_svgLoaded(e.detail);
        },

        _changeLegendSpaces: function(change, svgLoaded){
            if (!svgLoaded) {
                return;
            }

            if(this.spaces && this.spaces.length > 0) {
                console.log("The 'legend-spaces' property and the 'spaces' property cannot be used together.");
                return;
            }
            
            if(change.path == "legendSpaces"){
                this._clearAllLegendSpaces();
                if(change.value){
                    change.value.forEach(function(legendSpace) {
                        this._highlightLegendSpace(legendSpace);
                    }, this);
                }
                this._forceMicrosoftStyleUpdate();
            }

            if(change.path == "legendSpaces.splices"){
                var indexSplice = change.value.indexSplices[0];
                indexSplice.removed.forEach(function(legendSpace) {
                    this._removeLegendSpace(legendSpace.id, legendSpace.classNumber);
                }, this);
                for (var i = 0; i < indexSplice.addedCount; i++) {
                    var legendSpace = indexSplice.object[indexSplice.index + i]
                    this._highlightLegendSpace(legendSpace);
                }
                
                this._forceMicrosoftStyleUpdate();
            }
        },

        _getSpaceElement: function(id) {
            if (this.highlightLayer == TriplatHighlightGroupLayers.INTERACTIVE) {           
                return this.graphic.interactiveElementsByRecordId[id];
            } else {
                return this.graphic.attachedElementsByRecordId[id];
            }
        },

        _highlightLegendSpace: function(legendSpace) {
            var space = this._getSpaceElement(legendSpace.id);
            if (space) {
                var color = this._getSpaceColor(space, legendSpace);
                this._addClass(legendSpace.id, legendSpace.classNumber, color);
                space.style["fill-opacity"] = legendSpace.fillOpacity;
            }
        },

        _getSpaceColor: function(space, legendSpace) {
            var color = "";
            if(legendSpace.color && legendSpace.color.values) {
                if (legendSpace.color.values.length == 1) {
                    color = legendSpace.color.values[0];
                } else {
                    color = this._createLinearGradient(space, legendSpace);
                }
            }
            return color;
        },

        _createLinearGradient: function(space, legendSpace) {
            var color = "tri-gradient-" + legendSpace.id;
            var linearGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            linearGradient.setAttribute("id", color);
            linearGradient.setAttribute("x1", "0%");
            linearGradient.setAttribute("y1", "0%");

            if(legendSpace.color.direction && legendSpace.color.direction === "horizontal") {
                linearGradient.setAttribute("x2", "100%");
                linearGradient.setAttribute("y2", "0%");
            } else {
                linearGradient.setAttribute("x2", "0%");
                linearGradient.setAttribute("y2", "100%");
            }

            var baseOffset = 100/(legendSpace.color.values.length);
            for (var i = 0; i < legendSpace.color.values.length; i++) {
                var stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                stop.setAttribute("offset", Math.trunc(baseOffset*i)+"%");
                stop.setAttribute("stop-color", legendSpace.color.values[i]);
                linearGradient.appendChild(stop);

                stop = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                stop.setAttribute("offset", Math.trunc(baseOffset*(i+1))+"%");
                stop.setAttribute("stop-color", legendSpace.color.values[i]);
                linearGradient.appendChild(stop);
            }

            Polymer.dom(this.graphic.svgElement).appendChild(linearGradient);
            space.color = linearGradient;
            return "url(#" + color + ")";
        },

        _clearAllLegendSpaces: function() {
            for(var i=1; i<=5; i++){
                Polymer.dom(this.graphic.svgElement).querySelectorAll("." + this._getClassName(i)).forEach(function(space) {
                    this._removeLegendSpace(space.getAttribute("tri-record-id"), i);
                }, this);     
            }             
        },

        _removeLegendSpace: function(id, classNumber) {
            this._removeClass(id, classNumber);
            var space = this._getSpaceElement(id);
             if (space.color) {
                Polymer.dom(this.graphic.svgElement).removeChild(space.color);
                space.color = null;
            }
            space.style["fill-opacity"] = "";
            space.style.fill = "";
        }

	});
    
    HighlightClass = Polymer({

        is: "triplat-graphic-highlight-class",
        
        properties: {
            value: String,
            classNumber: Number
        }
    });

</script>





<script>

  Polymer({

    is: 'fade-out-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;
      this._effect = new KeyframeEffect(node, [
        {'opacity': '1'},
        {'opacity': '0'}
      ], this.timingFromConfig(config));
      return this._effect;
    }

  });

</script><dom-module id="paper-tooltip" assetpath="../paper-tooltip/">
  <template>
    <style>
      :host {
        display: block;
        position: absolute;
        outline: none;
        z-index: 1002;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        cursor: default;
      }

      #tooltip {
        display: block;
        outline: none;
        @apply(--paper-font-common-base);
        font-size: 10px;
        line-height: 1;

        background-color: var(--paper-tooltip-background, #616161);
        opacity: var(--paper-tooltip-opacity, 0.9);
        color: var(--paper-tooltip-text-color, white);

        padding: 8px;
        border-radius: 2px;

        @apply(--paper-tooltip);
      }

      /* Thanks IE 10. */
      .hidden {
        display: none !important;
      }
    </style>

    <div id="tooltip" class="hidden">
      <content></content>
    </div>
  </template>

  <script>
    Polymer({
      is: 'paper-tooltip',

      hostAttributes: {
        role: 'tooltip',
        tabindex: -1
      },

      behaviors: [
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {
        /**
         * The id of the element that the tooltip is anchored to. This element
         * must be a sibling of the tooltip.
         */
        for: {
          type: String,
          observer: '_findTarget'
        },

        /**
         * Set this to true if you want to manually control when the tooltip
         * is shown or hidden.
         */
        manualMode: {
          type: Boolean,
          value: false,
          observer: '_manualModeChanged'
        },

        /**
         * Positions the tooltip to the top, right, bottom, left of its content.
         */
        position: {
          type: String,
          value: 'bottom'
        },

        /**
         * If true, no parts of the tooltip will ever be shown offscreen.
         */
        fitToVisibleBounds: {
          type: Boolean,
          value: false
        },

        /**
         * The spacing between the top of the tooltip and the element it is
         * anchored to.
         */
        offset: {
          type: Number,
          value: 14
        },

        /**
         * This property is deprecated, but left over so that it doesn't
         * break exiting code. Please use `offset` instead. If both `offset` and
         * `marginTop` are provided, `marginTop` will be ignored.
         * @deprecated since version 1.0.3
         */
        marginTop: {
          type: Number,
          value: 14
        },

        /**
         * The delay that will be applied before the `entry` animation is
         * played when showing the tooltip.
         */
        animationDelay: {
          type: Number,
          value: 500
        },

        /**
         * The entry and exit animations that will be played when showing and
         * hiding the tooltip. If you want to override this, you must ensure
         * that your animationConfig has the exact format below.
         */
        animationConfig: {
          type: Object,
          value: function() {
            return {
              'entry': [{
                name: 'fade-in-animation',
                node: this,
                timing: {delay: 0}
              }],
              'exit': [{
                name: 'fade-out-animation',
                node: this
              }]
            }
          }
        },

        _showing: {
          type: Boolean,
          value: false
        }
      },

      listeners: {
        'neon-animation-finish': '_onAnimationFinish',
      },

      /**
       * Returns the target element that this tooltip is anchored to. It is
       * either the element given by the `for` attribute, or the immediate parent
       * of the tooltip.
       */
      get target () {
        var parentNode = Polymer.dom(this).parentNode;
        // If the parentNode is a document fragment, then we need to use the host.
        var ownerRoot = Polymer.dom(this).getOwnerRoot();

        var target;
        if (this.for) {
          target = Polymer.dom(ownerRoot).querySelector('#' + this.for);
        } else {
          target = parentNode.nodeType == Node.DOCUMENT_FRAGMENT_NODE ?
              ownerRoot.host : parentNode;
        }

        return target;
      },

      attached: function() {
        this._findTarget();
      },

      detached: function() {
        if (!this.manualMode)
          this._removeListeners();
      },

      show: function() {
        // If the tooltip is already showing, there's nothing to do.
        if (this._showing)
          return;

        if (Polymer.dom(this).textContent.trim() === '')
          return;


        this.cancelAnimation();
        this._showing = true;
        this.toggleClass('hidden', false, this.$.tooltip);
        this.updatePosition();

        this.animationConfig.entry[0].timing = this.animationConfig.entry[0].timing || {};
        this.animationConfig.entry[0].timing.delay = this.animationDelay;
        this._animationPlaying = true;
        this.playAnimation('entry');
      },

      hide: function() {
        // If the tooltip is already hidden, there's nothing to do.
        if (!this._showing) {
          return;
        }

        // If the entry animation is still playing, don't try to play the exit
        // animation since this will reset the opacity to 1. Just end the animation.
        if (this._animationPlaying) {
          this.cancelAnimation();
          this._showing = false;
          this._onAnimationFinish();
          return;
        }

        this._showing = false;
        this._animationPlaying = true;
        this.playAnimation('exit');
      },

      updatePosition: function() {
        if (!this._target || !this.offsetParent)
          return;

        var offset = this.offset;
        // If a marginTop has been provided by the user (pre 1.0.3), use it.
        if (this.marginTop != 14 && this.offset == 14)
          offset = this.marginTop;

        var parentRect = this.offsetParent.getBoundingClientRect();
        var targetRect = this._target.getBoundingClientRect();
        var thisRect = this.getBoundingClientRect();

        var horizontalCenterOffset = (targetRect.width - thisRect.width) / 2;
        var verticalCenterOffset = (targetRect.height - thisRect.height) / 2;

        var targetLeft = targetRect.left - parentRect.left;
        var targetTop = targetRect.top - parentRect.top;

        var tooltipLeft, tooltipTop;

        switch (this.position) {
          case 'top':
            tooltipLeft = targetLeft + horizontalCenterOffset;
            tooltipTop = targetTop - thisRect.height - offset;
            break;
          case 'bottom':
            tooltipLeft = targetLeft + horizontalCenterOffset;
            tooltipTop = targetTop + targetRect.height + offset;
            break;
          case 'left':
            tooltipLeft = targetLeft - thisRect.width - offset;
            tooltipTop = targetTop + verticalCenterOffset;
            break;
          case 'right':
            tooltipLeft = targetLeft + targetRect.width + offset;
            tooltipTop = targetTop + verticalCenterOffset;
            break;
        }

        // TODO(noms): This should use IronFitBehavior if possible.
        if (this.fitToVisibleBounds) {
          // Clip the left/right side.
          if (tooltipLeft + thisRect.width > window.innerWidth) {
            this.style.right = '0px';
            this.style.left = 'auto';
          } else {
            this.style.left = Math.max(0, tooltipLeft) + 'px';
            this.style.right = 'auto';
          }

          // Clip the top/bottom side.
          if (tooltipTop + thisRect.height > window.innerHeight) {
            this.style.bottom = '0px';
            this.style.top = 'auto';
          } else {
            this.style.top = Math.max(0, tooltipTop) + 'px';
            this.style.bottom = 'auto';
          }
        } else {
          this.style.left = tooltipLeft + 'px';
          this.style.top = tooltipTop + 'px';
        }

      },

      _addListeners: function() {
        if (this._target) {
          this.listen(this._target, 'mouseenter', 'show');
          this.listen(this._target, 'focus', 'show');
          this.listen(this._target, 'mouseleave', 'hide');
          this.listen(this._target, 'blur', 'hide');
          this.listen(this._target, 'tap', 'hide');
        }
        this.listen(this, 'mouseenter', 'hide');
      },

      _findTarget: function() {
        if (!this.manualMode)
          this._removeListeners();

        this._target = this.target;

        if (!this.manualMode)
          this._addListeners();
      },

      _manualModeChanged: function() {
        if (this.manualMode)
          this._removeListeners();
        else
          this._addListeners();
      },

      _onAnimationFinish: function() {
        this._animationPlaying = false;
        if (!this._showing) {
          this.toggleClass('hidden', true, this.$.tooltip);
        }
      },

      _removeListeners: function() {
        if (this._target) {
          this.unlisten(this._target, 'mouseenter', 'show');
          this.unlisten(this._target, 'focus', 'show');
          this.unlisten(this._target, 'mouseleave', 'hide');
          this.unlisten(this._target, 'blur', 'hide');
          this.unlisten(this._target, 'tap', 'hide');
        }
        this.unlisten(this, 'mouseenter', 'hide');
      }
    });
  </script>
</dom-module>
<dom-module id="triplat-graphic-pin-tooltip" assetpath="../triplat-graphic/">
	<template>
		<style>
			#tooltip {
				@apply(--internal-pin-tooltip-container);
				--paper-tooltip: { 
		    	    padding: 0px;
		    	    font-size: 14px;
		    	    @apply(--internal-pin-tooltip);
			    };
			    --paper-tooltip-background: var(--internal-pin-tooltip-bg-color);
			    --paper-tooltip-text-color: var(--internal-pin-tooltip-text-color);
			    white-space: nowrap;
			}

			.tooltipContent {
				border-width: 2px;
		       	border-style: solid; 
		    	padding-top: 10px;
		    	padding-bottom: 10px;
		    	border-radius: 3px;
		    	border-color: var(--internal-pin-tooltip-border-color);
		    	@apply(--layout-vertical);
			}

			.tooltipContent::after {
				content: '';
				position: absolute;
				border-style: solid;
				border-top-color: transparent;
				border-bottom-color: transparent;
				border-right-color: var(--internal-pin-tooltip-bg-color);
				border-left-color: var(--internal-pin-tooltip-bg-color);
				display: block;
				width: 0;
				z-index: 1;
				margin-top: -7px;
				top: 50%;
			}

			:host([position="left"]) .tooltipContent::after {
				border-width: 7px 0px 7px 7px;
				right: -4px;
			}

			:host([position="right"]) .tooltipContent::after {
				border-width: 7px 7px 7px 0px;
				left: -4px;
			}

			.tooltipContent::before {
				content: '';
				position: absolute;
				border-style: solid;
				border-top-color: transparent;
				border-bottom-color: transparent;
				border-right-color: var(--internal-pin-tooltip-border-color);
				border-left-color: var(--internal-pin-tooltip-border-color);
				display: block;
				width: 0;
				z-index: 0;
				margin-top: -8px;
				top: 50%;
			}

			:host([position="left"]) .tooltipContent::before {
				border-width: 8px 0px 8px 8px;
				right: -7px;
			}

			:host([position="right"]) .tooltipContent::before {
				border-width: 8px 8px 8px 0px;
				left: -7px;
			}

			.tooltipTitle {
				height: 22px;
				font-weight: bold;
				border-bottom-style: solid;
				border-bottom-width: 1px;
				border-bottom-color: var(--internal-pin-tooltip-divider-line-color);
				margin-right: 10px;
				margin-left: 10px;
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			.tooltipItem {
				height: 22px;
				padding-right: 8px;
				padding-left: 8px;
				margin-right: 2px;
				margin-left: 2px;
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			.tooltipItem[selected] {
				background-color: var(--internal-pin-tooltip-border-color);
			}
			
			.tooltipItemText {
				pointer-events: none;
			}

			.closeButton {
				top: calc(18px / -2 );
				right: calc(18px / -2 );
				justify-content: flex-end;
                position: absolute;
                min-width: 18px;
                min-height: 18px;
                --paper-button: {
                    padding: 0px;
                    position: relative;
                    margin: 0px;
                };
			}

			triplat-icon {
				--triplat-icon-fill-color: var(--internal-pin-tooltip-close-button-color);
                --triplat-icon-iron-icon: {
                    width: 18px;
                    height: 18px;
                };
            }

		</style>
		
		<paper-tooltip id="tooltip" offset="5" position="[[position]]" manual-mode="" animation-delay="100">
	       	<paper-button class="closeButton tri-disable-theme" noink="" on-tap="_handleCloseButtonTap">
	        	<triplat-icon icon="ibm-glyphs:close-cancel-error"></triplat-icon>
	        </paper-button>
	        <div class="tooltipContent">
		        <div class="tooltipTitle" hidden$="[[!_hasTitle]]">
		        	<span class="tooltipTitleText">[[title]]</span>
		        </div>
				<template id="domRepeat" is="dom-repeat" items="{{items}}">
					<div on-tap="_handleItemTap" class="tooltipItem" item="[[item]]">
						<span class="tooltipItemText">[[item.label]]</span>
					</div>
				</template>
		    </div>           	
	    </paper-tooltip>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-pin-tooltip",

		properties: {
			graphic: Object,

			title: {
				type: String,
				value: ""
			},

			items: {
				type: Array,
				value: []
			},

			target: {
				type: Object
			},

			position : {
				type: String,
				reflectToAttribute: true,
				value: "left"
			},

			selected: {
				type: Object,
				observer: "_handleSelectedChange"
			},

			status : {
				type: String,
				value: "hidden"
			},

			_hasTitle: {
				type: Boolean,
				computed: "_computeHasTitle(title)"
			}
		},


        show: function() {
        	this.updatePosition();
        	//Do not close the tooltip on mouse enter.
			this.$.tooltip.unlisten(this.$.tooltip, 'mouseenter', 'hide');
        	this.$.tooltip.show();
		},

		hide: function() {
			this.$.tooltip.hide();
			this.selected = null;
        },

        updatePosition: function() {
        	this._calculateTooltipPosition();
        	this.$.tooltip._target = this.target;
        	this.$.tooltip.updatePosition();
		},

		addItems: function(items) {
			var newItems = null;
			if (items) {
				newItems = items.slice(0);
			}
			this.items = newItems;
			this.$.domRepeat.render();
			Polymer.dom(this.$.tooltip).flush();			
		},

		_handleItemTap: function(event) {
			if(this.items.length == 1) {
				return;
			}
			var targetDiv = event.target;
			var item = this.$.domRepeat.modelForElement(targetDiv).item;
			if (targetDiv.hasAttribute("selected")) {
				this.selected = null;
			} else {
				this.selected = item;
			}
			this.fire("pin-selected-change", this.selected);
		},

		_computeHasTitle: function(title) {
			return title != null && title.length > 0;
		},

		_handleSelectedChange: function(newValue , oldVAlue) {
			if(this.items.length == 1) {
				return;
			}
			this._unselect(oldVAlue);
			this._select(newValue);
		},

		_select: function(item) {
			if(!item || this.items.length == 1) {
				return;
			}
			var tooltipItems = Polymer.dom(this.root).querySelectorAll(".tooltipItem");
            if (tooltipItems) {
            	var found = false;
            	for (var i = 0; i < tooltipItems.length && ! found; i++) {
            		if (tooltipItems[i].item.label == item.label) {
            			tooltipItems[i].setAttribute("selected","");
            			found = true;
            		}
            	}
            }
		},

		_unselect: function(item) {
			if(!item) {
				return;
			}
			var tooltipItems = Polymer.dom(this.root).querySelectorAll(".tooltipItem[selected]");
            if (tooltipItems) {
            	var found = false;
            	for (var i = 0; i < tooltipItems.length && ! found; i++) {
            		if (tooltipItems[i].item.label == item.label) {
            			tooltipItems[i].removeAttribute("selected");
            			found = true;
            		}
            	}
            }
		},

		_handleCloseButtonTap: function(event) {
			this.fire("tri-pin-tooltip-close");
		},

		/**
		 * Determines if the tooltip should be positioned to the left or to the right of the target pin.
		 * It considers that the graphic has two parts, one to the left of the graphic center and another 
		 * to the right of the graphic center.
		 * Returns 'left' if the target pin is located in the right part of the graphic.
		 * Returns 'right' if the target pin is located in the left part of the graphic.
		 */
		_calculateTooltipPosition: function() {
			if (this.graphic && this.target) {
				var graphicRect = this.graphic.getBoundingClientRect();
				var targetRect = this.target.getBoundingClientRect();
				var graphicCenterX = graphicRect.width / 2;
				this.position = (targetRect.left - graphicRect.left) <= graphicCenterX ? "right" : "left";
			}
		}
	});

</script><dom-module id="triplat-graphic-pin-worker" assetpath="../triplat-graphic/">
	<template>
	</template>
</dom-module>
<script>
	PinWorker = Polymer({
		is: 'triplat-graphic-pin-worker',

		factoryImpl: function(graphic) {
	        this._graphic = graphic;
	        this._createTooltip();
	        this.listen(this._graphic, "svg-loaded", "_handleSvgLoadedChanged");
	    },

		properties: {
			_graphic: Object,

			multiplePinSize: {
	        	type: Number,
                value: 32
	        },

	        multiplePinIconsetName: {
	        	type: String,
                value: "ibm"
	        },

	        multiplePinIconName: {
	        	type: String,
                value: "pin-multiples"
	        },

	        preserveMultiplePinSizeRatio: {
	        	type: Boolean,
                value: false
	        },

	        multiplePinShowLabelOnhover: {
	        	type: Boolean,
                value: false
	        },

			multiplePinClassNumber: {
				type: Number,
				value: 1
			},

			_pinnedSpaces: {
	        	type: Array,
                value: []
	        },

	        _internalPins: {
	        	type: Array,
                value: []
	        },

	        _svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false
            },

            _lastViewPortScale: {
            	type: Number,
            	value: 0
            },

            _tooltip: Object,

            _svgElement: Object,

            /**
	         * @type {!Polymer.IronMeta}
	         */
	        _meta: {
	        	value: Polymer.Base.create('iron-meta', {type: 'iconset'})
	        }
		},

		_handleSvgLoadedChanged: function(e) {
			this._lastViewPortScale=0;
			if (!this._graphic._lastPinScale) {
				this._graphic._lastPinScale=1;
			}
			this._pinnedSpaces = [];
			this._internalPins = [];
			if (this._tooltip) {
            	this._hideTooltip();
            	this._tooltip.status = "hidden";
            }
        	this._svgElement = this._graphic.svgElement;
            this._set_svgLoaded(e.detail);
        },

        _findSpace: function (internalPin) {
			var space = this._graphic.attachedElementsByRecordId[internalPin.spaceId];
    		return space;
		},

		_findInternalPinIndex: function (internalPinsArray, internalPin) {
			var index = -1;
			if(internalPinsArray) {
				for (var i = 0; i < internalPinsArray.length && index < 0; i++) {
					if (internalPinsArray[i].key == internalPin.key) {
						index = i;
					}
				}
			}
			return index;
		},
		/********************************************
		 *            TOOLTIP FUNCTIONS             *
		 ********************************************/

		 /**
		  * Creates the tooltip for showing the pin labels.
		  */
		_createTooltip: function() {
			if (!this._tooltip && !this._graphic._tooltip ) {
				var tooltip = this.create("triplat-graphic-pin-tooltip");
				this.toggleClass("tri-pin-tooltip", true, tooltip);
				Polymer.dom(this._graphic.root).appendChild(tooltip);
				this.listen(tooltip, "tri-pin-tooltip-close", "_handleTooltipClose");
				this._graphic._tooltip = tooltip;
				tooltip.graphic = this._graphic;
			}
			this._tooltip = this._graphic._tooltip;
		},

		_configSvgPinEvents: function(space, showLabelOnhover) {
			var rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
			rect.setAttribute("id", space._svgPinGroup.id+"Hover");
			rect.setAttribute("display", "inline");
			rect.setAttribute("fill", "white");
			rect.setAttribute("fill-opacity", "0");
			rect.setAttribute("width", space._pinIcon.viewBox.baseVal.width);
			rect.setAttribute("height", space._pinIcon.viewBox.baseVal.height);
			rect.space = space;
			if (showLabelOnhover) {
				this.listen(rect, 'mouseenter', '_handleSvgPinEvents');
				this.listen(rect, 'mouseleave', '_handleSvgPinEvents');        		
			}
        	this.listen(rect, 'tap', '_handleSvgPinEvents');
			Polymer.dom(space._pinIcon).appendChild(rect);
			space._pinIcon.rect = rect;
		},

		_handleSvgPinEvents: function(event) {
			var rect = event.currentTarget;
			var space = rect.space;
			this._processTooltipEvent(event.type, space);
		},

		_handleTooltipClose: function(event) {
			this._processTooltipEvent("close");
		},

		_processTooltipEvent: function(eventType, space, internalPin) {
			switch (this._tooltip.status) {
				case "hidden":
					switch (eventType) {
						case "mouseenter":
							this._tooltip.status = "showing-by-mouse-hover";
							this._showTooltip(space);
    						break;
						case "tap":
							this._tooltip.status = "showing";
							this._showTooltip(space);
							if (space._internalPins.length == 1) {
								this._tooltip.selected = space._internalPins[0];
								this.fire("pin-selected-change", space._internalPins[0]);
							}
    						break;
						case "select":
							this._tooltip.status = "showing";
							this._showTooltip(space);
							this._tooltip.selected = internalPin;
							this.fire("pin-selected-change", internalPin);
    						break;
					}
    				break;
    			case "showing-by-mouse-hover":
    				switch (eventType) {
						case "mouseleave":
							this._tooltip.status = "hidden";
							this._hideTooltip();
    						break;
						case "tap":
							this._tooltip.status = "showing";
							if (this._tooltip.space != space) {
								this._hideTooltip();
								this._showTooltip(space);
							}
							if (space._internalPins.length == 1) {
								this._tooltip.selected = space._internalPins[0];
								this.fire("pin-selected-change", space._internalPins[0]);
							}	
							break;
						case "select":
							this._tooltip.status = "showing";
							if (this._tooltip.space != space) {
								this._hideTooltip();
								this._showTooltip(space);
							}
							this._tooltip.selected = internalPin;
							this.fire("pin-selected-change", internalPin);				
    						break;
					}
    				break;
    			case "showing":
    				switch (eventType) {
						case "close":
							this._tooltip.status = "hidden";
							this._hideTooltip();
							this.fire("pin-selected-change", null);
    						break;
						case "tap":
							if (this._tooltip.space != space) {
								this._hideTooltip();
								this._showTooltip(space);
								if (space._internalPins.length == 1) {
									this._tooltip.selected = space._internalPins[0];
									this.fire("pin-selected-change", space._internalPins[0]);
								} else {
									this.fire("pin-selected-change", null);
								}
							}							
    						break;
						case "select":
							if (this._tooltip.space != space) {
								this._hideTooltip();
								this._showTooltip(space);
							}
							this._tooltip.selected = internalPin;
							this.fire("pin-selected-change", internalPin);						
    						break;
    					case "deselect":
							if (this._tooltip.space == space && this._tooltip.selected && this._tooltip.selected.key == internalPin.key) {
    							this._tooltip.status = "hidden";
								this._hideTooltip();
								this.fire("pin-selected-change", null);
    						}					
    						break;
    					case "removed":
    						if (this._tooltip.space == space) {
    							if ( this._tooltip.selected && this._tooltip.selected.key == internalPin.key) {
    								this._tooltip.selected = null;
    							}
	    						if (!space._internalPins) {
	    							this._tooltip.status = "hidden";
									this._hideTooltip();
	    						} else {
	    							var selected = this._tooltip.selected;
									this._hideTooltip();
									this._showTooltip(space);
									this._tooltip.selected = selected; 							
	    						}
    						}
    						break;
    					case "added":
    						if (this._tooltip.space == space) {
    							var selected = this._tooltip.selected;
								this._hideTooltip();
								this._showTooltip(space);
								this._tooltip.selected = selected;
    						}
    						break;
					}
    				break;
			}
		},

		_showTooltip: function(space) {
			if (space) {
				Polymer.dom(this._svgElement).removeChild(space._svgPinGroup);
				Polymer.dom(this._svgElement).appendChild(space._svgPinGroup);
				space._pinIcon.outlineLayer.setAttribute("selected","");
				this._tooltip.addItems(space._internalPins);
				this._tooltip.target=space._pinIcon.rect;
				this._tooltip.space = space;
				this._tooltip.title = space._internalPins[0].spaceName;
				this._tooltip.show();
			}
		},

		_hideTooltip: function() {
			this._tooltip.hide();
			this._tooltip.for="";
			if (this._tooltip.space) {
				if (this._tooltip.space._pinIcon && this._tooltip.space._pinIcon.outlineLayer) {
					this._tooltip.space._pinIcon.outlineLayer.removeAttribute("selected");
				}
				this._tooltip.space = null;
			}		
		},

		_selectPin: function(internalPin) {
			var internalIndex = this._findInternalPinIndex(this._internalPins,internalPin)
            if (internalIndex >=0) {
				var space = this._findSpace(internalPin);
	        	if (space) {
	        		this._processTooltipEvent("select", space, internalPin);
	        	}
	        }
		},

		_deselectPin: function(internalPin) {
			var internalIndex = this._findInternalPinIndex(this._internalPins,internalPin)
            if (internalIndex >=0) {
				var space = this._findSpace(internalPin);
	        	if (space) {
	        		this._processTooltipEvent("deselect", space, internalPin);
	        	}
	        }
		},

		/********************************************
		 *      ADD AND REMOVE PIN FUNCTIONS        *
		 ********************************************/

		_addInternalPin: function(internalPin) {
        	var space = this._findSpace(internalPin);
        	if (space) {        		
        		this._addPinToSpace(space, internalPin);
				this._updatePins();
				if (this._internalPins.length == 1 ) {
					this.listen(this._graphic, "view-port-change", "_handleViewPortChanged");
            		this.listen(this._graphic, "iron-resize", "_handleGraphicSizeChanged");
				}
				this._processTooltipEvent("added", space, internalPin);
			} else {
				console.log("Space not found: [Space id= " + internalPin.spaceId + "]");
			}
		},

		_addPinToSpace: function(space, internalPin) {
			if (!space._internalPins) {
    			space._internalPins = [];
    		}
			switch (space._internalPins.length) {
				case 0:
    				this._addFirstPinToSpace(space, internalPin);
    				break;
    			case 1: 
    				this._addMultiplePinToSpace(space, internalPin);
    				break;
    			default:
    				space._internalPins.push(internalPin);
					this._internalPins.push(internalPin);
    				this._updateMultiplePinCounter(space);
			}
		},

		_addFirstPinToSpace: function(space, internalPin) {
			this._addSvgPinGroup(space);
			var pinIcon = this._addSvgPinIcon(space, 
				                              internalPin.iconsetName, 
				                              internalPin.iconName, 
				                              internalPin.classNumber);
			if (pinIcon) {
				space._internalPins.push(internalPin);
				this._pinnedSpaces.push(space);
				this._internalPins.push(internalPin);
				this._configSvgPinEvents(space, internalPin.showLabelOnhover);
			} else {
				this._unpinSpace(space);
			}
		},

		_addMultiplePinToSpace: function(space, internalPin) {
			var oldPinIcon = space._pinIcon;
			Polymer.dom(space._svgPinGroup).removeChild(oldPinIcon);
            space._pinIcon = null;
			var pinIcon = this._addSvgPinIcon(space, 
				                              this.multiplePinIconsetName, 
				                              this.multiplePinIconName, 
				                              this.multiplePinClassNumber);
			if (pinIcon) {
				space._internalPins.push(internalPin);
				this._internalPins.push(internalPin);
				this._addMultiplePinCounter(space);
				this._configSvgPinEvents(space, this.multiplePinShowLabelOnhover);
			} else {
				Polymer.dom(space._svgPinGroup).appendChild(oldPinIcon);
				space._pinIcon = oldPinIcon;
			}
		},

		_addSvgPinGroup: function(space) {
			var svgPinGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
			svgPinGroup.id = "svgPinGroup" + space.getAttribute("tri-record-id");
			Polymer.dom(this._svgElement).appendChild(svgPinGroup);
			space._svgPinGroup = svgPinGroup;
		},

		_addSvgPinIcon: function(space, iconsetName, iconName, classNumber) {
			var iconset = null;
			if (this._meta) {
            	iconset = this._meta.byKey(iconsetName);
            	if (iconset) {
            		var icon = iconset._createIconMap()[iconName];
            		if (icon) {
            			var pinIcon = icon.cloneNode(true);
            			/*
            			 * IBM icons are svg tags, iron-icons are g tags. 
            			 * Here we normalize all icons to be svg tags.
            			 */
            			if (pinIcon.nodeName != "svg") {
            				var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            				var viewBox = '0 0 ' + iconset.size + ' ' + iconset.size;
        					svg.setAttribute('viewBox', viewBox);
        					svg.appendChild(pinIcon).removeAttribute('id');
        					pinIcon = svg;
            			}
            			pinIcon.setAttribute("id", space._svgPinGroup.id + "Icon" );
            			pinIcon.setAttribute("class", "tri-pin-icon-" + classNumber);
            			pinIcon.setAttribute("width", pinIcon.viewBox.baseVal.width);
            			pinIcon.setAttribute("height", pinIcon.viewBox.baseVal.height);

            			// Add space for the outline line that is shown when the pin is selected
            			pinIcon.viewBox.baseVal.width += 2;
            			pinIcon.viewBox.baseVal.height += 2;
            			pinIcon.viewBox.baseVal.x -= 1;
            			pinIcon.viewBox.baseVal.y -= 1;

				        Polymer.dom(space._svgPinGroup).appendChild(pinIcon);
						//this._updatePinIconPosition(pinIcon, space);
            			space._pinIcon = pinIcon;
            			space._pinIcon.outlineLayer = Polymer.dom(pinIcon).querySelector("[fill]");
            			this.toggleClass("tri-pin-outline", true, space._pinIcon.outlineLayer);
				    }
            	} else {
            		console.log("Icon not found.[icon=" + this.icon + "]");	
            	}
            }
            return space._pinIcon;
		},

		_addMultiplePinCounter: function(space) {
			var counterText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
			counterText.setAttribute("class", "tri-pin-counter");
			counterText.setAttribute("text-anchor", "middle");
			counterText.setAttribute("font-size", "14");
			counterText.setAttribute("x", space._pinIcon.viewBox.baseVal.width/2 -1);
			counterText.setAttribute("y", space._pinIcon.viewBox.baseVal.height/2 + 1);			
	        Polymer.dom(space._pinIcon).appendChild(counterText);
			space._counter = counterText;
			this._updateMultiplePinCounter(space);
		},

		_updateMultiplePinCounter: function(space) {
			space._counter.textContent = space._internalPins.length;
		},

		_unpinSpace: function(space) {
			if (space._svgPinGroup) {
				Polymer.dom(this._svgElement).removeChild(space._svgPinGroup);
			}
            space._svgPinGroup = null;
            space._pinIcon = null;
            space._counter = null;
            space._internalPins = null;
            var index = this._pinnedSpaces.indexOf(space);
            if (index >=0) {
            	this._pinnedSpaces.splice(index,1);
            }
		},

		_removeInternalPin: function(internalPin) {
			var space = this._findSpace(internalPin);
			//Remove the internal pin from the space
			if (space) {
				var internalPinIndex = this._findInternalPinIndex(space._internalPins,internalPin);
				if (internalPinIndex >= 0 ) {
					space._internalPins.splice(internalPinIndex,1);
					switch (space._internalPins.length) {
						case 0: 
							this._unpinSpace(space);
							break;
						case 1:
							this._removeMultiplePinFromSpace(space);
							break;
						default:
							this._updateMultiplePinCounter(space);
					}
					this._processTooltipEvent("removed", space, internalPin);
				}
			}

			//Remove the internal pin from this component
			var internalIndex = this._findInternalPinIndex(this._internalPins,internalPin)
            if (internalIndex >=0) {
            	this._internalPins.splice(internalIndex,1);
            }
            if (this._internalPins.length == 0 ) {
				this.unlisten(this._graphic, "view-port-change", "_handleViewPortChanged");
            	this.unlisten(this._graphic, "iron-resize", "_handleGraphicSizeChanged");
			}
		},

		_removeInternalPins: function(iconName) {
			if(this._internalPins) {
				var pinsToRemove = this._internalPins.filter (
					function(internalPin) {
						return internalPin.iconName === iconName;
					}
				);
				for (var i = 0; i < pinsToRemove.length; i++) {
					this._removeInternalPin(pinsToRemove[i]);
				}
			}
		},

		_removeMultiplePinFromSpace: function(space) {
			var internalPin = space._internalPins[0];
			var oldPinIcon = space._pinIcon;
			Polymer.dom(space._svgPinGroup).removeChild(oldPinIcon);
            space._pinIcon = null;
			var pinIcon = this._addSvgPinIcon(space, 
				                              internalPin.iconsetName, 
				                              internalPin.iconName, 
				                              internalPin.classNumber);
			this._configSvgPinEvents(space, internalPin.showLabelOnhover);
			this._updatePins();	
		},

		/********************************************
		 *    SCALING AND POSITIONING FUNCTIONS     *
		 ********************************************/
		 _handleViewPortChanged: function(e) {
		 	if (e.detail.base.width == 0 || e.detail.base.height == 0) {
		 		return;
		 	}
        	if (e.detail.base.scale != this._lastViewPortScale) {
        		this._updatePins();
	        	this._lastViewPortScale = e.detail.base.scale;
	        } else if (this._tooltip) {
	        	this._tooltip.updatePosition();
	        }
        },

		_handleGraphicSizeChanged: function() {
			if (!this._svgLoaded) {
				return;
			}
			if (this._graphic._calculatedWidth > 0 && this._graphic._calculatedHeight > 0 ) {
				this._updatePins();
			}
		},

		_updatePins: function() {
			if (this._updatePinsHandle) {
				this.cancelAsync(this._updatePinsHandle);
			}
			this._updatePinsHandle = this.async(this._updatePinsExecute, 20);
		},

		_updatePinsExecute: function(centerPointsByRecordId) {
			if (centerPointsByRecordId) {
				if (!this._svgLoaded || this._svgElement.getBoundingClientRect().width == 0 || this._svgElement.getBoundingClientRect().height == 0) {
					return;
				}

				var widthScale = this._svgElement.viewBox.baseVal.width / this._svgElement.getBoundingClientRect().width;
		        var heightScale = this._svgElement.viewBox.baseVal.height / this._svgElement.getBoundingClientRect().height;
	        	/* 
	        	 * The svg has the preserveAspectRatio attribute equals to "xMidYMid meet". In this case the the entire 
	        	 * viewBox is visible within the viewport and the viewBox is scaled up as much as possible. So, we will use
	        	 * the highest between the width and height scale. 
	        	 */
	        	var calculatedScale = widthScale > heightScale ? widthScale : heightScale;

	        	for (var i = 0; i < this._pinnedSpaces.length; i++) {
	        		var space = this._pinnedSpaces[i];
	        		var multiplePin = space._internalPins.length > 1;
	        		var pinIcon = space._pinIcon;
	        		var scale = space._internalPins[0].preservePinSizeRatio ? 1 : calculatedScale;
	        		var pinSize = space._internalPins[0].pinSize;
	        		if (multiplePin) {
	        			scale = this.preserveMultiplePinSizeRatio ? 1 : calculatedScale;
	        			pinSize = this.multiplePinSize;
	        		}
	        		this._scalePinIcon(pinIcon, space, scale, pinSize, centerPointsByRecordId);
	        		if (this._tooltip && this._tooltip.space==space) {
			          	this._tooltip.updatePosition();
			        }
	        	}

	        	this._graphic._lastPinScale = scale;
	        	this._updatePinsHandle = null;
	        } else {
	        	this._graphic.getCenterPointsByRecordId().then(
					this._updatePinsExecute.bind(this)
				).catch(
					this._updatePinsExecute.bind(this, {})
				);
	        }
		},

		_scalePinIcon: function (pinIcon, space, scale, pinSize, centerPointsByRecordId) {
			var pinScaledSize = pinSize*scale;
			var currentX = pinIcon.x.baseVal.value;
	        var currentY = pinIcon.y.baseVal.value;
	        var currentWidth = pinIcon.width.baseVal.value;
	        var currentHeight = pinIcon.height.baseVal.value;
	        pinIcon.setAttribute("width", pinScaledSize);
	        pinIcon.setAttribute("height", pinScaledSize);
	        this._updatePinIconPosition(pinIcon, space, centerPointsByRecordId);
		},

		 /**
          * Put the pin icon at the center of the space.
          * It first tries to use the center point returned from the server. If the center point is not
          * available it will place the pin in the centroid of the space.
          * The icon's bottom and icon's middle width are aligned with the center of the space.
          */
		_updatePinIconPosition: function (pinIcon, space, centerPointsByRecordId) {
			var centerX, centerY = 0;
			var spaceId = space.getAttribute("tri-record-id");
			if (centerPointsByRecordId && centerPointsByRecordId[spaceId]) {
				centerX = centerPointsByRecordId[spaceId].x;
				centerY = centerPointsByRecordId[spaceId].y;
			} else if (!space.points) {
				var spaceBBox = space.getBBox();
				centerX = spaceBBox.x + spaceBBox.width/2;
				centerY = spaceBBox.y + spaceBBox.height/2
			} else {
				var centroid = this._calculateSpaceCentroid(space.points);
				centerX = centroid.x;
				centerY = centroid.y;
			}
			pinIcon.setAttribute("x", centerX - pinIcon.width.baseVal.value/2);
			pinIcon.setAttribute("y", centerY - pinIcon.height.baseVal.value);
		},

		/**
		 *	Calculate the centroid of a non-self-intersecting closed polygon
		 */
		_calculateSpaceCentroid: function (points) {
	        var x = 0,
	            y = 0,
	            signedArea = 0,
	            i,
	            j,
	            f,
	            point1,
	            point2;

	        for (i = 0, j = points.numberOfItems - 1; i < points.numberOfItems; j=i,i++) {
	            point1 = points.getItem(j);
	            point2 = points.getItem(i);
	            f = (point1.x * point2.y) - (point2.x * point1.y)
	            signedArea += f;
	            x += (point1.x + point2.x) * f;
	            y += (point1.y + point2.y) * f;
	        }

	        signedArea /= 2;

	        return {
	        	x: x / (signedArea * 6),
	        	y: y / (signedArea * 6)
	        };
	    }
    });
</script><dom-module id="triplat-graphic-pin" assetpath="../triplat-graphic/">
	<template>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-graphic-pin",

		properties: {

			/**
			 * The graphic on which the pins will be added. 
			 * Usually, this is automatically set by triplat-graphic.
			 */
			graphic: Object,

			/**
			 * An object containing the pins to be added to the graphic.
			 * It can be either an array or a single element. 
			 * Every pin object must have the ID of the space where the pin will be placed and optionally a label for the pin.
			 */
			pins: {
				type: Object,
				notify: false,
				readOnly: false
			},

			/**
			 * The name of the pin object attribute that contains the ID of the space where the pin will be placed.
			 */
			recordIdAttrName: {
				type: String,
				value: "_id"
			},

			/**
			 * The name of the pin object attribute that contains the label for the pin.
			 */
			labelAttrName: {
				type: String,
				value: "label"
			},

			/**
			 * The name of the pin object attribute that contains the name of the space where the pin will be placed.
			 */
			spaceAttrName: {
				type: String,
				value: "space"
			},

	        /**
	         * The size in pixels of the pin icon.
	         */
	        pinSize: {
	        	type: Number,
                value: 32
	        },

	        /**
	         * The name of the icon to use. The name should have the format: iconset_name:icon_name. 
	         * The iconset_name: can be omitted for the IBM icon set.
	         */
	        icon: {
	        	type: String,
                value: "ibm:pin-multiples",
                observer: '_iconChanged'
	        },

	        /**
			 * A flag to enable this plugin. If this is omitted, then it will be 
			 * true and the plugin will be enabled.
			 */
			enabled: {
				type: Boolean,
				notify: true,
				readOnly: false,
				value: true
			},

			/**
			 * If true, the pin size will be scaled as the whole graphic is zoomed in or out.
			 * Otherwise, the pin size will be fixed and it will not be changed when the graphic is zoomed in or out.
			 */
	        preservePinSizeRatio: {
	        	type: Boolean,
                value: false
	        },

	        /**
	         * If true, the label of a pin will be shown as a tooltip when the user taps or hovers the cursor over the pin icon.
	         * Otherwise, the label will be shown only when the user taps the icon.
	         */
	        showLabelOnhover: {
	        	type: Boolean,
                value: false
	        },

	        /**
			 * The number used for styling with mixins and CSS properties. It must be a number between 1 to 5 inclusive.  
			 */
			classNumber: {
				type: Number,
				readOnly: false,
				notify: false,
				value: 1,
				observer: "_onClassNumberChange"
			},

			_svgLoaded: {
                type: Boolean,
				readOnly: true,
                value: false
            },
            
			/**
			 * If true, this <b>triplat-graphic-pin</b> will be used only for configuring the multiple pin and 
			 * the following attributes will be ignored:
			 * - <b>enabled</b>
			 * - <b>labelAttrName</b>
			 * - <b>spaceAttrName</b>
			 * - <b>pins</b>
			 * - <b>recordIdAttrName</b>
			 *
			 * The multiple pin is shown when there is more than one pin in the same space. Inside the multiple pin there is a 
			 * counter indicating the number of pins located in that space.
			 */
			multiplePin: {
				type: Boolean,
                value: false
			},

			/**
			 *	Gets or sets the selected pin. The selected pin shows the tooltip in the graphic.
			 */
			selected: {
				type: Object,
				notify: true
			}
		},

		_DEFAULT_ICONSET: 'ibm',

		observers: [
            "_initializeGraphic(graphic)",
			"_handlePinsChanged(pins.*, _svgLoaded, enabled)",
			"_handleSelectedChanged(selected, _svgLoaded, enabled)"
		],
        
        _initializeGraphic: function(graphic) {
        	if (!graphic._pinWorker) {
        		graphic._pinWorker = new PinWorker(graphic);
        		Polymer.dom(graphic.root).appendChild(graphic._pinWorker);
        	}
        	if (this.multiplePin) {
        		graphic._pinWorker.multiplePinSize = this.pinSize;
        		graphic._pinWorker.multiplePinIconsetName = this._iconsetName;
        		graphic._pinWorker.multiplePinIconName = this._iconName;
        		graphic._pinWorker.preserveMultiplePinSizeRatio = this.preservePinSizeRatio;
        		graphic._pinWorker.multiplePinShowLabelOnhover = this.showLabelOnhover;
        		graphic._pinWorker.multiplePinClassNumber = this.classNumber;
        	} else {
        		this.listen(this.graphic, "pin-selected-change", "_handlePinSelectedChangeEvent");
        	}
        	this.listen(this.graphic, "svg-loaded", "_handleSvgLoadedChanged");
		},

		_handleSvgLoadedChanged: function(e) {
			this._set_svgLoaded(e.detail);
		},

        _iconChanged: function(icon) {
	        var parts = (icon || '').split(':');
	        this._iconName = parts.pop();
	        this._iconsetName = parts.pop() || this._DEFAULT_ICONSET;
	    },

	    _onClassNumberChange: function(classNumber, oldClassNumber) {
        	if (!classNumber || classNumber < 1 || classNumber > 5) {
        		console.warn("triplat-graphic-pin: the classNumber must be a number from 1 to 5 inclusive. [classNumber=" + classNumber + "]");
        	}
        },

		_handlePinsChanged: function(pins, svgLoaded, enabled) {
			if (!svgLoaded) {
				return;
			}
			if (this.multiplePin) {
				console.warn("triplat-graphic-pin: the pins and enabled attributes are ignored when the multiplePin property is used. ");
				return;
			}
			if (!enabled) {
				this._clearAllInternalPins();
				return;
			} 

			if(pins.path == "pins"){
                this._clearAllInternalPins();
                this._addAllPins(pins.value);
			}

			if(pins.path == "pins.splices"){
				var indexSplice = pins.value.indexSplices[0];
				indexSplice.removed.forEach(function(removed) {
					this.graphic._pinWorker._removeInternalPin(this._createInternalPin(removed));
				}, this);
				for (var i = 0; i < indexSplice.addedCount; i++) {
					var added = indexSplice.object[indexSplice.index + i];
					this._addPin(added);
				}
			}
		},

		_handleSelectedChanged: function(selected,  svgLoaded, enabled) {
			if (!svgLoaded) {
				return;
			}
			if (!enabled) {
				this.selected = this._selected = null;
				return;
			}
			if (this.multiplePin) {
				return;
			}
			if (selected) {
				var internalPin = this._createInternalPin(selected);
				if (!this._selected || this._selected.key != internalPin.key) {
					this._selected = internalPin;
					if (this.graphic._pinWorker) {
		        		this.graphic._pinWorker._selectPin(internalPin);
		        	}
		        }
		    } else {
		    	if (this._selected) {
		    		this.graphic._pinWorker._deselectPin(this._selected);
		    		this._selected = null;
		    	}
		    }
		},

		_handlePinSelectedChangeEvent: function(event) {
			if (this.multiplePin || !this.enabled) {
				return;
			}
			if (event.detail.key) {
				if (event.detail.iconName == this._iconName) {
					this._selected = event.detail;
					this.selected = event.detail.originalPin;
				} else {
					this.selected = this._selected = null;
				}
			} else {
				this.selected = this._selected = null;
			}
		},

		_addPin: function(pin) {
			var internalPin = this._createInternalPin(pin);
			this.graphic._pinWorker._addInternalPin(internalPin);
			if (this.selected && this._selected) {
				this.graphic._pinWorker._selectPin(this._selected);
			}
		},

        _addAllPins: function(pins){
            if(Array.isArray(pins)){
                pins.forEach(function(pin) {
					this._addPin(pin);
				}, this);
            } else if(pins){
                this._addPin(pins);
            }   
        },

        _createInternalPin: function(pin) {
        	var label = this.get(this.labelAttrName,pin);
        	if (!label) {
        		label = "";
        	}
        	
        	var spaceName = this.get(this.spaceAttrName,pin);
        	if (!spaceName) {
        		spaceName = "";
        	}
        	var spaceId = this.get(this.recordIdAttrName,pin);
        	return {
        		spaceId: spaceId, 
        		label: label,
        		iconName: this._iconName,
        		iconsetName: this._iconsetName,
        		classNumber: this.classNumber,
        		showLabelOnhover: this.showLabelOnhover,
        		preservePinSizeRatio: this.preservePinSizeRatio,
        		pinSize: this.pinSize,
        		spaceName: spaceName,
        		key: spaceId+label+this._iconName,
        		originalPin: pin
        	}
        },

		_clearAllInternalPins: function() {
			this.graphic._pinWorker._removeInternalPins(this._iconName);
		}
	});
</script><dom-module id="triplat-graphic" assetpath="../triplat-graphic/">
	<template>
        <style>
            :host {
                height: 100%;
                width: inherit; /*needed for FF (in page Tile)*/
            }
            triplat-graphic-base {
            	--triplat-graphic-base-selected: {
            		@apply(--triplat-graphic-selected);
            	};
            	--triplat-graphic-base-interactive-selected: {
            		@apply(--triplat-graphic-interactive-selected);
            	};
            	--triplat-graphic-base-selectable: {
            		@apply(--triplat-graphic-selectable);
            	};
            	--triplat-graphic-base-interactive-selectable: {
            		@apply(--triplat-graphic-interactive-selectable);
            	};
            	--triplat-graphic-base-non-selectable: {
            		@apply(--triplat-graphic-non-selectable);
            	};
            	--triplat-graphic-base-highlight-1: {
            		@apply(--triplat-graphic-highlight-1);
            	};
            	--triplat-graphic-base-highlight-2: {
            		@apply(--triplat-graphic-highlight-2);
            	};
            	--triplat-graphic-base-highlight-3: {
            		@apply(--triplat-graphic-highlight-3);
            	};
            	--triplat-graphic-base-highlight-4: {
            		@apply(--triplat-graphic-highlight-4);
            	};
            	--triplat-graphic-base-highlight-5: {
            		@apply(--triplat-graphic-highlight-5);
            	};
                --triplat-graphic-base-highlight-group-1: {
            		@apply(--triplat-graphic-highlight-group-1);
            	};
                --triplat-graphic-base-highlight-group-2: {
            		@apply(--triplat-graphic-highlight-group-2);
            	};
                --triplat-graphic-base-highlight-group-3: {
            		@apply(--triplat-graphic-highlight-group-3);
            	};
                 --triplat-graphic-base-highlight-group-4: {
            		@apply(--triplat-graphic-highlight-group-4);
            	};
                 --triplat-graphic-base-highlight-group-5: {
            		@apply(--triplat-graphic-highlight-group-5);
            	};
            	--triplat-graphic-base-interactive-drop-enter: {
            		@apply(--triplat-graphic-interactive-drop-enter);
            	};
            	--triplat-graphic-base-interactive-drop-done: {
            		@apply(--triplat-graphic-interactive-drop-done);
            	};
            }
        </style>
		<triplat-graphic-base drawing-id="{{drawingId}}" record-id="{{recordId}}" has-graphic="{{hasGraphic}}" drawing-id-loading="{{drawingIdLoading}}" loading="{{loading}}" svg-aria-label="[[svgAriaLabel]]">
		</triplat-graphic-base>
		<content select="triplat-graphic-selectable" id="triplat-graphic-selectable"></content>
		<content select="triplat-graphic-zoomable" id="triplat-graphic-zoomable"></content>
		<content select="triplat-graphic-highlight" id="triplat-graphic-highlight"></content>
		<content select="triplat-graphic-pin" id="triplat-graphic-pin"></content>
		<content select="triplat-graphic-label" id="triplat-graphic-label"></content>
		<content select="triplat-graphic-bounding-selection" id="triplat-graphic-bounding-selection"></content>
		<content select="triplat-graphic-layer-manager" id="triplat-graphic-layer-manager"></content>
		<content select="triplat-graphic-def" id="triplat-graphic-def"></content>
		<content select="triplat-graphic-drag-drop" id="triplat-graphic-drag-drop"></content>
		<content select="triplat-graphic-highlight-group" id="triplat-graphic-highlight-group"></content>
	</template>

</dom-module>
<script>
	Polymer({

		is: "triplat-graphic",

		properties: {
			/**
			 * A flag that indicates if the graphic is loaded.
			 */
			svgLoaded: {
				type: Boolean,
				notify: true,
				readOnly: true
			},

			/**
			 * A flag that indicates whether or not a graphic
			 * has been found for the related record.
			 */
			hasGraphic: {
				type: Boolean,
				notify: true,
			},

			/**
			 * A flag that indicates if the component is currently making a request 
			 * to the server to get the drawing ID.
			 */
			drawingIdLoading: {
				type: Boolean,
				notify: true,	
			},

			/**
			 * A flag that indicates if the component is currently making a request 
			 * to the server to get the graphic.
			 */
			loading: {
				type: Boolean,
				notify: true
			},

			/**
			 * Aria-label value for the svg.
			 */
			svgAriaLabel: {
				type: String,
				value: ""
			},

			_graphic: {
				type: Object,
				notify: true,
				readOnly: true
			},

			_singlePlugins: {
				type: Array,
				value: function(){
					return ["triplat-graphic-selectable",
							"triplat-graphic-zoomable",
							"triplat-graphic-label",
							"triplat-graphic-bounding-selection",
							"triplat-graphic-layer-manager",
							"triplat-graphic-highlight-group"]
				}
			},

			_graphic_label: {
				type: Object,
				value: null,
				readOnly: true
			}
		},

		listeners: {
			"graphic-tapped":"_handleTap"
		},

		attached: function() {
			this.async(function() {
				var graphic = this.$$("triplat-graphic-base");
				if (!graphic) {
					console.warn("no graphic found");
					return;
				}
				this._set_graphic(graphic);

				this.listen(graphic, "svg-loaded", "_handleSvgLoadedChanged");
				
				this._singlePlugins.forEach(function(plugin){
					var pluginTag = Polymer.dom(this.$$("#"+plugin)).getDistributedNodes()[0];
					if(pluginTag){
						pluginTag.set("graphic", graphic);
					}
				}, this);

				Polymer.dom(this.$$("#triplat-graphic-highlight")).getDistributedNodes().forEach(function(node){
					node.set("graphic", graphic);
				});

				Polymer.dom(this.$$("#triplat-graphic-def")).getDistributedNodes().forEach(function(node){
					node.set("graphic", graphic);
				});
				
				Polymer.dom(this.$$("#triplat-graphic-pin")).getDistributedNodes().forEach(function(node){
					node.set("graphic", graphic);
				});

				var graphic_label = Polymer.dom(this.$$("#triplat-graphic-label")).getDistributedNodes()[0];
				this._set_graphic_label(graphic_label);
				this._setSvgLoaded(graphic.svgLoaded);
			});
			this._lazyLoading();
		},

		_handleSvgLoadedChanged: function(e) {
			this._setSvgLoaded(e.detail);
		},

		/**
		 * Recalculates the view box of the graphic.
		 * If triplat-graphic-highlight-group is used, it will refresh the mask element.
		 * If triplat-graphic-zoomable plugin and cached property are used, it will set to cached view box.
		 */
		refreshViewBox: function(){
			if(this._graphic) {
				this._graphic.refreshViewBox();

				var highlight_group_plugin = this.queryEffectiveChildren("triplat-graphic-highlight-group");
				if (highlight_group_plugin) { 
					highlight_group_plugin.refreshMaskElement();
				}

				var zoomable_plugin = this.queryEffectiveChildren("triplat-graphic-zoomable");
				if (zoomable_plugin && zoomable_plugin._isCached()) {
					zoomable_plugin._setCachedViewPort(this.svgLoaded);
				}
			}
		},

		/**
		 * Forces the refresh of labels in the graphic.
		 */
		refreshLabel: function(delay) {
			console.warn("triplat-graphic: refreshLabel is deprecated. Use it directly against the plugin element(triplat-graphic-label) instead.");
			if(this._graphic_label) {
				this._graphic_label.refreshLabel(delay);
			}
		},

		_findPlugin: function(plugin) {
			var pluginElm = Polymer.dom(this.$$("#"+plugin)).getDistributedNodes()[0];
			return pluginElm;
		},

		_lazyLoading: function() {
			var graphic = this.$$("triplat-graphic-base");
			if (!graphic) {
				console.warn("no graphic found");
				return;
			}
			var drag_drop_plugin = Polymer.dom(this.$$("#triplat-graphic-drag-drop")).getDistributedNodes()[0];
			if (drag_drop_plugin) {
				// triplat-graphic-drag-drop will be imported only when instance is used
				// if no triplat-graphic-drag-drop plugin in triplat-graphic, no actual triplat-graphic-drag-drop import occcurs.
				if (Polymer.isInstance(drag_drop_plugin)) {
					drag_drop_plugin.set("graphic", graphic);
				}
			}
		},

		_handleTap: function(e) {
			e.stopPropagation();
			var selectable_plugin = Polymer.dom(this.$$("#triplat-graphic-selectable")).getDistributedNodes()[0];
			if (selectable_plugin) {
				selectable_plugin.handleTap(e.detail);
			}
		}
	});

</script>


<script>

 /**
 * `iron-range-behavior` provides the behavior for something with a minimum to maximum range.
 *
 * @demo demo/index.html
 * @polymerBehavior
 */
 Polymer.IronRangeBehavior = {

  properties: {

    /**
     * The number that represents the current value.
     */
    value: {
      type: Number,
      value: 0,
      notify: true,
      reflectToAttribute: true
    },

    /**
     * The number that indicates the minimum value of the range.
     */
    min: {
      type: Number,
      value: 0,
      notify: true
    },

    /**
     * The number that indicates the maximum value of the range.
     */
    max: {
      type: Number,
      value: 100,
      notify: true
    },

    /**
     * Specifies the value granularity of the range's value.
     */
    step: {
      type: Number,
      value: 1,
      notify: true
    },

    /**
     * Returns the ratio of the value.
     */
    ratio: {
      type: Number,
      value: 0,
      readOnly: true,
      notify: true
    },
  },

  observers: [
    '_update(value, min, max, step)'
  ],

  _calcRatio: function(value) {
    return (this._clampValue(value) - this.min) / (this.max - this.min);
  },

  _clampValue: function(value) {
    return Math.min(this.max, Math.max(this.min, this._calcStep(value)));
  },

  _calcStep: function(value) {
    // polymer/issues/2493
    value = parseFloat(value);

    if (!this.step) {
      return value;
    }

    var numSteps = Math.round((value - this.min) / this.step);
    if (this.step < 1) {
     /**
      * For small values of this.step, if we calculate the step using
      * `Math.round(value / step) * step` we may hit a precision point issue
      * eg. 0.1 * 0.2 =  0.020000000000000004
      * http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html
      *
      * as a work around we can divide by the reciprocal of `step`
      */
      return numSteps / (1 / this.step) + this.min;
    } else {
      return numSteps * this.step + this.min;
    }
  },

  _validateValue: function() {
    var v = this._clampValue(this.value);
    this.value = this.oldValue = isNaN(v) ? this.oldValue : v;
    return this.value !== v;
  },

  _update: function() {
    this._validateValue();
    this._setRatio(this._calcRatio(this.value) * 100);
  }

};
</script>

<dom-module id="paper-progress" assetpath="../paper-progress/">
  <template>
    <style>
      :host {
        display: block;
        width: 200px;
        position: relative;
        overflow: hidden;
      }

      :host([hidden]) {
        display: none !important;
      }

      #progressContainer {
        @apply(--paper-progress-container);
        position: relative;
      }

      #progressContainer,
      /* the stripe for the indeterminate animation*/
      .indeterminate::after {
        height: var(--paper-progress-height, 4px);
      }

      #primaryProgress,
      #secondaryProgress,
      .indeterminate::after {
        @apply(--layout-fit);
      }

      #progressContainer,
      .indeterminate::after {
        background: var(--paper-progress-container-color, --google-grey-300);
      }

      :host(.transiting) #primaryProgress,
      :host(.transiting) #secondaryProgress {
        -webkit-transition-property: -webkit-transform;
        transition-property: transform;

        /* Duration */
        -webkit-transition-duration: var(--paper-progress-transition-duration, 0.08s);
        transition-duration: var(--paper-progress-transition-duration, 0.08s);

        /* Timing function */
        -webkit-transition-timing-function: var(--paper-progress-transition-timing-function, ease);
        transition-timing-function: var(--paper-progress-transition-timing-function, ease);

        /* Delay */
        -webkit-transition-delay: var(--paper-progress-transition-delay, 0s);
        transition-delay: var(--paper-progress-transition-delay, 0s);
      }

      #primaryProgress,
      #secondaryProgress {
        @apply(--layout-fit);
        -webkit-transform-origin: left center;
        transform-origin: left center;
        -webkit-transform: scaleX(0);
        transform: scaleX(0);
        will-change: transform;
      }

      #primaryProgress {
        background: var(--paper-progress-active-color, --google-green-500);
      }

      #secondaryProgress {
        background: var(--paper-progress-secondary-color, --google-green-100);
      }

      :host([disabled]) #primaryProgress {
        background: var(--paper-progress-disabled-active-color, --google-grey-500);
      }

      :host([disabled]) #secondaryProgress {
        background: var(--paper-progress-disabled-secondary-color, --google-grey-300);
      }

      :host(:not([disabled])) #primaryProgress.indeterminate {
        -webkit-transform-origin: right center;
        transform-origin: right center;
        -webkit-animation: indeterminate-bar var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;
        animation: indeterminate-bar var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;
      }

      :host(:not([disabled])) #primaryProgress.indeterminate::after {
        content: "";
        -webkit-transform-origin: center center;
        transform-origin: center center;

        -webkit-animation: indeterminate-splitter var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;
        animation: indeterminate-splitter var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;
      }

      @-webkit-keyframes indeterminate-bar {
        0% {
          -webkit-transform: scaleX(1) translateX(-100%);
        }
        50% {
          -webkit-transform: scaleX(1) translateX(0%);
        }
        75% {
          -webkit-transform: scaleX(1) translateX(0%);
          -webkit-animation-timing-function: cubic-bezier(.28,.62,.37,.91);
        }
        100% {
          -webkit-transform: scaleX(0) translateX(0%);
        }
      }

      @-webkit-keyframes indeterminate-splitter {
        0% {
          -webkit-transform: scaleX(.75) translateX(-125%);
        }
        30% {
          -webkit-transform: scaleX(.75) translateX(-125%);
          -webkit-animation-timing-function: cubic-bezier(.42,0,.6,.8);
        }
        90% {
          -webkit-transform: scaleX(.75) translateX(125%);
        }
        100% {
          -webkit-transform: scaleX(.75) translateX(125%);
        }
      }

      @keyframes indeterminate-bar {
        0% {
          transform: scaleX(1) translateX(-100%);
        }
        50% {
          transform: scaleX(1) translateX(0%);
        }
        75% {
          transform: scaleX(1) translateX(0%);
          animation-timing-function: cubic-bezier(.28,.62,.37,.91);
        }
        100% {
          transform: scaleX(0) translateX(0%);
        }
      }

      @keyframes indeterminate-splitter {
        0% {
          transform: scaleX(.75) translateX(-125%);
        }
        30% {
          transform: scaleX(.75) translateX(-125%);
          animation-timing-function: cubic-bezier(.42,0,.6,.8);
        }
        90% {
          transform: scaleX(.75) translateX(125%);
        }
        100% {
          transform: scaleX(.75) translateX(125%);
        }
      }
    </style>

    <div id="progressContainer">
      <div id="secondaryProgress" hidden$="[[_hideSecondaryProgress(secondaryRatio)]]"></div>
      <div id="primaryProgress"></div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'paper-progress',

    behaviors: [
      Polymer.IronRangeBehavior
    ],

    properties: {
      /**
       * The number that represents the current secondary progress.
       */
      secondaryProgress: {
        type: Number,
        value: 0
      },

      /**
       * The secondary ratio
       */
      secondaryRatio: {
        type: Number,
        value: 0,
        readOnly: true
      },

      /**
       * Use an indeterminate progress indicator.
       */
      indeterminate: {
        type: Boolean,
        value: false,
        observer: '_toggleIndeterminate'
      },

      /**
       * True if the progress is disabled.
       */
      disabled: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
        observer: '_disabledChanged'
      }
    },

    observers: [
      '_progressChanged(secondaryProgress, value, min, max)'
    ],

    hostAttributes: {
      role: 'progressbar'
    },

    _toggleIndeterminate: function(indeterminate) {
      // If we use attribute/class binding, the animation sometimes doesn't translate properly
      // on Safari 7.1. So instead, we toggle the class here in the update method.
      this.toggleClass('indeterminate', indeterminate, this.$.primaryProgress);
    },

    _transformProgress: function(progress, ratio) {
      var transform = 'scaleX(' + (ratio / 100) + ')';
      progress.style.transform = progress.style.webkitTransform = transform;
    },

    _mainRatioChanged: function(ratio) {
      this._transformProgress(this.$.primaryProgress, ratio);
    },

    _progressChanged: function(secondaryProgress, value, min, max) {
      secondaryProgress = this._clampValue(secondaryProgress);
      value = this._clampValue(value);

      var secondaryRatio = this._calcRatio(secondaryProgress) * 100;
      var mainRatio = this._calcRatio(value) * 100;

      this._setSecondaryRatio(secondaryRatio);
      this._transformProgress(this.$.secondaryProgress, secondaryRatio);
      this._transformProgress(this.$.primaryProgress, mainRatio);

      this.secondaryProgress = secondaryProgress;

      this.setAttribute('aria-valuenow', value);
      this.setAttribute('aria-valuemin', min);
      this.setAttribute('aria-valuemax', max);
    },

    _disabledChanged: function(disabled) {
      this.setAttribute('aria-disabled', disabled ? 'true' : 'false');
    },

    _hideSecondaryProgress: function(secondaryRatio) {
      return secondaryRatio === 0;
    }
  });
</script>
<dom-module id="paper-slider" assetpath="../paper-slider/">
  <template strip-whitespace="">
    <style>
      :host {
        @apply(--layout);
        @apply(--layout-justified);
        @apply(--layout-center);
        width: 200px;
        cursor: default;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        --paper-progress-active-color: var(--paper-slider-active-color, --google-blue-700);
        --paper-progress-secondary-color: var(--paper-slider-secondary-color, --google-blue-300);
        --paper-progress-disabled-active-color: var(--paper-slider-disabled-active-color, --paper-grey-400);
        --paper-progress-disabled-secondary-color: var(--paper-slider-disabled-secondary-color, --paper-grey-400);
        --calculated-paper-slider-height: var(--paper-slider-height, 2px);
      }

      /* focus shows the ripple */
      :host(:focus) {
        outline: none;
      }

      #sliderContainer {
        position: relative;
        width: 100%;
        height: calc(30px + var(--calculated-paper-slider-height));
        margin-left: calc(15px + var(--calculated-paper-slider-height)/2);
        margin-right: calc(15px + var(--calculated-paper-slider-height)/2);
      }

      #sliderContainer:focus {
        outline: 0;
      }

      #sliderContainer.editable {
        margin-top: 12px;
        margin-bottom: 12px;
      }

      .bar-container {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        overflow: hidden;
      }

      .ring > .bar-container {
        left: calc(5px + var(--calculated-paper-slider-height)/2);
        transition: left 0.18s ease;
      }

      .ring.expand.dragging > .bar-container {
        transition: none;
      }

      .ring.expand:not(.pin) > .bar-container {
        left: calc(8px + var(--calculated-paper-slider-height)/2);
      }

      #sliderBar {
        padding: 15px 0;
        width: 100%;
        background-color: var(--paper-slider-bar-color, transparent);
        --paper-progress-container-color: var(--paper-slider-container-color, --paper-grey-400);
        --paper-progress-height: var(--calculated-paper-slider-height);
      }

      .slider-markers {
        position: absolute;
        top: calc(14px + var(--paper-slider-height,2px)/2);
        height: var(--calculated-paper-slider-height);
        left: 0;
        right: -1px;
        box-sizing: border-box;
        pointer-events: none;
        @apply(--layout-horizontal);
      }

      .slider-marker {
        @apply(--layout-flex);
      }
      .slider-markers::after,
      .slider-marker::after {
        content: "";
        display: block;
        margin-left: -1px;
        width: 2px;
        height: var(--calculated-paper-slider-height);
        border-radius: 50%;
        background-color: var(--paper-slider-markers-color, #000);
      }

      .slider-knob {
        position: absolute;
        left: 0;
        top: 0;
        margin-left: calc(-15px - var(--calculated-paper-slider-height)/2);
        width: calc(30px + var(--calculated-paper-slider-height));
        height: calc(30px + var(--calculated-paper-slider-height));
      }

      .transiting > .slider-knob {
        transition: left 0.08s ease;
      }

      .slider-knob:focus {
        outline: none;
      }

      .slider-knob.dragging {
        transition: none;
      }

      .snaps > .slider-knob.dragging {
        transition: -webkit-transform 0.08s ease;
        transition: transform 0.08s ease;
      }

      .slider-knob-inner {
        margin: 10px;
        width: calc(100% - 20px);
        height: calc(100% - 20px);
        background-color: var(--paper-slider-knob-color, --google-blue-700);
        border: 2px solid var(--paper-slider-knob-color, --google-blue-700);
        border-radius: 50%;

        -moz-box-sizing: border-box;
        box-sizing: border-box;

        transition-property: -webkit-transform, background-color, border;
        transition-property: transform, background-color, border;
        transition-duration: 0.18s;
        transition-timing-function: ease;
      }

      .expand:not(.pin) > .slider-knob > .slider-knob-inner {
        -webkit-transform: scale(1.5);
        transform: scale(1.5);
      }

      .ring > .slider-knob > .slider-knob-inner {
        background-color: var(--paper-slider-knob-start-color, transparent);
        border: 2px solid var(--paper-slider-knob-start-border-color, --paper-grey-400);
      }

      .slider-knob-inner::before {
        background-color: var(--paper-slider-pin-color, --google-blue-700);
      }

      .pin > .slider-knob > .slider-knob-inner::before {
        content: "";
        position: absolute;
        top: 0;
        left: 50%;
        margin-left: -13px;
        width: 26px;
        height: 26px;
        border-radius: 50% 50% 50% 0;

        -webkit-transform: rotate(-45deg) scale(0) translate(0);
        transform: rotate(-45deg) scale(0) translate(0);
      }

      .slider-knob-inner::before,
      .slider-knob-inner::after {
        transition: -webkit-transform .18s ease, background-color .18s ease;
        transition: transform .18s ease, background-color .18s ease;
      }

      .pin.ring > .slider-knob > .slider-knob-inner::before {
        background-color: var(--paper-slider-pin-start-color, --paper-grey-400);
      }

      .pin.expand > .slider-knob > .slider-knob-inner::before {
        -webkit-transform: rotate(-45deg) scale(1) translate(17px, -17px);
        transform: rotate(-45deg) scale(1) translate(17px, -17px);
      }

      .pin > .slider-knob > .slider-knob-inner::after {
        content: attr(value);
        position: absolute;
        top: 0;
        left: 50%;
        margin-left: -16px;
        width: 32px;
        height: 26px;
        text-align: center;
        color: var(--paper-slider-font-color, #fff);
        font-size: 10px;

        -webkit-transform: scale(0) translate(0);
        transform: scale(0) translate(0);
      }

      .pin.expand > .slider-knob > .slider-knob-inner::after {
        -webkit-transform: scale(1) translate(0, -17px);
        transform: scale(1) translate(0, -17px);
      }

      /* paper-input */
      .slider-input {
        width: 50px;
        overflow: hidden;
        --paper-input-container-input: {
          text-align: center;
        };
        @apply(--paper-slider-input);
      }

      /* disabled state */
      #sliderContainer.disabled {
        pointer-events: none;
      }

      .disabled > .slider-knob > .slider-knob-inner {
        background-color: var(--paper-slider-disabled-knob-color, --paper-grey-400);
        border: 2px solid var(--paper-slider-disabled-knob-color, --paper-grey-400);
        -webkit-transform: scale3d(0.75, 0.75, 1);
        transform: scale3d(0.75, 0.75, 1);
      }

      .disabled.ring > .slider-knob > .slider-knob-inner {
        background-color: var(--paper-slider-knob-start-color, transparent);
        border: 2px solid var(--paper-slider-knob-start-border-color, --paper-grey-400);
      }

      paper-ripple {
        color: var(--paper-slider-knob-color, --google-blue-700);
      }
    </style>

    <div id="sliderContainer" class$="[[_getClassNames(disabled, pin, snaps, immediateValue, min, expand, dragging, transiting, editable)]]">
      <div class="bar-container">
        <paper-progress disabled$="[[disabled]]" id="sliderBar" aria-hidden="true" min="[[min]]" max="[[max]]" step="[[step]]" value="[[immediateValue]]" secondary-progress="[[secondaryProgress]]" on-down="_bardown" on-up="_resetKnob" on-track="_onTrack">
        </paper-progress>
      </div>

      <template is="dom-if" if="[[snaps]]">
        <div class="slider-markers">
          <template is="dom-repeat" items="[[markers]]">
            <div class="slider-marker"></div>
          </template>
        </div>
      </template>

      <div id="sliderKnob" class="slider-knob" on-down="_knobdown" on-up="_resetKnob" on-track="_onTrack" on-transitionend="_knobTransitionEnd">
          <div class="slider-knob-inner" value$="[[immediateValue]]"></div>
      </div>
    </div>

    <template is="dom-if" if="[[editable]]">
      <paper-input id="input" type="number" step="[[step]]" min="[[min]]" max="[[max]]" class="slider-input" disabled$="[[disabled]]" value="[[immediateValue]]" on-change="_changeValue" on-keydown="_inputKeyDown" no-label-float="">
      </paper-input>
    </template>
  </template>

  <script>
    Polymer({
      is: 'paper-slider',

      behaviors: [
        Polymer.IronA11yKeysBehavior,
        Polymer.IronFormElementBehavior,
        Polymer.PaperInkyFocusBehavior,
        Polymer.IronRangeBehavior
      ],

      properties: {
        /**
         * If true, the slider thumb snaps to tick marks evenly spaced based
         * on the `step` property value.
         */
        snaps: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * If true, a pin with numeric value label is shown when the slider thumb
         * is pressed. Use for settings for which users need to know the exact
         * value of the setting.
         */
        pin: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * The number that represents the current secondary progress.
         */
        secondaryProgress: {
          type: Number,
          value: 0,
          notify: true,
          observer: '_secondaryProgressChanged'
        },

        /**
         * If true, an input is shown and user can use it to set the slider value.
         */
        editable: {
          type: Boolean,
          value: false
        },

        /**
         * The immediate value of the slider.  This value is updated while the user
         * is dragging the slider.
         */
        immediateValue: {
          type: Number,
          value: 0,
          readOnly: true,
          notify: true
        },

        /**
         * The maximum number of markers
         */
        maxMarkers: {
          type: Number,
          value: 0,
          notify: true
        },

        /**
         * If true, the knob is expanded
         */
        expand: {
          type: Boolean,
          value: false,
          readOnly: true
        },

        /**
         * True when the user is dragging the slider.
         */
        dragging: {
          type: Boolean,
          value: false,
          readOnly: true
        },

        transiting: {
          type: Boolean,
          value: false,
          readOnly: true
        },

        markers: {
          type: Array,
          readOnly: true,
          value: function() {
              return [];
          }
        },
      },

      observers: [
        '_updateKnob(value, min, max, snaps, step)',
        '_valueChanged(value)',
        '_immediateValueChanged(immediateValue)',
        '_updateMarkers(maxMarkers, min, max, snaps)'
      ],

      hostAttributes: {
        role: 'slider',
        tabindex: 0
      },

      keyBindings: {
        'left down pagedown home': '_decrementKey',
        'right up pageup end': '_incrementKey'
      },

      /**
       * Increases value by `step` but not above `max`.
       * @method increment
       */
      increment: function() {
        this.value = this._clampValue(this.value + this.step);
      },

      /**
       * Decreases value by `step` but not below `min`.
       * @method decrement
       */
      decrement: function() {
        this.value = this._clampValue(this.value - this.step);
      },

      _updateKnob: function(value, min, max, snaps, step) {
        this.setAttribute('aria-valuemin', min);
        this.setAttribute('aria-valuemax', max);
        this.setAttribute('aria-valuenow', value);

        this._positionKnob(this._calcRatio(value));
      },

      _valueChanged: function() {
        this.fire('value-change');
      },

      _immediateValueChanged: function() {
        if (this.dragging) {
          this.fire('immediate-value-change');
        } else {
          this.value = this.immediateValue;
        }
      },

      _secondaryProgressChanged: function() {
        this.secondaryProgress = this._clampValue(this.secondaryProgress);
      },

      _expandKnob: function() {
        this._setExpand(true);
      },

      _resetKnob: function() {
        this.cancelDebouncer('expandKnob');
        this._setExpand(false);
      },

      _positionKnob: function(ratio) {
        this._setImmediateValue(this._calcStep(this._calcKnobPosition(ratio)));
        this._setRatio(this._calcRatio(this.immediateValue));

        this.$.sliderKnob.style.left = (this.ratio * 100) + '%';
        if (this.dragging) {
          this._knobstartx = this.ratio * this._w;
          this.translate3d(0, 0, 0, this.$.sliderKnob);
        }
      },

      _calcKnobPosition: function(ratio) {
        return (this.max - this.min) * ratio + this.min;
      },

      _onTrack: function(event) {
        event.stopPropagation();
        switch (event.detail.state) {
          case 'start':
            this._trackStart(event);
            break;
          case 'track':
            this._trackX(event);
            break;
          case 'end':
            this._trackEnd();
            break;
        }
      },

      _trackStart: function(event) {
        this._w = this.$.sliderBar.offsetWidth;
        this._x = this.ratio * this._w;
        this._startx = this._x;
        this._knobstartx = this._startx;
        this._minx = - this._startx;
        this._maxx = this._w - this._startx;
        this.$.sliderKnob.classList.add('dragging');
        this._setDragging(true);
      },

      _trackX: function(event) {
        if (!this.dragging) {
          this._trackStart(event);
        }

        var dx = Math.min(this._maxx, Math.max(this._minx, event.detail.dx));
        this._x = this._startx + dx;

        var immediateValue = this._calcStep(this._calcKnobPosition(this._x / this._w));
        this._setImmediateValue(immediateValue);

        // update knob's position
        var translateX = ((this._calcRatio(this.immediateValue) * this._w) - this._knobstartx);
        this.translate3d(translateX + 'px', 0, 0, this.$.sliderKnob);
      },

      _trackEnd: function() {
        var s = this.$.sliderKnob.style;

        this.$.sliderKnob.classList.remove('dragging');
        this._setDragging(false);
        this._resetKnob();
        this.value = this.immediateValue;

        s.transform = s.webkitTransform = '';

        this.fire('change');
      },

      _knobdown: function(event) {
        this._expandKnob();

        // cancel selection
        event.preventDefault();

        // set the focus manually because we will called prevent default
        this.focus();
      },

      _bardown: function(event) {
        this._w = this.$.sliderBar.offsetWidth;
        var rect = this.$.sliderBar.getBoundingClientRect();
        var ratio = (event.detail.x - rect.left) / this._w;
        var prevRatio = this.ratio;

        this._setTransiting(true);

        this._positionKnob(ratio);

        this.debounce('expandKnob', this._expandKnob, 60);

        // if the ratio doesn't change, sliderKnob's animation won't start
        // and `_knobTransitionEnd` won't be called
        // Therefore, we need to manually update the `transiting` state

        if (prevRatio === this.ratio) {
          this._setTransiting(false);
        }

        this.async(function() {
          this.fire('change');
        });

        // cancel selection
        event.preventDefault();

        // set the focus manually because we will called prevent default
        this.focus();
      },

      _knobTransitionEnd: function(event) {
        if (event.target === this.$.sliderKnob) {
          this._setTransiting(false);
        }
      },

      _updateMarkers: function(maxMarkers, min, max, snaps) {
        if (!snaps) {
          this._setMarkers([]);
        }
        var steps = Math.round((max - min) / this.step);
        if (steps > maxMarkers) {
          steps = maxMarkers;
        }
        this._setMarkers(new Array(steps));
      },

      _mergeClasses: function(classes) {
        return Object.keys(classes).filter(
          function(className) {
            return classes[className];
          }).join(' ');
      },

      _getClassNames: function() {
        return this._mergeClasses({
          disabled: this.disabled,
          pin: this.pin,
          snaps: this.snaps,
          ring: this.immediateValue <= this.min,
          expand: this.expand,
          dragging: this.dragging,
          transiting: this.transiting,
          editable: this.editable
        });
      },

      _incrementKey: function(event) {
        if (!this.disabled) {
          if (event.detail.key === 'end') {
            this.value = this.max;
          } else {
            this.increment();
          }
          this.fire('change');
        }
      },

      _decrementKey: function(event) {
        if (!this.disabled) {
          if (event.detail.key === 'home') {
            this.value = this.min;
          } else {
            this.decrement();
          }
          this.fire('change');
        }
      },

      _changeValue: function(event) {
        this.value = event.target.value;
        this.fire('change');
      },

      _inputKeyDown: function(event) {
        event.stopPropagation();
      },

      // create the element ripple inside the `sliderKnob`
      _createRipple: function() {
        this._rippleContainer = this.$.sliderKnob;
        return Polymer.PaperInkyFocusBehaviorImpl._createRipple.call(this);
      },

      // Hide the ripple when user is not interacting with keyboard.
      // This behavior is different from other ripple-y controls, but is
      // according to spec: https://www.google.com/design/spec/components/sliders.html
      _focusedChanged: function(receivedFocusFromKeyboard) {
        if (receivedFocusFromKeyboard) {
          this.ensureRipple();
        }
        if (this.hasRipple()) {
          // note, ripple must be un-hidden prior to setting `holdDown`
          if (receivedFocusFromKeyboard) {
            this._ripple.style.display = '';
          } else {
            this._ripple.style.display = 'none';
          }
          this._ripple.holdDown = receivedFocusFromKeyboard;
        }
      }
    });

    /**
     * Fired when the slider's value changes.
     *
     * @event value-change
     */

    /**
     * Fired when the slider's immediateValue changes. Only occurs while the
     * user is dragging.
     *
     * To detect changes to immediateValue that happen for any input (i.e.
     * dragging, tapping, clicking, etc.) listen for immediate-value-changed
     * instead.
     *
     * @event immediate-value-change
     */

    /**
     * Fired when the slider's value changes due to user interaction.
     *
     * Changes to the slider's value due to changes in an underlying
     * bound variable will not trigger this event.
     *
     * @event change
     */
  </script>
</dom-module>
<dom-module id="triplat-zoom-slider" assetpath="../triplat-zoom-slider/">
	<template>
		<style>
			:host {
				@apply(--layout);
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				@apply(--triplat-zoom-slider);
			}
			:host-context([dir="rtl"]) {
				@apply(--layout-horizontal-reverse);
			} 

			.slider {
				--paper-slider-active-color: var(--tri-secondary-color);
				--paper-slider-knob-start-color: var(--tri-primary-color);
				--paper-slider-knob-start-border-color: var(--tri-primary-color);
				--paper-slider-knob-color: var(--tri-primary-color);
				--paper-slider-secondary-color: var(--tri-secondary-color);
				@apply(--layout);
				@apply(--layout-flex);
			}
		</style>
			<paper-icon-button primary="" icon="ibm-glyphs:incremental-input-minus" on-tap="increaseValue" disabled$="[[_disableDecrementButton]]" alt="Zoom out">
			</paper-icon-button>
			<paper-slider id="slider" class="slider" min="[[_normalizedMin]]" max="[[_normalizedMax]]" on-immediate-value-change="_handleSliderValueChange" on-change="_handleSliderValueChange" aria-label="Slide to zoom">
			</paper-slider>
			<paper-icon-button primary="" icon="ibm-glyphs:incremental-input-add" on-tap="decreaseValue" disabled$="[[_disableIncrementButton]]" alt="Zoom in">
			</paper-icon-button>
	</template>
	<script>
		Polymer({
			is: "triplat-zoom-slider",

			properties : {
				/**
				  * Optional minimum allowed for a value when a value is decreased.
				  */
				min: {
					type: Number,
					value: 0
				},
				/**
				  * Optional maximum allowed for a value when a value is increased.
				  */
				max: {
					type: Number,
					value: 100
				},

				/*
				 * Amount to add or subtract when increasing or decreasing a value.
				 */
				step: {
					type: Number,
					value: 10
				},

				/**
				 * Numeric value for the zoom slider. 
				 */
				value: {
					type: Number,
					value: 50,
					notify: true
				},

				_normalizingFactor: {
					type: Number,
					value: 1,
					computed: "_computeNormalizingFactor(min, max)"
				},

				_normalizedMin: {
					type: Number,
					computed: "_computeNormalizedMin(max, _normalizingFactor)"
				},

				_normalizedMax: {
					type: Number,
					computed: "_computeNormalizedMax(min, _normalizingFactor)"
				}
			},

			observers: [
				"_updateSlideValue(value, _normalizingFactor)",
				"_checkValueLimits(value, min, max)"
			],

			/**
			  * Increase the value by a given step.
			  * If max value is set, value cannot be larger than max.
			  */
			increaseValue: function() {
				var value = this.value + this.step;
				this.value = value > this.max ? this.max : value;
			},

			/**
			  * Decrease the value by a given step.
			  * If min value is set, value cannot be smaller than min.
			  */
			decreaseValue: function() {
				var value = this.value - this.step;
				this.value = value < this.min ? this.min : value;
			},

			_computeNormalizedMin: function(value, _normalizingFactor) {
				return value * _normalizingFactor * -1;
			},

			_computeNormalizedMax: function(value, _normalizingFactor) {
				return value * _normalizingFactor * -1;
			},

			_handleSliderValueChange: function() {
				this.value = this.$.slider.immediateValue / this._normalizingFactor * -1;
			},

			_updateSlideValue: function(value, _normalizingFactor) {
				this.$.slider.value = value * _normalizingFactor * -1;
			},

			_checkValueLimits: function(value, min, max) {
				if (value < min) {
					this.value = min;
				} else if (value > max) {
					this.value = max;
				}
			},

			_computeNormalizingFactor: function(min, max) {
				var minDecimalPlaces = this._decimalPlaces(min);
				var maxDecimalPlaces = this._decimalPlaces(max);
				return Math.pow(10, Math.max(minDecimalPlaces, maxDecimalPlaces, 1));
			},

			_decimalPlaces: function(num) {
				if(Math.floor(num) === num) return 0;
				return num.toString().split(".")[1].length || 0; 
			}
		});
	</script>
</dom-module>
<dom-module id="tricomp-reservation-room-location" assetpath="../triapp-reservation-list/">
	<template>
		<style>

			:host {
				@apply(--layout-vertical);
				flex-shrink: 0;
			}

			.floor-graphic-container {
				@apply(--layout-flex);
				@apply(--layout-relative);
				@apply(--layout-vertical);
				margin: 5px;
				min-height: 0;
			}

			.floor-graphic {
				@apply(--layout-flex);
				@apply(--layout-vertical);

				--triplat-graphic-highlight-1: {
					fill: green;
					fill-opacity: 1;
				};
			}

			.slider-container {
				@apply(--layout-vertical);
				@apply(--layout-center);
			}

			.slider {
				max-width: 280px;
			}

			.instruction {
				padding:0px 0px 3px 0px;
			}

			.page-main {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				@apply(--layout-center);
				min-height: 0;
				background-color: var(--tri-primary-content-background-color);
				box-sizing: border-box; 
			}
			

			.page-wrap {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				width: 100%;
			}

			paper-button {
				margin: 0 5px;
				height: 44px;
				width: 90px !important;
				border-width: 2px !important;
			}

			.action-bar {
				height: 50px;
			}

			:host([small-screen-width]) > .page-main >.action-bar {
				@apply(--layout);
				@apply(--layout-fixed-bottom);
				background-color: var(--tri-footer-background-color);
				color: var(--tri-footer-color);
				width: 100%;
				padding: 5px;
				@apply(--layout-center-center);			
				z-index: 102;
			}

			.empty-data-message {
				@apply(--layout-center-justified);
			}

		</style>
		
		<triplat-loading-indicator show="[[graphicLoading]]"></triplat-loading-indicator>

		<triplat-ds id="spaceLabelStyle" name="spaceLabelStyle" filtered-data="{{_spaceLabelStyle}}">
			<triplat-query>
				<triplat-query-filter name="ID" operator="equals" value="[[_spaceLabelID]]">
				</triplat-query-filter>
			</triplat-query>
		</triplat-ds>

		<triplat-ds id="roomDetails" name="lookupRoom" data="{{_roomDetails}}" loading="{{roomDetailsLoading}}">
			<triplat-ds-instance instance-id="{{roomId}}"></triplat-ds-instance>
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]">
			</triplat-ds-context>
		</triplat-ds>

		<div class="page-main">
			<div class="page-wrap">
				<div class="floor-graphic-container" hidden$="[[!hasGraphic]]">
					<div class="instruction">
						You can pan or zoom on the floor plan.
					</div>
					<triplat-graphic id="floorplan" class="floor-graphic" record-id="[[_roomDetails.floorRef.id]]" has-graphic="{{hasGraphic}}" drawing-id-loading="{{graphicLoading}}">
						<triplat-graphic-highlight classnumber="1" highlighted="{{_roomDetails}}"></triplat-graphic-highlight>
						<triplat-graphic-zoomable scale="{{_zoomScale}}" cached=""></triplat-graphic-zoomable>
						<triplat-graphic-label id="graphicLabel" label-id="[[_getLabelId(_spaceLabelStyle.*)]]"></triplat-graphic-label>
					</triplat-graphic>
				</div>

				<div class="slider-container" hidden$="[[!hasGraphic]]">
					<triplat-zoom-slider class="slider" min="0.01" max="1.5" step="0.1" value="{{_zoomScale}}">
					</triplat-zoom-slider>
				</div>

				<div class="page-main empty-data-message" hidden$="[[hasGraphic]]">
					<iron-icon class="empty-data-message-icon" icon="ibm:status-info" info=""></iron-icon>
					<div>There is no floor plan for this room.</div>
				</div>

			</div>
			<div class="action-bar">
				<paper-button footer$="[[smallScreenWidth]]" on-tap="_handleDone">[[actionLabel]]</paper-button>
			</div>
		</div>
	</template>
	<script>
		Polymer({

			is: "tricomp-reservation-room-location",
			behaviors: [TriBlockViewResponsiveBehavior],
			properties: {
				roomId: String,
				specId: String,
				_zoomScale: {
					type: Number,
					value: 1.0
				},
				/**
		    	 * Use this property to change the displayed text for the Done button.
		    	 */
				actionLabel:{
					type: String,
					value: function(){
						var __dictionary__actionLabel= "Done";
						return __dictionary__actionLabel;
					},
				},

				isWorkspaceRoom: {
					type: Boolean,
					value: false
				},

				_spaceLabelID: {
					type: String,
					computed: "_computeSpaceLabelID(_roomDetails.isWorkspaceRoom)",
				},

				_spaceLabelStyle: {
					type: Array
				}
			},

			_handleDone: function() {
				this.fire("reservation-room-location-done", { "roomId": this.roomId });
			},

			_getLabelId: function (change) {
				var labelId = null;
				if (change.base && change.base.length > 0) {
					return change.base[0]._id;
				}
				return labelId;
			},

			_computeSpaceLabelID: function(isWorkspaceRoom) {
				return isWorkspaceRoom ? "triPeople001" : "triSpace002";
			}
		});
	</script>
</dom-module>

<dom-module id="tricomp-reservation-room-details" assetpath="../triapp-reservation-list/">
    <template>
        <style>
            :host {
                height: 100%;
                width: 100%;
            }
            tricomp-reservation-room {
                margin: 15px 0px 0px 15px;
                --room-name-font-size: 22px;
                --room-name-font-weight: bold;
                --room-building-font-size: 18px;
                --room-floor-font-size: 18px;
            }

            tricomp-reservation-room-location {
                width: 100%;
                height: 90%;
            }
        </style>
        <tricomp-reservation-room event-item="[[eventItem]]" application-settings="[[applicationSettings]]" no-icon=""></tricomp-reservation-room>
        <tricomp-reservation-room-location action-label="[[actionLabel]]" id="reserveRoomLocation" room-id="[[eventItem.roomId]]" spec-id="[[eventItem._id]]">
        </tricomp-reservation-room-location>
    </template>
    <script>

        Polymer({

            is: "tricomp-reservation-room-details",

            listeners: {
                "reserveRoomLocation.reservation-room-location-done": "_handleRoomLocationClose",
            },

            properties: {
                eventItem: Object,
                applicationSettings: Object,
                actionLabel: String,
            },

            _handleRoomLocationClose: function(){
                this.fire("reservation-room-location-close");
            },

        });

    </script>
</dom-module>
<script>

(function () {

    TriReservationActionsBehavior = {

        listeners: {
            "action-cancel-from-list": "_handleCancelFromList",
            "action-checkin-from-list": "_handleCheckInFromList",
            "action-checkout-from-list": "_handleCheckOutFromList",
            "action-earlyend-from-list": "_handleEarlyEndFromList"
        },

        _handleCancelFromList: function (e) {
            var reservationId = e.detail.reservationId;
            var occurrenceStart = e.detail.occurrenceStart;
            var occurrenceEnd = e.detail.occurrenceEnd;

            this.set("occurrenceStart", occurrenceStart);
            this.set("occurrenceEnd", occurrenceEnd);

            if (this.$.cancelDialog) this.$.cancelDialog.open();

            this._getRM(reservationId).then(function () {
                this._cancelRM().then(function () {
                    if (this.$.cancelDialog) this.$.cancelDialog.close();

                    this.$.reservationLocations.refresh().then(function () {
                        this.async(function () {
                            this._cancelSuccess();

                            this._goReservationList();
                        });
                    }.bind(this));
                }.bind(this));
            }.bind(this));
        },

        _handleCheckInFromList: function (e) {
            var instanceId = e.detail.instanceId;

            this._setBusy();

            this.$.reservationInstances.performAction(instanceId, TriPlatDs.RefreshType.NONE, "actions", "check-in").then(function () {
                this.async(function () {
                    this._checkinSuccess();

                    this._refreshReservationList();

                    this._clearBusy();
                });
            }.bind(this));
        },

        _handleCheckOutFromList: function (e) {
            var instanceId = e.detail.instanceId;

            this._setBusy();

            this.$.reservationInstances.performAction(instanceId, TriPlatDs.RefreshType.NONE, "actions", "check-out").then(function () {
                this.async(function () {
                    this._checkoutSuccess();

                    this._refreshReservationList();

                    this._clearBusy();
                });
            }.bind(this));
        },

        _handleEarlyEndFromList: function (e) {
            var instanceId = e.detail.instanceId;

            this._setBusy();

            this.$.reservationInstances.performAction(instanceId, TriPlatDs.RefreshType.NONE, "actions", "early-end").then(function () {
                this.async(function () {
                    this._earlyendSuccess();

                    this._refreshReservationList();

                    this._clearBusy();
                });
            }.bind(this));
        }

    }

})();

</script>
<script>

	(function() {

		var contextRegistry = [];
		var routesByName = {};
		var pathData;

		var handlePathChange = function() {
			var path = window.location.hash;
			pathData = {};
			if (path.search(/#\!\/.*$/) == -1) {
				pathData.parts = [];
				pathData.path = "/";
			} else {
				pathData.path = path.substr(2);
				pathData.parts = [];
				var matches = pathData.path.match(/([^\/]+)/g);
				if (matches) {
					matches.forEach(function(part) {
						pathData.parts.push(part);
					});
				}
			}

			contextRegistry.forEach(function(context) {
				context._onPathChange(pathData);
			});
		};

		window.addEventListener("hashchange", function(e) {
			handlePathChange();
		});

		handlePathChange();

		Polymer.TriPlatRouteContextBehavior = {

			properties: {

				_parentContext: {
					type: Object,
					notify: false,
					readOnly: true
				},

				_parentRouteContainer: {
					type: Object,
					notify: false,
					readOnly: true
				},

				_contextInitialized: {
					type: Boolean,
					notify: true,
					readOnly: true,
					value: false
				},

				_isInitializedPromise: {
					type: Object,
					notify: false,
					readOnly: true
				},

				_isInitializedPromiseResolve: {
					type: Function,
					notify: false,
					readOnly: true
				},

				_pathData: {
					type: Object,
					notify: true,
					readOnly: true
				}

			},

			get _isContained() {
				return this._parentContext && this._parentRouteContainer;
			},

			get _isRoot() {
				return !this._isContained;
			},

			attached: function() {
				this._set_isInitializedPromise(new Promise(function(resolve){
					this._set_isInitializedPromiseResolve(resolve);
				}.bind(this)));

				var node = this;
				var routeName = null;
				var routeContextSelector = null;
				var routeContextContainer = null;
				while (node) {
					node = Polymer.dom(node).parentNode;
					if (node && node.nodeType !== Node.ELEMENT_NODE) {
						node = node.host;
					}

					if (node && node.hasAttribute("route")) {
						routeContextContainer = node;
						routeName = node.getAttribute("route");
					}

					if (node && node.tagName == "TRIPLAT-ROUTE-SELECTOR") {
						routeContextSelector = node;
						break;
					}
				}

				if (routeContextSelector && routeContextContainer) {
					// we found a parent route context
					this._set_parentContext(routeContextSelector);
					this._set_parentRouteContainer(routeContextContainer);
				}

				this._initializeContext();
			},

			detached: function() {
				this._unregisterContext();
			},

			_initializeContext: function() {
				if (this._isRoot) {
					this._doSetInitialized();
				} else {
					this._parentContext._isInitialzied().then(this._doSetInitialized.bind(this));
				}
			},

			_doSetInitialized: function() {
				this._registerContext();
				this._set_contextInitialized(true);
				this._onPathChange(pathData);
				this._isInitializedPromiseResolve(true);
			},

			_isInitialzied: function() {
				return this._isInitializedPromise;
			},

			_registerContext: function() {
				contextRegistry.push(this);
			},

			_unregisterContext: function() {
				var index = contextRegistry.indexOf(this);
				if (index < 0) {
					return;
				}
				contextRegistry.splice(index, 1);
			},

			_onPathChange: function(pathData) {
				this._set_pathData(pathData);
			},

			_registerRoute: function() {
				if (this.name in routesByName) {
					console.warn("A duplicate route has been defined. [routeName=" + this.name + "]");
					return;
				}
				routesByName[this.name] = this;
			},

			_unregisterRoute: function() {
				delete routesByName[this.name];
			},

			_getRouteByName: function(routeName) {
				return routesByName[routeName];
			},

			_navigate: function(path, replaceUrl) {
				if (replaceUrl && history.replaceState) {
					history.replaceState({}, "", window.location.pathname + "#!" + path);
					handlePathChange();
				} else {
					window.location.hash = "!" + path;
				}
			}

		};

	})();
</script>
<dom-module id="triplat-route-selector" assetpath="../triplat-routing/">
	<style>
		:host {
			display: block;
		}
	</style>
	<template>
		<content></content>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-route-selector",

		/**
	     * Fired before navigating.
	     *
	     * @event triplat-route-selector-before-navigate
	     */

		properties: {

			/**
			 * The name of the currently selected route.
			 */
			selected: {
				type: String,
				notify: true,
				readOnly: true
			},

			_activeRoute: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_activeItem: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_selectionDelegate: {
				type: Object,
				notify: false,
				readOnly: true
			},
			
			/**
			 * When true, no route is initially selected.  A route must be explicitly navigated or marked as `default-route` so that it is selected and rendered.
			 * This property is ignored if there is a route marked as `default-route`.
			 */
			noInitialRoute: {
				type: Boolean,
				value: false
			}

		},

		behaviors: [
			Polymer.TriPlatRouteContextBehavior
		],

		observers: [
			"_updateRoute(_pathData, _contextInitialized, _selectionDelegate)"
		],

		attached: function() {
			this._set_selectionDelegate(this._findSelectionDelegate());
		},

		detached: function() {
			this._set_activeRoute(null);
			this._set_activeItem(null);
			this._set_selectionDelegate(null);
		},

		select: function() {
			this._updateRoute(this._pathData, this._contextInitialized, this._selectionDelegate);
		},

		_isActiveRoute: function(routeItem) {
			if (!this._isActive()) {
				return false;
			}
			return routeItem == this._activeItem;
		},

		_isActive: function() {
			if (this._isRoot) {
				return true;
			}
			return this._parentContext._isActiveRoute(this._parentRouteContainer);
		},

		_findSelectionDelegate: function() {
			return Polymer.dom(this).children[0];
		},

		_updateRoute: function(pathData, contextInitialized, selectionDelegate) {
			if (!contextInitialized || !selectionDelegate) {
				return;
			}

			if (!this._isActive()) {
				this._clearRoute();
				return;
			}

			var matchedRoute = null;
			var matchedStrength = 0;
			var matchedIndex = -1;
			var matchedDynamicCount = 1000;
			var matchedRouteName = null;
			var matchedItem = null;
			var matchedRoute = null;
			
			var children = Polymer.dom(this._selectionDelegate).children;
			for (var i = 0; i < children.length; i++) {
				var child = children[i];
				if (!child.hasAttribute("route")) {
					continue;
				}
				var routeName = child.getAttribute("route");
				var routePath = child.getAttribute("route-path");
				var routeContext = [];
				if (routePath) {
					routePath.match(/([^\/]+)/g).forEach(function(routeContextPart) {
						routeContext.push(routeContextPart);
					});
				}

				var route = this._getRouteByName(routeName);
				
				if (route == null) {
					continue;
				}

				if (matchedStrength == 0 && route._route.length == 0 && !this.noInitialRoute) {
					// do a special check for a 'root' route.
					matchedIndex = i;
					matchedDynamicCount = 0;
					matchedRouteName = route.name;
					matchedItem = child;
					matchedRoute = route;
				} else {
					var strength = this._getMatchStrength(route._route, pathData.parts, routeContext);
					var dynamicCount = this._getDynaiceCount(route._route);
					if (matchedIndex == -1 && this.noInitialRoute && (strength == 0)) {
						continue;
					}
					
					if (strength > matchedStrength 
							|| (strength == matchedStrength && dynamicCount < matchedDynamicCount)) {
						matchedStrength = strength;
						matchedIndex = i;
						matchedDynamicCount = dynamicCount;
						matchedRouteName = route.name;
						matchedItem = child;
						matchedRoute = route;
					}
				}
			}

			if (matchedIndex == -1) {
				this._selectDefault();
			} else {
				this._selectRoute(matchedIndex, matchedRouteName, matchedItem, matchedRoute);
			}
		},

		_selectDefault: function() {
			var defaultIndex = -1;
			var routePath = null;
			var children = Polymer.dom(this._selectionDelegate).children;
			var routeName = null;
			for (var i = 0; i < children.length; i++) {
				if (children[i].hasAttribute("default-route")) {
					defaultIndex = i;
					routeElement = children[i];
					routeName = children[i].getAttribute("route");
					routePath = children[i].getAttribute("route-path");
					break;
				}
			}
			
			if (defaultIndex == -1) {
				this._clearRoute();
				return;
			}

			if (!routeName) {
				console.warn("The default route of a triplat-route-selector does not have a route name.");
				return;
			}

			var routeElement = this._getRouteByName(routeName);

			if (routeElement && routePath) {
				routeElement.navigate(routeElement.getParamsFromPath(routePath));
			} else if(routeElement && routeElement.path.indexOf(":") == -1) {
				routeElement.navigate({});
			} else {
				this._selectionDelegate.selected = defaultIndex;
			}
			this._setSelected(routeName);
		},

		_getMatchStrength: function(route, parts, routeContext) {
			var strength = 0;
			for (var i = 0; i < route.length; i++) {
				if (parts.length <= i) {
					return 0;
				}

				if (route[i].type == "dynamic") {
					if (routeContext.length > i) {
						if (parts[i] == routeContext[i]) {
							strength++;
							continue;
						} else {
							return 0;
						}
					} else {
						strength++;
						continue;
					}
				}

				if (route[i].part != parts[i]) {
					return 0;
				}
				strength++;
			}
			return strength;
		},

		_getDynaiceCount: function(route) {
			var dynamicCount = 0;
			route.forEach(function(route) {
				if (route.type == "dynamic") {
					dynamicCount++;
				}
			});
			return dynamicCount;
		},

		_selectRoute: function(routeIndex, routeName, routeItem, route) {
			if (routeItem && this._activeItem && routeItem == this._activeItem) {
				/*
				 * Getting here means that the URL changed, but the selected route did not.
				 * Although, the selected route isn't changing, the paramaters might have, 
				 * so we still need to update the route with new parameters.
				 */
				if (route) {
					// make sure to tell the route not to fire a route-active event
					route._markActive(this._pathData, true);
				}
				return;
			}

			this.fire("triplat-route-selector-before-navigate", {
				currentIndex: this._selectionDelegate.selected,
				nextIndex: routeIndex
			});

			if (routeItem) {
				this.fire("triplat-route-before-navigate-to", {}, {
					bubbles: false,
					cancelable: false,
					node: routeItem
				});
			}

			this._leaveRoute();
			this._selectionDelegate.selected = routeIndex;
			this._setSelected(routeName);
			this._set_activeItem(routeItem);
			this._set_activeRoute(route);
			if (route) {
				route._markActive(this._pathData);
			}
			if (routeItem && routeItem._onNavigateTo) {
				routeItem._onNavigateTo(route.params);
				this.fire("triplat-route-navigate-to", route.params, {
					bubbles: false,
					cancelable: false,
					node: routeItem
				});
			}
			if (routeItem && routeItem.setupDialogPromise) {
				routeItem.setupDialogPromise(routeItem);
			}
		},

		_clearRoute: function() {
			this._leaveRoute();
			// TODO this causes an issue if an neon-animatable-page is used
			// this._selectionDelegate.selected = -1;
			this._setSelected(null);
			this._set_activeItem(null);
			this._set_activeRoute(null);
		},

		_leaveRoute: function() {
			if (this._activeRoute) {
				this._activeRoute._markInactive();
			}
			if (this._activeItem && this._activeItem._onNavigateAway) {
				this._activeItem._onNavigateAway();
				this.fire("triplat-route-navigate-away", {}, {
					bubbles: false,
					cancelable: false,
					node: this._activeItem
				});
			}
			if (this._activeItem && this._activeItem.clearDialogPromise) {
				this._activeItem.clearDialogPromise();
			} 
		}

	});
</script><script>
	Polymer({

		is: "triplat-route",

		properties: {

			/**
			 * The name of the route.
			 */
			name: {
				type: String,
				notify: false,
				readOnly: false
			},

			/**
			 * The path of the route.
			 */
			path: {
				type: String,
				notify: false,
				readOnly: false
			},

			/**
			 * The params of an active route.
			 */
			params: {
				type: Object,
				notify: true,
				readOnly: true
			},

			/**
			 * Whether the route is active or not.
			 */
			active: {
				type: Boolean,
				notify: true,
				readOnly: true,
				value: false
			},

			greedy: {
				type: Boolean,
				notify: false,
				readOnly: false,
				value: false
			},

			_route: {
				type: Array,
				notify: true,
				readOnly: true
			},

			_delegateRoute: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_delegateRouteActiveHandler: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_routeInitialized: {
				type: Boolean,
				notify: true,
				readOnly: true
			}

		},

		get _isPathDefined() {
			return this.path;
		},

		get _isPassiveRoute() {
			return !this._isPathDefined;
		},

		behaviors: [
			Polymer.TriPlatRouteContextBehavior,
			TriPlatChangeTrackerBehavior
		],

		observers: [
			"_handlePathDataChanged(_pathData, _route)"
		],

		attached: function() {
			if (this._isPathDefined) {
				this._registerRoute();
			}
			this._handleInit();
		},

		detached: function() {
			if (this._isPathDefined) {
				this._unregisterRoute();
			}
			if (this._delegateRoute && this._delegateRouteActiveHandler) {
				this._delegateRoute.removeEventListener("route-active", this._delegateRouteActiveHandler);
			}
			this._set_delegateRoute(null);
		},

		_startNavigate: function(params, replaceUrl) {
			var path = this._resolvePath(params);
			if (!path || path.length == 0) {
				path = "/";
			}
			this._navigate(path, replaceUrl);
		},
		
		navigate: function(params, replaceUrl) {
			if (this._isPassiveRoute) {
				this._delegateRoute.navigate(params, replaceUrl);
				return;
			}
			if (this._isDialogPromiseRegister && this._isDialogPromiseRegister()) {
				if (this._isUnsaveCheckEnable && 
					this._isUnsaveCheckEnable() &&
					this._isPageStatusDirty()) {
				
					this.getDialogPromise().then(function() {
						//console.log("user confirm to discard the changes");
						this._resetPageStatus();
						this._startNavigate(params);
					}.bind(this), function() {
						//console.log("user cancel navigation");
					});
				} else {
					this._startNavigate(params);
				}
			} else {
				if (this.unsaveCheck) {
					if (!this.unsaveCheck()) return;
				}
				this._startNavigate(params, replaceUrl);
			}
		},

		_resolvePath: function(params) {
			if (!params) {
				params = {};
			}
			var computedParams = this._getParamsFromPath(this._pathData);
			Polymer.Base.mixin(computedParams, params);
			var path = "";
			this._route.forEach(function(route) {
				path += "/";
				if (route.type == "dynamic") {
					path += computedParams[route.name];
				} else {
					path += route.part;
				}
			});
			return path;
		},

		getParamsFromPath: function(path) {
			var parts = [];
			path.match(/([^\/]+)/g).forEach(function(part) {
				parts.push(part);
			});

			var params = {};
			for (var i = 0; i < this.route.length; i++) {
				if (this.route[i].type == "dynamic") {
					params[this.route[i].name] = parts[i];
				}
			}
			
			return params;
		},

		_handleInit: function() {
			if (this._isPassiveRoute) {
				var delegateRoute = this._getRouteByName(this.name);
				if (!delegateRoute) {
					console.warn("Cannot initialize passive route as no route found with name. " + 
						"[routeName=" + this.name + "]");
					return;
				}
				var delegateRouteActiveHandler = this._handleDelegateRouteActive.bind(this);
				if (delegateRoute.active) {
					this._setParams(delegateRoute.params);
					this._setActive(true);
					this.fire("route-active", {
						active: true,
						params: this.params
					});
				}
				delegateRoute.addEventListener("route-active", delegateRouteActiveHandler);
				this._set_delegateRouteActiveHandler(delegateRouteActiveHandler);
				this._set_delegateRoute(delegateRoute);
				this._set_routeInitialized(true);
				return;
			}

			var fullPath = this._calculatePath();

			var route = [];
			if (fullPath == "/") {
				// this is a 'root' route
				this._set_route(route);
				return;
			}
			fullPath.match(/([^\/]+)/g).forEach(function(match) {
				if (match.search(/\:.*$/) != -1) {
					var name = match.match(/([^:]+)/g)[0];
					route.push({type: "dynamic", name: name});
				} else {
					route.push({type: "static", part: match});
				}
			});
			
			this._set_route(route);
			this._set_routeInitialized(true);
		},

		_calculatePath: function() {
			if (this._isPassiveRoute) {
				console.warn("_calculatePath should not be called on a passive route.");
				return;
			}
			
			if (this._isRoot) {
				return this.path;
			}

			var parentRouteName = this._parentRouteContainer.getAttribute("route");
			var parentRouteElement = this._getRouteByName(parentRouteName);
			if (!parentRouteElement) {
				console.warn("Cannot calculate route path as the parent route could not be found. " + 
					"[routeName=" + parentRouteName + "]");
				return;
			}

			return parentRouteElement._calculatePath() + this.path;
		},

		// called by plat-route-selector
		_markActive: function(pathData, doNotFireEvent) {
			this._setParams(this._getParamsFromPath(pathData));
			this._setActive(true);

			if (!doNotFireEvent) {
				this.fire("route-active", {
					active: true,
					params: this.params
				});
			}
		},

		// called by plat-route-selector
		_markInactive: function() {
			this._setParams({});
			this._setActive(false);
			this.fire("route-active", {
				active: false,
				params: this.params
			});
		},

		_getParamsFromPath: function(pathData) {
			var params = {};
			for (var i = 0; i < this._route.length; i++) {
				if (this._route[i].type != "dynamic") {
					continue;
				}
				params[this._route[i].name] = pathData.parts[i];
			}
			return params;
		},

		_isActive: function() {
			if (this._isRoot) {
				return true;
			}
			return this._parentContext._isActiveRoute(this._parentRouteContainer);
		},

		_handleDelegateRouteActive: function(e) {
			this._setParams(e.detail.params);
			this._setActive(e.detail.active);
			this.fire("route-active", e.detail);
		},

		_handlePathDataChanged: function(pathData) {
			if (!this.greedy) {
				return;
			}
			this._setParams(this._getParamsFromPath(pathData));
		}

	});
</script>
<dom-module id="triblock-responsive-layout" assetpath="../triblock-responsive-layout/">
	<template>
		<style include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning">
			
			:host{
				@apply(--layout);
				@apply(--layout-flex);
				@apply(--layout-horizontal);
			}

			:host ::content> * {
				@apply(--layout-flex);
			}

			:host([small-screen-width]){
				-ms-flex-direction: column !important;
				-webkit-flex-direction: column !important;
				flex-direction: column !important;
			}

			:host([stack-reverse][small-screen-width]){
				-ms-flex-direction: column-reverse !important;
				-webkit-flex-direction: column-reverse !important;
				flex-direction: column-reverse !important;
			}

			:host([small-screen-width][switch-view]) ::content > :not(.displayed-view){
		        display: none !important;
		    }

		</style>
		<content></content>
	</template>
</dom-module>

<script>

	Polymer({
		/**
         * Fired when a switched view is displayed.
         *
         * @event responsive-layout-switch-view-display
		 * @param {{view:Object, index:Number}} detail -
		 *     currentView: the currentView object.
		 *     index: the index of the child component.
         */


		is: "triblock-responsive-layout",

		behaviors: [TriBlockViewResponsiveBehavior],

		properties: {
	      /**
	       * If set to true, all the child components will be hidden when the `smallScreenWidth` property is true. A child component can be displayed by assigning the `currentViewId` property to one of the child components `id` (for example, current-view-id="left-column").
	       */
			switchView: {
				type: Boolean,
				value: false,
				reflectToAttribute: true
			},

			/**
	        * The child components.
	        */
			views: {
				type: Array,
				readOnly: true,
        		notify: true,
				value: function() {
					return [];
				}
			},

			/**
			 * The child component `id` to display when the `switchView` and `smallScreenWidth` properties are true.
			 */
			currentViewId: {
				type: String,
				notify: true,
				value: null,
				observer: "_currentViewIdChanged"
			},

			/**
			 * Returns the element of the currently displayed view when `switchView` is true.
			 */
			currentView: {
				type: Object,
		        readOnly: true,
		        notify: true
			}
		},

		attached: function(){
			this._updateViews();
		},

		/**
 		  * Switches to a view based on the given `id`.  
 		  * 
		  * @param {string} viewId The `id` of the child component to display. 
		  *
 		  **/	
		switchToViewId: function(viewId){
			this.set('currentViewId', viewId);
			
		},

		_updateViews: function() {
	      var nodes = Polymer.dom(this).queryDistributedElements('*');
	      this._setViews(nodes);
	    },

	    _currentViewIdChanged: function(e){
	    	var self = this;	    	
			if(this.views.length === 0) this._updateViews();
	    	Array.prototype.forEach.call(this.views, function(view){
	    		var isDisplayedView = (view.id === e) ? true : false;
	    		self.toggleClass('displayed-view', isDisplayedView, view);
	    		if(isDisplayedView && self.smallScreenWidth) {
	    			self._setCurrentView(view);
	    			self.fire("responsive-layout-switch-view-display", {currentView: view, index: self.views.indexOf(view)});
	    		}
	    	});
	    },
	    /**
 		  * Switches to a view based on the given `index`.
 		  * 
		  * @param {Number} index The index of the child component to display. 
		  *
 		  **/
	    switchToViewIndex: function(index){
	    	this.set('currentViewId', this.views[index].id);
	    }

	});
</script><script>
	TriValidationBehavior = {

		_isValidString: function(stringValue) {
			return !!stringValue && stringValue !== null && stringValue !== undefined;
		},

		_isValidSelectInputOption: function(selectInputOption) {
			// empty select input options are usually defaulted to { id: null, value: null }
			return selectInputOption && this._isValidString(selectInputOption.id) && this._isValidString(selectInputOption.value);
		},

	};
</script><dom-module id="iron-label" assetpath="../iron-label/">
  <script>
    Polymer.IronLabel = Polymer({
      is: 'iron-label',

      listeners: {
        'tap': '_tapHandler'
      },

      properties: {
        /**
          * An ID reference to another element that needs to be
          * labelled by this `iron-label` element.
          */
        for: {
          type: String,
          value: '',
          reflectToAttribute: true,
          observer: '_forChanged'
        },
        /**
         * @type {Element}
         */
        _forElement: Object
      },

      attached: function() {
        this._forChanged();
      },

      ready: function() {
        this._generateLabelId();
      },

      // generate a unique id for this element
      _generateLabelId: function() {
        if (!this.id) {
          var id = 'iron-label-' + Polymer.IronLabel._labelNumber++;
          Polymer.dom(this).setAttribute('id', id);
        }
      },

      _findTarget: function() {
        if (this.for) {
          // external target
          var scope = Polymer.dom(this).getOwnerRoot();
          return Polymer.dom(scope).querySelector('#' + this.for);
        } else {
          // explicit internal target
          var el = Polymer.dom(this).querySelector('[iron-label-target]');
          if (!el) {
            // implicit internal target
            el = Polymer.dom(this).firstElementChild;
          }
          return el;
        }
      },

      _tapHandler: function(ev) {
        if (!this._forElement) {
          return;
        }
        var target = Polymer.dom(ev).localTarget;
        if (target === this._forElement) {
          return;
        }
        this._forElement.focus();
        this._forElement.click();
      },

      _applyLabelledBy: function() {
        if (this._forElement) {
          Polymer.dom(this._forElement).setAttribute('aria-labelledby', this.id);
        }
      },

      _forChanged: function() {
        if (this._forElement) {
          Polymer.dom(this._forElement).removeAttribute('aria-labelledby');
        }
        this._forElement = this._findTarget();
        this._applyLabelledBy();
      }
    });

    // global counter for unique label ids
    Polymer.IronLabel._labelNumber = 0;
  </script>
</dom-module>




<script>
  Polymer({
    is: 'paper-menu-grow-height-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;
      var rect = node.getBoundingClientRect();
      var height = rect.height;

      this._effect = new KeyframeEffect(node, [{
        height: (height / 2) + 'px'
      }, {
        height: height + 'px'
      }], this.timingFromConfig(config));

      return this._effect;
    }
  });

  Polymer({
    is: 'paper-menu-grow-width-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;
      var rect = node.getBoundingClientRect();
      var width = rect.width;

      this._effect = new KeyframeEffect(node, [{
        width: (width / 2) + 'px'
      }, {
        width: width + 'px'
      }], this.timingFromConfig(config));

      return this._effect;
    }
  });

  Polymer({
    is: 'paper-menu-shrink-width-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;
      var rect = node.getBoundingClientRect();
      var width = rect.width;

      this._effect = new KeyframeEffect(node, [{
        width: width + 'px'
      }, {
        width: width - (width / 20) + 'px'
      }], this.timingFromConfig(config));

      return this._effect;
    }
  });

  Polymer({
    is: 'paper-menu-shrink-height-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;
      var rect = node.getBoundingClientRect();
      var height = rect.height;
      var top = rect.top;

      this.setPrefixedProperty(node, 'transformOrigin', '0 0');

      this._effect = new KeyframeEffect(node, [{
        height: height + 'px',
        transform: 'translateY(0)'
      }, {
        height: height / 2 + 'px',
        transform: 'translateY(-20px)'
      }], this.timingFromConfig(config));

      return this._effect;
    }
  });
</script><dom-module id="paper-menu-button" assetpath="../paper-menu-button/">
  <template>
    <style>
      :host {
        display: inline-block;
        position: relative;
        padding: 8px;
        outline: none;

        @apply(--paper-menu-button);
      }

      :host([disabled]) {
        cursor: auto;
        color: var(--disabled-text-color);

        @apply(--paper-menu-button-disabled);
      }

      iron-dropdown {
        @apply(--paper-menu-button-dropdown);
      }

      .dropdown-content {
        @apply(--shadow-elevation-2dp);

        position: relative;
        border-radius: 2px;
        background-color: var(--paper-menu-button-dropdown-background, --primary-background-color);

        @apply(--paper-menu-button-content);
      }

      :host([vertical-align="top"]) .dropdown-content {
        margin-bottom: 20px;
        margin-top: -10px;
        top: 10px;
      }

      :host([vertical-align="bottom"]) .dropdown-content {
        bottom: 10px;
        margin-bottom: -10px;
        margin-top: 20px;
      }
      
      #trigger {
        cursor: pointer;
      }
    </style>

    <div id="trigger" on-tap="toggle">
      <content select=".dropdown-trigger"></content>
    </div>

    <iron-dropdown id="dropdown" opened="{{opened}}" horizontal-align="[[horizontalAlign]]" vertical-align="[[verticalAlign]]" dynamic-align="[[dynamicAlign]]" horizontal-offset="[[horizontalOffset]]" vertical-offset="[[verticalOffset]]" no-overlap="[[noOverlap]]" open-animation-config="[[openAnimationConfig]]" close-animation-config="[[closeAnimationConfig]]" no-animations="[[noAnimations]]" focus-target="[[_dropdownContent]]" allow-outside-scroll="[[allowOutsideScroll]]" restore-focus-on-close="[[restoreFocusOnClose]]" on-iron-overlay-canceled="__onIronOverlayCanceled">
      <div class="dropdown-content">
        <content id="content" select=".dropdown-content"></content>
      </div>
    </iron-dropdown>
  </template>

  <script>
    (function() {
      'use strict';

      var config = {
        ANIMATION_CUBIC_BEZIER: 'cubic-bezier(.3,.95,.5,1)',
        MAX_ANIMATION_TIME_MS: 400
      };

      var PaperMenuButton = Polymer({
        is: 'paper-menu-button',

        /**
         * Fired when the dropdown opens.
         *
         * @event paper-dropdown-open
         */

        /**
         * Fired when the dropdown closes.
         *
         * @event paper-dropdown-close
         */

        behaviors: [
          Polymer.IronA11yKeysBehavior,
          Polymer.IronControlState
        ],

        properties: {
          /**
           * True if the content is currently displayed.
           */
          opened: {
            type: Boolean,
            value: false,
            notify: true,
            observer: '_openedChanged'
          },

          /**
           * The orientation against which to align the menu dropdown
           * horizontally relative to the dropdown trigger.
           */
          horizontalAlign: {
            type: String,
            value: 'left',
            reflectToAttribute: true
          },

          /**
           * The orientation against which to align the menu dropdown
           * vertically relative to the dropdown trigger.
           */
          verticalAlign: {
            type: String,
            value: 'top',
            reflectToAttribute: true
          },

          /**
           * If true, the `horizontalAlign` and `verticalAlign` properties will
           * be considered preferences instead of strict requirements when
           * positioning the dropdown and may be changed if doing so reduces
           * the area of the dropdown falling outside of `fitInto`.
           */
          dynamicAlign: {
            type: Boolean
          },

          /**
           * A pixel value that will be added to the position calculated for the
           * given `horizontalAlign`. Use a negative value to offset to the
           * left, or a positive value to offset to the right.
           */
          horizontalOffset: {
            type: Number,
            value: 0,
            notify: true
          },

          /**
           * A pixel value that will be added to the position calculated for the
           * given `verticalAlign`. Use a negative value to offset towards the
           * top, or a positive value to offset towards the bottom.
           */
          verticalOffset: {
            type: Number,
            value: 0,
            notify: true
          },

          /**
           * If true, the dropdown will be positioned so that it doesn't overlap
           * the button.
           */
          noOverlap: {
            type: Boolean
          },

          /**
           * Set to true to disable animations when opening and closing the
           * dropdown.
           */
          noAnimations: {
            type: Boolean,
            value: false
          },

          /**
           * Set to true to disable automatically closing the dropdown after
           * a selection has been made.
           */
          ignoreSelect: {
            type: Boolean,
            value: false
          },

          /**
           * Set to true to enable automatically closing the dropdown after an
           * item has been activated, even if the selection did not change.
           */
          closeOnActivate: {
            type: Boolean,
            value: false
          },

          /**
           * An animation config. If provided, this will be used to animate the
           * opening of the dropdown.
           */
          openAnimationConfig: {
            type: Object,
            value: function() {
              return [{
                name: 'fade-in-animation',
                timing: {
                  delay: 100,
                  duration: 200
                }
              }, {
                name: 'paper-menu-grow-width-animation',
                timing: {
                  delay: 100,
                  duration: 150,
                  easing: config.ANIMATION_CUBIC_BEZIER
                }
              }, {
                name: 'paper-menu-grow-height-animation',
                timing: {
                  delay: 100,
                  duration: 275,
                  easing: config.ANIMATION_CUBIC_BEZIER
                }
              }];
            }
          },

          /**
           * An animation config. If provided, this will be used to animate the
           * closing of the dropdown.
           */
          closeAnimationConfig: {
            type: Object,
            value: function() {
              return [{
                name: 'fade-out-animation',
                timing: {
                  duration: 150
                }
              }, {
                name: 'paper-menu-shrink-width-animation',
                timing: {
                  delay: 100,
                  duration: 50,
                  easing: config.ANIMATION_CUBIC_BEZIER
                }
              }, {
                name: 'paper-menu-shrink-height-animation',
                timing: {
                  duration: 200,
                  easing: 'ease-in'
                }
              }];
            }
          },

          /**
           * By default, the dropdown will constrain scrolling on the page
           * to itself when opened.
           * Set to true in order to prevent scroll from being constrained
           * to the dropdown when it opens.
           */
          allowOutsideScroll: {
            type: Boolean,
            value: false
          },

          /**
           * Whether focus should be restored to the button when the menu closes.
           */
          restoreFocusOnClose: {
            type: Boolean,
            value: true
          },

          /**
           * This is the element intended to be bound as the focus target
           * for the `iron-dropdown` contained by `paper-menu-button`.
           */
          _dropdownContent: {
            type: Object
          }
        },

        hostAttributes: {
          role: 'group',
          'aria-haspopup': 'true'
        },

        listeners: {
          'iron-activate': '_onIronActivate',
          'iron-select': '_onIronSelect'
        },

        /**
         * The content element that is contained by the menu button, if any.
         */
        get contentElement() {
          return Polymer.dom(this.$.content).getDistributedNodes()[0];
        },

        /**
         * Toggles the drowpdown content between opened and closed.
         */
        toggle: function() {
          if (this.opened) {
            this.close();
          } else {
            this.open();
          }
        },

        /**
         * Make the dropdown content appear as an overlay positioned relative
         * to the dropdown trigger.
         */
        open: function() {
          if (this.disabled) {
            return;
          }

          this.$.dropdown.open();
        },

        /**
         * Hide the dropdown content.
         */
        close: function() {
          this.$.dropdown.close();
        },

        /**
         * When an `iron-select` event is received, the dropdown should
         * automatically close on the assumption that a value has been chosen.
         *
         * @param {CustomEvent} event A CustomEvent instance with type
         * set to `"iron-select"`.
         */
        _onIronSelect: function(event) {
          if (!this.ignoreSelect) {
            this.close();
          }
        },

        /**
         * Closes the dropdown when an `iron-activate` event is received if
         * `closeOnActivate` is true.
         *
         * @param {CustomEvent} event A CustomEvent of type 'iron-activate'.
         */
        _onIronActivate: function(event) {
          if (this.closeOnActivate) {
            this.close();
          }
        },

        /**
         * When the dropdown opens, the `paper-menu-button` fires `paper-open`.
         * When the dropdown closes, the `paper-menu-button` fires `paper-close`.
         *
         * @param {boolean} opened True if the dropdown is opened, otherwise false.
         * @param {boolean} oldOpened The previous value of `opened`.
         */
        _openedChanged: function(opened, oldOpened) {
          if (opened) {
            // TODO(cdata): Update this when we can measure changes in distributed
            // children in an idiomatic way.
            // We poke this property in case the element has changed. This will
            // cause the focus target for the `iron-dropdown` to be updated as
            // necessary:
            this._dropdownContent = this.contentElement;
            this.fire('paper-dropdown-open');
          } else if (oldOpened != null) {
            this.fire('paper-dropdown-close');
          }
        },

        /**
         * If the dropdown is open when disabled becomes true, close the
         * dropdown.
         *
         * @param {boolean} disabled True if disabled, otherwise false.
         */
        _disabledChanged: function(disabled) {
          Polymer.IronControlState._disabledChanged.apply(this, arguments);
          if (disabled && this.opened) {
            this.close();
          }
        },

        __onIronOverlayCanceled: function(event) {
          var uiEvent = event.detail;
          var target = Polymer.dom(uiEvent).rootTarget;
          var trigger = this.$.trigger;
          var path = Polymer.dom(uiEvent).path;

          if (path.indexOf(trigger) > -1) {
            event.preventDefault();
          }
        }
      });

      Object.keys(config).forEach(function (key) {
        PaperMenuButton[key] = config[key];
      });

      Polymer.PaperMenuButton = PaperMenuButton;
    })();
  </script>
</dom-module>
<iron-iconset-svg name="paper-dropdown-menu" size="24">
<svg><defs>
<g id="arrow-drop-down"><path d="M7 10l5 5 5-5z"></path></g>
</defs></svg>
</iron-iconset-svg>
<dom-module id="paper-dropdown-menu-shared-styles" assetpath="../paper-dropdown-menu/">
  <template>
    <style>
      :host {
        display: inline-block;
        position: relative;
        text-align: left;

        /* NOTE(cdata): Both values are needed, since some phones require the
         * value to be `transparent`.
         */
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        -webkit-tap-highlight-color: transparent;

        --paper-input-container-input: {
          overflow: hidden;
          white-space: nowrap;
          text-overflow: ellipsis;
          max-width: 100%;
          box-sizing: border-box;
          cursor: pointer;
        };

        @apply(--paper-dropdown-menu);
      }

      :host([disabled]) {
        @apply(--paper-dropdown-menu-disabled);
      }

      :host([noink]) paper-ripple {
        display: none;
      }

      :host([no-label-float]) paper-ripple {
        top: 8px;
      }

      paper-ripple {
        top: 12px;
        left: 0px;
        bottom: 8px;
        right: 0px;

        @apply(--paper-dropdown-menu-ripple);
      }

      paper-menu-button {
        display: block;
        padding: 0;

        @apply(--paper-dropdown-menu-button);
      }

      paper-input {
        @apply(--paper-dropdown-menu-input);
      }

      iron-icon {
        color: var(--disabled-text-color);

        @apply(--paper-dropdown-menu-icon);
      }
    </style>
  </template>
</dom-module>
<dom-module id="paper-dropdown-menu" assetpath="../paper-dropdown-menu/">
  <template>
    <style include="paper-dropdown-menu-shared-styles"></style>

    
    <span role="button"></span>
    <paper-menu-button id="menuButton" vertical-align="[[verticalAlign]]" horizontal-align="[[horizontalAlign]]" dynamic-align="[[dynamicAlign]]" vertical-offset="[[_computeMenuVerticalOffset(noLabelFloat)]]" disabled="[[disabled]]" no-animations="[[noAnimations]]" on-iron-select="_onIronSelect" on-iron-deselect="_onIronDeselect" opened="{{opened}}" close-on-activate="" allow-outside-scroll="[[allowOutsideScroll]]">
      <div class="dropdown-trigger">
        <paper-ripple></paper-ripple>
        
        <paper-input type="text" invalid="[[invalid]]" readonly="" disabled="[[disabled]]" value="[[selectedItemLabel]]" placeholder="[[placeholder]]" error-message="[[errorMessage]]" always-float-label="[[alwaysFloatLabel]]" no-label-float="[[noLabelFloat]]" label="[[label]]">
          <iron-icon icon="paper-dropdown-menu:arrow-drop-down" suffix=""></iron-icon>
        </paper-input>
      </div>
      <content id="content" select=".dropdown-content"></content>
    </paper-menu-button>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'paper-dropdown-menu',

        behaviors: [
          Polymer.IronButtonState,
          Polymer.IronControlState,
          Polymer.IronFormElementBehavior,
          Polymer.IronValidatableBehavior
        ],

        properties: {
          /**
           * The derived "label" of the currently selected item. This value
           * is the `label` property on the selected item if set, or else the
           * trimmed text content of the selected item.
           */
          selectedItemLabel: {
            type: String,
            notify: true,
            readOnly: true
          },

          /**
           * The last selected item. An item is selected if the dropdown menu has
           * a child with class `dropdown-content`, and that child triggers an
           * `iron-select` event with the selected `item` in the `detail`.
           *
           * @type {?Object}
           */
          selectedItem: {
            type: Object,
            notify: true,
            readOnly: true
          },

          /**
           * The value for this element that will be used when submitting in
           * a form. It is read only, and will always have the same value
           * as `selectedItemLabel`.
           */
          value: {
            type: String,
            notify: true,
            readOnly: true
          },

          /**
           * The label for the dropdown.
           */
          label: {
            type: String
          },

          /**
           * The placeholder for the dropdown.
           */
          placeholder: {
            type: String
          },

          /**
           * The error message to display when invalid.
           */
          errorMessage: {
              type: String
          },

          /**
           * True if the dropdown is open. Otherwise, false.
           */
          opened: {
            type: Boolean,
            notify: true,
            value: false,
            observer: '_openedChanged'
          },

          /**
           * By default, the dropdown will constrain scrolling on the page
           * to itself when opened.
           * Set to true in order to prevent scroll from being constrained
           * to the dropdown when it opens.
           */
          allowOutsideScroll: {
            type: Boolean,
            value: false
          },

          /**
           * Set to true to disable the floating label. Bind this to the
           * `<paper-input-container>`'s `noLabelFloat` property.
           */
          noLabelFloat: {
              type: Boolean,
              value: false,
              reflectToAttribute: true
          },

          /**
           * Set to true to always float the label. Bind this to the
           * `<paper-input-container>`'s `alwaysFloatLabel` property.
           */
          alwaysFloatLabel: {
            type: Boolean,
            value: false
          },

          /**
           * Set to true to disable animations when opening and closing the
           * dropdown.
           */
          noAnimations: {
            type: Boolean,
            value: false
          },

          /**
           * The orientation against which to align the menu dropdown
           * horizontally relative to the dropdown trigger.
           */
          horizontalAlign: {
            type: String,
            value: 'right'
          },

          /**
           * The orientation against which to align the menu dropdown
           * vertically relative to the dropdown trigger.
           */
          verticalAlign: {
            type: String,
            value: 'top'
          },

          /**
           * If true, the `horizontalAlign` and `verticalAlign` properties will
           * be considered preferences instead of strict requirements when
           * positioning the dropdown and may be changed if doing so reduces
           * the area of the dropdown falling outside of `fitInto`.
           */
          dynamicAlign: {
            type: Boolean
          },
        },

        listeners: {
          'tap': '_onTap'
        },

        keyBindings: {
          'up down': 'open',
          'esc': 'close'
        },

        hostAttributes: {
          role: 'combobox',
          'aria-autocomplete': 'none',
          'aria-haspopup': 'true'
        },

        observers: [
          '_selectedItemChanged(selectedItem)'
        ],

        attached: function() {
          // NOTE(cdata): Due to timing, a preselected value in a `IronSelectable`
          // child will cause an `iron-select` event to fire while the element is
          // still in a `DocumentFragment`. This has the effect of causing
          // handlers not to fire. So, we double check this value on attached:
          var contentElement = this.contentElement;
          if (contentElement && contentElement.selectedItem) {
            this._setSelectedItem(contentElement.selectedItem);
          }
        },

        /**
         * The content element that is contained by the dropdown menu, if any.
         */
        get contentElement() {
          return Polymer.dom(this.$.content).getDistributedNodes()[0];
        },

        /**
         * Show the dropdown content.
         */
        open: function() {
          this.$.menuButton.open();
        },

        /**
         * Hide the dropdown content.
         */
        close: function() {
          this.$.menuButton.close();
        },

        /**
         * A handler that is called when `iron-select` is fired.
         *
         * @param {CustomEvent} event An `iron-select` event.
         */
        _onIronSelect: function(event) {
          this._setSelectedItem(event.detail.item);
        },

        /**
         * A handler that is called when `iron-deselect` is fired.
         *
         * @param {CustomEvent} event An `iron-deselect` event.
         */
        _onIronDeselect: function(event) {
          this._setSelectedItem(null);
        },

        /**
         * A handler that is called when the dropdown is tapped.
         *
         * @param {CustomEvent} event A tap event.
         */
        _onTap: function(event) {
          if (Polymer.Gestures.findOriginalTarget(event) === this) {
            this.open();
          }
        },

        /**
         * Compute the label for the dropdown given a selected item.
         *
         * @param {Element} selectedItem A selected Element item, with an
         * optional `label` property.
         */
        _selectedItemChanged: function(selectedItem) {
          var value = '';
          if (!selectedItem) {
            value = '';
          } else {
            value = selectedItem.label || selectedItem.getAttribute('label') || selectedItem.textContent.trim();
          }

          this._setValue(value);
          this._setSelectedItemLabel(value);
        },

        /**
         * Compute the vertical offset of the menu based on the value of
         * `noLabelFloat`.
         *
         * @param {boolean} noLabelFloat True if the label should not float
         * above the input, otherwise false.
         */
        _computeMenuVerticalOffset: function(noLabelFloat) {
          // NOTE(cdata): These numbers are somewhat magical because they are
          // derived from the metrics of elements internal to `paper-input`'s
          // template. The metrics will change depending on whether or not the
          // input has a floating label.
          return noLabelFloat ? -4 : 8;
        },

        /**
         * Returns false if the element is required and does not have a selection,
         * and true otherwise.
         * @param {*=} _value Ignored.
         * @return {boolean} true if `required` is false, or if `required` is true
         * and the element has a valid selection.
         */
        _getValidity: function(_value) {
          return this.disabled || !this.required || (this.required && !!this.value);
        },

        _openedChanged: function() {
          var openState = this.opened ? 'true' : 'false';
          var e = this.contentElement;
          if (e) {
            e.setAttribute('aria-expanded', openState);
          }
        }
      });
    })();
  </script>
</dom-module>


<dom-module id="paper-listbox" assetpath="../paper-listbox/">
  <template>
    <style>
      :host {
        display: block;
        padding: 8px 0;

        background: var(--paper-listbox-background-color, --primary-background-color);
        color: var(--paper-listbox-color, --primary-text-color);

        @apply(--paper-listbox);
      }
    </style>

    <content></content>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'paper-listbox',

        behaviors: [
          Polymer.IronMenuBehavior
        ],

        hostAttributes: {
          role: 'listbox'
        }
      });
    })();
  </script>
</dom-module>



<script>

  /**
   * `Polymer.IronScrollTargetBehavior` allows an element to respond to scroll events from a
   * designated scroll target.
   *
   * Elements that consume this behavior can override the `_scrollHandler`
   * method to add logic on the scroll event.
   *
   * @demo demo/scrolling-region.html Scrolling Region
   * @demo demo/document.html Document Element
   * @polymerBehavior
   */
  Polymer.IronScrollTargetBehavior = {

    properties: {

      /**
       * Specifies the element that will handle the scroll event
       * on the behalf of the current element. This is typically a reference to an element,
       * but there are a few more posibilities:
       *
       * ### Elements id
       *
       *```html
       * <div id="scrollable-element" style="overflow: auto;">
       *  <x-element scroll-target="scrollable-element">
       *    <!-- Content-->
       *  </x-element>
       * </div>
       *```
       * In this case, the `scrollTarget` will point to the outer div element.
       *
       * ### Document scrolling
       *
       * For document scrolling, you can use the reserved word `document`:
       *
       *```html
       * <x-element scroll-target="document">
       *   <!-- Content -->
       * </x-element>
       *```
       *
       * ### Elements reference
       *
       *```js
       * appHeader.scrollTarget = document.querySelector('#scrollable-element');
       *```
       *
       * @type {HTMLElement}
       */
      scrollTarget: {
        type: HTMLElement,
        value: function() {
          return this._defaultScrollTarget;
        }
      }
    },

    observers: [
      '_scrollTargetChanged(scrollTarget, isAttached)'
    ],

    /**
     * True if the event listener should be installed.
     */
    _shouldHaveListener: true,

    _scrollTargetChanged: function(scrollTarget, isAttached) {
      var eventTarget;

      if (this._oldScrollTarget) {
        this._toggleScrollListener(false, this._oldScrollTarget);
        this._oldScrollTarget = null;
      }
      if (!isAttached) {
        return;
      }
      // Support element id references
      if (scrollTarget === 'document') {

        this.scrollTarget = this._doc;

      } else if (typeof scrollTarget === 'string') {

        this.scrollTarget = this.domHost ? this.domHost.$[scrollTarget] :
            Polymer.dom(this.ownerDocument).querySelector('#' + scrollTarget);

      } else if (this._isValidScrollTarget()) {

        this._boundScrollHandler = this._boundScrollHandler || this._scrollHandler.bind(this);
        this._oldScrollTarget = scrollTarget;
        this._toggleScrollListener(this._shouldHaveListener, scrollTarget);

      }
    },

    /**
     * Runs on every scroll event. Consumer of this behavior may override this method.
     *
     * @protected
     */
    _scrollHandler: function scrollHandler() {},

    /**
     * The default scroll target. Consumers of this behavior may want to customize
     * the default scroll target.
     *
     * @type {Element}
     */
    get _defaultScrollTarget() {
      return this._doc;
    },

    /**
     * Shortcut for the document element
     *
     * @type {Element}
     */
    get _doc() {
      return this.ownerDocument.documentElement;
    },

    /**
     * Gets the number of pixels that the content of an element is scrolled upward.
     *
     * @type {number}
     */
    get _scrollTop() {
      if (this._isValidScrollTarget()) {
        return this.scrollTarget === this._doc ? window.pageYOffset : this.scrollTarget.scrollTop;
      }
      return 0;
    },

    /**
     * Gets the number of pixels that the content of an element is scrolled to the left.
     *
     * @type {number}
     */
    get _scrollLeft() {
      if (this._isValidScrollTarget()) {
        return this.scrollTarget === this._doc ? window.pageXOffset : this.scrollTarget.scrollLeft;
      }
      return 0;
    },

    /**
     * Sets the number of pixels that the content of an element is scrolled upward.
     *
     * @type {number}
     */
    set _scrollTop(top) {
      if (this.scrollTarget === this._doc) {
        window.scrollTo(window.pageXOffset, top);
      } else if (this._isValidScrollTarget()) {
        this.scrollTarget.scrollTop = top;
      }
    },

    /**
     * Sets the number of pixels that the content of an element is scrolled to the left.
     *
     * @type {number}
     */
    set _scrollLeft(left) {
      if (this.scrollTarget === this._doc) {
        window.scrollTo(left, window.pageYOffset);
      } else if (this._isValidScrollTarget()) {
        this.scrollTarget.scrollLeft = left;
      }
    },

    /**
     * Scrolls the content to a particular place.
     *
     * @method scroll
     * @param {number} left The left position
     * @param {number} top The top position
     */
    scroll: function(left, top) {
       if (this.scrollTarget === this._doc) {
        window.scrollTo(left, top);
      } else if (this._isValidScrollTarget()) {
        this.scrollTarget.scrollLeft = left;
        this.scrollTarget.scrollTop = top;
      }
    },

    /**
     * Gets the width of the scroll target.
     *
     * @type {number}
     */
    get _scrollTargetWidth() {
      if (this._isValidScrollTarget()) {
        return this.scrollTarget === this._doc ? window.innerWidth : this.scrollTarget.offsetWidth;
      }
      return 0;
    },

    /**
     * Gets the height of the scroll target.
     *
     * @type {number}
     */
    get _scrollTargetHeight() {
      if (this._isValidScrollTarget()) {
        return this.scrollTarget === this._doc ? window.innerHeight : this.scrollTarget.offsetHeight;
      }
      return 0;
    },

    /**
     * Returns true if the scroll target is a valid HTMLElement.
     *
     * @return {boolean}
     */
    _isValidScrollTarget: function() {
      return this.scrollTarget instanceof HTMLElement;
    },

    _toggleScrollListener: function(yes, scrollTarget) {
      if (!this._boundScrollHandler) {
        return;
      }
      var eventTarget = scrollTarget === this._doc ? window : scrollTarget;

      if (yes) {
        eventTarget.addEventListener('scroll', this._boundScrollHandler);
      } else {
        eventTarget.removeEventListener('scroll', this._boundScrollHandler);
      }
    },

    /**
     * Enables or disables the scroll event listener.
     *
     * @param {boolean} yes True to add the event, False to remove it.
     */
    toggleScrollListener: function(yes) {
      this._shouldHaveListener = yes;
      this._toggleScrollListener(yes, this.scrollTarget);
    }

  };

</script><dom-module id="iron-list" assetpath="../iron-list/">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
      }

      @media only screen and (-webkit-max-device-pixel-ratio: 1) {
        :host {
          will-change: transform;
        }
      }

      #items {
        @apply(--iron-list-items-container);
        position: relative;
      }

      :host(:not([grid])) #items > ::content > * {
        width: 100%;
      };

      #items > ::content > * {
        box-sizing: border-box;
        margin: 0;
        position: absolute;
        top: 0;
        will-change: transform;
      }
    </style>

    <array-selector id="selector" items="{{items}}" selected="{{selectedItems}}" selected-item="{{selectedItem}}">
    </array-selector>

    <div id="items">
      <content></content>
    </div>

  </template>
</dom-module>

<script>

(function() {

  var IOS = navigator.userAgent.match(/iP(?:hone|ad;(?: U;)? CPU) OS (\d+)/);
  var IOS_TOUCH_SCROLLING = IOS && IOS[1] >= 8;
  var DEFAULT_PHYSICAL_COUNT = 3;
  var HIDDEN_Y = '-10000px';
  var ITEM_WIDTH = 0;
  var ITEM_HEIGHT = 1;
  var SECRET_TABINDEX = -100;

  Polymer({

    is: 'iron-list',

    properties: {

      /**
       * An array containing items determining how many instances of the template
       * to stamp and that that each template instance should bind to.
       */
      items: {
        type: Array
      },

      /**
       * The max count of physical items the pool can extend to.
       */
      maxPhysicalCount: {
        type: Number,
        value: 500
      },

      /**
       * The name of the variable to add to the binding scope for the array
       * element associated with a given template instance.
       */
      as: {
        type: String,
        value: 'item'
      },

      /**
       * The name of the variable to add to the binding scope with the index
       * for the row.
       */
      indexAs: {
        type: String,
        value: 'index'
      },

      /**
       * The name of the variable to add to the binding scope to indicate
       * if the row is selected.
       */
      selectedAs: {
        type: String,
        value: 'selected'
      },

      /**
       * When true, the list is rendered as a grid. Grid items must have
       * fixed width and height set via CSS. e.g.
       *
       * ```html
       * <iron-list grid>
       *   <template>
       *      <div style="width: 100px; height: 100px;"> 100x100 </div>
       *   </template>
       * </iron-list>
       * ```
       */
      grid: {
        type: Boolean,
        value: false,
        reflectToAttribute: true
      },

      /**
       * When true, tapping a row will select the item, placing its data model
       * in the set of selected items retrievable via the selection property.
       *
       * Note that tapping focusable elements within the list item will not
       * result in selection, since they are presumed to have their * own action.
       */
      selectionEnabled: {
        type: Boolean,
        value: false
      },

      /**
       * When `multiSelection` is false, this is the currently selected item, or `null`
       * if no item is selected.
       */
      selectedItem: {
        type: Object,
        notify: true
      },

      /**
       * When `multiSelection` is true, this is an array that contains the selected items.
       */
      selectedItems: {
        type: Object,
        notify: true
      },

      /**
       * When `true`, multiple items may be selected at once (in this case,
       * `selected` is an array of currently selected items).  When `false`,
       * only one item may be selected at a time.
       */
      multiSelection: {
        type: Boolean,
        value: false
      }
    },

    observers: [
      '_itemsChanged(items.*)',
      '_selectionEnabledChanged(selectionEnabled)',
      '_multiSelectionChanged(multiSelection)',
      '_setOverflow(scrollTarget)'
    ],

    behaviors: [
      Polymer.Templatizer,
      Polymer.IronResizableBehavior,
      Polymer.IronA11yKeysBehavior,
      Polymer.IronScrollTargetBehavior
    ],

    keyBindings: {
      'up': '_didMoveUp',
      'down': '_didMoveDown',
      'enter': '_didEnter'
    },

    /**
     * The ratio of hidden tiles that should remain in the scroll direction.
     * Recommended value ~0.5, so it will distribute tiles evely in both directions.
     */
    _ratio: 0.5,

    /**
     * The padding-top value for the list.
     */
    _scrollerPaddingTop: 0,

    /**
     * This value is the same as `scrollTop`.
     */
    _scrollPosition: 0,

    /**
     * The sum of the heights of all the tiles in the DOM.
     */
    _physicalSize: 0,

    /**
     * The average `offsetHeight` of the tiles observed till now.
     */
    _physicalAverage: 0,

    /**
     * The number of tiles which `offsetHeight` > 0 observed until now.
     */
    _physicalAverageCount: 0,

    /**
     * The Y position of the item rendered in the `_physicalStart`
     * tile relative to the scrolling list.
     */
    _physicalTop: 0,

    /**
     * The number of items in the list.
     */
    _virtualCount: 0,

    /**
     * A map between an item key and its physical item index
     */
    _physicalIndexForKey: null,

    /**
     * The estimated scroll height based on `_physicalAverage`
     */
    _estScrollHeight: 0,

    /**
     * The scroll height of the dom node
     */
    _scrollHeight: 0,

    /**
     * The height of the list. This is referred as the viewport in the context of list.
     */
    _viewportHeight: 0,

    /**
     * The width of the list. This is referred as the viewport in the context of list.
     */
    _viewportWidth: 0,

    /**
     * An array of DOM nodes that are currently in the tree
     * @type {?Array<!TemplatizerNode>}
     */
    _physicalItems: null,

    /**
     * An array of heights for each item in `_physicalItems`
     * @type {?Array<number>}
     */
    _physicalSizes: null,

    /**
     * A cached value for the first visible index.
     * See `firstVisibleIndex`
     * @type {?number}
     */
    _firstVisibleIndexVal: null,

    /**
     * A cached value for the last visible index.
     * See `lastVisibleIndex`
     * @type {?number}
     */
    _lastVisibleIndexVal: null,

    /**
     * A Polymer collection for the items.
     * @type {?Polymer.Collection}
     */
    _collection: null,

    /**
     * The max number of pages to render. One page is equivalent to the height of the list.
     */
    _maxPages: 2,

    /**
     * The currently focused physical item.
     */
    _focusedItem: null,

    /**
     * The index of the `_focusedItem`.
     */
    _focusedIndex: -1,

    /**
     * The the item that is focused if it is moved offscreen.
     * @private {?TemplatizerNode}
     */
    _offscreenFocusedItem: null,

    /**
     * The item that backfills the `_offscreenFocusedItem` in the physical items
     * list when that item is moved offscreen.
     */
    _focusBackfillItem: null,

    /**
     * The maximum items per row
     */
    _itemsPerRow: 1,

    /**
     * The width of each grid item
     */
    _itemWidth: 0,

    /**
     * The height of the row in grid layout.
     */
    _rowHeight: 0,

    /**
     * The cost of stamping a template in ms.
     */
    _templateCost: 0,

    /**
     * The bottom of the physical content.
     */
    get _physicalBottom() {
      return this._physicalTop + this._physicalSize;
    },

    /**
     * The bottom of the scroll.
     */
    get _scrollBottom() {
      return this._scrollPosition + this._viewportHeight;
    },

    /**
     * The n-th item rendered in the last physical item.
     */
    get _virtualEnd() {
      return this._virtualStart + this._physicalCount - 1;
    },

    /**
     * The height of the physical content that isn't on the screen.
     */
    get _hiddenContentSize() {
      var size = this.grid ? this._physicalRows * this._rowHeight : this._physicalSize;
      return size - this._viewportHeight;
    },

    /**
     * The maximum scroll top value.
     */
    get _maxScrollTop() {
      return this._estScrollHeight - this._viewportHeight + this._scrollerPaddingTop;
    },

    /**
     * The lowest n-th value for an item such that it can be rendered in `_physicalStart`.
     */
    _minVirtualStart: 0,

    /**
     * The largest n-th value for an item such that it can be rendered in `_physicalStart`.
     */
    get _maxVirtualStart() {
      return Math.max(0, this._virtualCount - this._physicalCount);
    },

    /**
     * The n-th item rendered in the `_physicalStart` tile.
     */
    _virtualStartVal: 0,

    set _virtualStart(val) {
      this._virtualStartVal = Math.min(this._maxVirtualStart, Math.max(this._minVirtualStart, val));
    },

    get _virtualStart() {
      return this._virtualStartVal || 0;
    },

    /**
     * The k-th tile that is at the top of the scrolling list.
     */
    _physicalStartVal: 0,

    set _physicalStart(val) {
      this._physicalStartVal = val % this._physicalCount;
      if (this._physicalStartVal < 0) {
        this._physicalStartVal = this._physicalCount + this._physicalStartVal;
      }
      this._physicalEnd = (this._physicalStart + this._physicalCount - 1) % this._physicalCount;
    },

    get _physicalStart() {
      return this._physicalStartVal || 0;
    },

    /**
     * The number of tiles in the DOM.
     */
    _physicalCountVal: 0,

    set _physicalCount(val) {
      this._physicalCountVal = val;
      this._physicalEnd = (this._physicalStart + this._physicalCount - 1) % this._physicalCount;
    },

    get _physicalCount() {
      return this._physicalCountVal;
    },

    /**
     * The k-th tile that is at the bottom of the scrolling list.
     */
    _physicalEnd: 0,

    /**
     * An optimal physical size such that we will have enough physical items
     * to fill up the viewport and recycle when the user scrolls.
     *
     * This default value assumes that we will at least have the equivalent
     * to a viewport of physical items above and below the user's viewport.
     */
    get _optPhysicalSize() {
      if (this.grid) {
        return this._estRowsInView * this._rowHeight * this._maxPages;
      }
      return this._viewportHeight * this._maxPages;
    },

   /**
    * True if the current list is visible.
    */
    get _isVisible() {
      return Boolean(this.offsetWidth || this.offsetHeight);
    },

    /**
     * Gets the index of the first visible item in the viewport.
     *
     * @type {number}
     */
    get firstVisibleIndex() {
      if (this._firstVisibleIndexVal === null) {
        var physicalOffset = Math.floor(this._physicalTop + this._scrollerPaddingTop);

        this._firstVisibleIndexVal = this._iterateItems(
          function(pidx, vidx) {
            physicalOffset += this._getPhysicalSizeIncrement(pidx);

            if (physicalOffset > this._scrollPosition) {
              return this.grid ? vidx - (vidx % this._itemsPerRow) : vidx;
            }
            // Handle a partially rendered final row in grid mode
            if (this.grid && this._virtualCount - 1 === vidx) {
              return vidx - (vidx % this._itemsPerRow);
            }
          }) || 0;
      }
      return this._firstVisibleIndexVal;
    },

    /**
     * Gets the index of the last visible item in the viewport.
     *
     * @type {number}
     */
    get lastVisibleIndex() {
      if (this._lastVisibleIndexVal === null) {
        if (this.grid) {
          var lastIndex = this.firstVisibleIndex + this._estRowsInView * this._itemsPerRow - 1;
          this._lastVisibleIndexVal = Math.min(this._virtualCount, lastIndex);
        } else {
          var physicalOffset = this._physicalTop;
          this._iterateItems(function(pidx, vidx) {
            if (physicalOffset < this._scrollBottom) {
              this._lastVisibleIndexVal = vidx;
            } else {
              // Break _iterateItems
              return true;
            }
            physicalOffset += this._getPhysicalSizeIncrement(pidx);
          });
        }
      }
      return this._lastVisibleIndexVal;
    },

    get _defaultScrollTarget() {
      return this;
    },

    get _virtualRowCount() {
      return Math.ceil(this._virtualCount / this._itemsPerRow);
    },

    get _estRowsInView() {
      return Math.ceil(this._viewportHeight / this._rowHeight);
    },

    get _physicalRows() {
      return Math.ceil(this._physicalCount / this._itemsPerRow);
    },

    ready: function() {
      this.addEventListener('focus', this._didFocus.bind(this), true);
    },

    attached: function() {
      if (this._physicalCount === 0) {
        this._debounceTemplate(this._render);
      }
      // `iron-resize` is fired when the list is attached if the event is added
      // before attached causing unnecessary work.
      this.listen(this, 'iron-resize', '_resizeHandler');
    },

    detached: function() {
      this.unlisten(this, 'iron-resize', '_resizeHandler');
    },

    /**
     * Set the overflow property if this element has its own scrolling region
     */
    _setOverflow: function(scrollTarget) {
      this.style.webkitOverflowScrolling = scrollTarget === this ? 'touch' : '';
      this.style.overflow = scrollTarget === this ? 'auto' : '';
    },

    /**
     * Invoke this method if you dynamically update the viewport's
     * size or CSS padding.
     *
     * @method updateViewportBoundaries
     */
    updateViewportBoundaries: function() {
      this._scrollerPaddingTop = this.scrollTarget === this ? 0 :
          parseInt(window.getComputedStyle(this)['padding-top'], 10);
      this._viewportWidth = this.$.items.offsetWidth;
      this._viewportHeight = this._scrollTargetHeight;
      this.grid && this._updateGridMetrics();
    },

    /**
     * Recycles the physical items when needed.
     */
    _scrollHandler: function() {
      var scrollTop = Math.max(0, Math.min(this._maxScrollTop, this._scrollTop));
      var delta = scrollTop - this._scrollPosition;
      var isScrollingDown = delta >= 0;
      // Track the current scroll position.
      this._scrollPosition = scrollTop;
      // Clear indexes.
      this._firstVisibleIndexVal = null;
      this._lastVisibleIndexVal = null;

      // Random access.
      if (Math.abs(delta) > this._physicalSize) {
        var idxAdjustment =  Math.round(delta / this._physicalAverage) * this._itemsPerRow
        this._physicalTop = this._physicalTop + delta;
        this._virtualStart = this._virtualStart + idxAdjustment;
        this._physicalStart = this._physicalStart + idxAdjustment;
        this._update();
      } else {
        var reusables = this._getReusables(isScrollingDown);
        if (isScrollingDown) {
          this._physicalTop = reusables.physicalTop;
          this._virtualStart = this._virtualStart + reusables.indexes.length;
          this._physicalStart = this._physicalStart + reusables.indexes.length;
        } else {
          this._virtualStart = this._virtualStart - reusables.indexes.length;
          this._physicalStart = this._physicalStart - reusables.indexes.length;
        }
        if (reusables.indexes.length === 0) {
          this._increasePoolIfNeeded();
        } else {
          this._update(reusables.indexes, isScrollingDown ? null : reusables.indexes);
        }
      }
    },

    /**
     * Returns an object that contains the indexes of the physical items
     * that might be reused and the physicalTop.
     *
     * @param {boolean} fromTop If the potential reusable items are above the scrolling region.
     */
    _getReusables: function(fromTop) {
      var ith, lastIth, offsetContent, physicalItemHeight;
      var idxs = [];
      var protectedOffsetContent = this._hiddenContentSize * this._ratio;
      var virtualStart = this._virtualStart;
      var virtualEnd = this._virtualEnd;
      var physicalCount = this._physicalCount;
      var physicalTop = this._physicalTop + this._scrollerPaddingTop;
      var scrollTop = this._scrollTop;
      var scrollBottom = this._scrollBottom;

      if (fromTop) {
        ith = this._physicalStart;
        lastIth = this._physicalEnd;
        offsetContent = scrollTop - physicalTop;
      } else {
        ith = this._physicalEnd;
        lastIth = this._physicalStart;
        offsetContent = this._physicalBottom - scrollBottom;
      }
      while (true) {
        physicalItemHeight = this._getPhysicalSizeIncrement(ith);
        offsetContent = offsetContent - physicalItemHeight;
        if (idxs.length >= physicalCount || offsetContent <= protectedOffsetContent) {
          break;
        }
        if (fromTop) {
          // Check that index is within the valid range.
          if (virtualEnd + idxs.length + 1 >= this._virtualCount) {
            break;
          }
          // Check that the index is not visible.
          if (physicalTop + physicalItemHeight >= scrollTop) {
            break;
          }
          idxs.push(ith);
          physicalTop = physicalTop + physicalItemHeight;
          ith = (ith + 1) % physicalCount;
        } else {
          // Check that index is within the valid range.
          if (virtualStart - idxs.length <= 0) {
            break;
          }
          // Check that the index is not visible.
          if (physicalTop + this._physicalSize - physicalItemHeight <= scrollBottom) {
            break;
          }
          idxs.push(ith);
          physicalTop = physicalTop - physicalItemHeight;
          ith = (ith === 0) ? physicalCount - 1 : ith - 1;
        }
      }
      return { indexes: idxs, physicalTop: physicalTop - this._scrollerPaddingTop };
    },

    /**
     * Update the list of items, starting from the `_virtualStart` item.
     * @param {!Array<number>=} itemSet
     * @param {!Array<number>=} movingUp
     */
    _update: function(itemSet, movingUp) {
      if (itemSet && itemSet.length === 0) {
        return;
      }
      this._manageFocus();
      this._assignModels(itemSet);
      this._updateMetrics(itemSet);
      // Adjust offset after measuring.
      if (movingUp) {
        while (movingUp.length) {
          var idx = movingUp.pop();
          this._physicalTop -= this._getPhysicalSizeIncrement(idx);
        }
      }
      this._positionItems();
      this._updateScrollerSize();
      this._increasePoolIfNeeded();
    },

    /**
     * Creates a pool of DOM elements and attaches them to the local dom.
     *
     * @param {number} size Size of the pool
     */
    _createPool: function(size) {
      var physicalItems = new Array(size);

      this._ensureTemplatized();

      for (var i = 0; i < size; i++) {
        var inst = this.stamp(null);
        // First element child is item; Safari doesn't support children[0]
        // on a doc fragment.
        physicalItems[i] = inst.root.querySelector('*');
        Polymer.dom(this).appendChild(inst.root);
      }
      return physicalItems;
    },

    /**
     * Increases the pool of physical items only if needed.
     *
     * @return {boolean} True if the pool was increased.
     */
    _increasePoolIfNeeded: function() {
      // Base case 1: the list has no height.
      if (this._viewportHeight === 0) {
        return false;
      }
      var self = this;
      var isClientFull = this._physicalBottom >= this._scrollBottom &&
          this._physicalTop <= this._scrollPosition;

      // Base case 2: if the physical size is optimal and the list's client height is full
      // with physical items, don't increase the pool.
      if (this._physicalSize >= this._optPhysicalSize && isClientFull) {
        return false;
      }
      var maxPoolSize = Math.round(this._physicalCount * 0.5);
      // Increase the pool synchronously until the client is filled.
      if (!isClientFull) {
        this._debounceTemplate(this._increasePool.bind(this, maxPoolSize));
        return true;
      }
      this._yield(function() {
        self._increasePool(Math.min(maxPoolSize, Math.max(1, Math.round(50 / self._templateCost))));
      });
      return true;
    },

    _yield: function(cb) {
      var g = window;
      var handle = g.requestIdleCallback ? g.requestIdleCallback(cb) : g.setTimeout(cb, 16);
      // Polymer/issues/3895
      Polymer.dom.addDebouncer(/** @type {!Polymer.Debouncer} */({
        complete: function() {
          g.cancelIdleCallback ? g.cancelIdleCallback(handle) : g.clearTimeout(handle);
          cb();
        }
      }));
    },

    /**
     * Increases the pool size.
     */
    _increasePool: function(missingItems) {
      var nextPhysicalCount = Math.min(
          this._physicalCount + missingItems,
          this._virtualCount - this._virtualStart,
          Math.max(this.maxPhysicalCount, DEFAULT_PHYSICAL_COUNT)
        );
      var prevPhysicalCount = this._physicalCount;
      var delta = nextPhysicalCount - prevPhysicalCount;
      var ts = window.performance.now();

      if (delta <= 0) {
        return;
      }
      // Concat arrays in place.
      [].push.apply(this._physicalItems, this._createPool(delta));
      [].push.apply(this._physicalSizes, new Array(delta));
      this._physicalCount = prevPhysicalCount + delta;
      // Update the physical start if it needs to preserve the model of the focused item.
      // In this situation, the focused item is currently rendered and its model would
      // have changed after increasing the pool if the physical start remained unchanged.
      if (this._physicalStart > this._physicalEnd &&
          this._isIndexRendered(this._focusedIndex) &&
          this._getPhysicalIndex(this._focusedIndex) < this._physicalEnd) {
        this._physicalStart = this._physicalStart + delta;
      }
      this._update();
      this._templateCost = (window.performance.now() - ts) / delta;
    },

    /**
     * Renders the a new list.
     */
    _render: function() {
      if (this.isAttached && this._isVisible) {
        if (this._physicalCount === 0) {
          this.updateViewportBoundaries();
          this._increasePool(DEFAULT_PHYSICAL_COUNT);
        } else {
          // Try to recycle nodes
          var reusables = this._getReusables(true);
          this._physicalTop = reusables.physicalTop;
          this._virtualStart = this._virtualStart + reusables.indexes.length;
          this._physicalStart = this._physicalStart + reusables.indexes.length;
          this._update(reusables.indexes);
          this._update();
        }
      }
    },

    /**
     * Templetizes the user template.
     */
    _ensureTemplatized: function() {
      if (!this.ctor) {
        // Template instance props that should be excluded from forwarding
        var props = {};
        props.__key__ = true;
        props[this.as] = true;
        props[this.indexAs] = true;
        props[this.selectedAs] = true;
        props.tabIndex = true;
        this._instanceProps = props;
        this._userTemplate = Polymer.dom(this).querySelector('template');

        if (this._userTemplate) {
          this.templatize(this._userTemplate);
        } else {
          console.warn('iron-list requires a template to be provided in light-dom');
        }
      }
    },

    /**
     * Implements extension point from Templatizer mixin.
     */
    _getStampedChildren: function() {
      return this._physicalItems;
    },

    /**
     * Implements extension point from Templatizer
     * Called as a side effect of a template instance path change, responsible
     * for notifying items.<key-for-instance>.<path> change up to host.
     */
    _forwardInstancePath: function(inst, path, value) {
      if (path.indexOf(this.as + '.') === 0) {
        this.notifyPath('items.' + inst.__key__ + '.' +
          path.slice(this.as.length + 1), value);
      }
    },

    /**
     * Implements extension point from Templatizer mixin
     * Called as side-effect of a host property change, responsible for
     * notifying parent path change on each row.
     */
    _forwardParentProp: function(prop, value) {
      if (this._physicalItems) {
        this._physicalItems.forEach(function(item) {
          item._templateInstance[prop] = value;
        }, this);
      }
    },

    /**
     * Implements extension point from Templatizer
     * Called as side-effect of a host path change, responsible for
     * notifying parent.<path> path change on each row.
     */
    _forwardParentPath: function(path, value) {
      if (this._physicalItems) {
        this._physicalItems.forEach(function(item) {
          item._templateInstance.notifyPath(path, value, true);
        }, this);
      }
    },

    /**
     * Called as a side effect of a host items.<key>.<path> path change,
     * responsible for notifying item.<path> changes.
     */
    _forwardItemPath: function(path, value) {
      if (!this._physicalIndexForKey) {
        return;
      }
      var dot = path.indexOf('.');
      var key = path.substring(0, dot < 0 ? path.length : dot);
      var idx = this._physicalIndexForKey[key];
      var offscreenItem = this._offscreenFocusedItem;
      var el = offscreenItem && offscreenItem._templateInstance.__key__ === key ?
          offscreenItem : this._physicalItems[idx];

      if (!el || el._templateInstance.__key__ !== key) {
        return;
      }
      if (dot >= 0) {
        path = this.as + '.' + path.substring(dot+1);
        el._templateInstance.notifyPath(path, value, true);
      } else {
        // Update selection if needed
        var currentItem = el._templateInstance[this.as];
        if (Array.isArray(this.selectedItems)) {
          for (var i = 0; i < this.selectedItems.length; i++) {
            if (this.selectedItems[i] === currentItem) {
              this.set('selectedItems.' + i, value);
              break;
            }
          }
        } else if (this.selectedItem === currentItem) {
          this.set('selectedItem', value);
        }
        el._templateInstance[this.as] = value;
      }
    },

    /**
     * Called when the items have changed. That is, ressignments
     * to `items`, splices or updates to a single item.
     */
    _itemsChanged: function(change) {
      if (change.path === 'items') {
        this._virtualStart = 0;
        this._physicalTop = 0;
        this._virtualCount = this.items ? this.items.length : 0;
        this._collection = this.items ? Polymer.Collection.get(this.items) : null;
        this._physicalIndexForKey = {};
        this._firstVisibleIndexVal = null;
        this._lastVisibleIndexVal = null;
        this._physicalCount = this._physicalCount || 0;
        this._physicalItems = this._physicalItems || [];
        this._physicalSizes = this._physicalSizes || [];
        this._physicalStart = 0;
        this._resetScrollPosition(0);
        this._removeFocusedItem();
        this._debounceTemplate(this._render);

      } else if (change.path === 'items.splices') {
        this._adjustVirtualIndex(change.value.indexSplices);
        this._virtualCount = this.items ? this.items.length : 0;

        this._debounceTemplate(this._render);

      } else {
        this._forwardItemPath(change.path.split('.').slice(1).join('.'), change.value);
      }
    },

    /**
     * @param {!Array<!PolymerSplice>} splices
     */
    _adjustVirtualIndex: function(splices) {
      splices.forEach(function(splice) {
        // deselect removed items
        splice.removed.forEach(this._removeItem, this);
        // We only need to care about changes happening above the current position
        if (splice.index < this._virtualStart) {
          var delta = Math.max(
              splice.addedCount - splice.removed.length,
              splice.index - this._virtualStart);

          this._virtualStart = this._virtualStart + delta;

          if (this._focusedIndex >= 0) {
            this._focusedIndex = this._focusedIndex + delta;
          }
        }
      }, this);
    },

    _removeItem: function(item) {
      this.$.selector.deselect(item);
      // remove the current focused item
      if (this._focusedItem && this._focusedItem._templateInstance[this.as] === item) {
        this._removeFocusedItem();
      }
    },

    /**
     * Executes a provided function per every physical index in `itemSet`
     * `itemSet` default value is equivalent to the entire set of physical indexes.
     *
     * @param {!function(number, number)} fn
     * @param {!Array<number>=} itemSet
     */
    _iterateItems: function(fn, itemSet) {
      var pidx, vidx, rtn, i;

      if (arguments.length === 2 && itemSet) {
        for (i = 0; i < itemSet.length; i++) {
          pidx = itemSet[i];
          vidx = this._computeVidx(pidx);
          if ((rtn = fn.call(this, pidx, vidx)) != null) {
            return rtn;
          }
        }
      } else {
        pidx = this._physicalStart;
        vidx = this._virtualStart;

        for (; pidx < this._physicalCount; pidx++, vidx++) {
          if ((rtn = fn.call(this, pidx, vidx)) != null) {
            return rtn;
          }
        }
        for (pidx = 0; pidx < this._physicalStart; pidx++, vidx++) {
          if ((rtn = fn.call(this, pidx, vidx)) != null) {
            return rtn;
          }
        }
      }
    },

    /**
     * Returns the virtual index for a given physical index
     *
     * @param {number} pidx Physical index
     * @return {number}
     */
    _computeVidx: function(pidx) {
      if (pidx >= this._physicalStart) {
        return this._virtualStart + (pidx - this._physicalStart);
      }
      return this._virtualStart + (this._physicalCount - this._physicalStart) + pidx;
    },

    /**
     * Assigns the data models to a given set of items.
     * @param {!Array<number>=} itemSet
     */
    _assignModels: function(itemSet) {
      this._iterateItems(function(pidx, vidx) {
        var el = this._physicalItems[pidx];
        var inst = el._templateInstance;
        var item = this.items && this.items[vidx];
        if (item != null) {
          inst[this.as] = item;
          inst.__key__ = this._collection.getKey(item);
          inst[this.selectedAs] = /** @type {!ArraySelectorElement} */ (this.$.selector).isSelected(item);
          inst[this.indexAs] = vidx;
          inst.tabIndex = this._focusedIndex === vidx ? 0 : -1;
          this._physicalIndexForKey[inst.__key__] = pidx;
          el.removeAttribute('hidden');
        } else {
          inst.__key__ = null;
          el.setAttribute('hidden', '');
        }
      }, itemSet);
    },

    /**
     * Updates the height for a given set of items.
     *
     * @param {!Array<number>=} itemSet
     */
     _updateMetrics: function(itemSet) {
      // Make sure we distributed all the physical items
      // so we can measure them.
      Polymer.dom.flush();

      var newPhysicalSize = 0;
      var oldPhysicalSize = 0;
      var prevAvgCount = this._physicalAverageCount;
      var prevPhysicalAvg = this._physicalAverage;

      this._iterateItems(function(pidx, vidx) {
        oldPhysicalSize += this._physicalSizes[pidx] || 0;
        this._physicalSizes[pidx] = this._physicalItems[pidx].offsetHeight;
        newPhysicalSize += this._physicalSizes[pidx];
        this._physicalAverageCount += this._physicalSizes[pidx] ? 1 : 0;
      }, itemSet);

      if (this.grid) {
        this._updateGridMetrics();
        this._physicalSize = Math.ceil(this._physicalCount / this._itemsPerRow) * this._rowHeight;
      } else {
        this._physicalSize = this._physicalSize + newPhysicalSize - oldPhysicalSize;
      }
      // Update the average if it measured something.
      if (this._physicalAverageCount !== prevAvgCount) {
        this._physicalAverage = Math.round(
            ((prevPhysicalAvg * prevAvgCount) + newPhysicalSize) /
            this._physicalAverageCount);
      }
    },

    _updateGridMetrics: function() {
      this._itemWidth = this._physicalCount > 0 ? this._physicalItems[0].getBoundingClientRect().width : 200;
      this._rowHeight = this._physicalCount > 0 ? this._physicalItems[0].offsetHeight : 200;
      this._itemsPerRow = this._itemWidth ? Math.floor(this._viewportWidth / this._itemWidth) : this._itemsPerRow;
    },

    /**
     * Updates the position of the physical items.
     */
    _positionItems: function() {
      this._adjustScrollPosition();

      var y = this._physicalTop;

      if (this.grid) {
        var totalItemWidth = this._itemsPerRow * this._itemWidth;
        var rowOffset = (this._viewportWidth - totalItemWidth) / 2;

        this._iterateItems(function(pidx, vidx) {
          var modulus = vidx % this._itemsPerRow;
          var x = Math.floor((modulus * this._itemWidth) + rowOffset);
          this.translate3d(x + 'px', y + 'px', 0, this._physicalItems[pidx]);
          if (this._shouldRenderNextRow(vidx)) {
            y += this._rowHeight;
          }
        });
      } else {
        this._iterateItems(function(pidx, vidx) {
          this.translate3d(0, y + 'px', 0, this._physicalItems[pidx]);
          y += this._physicalSizes[pidx];
        });
      }
    },

    _getPhysicalSizeIncrement: function(pidx) {
      if (!this.grid) {
        return this._physicalSizes[pidx];
      }
      if (this._computeVidx(pidx) % this._itemsPerRow !== this._itemsPerRow - 1) {
        return 0;
      }
      return this._rowHeight;
    },

    /**
     * Returns, based on the current index,
     * whether or not the next index will need
     * to be rendered on a new row.
     *
     * @param {number} vidx Virtual index
     * @return {boolean}
     */
    _shouldRenderNextRow: function(vidx) {
      return vidx % this._itemsPerRow === this._itemsPerRow - 1;
    },

    /**
     * Adjusts the scroll position when it was overestimated.
     */
    _adjustScrollPosition: function() {
      var deltaHeight = this._virtualStart === 0 ? this._physicalTop :
          Math.min(this._scrollPosition + this._physicalTop, 0);

      if (deltaHeight) {
        this._physicalTop = this._physicalTop - deltaHeight;
        // juking scroll position during interial scrolling on iOS is no bueno
        if (!IOS_TOUCH_SCROLLING && this._physicalTop !== 0) {
          this._resetScrollPosition(this._scrollTop - deltaHeight);
        }
      }
    },

    /**
     * Sets the position of the scroll.
     */
    _resetScrollPosition: function(pos) {
      if (this.scrollTarget) {
        this._scrollTop = pos;
        this._scrollPosition = this._scrollTop;
      }
    },

    /**
     * Sets the scroll height, that's the height of the content,
     *
     * @param {boolean=} forceUpdate If true, updates the height no matter what.
     */
    _updateScrollerSize: function(forceUpdate) {
      if (this.grid) {
        this._estScrollHeight = this._virtualRowCount * this._rowHeight;
      } else {
        this._estScrollHeight = (this._physicalBottom +
            Math.max(this._virtualCount - this._physicalCount - this._virtualStart, 0) * this._physicalAverage);
      }

      forceUpdate = forceUpdate || this._scrollHeight === 0;
      forceUpdate = forceUpdate || this._scrollPosition >= this._estScrollHeight - this._physicalSize;
      forceUpdate = forceUpdate || this.grid && this.$.items.style.height < this._estScrollHeight;

      // Amortize height adjustment, so it won't trigger large repaints too often.
      if (forceUpdate || Math.abs(this._estScrollHeight - this._scrollHeight) >= this._optPhysicalSize) {
        this.$.items.style.height = this._estScrollHeight + 'px';
        this._scrollHeight = this._estScrollHeight;
      }
    },

    /**
     * Scroll to a specific item in the virtual list regardless
     * of the physical items in the DOM tree.
     *
     * @method scrollToItem
     * @param {(Object)} item The item to be scrolled to
     */
    scrollToItem: function(item){
      return this.scrollToIndex(this.items.indexOf(item));
    },

    /**
     * Scroll to a specific index in the virtual list regardless
     * of the physical items in the DOM tree.
     *
     * @method scrollToIndex
     * @param {number} idx The index of the item
     */
    scrollToIndex: function(idx) {
      if (typeof idx !== 'number' || idx < 0 || idx > this.items.length - 1) {
        return;
      }

      Polymer.dom.flush();
      // Items should have been rendered prior scrolling to an index.
      if (this._physicalCount === 0) {
        return;
      }
      idx = Math.min(Math.max(idx, 0), this._virtualCount-1);
      // Update the virtual start only when needed.
      if (!this._isIndexRendered(idx) || idx >= this._maxVirtualStart) {
        this._virtualStart = this.grid ? (idx - this._itemsPerRow * 2) : (idx - 1);
      }
      this._manageFocus();
      this._assignModels();
      this._updateMetrics();
      // Estimate new physical offset.
      this._physicalTop = Math.floor(this._virtualStart / this._itemsPerRow)  * this._physicalAverage;

      var currentTopItem = this._physicalStart;
      var currentVirtualItem = this._virtualStart;
      var targetOffsetTop = 0;
      var hiddenContentSize = this._hiddenContentSize;
      // scroll to the item as much as we can.
      while (currentVirtualItem < idx && targetOffsetTop <= hiddenContentSize) {
        targetOffsetTop = targetOffsetTop + this._getPhysicalSizeIncrement(currentTopItem);
        currentTopItem = (currentTopItem + 1) % this._physicalCount;
        currentVirtualItem++;
      }
      this._updateScrollerSize(true);
      this._positionItems();
      this._resetScrollPosition(this._physicalTop + this._scrollerPaddingTop + targetOffsetTop);
      this._increasePoolIfNeeded();
      // clear cached visible index.
      this._firstVisibleIndexVal = null;
      this._lastVisibleIndexVal = null;
    },

    /**
     * Reset the physical average and the average count.
     */
    _resetAverage: function() {
      this._physicalAverage = 0;
      this._physicalAverageCount = 0;
    },

    /**
     * A handler for the `iron-resize` event triggered by `IronResizableBehavior`
     * when the element is resized.
     */
    _resizeHandler: function() {
      // iOS fires the resize event when the address bar slides up
      if (IOS && Math.abs(this._viewportHeight - this._scrollTargetHeight) < 100) {
        return;
      }
      // In Desktop Safari 9.0.3, if the scroll bars are always shown,
      // changing the scroll position from a resize handler would result in
      // the scroll position being reset. Waiting 1ms fixes the issue.
      Polymer.dom.addDebouncer(this.debounce('_debounceTemplate', function() {
        this.updateViewportBoundaries();
        this._render();
        if (this._isVisible) {
          this.toggleScrollListener(true);
          if (this._physicalCount > 0) {
            this._resetAverage();
            this.scrollToIndex(this.firstVisibleIndex);
          }
        } else {
          this.toggleScrollListener(false);
        }
      }.bind(this), 1));
    },

    _getModelFromItem: function(item) {
      var key = this._collection.getKey(item);
      var pidx = this._physicalIndexForKey[key];

      if (pidx != null) {
        return this._physicalItems[pidx]._templateInstance;
      }
      return null;
    },

    /**
     * Gets a valid item instance from its index or the object value.
     *
     * @param {(Object|number)} item The item object or its index
     */
    _getNormalizedItem: function(item) {
      if (this._collection.getKey(item) === undefined) {
        if (typeof item === 'number') {
          item = this.items[item];
          if (!item) {
            throw new RangeError('<item> not found');
          }
          return item;
        }
        throw new TypeError('<item> should be a valid item');
      }
      return item;
    },

    /**
     * Select the list item at the given index.
     *
     * @method selectItem
     * @param {(Object|number)} item The item object or its index
     */
    selectItem: function(item) {
      item = this._getNormalizedItem(item);
      var model = this._getModelFromItem(item);

      if (!this.multiSelection && this.selectedItem) {
        this.deselectItem(this.selectedItem);
      }
      if (model) {
        model[this.selectedAs] = true;
      }
      this.$.selector.select(item);
      this.updateSizeForItem(item);
    },

    /**
     * Deselects the given item list if it is already selected.
     *

     * @method deselect
     * @param {(Object|number)} item The item object or its index
     */
    deselectItem: function(item) {
      item = this._getNormalizedItem(item);
      var model = this._getModelFromItem(item);

      if (model) {
        model[this.selectedAs] = false;
      }
      this.$.selector.deselect(item);
      this.updateSizeForItem(item);
    },

    /**
     * Select or deselect a given item depending on whether the item
     * has already been selected.
     *
     * @method toggleSelectionForItem
     * @param {(Object|number)} item The item object or its index
     */
    toggleSelectionForItem: function(item) {
      item = this._getNormalizedItem(item);
      if (/** @type {!ArraySelectorElement} */ (this.$.selector).isSelected(item)) {
        this.deselectItem(item);
      } else {
        this.selectItem(item);
      }
    },

    /**
     * Clears the current selection state of the list.
     *
     * @method clearSelection
     */
    clearSelection: function() {
      function unselect(item) {
        var model = this._getModelFromItem(item);
        if (model) {
          model[this.selectedAs] = false;
        }
      }

      if (Array.isArray(this.selectedItems)) {
        this.selectedItems.forEach(unselect, this);
      } else if (this.selectedItem) {
        unselect.call(this, this.selectedItem);
      }

      /** @type {!ArraySelectorElement} */ (this.$.selector).clearSelection();
    },

    /**
     * Add an event listener to `tap` if `selectionEnabled` is true,
     * it will remove the listener otherwise.
     */
    _selectionEnabledChanged: function(selectionEnabled) {
      var handler = selectionEnabled ? this.listen : this.unlisten;
      handler.call(this, this, 'tap', '_selectionHandler');
    },

    /**
     * Select an item from an event object.
     */
    _selectionHandler: function(e) {
      var model = this.modelForElement(e.target);
      if (!model) {
        return;
      }
      var modelTabIndex, activeElTabIndex;
      var target = Polymer.dom(e).path[0];
      var activeEl = Polymer.dom(this.domHost ? this.domHost.root : document).activeElement;
      var physicalItem = this._physicalItems[this._getPhysicalIndex(model[this.indexAs])];
      // Safari does not focus certain form controls via mouse
      // https://bugs.webkit.org/show_bug.cgi?id=118043
      if (target.localName === 'input' ||
          target.localName === 'button' ||
          target.localName === 'select') {
        return;
      }
      // Set a temporary tabindex
      modelTabIndex = model.tabIndex;
      model.tabIndex = SECRET_TABINDEX;
      activeElTabIndex = activeEl ? activeEl.tabIndex : -1;
      model.tabIndex = modelTabIndex;
      // Only select the item if the tap wasn't on a focusable child
      // or the element bound to `tabIndex`
      if (activeEl && physicalItem !== activeEl && physicalItem.contains(activeEl) && activeElTabIndex !== SECRET_TABINDEX) {
        return;
      }
      this.toggleSelectionForItem(model[this.as]);
    },

    _multiSelectionChanged: function(multiSelection) {
      this.clearSelection();
      this.$.selector.multi = multiSelection;
    },

    /**
     * Updates the size of an item.
     *
     * @method updateSizeForItem
     * @param {(Object|number)} item The item object or its index
     */
    updateSizeForItem: function(item) {
      item = this._getNormalizedItem(item);
      var key = this._collection.getKey(item);
      var pidx = this._physicalIndexForKey[key];

      if (pidx != null) {
        this._updateMetrics([pidx]);
        this._positionItems();
      }
    },

    /**
     * Creates a temporary backfill item in the rendered pool of physical items
     * to replace the main focused item. The focused item has tabIndex = 0
     * and might be currently focused by the user.
     *
     * This dynamic replacement helps to preserve the focus state.
     */
    _manageFocus: function() {
      var fidx = this._focusedIndex;

      if (fidx >= 0 && fidx < this._virtualCount) {
        // if it's a valid index, check if that index is rendered
        // in a physical item.
        if (this._isIndexRendered(fidx)) {
          this._restoreFocusedItem();
        } else {
          this._createFocusBackfillItem();
        }
      } else if (this._virtualCount > 0 && this._physicalCount > 0) {
        // otherwise, assign the initial focused index.
        this._focusedIndex = this._virtualStart;
        this._focusedItem = this._physicalItems[this._physicalStart];
      }
    },

    _isIndexRendered: function(idx) {
      return idx >= this._virtualStart && idx <= this._virtualEnd;
    },

    _isIndexVisible: function(idx) {
      return idx >= this.firstVisibleIndex && idx <= this.lastVisibleIndex;
    },

    _getPhysicalIndex: function(idx) {
      return this._physicalIndexForKey[this._collection.getKey(this._getNormalizedItem(idx))];
    },

    _focusPhysicalItem: function(idx) {
      if (idx < 0 || idx >= this._virtualCount) {
        return;
      }
      this._restoreFocusedItem();
      // scroll to index to make sure it's rendered
      if (!this._isIndexRendered(idx)) {
        this.scrollToIndex(idx);
      }

      var physicalItem = this._physicalItems[this._getPhysicalIndex(idx)];
      var model = physicalItem._templateInstance;
      var focusable;
      // set a secret tab index
      model.tabIndex = SECRET_TABINDEX;
      // check if focusable element is the physical item
      if (physicalItem.tabIndex === SECRET_TABINDEX) {
       focusable = physicalItem;
      }
      // search for the element which tabindex is bound to the secret tab index
      if (!focusable) {
        focusable = Polymer.dom(physicalItem).querySelector('[tabindex="' + SECRET_TABINDEX + '"]');
      }
      // restore the tab index
      model.tabIndex = 0;
      // focus the focusable element
      this._focusedIndex = idx;
      focusable && focusable.focus();
    },

    _removeFocusedItem: function() {
      if (this._offscreenFocusedItem) {
        Polymer.dom(this).removeChild(this._offscreenFocusedItem);
      }
      this._offscreenFocusedItem = null;
      this._focusBackfillItem = null;
      this._focusedItem = null;
      this._focusedIndex = -1;
    },

    _createFocusBackfillItem: function() {
      var pidx, fidx = this._focusedIndex;
      if (this._offscreenFocusedItem || fidx < 0) {
        return;
      }
      if (!this._focusBackfillItem) {
        // create a physical item, so that it backfills the focused item.
        var stampedTemplate = this.stamp(null);
        this._focusBackfillItem = stampedTemplate.root.querySelector('*');
        Polymer.dom(this).appendChild(stampedTemplate.root);
      }
      // get the physical index for the focused index
      pidx = this._getPhysicalIndex(fidx);

      if (pidx != null) {
        // set the offcreen focused physical item
        this._offscreenFocusedItem = this._physicalItems[pidx];
        // backfill the focused physical item
        this._physicalItems[pidx] = this._focusBackfillItem;
        // hide the focused physical
        this.translate3d(0, HIDDEN_Y, 0, this._offscreenFocusedItem);
      }
    },

    _restoreFocusedItem: function() {
      var pidx, fidx = this._focusedIndex;

      if (!this._offscreenFocusedItem || this._focusedIndex < 0) {
        return;
      }
      // assign models to the focused index
      this._assignModels();
      // get the new physical index for the focused index
      pidx = this._getPhysicalIndex(fidx);

      if (pidx != null) {
        // flip the focus backfill
        this._focusBackfillItem = this._physicalItems[pidx];
        // restore the focused physical item
        this._physicalItems[pidx] = this._offscreenFocusedItem;
        // reset the offscreen focused item
        this._offscreenFocusedItem = null;
        // hide the physical item that backfills
        this.translate3d(0, HIDDEN_Y, 0, this._focusBackfillItem);
      }
    },

    _didFocus: function(e) {
      var targetModel = this.modelForElement(e.target);
      var focusedModel = this._focusedItem ? this._focusedItem._templateInstance : null;
      var hasOffscreenFocusedItem = this._offscreenFocusedItem !== null;
      var fidx = this._focusedIndex;

      if (!targetModel || !focusedModel) {
        return;
      }
      if (focusedModel === targetModel) {
        // if the user focused the same item, then bring it into view if it's not visible
        if (!this._isIndexVisible(fidx)) {
          this.scrollToIndex(fidx);
        }
      } else {
        this._restoreFocusedItem();
        // restore tabIndex for the currently focused item
        focusedModel.tabIndex = -1;
        // set the tabIndex for the next focused item
        targetModel.tabIndex = 0;
        fidx = targetModel[this.indexAs];
        this._focusedIndex = fidx;
        this._focusedItem = this._physicalItems[this._getPhysicalIndex(fidx)];

        if (hasOffscreenFocusedItem && !this._offscreenFocusedItem) {
          this._update();
        }
      }
    },

    _didMoveUp: function() {
      this._focusPhysicalItem(this._focusedIndex - 1);
    },

    _didMoveDown: function(e) {
      // disable scroll when pressing the down key
      e.detail.keyboardEvent.preventDefault();
      this._focusPhysicalItem(this._focusedIndex + 1);
    },

    _didEnter: function(e) {
      this._focusPhysicalItem(this._focusedIndex);
      this._selectionHandler(e.detail.keyboardEvent);
    }
  });

})();

</script>


<script>
  console.warn('This file is deprecated. Please use `iron-flex-layout/iron-flex-layout-classes.html`, and one of the specific dom-modules instead');
</script>

<style>

  /*******************************
            Flex Layout
  *******************************/

  html /deep/ .layout.horizontal,
  html /deep/ .layout.horizontal-reverse,
  html /deep/ .layout.vertical,
  html /deep/ .layout.vertical-reverse {
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
  }

  html /deep/ .layout.inline {
    display: -ms-inline-flexbox;
    display: -webkit-inline-flex;
    display: inline-flex;
  }

  html /deep/ .layout.horizontal {
    -ms-flex-direction: row;
    -webkit-flex-direction: row;
    flex-direction: row;
  }

  html /deep/ .layout.horizontal-reverse {
    -ms-flex-direction: row-reverse;
    -webkit-flex-direction: row-reverse;
    flex-direction: row-reverse;
  }

  html /deep/ .layout.vertical {
    -ms-flex-direction: column;
    -webkit-flex-direction: column;
    flex-direction: column;
  }

  html /deep/ .layout.vertical-reverse {
    -ms-flex-direction: column-reverse;
    -webkit-flex-direction: column-reverse;
    flex-direction: column-reverse;
  }

  html /deep/ .layout.wrap {
    -ms-flex-wrap: wrap;
    -webkit-flex-wrap: wrap;
    flex-wrap: wrap;
  }

  html /deep/ .layout.wrap-reverse {
    -ms-flex-wrap: wrap-reverse;
    -webkit-flex-wrap: wrap-reverse;
    flex-wrap: wrap-reverse;
  }

  html /deep/ .flex-auto {
    -ms-flex: 1 1 auto;
    -webkit-flex: 1 1 auto;
    flex: 1 1 auto;
  }

  html /deep/ .flex-none {
    -ms-flex: none;
    -webkit-flex: none;
    flex: none;
  }

  html /deep/ .flex,
  html /deep/ .flex-1 {
    -ms-flex: 1;
    -webkit-flex: 1;
    flex: 1;
  }

  html /deep/ .flex-2 {
    -ms-flex: 2;
    -webkit-flex: 2;
    flex: 2;
  }

  html /deep/ .flex-3 {
    -ms-flex: 3;
    -webkit-flex: 3;
    flex: 3;
  }

  html /deep/ .flex-4 {
    -ms-flex: 4;
    -webkit-flex: 4;
    flex: 4;
  }

  html /deep/ .flex-5 {
    -ms-flex: 5;
    -webkit-flex: 5;
    flex: 5;
  }

  html /deep/ .flex-6 {
    -ms-flex: 6;
    -webkit-flex: 6;
    flex: 6;
  }

  html /deep/ .flex-7 {
    -ms-flex: 7;
    -webkit-flex: 7;
    flex: 7;
  }

  html /deep/ .flex-8 {
    -ms-flex: 8;
    -webkit-flex: 8;
    flex: 8;
  }

  html /deep/ .flex-9 {
    -ms-flex: 9;
    -webkit-flex: 9;
    flex: 9;
  }

  html /deep/ .flex-10 {
    -ms-flex: 10;
    -webkit-flex: 10;
    flex: 10;
  }

  html /deep/ .flex-11 {
    -ms-flex: 11;
    -webkit-flex: 11;
    flex: 11;
  }

  html /deep/ .flex-12 {
    -ms-flex: 12;
    -webkit-flex: 12;
    flex: 12;
  }

  /* alignment in cross axis */

  html /deep/ .layout.start {
    -ms-flex-align: start;
    -webkit-align-items: flex-start;
    align-items: flex-start;
  }

  html /deep/ .layout.center,
  html /deep/ .layout.center-center {
    -ms-flex-align: center;
    -webkit-align-items: center;
    align-items: center;
  }

  html /deep/ .layout.end {
    -ms-flex-align: end;
    -webkit-align-items: flex-end;
    align-items: flex-end;
  }

  /* alignment in main axis */

  html /deep/ .layout.start-justified {
    -ms-flex-pack: start;
    -webkit-justify-content: flex-start;
    justify-content: flex-start;
  }

  html /deep/ .layout.center-justified,
  html /deep/ .layout.center-center {
    -ms-flex-pack: center;
    -webkit-justify-content: center;
    justify-content: center;
  }

  html /deep/ .layout.end-justified {
    -ms-flex-pack: end;
    -webkit-justify-content: flex-end;
    justify-content: flex-end;
  }

  html /deep/ .layout.around-justified {
    -ms-flex-pack: around;
    -webkit-justify-content: space-around;
    justify-content: space-around;
  }

  html /deep/ .layout.justified {
    -ms-flex-pack: justify;
    -webkit-justify-content: space-between;
    justify-content: space-between;
  }

  /* self alignment */

  html /deep/ .self-start {
    -ms-align-self: flex-start;
    -webkit-align-self: flex-start;
    align-self: flex-start;
  }

  html /deep/ .self-center {
    -ms-align-self: center;
    -webkit-align-self: center;
    align-self: center;
  }

  html /deep/ .self-end {
    -ms-align-self: flex-end;
    -webkit-align-self: flex-end;
    align-self: flex-end;
  }

  html /deep/ .self-stretch {
    -ms-align-self: stretch;
    -webkit-align-self: stretch;
    align-self: stretch;
  }

  /*******************************
            Other Layout
  *******************************/

  html /deep/ .block {
    display: block;
  }

  /* IE 10 support for HTML5 hidden attr */
  html /deep/ [hidden] {
    display: none !important;
  }

  html /deep/ .invisible {
    visibility: hidden !important;
  }

  html /deep/ .relative {
    position: relative;
  }

  html /deep/ .fit {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }

  body.fullbleed {
    margin: 0;
    height: 100vh;
  }

  html /deep/ .scroll {
    -webkit-overflow-scrolling: touch;
    overflow: auto;
  }

  .fixed-bottom,
  .fixed-left,
  .fixed-right,
  .fixed-top {
    position: fixed;
  }

  html /deep/ .fixed-top {
    top: 0;
    left: 0;
    right: 0;
  }

  html /deep/ .fixed-right {
    top: 0;
    right: 0;
    bottom: 0;
  }

  html /deep/ .fixed-bottom {
    right: 0;
    bottom: 0;
    left: 0;
  }

  html /deep/ .fixed-left {
    top: 0;
    bottom: 0;
    left: 0;
  }

</style>
<script>
  console.warn('This file is deprecated. Please use `iron-flex-layout/iron-flex-layout-classes.html`, and one of the specific dom-modules instead');
</script><style>

  /*******************************
            Flex Layout
  *******************************/

  .layout.horizontal,
  .layout.horizontal-reverse,
  .layout.vertical,
  .layout.vertical-reverse {
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
  }

  .layout.inline {
    display: -ms-inline-flexbox;
    display: -webkit-inline-flex;
    display: inline-flex;
  }

  .layout.horizontal {
    -ms-flex-direction: row;
    -webkit-flex-direction: row;
    flex-direction: row;
  }

  .layout.horizontal-reverse {
    -ms-flex-direction: row-reverse;
    -webkit-flex-direction: row-reverse;
    flex-direction: row-reverse;
  }

  .layout.vertical {
    -ms-flex-direction: column;
    -webkit-flex-direction: column;
    flex-direction: column;
  }

  .layout.vertical-reverse {
    -ms-flex-direction: column-reverse;
    -webkit-flex-direction: column-reverse;
    flex-direction: column-reverse;
  }

  .layout.wrap {
    -ms-flex-wrap: wrap;
    -webkit-flex-wrap: wrap;
    flex-wrap: wrap;
  }

  .layout.wrap-reverse {
    -ms-flex-wrap: wrap-reverse;
    -webkit-flex-wrap: wrap-reverse;
    flex-wrap: wrap-reverse;
  }

  .flex-auto {
    -ms-flex: 1 1 auto;
    -webkit-flex: 1 1 auto;
    flex: 1 1 auto;
  }

  .flex-none {
    -ms-flex: none;
    -webkit-flex: none;
    flex: none;
  }

  .flex,
  .flex-1 {
    -ms-flex: 1;
    -webkit-flex: 1;
    flex: 1;
  }

  .flex-2 {
    -ms-flex: 2;
    -webkit-flex: 2;
    flex: 2;
  }

  .flex-3 {
    -ms-flex: 3;
    -webkit-flex: 3;
    flex: 3;
  }

  .flex-4 {
    -ms-flex: 4;
    -webkit-flex: 4;
    flex: 4;
  }

  .flex-5 {
    -ms-flex: 5;
    -webkit-flex: 5;
    flex: 5;
  }

  .flex-6 {
    -ms-flex: 6;
    -webkit-flex: 6;
    flex: 6;
  }

  .flex-7 {
    -ms-flex: 7;
    -webkit-flex: 7;
    flex: 7;
  }

  .flex-8 {
    -ms-flex: 8;
    -webkit-flex: 8;
    flex: 8;
  }

  .flex-9 {
    -ms-flex: 9;
    -webkit-flex: 9;
    flex: 9;
  }

  .flex-10 {
    -ms-flex: 10;
    -webkit-flex: 10;
    flex: 10;
  }

  .flex-11 {
    -ms-flex: 11;
    -webkit-flex: 11;
    flex: 11;
  }

  .flex-12 {
    -ms-flex: 12;
    -webkit-flex: 12;
    flex: 12;
  }

  /* alignment in cross axis */

  .layout.start {
    -ms-flex-align: start;
    -webkit-align-items: flex-start;
    align-items: flex-start;
  }

  .layout.center,
  .layout.center-center {
    -ms-flex-align: center;
    -webkit-align-items: center;
    align-items: center;
  }

  .layout.end {
    -ms-flex-align: end;
    -webkit-align-items: flex-end;
    align-items: flex-end;
  }

  /* alignment in main axis */

  .layout.start-justified {
    -ms-flex-pack: start;
    -webkit-justify-content: flex-start;
    justify-content: flex-start;
  }

  .layout.center-justified,
  .layout.center-center {
    -ms-flex-pack: center;
    -webkit-justify-content: center;
    justify-content: center;
  }

  .layout.end-justified {
    -ms-flex-pack: end;
    -webkit-justify-content: flex-end;
    justify-content: flex-end;
  }

  .layout.around-justified {
    -ms-flex-pack: around;
    -webkit-justify-content: space-around;
    justify-content: space-around;
  }

  .layout.justified {
    -ms-flex-pack: justify;
    -webkit-justify-content: space-between;
    justify-content: space-between;
  }

  /* self alignment */

  .self-start {
    -ms-align-self: flex-start;
    -webkit-align-self: flex-start;
    align-self: flex-start;
  }

  .self-center {
    -ms-align-self: center;
    -webkit-align-self: center;
    align-self: center;
  }

  .self-end {
    -ms-align-self: flex-end;
    -webkit-align-self: flex-end;
    align-self: flex-end;
  }

  .self-stretch {
    -ms-align-self: stretch;
    -webkit-align-self: stretch;
    align-self: stretch;
  }

  /*******************************
            Other Layout
  *******************************/

  .block {
    display: block;
  }

  /* IE 10 support for HTML5 hidden attr */
  [hidden] {
    display: none !important;
  }

  .invisible {
    visibility: hidden !important;
  }

  .relative {
    position: relative;
  }

  .fit {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }

  body.fullbleed {
    margin: 0;
    height: 100vh;
  }

  .scroll {
    -webkit-overflow-scrolling: touch;
    overflow: auto;
  }

  /* fixed position */

  .fixed-bottom,
  .fixed-left,
  .fixed-right,
  .fixed-top {
    position: fixed;
  }

  .fixed-top {
    top: 0;
    left: 0;
    right: 0;
  }

  .fixed-right {
    top: 0;
    right: 0;
    bottom: 0;
  }

  .fixed-bottom {
    right: 0;
    bottom: 0;
    left: 0;
  }

  .fixed-left {
    top: 0;
    bottom: 0;
    left: 0;
  }

</style><script>
    /**
     * A behavior to control the scrolling of the triplat-select-input dropdown. 
     *
     * @polymerBehavior TriplatSelectInputScrollBehavior
     *
     */
    TriplatSelectInputScrollBehavior = {
        
        properties: {
        	/**
      		 * Last vertical touch position.
      		 */
      		_lastTouchPageY: {
        		type: Number,
        		value: 0
      		},
      		
      		/**
      		 * Indicates if new items are being added to the dropdown.
      		 */
      		_addingItems: {
        		type: Boolean,
        		value: false
      		}
        },
        
        listeners: {
			"wheel": "_onScroll",
			"touchstart": "_onScroll",
			"touchmove": "_onScroll",
			"dom-change": "_handleItemsTemplateDomChange"
		},
		
		_onScroll: function(event) {
			if (!this.$.dropdown.opened) {
				return;
			}
			if (event.type === 'touchstart') {
				this._storeLastTouch(event);
	        	return;
	        }
			if (!event.cancelable) {
				return;
			}
			var deltaY = this._getScrollDeltaY(event);
			
			if (deltaY > 0) {
				var distanceToBottom = this.scroller.scrollHeight - this.scroller.clientHeight - this.scroller.scrollTop;
				var canScrollDown =  distanceToBottom > 65;//loading spinner height
			
				if (!canScrollDown || this._addingItems) {
					event.preventDefault();
					this.scroller.scrollTop = this.scroller.scrollHeight;//Move the scrollbar to the bottom
				}
			}
			
		},
		
		_storeLastTouch: function(event) {
			if (event.targetTouches) {
	        	this._lastTouchPageY = event.targetTouches[0].pageY;
	        }
		},
		
		_getScrollDeltaY: function(event) {
			var deltaY = event.deltaY;
			if (event.targetTouches) {
				deltaY = this._lastTouchPageY - event.targetTouches[0].pageY;
	        }
			this._storeLastTouch(event);
			return deltaY;
		},
		
		_handleItemsTemplateDomChange: function(event) {
			if (event.target != null && event.target.is == "dom-repeat") {
				this._addingItems = true;
				this.debounce('triplat-select-input-adding-items',
					this.set.bind(this, "_addingItems", false), 
					500
				);
			}
		}
    }
</script><dom-module id="triplat-select-input" assetpath="../triplat-select-input/">

  <style>

    :host {
      display: block;
      position: relative;
    }

    #dropdown {
      /* iron-dropdown vertical-offset set the same value for top and bottom margins. For better control,
       * we set vertical-offset to zero, position the dialog under the input field, and reduce the bottom margin
       * so more items are displayed in the dialog.
       */
	  margin-bottom: var(--triplat-select-input-dropdown-margin-bottom, 10px);

      /* iron-dropdown allowOutsideScroll property fails to constrain scrolling on complex pages. Therefore, 
       * overwrite iron-dropdown fixed position setting and set the dropdown relative to its positionTarget element (input field).
       */
      position: absolute !important;
      
      /* iron-dropdown calculate the max-height for the dropdown base on the screen size. The dropdown scroll 
       * is set to auto, and will be displayed if the items size is bigger then the dropdown size.
       * If using scroll pagination with low number of records that fit the screen, the scroll will not be displayed.
       * In that case, App developer should set the dropdown max-height to be smaller then the height of the pagination records, to force scroll display.
       */
	  max-height: var(--triplat-select-input-dropdown-max-height, none);
    }

    .dropdown-content {
		@apply(--layout);
		@apply(--layout-vertical);

		@apply(--shadow-elevation-2dp);
		margin-bottom: 20px;
	}
	
	#selectClear {
		@apply(--layout-horizontal);
		position: relative;
	}
      
    #selectClear:focus{
        outline: none;   
    }
	
	.clearButton {
		margin-top: 20px;
		position: absolute;
		bottom: 2px;
		display: none;
		@apply(--triplat-select-input-clear-button);
	}
	
	:host-context([dir="rtl"]) .clearButton {
		left: -9px;
	}
	
	:host-context([dir="ltr"]) .clearButton {
		right: -9px;
	}

	iron-list {
		@apply(--layout-flex);
	}

	paper-menu {
		padding: 0px;
	}

	paper-item {
		--paper-item: {
			padding: 0px 16px;
			cursor: pointer;
			background-color: #ffffff;
			@apply(--triplat-select-input-paper-item);
		};
		--paper-item-min-height: var(--triplat-select-input-paper-item-min-height, 48px);
		--paper-item-focused: {
			@apply(--triplat-select-input-paper-item-focused);
		};
	}
      
    paper-item span {
        pointer-events: none;
    }

	.item {
		/*padding: 5px 10px;*/
	}
	
	paper-input-container input::-ms-clear {
		display: none;
	}

	.loading-item {
      @apply(--layout-center-center);
      pointer-events: none;
      min-height: 60px;
    }
    
    .spacer-when-opened {
    	margin-bottom: var(--triplat-select-input-margin-bottom-when-opened, 0px);
    }

	paper-input-container input {
		box-sizing: border-box;
		padding-right: 25px;
	}
	:host-context([dir="rtl"]) paper-input-container input {
		padding-right: 0;
		padding-left: 25px;
	}

	/* 
		Sometimes, Safari browser displays, by default, an user icon on the right side of the input field. 
		This is a problem for this component because the default icon visually conflicts with the X clear button.
		This fix will hide the default "user icon".
	*/
	input::-webkit-contacts-auto-fill-button {
		visibility: hidden;
		display: none !important;
		pointer-events: none;
		position: absolute;
		right: 0;
	}

	paper-input-container {
		@apply --layout-flex;
	}

  </style>

  <template>
  	<div id="selectClear">
  		<paper-input-container id="input" focused="{{focused}}" disabled$="[[disabled]]" aria-label$="{{label}}" auto-validate$="[[autoValidate]]" always-float-label$="[[alwaysFloatLabel]]" on-keydown="_keyDownInputHandler" invalid$="{{invalid}}">
  			<label id="[[_labelId]]" for$="[[_inputId]]">
  				[[label]]<content id="labelContent" select="[label]"></content>
  			</label>
  			<input id="[[_inputId]]" aria-labelledby="[[_labelId]]" is="iron-input" bind-value="{{_searchValue}}" required$="[[required]]" disabled$="[[disabled]]" readonly$="[[readonly]]" aria-label$="{{label}}">

	      	<template is="dom-if" if="[[errorMessage]]">
    	    	<paper-input-error>[[errorMessage]]</paper-input-error>
      		</template>
  		</paper-input-container>

  		<paper-icon-button id="clearButton" class="clearButton" icon="icons:clear" on-tap="_clearValue" on-keydown="_keyDownClearHandler" disabled$="[[disabled]]" aria-label="clear">
  		</paper-icon-button>
  	</div>
  	<div id="dropdownAnchor"></div>
	<iron-dropdown id="dropdown" horizontal-align="left" vertical-align="top" vertical-offset="0">
		<div role="alert" id="dropdownContent" class="dropdown-content">
			<paper-menu id="menu" role="listbox" aria-label$="{{label}}" on-keydown="_keyDownMenuHandler">
				<template id="itemsTemplate" is="dom-repeat" items="{{selectSrc}}">
					<paper-item role="option" on-keypress="_keyPressHandler" on-tap="_onTapItem"><span>{{_computeItemValue(item)}}</span></paper-item>
				</template>
				<paper-item class="loading-item" role="option" hidden="[[!loading]]"><paper-spinner active=""></paper-spinner></paper-item>
			</paper-menu>
		</div>
	</iron-dropdown>
  </template>

</dom-module>

<script>
	Polymer({

		is: "triplat-select-input",
		
		behaviors: [
			TriplatInputContainerBehavior,
			TriplatSelectInputScrollBehavior
		],
		
		/**
	     * Fired after the dropdown list opens.
	     *
	     * @event select-input-list-open
	     */
	     
		/**
	     * Fired after the dropdown list closes.
	     *
	     * @event select-input-list-close
	     */
	     
		/**
	     * Fired after the input value changes. Contains the new value in event.detail.value.
	     *
	     * @event select-input-value-change 
	     */

	     /**
	     * Fired when the input changes due to user interaction. Contains the new value in event.detail.value.
	     *
	     * @event select-input-value-user-change 
	     */
	     
		properties: {
			/*
			 * Label for input field.
			 */
			label: {
				type: String,
				notify: false,
				readOnly: false
			},

			/*
			 * STRING_WITH_ID object for the currently selected value for the field. 
			 * If the dropdown is open. then this value won't change until you select a new value.
			 * This value will be null if there is no match.
			 */
			value: {
				type: Object,
				notify: true,
				readOnly: false,
				observer: "_onValueChanged"
			},
			
			/*
			 * Value name used in the STRING_WITH_ID object. This will specify the property of the STRING_WITH_ID object
			 * that you want to set. Typically, STRING_WITH_ID contains 2 properties, "id" and "value", and you would want 
			 * to set the valueName to "value".
			 */
			valueName: {
				type: String,
				notify: false,
				readOnly: false
			},

			/*
			 * String for filter/search. This is set to the value that is typed in the input field and is updated each
			 * time a character is typed or removed. When selectSrc references a data source with a filter, this value can 
			 * be used in that filter to produce typeahead filtering by data-binding this value with a
			 * triplat-query-filter value attribute.
			 */
			searchValue: {
				type: String,
				notify: true,
				readOnly: true
			},

			/*
			 * Select data source. The values in this array are displayed in the dropdown box.
			 * This array is also used to data-bind with the triplat-ds data attribute or filtered-data attribute.
			 */
			selectSrc: {
				type: Array,
				notify: false,
				readOnly: false,
				observer: "_onSelectSrcChanged"
			},
			
			/*
			 * Scroller container element object. This object is also used to data-bind with the triplat-query-scroll-page scroller attribute.
			 */
			scroller: {
				type: Object,
				notify: true,
				readOnly: true
			},
			
			/*
			 * Query scroll page element ID that defines the scroller property. This ID is used to get the 
			 * triplat-query-scroll-page size attribute to ensure that the scrollbar is displayed for a small pagination size.
			 */
			queryScrollPageId: {
				type: String
			},
			
	  		/** 
	  		  * Boolean to indicate that this is a disabled input field. Show
	  		  * the value, but not the clear button. The value will be grayed out and not editable.
	  		  * The value will be underlined to indicate it is an input field.
	  		  */
			disabled: {
	  			type: Boolean,
	  			value: false
	  		},

	  		/** 
	  		  * Boolean to indicate that this is a read-only value. Show
	  		  * the value, but not the clear button.
	  		  */
	  		readonly: {
	  			type: Boolean,
	  			value: false
	  		}, 


	        /**
	         * Set to true to mark the input field as required.
	         */
	        required: {
	          type: Boolean,
	          value: false
	        },

	        /**
	         * The error message to display when the input value is invalid.
	         */
	        errorMessage: {
	          type: String
	        },

	        /**
	         * Set to true to auto-validate the input value when it changes.
	         */
	        autoValidate: {
	          type: Boolean,
	          value: false
	        },

			/**
			 * True if the input is invalid. This property is set automatically when the input value changes if auto-validating.
			 */
			invalid: {
				type: Boolean,
				value: false
			},

	        /**
	         * Set to true to scroll the selected input element into view (on focus). If scroll is available, it will align the element to the top of the browser window (if possible).
	         * The scroll into view is applied on mobile devices only, where screens are small and the virtual keyboard takes much of the screen area.
	         * If no scroll is available, you can set the size of the bottom margin using the <b>--triplat-select-input-margin-bottom-when-opened</b> 
	         * CSS property to enable the scroll on the screen. That bottom margin will be applied only on mobile devices when the 
	         * <b>scrollElementIntoView</b> is true. 
	         */
	         scrollElementIntoView: {
	          type: Boolean,
	          value: false,
	          observer: "_handleScrollElementIntoViewChange"
	        },

			/*
			 * Set to true to always float the floating label.
			 */
			alwaysFloatLabel: {
	  			type: Boolean,
	  			value: false
	  		},

            
           /**
			 * The delay (in milliseconds) between the time a single letter is typed, 
             * and the time the dropdown shows results. This delay is needed so we can wait a bit after presenting the results list in 
			 * the dropdown. This way, we can achieve better performance, skipping searches against single letters.
			 */
			delay: {
				type: Number,
				notify: false,
				readOnly: false,
				value: 300
			},

			/*
             * Set to true to indicate when a loading indicator is required
             */
	     	loading: {
	        	type: Boolean,
	        	value: false,
	        	observer: "_onLoadingChanged"
	      	},

	        /**
	         * Internally set to true to open the dropdown when the select source change.
	         */
	        _openDropDownOnMenuChange: {
	          type: Boolean,
	          value: false
	        },

	        /**
	         * Internally set to true to skip focus setting when closing the dropdown.
	         */
	         _skipSetFocusOnClose: {
	          type: Boolean,
	          value: false
	        },

	        /**
       		 * Internally set to true to to indicate the first time a data was loaded
       		 */
      		_firstLoading: {
        		type: Boolean,
        		value: false
      		}
		},

		observers: [
			"_onFocusedChanged(focused)",
			"_on_searchValueChanged(_searchValue)"
		],

		listeners: {
			"dropdown.iron-overlay-closed": "_onIronOverlayClosed",
			"dropdown.iron-overlay-opened": "_onIronOverlayOpened",
			"menu.iron-select": "_onIronSelect"
		},

		attached: function() {
			// Instead of positionTarget to input and adding fixed top offset of 60px so dropdown is displayed under the input, we set it to 
			// the DIV that is under the input, and let the iron-dropdown calculate its position (iron-dropdown CSS top is calculated base on positionTarget and vertical-offset).
			this.$.dropdown.positionTarget = this.$.dropdownAnchor;
			this.$.dropdown.focusTarget = this.$.input;
			this._setScroller(this.$.dropdownContent);
		  	if(Polymer.dom(this.$$('#labelContent')).getDistributedNodes().length >0){
				this.label=" ";
			}
		},

		_computeItemValue: function(item) {
			return (item == undefined)? "":item[this.valueName];
		},

		_onFocusedChanged: function(focused) {
			if(this._isDisabledOrReadonly()) {
				return;
			}
			
			if (focused && (!this.$.dropdown.opened)) {
			    var searchValue = this._searchValue;
			    var value = (this.value)? this.value.value:null;
				 if(searchValue && searchValue.length>0 && value && value.length>0 && searchValue.length==value.length && searchValue.indexOf(value)>-1) {
					// Even if value is already set, we want to open dropdown and display all the available values to tell user this is a list
					// values from drop down will be filetered on user's key stroke
					this._on_searchValueChanged(""); //set search value includes: enable/disable clear icon, open dropdown
					this.$.clearButton.style.display = "inline"; //display clear icon as there is a value
				}else{
					this.$.dropdown.resetFit();
					this._on_searchValueChanged(""); //set search value includes: enable/disable clear icon, open dropdown
				} 
			}
		},

		_selectItem: function(selectedElement) {
			this.$.dropdown.resetFit();
			var selectedItem = this.$.itemsTemplate.itemForElement(selectedElement);
			this._valueSelected = true;
			this.$.menu.selected = -1;
			this.$.dropdown.close();
			this.fire('select-input-list-close');
			this._internalSet = true;
			// only set value when it has actually changed
			if ((this.value == undefined || this.value.id == undefined || this.value.value == undefined) ||
				(this.value.id != selectedItem._id && this.value.value != selectedItem[this.valueName])) {
				this.set("value", {id: selectedItem._id, value: selectedItem[this.valueName]});
			} else if(this._searchValue != selectedItem[this.valueName]) {
				//if value did not change but search value change, then update the search value (input display value)
				this.set("_searchValue", selectedItem[this.valueName]);
			}
			this._internalSet = false;
		},
		
		_onIronSelect: function(e) {	
			this.async(function() {
				var selectedElement = e.detail.item;
				this._selectItem(selectedElement);
				this._fireUserChanged();
			}, 200);
		},

		_onSelectSrcChanged: function(selectSrc) {
			if (!selectSrc) {
                this.set("_firstLoading", false);
				
                // Reset the size of the dropdown
                this.$.dropdown.resetFit();
            }
			
			if(this._openDropDownOnMenuChange){
				this._openDropDown();
			}
		},
		
		_onValueChanged: function(value) {
			this._internalSet = true;
			if (value && (value.value!=null)) {
				this.set("_searchValue", value.value);
			} else {
				this.set("_searchValue", "");
			}
			this._internalSet = false;
			this.fire('select-input-value-change', {'value': (value ? value.value : "")});
		},

		_onIronOverlayClosed: function(e) {
			if (!this._valueSelected) {
				var canceled = e.detail.canceled;
				if (canceled && this.searchValue && this.searchValue.length == 0) {
					this.set("value", null);
				} else {
					if (this.value && (this.value.value!=null)) {
						//string with id has value, update search value
						this.set("_searchValue", this.value.value);
					} else {
						this.set("_searchValue", "");
					}
				}
			}
			this._valueSelected = false;
			this._overlayClosed = true;
			if (this.scrollElementIntoView) {
				this.toggleClass("spacer-when-opened", false, this.$.dropdownAnchor);
			}
			if(this._skipSetFocusOnClose){
				//do not set focus and allow tab to next/previous element in the page
				this.set("_skipSetFocusOnClose", false);
			} else {
				//reset focus, so clicking of the input field again will open the dropdown
	            this._setFocus();
			}
		},

		_onIronOverlayOpened: function(e) {
			this._adjustScrollHeight();
		},
		
		_adjustScrollHeight: function() {
			//check if need to adjust menu height to guarantee scroller is displayed (to get next records)
			if(this.scroller !=undefined && this.queryScrollPageId !=undefined){
				var queryScrollPage = document.querySelector("#"+this.queryScrollPageId);
				
				if(queryScrollPage != undefined && this.$.menu.items !=undefined 
					&& this.$.menu.items.length < queryScrollPage.totalSize){
					var menuHeight = this.$.menu.getBoundingClientRect().bottom - this.$.menu.getBoundingClientRect().top;
					var dropdownContentHeight = parseInt(this.$.dropdownContent.style.maxHeight);
					if(menuHeight <= dropdownContentHeight){
						//Make wrapper height a bit smaller then menu to insure scroller is displayed
						this.$.dropdownContent.style.maxHeight = menuHeight - 10 + "px";
					}
				}
			}
		},

		_on_searchValueChanged: function(_searchValue) {
			if(_searchValue && _searchValue.length > 0 && !this._isDisabledOrReadonly()){
				this.$.clearButton.style.display = "inline";
			}else {
				this.$.clearButton.style.display = "none";
			}

			var toOpenDropDown = (!this._internalSet && this._overlayClosed)? true:false;

			if(toOpenDropDown){
				//no delay in setting search value and opening dropdown dialog in that order so
				//dropdown max-height calculation is done on the full set
				if(this.searchValue !=  _searchValue){
					//new search trigger new request, open dropdown on request results change
					this._openDropDownOnMenuChange = true;
					this._setSearchValue(_searchValue);
				} else {
					//open dropdown directly (no change means no request)
					this._setSearchValue(_searchValue);
					this._openDropDown();
				}
			} else {
				if(_searchValue && _searchValue.length > 0 && 
				   this.value && this.value.value != null && this.value.value == _searchValue){
					this._setSearchValue(_searchValue);
				} else {
					//once dropdown already open (and sized), delay the search text 
					if (this._delayHandle != undefined && this._delayHandle != null) {
						this.cancelAsync(this._delayHandle);
					}
					this._delayHandle = this.async(function() {
						this._setSearchValue(this._searchValue);
					}, this._intDelay);
				}
			}

			if(this._overlayClosed == undefined) {
				this._overlayClosed = true;
			}
		},

		_onLoadingChanged: function(value) {
			var dropdownOpened = this.$.dropdown.opened;
			
      		if (dropdownOpened && !value && this.selectSrc && !this._firstLoading) {
        		this.async(function() {
          			this.set("_firstLoading", true);
          			this.$.dropdown.resetFit();
          			this.$.dropdown.refit();
          			this._adjustScrollHeight();
        		}, 300);
      		}
    	},
		
		get _intDelay() {
			var intDelay = parseInt(this.delay);
			return (intDelay > 200)? intDelay:200; //minimum search delay of 200 milliseconds to avoid sync results issues
		},

		_keyPressHandler: function(event) {
			var code = event.keyCode;
			// accept Enter (13) as select item
			if (code == 13) {
				var selectedElement = event.target;
				this._selectItem(selectedElement);
				this._fireUserChanged();
				//console.log("_keyPressHandler selectedElement: " + selectedElement);
			}
			event.preventDefault();
		},
		
		_keyDownInputHandler: function(event) {
			var code = event.keyCode;
			if(this.$.dropdown.opened){
				if(code==9 && event.shiftKey) {
					// on the input field, accept shiftKey + TAB(9) as a move back to previouse TAB element in the page and therefore close the dropdown menu
					this.set("_skipSetFocusOnClose", true);
					this.$.dropdown.close();
				} else if(code == 40 ||
						(code == 9 && this.$.clearButton.style.display == "none")) {
					// on the input field, accept Down Arrow (40) or TAB(9) without clear icon as a move to dropdown first item (menu.div.paper-item)
					var firstItem = this.$.menu.firstElementChild.firstElementChild;
					var hasSelectSrc = this.selectSrc ? (this.selectSrc.length > 0 ? true: false) : false;

					if(firstItem != null && hasSelectSrc) {
						firstItem.focus();
						event.preventDefault();//dont move to next element
					}
				}
			}
		},
		
		_keyDownMenuHandler: function(event) {
			var code = event.keyCode;
			if(code == 9) {
				// on the menu, accept TAB(9) as a move to next TAB element in the page and therefore close the dropdown menu
				this.set("_skipSetFocusOnClose", true);
				this.$.dropdown.close();
			}
		},
		
		_keyDownClearHandler: function(event) {
			var code = event.keyCode;
			if(code == 9 && this.$.dropdown.opened) {
				// on the clear icon, when dropdown is displayed accept TAB(9) as a move to dropdown first item (menu.div.paper-item)
				var firstItem = this.$.menu.firstElementChild.firstElementChild;
				if(firstItem != null) {
					firstItem.focus();
					event.preventDefault();
				}
			}
		},
		
		_clearValue: function() {
			this.$.dropdown.resetFit();
			this._internalSet = true;
			this.set("value", null);
			this.set("_searchValue", "");
			this._internalSet = false;
            this._setFocus();
            this._fireUserChanged();
		},
        
        _setFocus: function(){
            this.$.selectClear.tabIndex = 0;
            this.$.selectClear.focus();
            this.$.selectClear.tabIndex = -1;
        },

		/* Return true if the component is disabled or readonly.
		 */
		_isDisabledOrReadonly: function() {
		 	return this.disabled || this.readonly;
		},

		_openDropDown: function() {
			if(!this.$.dropdown.opened && !this._isDisabledOrReadonly()){
				var openDelay = 200;
				if(this._isMobileDevice()){
					//Mobile devices, such iPad, need more delay for scrollToTop and virtual keyboard
					openDelay = 400;
					if(this._isAndroidDevice()) {
						//Android field keyboard and field scroll to to seem to be slower. Therefore, increase delay for Android to 
						//allow more time for the virtual keyboard to be displayed and for the field to scroll to top before 
						//dropdown is opened and positioned next to the field.
						openDelay = 1000;
					}
					if(this.scrollElementIntoView){
						this.toggleClass("spacer-when-opened", true, this.$.dropdownAnchor);
						this.$.input.scrollIntoView(true); //On mobile devices, scrolls the page, if possible, and bring the current input element into a higher area of the screen.
					}
				}
				
				this.async(function() {
					this.$.dropdownContent.style.width = this.offsetWidth + "px";
					this.$.dropdown.open();
					//this.$.dropdown.notifyResize(); commented out since it cause dialog to be center when leaving and returning to the page 
					this.fire('select-input-list-open');
					this._openDropDownOnMenuChange = false;
					this._overlayClosed = false;
				}, openDelay); //100 not enough in some cases for the search input to keep its focus
			}
		},

		_isMobileDevice: function () {
			if( navigator.userAgent.match(/Android/i)
				 || navigator.userAgent.match(/webOS/i)
				 || navigator.userAgent.match(/iPhone/i)
				 || navigator.userAgent.match(/iPad/i)
				 || navigator.userAgent.match(/iPod/i)
				 || navigator.userAgent.match(/BlackBerry/i)
				 || navigator.userAgent.match(/Windows Phone/i)
			){
			    return true;
			}
			else {
			    return false;
			}
		},

		_isAndroidDevice: function () {
			return navigator.userAgent.match(/Android/i);
		},
		
		_handleScrollElementIntoViewChange: function(scrollElementIntoViewNew, scrollElementIntoViewOld) {
			if (!scrollElementIntoViewNew) {
				this.toggleClass("spacer-when-opened", false, this.$.dropdownAnchor);
			}
		},

		/* This event get fired after user: 
		 *  - select dropdown item
		 *  - keypress arrow down to select item. 
		 *  - click clear icon
		 *  - keypress clear icon
		 */ 
		_fireUserChanged: function(){
			this.fire('select-input-value-user-change', {'value': (this.value ? this.value.value : "")});
		},
		
		_onTapItem: function(event) {
			event.preventDefault();
		}
	});

</script>

<dom-module id="iron-localstorage" assetpath="../iron-localstorage/"></dom-module>
<script>

  Polymer({
    is: 'iron-localstorage',

    properties: {
      /**
       * localStorage item key
       */
      name: {
        type: String,
        value: ''
      },
      /**
       * The data associated with this storage.
       * If set to null item will be deleted.
       * @type {*}
       */
      value: {
        type: Object,
        notify: true
      },

      /**
       * If true: do not convert value to JSON on save/load
       */
      useRaw: {
        type: Boolean,
        value: false
      },

      /**
       * Value will not be saved automatically if true. You'll have to do it manually with `save()`
       */
      autoSaveDisabled: {
        type: Boolean,
        value: false
      },
      /**
       * Last error encountered while saving/loading items
       */
      errorMessage: {
        type: String,
        notify: true
      },

      /** True if value has been loaded */
      _loaded: {
        type: Boolean,
        value: false
      }
    },

    observers: [
      '_debounceReload(name,useRaw)',
      '_trySaveValue(autoSaveDisabled)',
      '_trySaveValue(value.*)'
    ],

    ready: function() {
      this._boundHandleStorage = this._handleStorage.bind(this);
    },

    attached: function() {
      window.addEventListener('storage', this._boundHandleStorage);
    },

    detached: function() {
      window.removeEventListener('storage', this._boundHandleStorage);
    },

    _handleStorage: function(ev) {
      if (ev.key == this.name) {
        this._load(true);
      }
    },

    _trySaveValue: function() {
      if (this._doNotSave) {
        return;
      }
      if (this._loaded && !this.autoSaveDisabled) {
        this.debounce('save', this.save);
      }
    },

    _debounceReload: function() {
      this.debounce('reload', this.reload);
    },

    /**
     * Loads the value again. Use if you modify
     * localStorage using DOM calls, and want to
     * keep this element in sync.
     */
    reload: function() {
      this._loaded = false;
      this._load();
    },

    /**
     * loads value from local storage
     * @param {boolean=} externalChange true if loading changes from a different window
     */
    _load: function(externalChange) {
      try {
        var v = window.localStorage.getItem(this.name);
      } catch (ex) {
        this.errorMessage = ex.message;

        this._error("Could not save to localStorage.  Try enabling cookies for this page.", ex);
      };

      if (v === null) {
        this._loaded = true;
        this._doNotSave = true;  // guard for save watchers
        this.value = null;
        this._doNotSave = false;
        this.fire('iron-localstorage-load-empty', { externalChange: externalChange});
      } else {
        if (!this.useRaw) {
          try { // parse value as JSON
            v = JSON.parse(v);
          } catch(x) {
            this.errorMessage = "Could not parse local storage value";
            Polymer.Base._error("could not parse local storage value", v);
            v = null;
          }
        }
        this._loaded = true;
        this._doNotSave = true;
        this.value = v;
        this._doNotSave = false;
        this.fire('iron-localstorage-load', { externalChange: externalChange});
      }
    },

    /**
     * Saves the value to localStorage. Call to save if autoSaveDisabled is set.
     * If `value` is null or undefined, deletes localStorage.
     */
    save: function() {
      var v = this.useRaw ? this.value : JSON.stringify(this.value);
      try {
        if (this.value === null || this.value === undefined) {
          window.localStorage.removeItem(this.name);
        } else {
          window.localStorage.setItem(this.name, /** @type {string} */ (v));
        }
      }
      catch(ex) {
        // Happens in Safari incognito mode,
        this.errorMessage = ex.message;
        Polymer.Base._error("Could not save to localStorage. Incognito mode may be blocking this action", ex);
      }
    }

    /**
     * Fired when value loads from localStorage.
     *
     * @event iron-localstorage-load
     * @param {{externalChange:boolean}} detail -
     *     externalChange: true if change occured in different window.
     */

    /**
     * Fired when loaded value does not exist.
     * Event handler can be used to initialize default value.
     *
     * @event iron-localstorage-load-empty
     * @param {{externalChange:boolean}} detail -
     *     externalChange: true if change occured in different window.
     */
  });

</script>






<script>
(function() {
  "use strict";
  /**
    `Polymer.IronJsonpLibraryBehavior` loads a jsonp library.
    Multiple components can request same library, only one copy will load.

    Some libraries require a specific global function be defined.
    If this is the case, specify the `callbackName` property.

    You should use an HTML Import to load library dependencies
    when possible instead of using this element.

    @hero hero.svg
    @demo demo/index.html
    @polymerBehavior
   */
  Polymer.IronJsonpLibraryBehavior = {

    properties: {
      /**
       * True if library has been successfully loaded
       */
      libraryLoaded: {
        type: Boolean,
        value: false,
        notify: true,
        readOnly: true
      },
      /**
       * Not null if library has failed to load
       */
      libraryErrorMessage: {
        type: String,
        value: null,
        notify: true,
        readOnly: true
      }
      // Following properties are to be set by behavior users
      /**
       * Library url. Must contain string `%%callback%%`.
       *
       * `%%callback%%` is a placeholder for jsonp wrapper function name
       *
       * Ex: https://maps.googleapis.com/maps/api/js?callback=%%callback%%
       * @property libraryUrl
       */
      /**
       * Set if library requires specific callback name.
       * Name will be automatically generated if not set.
       * @property callbackName
       */
      /**
       * name of event to be emitted when library loads. Standard is `api-load`
       * @property notifyEvent
       */
      /**
       * event with name specified in `notifyEvent` attribute
       * will fire upon successful load2
       * @event `notifyEvent`
       */
    },

    observers: [
      '_libraryUrlChanged(libraryUrl)'
    ],

    _libraryUrlChanged: function(libraryUrl) {
      // can't load before ready because notifyEvent might not be set
      if (this._isReady && this.libraryUrl)
        this._loadLibrary();
    },

    _libraryLoadCallback: function(err, result) {
      if (err) {
        console.warn("Library load failed:", err.message);
        this._setLibraryErrorMessage(err.message);
      }
      else {
        this._setLibraryErrorMessage(null);
        this._setLibraryLoaded(true);
        if (this.notifyEvent)
          this.fire(this.notifyEvent, result);
      }
    },

    /** loads the library, and fires this.notifyEvent upon completion */
    _loadLibrary: function() {
      LoaderMap.require(
        this.libraryUrl,
        this._libraryLoadCallback.bind(this),
        this.callbackName
      );
    },

    ready: function() {
      this._isReady = true;
      if (this.libraryUrl)
        this._loadLibrary();
    }
  };

  /**
   * LoaderMap keeps track of all Loaders
   */
  var LoaderMap = {
    apiMap: {}, // { hash -> Loader }

    /**
     * @param {Function} notifyCallback loaded callback fn(result)
     * @param {string} jsonpCallbackName name of jsonpcallback. If API does not provide it, leave empty. Optional.
     */
    require: function(url, notifyCallback, jsonpCallbackName) {

      // make hashable string form url
      var name = this.nameFromUrl(url);

      // create a loader as needed
      if (!this.apiMap[name])
        this.apiMap[name] = new Loader(name, url, jsonpCallbackName);

      // ask for notification
      this.apiMap[name].requestNotify(notifyCallback);
    },

    nameFromUrl: function(url) {
      return url.replace(/[\:\/\%\?\&\.\=\-\,]/g, '_') + '_api';
    }
  };

  /** @constructor */
  var Loader = function(name, url, callbackName) {
    this.notifiers = [];  // array of notifyFn [ notifyFn* ]

    // callback is specified either as callback name
    // or computed dynamically if url has callbackMacro in it
    if (!callbackName) {
      if (url.indexOf(this.callbackMacro) >= 0) {
        callbackName = name + '_loaded';
        url = url.replace(this.callbackMacro, callbackName);
      } else {
        this.error = new Error('IronJsonpLibraryBehavior a %%callback%% parameter is required in libraryUrl');
        // TODO(sjmiles): we should probably fallback to listening to script.load
        return;
      }
    }
    this.callbackName = callbackName;
    window[this.callbackName] = this.success.bind(this);
    this.addScript(url);
  };

  Loader.prototype = {

    callbackMacro: '%%callback%%',
    loaded: false,

    addScript: function(src) {
      var script = document.createElement('script');
      script.src = src;
      script.onerror = this.handleError.bind(this);
      var s = document.querySelector('script') || document.body;
      s.parentNode.insertBefore(script, s);
      this.script = script;
    },

    removeScript: function() {
      if (this.script.parentNode) {
        this.script.parentNode.removeChild(this.script);
      }
      this.script = null;
    },

    handleError: function(ev) {
      this.error = new Error("Library failed to load");
      this.notifyAll();
      this.cleanup();
    },

    success: function() {
      this.loaded = true;
      this.result = Array.prototype.slice.call(arguments);
      this.notifyAll();
      this.cleanup();
    },

    cleanup: function() {
      delete window[this.callbackName];
    },

    notifyAll: function() {
      this.notifiers.forEach( function(notifyCallback) {
        notifyCallback(this.error, this.result);
      }.bind(this));
      this.notifiers = [];
    },

    requestNotify: function(notifyCallback) {
      if (this.loaded || this.error) {
        notifyCallback( this.error, this.result);
      } else {
        this.notifiers.push(notifyCallback);
      }
    }
  };
})();
</script><script>
  Polymer({

    is: 'iron-jsonp-library',

    behaviors: [ Polymer.IronJsonpLibraryBehavior ],

    properties: {
      /**
       * Library url. Must contain string `%%callback%%`.
       *
       * `%%callback%%` is a placeholder for jsonp wrapper function name
       *
       * Ex: https://maps.googleapis.com/maps/api/js?callback=%%callback%%
       */
      libraryUrl: String,
      /**
       * Set if library requires specific callback name.
       * Name will be automatically generated if not set.
       */
      callbackName: String,
      /**
       * event with name specified in 'notifyEvent' attribute
       * will fire upon successful load
       */
      notifyEvent: String
      /**
       * event with name specified in 'notifyEvent' attribute
       * will fire upon successful load
       * @event `notifyEvent`
       */

    }
  });

</script><script>
  Polymer({

    is: 'google-maps-api',

    behaviors: [
      Polymer.IronJsonpLibraryBehavior
    ],

    properties: {

      /** @private */
      mapsUrl: {
        type: String,
        value: 'https://maps.googleapis.com/maps/api/js?callback=%%callback%%'
      },

      /**
       * A Maps API key. To obtain an API key, see developers.google.com/maps/documentation/javascript/tutorial#api_key.
       */
      apiKey: {
        type: String,
        value: ''
      },

      /**
       * A Maps API for Business Client ID. To obtain a Maps API for Business Client ID, see developers.google.com/maps/documentation/business/.
       * If set, a Client ID will take precedence over an API Key.
       */
      clientId: {
        type: String,
        value: ''
      },

      /**
       * Version of the Maps API to use.
       */
      version: {
        type: String,
        value: '3.exp'
      },

      /**
       * The localized language to load the Maps API with. For more information
       * see https://developers.google.com/maps/documentation/javascript/basics#Language
       *
       * Note: the Maps API defaults to the preffered language setting of the browser.
       * Use this parameter to override that behavior.
       */
      language: {
        type: String,
        value: ''
      },
      /**
       * If true, sign-in is enabled.
       * See https://developers.google.com/maps/documentation/javascript/signedin#enable_sign_in
       */
      signedIn: {
        type: Boolean,
        value: false
      },

      /**
       * Fired when the Maps API library is loaded and ready.
       * @event api-load
       */
      /**
       * Name of event fired when library is loaded and available.
       */
      notifyEvent: {
        type: String,
        value: 'api-load'
      },

      /** @private */
      libraryUrl: {
        type: String,
        computed: '_computeUrl(mapsUrl, version, apiKey, clientId, language, signedIn)'
      }
    },

    _computeUrl: function(mapsUrl, version, apiKey, clientId, language, signedIn) {
      var url = mapsUrl + '&v=' + version;

      // Always load all Maps API libraries.
      url += '&libraries=drawing,geometry,places,visualization';

      if (apiKey && !clientId) {
        url += '&key=' + apiKey;
      }

      if (clientId) {
        url += '&client=' + clientId;
      }

      // Log a warning if the user is not using an API Key or Client ID.
      if (!apiKey && !clientId) {
        var warning = 'No Google Maps API Key or Client ID specified. ' +
            'See https://developers.google.com/maps/documentation/javascript/get-api-key ' +
            'for instructions to get started with a key or client id.';
        console.warn(warning);
      }

      if (language) {
        url += '&language=' + language;
      }

      if (signedIn) {
        url += '&signed_in=' + signedIn;
      }
      return url;
    },

    /**
     * Provides the google.maps JS API namespace.
     */
    get api() {
      return google.maps;
    }
  });
</script>

<dom-module id="google-map-marker" assetpath="../google-map/">
  <style>
    :host {
      display: none;
    }
  </style>
  <template><content></content></template>
</dom-module>

<script>
(function() {

  function setupDragHandler_() {
    if (this.draggable) {
      this.dragHandler_ = google.maps.event.addListener(
          this.marker, 'dragend', onDragEnd_.bind(this));
    } else {
      google.maps.event.removeListener(this.dragHandler_);
      this.dragHandler_ = null;
    }
  }

  function onDragEnd_(e, details, sender) {
    this.latitude = e.latLng.lat();
    this.longitude = e.latLng.lng();
  }

  Polymer({

    is: 'google-map-marker',

    /**
     * Fired when the marker icon was clicked. Requires the clickEvents attribute to be true.
     * @param {google.maps.MouseEvent} event The mouse event.
     * @event google-map-marker-click
     */

    /**
     * Fired when the marker icon was double clicked. Requires the clickEvents attribute to be true.
     * @param {google.maps.MouseEvent} event The mouse event.
     * @event google-map-marker-dblclick
     */

    /**
     * Fired repeatedly while the user drags the marker. Requires the dragEvents attribute to be true.
     * @event google-map-marker-drag
     */

    /**
     * Fired when the user stops dragging the marker. Requires the dragEvents attribute to be true.
     * @event google-map-marker-dragend
     */

    /**
     * Fired when the user starts dragging the marker. Requires the dragEvents attribute to be true.
     * @event google-map-marker-dragstart
     */

    /**
     * Fired for a mousedown on the marker. Requires the mouseEvents attribute to be true.
     * @event google-map-marker-mousedown
     * @param {google.maps.MouseEvent} event The mouse event.
     */

    /**
     * Fired when the DOM `mousemove` event is fired on the marker. Requires the mouseEvents
     * attribute to be true.
     * @event google-map-marker-mousemove
     * @param {google.maps.MouseEvent} event The mouse event.
     */

    /**
     * Fired when the mouse leaves the area of the marker icon. Requires the mouseEvents attribute to be
     * true.
     * @event google-map-marker-mouseout
     * @param {google.maps.MouseEvent} event The mouse event.
     */

    /**
     * Fired when the mouse enters the area of the marker icon. Requires the mouseEvents attribute to be
     * true.
     * @event google-map-marker-mouseover
     * @param {google.maps.MouseEvent} event The mouse event.
     */

    /**
     * Fired for a mouseup on the marker. Requires the mouseEvents attribute to be true.
     *
     * @event google-map-marker-mouseup
     * @param {google.maps.MouseEvent} event The mouse event.
     */

    /**
     * Fired for a rightclick on the marker. Requires the clickEvents attribute to be true.
     * @event google-map-marker-rightclick
     * @param {google.maps.MouseEvent} event The mouse event.
     */

    /**
     * Fired when an infowindow is opened.
     * @event google-map-marker-open
     */

    /**
     * Fired when the close button of the infowindow is pressed.
     * @event google-map-marker-close
     */

    properties: {
      /**
       * A Google Maps marker object.
       * @type google.maps.Marker
       */
      marker: {
        type: Object,
        notify: true
      },

      /**
       * The Google map object.
       * @type google.maps.Map
       */
      map: {
        type: Object,
        observer: '_mapChanged'
      },

      /**
       * A Google Map Infowindow object.
       * @type {?Object}
       */
      info: {
        type: Object,
        value: null
      },

      /**
       * When true, marker *click events are automatically registered.
       */
      clickEvents: {
        type: Boolean,
        value: false,
        observer: '_clickEventsChanged'
      },

      /**
       * When true, marker drag* events are automatically registered.
       */
      dragEvents: {
        type: Boolean,
        value: false,
        observer: '_dragEventsChanged'
      },

      /**
       * Image URL for the marker icon.
       * @type string|google.maps.Icon|google.maps.Symbol
       */
      icon: {
        type: Object,
        value: null,
        observer: '_iconChanged'
      },

      /**
       * When true, marker mouse* events are automatically registered.
       */
      mouseEvents: {
        type: Boolean,
        value: false,
        observer: '_mouseEventsChanged'
      },

      /**
       * Z-index for the marker icon.
       */
      zIndex: {
        type: Number,
        value: 0,
        observer: '_zIndexChanged'
      },

      /**
       * The marker's longitude coordinate.
       */
      longitude: {
        type: Number,
        value: null,
        notify: true
      },

      /**
       * The marker's latitude coordinate.
       */
      latitude: {
        type: Number,
        value: null,
        notify: true
      },

      /**
       * A animation for the marker. "DROP" or "BOUNCE". See
       * https://developers.google.com/maps/documentation/javascript/examples/marker-animations.
       */
      animation: {
        type: String,
        value: null,
        observer: '_animationChanged'
      },

      /**
       * Specifies whether the InfoWindow is open or not
       */
      open: {
        type: Boolean,
        value: false,
        observer: '_openChanged'
      }
    },

    observers: [
      '_updatePosition(latitude, longitude)'
    ],

    detached: function() {
      if (this.marker) {
        google.maps.event.clearInstanceListeners(this.marker);
        this._listeners = {};
        this.marker.setMap(null);
      }
      if (this._contentObserver)
        this._contentObserver.disconnect();
    },

    attached: function() {
      // If element is added back to DOM, put it back on the map.
      if (this.marker) {
        this.marker.setMap(this.map);
      }
    },

    _updatePosition: function() {
      if (this.marker && this.latitude != null && this.longitude != null) {
        this.marker.setPosition(new google.maps.LatLng(
          parseFloat(this.latitude), parseFloat(this.longitude)));
      }
    },

    _clickEventsChanged: function() {
      if (this.map) {
        if (this.clickEvents) {
          this._forwardEvent('click');
          this._forwardEvent('dblclick');
          this._forwardEvent('rightclick');
        } else {
          this._clearListener('click');
          this._clearListener('dblclick');
          this._clearListener('rightclick');
        }
      }
    },

    _dragEventsChanged: function() {
      if (this.map) {
        if (this.dragEvents) {
          this._forwardEvent('drag');
          this._forwardEvent('dragend');
          this._forwardEvent('dragstart');
        } else {
          this._clearListener('drag');
          this._clearListener('dragend');
          this._clearListener('dragstart');
        }
      }
    },

    _mouseEventsChanged: function() {
      if (this.map) {
        if (this.mouseEvents) {
          this._forwardEvent('mousedown');
          this._forwardEvent('mousemove');
          this._forwardEvent('mouseout');
          this._forwardEvent('mouseover');
          this._forwardEvent('mouseup');
        } else {
          this._clearListener('mousedown');
          this._clearListener('mousemove');
          this._clearListener('mouseout');
          this._clearListener('mouseover');
          this._clearListener('mouseup');
        }
      }
    },

    _animationChanged: function() {
      if (this.marker) {
        this.marker.setAnimation(google.maps.Animation[this.animation]);
      }
    },

    _iconChanged: function() {
      if (this.marker) {
        this.marker.setIcon(this.icon);
      }
    },

    _zIndexChanged: function() {
      if (this.marker) {
        this.marker.setZIndex(this.zIndex);
      }
    },

    _mapChanged: function() {
      // Marker will be rebuilt, so disconnect existing one from old map and listeners.
      if (this.marker) {
        this.marker.setMap(null);
        google.maps.event.clearInstanceListeners(this.marker);
      }

      if (this.map && this.map instanceof google.maps.Map) {
        this._mapReady();
      }
    },

    _contentChanged: function() {
      if (this._contentObserver)
        this._contentObserver.disconnect();
      // Watch for future updates.
      this._contentObserver = new MutationObserver( this._contentChanged.bind(this));
      this._contentObserver.observe( this, {
        childList: true,
        subtree: true
      });

      var content = this.innerHTML.trim();
      if (content) {
        if (!this.info) {
          // Create a new infowindow
          this.info = new google.maps.InfoWindow();
          this.openInfoHandler_ = google.maps.event.addListener(this.marker, 'click', function() {
            this.open = true;
          }.bind(this));

          this.closeInfoHandler_ = google.maps.event.addListener(this.info, 'closeclick', function() {
            this.open = false;
          }.bind(this));
        }
        this.info.setContent(content);
      } else {
        if (this.info) {
          // Destroy the existing infowindow.  It doesn't make sense to have an empty one.
          google.maps.event.removeListener(this.openInfoHandler_);
          google.maps.event.removeListener(this.closeInfoHandler_);
          this.info = null;
        }
      }
    },

    _openChanged: function() {
      if (this.info) {
        if (this.open) {
          this.info.open(this.map, this.marker);
          this.fire('google-map-marker-open');
        } else {
          this.info.close();
          this.fire('google-map-marker-close');
        }
      }
    },

    _mapReady: function() {
      this._listeners = {};
      this.marker = new google.maps.Marker({
        map: this.map,
        position: {
          lat: parseFloat(this.latitude),
          lng: parseFloat(this.longitude)
        },
        title: this.title,
        animation: google.maps.Animation[this.animation],
        draggable: this.draggable,
        visible: !this.hidden,
        icon: this.icon,
        zIndex: this.zIndex
      });
      this._contentChanged();
      this._clickEventsChanged();
      this._dragEventsChanged();
      this._mouseEventsChanged();
      this._openChanged();
      setupDragHandler_.bind(this)();
    },

    _clearListener: function(name) {
      if (this._listeners[name]) {
        google.maps.event.removeListener(this._listeners[name]);
        this._listeners[name] = null;
      }
    },

    _forwardEvent: function(name) {
      this._listeners[name] = google.maps.event.addListener(this.marker, name, function(event) {
        this.fire('google-map-marker-' + name, event);
      }.bind(this));
    },

    attributeChanged: function(attrName) {
      if (!this.marker) {
        return;
      }

      // Cannot use *Changed watchers for native properties.
      switch (attrName) {
        case 'hidden':
          this.marker.setVisible(!this.hidden);
          break;
        case 'draggable':
          this.marker.setDraggable(this.draggable);
          setupDragHandler_.bind(this)();
          break;
        case 'title':
          this.marker.setTitle(this.title);
          break;
      }
    }
  });

})();
</script>
<dom-module id="google-map" assetpath="../google-map/">

  <style>
    :host {
      position: relative;
      display: block;
      height: 100%;
    }

    #map {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }

  </style>
  <template>

    <google-maps-api id="api" api-key="[[apiKey]]" client-id="[[clientId]]" version="[[version]]" signed-in="[[signedIn]]" language="[[language]]" on-api-load="_mapApiLoaded" maps-url="[[mapsUrl]]"></google-maps-api>

    <div id="map"></div>

    <iron-selector id="selector" multi="[[!singleInfoWindow]]" selected-attribute="open" activate-event="google-map-marker-open" on-google-map-marker-close="_deselectMarker">
      <content id="markers" select="google-map-marker"></content>
    </iron-selector>
    <content id="objects" select="*"></content>
  </template>
</dom-module>

<script>

  Polymer({

    is: 'google-map',


    /**
     * Fired when the Maps API has fully loaded.
     * @event google-map-ready
     */
    /**
     * Fired when the user clicks on the map (but not when they click on a marker, infowindow, or
     * other object). Requires the clickEvents attribute to be true.
     * @event google-map-click
     * @param {google.maps.MouseEvent} event The mouse event.
     */
    /**
     * Fired when the user double-clicks on the map. Note that the google-map-click event will also fire,
     * right before this one. Requires the clickEvents attribute to be true.
     * @event google-map-dblclick
     * @param {google.maps.MouseEvent} event The mouse event.
     */
    /**
     * Fired repeatedly while the user drags the map. Requires the dragEvents attribute to be true.
     * @event google-map-drag
     */
    /**
     * Fired when the user stops dragging the map. Requires the dragEvents attribute to be true.
     * @event google-map-dragend
     */
    /**
     * Fired when the user starts dragging the map. Requires the dragEvents attribute to be true.
     * @event google-map-dragstart
     */
    /**
     * Fired whenever the user's mouse moves over the map container. Requires the mouseEvents attribute to
     * be true.
     * @event google-map-mousemove
     * @param {google.maps.MouseEvent} event The mouse event.
     */
    /**
     * Fired when the user's mouse exits the map container. Requires the mouseEvents attribute to be true.
     * @event google-map-mouseout
     * @param {google.maps.MouseEvent} event The mouse event.
     */
    /**
     * Fired when the user's mouse enters the map container. Requires the mouseEvents attribute to be true.
     * @event google-map-mouseover
     * @param {google.maps.MouseEvent} event The mouse event.
     */
    /**
     * Fired when the DOM `contextmenu` event is fired on the map container. Requires the clickEvents
     * attribute to be true.
     * @event google-map-rightclick
     * @param {google.maps.MouseEvent} event The mouse event.
     */
    /**
     * Fired when the map becomes idle after panning or zooming.
     * @event google-map-idle
    */

    /**
     * Polymer properties for the google-map custom element.
     */
    properties: {
      /**
       * A Maps API key. To obtain an API key, see https://developers.google.com/maps/documentation/javascript/tutorial#api_key.
       */
      apiKey: String,

      /**
       * Overrides the origin the Maps API is loaded from. Defaults to `https://maps.googleapis.com`.
       */
      mapsUrl: {
        type: String
        // Initial value set in google-maps-api.
      },

      /**
       * A Maps API for Business Client ID. To obtain a Maps API for Business Client ID, see https://developers.google.com/maps/documentation/business/.
       * If set, a Client ID will take precedence over an API Key.
       */
      clientId: String,

      /**
       * A latitude to center the map on.
       */
      latitude: {
        type: Number,
        value: 37.77493,
        notify: true,
        reflectToAttribute: true
      },

      /**
       * A Maps API object.
       */
      map: {
        type: Object,
        notify: true,
        value: null
      },

      /**
       * A longitude to center the map on.
       */
      longitude: {
        type: Number,
        value: -122.41942,
        notify: true,
        reflectToAttribute: true
      },

      /**
       * A kml file to load.
       */
      kml: {
        type: String,
        value: null,
        observer: '_loadKml'
      },

      /**
       * A zoom level to set the map to.
       */
      zoom: {
        type: Number,
        value: 10,
        observer: '_zoomChanged',
        notify: true
      },

      /**
       * When set, prevents the map from tilting (when the zoom level and viewport supports it).
       */
      noAutoTilt: {
        type: Boolean,
        value: false
      },

      /**
       * Map type to display. One of 'roadmap', 'satellite', 'hybrid', 'terrain'.
       */
      mapType: {
        type: String,
        value: 'roadmap', // roadmap, satellite, hybrid, terrain,
        observer: '_mapTypeChanged',
        notify: true
      },

      /**
       * Version of the Google Maps API to use.
       */
      version: {
        type: String,
        value: '3.exp'
      },

      /**
       * If set, removes the map's default UI controls.
       */
      disableDefaultUi: {
        type: Boolean,
        value: false,
        observer: '_disableDefaultUiChanged'
      },

      /**
       * If set, removes the map's 'map type' UI controls.
       */
      disableMapTypeControl: {
        type: Boolean,
        value: false,
        observer: '_disableMapTypeControlChanged'
      },

      /**
       * If set, removes the map's 'street view' UI controls.
       */
      disableStreetViewControl: {
        type: Boolean,
        value: false,
        observer: '_disableStreetViewControlChanged'
      },

      /**
       * If set, the zoom level is set such that all markers (google-map-marker children) are brought into view.
       */
      fitToMarkers: {
        type: Boolean,
        value: false,
        observer: '_fitToMarkersChanged'
      },

      /**
       * If true, prevent the user from zooming the map interactively.
       */
      disableZoom: {
        type: Boolean,
        value: false,
        observer: '_disableZoomChanged'
      },

      /**
       * If set, custom styles can be applied to the map.
       * For style documentation see https://developers.google.com/maps/documentation/javascript/reference#MapTypeStyle
       */
      styles: {
        type: Object,
        value: function() { return {}; }
      },

      /**
       * A maximum zoom level which will be displayed on the map.
       */
      maxZoom: {
        type: Number,
        observer: '_maxZoomChanged'
      },

      /**
       * A minimum zoom level which will be displayed on the map.
       */
      minZoom: {
        type: Number,
        observer: '_minZoomChanged'
      },

      /**
       * If true, sign-in is enabled.
       * See https://developers.google.com/maps/documentation/javascript/signedin#enable_sign_in
       */
      signedIn: {
        type: Boolean,
        value: false
      },

      /**
       * The localized language to load the Maps API with. For more information
       * see https://developers.google.com/maps/documentation/javascript/basics#Language
       *
       * Note: the Maps API defaults to the preffered language setting of the browser.
       * Use this parameter to override that behavior.
       */
      language: {
        type: String
      },

      /**
       * When true, map *click events are automatically registered.
       */
      clickEvents: {
        type: Boolean,
        value: false,
        observer: '_clickEventsChanged'
      },

      /**
       * When true, map drag* events are automatically registered.
       */
      dragEvents: {
        type: Boolean,
        value: false,
        observer: '_dragEventsChanged'
      },

      /**
       * When true, map mouse* events are automatically registered.
       */
      mouseEvents: {
        type: Boolean,
        value: false,
        observer: '_mouseEventsChanged'
      },

      /**
       * Additional map options for google.maps.Map constructor.
       * Use to specify additional options we do not expose as
       * properties.
       * Ex: `<google-map additional-map-options='{"mapTypeId":"satellite"}'>`
       *
       * Note, you can't use API enums like `google.maps.ControlPosition.TOP_RIGHT`
       * when using this property as an HTML attribute. Instead, use the actual
       * value (e.g. `3`) or set `.additionalMapOptions` in JS rather than using
       * the attribute.
       */
      additionalMapOptions: {
        type: Object,
        value: function() { return {}; }
      },

      /**
       * The markers on the map.
       */
      markers: {
        type: Array,
        value: function() { return []; },
        readOnly: true
      },

      /**
       * The non-marker objects on the map.
       */
      objects: {
        type: Array,
        value: function() { return []; },
        readOnly: true
      },

      /**
       * If set, all other info windows on markers are closed when opening a new one.
       */
      singleInfoWindow: {
        type: Boolean,
        value: false
      }
    },

    behaviors: [
      Polymer.IronResizableBehavior
    ],

    listeners: {
      'iron-resize': 'resize'
    },

    observers: [
      '_debounceUpdateCenter(latitude, longitude)'
    ],

    attached: function() {
      this._initGMap();
    },

    detached: function() {
      if (this._markersChildrenListener) {
        this.unlisten(this.$.selector, 'items-changed', '_updateMarkers');
        this._markersChildrenListener = null;
      }
      if (this._objectsMutationObserver) {
        this._objectsMutationObserver.disconnect();
        this._objectsMutationObserver = null;
      }
    },

    _initGMap: function() {
      if (this.map) {
        return; // already initialized
      }
      if (this.$.api.libraryLoaded !== true) {
        return; // api not loaded
      }
      if (!this.isAttached) {
        return; // not attached
      }

      this.map = new google.maps.Map(this.$.map, this._getMapOptions());
      this._listeners = {};
      this._updateCenter();
      this._loadKml();
      this._updateMarkers();
      this._updateObjects();
      this._addMapListeners();
      this.fire('google-map-ready');
    },

    _mapApiLoaded: function() {
      this._initGMap();
    },

    _getMapOptions: function() {
      var mapOptions = {
        zoom: this.zoom,
        tilt: this.noAutoTilt ? 0 : 45,
        mapTypeId: this.mapType,
        disableDefaultUI: this.disableDefaultUi,
        mapTypeControl: !this.disableDefaultUi && !this.disableMapTypeControl,
        streetViewControl: !this.disableDefaultUi && !this.disableStreetViewControl,
        disableDoubleClickZoom: this.disableZoom,
        scrollwheel: !this.disableZoom,
        styles: this.styles,
        maxZoom: Number(this.maxZoom),
        minZoom: Number(this.minZoom)
      };

      // Only override the default if set.
      // We use getAttribute here because the default value of this.draggable = false even when not set.
      if (this.getAttribute('draggable') != null) {
        mapOptions.draggable = this.draggable
      }
      for (var p in this.additionalMapOptions)
        mapOptions[p] = this.additionalMapOptions[p];

      return mapOptions;
    },

    _attachChildrenToMap: function(children) {
      if (this.map) {
        for (var i = 0, child; child = children[i]; ++i) {
          child.map = this.map;
        }
      }
    },

    // watch for future updates to marker objects
    _observeMarkers: function() {
      // Watch for future updates.
      if (this._markersChildrenListener) {
        return;
      }
      this._markersChildrenListener = this.listen(this.$.selector, 'items-changed', '_updateMarkers');
    },

    _updateMarkers: function() {
      var newMarkers = Array.prototype.slice.call(
          Polymer.dom(this.$.markers).getDistributedNodes());

      // do not recompute if markers have not been added or removed
      if (newMarkers.length === this.markers.length) {
        var added = newMarkers.filter(function(m) {
          return this.markers && this.markers.indexOf(m) === -1;
        }.bind(this));
        if (added.length === 0) {
          // set up observer first time around
          if (!this._markersChildrenListener) {
            this._observeMarkers();
          }
          return;
        }
      }

      this._observeMarkers();

      this.markers = this._setMarkers(newMarkers);

      // Set the map on each marker and zoom viewport to ensure they're in view.
      this._attachChildrenToMap(this.markers);
      if (this.fitToMarkers) {
        this._fitToMarkersChanged();
      }
    },

    // watch for future updates to non-marker objects
    _observeObjects: function() {
      if (this._objectsMutationObserver) {
        return;
      }
      this._objectsMutationObserver = new MutationObserver(this._updateObjects.bind(this));
      this._objectsMutationObserver.observe(this, {
        childList: true
      });
    },

    _updateObjects: function() {
      var newObjects = Array.prototype.slice.call(
          Polymer.dom(this.$.objects).getDistributedNodes());

      // Do not recompute if objects have not been added or removed.
      if (newObjects.length === this.objects.length) {
        var added = newObjects.filter(function(o) {
          return this.objects.indexOf(o) === -1;
        }.bind(this));
        if (added.length === 0) {
          // Set up observer first time around.
          this._observeObjects();
          return;
        }
      }

      this._observeObjects();
      this._setObjects(newObjects);
      this._attachChildrenToMap(this.objects);
    },

    /**
     * Clears all markers from the map.
     *
     * @method clear
     */
    clear: function() {
      for (var i = 0, m; m = this.markers[i]; ++i) {
        m.marker.setMap(null);
      }
    },

    /**
     * Explicitly resizes the map, updating its center. This is useful if the
     * map does not show after you have unhidden it.
     *
     * @method resize
     */
    resize: function() {
      if (this.map) {

        // saves and restores latitude/longitude because resize can move the center
        var oldLatitude = this.latitude;
        var oldLongitude = this.longitude;
        google.maps.event.trigger(this.map, 'resize');
        this.latitude = oldLatitude;  // restore because resize can move our center
        this.longitude = oldLongitude;

        if (this.fitToMarkers) { // we might not have a center if we are doing fit-to-markers
          this._fitToMarkersChanged();
        }
      }
    },

    _loadKml: function() {
      if (this.map && this.kml) {
        var kmlfile = new google.maps.KmlLayer({
          url: this.kml,
          map: this.map
        });
      }
    },

    _debounceUpdateCenter: function() {
      this.debounce('updateCenter', this._updateCenter);
    },

    _updateCenter: function() {
      this.cancelDebouncer('updateCenter');

      if (this.map && this.latitude !== undefined && this.longitude !== undefined) {
        // allow for latitude and longitude to be String-typed, but still Number valued
        var lati = Number(this.latitude);
        if (isNaN(lati)) {
          throw new TypeError('latitude must be a number');
        }
        var longi = Number(this.longitude);
        if (isNaN(longi)) {
          throw new TypeError('longitude must be a number');
        }

        var newCenter = new google.maps.LatLng(lati, longi);
        var oldCenter = this.map.getCenter();

        if (!oldCenter) {
          // If the map does not have a center, set it right away.
          this.map.setCenter(newCenter);
        } else {
          // Using google.maps.LatLng returns corrected lat/lngs.
          oldCenter = new google.maps.LatLng(oldCenter.lat(), oldCenter.lng());

          // If the map currently has a center, slowly pan to the new one.
          if (!oldCenter.equals(newCenter)) {
            this.map.panTo(newCenter);
          }
        }
      }
    },

    _zoomChanged: function() {
      if (this.map) {
        this.map.setZoom(Number(this.zoom));
      }
    },

    _idleEvent: function() {
      if (this.map) {
        this._forwardEvent('idle');
      } else {
        this._clearListener('idle');
      }
    },

    _clickEventsChanged: function() {
      if (this.map) {
        if (this.clickEvents) {
          this._forwardEvent('click');
          this._forwardEvent('dblclick');
          this._forwardEvent('rightclick');
        } else {
          this._clearListener('click');
          this._clearListener('dblclick');
          this._clearListener('rightclick');
        }
      }
    },

    _dragEventsChanged: function() {
      if (this.map) {
        if (this.dragEvents) {
          this._forwardEvent('drag');
          this._forwardEvent('dragend');
          this._forwardEvent('dragstart');
        } else {
          this._clearListener('drag');
          this._clearListener('dragend');
          this._clearListener('dragstart');
        }
      }
    },

    _mouseEventsChanged: function() {
      if (this.map) {
        if (this.mouseEvents) {
          this._forwardEvent('mousemove');
          this._forwardEvent('mouseout');
          this._forwardEvent('mouseover');
        } else {
          this._clearListener('mousemove');
          this._clearListener('mouseout');
          this._clearListener('mouseover');
        }
      }
    },

    _maxZoomChanged: function() {
      if (this.map) {
        this.map.setOptions({maxZoom: Number(this.maxZoom)});
      }
    },

    _minZoomChanged: function() {
      if (this.map) {
        this.map.setOptions({minZoom: Number(this.minZoom)});
      }
    },

    _mapTypeChanged: function() {
      if (this.map) {
        this.map.setMapTypeId(this.mapType);
      }
    },

    _disableDefaultUiChanged: function() {
      if (!this.map) {
        return;
      }
      this.map.setOptions({disableDefaultUI: this.disableDefaultUi});
    },

    _disableMapTypeControlChanged: function() {
      if (!this.map) {
        return;
      }
      this.map.setOptions({mapTypeControl: !this.disableMapTypeControl});
    },

    _disableStreetViewControlChanged: function() {
      if (!this.map) {
        return;
      }
      this.map.setOptions({streetViewControl: !this.disableStreetViewControl});
    },

    _disableZoomChanged: function() {
      if (!this.map) {
        return;
      }
      this.map.setOptions({
        disableDoubleClickZoom: this.disableZoom,
        scrollwheel: !this.disableZoom
      });
    },

    attributeChanged: function(attrName) {
      if (!this.map) {
        return;
      }
      // Cannot use *Changed watchers for native properties.
      switch (attrName) {
        case 'draggable':
          this.map.setOptions({draggable: this.draggable});
          break;
      }
    },

    _fitToMarkersChanged: function() {
      // TODO(ericbidelman): respect user's zoom level.

      if (this.map && this.fitToMarkers && this.markers.length > 0) {
        var latLngBounds = new google.maps.LatLngBounds();
        for (var i = 0, m; m = this.markers[i]; ++i) {
          latLngBounds.extend(
              new google.maps.LatLng(m.latitude, m.longitude));
        }

        // For one marker, don't alter zoom, just center it.
        if (this.markers.length > 1) {
          this.map.fitBounds(latLngBounds);
        }

        this.map.setCenter(latLngBounds.getCenter());
      }
    },

    _addMapListeners: function() {
      google.maps.event.addListener(this.map, 'center_changed', function() {
        var center = this.map.getCenter();
        this.latitude = center.lat();
        this.longitude = center.lng();
      }.bind(this));

      google.maps.event.addListener(this.map, 'zoom_changed', function() {
        this.zoom = this.map.getZoom();
      }.bind(this));

      google.maps.event.addListener(this.map, 'maptypeid_changed', function() {
        this.mapType = this.map.getMapTypeId();
      }.bind(this));

      this._clickEventsChanged();
      this._dragEventsChanged();
      this._mouseEventsChanged();
      this._idleEvent();
    },

    _clearListener: function(name) {
      if (this._listeners[name]) {
        google.maps.event.removeListener(this._listeners[name]);
        this._listeners[name] = null;
      }
    },

    _forwardEvent: function(name) {
      this._listeners[name] = google.maps.event.addListener(this.map, name, function(event) {
        this.fire('google-map-' + name, event);
      }.bind(this));
    },

   _deselectMarker: function(e, detail) {
     // If singleInfoWindow is set, update iron-selector's selected attribute to be null.
     // Else remove the marker from iron-selector's selected array.
     var markerIndex = this.$.selector.indexOf(e.target);

     if (this.singleInfoWindow) {
      this.$.selector.selected = null;
     } else if (this.$.selector.selectedValues) {
      this.$.selector.selectedValues = this.$.selector.selectedValues.filter(function(i) {return i !== markerIndex});
     }
   }

  });

</script>
<link rel="import" hef="geo-location/geo-location.html"><script>
(function() {
	Polymer({
		is: "triplat-geo",

		/**
		 * Fired after finding the geo location successfully.
		 * The event detail includes the detected latitude and longitude.
		 *
		 * @event triplat-geo-success
		 */

		/**
		 * Fired after finding the geo location with no success.
		 *
		 * @event triplat-geo-error
		 */

		properties:{
			/**
			 * The current longitude of the device.
			 */
			longitude:{
				type: Number,
				reflectToAttribute: true,
				notify: true,
				readOnly: true,
			},
			/**
			 * The current latitude of the device.
			 */
			latitude:{
				type: Number,
				reflectToAttribute: true,
				notify: true,
				readOnly: true,
			}, 
			/**
			 * The length of time (millisecond) that the device accepts cached positions. 
			 */
			maximumAge: {
				type: Number,
				value: 600000
			},
			/**
			 * The length of time (millisecond) that the device is taken to return the coordinates.  
			 */
			timeOut: {
				type: Number,
				value: 10000
			},
			/**
			 * A number that representing the accuracy of the coordinates (latitude and longitude) express in meters. 
			 */
			accuracy: {
				type: Number,
				reflectToAttribute: true,
				readOnly: true,
				notify: true,
			},
			/**
			 * Set to <b>true</b> will update the current position information when the device is moved or more accurate location is detected.
			 */
			isWatchPosition:{
				type: Boolean,
				value: false
			},

			/**
			 * A flag to disable the detection of location.
			 */
			disable: {
				type: Boolean,
				notify: false,
				readOnly: false,
				value: false,
				observer: "_onDisableChanged"
			},
			/**
			 * Flag that allows the second attempt to fetch the current location if the high accuracy failed. 
			 */
			_attemptLowerAccuracy:{
				type: Boolean,
				value: false
			},

			_geoResponseOccurred: {
				type: Boolean,
				value: false,
				readOnly: true
			}
		},

		attached: function() {
			this.async(function() {
				if(!this.disable) {
					this._getCoordinates();
				}
			});
		},

		_onDisableChanged: function(disable, oldDisable) {
			if (oldDisable && !disable) {
				this._getCoordinates();
			}
		},

		_getCoordinates: function() {
			this._set_geoResponseOccurred(false);
			var success = this._success.bind(this);
			var watchPositionId;
			var error = this._error.bind(this);
			var options = {
				maximumAge: this.maximumAge,
				timeout: this.timeOut,
				enableHighAccuracy: true
			};
			if (this._attemptLowerAccuracy) {
				options.enableHighAccuracy = false;
			}
			if (this.isWatchPosition) {
				watchPositionId = navigator.geolocation.watchPosition(success, error, options);
			} else {
				navigator.geolocation.getCurrentPosition(success, error, options);
			}

			// Set timeout to call error after the timeout time.
			// This is necessary for Firefox and Edge browsers when the user ignores the permission popup.
			window.setTimeout(function() {
				if (!this._geoResponseOccurred) {
					this._error();
				}
			}.bind(this), options.timeout);
		},

		_success: function(position) {
			this._set_geoResponseOccurred(true);
			this._setLatitude(position.coords.latitude);
			this._setLongitude(position.coords.longitude);
			this._setAccuracy(position.coords.accuracy);
			this.fire('triplat-geo-success', {lat: position.coords.latitude, lng: position.coords.longitude});
			return;
		},

		_error: function(position) {
			// attempt lower accuracy
			if (!this._attemptLowerAccuracy) {
				this.set("_attemptLowerAccuracy", true);
				this._getCoordinates();
				return;
			}
			if (!this.isWatchPosition) {
				this._set_geoResponseOccurred(true);
				console.warn("Couldn't retrieve the current location");
				this.fire('triplat-geo-error');
			}
		}

	})
})();
</script><dom-module id="triplat-search-location" assetpath="../triplat-search-location/">
	<template>
		<triplat-geo id="geoLocation" latitude="{{latitude}}" longitude="{{longitude}}" accuracy="{{accuracy}}" is-watch-position="{{isWatchPosition}}" time-out="{{timeOut}}" maximum-age="{{maximumAge}}" disable="{{disable}}">
		</triplat-geo>
	</template>
</dom-module>
<script>
	Polymer({
		is: "triplat-search-location",

		/**
	     * Fired after finding the geo location successfully.
		 * The event detail includes the detected latitude and longitude.
	     *
	     * @event triplat-geo-success
	     */

	     /**
	     * Fired after finding the geo location with no success.
	     *
	     * @event triplat-geo-error
	     */

		properties: {
			/**
			 * The length of time (millisecond) that the device is given to return the coordinates.  
			 */
			timeOut: {
				type: Number,
				value: 10000
			},
			/**
			 * Set to <b>true</b> will update the current position information when the device is moved or 
			 * a more accurate location is detected.
			 */
			isWatchPosition:{
				type: Boolean,
				value: false
			},
			/**
			 * A number that represents the accuracy of the coordinates (latitude and longitude) in meters. 
			 */
			accuracy: {
				type: Number,
				readOnly: true,
				notify: true,

			},
			/**
			 * The length of time (milliseconds) that the device accepts cached positions. 
			 */
			maximumAge: {
				type: Number,
				value: 600000
			},
			/*
			 * The locations data object to which the data source values can be bound.
			 */
			locations: {
				type: Object,
				notify: true,
				readOnly: false
			},
			/*
			 * The radius(meters) of a circle around the position of
			 * the user where locations can be found.
			 */
			threshold: {
		        type: Number,
		        value: 100
			},
			/*
			 * An array of locations found within the 
			 * threshold.
			 */
			locationsWithinThreshold: {
		        type: Object,
		        notify: true,
		        value: null
			},
			/*
			 * Closest location found.
			 */
			closestLocation: {
		        type: Object,
		        notify: true,
		        value: null
			},
			/*
			 * Closest distance found.
			 */
			closestDistance: {
		        type: Number,
		        notify: true,
		        value: 0
			},
			/**
			 * A flag to disable the detection of a location.
			 */
			disable: {
				type: Boolean,
				notify: false,
				readOnly: false,
				observer: "_disableChanged"
			},
			_geoLocationFound: {
				type: Boolean,
				value: false,
				readOnly: true
			},
		},

		listeners: {
			'geoLocation.triplat-geo-success': '_handleSuccessGeoLocation'
		},

		observers: [
            "_findLocation(locations.*, _geoLocationFound)"
		],

		_handleSuccessGeoLocation: function(){
			this._set_geoLocationFound(true);
		},

		_findLocation: function(change, geoLocationFound){
			if(!geoLocationFound){
				return;
			}
			if(change.path == "locations"
				&& change.value && change.value.length > 0){
                this._findClosestLocation(change.value);
			}
		},

		_findClosestLocation: function(value){
			if (!this.disable) {
				var locations = value;
	            var tmpLocationsWithinThreshold = [];
				var tmpClosestLocation = null;
				var tmpClosestDistance = -1;
				for (var i = 0; i < locations != null && i < locations.length; i++) {
					var location = locations[i];
					var distance = this._getDistanceBetween(this.latitude, this.longitude, location.latitude, location.longitude);
					//within Location Threshold
					if(distance <= this.threshold){
						tmpLocationsWithinThreshold.push(location);
					}
					//closest location
					if(tmpClosestDistance == -1 || tmpClosestDistance > distance){
						tmpClosestDistance = distance;
						tmpClosestLocation = location;
					}
				};
				this.set("locationsWithinThreshold", tmpLocationsWithinThreshold.length > 0 ? 
					tmpLocationsWithinThreshold : []);
				if(tmpClosestDistance > -1){
					this.set("closestDistance", tmpClosestDistance);
					this.set("closestLocation", tmpClosestLocation);
				}
			}
		},

		/**
		* Implements the haversine formula to determine 
		* the great-circle distance between two
		* points on a sphere given their latitudes
		* and longitudes.
		*/
		_getDistanceBetween: function(lat1, lng1, lat2, lng2) {
	  		var earthRadius = 6371;
	  	  	var latitudeDistance = this._degreeToRadians(lat2-lat1);
	  	  	var longitudeDistance = this._degreeToRadians(lng2-lng1);
		  	var a = Math.sin(latitudeDistance/2) * 
		  		Math.sin(latitudeDistance/2) +
		    	Math.cos(this._degreeToRadians(lat1)) * 
		    	Math.cos(this._degreeToRadians(lat2)) * 
		    	Math.sin(longitudeDistance/2) * 
		    	Math.sin(longitudeDistance/2); 
		  	var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
		  	return (earthRadius * c) * 1000;
		},

		_degreeToRadians: function(value){
			return value * (Math.PI / 180);
		},

		_disableChanged: function(disable){
			if(disable){
				this._set_geoLocationFound(false);
				this.set("closestLocation", null);
				this.set("closestDistance", 0);
			}
		},
	});
</script>


<script>

	/**
	 * A behavior to validate if the size of a file exceeds the maximum allowed by the 
	 * MAXIMUM_UPLOAD_FILE_SIZE_MEGABYTES parameter in the TRIRIGAWEB.properties.
	 * 
	 * @polymerBehavior TriplatFileSizeValidationBehavior
	 *
	 */
	TriplatFileSizeValidationBehavior = {
			
		properties: {
			_maximumFileSizeForUpload: {
				type: Number,
				value: 0
			}
		},
			
		/**
		 * Check if the size of the file exceeds the maximum allowed by the MAXIMUM_UPLOAD_FILE_SIZE_MEGABYTES
		 * parameter.
		 * Returns resolved promise if the file size is less than or equals the maximum allowed by the 
		 * MAXIMUM_UPLOAD_FILE_SIZE_MEGABYTES
		 * Otherwise returns a rejected promise.
		 */
		 checkFileSize: function(file) {
			var promiseResolve, promiseReject;
			var promise = new Promise(
				function(resolve, reject) {
					promiseResolve = resolve;
					promiseReject = reject;
				}
			);

			this.getMaximumFileSizeForUpload()
				.then(this._doCheckFileSize.bind(this, file, promiseResolve, promiseReject));

			return promise;
		},

		_doCheckFileSize: function(file, resolve, reject, maximumFileSize) {
			if (file.size > maximumFileSize) {
				reject(maximumFileSize);
			} else {
				resolve(maximumFileSize);
			}
		},

		/**
		 * Returns a promise resolved to the number specified by the MAXIMUM_UPLOAD_FILE_SIZE_MEGABYTES
		 * parameter in the TRIRIGAWEB.properties.
		 */
		getMaximumFileSizeForUpload: function() {
			if (this._maximumFileSizeForUpload > 0) {
				return Promise.resolve(this._maximumFileSizeForUpload);
			} else {
				var tricoreUrl = document.createElement('tricore-url');
				var getMaxFileSizeUrl = tricoreUrl.getUrl("/p/fileupload/maximumFileSizeForUpload");
				var request = document.createElement('iron-request');
				var requestOptions = {
					url: getMaxFileSizeUrl,
					method: "GET",
					handleAs: "json"
				};		       
					request.send(requestOptions);
					return request.completes
							.then(this._getMaximumFileSizeForUploadResponse.bind(this))
							.catch(Promise.resolve.bind(Promise, 0));
				}
		},
		
		_getMaximumFileSizeForUploadResponse: function(request) {
			return this._maximumFileSizeForUpload = request.response.maximumFileSizeForUpload;
		}
	}
</script><script>
	(function() {
		var singleton = null;
		
		var serverOnline = true;
		var instances = [];
		
		TriplatServerStatus = Polymer({
			is: 'triplat-server-status',
			
			properties: {
				
				/**
				 * Returns the online status of the TRIRIGA Server.
				 */
				online: {
					type: Boolean,
					notify: true,
					readOnly: true,
					value: true
				}
			},
			
			attached: function() {
				this._register();
				this._notifyServerStatusChanged();
			},
			
			detached: function() {
				this._unregister();
			},
			
			isServerOnline: function() {
				return serverOnline;
			},
			
			_register: function () {
				instances.push(this);
			},

			_unregister: function () {
				var index = instances.indexOf(this);
				if (index > -1) {
					instances.splice(index, 1);
				}
			},
			
			_notifyServerStatusChanged: function() {
				this._setOnline(this.isServerOnline());
			}
		});
		
		TriplatServerStatus.getInstance = function () {
			if (singleton === null) {
				singleton = new TriplatServerStatus();
			}
			return singleton;
		};
		
		TriplatServerStatus.notifyServerStatusChanged = function (online) {
			serverOnline = online;
			instances.forEach(function(instance) {
				instance._notifyServerStatusChanged();
			});
		};
	})();
</script><script>

	/**
	 * A behavior to fix the orientation of jpeg images.
	 * The camera does not rotate the image according to the camera position/orientation. 
	 * The camera just adds an EXIF header that indicates the orientation of the image on the moment it was taken.
	 * The program showing the image is responsible to rotate the image according to the orientation field.
	 * The HTML img element does not read this orientation field.
	 * So the solution is to read the image before uploading, and if it has an orientation field then 
	 * rotate the image before sending to the server.
	 * @polymerBehavior TriplatImageOrientationBehavior
	 *
	 */
	TriplatImageOrientationBehavior = {
			
		/**
		 * If the file parameter is a jpeg and if it has an orientation metadata then 
		 * this method returns a promise resolved to the image rotated according to its orientation.
		 * Otherwise returned a rejected promise.
		 */
		_fixImageOrientation: function(file) {
			if (file.type === undefined || file.type != "image/jpeg") {
				return Promise.reject("Image type has no orientation");
			}
			return this._readImageHeader(file)
					.then(this._readOrientation.bind(this))
					.then(this._readImage.bind(this, file))
					.then(this._rotateImage.bind(this));
		},

		_readImageHeader: function(file) {
			return new Promise(
				function(resolve, reject) {
					var reader = new FileReader();
					reader.onload = function() {
						resolve(reader.result);
					};
					reader.onerror = reject;
					/*
					 * Pull out the first 128kb of the image to limit load.
					 * EXIF should exist in the first 128kb.
					 */
					reader.readAsArrayBuffer(file.slice(0, 131072));
				}.bind(this)
			);
		},

		_readImage: function(file, orientation) {
			return new Promise(
				function(resolve, reject) {
					var reader = new FileReader();
					reader.onload = function() {
						var img = document.createElement("img");
						img.onload = function() {
  							resolve({img: img, orientation: orientation});
						};
						img.src = reader.result;
						img.onerror = reject;
					};
					reader.onerror = reject;
					reader.readAsDataURL(file);					
				}.bind(this)
			);
		},

		/**
		 * Read the orientation of the image from the EXIF metadata.
		 * It will return rejected promise if the image is not a JPEG.
		 * It Will return rejected promise if cannot find the EXIF marker.
		 * Ref: https://www.media.mit.edu/pia/Research/deepview/exif.html
		 */
		_readOrientation: function(arrayBuffer) {
			try {
				var dataView = new DataView(arrayBuffer);

				if (dataView.getUint16(0) != 0xFFD8 /*SOI Marker*/) {
				    throw "Is is not a JPEG image";
				}

				var offset = 2;
				var length = arrayBuffer.byteLength;
				var marker;

				while (offset < length) {
					marker = dataView.getUint16(offset);
					offset += 2; //Skip current marker

					if ((marker & 0xFF00) != 0xFF00) {
						throw "Image has an invalid marker";
					}

					if (marker == 0xFFE1) {
						// Found the APP1 EXIF marker
						return this._readOrientationFromEXIF({dataView:dataView, offset:offset});
					} else {
						offset += dataView.getUint16(offset);//Skip current marker data
					}
				}
			} catch (err) {
				return Promise.reject(err);
			}
		},

		_readOrientationFromEXIF: function(exif) {
			exif.offset += 2; // Skip EXIFDataSize
			this._isValidEXIFHeader(exif);
			this._readByteAlignment(exif);
			this._moveToFirstIFDOffset(exif);
			this._readNumberOfDirectoryEntries(exif);
			return this._getOrientationTagData(exif);
		},

		/*
		 * Exif data is starts by an EXIF header composed by ASCII characters "Exif" and 2 bytes of 0x00.
		 * Which gives a 6 byte sequence: 0x45786966 + 0x0000
		 */
		_isValidEXIFHeader: function(exif) {
			if(exif.dataView.getUint32(exif.offset) != 0x45786966) {
				throw "Invalid EXIF Header";
			};
			exif.offset += 6;// Skip EXIF header
		},

		/**
		 * Read the byte alignment for the TIFF data.
		 */
		_readByteAlignment: function(exif) {
			// Read the first two bytes of the TIFF header to determine the byte align of TIFF data.
			var littleEndian = false;
			var byteAlignment = exif.dataView.getUint16(exif.offset);
			if (byteAlignment == 0x4949 || byteAlignment == 0x4D4D) {
				littleEndian = byteAlignment == 0x4949;
			} else {
				throw "Invalid TIFF byte align"; 
			}
			exif.offset += 2;// Skip TIFF byte align

			// Next 2 bytes are always the value of 0x002A
			if (exif.dataView.getUint16(exif.offset, littleEndian) != 0x002A) {
				throw "Invalid TIFF data";
			}
			exif.offset += 2;// Skip TIFF 0x002A
			exif.littleEndian = littleEndian;
		},

		/**
		 * Move the EXIF offset to the first Image File Directory.
		 */
		_moveToFirstIFDOffset: function(exif) {
			// The last 4bytes of TIFF header are an offset to the first Image File Directory
			var firstIFDOffset = exif.dataView.getUint32(exif.offset, exif.littleEndian);
			if (firstIFDOffset < 8) {
				throw "Invalid TIFF First IFD Offset";
			}
			exif.offset += 4;// Skip TIFF firstIFDOffset

			exif.offset += firstIFDOffset - 8;// Go to the firstIFDOffset.
		},

		/**
		 * Read the number of directory entries
		 */
		_readNumberOfDirectoryEntries: function(exif) {
			// The first 2 bytes has the number of directory entries.
			exif.entries = exif.dataView.getUint16(exif.offset, exif.littleEndian);
			exif.offset += 2;// Skip the number of directory entries
		},

		/**
		 * Get the orientation tag from the exif metadata
		 */
		_getOrientationTagData: function(exif) {
			for (var i = 0; i < exif.entries; i++) {
				// Each entry has 12 bytes
				// First 2 bytes is the tag number
				// Look for the orientation tag.
				if (exif.dataView.getUint16(exif.offset, exif.littleEndian) == 0x0112) {
					return exif.dataView.getUint16(exif.offset + 8, exif.littleEndian);
				}
				exif.offset += 12;// Skip current entry.
			}
			return false;
		},

		/**
		 * Rotate the image occording to its orientation.
		 */ 
		_rotateImage: function(image) {
			var img = image.img;
			var canvas = document.createElement("canvas");

			if (image.orientation > TriplatImageOrientation.BOTTOM_LEFT) {
				canvas.width = img.height;
				canvas.height = img.width;
			} else {
				canvas.width = img.width;
				canvas.height = img.height;
			}

			var ctx = canvas.getContext("2d");

			// The orientation of the camera relative to the scene, when the image was captured. 
			// The relation of the '0th row' and '0th column' to visual position is shown as below:
			// Value	0th Row		0th Column
			//	1		top			left 
			//	2		top			right 
			//	3		bottom		right 
			//	4		bottom		left 
			//	5		left 		top
			//	6		right 		top
			//	7		right 		bottom
			//	8		left 		bottom
			switch (image.orientation) {
				case TriplatImageOrientation.TOP_RIGHT:
					// horizontal flip
					ctx.translate(img.width, 0);
					ctx.scale(-1, 1);
					break;
				case TriplatImageOrientation.BOTTOM_RIGHT:
					// 180 rotate left
					ctx.translate(img.width, img.height);
					ctx.rotate(Math.PI);
					break;
				case TriplatImageOrientation.BOTTOM_LEFT:
					// vertical flip
					ctx.translate(0, img.height);
					ctx.scale(1, -1);
					break;
				case TriplatImageOrientation.LEFT_TOP:
					// vertical flip + 90 rotate right
					ctx.rotate(0.5 * Math.PI);
					ctx.scale(1, -1);
					break;
				case TriplatImageOrientation.RIGHT_TOP:
					// 90 rotate right
					ctx.rotate(0.5 * Math.PI);
					ctx.translate(0, -img.height);
					break;
				case TriplatImageOrientation.RIGHT_BOTTOM:
					// horizontal flip + 90 rotate right
					ctx.rotate(0.5 * Math.PI);
					ctx.translate(img.width, -img.height);
					ctx.scale(-1, 1);
					break;
				case TriplatImageOrientation.LEFT_BOTTOM:
					// 90 rotate left
					ctx.rotate(-0.5 * Math.PI);
					ctx.translate(-img.width, 0);
					break;
			}

			ctx.drawImage(img, 0, 0, img.width, img.height);
			return this._convertDataURLtoBlob(canvas.toDataURL("image/jpeg"));
		},

		_convertDataURLtoBlob: function(dataURL) {
			var byteString = atob(dataURL.split(',')[1]);
			var mimeString = dataURL.split(',')[0].split(':')[1].split(';')[0];
			
			var buffer = new ArrayBuffer(byteString.length);
			var dataView = new DataView(buffer);
			for(var i = 0; i < byteString.length; i++) {
			    dataView.setUint8(i, byteString.charCodeAt(i));
			}
			return new Blob([buffer], {type:mimeString});
		}
	};

	TriplatImageOrientation = function(){};
	TriplatImageOrientation.TOP_LEFT = 1;
	TriplatImageOrientation.TOP_RIGHT = 2;
	TriplatImageOrientation.BOTTOM_RIGHT = 3;
	TriplatImageOrientation.BOTTOM_LEFT = 4;
	TriplatImageOrientation.LEFT_TOP = 5;
	TriplatImageOrientation.RIGHT_TOP = 6;
	TriplatImageOrientation.RIGHT_BOTTOM = 7;
	TriplatImageOrientation.LEFT_BOTTOM = 8;

</script><dom-module id="triplat-image" assetpath="../triplat-image/">

	<style>
		.image-wrap {
			@apply(--layout);
			@apply(--layout-vertical);
			@apply(--layout-center-center);
			@apply(--triplat-image-wrap);   
		}

		.image-label {
			padding-bottom: 2px;
			@apply(--triplat-image-label);   
		}
		
		iron-image {
			@apply(--triplat-image-iron-image);   
		}

		.placeholder-icon {
			@apply(--triplat-image-placeholder-icon);   
		}

		.action-icons{
			margin: 4px;
			@apply(--triplat-image-action-icons);   
		}
		
		.upload-icon{
			color: var(--tri-actionable-color, --tri-primary-color);
			background-color: var(--tri-actionable-color-contrast, white);  
			cursor: pointer;
			@apply(--triplat-image-upload-icon);   
		}

		.clear-icon{
			color: var(--tri-actionable-color, --tri-primary-color);
			background-color: var(--tri-actionable-color-contrast, white);  
			cursor: pointer;
			@apply(--triplat-image-clear-icon);   
		}
		
		.upload-icon:focus, .clear-icon:focus{
			outline-color: var(--tri-actionable-color, --tri-primary-color);
			outline-style: dotted;
			outline-width: 1px;
			@apply(--triplat-image-focused-action-icon);   
		}

		.rtl{
			direction: rtl;
		}

	</style>

	<template>
		<tricore-url id="tricoreUrl" raw-url="/p/fileupload/uploadimage" bind-url="{{_fileUrl}}"></tricore-url>
		<iron-ajax id="getFileUrlIdAjax" url="{{_fileUrl}}" on-response="_handleGetFileUploadResponse" on-error="_handleGetFileUploadError">
		</iron-ajax>

		<tricore-url raw-url="/p/fileupload/validImageExtensions" bind-url="{{_validImageExtensionsUrl}}"></tricore-url>
		<iron-ajax id="validImageExtensionsAjax" url="[[_validImageExtensionsUrl]]"></iron-ajax>

		<input type="file" id="fileInput" on-change="_fileSelected" hidden="" accept="image/*">
		
		<div class="image-wrap">
		
			<template is="dom-if" if="{{_showLabel(label)}}">
			  <label class="image-label">{{label}}</label>
			</template>
			<label><content id="labelContent" select="[label]"></content></label>
			<iron-image id="triCustomImage" height="{{height}}" width="{{width}}" style="{{_setImageStyle(style)}}" sizing="{{sizing}}" position="{{position}}" hidden$="{{_showPlaceholder}}" data-info$="[[data-info]]"></iron-image>
	
			<triplat-icon class="placeholder-icon" icon="{{placeholderIcon}}" hidden$="{{!_showPlaceholder}}"></triplat-icon>

			<template is="dom-if" if="{{editable}}">
			  <div class="action-icons">
				
			  
				<triplat-icon icon="upload-export" id="uploadIcon" class="upload-icon" title="Upload image" on-tap="openFileSelection" tabindex="0" on-keypress="_keyPressHandlerUpload"></triplat-icon>
				
				<triplat-icon icon="close-cancel-error" class="clear-icon" title="Clear image" on-tap="clearImage" hidden$="{{!_showClearIcon}}" tabindex="0" on-keypress="_keyPressHandlerClear"></triplat-icon>
			  
				
			  </div>        
			</template>
		
		</div>
		
	</template>
</dom-module>
<script>
	(function() {
		var getExtensionsPromise = null;

		Polymer({
			is: "triplat-image",  

			behaviors: [
				TriplatImageOrientationBehavior,
				TriplatFileSizeValidationBehavior
			],

			/**
			 * Fired after the upload file is submitted and a response is received.<br>
			 * Error Messages:<br>
			 *	<b>invalidExcludeExtension</b> - Selected file has an extension that is not allowed (as defined in the TRIRIGAWEB.properties file).<br>
			 *	<b>invalidIncludeExtension</b> - Selected file has an extension that is not listed in the restricted included extension list (as defined in the TRIRIGAWEB.properties file).<br>
			 *  <b>invalidEmptyExtension</b> - Selected file has an empty extension.
			 *	<b>invalidToSaveFile</b> - Selected file is not valid for saving (hard-coded restriction).<br>
			 *	<b>failAntiVirusScanResult</b> - Selected file fail on antivirus Scan.<br>
			 *	<b>fileNotFound</b> - Fail to load the selected file for unknown reason.<br>
			 *	<b>invalidImageSize</b> - The size of the image file exceeds the maximum allowed by the MAXIMUM_UPLOAD_FILE_SIZE_MEGABYTES parameter.<br>
			 *  <b>uploadFailed</b> - The upload request failed.<br>
			 *
			 * @event image-uploadfile-response
			 */

			 properties : {
				
				/**
				 * Height in pixels. 
				 */
				height:{
					type: Object,
				},     
				
				 /**
				 * Width in pixels. 
				 */
				width:{
					type: Object,
				},

				/**
				 * Sizing can be either contain or cover. 
				 */
				sizing:{
					type: String,
				},
				
				 /**
				 * Set style of the image.
				 */
				style:{
					type: String,
				},
				
				 /**
				 * URL of the image. 
				 */
				src:{
					type: String,
					notify: true,
					readOnly: false,
					observer: "_handleImageChange"
				},

				/**
				 * Label of the image.
				 */
				label:{
					type: String,
				},

				/**
				 * When a sizing option is used (`cover` or `contain`), this determines
				 * how the image is aligned within the element bounds.
				 */
				position: {
				  type: String,
				  value: 'center'
				},

				/**
				 * Make the image editable. User can upload new image or delete the image.
				 */
				editable: {
					type: Boolean,
					value: false
				  },
				
				 /**
				 * If true, it displays a thumbnail version of the image (a smaller file size).
				 */
				thumbnail: {
					type: Boolean,
					value: false
				  },
				
				/**
				 * This icon will be used as a placeholder until URL image is provided.
				 */
				placeholderIcon:{
					type: String,
					observer: "_handleImageChange"
				  },

				/**
				 * It indicates if uploading is in progress.
				 */
				uploading: {
					type: Boolean,
					value: false,
					notify: true,
					readOnly: true
				},
				
				/**
				 * If true, the image will be uploaded only when the record that contains this image is saved or updated.
				 * When running in offline mode, this property is ignored and the image upload is always postponed.
				 */
				postponeUpload: {
					type: Boolean,
					value: false
				},
				
				/**
				 * If true, the images displayed by this component will be saved to the offline cache.
				 */
				cache: {
					type: Boolean,
					value: false
				},
				 
				_showPlaceholder: {
					type: Boolean,
					value: false
				},
				
				_showClearIcon: {
					type: Boolean,
					value: false
				},

				_validImageExtensionsUrl: {
					type: String
				}
			},

			_handleImageChange: function() {
				this.$.triCustomImage.src = this._computeImageSrc(this.src, this.thumbnail, this.cache);
				if(this._hasValue(this.placeholderIcon)){
					if(this._hasValue(this.src)) {
						this.set('_showPlaceholder', false);
					} else {
						this.set('_showPlaceholder', true);
					}
				}
				
				if(this.editable){
					if(this._hasValue(this.src)) {
						this.set('_showClearIcon', true);
					} else {
						this.set('_showClearIcon', false);
					}
				}
			},
			
			_setImageStyle: function(style){
				this.$.triCustomImage.style.cssText = style;
			},

			_computeImageSrc: function(src, thumbnail, cache) {
				if (!this._hasValue(src)) {
					return "";
				} else {
					if (typeof src === "object" && src.isUnsavedImage) {
						return src.image;
					} else {
						src = cache ? src + "&offlineCache=true" : src;
						if (thumbnail) {
							return this.$.tricoreUrl.getUrl("/html/en/default/images/getImageThumbnail.jsp?fileLoc=" + src);
						} else {
							return this.$.tricoreUrl.getUrl("/getCompanyFile.jsp?fileLoc=" + src);
						}
					}
				}
			},

			attached: function() {
				var textDirectionValue = document.querySelector('body').getAttribute('dir');
				if(textDirectionValue==="rtl"){
					var imageWrapElement = Polymer.dom(this).querySelectorAll(".image-wrap")[0];
					if(imageWrapElement != undefined && imageWrapElement != null){
						imageWrapElement.classList.add('rtl');
					}
				}
				if(Polymer.dom(this.$$('#labelContent')).getDistributedNodes().length >0){
					this.label=" ";
				}
			},

			ready: function(){
				this.$.triCustomImage.sizing = this.sizing;
			},

			/**
			 * Shows a file selection dialog box to the user, so that the user can search and select an image to upload.
			 */
			openFileSelection: function() {
			  var elem = this.$$("#fileInput");
			  if (elem && document.createEvent) {
				var evt = document.createEvent("MouseEvents");
				evt.initEvent("click", true, false);
				elem.dispatchEvent(evt);
			  }
			},

			_fileSelected: function(e) {
			  var length = e.target.files.length;
			  if(length>0) {
				var file = e.target.files[0];
				this._uploadFile(file);
			  }
			},
			
			/**
			 * Clears the value of the image field bound to this element.
			 */
			clearImage: function() {
				this.src = "";
				this.$$("#fileInput").value = "";
				
				var uploadIconEl = this.$$("#uploadIcon");
				if (uploadIconEl) {
					uploadIconEl.focus();
				}
			},
			
			/**
			 * Cache an image field to the local browser storage.
			 * @param {String} scr URL of the image to be cached. It defaults to the value of the `src` property.
			 */
			cacheImage: function(src, cacheThumbnail, cacheFullImage) {
				var imageUrl = this._computeImageSrc(src || this.src, false, true);
				var thumbnailUrl = this._computeImageSrc(src || this.src, true, true);
				return this._doCacheImage(imageUrl, cacheFullImage)
					.then(this._doCacheImage.bind(this, thumbnailUrl, cacheThumbnail));
			},
			
			_doCacheImage: function(imageSrc, cache) {
				if (!cache || !imageSrc || (typeof imageSrc === "object" && imageSrc.isUnsavedImage)) {
					return Promise.resolve();
				}
				var request = document.createElement('iron-request');
				var requestOptions = {
					url: imageSrc,
					method: "GET"
				};
				request.send(requestOptions);
				return request.completes.then(function() {
					var cacheError = request.xhr.getResponseHeader("trisw-cache-error");
					if (cacheError && cacheError != "") {
						return Promise.reject({cause: cacheError})
					}
					return request.response;
				});
			},

			_handleGetFileUploadResponse: function(e) {
				this._setUploading(false);
				this.$$("#fileInput").value = "";
				var newSrc = e.detail.response.fileURL;
				if(newSrc) {
					this.src = newSrc;
				}
				
				this.fire("image-uploadfile-response", e.detail.response);
			},

			_handleGetFileUploadError: function(e) {
				this._fireError("uploadFailed", this.$$("#fileInput").files[0].name);
			},

			_fireError: function(errorMessage, fileSelected) {
				this._setUploading(false);
				this.$$("#fileInput").value = "";
				this.fire(
					"image-uploadfile-response", 
					{
						errorMessage: errorMessage,
						isFileLoaded: "FALSE",
						fileSelected: fileSelected
					}
				);
			},

			_uploadFile: function(file) {
				if (!file) {
				  return;
				}
				this._setUploading(true);
				this._checkImageFileSize(file)
					.then(this._checkFileExtension.bind(this, file.name))
					.then(function() {
						this._fixImageOrientation(file)
							.then(this._doUploadFile.bind(this, file.name))
							.catch(this._doUploadFile.bind(this, file.name, file));
					}.bind(this))		
					.catch(function(error) {
						this._fireError(error, file.name);
					}.bind(this));
			},

			_doUploadFile: function(filename, image) {
				if (this.postponeUpload || !TriplatServerStatus.getInstance().isServerOnline()) {
					this.$$("#fileInput").value = "";
					this._readImageAsDataURL(image)
						.then(
							function(dataUrl) {
								this.src = {
									isUnsavedImage: true,
									image: dataUrl,
									filename: filename,
									length: image.size 
								};
								this._setUploading(false);
							}.bind(this)
						)
						.catch(this._fireError.bind(this, "uploadFailed", filename));
				} else {
					var formData = new FormData();
					formData.append("file", image, filename);
		
					var ironAjax = this.$$("#getFileUrlIdAjax");
					ironAjax.body = formData;
					ironAjax.method = "POST";
					ironAjax.contentType = undefined;
					ironAjax.generateRequest();
				}
			},
			
			_readImageAsDataURL: function(image) {
				return new Promise(
					function(resolve, reject) {
						var reader  = new FileReader();
						reader.addEventListener(
							"loadend", 
							function () {
								resolve(reader.result);
							}
						);
						reader.addEventListener("error",reject);
						reader.readAsDataURL(image);
					}
				);
			},

			_hasValue: function(elem) {
				return elem != undefined && elem != null && (typeof elem === "object" && elem.isUnsavedImage || elem.length > 0);
			},

			_showLabel: function(label) {
				return this._hasValue(label);
			},

			_keyPressHandlerUpload: function(event) {
				var code = event.keyCode;
				// accept enter or spacebar
				if (code == 13 || code == 32) {
					this.openFileSelection();
				}
			},

			_keyPressHandlerClear: function(event) {
				var code = event.keyCode;
				// accept enter or spacebar
				if (code == 13 || code == 32) {
					this.clearImage();
				}
			},

			_getValidImageExtensions: function() {
				if (getExtensionsPromise) {
					return getExtensionsPromise;
				}

				var request = this.$.validImageExtensionsAjax.generateRequest();
				getExtensionsPromise = request.completes
					.then(function() {
						return request.response;
					}.bind(this))
					.catch(function(error) {
						getExtensionsPromise = null;
						console.err(error);
						return null;
					}.bind(this));
				return getExtensionsPromise;
			},

			_checkFileExtension: function(fileName) {
				var lastIndex = fileName.lastIndexOf('.');
				if (lastIndex == -1) {
					return Promise.reject("invalidEmptyExtension");
				}
				var fileNameExtension = fileName.substring(lastIndex).toLowerCase();

				return this._getValidImageExtensions().then(function(validExtensions) {
					if(validExtensions && validExtensions.includedExtensions != null && validExtensions.includedExtensions.length > 0) {
						if (validExtensions.includedExtensions.indexOf(fileNameExtension) == -1) {
							return Promise.reject("invalidIncludeExtension");
						}
					} else if (validExtensions && validExtensions.excludedExtensions != null && validExtensions.excludedExtensions.indexOf(fileNameExtension) >= 0) {
						return Promise.reject("invalidExcludeExtension");
					}
				}.bind(this));
			},

			_checkImageFileSize: function(file) {
				return this.checkFileSize(file).catch(function() {
					return Promise.reject("invalidImageSize");
				});
			}
		});
	})();
</script>







<script>

  /**
   * Use `Polymer.IronCheckedElementBehavior` to implement a custom element
   * that has a `checked` property, which can be used for validation if the
   * element is also `required`. Element instances implementing this behavior
   * will also be registered for use in an `iron-form` element.
   *
   * @demo demo/index.html
   * @polymerBehavior Polymer.IronCheckedElementBehavior
   */
  Polymer.IronCheckedElementBehaviorImpl = {

    properties: {
      /**
       * Fired when the checked state changes.
       *
       * @event iron-change
       */

      /**
       * Gets or sets the state, `true` is checked and `false` is unchecked.
       */
      checked: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
        notify: true,
        observer: '_checkedChanged'
      },

      /**
       * If true, the button toggles the active state with each tap or press
       * of the spacebar.
       */
      toggles: {
        type: Boolean,
        value: true,
        reflectToAttribute: true
      },

      /* Overriden from Polymer.IronFormElementBehavior */
      value: {
        type: String,
        value: 'on',
        observer: '_valueChanged'
      }
    },

    observers: [
      '_requiredChanged(required)'
    ],

    created: function() {
      // Used by `iron-form` to handle the case that an element with this behavior
      // doesn't have a role of 'checkbox' or 'radio', but should still only be
      // included when the form is serialized if `this.checked === true`.
      this._hasIronCheckedElementBehavior = true;
    },

    /**
     * Returns false if the element is required and not checked, and true otherwise.
     * @param {*=} _value Ignored.
     * @return {boolean} true if `required` is false or if `checked` is true.
     */
    _getValidity: function(_value) {
      return this.disabled || !this.required || this.checked;
    },

    /**
     * Update the aria-required label when `required` is changed.
     */
    _requiredChanged: function() {
      if (this.required) {
        this.setAttribute('aria-required', 'true');
      } else {
        this.removeAttribute('aria-required');
      }
    },

    /**
     * Fire `iron-changed` when the checked state changes.
     */
    _checkedChanged: function() {
      this.active = this.checked;
      this.fire('iron-change');
    },

    /**
     * Reset value to 'on' if it is set to `undefined`.
     */
    _valueChanged: function() {
      if (this.value === undefined || this.value === null) {
        this.value = 'on';
      }
    }
  };

  /** @polymerBehavior Polymer.IronCheckedElementBehavior */
  Polymer.IronCheckedElementBehavior = [
    Polymer.IronFormElementBehavior,
    Polymer.IronValidatableBehavior,
    Polymer.IronCheckedElementBehaviorImpl
  ];

</script><script>
  /**
   * Use `Polymer.PaperCheckedElementBehavior` to implement a custom element
   * that has a `checked` property similar to `Polymer.IronCheckedElementBehavior`
   * and is compatible with having a ripple effect.
   * @polymerBehavior Polymer.PaperCheckedElementBehavior
   */
  Polymer.PaperCheckedElementBehaviorImpl = {
    /**
     * Synchronizes the element's checked state with its ripple effect.
     */
    _checkedChanged: function() {
      Polymer.IronCheckedElementBehaviorImpl._checkedChanged.call(this);
      if (this.hasRipple()) {
        if (this.checked) {
          this._ripple.setAttribute('checked', '');
        } else {
          this._ripple.removeAttribute('checked');
        }
      }
    },

    /**
     * Synchronizes the element's `active` and `checked` state.
     */
    _buttonStateChanged: function() {
      Polymer.PaperRippleBehavior._buttonStateChanged.call(this);
      if (this.disabled) {
        return;
      }
      if (this.isAttached) {
        this.checked = this.active;
      }
    }
  };

  /** @polymerBehavior Polymer.PaperCheckedElementBehavior */
  Polymer.PaperCheckedElementBehavior = [
    Polymer.PaperInkyFocusBehavior,
    Polymer.IronCheckedElementBehavior,
    Polymer.PaperCheckedElementBehaviorImpl
  ];
</script><dom-module id="paper-checkbox" assetpath="../paper-checkbox/">
  <template strip-whitespace="">
    <style>
      :host {
        display: inline-block;
        white-space: nowrap;
        cursor: pointer;
        --calculated-paper-checkbox-size: var(--paper-checkbox-size, 18px);
        /* -1px is a sentinel for the default and is replaced in `attached`. */
        --calculated-paper-checkbox-ink-size: var(--paper-checkbox-ink-size, -1px);
        @apply(--paper-font-common-base);
        line-height: 0;
        -webkit-tap-highlight-color: transparent;
      }

      :host([hidden]) {
        display: none !important;
      }

      :host(:focus) {
        outline: none;
      }

      .hidden {
        display: none;
      }

      #checkboxContainer {
        display: inline-block;
        position: relative;
        width: var(--calculated-paper-checkbox-size);
        height: var(--calculated-paper-checkbox-size);
        min-width: var(--calculated-paper-checkbox-size);
        margin: var(--paper-checkbox-margin, initial);
        vertical-align: var(--paper-checkbox-vertical-align, middle);
        background-color: var(--paper-checkbox-unchecked-background-color, transparent);
      }

      #ink {
        position: absolute;

        /* Center the ripple in the checkbox by negative offsetting it by
         * (inkWidth - rippleWidth) / 2 */
        top: calc(0px - (var(--calculated-paper-checkbox-ink-size) - var(--calculated-paper-checkbox-size)) / 2);
        left: calc(0px - (var(--calculated-paper-checkbox-ink-size) - var(--calculated-paper-checkbox-size)) / 2);
        width: var(--calculated-paper-checkbox-ink-size);
        height: var(--calculated-paper-checkbox-ink-size);
        color: var(--paper-checkbox-unchecked-ink-color, var(--primary-text-color));
        opacity: 0.6;
        pointer-events: none;
      }

      :host-context([dir="rtl"]) #ink {
        right: calc(0px - (var(--calculated-paper-checkbox-ink-size) - var(--calculated-paper-checkbox-size)) / 2);
        left: auto;
      }

      #ink[checked] {
        color: var(--paper-checkbox-checked-ink-color, var(--primary-color));
      }

      #checkbox {
        position: relative;
        box-sizing: border-box;
        height: 100%;
        border: solid 2px;
        border-color: var(--paper-checkbox-unchecked-color, var(--primary-text-color));
        border-radius: 2px;
        pointer-events: none;
        -webkit-transition: background-color 140ms, border-color 140ms;
        transition: background-color 140ms, border-color 140ms;
      }

      /* checkbox checked animations */
      #checkbox.checked #checkmark {
        -webkit-animation: checkmark-expand 140ms ease-out forwards;
        animation: checkmark-expand 140ms ease-out forwards;
      }

      @-webkit-keyframes checkmark-expand {
        0% {
          -webkit-transform: scale(0, 0) rotate(45deg);
        }
        100% {
          -webkit-transform: scale(1, 1) rotate(45deg);
        }
      }

      @keyframes checkmark-expand {
        0% {
          transform: scale(0, 0) rotate(45deg);
        }
        100% {
          transform: scale(1, 1) rotate(45deg);
        }
      }

      #checkbox.checked {
        background-color: var(--paper-checkbox-checked-color, var(--primary-color));
        border-color: var(--paper-checkbox-checked-color, var(--primary-color));
      }

      #checkmark {
        position: absolute;
        width: 36%;
        height: 70%;
        border-style: solid;
        border-top: none;
        border-left: none;
        border-right-width: calc(2/15 * var(--calculated-paper-checkbox-size));
        border-bottom-width: calc(2/15 * var(--calculated-paper-checkbox-size));
        border-color: var(--paper-checkbox-checkmark-color, white);
        -webkit-transform-origin: 97% 86%;
        transform-origin: 97% 86%;
        box-sizing: content-box; /* protect against page-level box-sizing */
      }

      :host-context([dir="rtl"]) #checkmark {
        -webkit-transform-origin: 50% 14%;
        transform-origin: 50% 14%;
      }

      /* label */
      #checkboxLabel {
        position: relative;
        display: inline-block;
        vertical-align: middle;
        padding-left: var(--paper-checkbox-label-spacing, 8px);
        white-space: normal;
        line-height: normal;
        color: var(--paper-checkbox-label-color, var(--primary-text-color));
        @apply(--paper-checkbox-label);
      }

      :host([checked]) #checkboxLabel {
        color: var(--paper-checkbox-label-checked-color, var(--paper-checkbox-label-color, var(--primary-text-color)));
        @apply(--paper-checkbox-label-checked);
      }

      :host-context([dir="rtl"]) #checkboxLabel {
        padding-right: var(--paper-checkbox-label-spacing, 8px);
        padding-left: 0;
      }

      #checkboxLabel[hidden] {
        display: none;
      }

      /* disabled state */

      :host([disabled]) #checkbox {
        opacity: 0.5;
        border-color: var(--paper-checkbox-unchecked-color, var(--primary-text-color));
      }

      :host([disabled][checked]) #checkbox {
        background-color: var(--paper-checkbox-unchecked-color, var(--primary-text-color));
        opacity: 0.5;
      }

      :host([disabled]) #checkboxLabel  {
        opacity: 0.65;
      }

      /* invalid state */
      #checkbox.invalid:not(.checked) {
        border-color: var(--paper-checkbox-error-color, var(--error-color));
      }
    </style>

    <div id="checkboxContainer">
      <div id="checkbox" class$="[[_computeCheckboxClass(checked, invalid)]]">
        <div id="checkmark" class$="[[_computeCheckmarkClass(checked)]]"></div>
      </div>
    </div>

    <div id="checkboxLabel"><content></content></div>
  </template>

  <script>
    Polymer({
      is: 'paper-checkbox',

      behaviors: [
        Polymer.PaperCheckedElementBehavior
      ],

      hostAttributes: {
        role: 'checkbox',
        'aria-checked': false,
        tabindex: 0
      },

      properties: {
        /**
         * Fired when the checked state changes due to user interaction.
         *
         * @event change
         */

        /**
         * Fired when the checked state changes.
         *
         * @event iron-change
         */
        ariaActiveAttribute: {
          type: String,
          value: 'aria-checked'
        }
      },

      attached: function() {
        var inkSize = this.getComputedStyleValue('--calculated-paper-checkbox-ink-size');
        // If unset, compute and set the default `--paper-checkbox-ink-size`.
        if (inkSize === '-1px') {
          var checkboxSize = parseFloat(this.getComputedStyleValue('--calculated-paper-checkbox-size'));
          var defaultInkSize = Math.floor((8 / 3) * checkboxSize);

          // The checkbox and ripple need to have the same parity so that their
          // centers align.
          if (defaultInkSize % 2 !== checkboxSize % 2) {
            defaultInkSize++;
          }

          this.customStyle['--paper-checkbox-ink-size'] = defaultInkSize + 'px';
          this.updateStyles();
        }
      },

      _computeCheckboxClass: function(checked, invalid) {
        var className = '';
        if (checked) {
          className += 'checked ';
        }
        if (invalid) {
          className += 'invalid';
        }
        return className;
      },

      _computeCheckmarkClass: function(checked) {
        return checked ? '' : 'hidden';
      },

      // create ripple inside the checkboxContainer
      _createRipple: function() {
        this._rippleContainer = this.$.checkboxContainer;
        return Polymer.PaperInkyFocusBehaviorImpl._createRipple.call(this);
      }

    });
  </script>
</dom-module>


<dom-module id="paper-radio-button" assetpath="../paper-radio-button/">
  <template strip-whitespace="">
    <style>
      :host {
        display: inline-block;
        line-height: 0;
        white-space: nowrap;
        cursor: pointer;
        @apply(--paper-font-common-base);
        --calculated-paper-radio-button-size: var(--paper-radio-button-size, 16px);
      }

      :host(:focus) {
        outline: none;
      }

      #radioContainer {
        @apply(--layout-inline);
        @apply(--layout-center-center);
        position: relative;
        width: var(--calculated-paper-radio-button-size);
        height: var(--calculated-paper-radio-button-size);
        vertical-align: middle;
      }

      #ink {
        position: absolute;
        top: 50%;
        left: 50%;
        right: auto;
        width: calc(3 * var(--calculated-paper-radio-button-size));
        height: calc(3 * var(--calculated-paper-radio-button-size));
        color: var(--paper-radio-button-unchecked-ink-color, --primary-text-color);
        opacity: 0.6;
        pointer-events: none;
        -webkit-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
      }

      #ink[checked] {
        color: var(--paper-radio-button-checked-ink-color, --primary-color);
      }

      #offRadio, #onRadio {
        position: absolute;
        box-sizing: border-box;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 50%;
      }

      #offRadio {
        border: 2px solid var(--paper-radio-button-unchecked-color, --primary-text-color);
        background-color: var(--paper-radio-button-unchecked-background-color, transparent);
        transition: border-color 0.28s;
      }

      #onRadio {
        background-color: var(--paper-radio-button-checked-color, --primary-color);
        -webkit-transform: scale(0);
        transform: scale(0);
        transition: -webkit-transform ease 0.28s;
        transition: transform ease 0.28s;
        will-change: transform;
      }

      :host([checked]) #offRadio {
        border-color: var(--paper-radio-button-checked-color, --primary-color);
      }

      :host([checked]) #onRadio {
        -webkit-transform: scale(0.5);
        transform: scale(0.5);
      }

      #radioLabel {
        line-height: normal;
        position: relative;
        display: inline-block;
        vertical-align: middle;
        margin-left: var(--paper-radio-button-label-spacing, 10px);
        white-space: normal;
        color: var(--paper-radio-button-label-color, --primary-text-color);
      }

      :host-context([dir="rtl"]) #radioLabel {
        margin-left: 0;
        margin-right: var(--paper-radio-button-label-spacing, 10px);
      }

      #radioLabel[hidden] {
        display: none;
      }

      /* disabled state */

      :host([disabled]) #offRadio {
        border-color: var(--paper-radio-button-unchecked-color, --primary-text-color);
        opacity: 0.5;
      }

      :host([disabled][checked]) #onRadio {
        background-color: var(--paper-radio-button-unchecked-color, --primary-text-color);
        opacity: 0.5;
      }

      :host([disabled]) #radioLabel {
        /* slightly darker than the button, so that it's readable */
        opacity: 0.65;
      }
    </style>

    <div id="radioContainer">
      <div id="offRadio"></div>
      <div id="onRadio"></div>
    </div>

    <div id="radioLabel"><content></content></div>
  </template>

  <script>
    Polymer({
      is: 'paper-radio-button',

      behaviors: [
        Polymer.PaperCheckedElementBehavior
      ],

      hostAttributes: {
        role: 'radio',
        'aria-checked': false,
        tabindex: 0
      },

      properties: {
        /**
         * Fired when the checked state changes due to user interaction.
         *
         * @event change
         */

        /**
         * Fired when the checked state changes.
         *
         * @event iron-change
         */

        ariaActiveAttribute: {
          type: String,
          value: 'aria-checked'
        }
      },

      ready: function() {
        this._rippleContainer = this.$.radioContainer;
      }
    })
  </script>
</dom-module>
<script>
	/**
	 * `TriPlatAccessibilityBehavior` can be used to improve accessibility of some elements.
	 *
	 * @polymerBehavior
	 */
	TriPlatAccessibilityBehavior = {

		/**
		 * This function will set to "true" or "false" the ARIA property for a given element.
		 * @param {Object} element Element that will receive the ARIA property
		 * @param {Boolean} value Either "true" or "false"
		 * @param {String} ariaProperty The Name of the ARIA property
		 */
		setAriaProperty: function(element, value, ariaProperty) {
			if (value) {
				element.setAttribute('aria-' + ariaProperty, 'true');
			} else {
				element.setAttribute('aria-' + ariaProperty, 'false');
			}
		},

		/**
		 * Creates an HTML element with an `aria-live` attribute, to set a live area for screen readers.
		 * This live container will not be visible on the page, so it should only be used to improve the accessibility of screen readers.
		 * It returns the live element.
		 * @param {Object} parentElement Element where the ARIA live container will be appended.
		 * @param {String} containerId The ID of the live container. If blank, the default value will be "liveArea".
		 * @param {String} ariaLiveValue The value for the **aria-live** attribute. Can be set to "assertive" or "polite". If blank, the default value will be "polite".
		 * @return {Element}
		 */
		setAriaLiveContainer: function(parentElement, containerId, ariaLiveValue) {
			// Check if the live area already exists
			var liveArea = parentElement.querySelector("#" + (containerId ? containerId : "liveArea"));
			if (!liveArea) {
				// If don't, create the live area
				var ariaLiveContainer = document.createElement("div");
				ariaLiveContainer.setAttribute('id', (containerId ? containerId : "liveArea"));
				ariaLiveContainer.setAttribute('aria-live', (ariaLiveValue ? ariaLiveValue : "polite"));
				ariaLiveContainer.setAttribute('style', 'height: 1px; overflow: hidden; position: absolute; white-space: nowrap; width: 1px;');
				parentElement.appendChild(ariaLiveContainer);

				liveArea = parentElement.querySelector("#" + (containerId ? containerId : "liveArea"));
			}

			return liveArea;
		}

	};
</script>


<script>
Polymer.TriPlatDatePickerBehavior = {
    properties: {
        /**
          * An invalid string message that appears under the date picker field when <b>_invalid</b> property set to true.
        **/
        _hightLighted : {
            type: String,
            value: ""
        },

        dateinvalidMsg:{
            type: String,
            computed: 'computeDateInvalidMsg(displayFormat)'
        },

        dateinvalidMsgViolateRestriction:{
            type: String,
            computed: 'computeDateInvalidMsgViolateRestriction(disallowWeekends, disallowPastDates)'
        }

    },

    formatDate: function (input, format) {
        format = format ? format : this.displayFormat;
        if(!input || Object.prototype.toString.call(input) ==="[object Object]" || !this._hasIsoDateLength(this.value))
            return "";

        var fixedFormat = this._convertToFixedMomentTzFormat(format);
        var withoutTimeIndex = input.indexOf("T");
        var dateString = input.substring(0, withoutTimeIndex);

        var mDate = moment(dateString);
        var translatedMDate = mDate.locale(this._lang);  
        var formatedDate = translatedMDate.formatWithJDF(fixedFormat);
        return formatedDate;
    },

    _convertToFixedMomentTzFormat: function(format){
        format = format || "MM/DD/YYYY";
        if (format.replace(/[^z]/g, "").length===1){
            format = format.replace("z", "zz");
        } 

        else if (format.replace(/[^z]/g, "").length===3){
            format = format.replace("zzz", "zz");
        }
        else if (format.replace(/[^z]/g, "").length===4){
            format = format.replace("zzzz", "zz");
        }

        if(format.replace(/[^M]/g,"").length===5){
            format = format.replace("MMMMM", "MMMM");
        }

        var end = false;
        var fixedFormat = format.replace(/\'/g, function(match) {
          return (end = !end) ? '[' : ']';    
        });
        return fixedFormat;
    },

    _convertStringToDate: function(val, nullDateInvalid) {
        var dataEntryErrorMsg = null;
        var formatedDate;
        
        this._enteredDateValue = val;

        if(!val){
            if(nullDateInvalid) {
                dataEntryErrorMsg = this.dateinvalidMsg; 
                this.value = null;  
            }
            this.set("_errorMsg" , dataEntryErrorMsg);
            var __dictionary__empty = "Empty";
            this.set("_enteredDateValue" , __dictionary__empty);
            return null; 
        }
        var fixedFormat = this._convertToFixedMomentTzFormat(this.displayFormat);
        var momentFormat = moment().toMomentFormatString(fixedFormat);

        moment.locale(this._lang);
        var fieldValueToMoment = moment(val, momentFormat).format();
        if(fieldValueToMoment === "Invalid date"){
            dataEntryErrorMsg = this.dateinvalidMsg;
            this.set("_errorMsg" , dataEntryErrorMsg);
            this.set("_enteredDateValue" , val);
            return null;
        }

        var mDate = moment(fieldValueToMoment);
        var dateInMillisec = mDate.valueOf();
        if(moment.locale() !== 'en') moment.locale('en');

        var dateWithoutTz = moment(dateInMillisec).format("YYYY-MM-DDTHH:mm:ss");
        var datetimeBasedOnUserTimezone = moment.tz(dateWithoutTz, this.timeZone).format("YYYY-MM-DDTHH:mm:ss.SSSZ");
        return datetimeBasedOnUserTimezone;
    },

    openTriCalendar: function(picker, calendar,phone, header){
        calendar.style.overflow = "auto";
        if(phone || this._isMobileDevice()){
            this._openInMobileDevice(calendar);
        }else{
            this._openInNonMobileDevice(calendar, picker, header);
        }
        calendar.open();
    },

    _openInMobileDevice: function(calendar){
        calendar.resetFit();
        calendar.style.position = '';
        calendar.style.top = '';
        calendar.style.left = '';

        var _top = calendar.style.top;
        var _left= calendar.style.left;
        var _position = calendar.style.position;
        this._handleTriPlatDatePickerCalendarPosition(_top, _left, _position);
    },

    _openInNonMobileDevice: function(calendar, picker, header){
        calendar.style.position = "fixed";
        calendar.style.top = picker.getBoundingClientRect().top+"px";
        calendar.style.left = picker.getBoundingClientRect().left+"px";

        var calendarHeight = 306;
        var calendarWidth = 290;
        var _top = calendar.style.top;
        var _left= calendar.style.left;
        var _position = calendar.style.position;

        if (window.innerWidth - picker.getBoundingClientRect().left < calendarWidth){
            var newWPosition = picker.getBoundingClientRect().left - calendarWidth;
            calendar.style.left = newWPosition + "px";
            _left = calendar.style.left;

            if(picker.getBoundingClientRect().left <= calendarWidth){
                calendar.style.left = "0px";
                _left = calendar.style.left;
            }
        }
        if (window.innerHeight - picker.getBoundingClientRect().top <= calendarHeight){
            var newHPosition = picker.getBoundingClientRect().top - calendarHeight;
            newHPosition = newHPosition < 0 ? 0 : newHPosition;
            calendar.style.top = newHPosition + "px";
            _top = calendar.style.top;

            if(picker.getBoundingClientRect().top <= calendarHeight/2){
                calendar.style.top = "0px";
                _top = calendar.style.top;
            }
        }
        if (header){
            var headerHeight = 180;
            if (window.innerHeight - picker.getBoundingClientRect().top <= (calendarHeight + headerHeight)  ){
                    var newHPosition = window.innerHeight/3;
                    calendar.style.top = newHPosition + "px";
                    _top = calendar.style.top;

                if(picker.getBoundingClientRect().top <= (calendarHeight +180)){
                    calendar.style.top = "0px";
                    _top = calendar.style.top;
                }
            }
        }
        this._handleTriPlatDatePickerCalendarPosition(_top, _left, _position);
    },

    _isMobileDevice: function () {
        if( navigator.userAgent.match(/Android/i)
             || navigator.userAgent.match(/webOS/i)
             || navigator.userAgent.match(/iPhone/i)
             || navigator.userAgent.match(/iPad/i)
             || navigator.userAgent.match(/iPod/i)
             || navigator.userAgent.match(/BlackBerry/i)
             || navigator.userAgent.match(/Windows Phone/i)
        ){
            return true;
        }
        else {
            return false;
        }
    },

    _directEditRestrictedDateCheck: function(momentDate) {     
    	if(!momentDate) {
    		return;
    	}
        var withoutTimeIndex = momentDate.indexOf("T");
        var dateString = momentDate.substring(0, withoutTimeIndex);
        var dateObj =  new Date(moment(dateString).format("YYYY-MM-DDTHH:mm:ss.SSSZ"));
        if (!this._isDateObject(dateObj)) {
            // For Arabic (and perhaps other languages), format("YYYY-MM-DDTHH:mm:ss.SSSZ") does not work, so use toISOString()
            dateObj =  new Date(moment(dateString).toISOString());
            if(!this._isDateObject(dateObj)){
                dateObj =  new Date(dateString);
                if (!this._isDateObject(dateObj)) {
                    dateObj = null; 
                }
            }
        }
        if (this.disallowWeekends) {
            var day = dateObj.getDay();
            if (day == 0 || day == 6) {
                this.set("_errorMsg" , this.dateinvalidMsgViolateRestriction);
            }
        }
        if (this.disallowPastDates) {
            var today = new Date();
            var todayZeroHour = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            if (dateObj.getTime() < todayZeroHour.getTime()) {
                this.set("_errorMsg" , this.dateinvalidMsgViolateRestriction);
            }
        }
      },


    computeDateInvalidMsg: function(displayFormat){
        var __dictionary__erroMsg = "The expected format is {dateFormat}. For example, {example}.";
        
		var d = new Date();
        var fixedFormat = this._convertToFixedMomentTzFormat(this.displayFormat);
        var momentFormat = moment().toMomentFormatString(fixedFormat);
        var example = moment(d).format(momentFormat);
        displayFormat = "\""+displayFormat+"\"";
        var _temp = __dictionary__erroMsg.replace("{dateFormat}", displayFormat).replace("{example}", example);
        __dictionary__erroMsg = _temp;
        return __dictionary__erroMsg;
    },

    computeDateInvalidMsgViolateRestriction: function(disallowWeekends, disallowPastDates){
        var __dictionary__erroMsgViolateRestriction = "The date violates one or more of the restrictions specified by {restrictionAttributes}.";
        var restrictionAttributes = null;

        if (disallowPastDates && disallowWeekends) {
            restrictionAttributes = "disallow-weekends and disallow-past-dates";
        } else if (disallowWeekends) {
            restrictionAttributes = "disallow-weekends"
        } else if (disallowPastDates) {
            restrictionAttributes = "disallow-past-dates";
        }

        var _temp = __dictionary__erroMsgViolateRestriction.replace("{restrictionAttributes}", restrictionAttributes);
        __dictionary__erroMsgViolateRestriction = _temp;
        return __dictionary__erroMsgViolateRestriction;
    },

    _handleTriPlatDatePickerCalendarPosition: function(_top, _left, _position){
        this.customStyle['--tri-date-picker-calendar-position-top'] = _top + " !important";
        this.customStyle['--tri-date-picker-calendar-position-left'] = _left + " !important";
        this.customStyle['--tri-date-picker-calendar-position'] = _position + " !important";
        this.updateStyles();
    },

    _hasIsoDateLength: function(date) {
        return date.length === this._isoDateLength || date.length === this._isoUTCDateLength;   
    } 
}
</script><script src="../jsTimezoneDetect/jstz.min.js"></script><script src="../moment/moment.js"></script><script src="../moment-timezone/builds/moment-timezone-with-data-2010-2020.js"></script><script src="../moment-jdateformatparser/moment-jdateformatparser.min.js"></script><script src="../moment/min/locales.min.js"></script><dom-module id="triplat-date-picker" assetpath="../triplat-date-picker/">
	<style include="iron-flex iron-flex-alignment">

	paper-icon-button {
            padding: 0px;
            height: var(--triplat-date-picker-icon-size, 24px);
            width: var(--triplat-date-picker-icon-size, 24px);
            --iron-icon-fill-color: var(--triplat-date-picker-icon-color, --tri-primary-icon-button-color);
            bottom:3px;
            @apply(--triplat-date-picker-icon);
	}

	paper-input {
		width: var(--triplat-date-picker-width);
	}

	paper-dialog {
		position: fixed;
		width: 60%;
		margin: 0px;		
	}

	.__triPlatDatePickerCalendar{
		top: var(--tri-date-picker-calendar-position-top);
		left: var(--tri-date-picker-calendar-position-left);
		position: var(--tri-date-picker-calendar-position);
	}

	#content {
		display:none;
	}
	</style>
	<template>
		<iron-media-query query="max-width: 414px" query-matches="{{phone}}"></iron-media-query>
		<paper-input-container hidden="{{_readonlyNoDisabledNoLabel(disabled,readonly,label)}}" class="flex" on-change="_directEdit" invalid="[[_invalid]]" always-float-label$="[[alwaysFloatLabel]]" disabled$="[[disabled]]" no-label-float$="[[noLabelFloat]]">
  			<label id="[[_labelId]]" for$="[[_inputId]]">[[label]]<content id="labelContent" select="[label]"></content></label>
  			<input is="iron-input" id="[[_inputId]]" aria-label="{{_getLabelWithFormatString(label,displayFormat)}}" pattern$="[[_datetimePattern]]" readonly$="[[readonly]]" disabled$="[[disabled]]" bind-value$="{{formatDate(value, displayFormat)}}" on-input="_fireInputChanged" tri-scroll-into-view="">
			<template is="dom-if" if="{{_notDisabledReadonly(disabled,readonly)}}">
			  	<paper-icon-button suffix="" icon="ibm:calendar" id="picker" on-tap="_openTriCalendar" aria-label$="{{_setPickerAriaLabel(label)}}">
		  		</paper-icon-button>
		  	</template>
	  		<paper-input-error>[[_hightLighted]]</paper-input-error>
  		</paper-input-container>
		<template is="dom-if" if="{{_readonlyNoDisabledNoLabel(disabled,readonly,label)}}">
			<span>{{formatDate(value, displayFormat)}}</span>
		</template>
		<template is="dom-if" if="{{_notDisabledReadonly(disabled,readonly)}}">
			<triplat-calendar id="calendar" class="__triPlatDatePickerCalendar" no-cancel-on-esc-key="{{_noCancelOnEscKey}}" no-cancel-on-outside-click="{{_noCancelOnOutsideClick}}" header="{{header}}" current-date="{{_convertToDateObject(_dateValue)}}" initiated-date="{{_initiatedDate}}" disallow-past-dates$="{{disallowPastDates}}" disallow-weekends$="{{disallowWeekends}}" restrict-to-date-list$="{{restrictToDateList}}" valid-date-list="{{validDateList}}" confirm-buttons="{{confirmButtons}}" on-calendar-date-selected="_getDateTime" disable-select-year$="{{disableSelectYear}}" on-iron-overlay-opened="_openCalendar" on-iron-overlay-closed="_closeCalendar">
			</triplat-calendar>
		</template>
		<paper-dialog id="directentryerror" no-cancel-on-outside-click="" role="alertdialog">
			<h2>Invalid value: <span>{{_enteredDateValue}}</span></h2>
			<div>{{_errorMsg}}</div>
		    <div class="buttons">
		        <paper-button id="triCloseButton" dialog-dismiss="">Close</paper-button>
		    </div>

		</paper-dialog>
	</template>
</dom-module>
<script>
	Polymer({

	  is: "triplat-date-picker",

	  /**
       * Fired when the date-picker value changes.
       *
       * @event date-picker-change
       */

       /**
       * Fired when the date-picker input changes due to user interaction.
       *
       * @event date-picker-user-change
       */

       /**
       * Fired every time the value is typed into the date-picker input field.
       *
       * @event date-picker-input-change
       */

	  behaviors: [ 
			Polymer.TriPlatDatePickerBehavior,
			TriDateUtilities,
			TriplatInputContainerBehavior,
			TriBlockScrollFieldIntoViewBehavior
	  ],
	  	
	  listeners: {
			'calendar-date-selected': '_calendarDateSelected'
	  },

	  properties: {

			/**
			 * The ISO date format 
			 */
	  		value: {
	  			type: String,
	  			notify: true,
	  			observer: "_valueChanged"
	  		},

	  		/**
	  		 * Representation of the value as a java.util.Date object
	  		 */
	  		_dateValue: {
	  			type: Date,
	  			observer: "_dateValueChanged"
	  		},

	  		/**
	  		  * Flag indicating whether to display a block above the calendar containing
	  		  * the day of the week, month, day, and year of the currently selected value.<br>
	  		  * <b>true</b> means display the header above the calendar.<br>
	  		  * <b>false</b> means just display the calendar without the header block.<br>
	  		  */
	  		header: {
	  			type: Boolean,
	  			value: false
	  		},

	  		/**
	  		  * String value to be used for the label.
	  		  */
	  		label: {
	  			type: String,
	  			value: null
	  		},

	  		/** 
	  		  * Boolean value to indicate that this is a disabled date value input field. Show
	  		  * the value, but not the date picker. The value will be grayed out and not editable.
	  		  * The value will be underlined to indicate it is an input field.
	  		  */
	  		disabled: {
	  			type: Boolean,
	  			value: false
	  		},

	  		/** 
	  		  * Boolean value to indicate that this is a readonly date value. Show
	  		  * the value, but not the date picker.
	  		  */
	  		readonly: {
	  			type: Boolean,
	  			value: false
	  		}, 

	  		/** 
	  		  * Boolean value to indicate that a null date should be considered as invalid.
	  		  */
	  		nullDateInvalid: {
	  			type: Boolean,
	  			value: false
	  		}, 

	  		/**
	  		  * String value that is null when no error exists or it contains the current error
	  		  * message if the existing value is invalid.
	  		  */
	  		_errorMsg: {
	  			type: String,
	  			value: null,
	  			notify: true
	  		},

	  		_militaryTime: {
	  			type: Object,
	  			value: true
	  		},

	  		_currentTimeZone:{
	  			type: String
	  		},

	  		_initiatedDate:{
	  			type: Boolean
	  		},

	  		_datetimeInvlidmsg:{
	  			type: String
	  		},

	  		_datetimePattern:{
	  			type: String
	  		},
	  		_enteredDateValue:{
	  			type: String
	  		},

	  		/**
	  		  * Flag indicating whether to display "Ok" and "Cancel" buttons in the calendar.<br>
	  		  */
	  		confirmButtons:{
	  			type: Boolean,
	  			value: false
	  		},

	  		/**
	  		  * Flag indicating whether to disable weekends and make them become gray color and unselectable in the calendar.<br>
	  		  */
	  		disallowWeekends: {
		      	type: Boolean,
		      	value: false
		    },
		    /**
			  * Flag that indicates whether to allow the user to select any date, or just select dates 
			  * in the future. If this is specified, then only dates in the future, excluding today, will be able 
			  * to be selected.
			  **/
		    disallowPastDates:{
		    	type: Boolean,
		      	value: false
		    },

		    /**
			  * Date format strings
		     */
		    displayFormat: {
		    	type: String,
		    	value: "MM/DD/YYYY"
		    },

		    _noCancelOnOutsideClick:{
		    	type: Boolean,
		    	value: false
		    },

		    _noCancelOnEscKey:{
		    	type: Boolean,
		    	value: false
		    }, 
		    /**
			  * Flag that indicates whether the date that the user enters is a valid date.<br/>
			  * <b>true</b> means the date picker field appears in red underline color.
			  **/
		    _invalid: {
		    	type: Boolean,
		    	value: false,
		    	reflectToAttribute: true
		    }, 
		    _isoDateLength: {
		    	type: Number,
		    	value: (moment().format("YYYY-MM-DDTHH:mm:ss.SSSZ")).length
		    },
		    /**
		     * Returns the length of a datetime using the UTC time zone.
		     * For example "2016-06-08T23:30:00.000Z" is a datetime with the UTC timezone.
		     */
		    _isoUTCDateLength: {
		    	type: Number,
		    	value: ("YYYY-MM-DDTHH:mm:ss.SSSZ").length
		    },
		    /**
			  * Flag that indicates whether to allow the message to alert when the user enters an invalid date.
			  **/
		    disableErrorMsg: {
		    	type: Boolean,
		    	value: false
		    },
		    /**
	  		  * Set to true to always float the label.
	  		  */
		    alwaysFloatLabel: {
		    	type: Boolean,
		    	value: false
		    },

		    /**
			  * Set to true to disable the floating label.
			  **/
		    noLabelFloat: {
		    	type: Boolean,
		    	value: false
		    },

		    /**
			  * Set to true to disable select year.
			  **/
		    disableSelectYear: {
		    	type: Boolean,
		    	value: false
		    },

		    _userValueChange: {
		    	type: String,
		    	observer: "_fireUserChanged"
		    }, 

		    _lang: String,
	  },

	  _calendarDateSelected: function() {
    		this.set("_errorMsg" , null);
	  },

	  /* Neither disabled nor readonly flag were set
	  */
	  _notDisabledReadonly: function(disabled,readonly) {
	  	return !disabled && !readonly;
	  },

	  /* readonly flag was set, but disabled was not set
	  */
	  _readonlyNoDisableLabel: function(disabled,readonly, label) {
	  	return !disabled && readonly && label;
	  },

	  _readonlyNoDisabledNoLabel: function(disabled,readonly,label) {
	  	return !disabled && readonly && !label;
	  },

	  _dateValueChanged: function() {
	  	this._initiatedDate = false;
	  	if(this._calendarIconIsTapped) {
	  		this._calendarIconIsTapped = false; 
	  		return;
	  	}
	  	if (this._dateValue) {
	  		this.set("value", moment(this._dateValue).format("YYYY-MM-DDTHH:mm:ss.SSSZ"));
	  	}
	  },

	  /**
	    * Handle user directly entering a new value into the input field
	    * without using the calendar.
	    */
	  _directEdit: function(e) {
	  	this.set("_errorMsg" , null);
	  	var newDate = this._convertStringToDate(e.target.value, this.nullDateInvalid);
	  	if (this._errorMsg === null) {
	  		this._directEditRestrictedDateCheck(newDate);
	  	}
		if (this._errorMsg===null) {
			if (newDate === null) {
				this._invalid = false;
				this.set("value", null);
				
			} else {
				this._invalid = false;
				this.set("value", newDate);				
				this.currentTime = newDate;

			}
		} else {
			this._invalid = true;
			if(!this.disableErrorMsg){
				this.$.directentryerror.style.top = this.getBoundingClientRect().top + "px";
				this.$.directentryerror.style.left = this.getBoundingClientRect().left + "px";
				this.$.directentryerror.toggle();
			}
		}
		this._userValueChange = this.value;
	  }, 

	  _getLabelWithFormatString: function(labelValue,userFormat) {
		 var __dictionary__wordin = " in ";
			var __dictionary__wordformat = " format ";
			if(labelValue == null){
				var labelWithFormatString =  __dictionary__wordin + userFormat + __dictionary__wordformat;
			}
			else{
				var labelWithFormatString = labelValue + __dictionary__wordin + userFormat + __dictionary__wordformat;
			}
			return labelWithFormatString;
	  },

	  _openTriCalendar: function(){
	  	this._calendarIconIsTapped = true; 
	  	var withoutTimeIndex, dateString, dateObj;
        if(this.value){
        	withoutTimeIndex = this.value.indexOf("T");
	        dateString = this.value.substring(0, withoutTimeIndex);
	        dateObj =  new Date(moment(dateString).format("YYYY-MM-DDTHH:mm:ss.SSSZ"));
	        if (!this._isDateObject(dateObj)) {
		        // For Arabic (and perhaps other languages), format("YYYY-MM-DDTHH:mm:ss.SSSZ") does not work, so use toISOString()
		        dateObj =  new Date(moment(dateString).toISOString());
		    }
	  		
        } else{
        	dateObj = null;
        }
        this.set("_dateValue", dateObj);
	  	

	  	this.openTriCalendar(this.$$("#picker"), this.$$("#calendar"), this.phone, this.header);
	  },

	  created: function(){
	  	this._currentTimeZone = jstz.determine().name();
	  	this._handleLocale();
	  },

	  attached: function(){
	  	this.timeZone = this.timeZone ? this.timeZone : this._currentTimeZone;
	  	this.allowPastDates = true;
	  	this._initiatedDate = this.value ? true : false;
	  	this._handleCustomLabel();
	  },

	  _handleLocale: function(){
	  	var lang = document.querySelector('html').getAttribute("lang") || 'en';
	  	//TODO to remove this later when have a better way/implementation to handle mock user.
	  	this._lang = (lang === "mock-USER") ? "en" : lang;
	  	moment.locale('en');
	  },

	  _getDateTime: function(e){
	  	var calendarDatetime = e.detail.datetime;
	  	this._calendarIconIsTapped = false;
	  	moment.locale('en');
	  	this.set("_dateValue", moment(new Date(calendarDatetime)));
	  	this._invalid = false;
	  	this._userValueChange = this.value;
	  },
	  
	  _setPickerAriaLabel: function(val){
        if (!val) {
           return "";
        }

		return "Select " + val;
 	  },

 	  _closeCalendar: function(e){
			this.$$("#calendar")._resetCalendar();
			this.$$("#"+this._inputId).focus();
			this._calendarState = false;
 	  },

 	  _openCalendar: function(){
	  	this._calendarState = true;
	  	this._handleBrowserResize();
	  },

	  _convertToDateObject: function(val){
	  	if(val){
	  		return moment(val).toDate();
	  	}
	  	return "";
	  },

	  _valueChanged:function(){ 
  		this.fire("date-picker-change", {date: this.value});
	  },
	  
	  /**
	    * Handle clear value from the input field.
	    */
	  clearDateValue: function(){
        this.value = null ? "" : null;
	  	this.$$('input').bindValue = null;
	  	this.$.directentryerror.close();
	  	this._invalid = false;
	  	this._userValueChange = this.value;
	  },

	 _handleCustomLabel: function(){
		if(Polymer.dom(this.$$('#labelContent')).getDistributedNodes().length >0){
			this.label=" ";
		}
	  },

	  _handleBrowserResize: function(){
	  	var self = this;
	  	window.onresize = function(){
	  		self._openInMobileDevice(self.$$("#calendar"));
	  	} 
	  },

	  _fireInputChanged: function(){
	  	this.fire('date-picker-input-change');
	  },

	  // This event get fired when user edit or input a new date string value in the field and tab out
	  // or click on the date from the calendar 
	  _fireUserChanged: function(){
	  	this.fire('date-picker-user-change', {value: this.value});
	  },
	});
</script><dom-module id="triblock-table-column" assetpath="../triblock-table/">
	
	<template>

		<style>
			:host {
				flex: var(--triblock-table-column-flex, 1);
				justify-content: var(--triblock-table-column-body-flex-alignment, flex-start);
				max-width: var(--triblock-table-column-fixed-width, auto);
				display: none;
			}

			/* Preset classes for columns: */
			:host.narrow {
				flex: var(--triblock-table-column-flex, 0.5);
			}
			:host.wide {
				flex: var(--triblock-table-column-flex, 2);
			}
			:host.extra-wide {
				flex: var(--triblock-table-column-flex, 3);
			}
			:host.centered {
				justify-content: var(--triblock-table-column-body-flex-alignment, center);
			}
			:host.right-aligned {
				justify-content: var(--triblock-table-column-body-flex-alignment, flex-end);
			}

			div[header] {
				justify-content: var(--triblock-table-column-header-flex-alignment, flex-start);
			}
			:host.centered > div[header] {
				justify-content: var(--triblock-table-column-header-flex-alignment, center);
			}
			:host.right-aligned > div[header] {
				justify-content: var(--triblock-table-column-header-flex-alignment, flex-end);
			}
		</style>

		<div header="" id="header"></div>

		
		<template id="defaultTemplate">
			<span>{{value}}</span>
		</template>
		<template id="booleanTemplate">
			<paper-checkbox disabled="" checked="{{value}}" tabindex$="[[tabIndex]]"></paper-checkbox>
		</template>
		<template id="dateTemplate">
			<triplat-date-picker readonly="" value="{{value}}"></triplat-date-picker>
		</template>
		<template id="dateTimeTemplate">
			<triplat-datetime-picker readonly="" value="{{value}}"></triplat-datetime-picker>
		</template>
		<template id="stringWithIdTemplate">
			<span>{{value.value}}</span>
		</template>

	</template>

	<script>
		Polymer({
			is: "triblock-table-column",

			behaviors: [ Polymer.Templatizer ],

			properties: {
				/**
				 * The name of the data-binding variable representing the row index. For columns using user-provided templates, the name is overwritten by the value passed by the user via triblock-table.
				 */
				bindIndexAs: {
					type: String,
					value: "index",
					reflectToAttribute: true
				},

				/**
				 * The name of the data-binding variable representing the row data object. For columns using user-provided templates, the name is overwritten by the value passed by the user via triblock-table.
				 */
				bindItemAs: {
					type: String,
					value: "item",
					reflectToAttribute: true
				},

				/**
				 * The name of the data-binding variable representing the row data value that corresponds to the `property` of the context column. For columns using user-provided templates, the name is overwritten by the value passed by the user via triblock-table.
				 */
				bindValueAs: {
					type: String,
					value: "value",
					reflectToAttribute: true
				},

				/**
				 * Indicate that the default sort direction for this column is descending.
				 */
				defaultSortDescending: {
					type: Boolean,
					value: false
				},

				/**
				 * Default text to display whenever the cell value is empty.
				 */
				defaultText: {
					type: String,
					value: ""
				},

				/**
				 * Default value to replace any empty cell values in this column. If a custom template is being used for this column, note that `defaultValue` is applied only on empty `{{value}}` bindings. This property is applied only whenever `defaultText` is empty.
				 */
				defaultValue: {
					type: Object,
					value: ""
				},

				/**
				 * Tooltip displayed when hovering over column header.
				 */
				headerTooltip: {
					type: String,
					value: ""
				},

				/**
				 * Updatable property to show or hide the column.
				 */
				hide: {
					type: Boolean,
					value: false,
					notify: true,
					observer: "_onHideChange"
				},

				/**
				 * Hide this column if the screen width is less-than-or-equal-to the value.  Accepts any valid value for CSS width.
				 */
				hideOnScreenWidth: {
					type: String,
					value: ""
				},

				/**
				 * Indicate that the property of this column should be the initial sort property.
				 */
				initialSort: {
					type: Boolean,
					value: false
				},

				/**
				 * Remove the column divider in the table header between this column and the previous column, and add a divider between the columns' row cells.
				 */
				mergeWithPreviousColumn: {
					type: Boolean,
					value: false
				},

				/**
				 * Property name from `data` to be used in this column.
				 */
				property: {
					type: String,
					value: "",
					reflectToAttribute: true
				},

				/**
				 * Remove the default cell padding for this column (excluding the header row).
				 */
				removeDefaultCellPadding: {
					type: Boolean,
					value: false
				},

				/**
				 * Indicate that this column is sortable.
				 */
				sortable: {
					type: Boolean,
					value: false
				},

				/**
				 * Column title.
				 */
				title: {
					type: String,
					value: ""
				},

				/**
				 * The `iron-icon` to display instead of `title`.
				 */
				titleIcon: {
					type: String,
					value: ""
				},

				/**
				 * The type of the property (case-insensitive): "STRING", "BOOLEAN", "DATE", "DATETIME", "STRING_WITH_ID".
				 * Used to determine the default display.
				 */
				type: {
					type: String,
					value: "string"
				},

                /** 
                 * Indicates that this column will sort in reverse order, e.g. where a lower number has a higher value.
                 */
                reverseSort: {
                    type: Boolean,
                    value: false
                }
			},

			/**
			 * Return style attribute value for table body cell elements
			 */
			get _bodyCellStyle() {
				return this._computeBodyCellStyleString();
			},

			/**
			 * Return style attribute value for column wrapper elements
			 */
			get _columnStyle() {
				return this._computeColumnStyleString();
			},

			/**
			 * Return style attribute value for table header cell elements
			 */
			get _headerCellStyle() {
				return this._computeHeaderCellStyleString();
			},

			/**
			 * Return all the `<div column>` elements associated to this column currently in the DOM
			 */
			get _columnCells() {
				if (this.columnId) {
					var cells = document.querySelectorAll("div[column][column-id='"+this.columnId+"']");
					return cells;
				}
				return [];
			},

			/**
			 * Return the template to be used for each cell in this column
			 */
			get _columnTemplate() {
				var template = this.queryEffectiveChildren('template');
				if (!template) {
					switch (this.type.toLowerCase()) {
						case "string":
							template = this.$.defaultTemplate;
							break;
						case "boolean":
							template = this.$.booleanTemplate;
							break;
						case "date":
							template = this.$.dateTemplate;
							break;
						case "datetime":
							template = this.$.dateTimeTemplate;
							break;
						case "string_with_id":
							template = this.$.stringWithIdTemplate;
							break;
						default:
							template = this.$.defaultTemplate;
							break;
					}
				}
				return template;
			},

			/**
			 * Return flag indicating if the user has provided a template for this column
			 */
			get _hasUserProvidedTemplate() {
				var template = this.queryEffectiveChildren('template');
				return Boolean(template);
			},

			/**
			 * Generate `_bodyCellStyle` property by examining the CSS variables for `<triblock-table-column>`
			 */
			_computeBodyCellStyleString: function() {
				var styleString = "";

				var justifyContent = this.getComputedStyleValue("justify-content");
				if (justifyContent && justifyContent != "" && justifyContent != "flex-start") {
					styleString += "justify-content: " + justifyContent + ";";
					if (justifyContent == "center") styleString += "text-align: center;";
					else if (justifyContent == "flex-end") styleString += "text-align: right;";
				}
				
				return styleString;
			},

			/**
			 * Generate `_columnStyle` property by examining the CSS variables for `<triblock-table-column>`
			 */
			_computeColumnStyleString: function() {
				var styleString = "";

				var fixedWidth = this.getComputedStyleValue("max-width");
				if (fixedWidth && fixedWidth != "none") {
					// ignore other styles if a fixedWidth is set
					styleString = "min-width: "+fixedWidth+"; max-width: "+fixedWidth+"; width: "+fixedWidth+";";
				} else {
					var flexGrow = this.getComputedStyleValue("flex-grow");
					var flexShrink = this.getComputedStyleValue("flex-shrink");
					var flexBasis = this.getComputedStyleValue("flex-basis");

					styleString = "flex: "+flexGrow+" "+flexShrink+" "+flexBasis+";";
				}
				
				return styleString;
			},

			/**
			 * Generate `_headerCellStyle` property by examining the CSS variables for `<triblock-table-column>`
			 */
			_computeHeaderCellStyleString: function() {
				var styleString = "";

				var justifyContent = getComputedStyle(this.$.header).getPropertyValue("justify-content");
				if (justifyContent && justifyContent != "" && justifyContent != "flex-start") {
					styleString += "justify-content: " + justifyContent + ";";
					if (justifyContent == "center") styleString += " text-align: center;";
					else if (justifyContent == "flex-end") styleString += " text-align: right;";
				}
				
				return styleString;
			},

			/**
			 * Stamp a new template instance for the given stampBindingKey. (See Polymer.Templatizer)
			 */
			_createTemplateInstance: function(stampBindingKey) {
				if (!this._templatized) {
					// this column hasn't been templatized yet (a.k.a. first call to this method) - templatize it

					// in Polymer.Templatizer, _instanceProps defines what local properties are to be used when stamping instances of the template
					this._instanceProps = {};
					this._instanceProps[this.bindIndexAs] = true;
					this._instanceProps[this.bindItemAs] = true;
					this._instanceProps[this.bindValueAs] = true;
					this._instanceProps.tabIndex = true;

					// templatize this component
					var template = this._columnTemplate;
					this.templatize(template);
				}

				// create template instance
				var instance = this.stamp(stampBindingKey);

				// keep track of all template instances created by this component
				if (!this._cellInstances) this._cellInstances = [];
				this._cellInstances.push(instance);

				return instance;
			},

			/* The following methods are used in Polymer.Templatizer */
			_forwardParentProp: function(prop, value) {
				if (this._cellInstances) {
					this._cellInstances.forEach(function(instance) {
						instance[prop] = value;
					}, this);
				}
			},
			_forwardParentPath: function(path, value) {
				if (this._cellInstances) {
					this._cellInstances.forEach(function(instance) {
						instance.notifyPath(path, value, true);
					}, this);
				}
			},
			_forwardInstanceProp: function(templateInstance, prop, value) {
				if (prop == this.bindItemAs) {
					templateInstance._cell.set("rowData", value);
				} else if (prop == this.bindValueAs) {
					templateInstance._cell.set("rowData."+this.property, value);
				}
			},
			_forwardInstancePath: function(templateInstance, path, value) {
				if (path.indexOf(this.bindItemAs+".") === 0) {
					templateInstance._cell.notifyPath("rowData."+path.slice(this.bindItemAs.length+1), value);
				} else if (path.indexOf(this.bindValueAs+".") === 0) {
					templateInstance._cell.notifyPath("rowData."+this.property+"."+path.slice(this.bindValueAs.length+1), value);
				}
			},

			_onHideChange: function(hide) {
				var cells = this._columnCells;
				if (cells) {
					for (var i=0, cell=cells[0]; i<cells.length; i++, cell=cells[i]) {
						if (hide) cell.setAttribute("hidden-by-col-prop", "");
						else cell.removeAttribute("hidden-by-col-prop");
					}
				}
			}
		});
	</script>

</dom-module><dom-module id="triblock-table-row-detail" assetpath="../triblock-table/">

	<script>
		Polymer({
			is: "triblock-table-row-detail",

			behaviors: [ Polymer.Templatizer ],
			
			/**
			 * Return the template to be used for each row-detail section
			 */
			get _detailTemplate() {
				var template = this.queryEffectiveChildren('template');
				return template;
			},

			/**
			 * Stamp a new template instance for the given stampBindingKey. (See Polymer.Templatizer)
			 */
			_createTemplateInstance: function(stampBindingKey) {
				if (!this._templatized) {
					// this row-detail section hasn't been templatized yet (a.k.a. first call to this method) - templatize it

					// in Polymer.Templatizer, _instanceProps defines what local properties are to be used when stamping instances of the template
					this._instanceProps = {};
					this._instanceProps[this.bindIndexAs] = true;
					this._instanceProps[this.bindItemAs] = true;
					this._instanceProps.tabIndex = true;

					// templatize this component
					var template = this._detailTemplate;
					this.templatize(template);
				}

				// create template instance
				var instance = this.stamp(stampBindingKey);

				// keep track of all template instances created by this component
				if (!this._rowDetailInstances) this._rowDetailInstances = [];
				this._rowDetailInstances.push(instance);

				return instance;
			},

			/* The following methods are used in Polymer.Templatizer */
			_forwardParentProp: function(prop, value) {
				if (this._rowDetailInstances) {
					this._rowDetailInstances.forEach(function(instance) {
						instance[prop] = value;
					}, this);
				}
			},
			_forwardParentPath: function(path, value) {
				if (this._rowDetailInstances) {
					this._rowDetailInstances.forEach(function(instance) {
						instance.notifyPath(path, value, true);
					}, this);
				}
			},
			_forwardInstanceProp: function(templateInstance, prop, value) {
				if (prop == this.bindItemAs) {
					templateInstance._rowDetail.set("rowData", value);
				}
			},
			_forwardInstancePath: function(templateInstance, path, value) {
				if (path.indexOf(this.bindItemAs+".") === 0) {
					templateInstance._rowDetail.notifyPath("rowData."+path.slice(this.bindItemAs.length+1), value);
				}
			}
		});
	</script>

</dom-module><dom-module id="triblock-table-cell-instance-manager" assetpath="../triblock-table/">

	<script>
		Polymer({
			is: "triblock-table-cell-instance-manager",

			properties: {
				/**
				 * The name of the data-binding variable representing the row index (that is passed in from `triblock-table`).
				 */
				bindIndexAs: {
					type: String,
					value: "index",
					reflectToAttribute: true
				},

				/**
				 * The name of the data-binding variable representing the row data object (that is passed in from `triblock-table`).
				 */
				bindItemAs: {
					type: String,
					value: "item",
					reflectToAttribute: true
				},

				/**
				 * The name of the data-binding variable representing the row data value that corresponds to the `property` of the context column (that is passed in from `triblock-table`).
				 */
				bindValueAs: {
					type: String,
					value: "value",
					reflectToAttribute: true
				},

				/**
				 * The `column-id` attribute value for the `triblock-table-column` that is associated to this cell instance.
				 */
				columnId: {
					type: String,
					value: "",
					reflectToAttribute: true
				},

				/**
				 * Default value that is passed in from the associated `triblock-table-column`.
				 */
				defaultValue: {
					type: Object,
					value: "",
					reflectToAttribute: true
				},

				/**
				 * Row index value that is passed in from the `iron-list`.
				 */
				index: {
					type: String,
					reflectToAttribute: true,
					observer: "_handleIndexChange"
				},

				/**
				 * Property name that is passed in from the associated `triblock-table-column`.
				 */
				property: {
					type: String,
					value: "",
					reflectToAttribute: true
				},

				/**
				 * Row data that is passed in from the `iron-list`.
				 */
				rowData: {
					type: Object,
					notify: true,
					reflectToAttribute: true
				},

				/**
				 * The `tabIndex` value that is passed in from the `iron-list`.
				 */
				tabIndex: {
					type: String,
					reflectToAttribute: true,
					observer: "_handleTabIndexChange"
				},
			},

			observers: [ "_handleRowDataChange(rowData.*)" ],

			/**
			 * Compute the {{value}} binding value for the templatizer instance
			 */
			_computeValueBinding: function(item) {
				return (item[this.property] == null || item[this.property] === "") ? this.defaultValue : item[this.property];
			},

			/**
			 * Update the template instance for this cell with the row index
			 */
			_handleIndexChange: function(index) {
				if (index != null && index != "{{index}}" && this._instance) {
					this._instance.notifyPath(this.bindIndexAs, parseInt(index)+1, true);
				}
			},

			/**
			 * Create or update the template instance for this cell with the row data
			 */
			_handleRowDataChange: function(change) {
				if (change.path == "rowData") {
					// rowData change
					var item = change.value;
					if (item && item != "{{item}}") {
						if (this._instance) {
							// template instance already created for this cell - update the data bindings
							this._instance.notifyPath(this.bindItemAs, item, true);
							this._instance.notifyPath(this.bindValueAs, this._computeValueBinding(item), true);
						} else {
							// template instance needs to be created and initialized for this cell 

							// create binding key object which has initial values for the instance binding variables
							var stampBindingKey = {};
							stampBindingKey[this.bindIndexAs] = (this.index && this.index != "{{index}}") ? parseInt(this.index)+1 : "";
							stampBindingKey[this.bindItemAs] = item;
							stampBindingKey[this.bindValueAs] = this._computeValueBinding(item);
							stampBindingKey.tabIndex = (this.tabIndex && this.tabIndex != "{{tabIndex}}") ? parseInt(this.tabIndex) : "-1";

							// request new template instance from associated triplat-table-column
							var column = document.querySelector("triblock-table-column[column-id='"+this.columnId+"']");
							var instance = column._createTemplateInstance(stampBindingKey);

							// store references to/from the template instance and this component for later use
							this._instance = instance;
							instance._cell = this;

							// append template instance as sibling to the host
							var parentDom = Polymer.dom(Polymer.dom(this).parentNode);
							parentDom.insertBefore(instance.root, this);
						}
					}
				} else if (change.path == "rowData.splices") {
					console.warn("Unexpected rowData splice encountered");
				} else {
					// rowData property change
					if (this._instance) {
						var changedPath = change.path.substring(change.path.indexOf('.') + 1);

						// update {{item}} subproperty bindings
						this._instance.notifyPath(this.bindItemAs+"."+changedPath, change.value, true);

						// update {{value}} bindings
						if (changedPath == this.property) {
							// update value itself
							this._instance.notifyPath(this.bindValueAs, change.value, true);
						} else if (changedPath.indexOf(this.property+'.') == 0) {
							// update value subproperty
							var valuePath = this.bindValueAs + "." + changedPath.substring(changedPath.indexOf('.') + 1);
							this._instance.notifyPath(valuePath, change.value, true);
						}
					} else {
						console.warn("Unexpected rowData subproperty change before cell instance has been stamped.");
					}
				}
			},
			
			/**
			 * Update the template instance for this cell with the tabIndex
			 */
			_handleTabIndexChange: function(tabIndex) {
				if (tabIndex != null && tabIndex != "{{tabIndex}}" && this._instance) {
					this._instance.notifyPath("tabIndex", parseInt(tabIndex), true);
				}
			},
		
		});
	</script>

</dom-module><dom-module id="triblock-table-row-detail-instance-manager" assetpath="../triblock-table/">

	<script>
		Polymer({
			is: "triblock-table-row-detail-instance-manager",

			properties: {
				/**
				 * The name of the data-binding variable representing the row index (that is passed in from `triblock-table`).
				 */
				bindIndexAs: {
					type: String,
					value: "index",
					reflectToAttribute: true
				},

				/**
				 * The name of the data-binding variable representing the row data object (that is passed in from `triblock-table`).
				 */
				bindItemAs: {
					type: String,
					value: "item",
					reflectToAttribute: true
				},

				/**
				 * The `detail-id` attribute value for the `triblock-table-row-detail` that is associated to this row-detail instance.
				 */
				detailId: {
					type: String,
					value: "",
					reflectToAttribute: true
				},

				/**
				 * Row index value that is passed in from the `iron-list`.
				 */
				index: {
					type: String,
					reflectToAttribute: true,
					observer: "_handleIndexChange"
				},

				/**
				 * Row data that is passed in from the `iron-list`.
				 */
				rowData: {
					type: Object,
					notify: true,
					reflectToAttribute: true
				},
				
				/**
				 * The `tabIndex` value that is passed in from the `iron-list`.
				 */
				tabIndex: {
					type: String,
					reflectToAttribute: true,
					observer: "_handleTabIndexChange"
				},
				
			},

			observers: [ "_handleRowDataChange(rowData.*)" ],

			/**
			 * Update the template instance for this row-detail section with the row index
			 */
			_handleIndexChange: function(index) {
				if (index != null && index != "{{index}}" && this._instance) {
					this._instance.notifyPath(this.bindIndexAs, parseInt(index)+1, true);
				}
			},

			/**
			 * Create or update the template instance for this row-detail section with the new row data
			 */
			_handleRowDataChange: function(change) {
				if (change.path == "rowData") {
					// rowData change
					var item = change.value;
					if (item && item != "{{item}}") {
						if (this._instance) {
							// template instance already created for this row-detail section - update the data bindings
							this._instance.notifyPath(this.bindItemAs, item, true);
						} else {
							// template instance needs to be created and initialized for this row-detail section 

							// create binding key object which has initial values for the instance binding variables
							var stampBindingKey = {};
							stampBindingKey[this.bindIndexAs] = (this.index && this.index != "{{index}}") ? parseInt(this.index)+1 : "";
							stampBindingKey[this.bindItemAs] = item;
							stampBindingKey.tabIndex = (this.tabIndex && this.tabIndex != "{{tabIndex}}") ? parseInt(this.tabIndex) : "-1";

							// request new template instance from associated triblock-table-row-detail
							var rowDetail = document.querySelector("triblock-table-row-detail[detail-id='"+this.detailId+"']");
							var instance = rowDetail._createTemplateInstance(stampBindingKey);
							// store references to/from the template instance and this component for later use
							this._instance = instance;
							instance._rowDetail = this;

							// append new instance as sibling to the host
							var parentDom = Polymer.dom(Polymer.dom(this).parentNode);
							parentDom.insertBefore(instance.root, this);
						}
					}
				} else if (change.path == "rowData.splices") {
					console.warn("Unexpected rowData splice encountered");
				} else {
					// rowData property change
					if (this._instance) {
						// update {{item}} subproperty bindings
						var changedPath = change.path.substring(change.path.indexOf('.') + 1);
						this._instance.notifyPath(this.bindItemAs+"."+changedPath, change.value, true);
					} else {
						console.warn("Unexpected rowData subproperty change before row detail instance has been stamped.");
					}
				}
			},

			/**
			 * Update the template instance for this cell with the tabIndex
			 */
			_handleTabIndexChange: function(tabIndex) {
				if (tabIndex != null && tabIndex != "{{tabIndex}}" && this._instance) {
					this._instance.notifyPath("tabIndex", parseInt(tabIndex), true);
				}
			},
		});
	</script>

</dom-module><dom-module id="triblock-table" assetpath="../triblock-table/">
	
	<template>
		
		<style>
			:host {
				display: block;
				position: relative;
				background-color: var(--triblock-table-background-color, --tri-primary-content-background-color);
				color: var(--triblock-table-color, --tri-primary-content-color);
				font-size: var(--triblock-table-font-size, 14px);
				overflow: auto;

				@apply(--triblock-table);
			}
			
			div[table-header] {
				@apply(--layout-vertical);
				min-height: 0;
			}
			div[table-header][fixed-header] {
				position: absolute;
				z-index: 1;
				width: 100%;
			}
			
			div[header-row] {
				@apply(--layout-horizontal);
				background-color: var(--triblock-table-header-background-color, --tri-primary-content-background-color);
				color: var(--triblock-table-header-color, --ibm-gray-50);
				border-bottom: 1px solid var(--triblock-table-header-row-border-bottom-color, --ibm-gray-30);
				
				@apply(--triblock-table-header);
			}

			div[header-column]:not(:first-child):not([merge-with-previous-column])::before {
				border-left: 1px solid var(--triblock-table-column-divider-color, --tri-primary-content-accent-color);
				content: "";
				position: absolute;
				top: 9px;
				height: 22px;
				
				@apply(--triblock-table-column-divider);
			}
			
			div[header-cell] {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
				@apply(--layout-center);
				box-sizing: border-box;
				border: 1px solid transparent; /* reserve space for focus border */
				height: 40px;
				padding: 5px 10px 5px 9px;
				margin-left: 1px;
				min-width: 0;

				@apply(--triblock-table-header-cell);
			}
			:host-context([dir="rtl"]) div[header-cell] {
				padding-left: 10px;
				padding-right: 9px;
				margin-left: 0;
				margin-right: 1px;
			}

			div[header-cell][sortable] {
				cursor: pointer;
				color: var(--triblock-table-header-sortable-color, --tri-primary-color);
			}
			div[header-cell][sortable]:hover {
				text-decoration: underline;
			}
			div[header-cell][sortable]:focus {
				outline: none;
				border: 1px solid var(--triblock-table-focus-outline-color, --tri-primary-color-20);
			}
			
			span[header-cell-label] {
				flex-shrink: 1;
				overflow: hidden;
				min-width: 0;

				@apply(--triblock-table-header-cell-label);
			}
			
			iron-list[table-body] {
				@apply(--layout-vertical);
			}
			
			div[row-container] {
				@apply(--layout-vertical);

				@apply(--triblock-table-row-container);
			}
			div[row-container][index=even] {
				background-color: var(--triblock-table-even-row-background-color, white);
			}
			div[row-container][index=odd] {
				background-color: var(--triblock-table-odd-row-background-color, --ibm-neutral-2);
			}
			div[row-container][clickable]:hover {
				cursor: pointer;
				background-color: var(--triblock-table-row-hover-background-color, --ibm-neutral-4);

				@apply(--triblock-table-row-hover);
			}
			div[row-container][clickable]:focus {
				cursor: pointer;
				outline: none;
				background-color: var(--triblock-table-row-hover-background-color, --ibm-neutral-4);

				@apply(--triblock-table-row-hover);
			}
			div[row-container][selected] {
				cursor: pointer;
				background-color: var(--triblock-table-row-selected-background-color, --tri-primary-light-color) !important;

				@apply(--triblock-table-row-selected);
			}
			div[row-container]:focus {
				outline-color: var(--triblock-table-focus-outline-color, --tri-primary-color-20);
			}
			
			div[row] {
				@apply(--layout-horizontal);
				background-color: inherit;
				flex-shrink: 0;

				@apply(--triblock-table-row);
			}
			div[row][bolded-row] {
				font-weight: bold;
			}
			
			div[column] {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				background-color: inherit;
				position: relative;
				overflow: hidden;

				@apply(--triblock-table-column);
			}
			div[column][hidden-by-screen-width] {
				display: none !important;
			}
			div[column][hidden-by-col-prop] {
				display: none !important;
			}
			div[column]:not([header-column])[merge-with-previous-column]:not(:first-child)::before {
				border-left: 1px solid var(--triblock-table-column-divider-color, --tri-primary-content-accent-color);
				content: "";
				position: absolute;
				top: 20px;
				height: 24px;
				
				@apply(--triblock-table-column-divider);
			}
						
			div[cell] {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
				@apply(--layout-center);
				background-color: inherit;
				overflow: hidden;
				
				@apply(--triblock-table-cell);
			}
			div[cell]:not([remove-default-cell-padding]):not([icon-cell]) {
				height: 44px;
				padding: 10px;
			}
			div[cell][remove-default-cell-padding] {
				height: 64px;
				padding: 0;
			}
			div[cell][icon-cell] {
				@apply(--layout-center-justified);
				height: 64px;
				padding: 0;
			}

			.row-collapse {
				flex-shrink: 0;
				display: none;
			}
			.row-collapse[opened] {
				display: block;
			}

			.row-collapse-icon {
				height: 44px;
				width: 44px;
				padding: 6px;
				cursor: pointer;
				
				@apply(--triblock-table-row-collapse-icon);
			}
			:host-context([dir="rtl"]) .row-collapse-icon {
				transform: scaleX(-1);
			}

			.row-detail-container {
				border-top: 1px solid var(--triblock-table-row-detail-divider-color, --tri-primary-content-accent-color);
				
				margin: 0 10px;
				padding: 20px 0;
				overflow: hidden;

				@apply(--triblock-table-row-detail);
			}
			
			.selection-checkbox {
				--paper-checkbox-label-spacing: 0px;
				--paper-checkbox-size: 24px;
				--paper-checkbox-ink-size: 45px;

				@apply(--triblock-table-selection-checkbox);
			}

			.selection-radio-button {
				--paper-radio-button-label-spacing: 0px;
				margin-bottom: 1px; /* offsetting weird 1px space above radio buttons being applied from within paper-radio-button */

				@apply(--triblock-table-selection-radio-button);
			}

			.sort-icon {
				--iron-icon-height: 16px;
				--iron-icon-width: 16px;
				flex-shrink: 0;

				@apply(--triblock-table-header-sort-icon);
			}
			.sort-icon:not([column-title=""]) {
				margin-left: 4px;
			}
			:host-context([dir="rtl"]) .sort-icon:not([column-title=""]) {
				margin-left: 0;
				margin-right: 4px;
			}
			.sort-icon.unsorted {
				color: var(--ibm-gray-10);
			}
			.title-icon {
				@apply --triblock-table-header-title-icon;
			}
		</style>

		<div table-header="" id="tableHeader" role="rowgroup" fixed-header$="[[fixedHeader]]" hidden$="[[_isZero(data.length)]]">
			<div header-row="" id="headerRow" role="row">
				
			</div>
		</div>

		<iron-list table-body="" id="tableBodyList" role="rowgroup" items="{{_filteredIronListData}}">
			
		</iron-list>

		<array-selector id="selector" items="{{data}}" selected="{{selected}}" multi="{{multiSelect}}" toggle=""></array-selector>

		<div style="display:none">
			
			<content id="content"></content>
		</div>

	</template>

	<script>
		var TRIBLOCK_TABLE_COLUMN_COUNTER = 0;
		function generateTriblockTableColumnId() {
			return TRIBLOCK_TABLE_COLUMN_COUNTER++;
		}

		Polymer({
			is: "triblock-table",

			/**
			 * Fired after an item is selected or deselected. For single-select, in addition to the row-select event fired for the newly selected item, an additional row-select event will be fired corresponding to the deselection of the previous selection, if any.
			 *
			 * @event row-select
			 */

			/**
			 * Fired after a "tap" event occurs on a row. The row's data object is delivered as "event.detail.item", and the row's template model (used to update any property values in the row template) is delivered as "event.detail.model".
			 *
			 * @event row-tap
			 */

			hostAttributes: {
				role: "grid"
			},

			behaviors: [
				TriPlatAccessibilityBehavior
			],

			properties: {
				/**
				 * Always show the expandable row section in a table row, hide the row expand icon column.
				 */
				alwaysShowRowDetail: {
					type: Boolean,
					value: false
				},
				
				/**
				 * The name of the data-binding variable representing the row index.
				 */
				bindIndexAs: {
					type: String,
					value: "index"
				},

				/**
				 * The name of the data-binding variable representing the row data object.
				 */
				bindItemAs: {
					type: String,
					value: "item"
				},

				/**
				 * The name of the data-binding variable representing the row data value corresponding to the context column's `property`.
				 */
				bindValueAs: {
					type: String,
					value: "value"
				},

				/**
				 * Boolean data property name that determines whether the row text should have bolded text. To negate the property value, prefix the property name with '!'.
				 */
				boldRowProperty: {
					type: String,
					value: ""
				},

				/**
				 * Array containing tabular data to display in the table.  Tabular means each object in the array must have the same set of properties.
				 */
				data: {
					type: Array
				},

				/**
				 * Disable the default behavior of the column titles being used as the tooltip values for the column headers.  Regardless of this setting, the tooltip can be overwritten by specifying a `header-tooltip` on the individual column headers.
				 */
				disableDefaultTooltips: {
					type: Boolean,
					value: false
				},

				/**
				 * Disable the row hover styling.
				 */
				disableRowHoverStyling: {
					type: Boolean,
					value: false
				},

				/**
				 * Automatically expand the row on a row-tap event, if `triblock-table-row-detail` is present.
				 */
				expandOnRowTap: {
					type: Boolean,
					value: false
				},

				/**
				 * Fix the header row, but make the table body scrollable.
				 */
				fixedHeader: {
					type: Boolean,
					value: false,
					observer: "_onFixedHeaderChange",
					reflectToAttribute: true
				},

				/**
				 * Add a numerical index to each row.
				 */
				indexed: {
					type: Boolean,
					value: false
				},

				/**
				 * List of all the media queries currently being tracked from this table
				 */
				_mediaQueryList: {
					type: Array,
					value: function() { return []; }
				},

				/**
				 * When `true`, multiple items may be selected at once.  In this case, `selected` is an array of currently selected items.  When `false`, only one item may be selected at a time.
				 */
				multiSelect: {
					type: Boolean,
					value: false
				},

				/**
				 * Remove the row focusability and `:hover` styling.
				 */
				removeRowFocusAndHover: {
					type: Boolean,
					value: false
				},

				/**
				 * The DOM element that scrolls the content to be used for scrolling pagination.
				 */
				scroller: {
					type: Object,
					notify: true,
					readOnly: true,
					value: function() {
						return this;
					}
				},

				/**
				 * Show checkboxes on the left of each row to allow selection.
				 */
				selectable: {
					type: Boolean,
					value: false
				},

				/**
				 * Boolean data property name that determines whether the row is selected.
				 */
				selectedProperty: {
					type: String,
					value: "selected"
				},

				/**
				 * Automatically select the row on a row-tap event, if `selectable` is specified.
				 */
				selectOnRowTap: {
					type: Boolean,
					value: false
				},

				/**
				 * Indicate that every column is sortable.
				 */
				sortable: {
					type: Boolean,
					value: false
				},
				
				/**
				 * Get/set the sorting direction.  Intended to be bound to the `desc` property of the `data` array in `triplat-query-sort`.
				 */
				sortDescending: {
					type: Boolean,
					value: false,
					notify: true
				},

				/**
				 * Get/set the data property name whose value determines the sorting order for the table.  Intended to be bound to the `name` property of the `data` array in `triplat-query-sort`.
				 */
				sortProperty: {
					type: String,
					value: "",
					notify: true
				},

				/**
				 * Get/set the data property type whose value determines the type of value being sorted.  Intended to be bound to the `type` property of the `data` array in `triplat-query-sort`.
				 */
				sortType: {
					type: String,
					value: "",
					notify: true
				},

				/**
				 * Callback function used to determine the aria-label value of each table row.
				 */
				rowAriaLabelCallback: {
					type: Object
				}
			},

			observers: [
				"_onSortChange(sortProperty, sortDescending, sortType)",
				"_onDataChange(data)"
			],

			attached: function() {
				// set the initial sort column, if any (see `initialSort` property on `triblock-table-column`)
				var initialSortCol = this.queryEffectiveChildren('triblock-table-column[initial-sort]');
				if (initialSortCol) {
					var initialSortProperty = initialSortCol.getAttribute("property");
					if (initialSortProperty) this.set("sortProperty", initialSortProperty);
					var initialSortDescending = initialSortCol.hasAttribute("default-sort-descending");
					if (initialSortDescending) this.set("sortDescending", true);
					var initialSortType = initialSortCol.getAttribute("type");
					if (initialSortType) this.set("sortType", initialSortType);
				}

				// set the iron-list's scrollTarget to this
				this.$.tableBodyList.scrollTarget = this;

				// observe when children elements are added and removed from this component
				Polymer.dom(this.$.content).observeNodes(function() {
					// get the columns and row-detail sections that are passed in via light DOM and use them to initialize the table header and table row template (make sure we only do this once)
					if (!this.initialized) {
						this.debounce("initializeTriblockTable", function() {
							var children = this.getEffectiveChildren();
							var columns = children.filter(function(child) {
								return child.tagName && child.tagName.toLowerCase() == "triblock-table-column";
							});
							this._columns = columns;
							var rowDetail = children.find(function(child) {
								return child.tagName && child.tagName.toLowerCase() == "triblock-table-row-detail";
							});
							this.async(function(){
								this._rowDetail = rowDetail;
								this._initializeMediaQueries(columns);
								this._generateTableHeader(columns, rowDetail);
								this._generateTableListTemplate(columns, rowDetail);
								this.initialized = true;
							}, 300);
						});
					}
				}.bind(this));
			},

			_addOne: function(val) {
				return parseInt(val) + 1;
			},

			_computeCollapseIcon: function(opened) {
				return (opened) ? "hardware:keyboard-arrow-down" : "hardware:keyboard-arrow-right";
			},

			_computeHiddenByColProp: function(columnId) {
				var col = this._columns.find(function(item) {
					return item.getAttribute("column-id") == columnId;
				});
				return (col) ? col.hide : false;
			},

			_computeHiddenByScreenWidth: function(columnId) {
				var col = this._columns.find(function(item) {
					return item.getAttribute("column-id") == columnId;
				});
				if (col) {
					var mediaQuery = window.matchMedia("(max-width: "+col.hideOnScreenWidth+")");
					return mediaQuery.matches;
				} else {
					return false;
				}
			},

			_computeRowIndex: function(val) {
				return (val % 2 == 0) ? "even" : "odd";
			},

			/**
			 * Returns `<div cell>` element for adding into the component DOM
			 */
			_createCellHTML: function() {
				var cell = document.createElement("div");
				cell.setAttribute("cell", "");
				cell.classList.add("style-scope", "triblock-table");
				return cell;
			},

			/**
			 * Returns '<div column>` element for adding into the component DOM
			 */
			_createColumnHTML: function(columnId) {
				var dummyContainerSoWeCanUseInnerHTML = document.createElement("div");
				var dummyInnerHTMLString = "<div column role='gridcell'";
				if (columnId) dummyInnerHTMLString += " hidden-by-screen-width$=[[_computeHiddenByScreenWidth('"+columnId+"')]] hidden-by-col-prop$=[[_computeHiddenByColProp('"+columnId+"')]]";
				dummyInnerHTMLString += "></div>";
				dummyContainerSoWeCanUseInnerHTML.innerHTML = dummyInnerHTMLString;
				var column = dummyContainerSoWeCanUseInnerHTML.children[0];
				column.classList.add("style-scope", "triblock-table");
				return column;
			},

			/**
			 * Returns `<div cell><span>{{defaultText}}</span></div>` for adding into the `iron-list` template
			 */
			_createDefaultTextCellHTML: function(defaultText) {
				var span = document.createElement("span");
				span.innerText = defaultText;
				span.classList.add("style-scope", "triblock-table");

				var cell = document.createElement("div");
				cell.setAttribute("cell", "");
				cell.classList.add("style-scope", "triblock-table");
				cell.appendChild(span);

				return cell;
			},

			/**
			 * Returns `<div header-cell>` element for adding into the component DOM
			 */
			_createHeaderCellHTML: function() {
				var headerCell = document.createElement("div");
				headerCell.setAttribute("header-cell", "");
				headerCell.classList.add("style-scope", "triblock-table");
				return headerCell;
			},

			/**
			 * Returns <div header-cell> element for a sortable column for adding into the component DOM
			 */
			_createHeaderCellSortableHTML: function() {
				var headerCell = document.createElement("div");
				headerCell.setAttribute("header-cell", "");
				headerCell.setAttribute("sortable", "");
				headerCell.setAttribute("tabindex", "0");
				headerCell.classList.add("style-scope", "triblock-table");
				this.listen(headerCell, "tap", "_onSortableHeaderCellTap");
				this.listen(headerCell, "keypress", "_onSortableHeaderCellKeypress")

				return headerCell;
			},

			/**
			 * Returns `<div column header-column>` element for adding into the component DOM
			 */
			_createHeaderColumnHTML: function() {
				var column = document.createElement("div");
				column.setAttribute("column", "");
				column.setAttribute("header-column", "");
				column.setAttribute("role", "columnheader");
				column.classList.add("style-scope", "triblock-table");
				return column;
			},

			/**
			 * Returns `<span header-cell-label>` element for adding into the component DOM
			 */
			_createHeaderCellLabelHTML: function() {
				var label = document.createElement("span");
				label.setAttribute("header-cell-label", "");
				label.classList.add("style-scope", "triblock-table");
				return label;
			},

			/**
			 * Returns `<div cell icon-cell>` element for adding into the component DOM
			 */
			_createIconCellHTML: function() {
				var cell = document.createElement("div");
				cell.setAttribute("cell", "");
				cell.setAttribute("icon-cell", "");
				cell.classList.add("style-scope", "triblock-table");
				return cell;
			},

			/**
			 * Returns `<span>{{index}}</span>` element for adding into the `iron-list` template
			 */
			_createIndexSpanHTML: function() {
				var span = document.createElement("span");
				span.innerText = "{{_addOne(index)}}.";
				span.classList.add("style-scope", "triblock-table");
				return span;
			},

			/**
			 * Returns `<div class="row-collapse" opened$='{{item.rowCollapseOpened}}'>` element for adding into the iron-list template
			 */
			_createIronCollapseHTML: function() {
				var dummyContainerSoWeCanUseInnerHTML = document.createElement("div");
				if (this.alwaysShowRowDetail)
					dummyContainerSoWeCanUseInnerHTML.innerHTML = "<div opened></div>";	
				else
					dummyContainerSoWeCanUseInnerHTML.innerHTML = "<div opened$='{{item.rowCollapseOpened}}'></div>";
				var collapse = dummyContainerSoWeCanUseInnerHTML.children[0];
				collapse.classList.add("row-collapse", "style-scope", "triblock-table");
				return collapse;
			},

			/**
			 * Returns `<iron-icon class="row-collapse-icon">` element for adding into the `iron-list` template
			 */
			_createRowCollapseIconHTML: function() {
				var dummyContainerSoWeCanUseInnerHTML = document.createElement("div");
				dummyContainerSoWeCanUseInnerHTML.innerHTML = "<paper-icon-button primary icon='{{_computeCollapseIcon(item.rowCollapseOpened)}}' on-tap='_onRowCollapseTap' tabindex$='[[tabIndex]]'></paper-icon-button>";
				var icon = dummyContainerSoWeCanUseInnerHTML.children[0];
				icon.classList.add("row-collapse-icon", "style-scope", "triblock-table");
				return icon;
			},

			/**
			 * Returns `<div class="row-detail-container">` element for adding into the component DOM
			 */
			_createRowDetailContainerHTML: function() {
				var div = document.createElement("div");
				div.classList.add("row-detail-container", "style-scope", "triblock-table");
				return div;
			},

			/**
			 * Returns `<div row>` element for adding into the `iron-list` template
			 */
			_createRowHTML: function() {
				var dummyContainerSoWeCanUseInnerHTML = document.createElement("div");
				var innerHTMLString = "<div row role='row'";
				if (this.boldRowProperty && this.boldRowProperty != "") {
					var negateBoldRowProperty = false;
					var boldRowProperty = this.boldRowProperty;
					if (boldRowProperty.charAt(0) == '!') {
						boldRowProperty = boldRowProperty.slice(1);
						negateBoldRowProperty = true;
					}
					var negationChar = (negateBoldRowProperty) ? "!" : "";
					innerHTMLString += " bolded-row$='[["+negationChar+"item."+boldRowProperty+"]]'";
				}
				innerHTMLString += "></div>";
				dummyContainerSoWeCanUseInnerHTML.innerHTML = innerHTMLString;
				var row = dummyContainerSoWeCanUseInnerHTML.children[0];
				row.classList.add("style-scope", "triblock-table");
				return row;
			},

			/**
			 * Returns `<div row-container>` element for adding into the `iron-list` template
			 */
			_createRowContainerHTML: function() {
				var dummyContainerSoWeCanUseInnerHTML = document.createElement("div");
				var dummyInnerHTMLString = "<div row-container selected$='[[item."+this.selectedProperty+"]]' index$='{{_computeRowIndex(index)}}' on-tap='_onRowTap' on-keypress='_onRowTap'";

				dummyInnerHTMLString += " aria-label$='[[_computeRowAriaLabel(item)]]'";

				if (!this.removeRowFocusAndHover) dummyInnerHTMLString += " tabindex$='[[tabIndex]]'";
				dummyInnerHTMLString += "></div>";
				dummyContainerSoWeCanUseInnerHTML.innerHTML = dummyInnerHTMLString;
				var row = dummyContainerSoWeCanUseInnerHTML.children[0];
				if (!this.removeRowFocusAndHover) row.setAttribute("clickable", "");
				row.classList.add("style-scope", "triblock-table");
				return row;
			},

			/**
			 * Returns `<paper-checkbox class="selection-checkbox" checked="{{selected}}">` element for adding into the `iron-list` template
			 */
			_createSelectionCheckboxHTML: function() {
				var dummyContainerSoWeCanUseInnerHTML = document.createElement("div");
				var innerHTMLString = "<paper-checkbox checked='{{item."+this.selectedProperty+"}}' noink tabindex$='[[tabIndex]]' on-tap='_onRowSelectCheckboxTap'></paper-checkbox>";
				dummyContainerSoWeCanUseInnerHTML.innerHTML = innerHTMLString;
				var checkbox = dummyContainerSoWeCanUseInnerHTML.firstElementChild;
				checkbox.innerHTML = ""; // need to clear innerHTML since the contents of paper-checkbox will be applied when row template is stamped
				checkbox.setAttribute("checked", "{{item."+this.selectedProperty+"}}"); // not sure why this line AND checked property specification above are BOTH necessary
				checkbox.classList.add("selection-checkbox", "style-scope", "triblock-table");
				return checkbox;
			},

			/**
			 * Returns `<paper-radio-button checked="{{selected}}">` element for adding into the `iron-list` template
			 */
			_createSelectionRadioButtonHTML: function() {
				var dummyContainerSoWeCanUseInnerHTML = document.createElement("div");
				var innerHTMLString = "<paper-radio-button checked='{{item."+this.selectedProperty+"}}' noink tabindex$='[[tabIndex]]' on-tap='_onRowSelectRadioButtonTap'></paper-radio-button>";
				dummyContainerSoWeCanUseInnerHTML.innerHTML = innerHTMLString;
				var radio = dummyContainerSoWeCanUseInnerHTML.firstElementChild;
				radio.innerHTML = ""; // need to clear innerHTML since the contents of paper-radio-button will be applied when row template is stamped
				radio.setAttribute("checked", "{{item."+this.selectedProperty+"}}"); // not sure why this line AND checked property specification above are BOTH necessary
				radio.classList.add("selection-radio-button", "style-scope", "triblock-table");
				return radio;
			},

			/**
			 * Returns `<iron-icon class="sort-icon">` element for adding into the component DOM
			 */
			_createSortIconHTML: function() {
				var icon = document.createElement("iron-icon");
				icon.classList.add("sort-icon", "style-scope", "triblock-table");
				return icon;
			},

			/**
			 * Returns `<iron-icon class="title-icon">` element for adding into the component DOM
			 */
			_createTitleIconHTML: function() {
				var icon = document.createElement("iron-icon");
				icon.classList.add("title-icon", "style-scope", "triblock-table");
				return icon;
			},

			/**
			 * Create the `<iron-list>` template by combining the `triblock-table-column` templates with some additional mark-up
			 */
			_generateTableListTemplate: function(columns, rowDetail) {
				var rowHTML = this._createRowHTML();

				// if this is an "indexed" table, include the index column
				if (this.indexed) {
					var indexSpanHTML = this._createIndexSpanHTML();

					var iconCellHTML = this._createIconCellHTML();
					iconCellHTML.appendChild(indexSpanHTML);

					var columnHTML = this._createColumnHTML();
					columnHTML.setAttribute("merge-with-previous-column", "");
					columnHTML.setAttribute("style", "min-width: 45px; max-width: 45px; width: 45px;");
					columnHTML.appendChild(iconCellHTML);

					rowHTML.appendChild(columnHTML);					
				}

				// if there are row details specified, include the row-expand icon column and row details expandable section
				if (rowDetail) {
					if (!this.alwaysShowRowDetail) {
						var iconHTML = this._createRowCollapseIconHTML();
						var iconCellHTML = this._createIconCellHTML();
						iconCellHTML.appendChild(iconHTML);

						var columnHTML = this._createColumnHTML();
						columnHTML.setAttribute("merge-with-previous-column", "");
						columnHTML.setAttribute("style", "min-width: 45px; max-width: 45px; width: 45px;");
						columnHTML.appendChild(iconCellHTML);

						rowHTML.appendChild(columnHTML);
					}

					var rowDetailInstanceManager = document.createElement("triblock-table-row-detail-instance-manager");
					rowDetailInstanceManager.rowData = "{{item}}";
					rowDetailInstanceManager.index = "{{index}}";
					rowDetailInstanceManager.tabIndex = "{{tabIndex}}";
					rowDetail.bindItemAs = this.bindItemAs;
					rowDetail.bindIndexAs = this.bindIndexAs;
					rowDetailInstanceManager.bindIndexAs = this.bindIndexAs;
					rowDetailInstanceManager.bindItemAs = this.bindItemAs;
					var detailId = (new Date()).getTime();
					rowDetailInstanceManager.detailId = detailId;
					rowDetail.setAttribute("detail-id", detailId);

					var rowDetailContainerHTML = this._createRowDetailContainerHTML();
					rowDetailContainerHTML.appendChild(rowDetailInstanceManager);

					var iconCollapseHTML = this._createIronCollapseHTML();
					iconCollapseHTML.appendChild(rowDetailContainerHTML);
				}
				
				// if this table is selectable, include the selections column
				if (this.selectable) {
					if (this.multiSelect) var selectionHTML = this._createSelectionCheckboxHTML();
					else var selectionHTML = this._createSelectionRadioButtonHTML();

					var iconCellHTML = this._createIconCellHTML();
					iconCellHTML.appendChild(selectionHTML);

					var columnHTML = this._createColumnHTML();
					columnHTML.setAttribute("merge-with-previous-column", "");
					columnHTML.setAttribute("style", "min-width: 45px; max-width: 45px; width: 45px;");
					columnHTML.appendChild(iconCellHTML);

					rowHTML.appendChild(columnHTML);
				}

				// add a column for each <triblock-table-column>
				columns.forEach(function(col) {
					var columnId;
					if (col.columnId) {
						columnId = col.columnId;
					} else {
						columnId = generateTriblockTableColumnId();
						col.columnId = columnId;
					}

					var cellInstanceManager = document.createElement("triblock-table-cell-instance-manager");
					cellInstanceManager.rowData = "{{item}}";
					cellInstanceManager.index = "{{index}}";
					cellInstanceManager.tabIndex = "{{tabIndex}}";
					if (col._hasUserProvidedTemplate) {
						col.bindIndexAs = this.bindIndexAs;
						col.bindItemAs = this.bindItemAs;
						col.bindValueAs = this.bindValueAs;
						cellInstanceManager.bindIndexAs = this.bindIndexAs;
						cellInstanceManager.bindItemAs = this.bindItemAs;
						cellInstanceManager.bindValueAs = this.bindValueAs;
					}
					cellInstanceManager.property = col.property;
					cellInstanceManager.defaultValue = col.defaultValue;
					cellInstanceManager.columnId = columnId;
					col.setAttribute("column-id", columnId);

					var cellHTML = this._createCellHTML();
					var bodyCellStyle = col._bodyCellStyle;
					if (bodyCellStyle != "") cellHTML.setAttribute("style", bodyCellStyle);
					if (col.removeDefaultCellPadding) cellHTML.setAttribute("remove-default-cell-padding", "");
					cellHTML.appendChild(cellInstanceManager);

					// if defaultText is specified, add a default text cell and include data-binding to determine whether to show the default text cell (empty cell value) or the column template cell (non-empty cell value)
					if (col.defaultText != "") {
						var defaultTextCellHTML = this._createDefaultTextCellHTML(col.defaultText);
						if (bodyCellStyle != "") defaultTextCellHTML.setAttribute("style", bodyCellStyle);

						defaultTextCellHTML.setAttribute("hidden", "{{!_isEmptyCellValue(item, '"+col.property+"')}}");
						cellHTML.setAttribute("hidden", "{{_isEmptyCellValue(item, '"+col.property+"')}}");
					}

					var columnHTML = this._createColumnHTML(columnId);
					if (col.mergeWithPreviousColumn) columnHTML.setAttribute("merge-with-previous-column", "");
					var columnStyle = col._columnStyle;
					columnHTML.setAttribute("style", columnStyle);
					if (col.hideOnScreenWidth != "") {
						columnHTML.setAttribute("hide-on-screen-width", col.hideOnScreenWidth);
					}
					columnHTML.appendChild(cellHTML);
					if (defaultTextCellHTML) columnHTML.appendChild(defaultTextCellHTML);
					columnHTML.setAttribute("column-id", columnId);

					rowHTML.appendChild(columnHTML);
				}.bind(this));

				var rowContainerHTML = this._createRowContainerHTML();
				rowContainerHTML.appendChild(rowHTML);
				if (rowDetail) rowContainerHTML.appendChild(iconCollapseHTML);

				var template = document.createElement("template");
				template.content.appendChild(rowContainerHTML);

				Polymer.dom(this.$.tableBodyList).appendChild(template);
				this._tableBodyListTemplateGenerated = true;
				
				// now that the row template has been added to the <iron-list>, we can templatize the iron-list and initialize the `_filteredIronListData` that gets passed into iron-list's `items` property
				this.$.tableBodyList._ensureTemplatized(); 
				if (this.data) this.set("_filteredIronListData", this.data);
				this.linkPaths("_filteredIronListData", "data");
				this.linkPaths("data", "_filteredIronListData");
				
				// fix console error complaining about null parentProps when the iron-list template model is modified
				this.async(function() {
					if (!this.$.tableBodyList._parentProps) this.$.tableBodyList._parentProps = [];
				});
			},

			/**
			 * Initialize the table header row
			 */
			_generateTableHeader: function(columns, rowDetail) {
				// clear the headerRow
				Polymer.dom(this.$.headerRow).innerHTML = "";

				// if this is an "indexed" table, include the index column
				if (this.indexed) {
					var headerColumnHTML = this._createHeaderColumnHTML();
					headerColumnHTML.setAttribute("merge-with-previous-column", "");
					headerColumnHTML.setAttribute("style", "min-width: 45px; max-width: 45px; width: 45px;");

					Polymer.dom(this.$.headerRow).appendChild(headerColumnHTML);
				}

				// if there are row details specified, include the row-expand icon column
				if (rowDetail && !this.alwaysShowRowDetail) {
					var headerColumnHTML = this._createHeaderColumnHTML();
					headerColumnHTML.setAttribute("merge-with-previous-column", "");
					headerColumnHTML.setAttribute("style", "min-width: 45px; max-width: 45px; width: 45px;");

					Polymer.dom(this.$.headerRow).appendChild(headerColumnHTML);
				}

				// if this table is selectable, include the selections column
				if (this.selectable) {
					var headerColumnHTML = this._createHeaderColumnHTML();
					headerColumnHTML.setAttribute("merge-with-previous-column", "");
					headerColumnHTML.setAttribute("style", "min-width: 45px; max-width: 45px; width: 45px;");

					Polymer.dom(this.$.headerRow).appendChild(headerColumnHTML);
				}

				// add each column in the header row
				columns.forEach(function(col) {
					var columnId;
					if (col.columnId) {
						columnId = col.columnId;
					} else {
						columnId = generateTriblockTableColumnId();
						col.columnId = columnId;
					}

					// set the title label or icon for this header column
					if (col.titleIcon == "") {
						var headerCellLabelHTML = this._createHeaderCellLabelHTML();
						headerCellLabelHTML.textContent = col.title;
					} else {
						var titleIconHTML = this._createTitleIconHTML();
						titleIconHTML.setAttribute("icon", col.titleIcon);
					}

					// add the sort icon if this column is sortable
					var columnIsSortable = this._isColumnSortable(this.sortable, col.sortable);
					if (columnIsSortable) {
						var sortIconHTML = this._createSortIconHTML();
						sortIconHTML.setAttribute("column-title", col.title);
						if (col.property == this.sortProperty) sortIconHTML.setAttribute("icon", (this.sortDescending) ? "ibm:sort-descending" : "ibm:sort-ascending");
						else {
							sortIconHTML.setAttribute("icon", "ibm:sort");
							sortIconHTML.classList.add("unsorted");
						}
					} 

					// create the header cell
					var headerCellHTML = (columnIsSortable) ? this._createHeaderCellSortableHTML() : this._createHeaderCellHTML();
					headerCellHTML.setAttribute("data-property", col.property);
					headerCellHTML.setAttribute("data-type", col.type);
					headerCellHTML.setAttribute("data-reverse-sort", col.reverseSort);
					var headerCellStyle = col._headerCellStyle;
					if (headerCellStyle != "") headerCellHTML.setAttribute("style", headerCellStyle);
					if (this._isColumnSortable(this.sortable, col.sortable)) headerCellHTML.setAttribute("sortable", "");
					if (col.defaultSortDescending) headerCellHTML.setAttribute("default-sort-descending", "");
					if (headerCellLabelHTML) headerCellHTML.appendChild(headerCellLabelHTML);
					if (titleIconHTML) headerCellHTML.appendChild(titleIconHTML);
					if (sortIconHTML) headerCellHTML.appendChild(sortIconHTML);

					// create the column wrapper
					var headerColumnHTML = this._createHeaderColumnHTML();
					headerColumnHTML.setAttribute("column-id", columnId);
					if (col.property == this.sortProperty) headerColumnHTML.setAttribute("aria-sort", (this.sortDescending) ? "descending" : "ascending");
					if (col.mergeWithPreviousColumn) headerColumnHTML.setAttribute("merge-with-previous-column", "");
					var columnStyle = col._columnStyle;
					if (columnStyle != "") headerColumnHTML.setAttribute("style", columnStyle);
					headerColumnHTML.appendChild(headerCellHTML);

					// set the header tooltip if one is specified
					if (col.headerTooltip && col.headerTooltip != "") {
						headerColumnHTML.setAttribute("title", col.headerTooltip);
					} else if (!this.disableDefaultTooltips) {
						headerColumnHTML.setAttribute("title", col.title);
					}

					if (col.hideOnScreenWidth != "") {
						// media queries in `mediaQueryList` will look for this attribute to show/hide the column on screen resize
						headerColumnHTML.setAttribute("hide-on-screen-width", col.hideOnScreenWidth);

						// initially show/hide this cell based on current screen width
						var mediaQuery = window.matchMedia("(max-width: "+col.hideOnScreenWidth+")");
						if (mediaQuery.matches) {
							// hide this cell
							headerColumnHTML.setAttribute("hidden-by-screen-width", "");
						}
					}
					
					if (col.hide) headerColumnHTML.setAttribute("hidden-by-col-prop", "");

					Polymer.dom(this.$.headerRow).appendChild(headerColumnHTML);
				}.bind(this));
			},

			_onFixedHeaderChange: function(fixedHeader) {
				if (fixedHeader) {
					// add scroll listener
					this.listen(this, "scroll", "_updateFixedHeaderPosition");

					// add padding above table body to push it below table header
					this.$.tableBodyList.style.marginTop = "41px";
				} else {
					// remove scroll listener
					this.unlisten(this, "scroll", "_updateFixedHeaderPosition");

					// remove table body padding
					this.$.tableBodyList.style.marginTop = "0px";
				}
			},

			/**
			 * Hide the necessary columns if the media query has been matched
			 */
			_onHideColumnAtScreenWidth: function(mediaQuery) {
				var width = mediaQuery.media.match(/\(max-width: (.+)\)/)[1];
				var matchingColumns = Polymer.dom(this.root).querySelectorAll("div[hide-on-screen-width='"+width+"']");
				if (matchingColumns && matchingColumns.length > 0) {
					if (mediaQuery.matches) {
						// columns should be hidden
						matchingColumns.forEach(function(col) {
							col.setAttribute("hidden-by-screen-width", "");
						});
					} else {
						// columns should be displayed
						matchingColumns.forEach(function(col) {
							col.removeAttribute("hidden-by-screen-width");
						});
					}
				}
			},

			/**
			 * Handler for `row-collapse-icon` tap event. Collapse/expand the row details section.
			 */
			_onRowCollapseTap: function(e) {
				e.stopPropagation();
				var item = e.model.item;
				if (item.rowCollapseOpened) {
					e.model.set("item.rowCollapseOpened", false);
				} else {
					e.model.set("item.rowCollapseOpened", true);
				}
				this.$.tableBodyList.updateSizeForItem(item);
			},

			/**
			 * Handler for row's selection checkbox tap event.
			 */
			_onRowSelectCheckboxTap: function(e) {
				e.stopPropagation();
				var item = e.model.item;
				if (item) {
					var selected = e.currentTarget.checked;

					// maintain `selected`
					this.$.selector.select(item);

					// fire row-select event
					this.fire("row-select", {"item": item, "selected": selected});
				}
			},

			/**
			 * Handler for row's selection `radio-button` tap event.
			 */
			_onRowSelectRadioButtonTap: function(e) {
				e.stopPropagation();
				var item = e.model.item;
				if (item) {
					var isSelected = e.currentTarget.checked;

					// remove previous selection
					if (this.selected && this.selected != item) {
						var selectedModel = this.$.tableBodyList._getModelFromItem(this.selected);
						selectedModel.set("item."+this.selectedProperty, false);
						this.fire("row-select", {"item": this.selected, "selected": false});
					}

					// maintain `selected`
					this.$.selector.select(item);

					// fire row-select event
					this.fire("row-select", {"item": item, "selected": isSelected});
				}
			},

			/**
			 * Checker to verify if the "enter" key was pressed
			 */
			_isEnterKey: function(e) {
				var key = e.which || e.keyCode;
	
				// 13 is enter
				return (key === 13) ? true : false;
			},

			/**
			 * Handler for row tap event
			 */
			_onRowTap: function(e) {
				if (e.type == "keypress" && !this._isEnterKey(e)) {
					return;
				}

				var rowModel = e.model;
				var rowData = rowModel.item;
				
				if (this.expandOnRowTap) {
					if (rowData.rowCollapseOpened) {
						rowModel.set("item.rowCollapseOpened", false);
					} else {
						rowModel.set("item.rowCollapseOpened", true);
					}
					this.$.tableBodyList.updateSizeForItem(rowData);
				}

				if (this.selectable && this.selectOnRowTap) {
					// if single-select, remove previous selection
					if (!this.multiSelect && this.selected && this.selected != rowData) {
						var oldSelectedModel = this.$.tableBodyList._getModelFromItem(this.selected);
						oldSelectedModel.set("item."+this.selectedProperty, false);
						this.fire("row-select", {"item": this.selected, "selected": false});
					}

					// maintain `selected`
					this.$.selector.select(rowData);

					// toggle current selection
					var isSelected = Boolean(rowData[this.selectedProperty]);
					var selectedModel = this.$.tableBodyList._getModelFromItem(rowData);
					selectedModel.set("item."+this.selectedProperty, !isSelected);

					// fire row-select event
					this.fire("row-select", {"item": rowData, "selected": !isSelected});
				}

				this.fire("row-tap", {"item": rowData, "model": rowModel});
			},

			/**
			 * Handle keypress event on header-cell
			 */
			_onSortableHeaderCellKeypress: function(e) {
				if (e.key == "Enter" || e.key == " ") {
					// when Enter or Spacebar is pressed, set sortProperty / cycle through sortDescending
					var column = e.currentTarget;
					var columnProperty = column.getAttribute("data-property");
					var columnDefaultSortDescending = column.hasAttribute("default-sort-descending");
					var columnType = column.getAttribute("data-type");
					var columnReverseSort = (column.getAttribute("data-reverse-sort") == 'true');
					if(columnReverseSort) columnDefaultSortDescending = !columnDefaultSortDescending;
					if (this.sortProperty == columnProperty) {
						if (this.sortDescending == !columnDefaultSortDescending) {
							// reset search to no sort
							this.set("sortProperty", "");
							this.set("sortDescending", false);
							this.set("sortType", "")
						} else {
							// switch sort direction
							this.set("sortDescending", !columnDefaultSortDescending);
						}
					} else {
						// new search column
						this.set("sortProperty", columnProperty);
						this.set("sortDescending", columnDefaultSortDescending);
						this.set("sortType", columnType);
					}
					e.preventDefault();
				}
			},

			/**
			 * Handle tap event on header-cell
			 */
			_onSortableHeaderCellTap: function(e) {
				e.preventDefault();
				e.stopPropagation();

				// set sortProperty / cycle through sortDescending
				var column = e.currentTarget;
				var columnProperty = column.getAttribute("data-property");
				var columnDefaultSortDescending = column.hasAttribute("default-sort-descending");
				var columnType = column.getAttribute("data-type");
				var columnReverseSort = (column.getAttribute("data-reverse-sort") == 'true');
				if(columnReverseSort) columnDefaultSortDescending = !columnDefaultSortDescending;
				if (this.sortProperty == columnProperty) {
					if (this.sortDescending == !columnDefaultSortDescending) {
						// reset search to no sort
						this.set("sortProperty", "");
						this.set("sortDescending", false);
						this.set("sortType", "")
					} else {
						// switch sort direction
						this.set("sortDescending", !columnDefaultSortDescending);
					}
				} else {
					// new search column
					this.set("sortProperty", columnProperty);
					this.set("sortDescending", columnDefaultSortDescending);
					this.set("sortType", columnType);
				}
			},

			/**
			 * Set up media queries based on `triblock-table-column`'s `hide-on-screen-width` values
			 */
			_initializeMediaQueries: function(columns) {
				if (columns && columns.length > 0) columns.forEach(function(col) {
					var mediaQueryString = "(max-width: "+col.hideOnScreenWidth+")";
					
					var mediaQueryFound = false;
					for (var i=0; i < this._mediaQueryList.length; i++) {
						if (this._mediaQueryList[i].media == mediaQueryString) {
							mediaQueryFound = true;
							break;
						}
					}

					if (!mediaQueryFound) {
						var mediaQuery = window.matchMedia(mediaQueryString);
						mediaQuery.addListener(this._onHideColumnAtScreenWidth.bind(this));
						this.push("_mediaQueryList", mediaQuery);
					}
				}, this);
			},

			/**
			 * Return true if this column is sortable
			 */
			_isColumnSortable: function(tableSortable, colSortable) {
				return tableSortable || colSortable;
			},

			/**
			 * Return true if `item[property]` is empty/blank
			 */
			_isEmptyCellValue: function(item, property) {
				return item[property] == null || item[property] === "";
			},

			_isZero: function(val) {
				return val == 0;
			},

			_onDataChange: function(data) {
				// only update _filteredIronListData if the iron-list template has been initialized
				if (this._tableBodyListTemplateGenerated) this.set("_filteredIronListData", data);
			},

			_onSortChange: function(sortProperty, sortDescending, sortType) {
				this._updateSortIcons();
			},

			/**
			 * Update the fixed header position based on current scroll position.
			 */
			_updateFixedHeaderPosition: function() {
				var scrollTop = this.scrollTop;
				this.$.tableHeader.style.top = scrollTop + "px";
			},

			/**
			 * Update the table display based on current sort property and direction.
			 */
			_updateSortIcons: function() {
				if (this.isAttached) this.debounce("updateSortIcons", function() {
					// reset all columns
					var sortIcons = Polymer.dom(this.$.tableHeader).querySelectorAll(".sort-icon");
					if (sortIcons) sortIcons.forEach(function(icon) {
						icon.setAttribute("icon", "ibm:sort");
						icon.classList.add("unsorted");
					});
					var sortColumn = Polymer.dom(this.$.tableHeader).querySelector("div[header-column][aria-sort]");
					if (sortColumn) sortColumn.removeAttribute("aria-sort");
					
					// Set a live area for screen readers
					var liveArea = this.setAriaLiveContainer(this, "tableLiveArea", "polite");
					if (liveArea) liveArea.innerHTML = "";

					// set the current sort column
					var newSortColumnIcon = Polymer.dom(this.$.tableHeader).querySelector('div[data-property="'+this.sortProperty+'"] .sort-icon');
					if (newSortColumnIcon) {
						var newSortColumn = newSortColumnIcon.parentElement;
						var newSortColumnReverse = (newSortColumn.dataset.reverseSort == 'true');
						var newSortColumnHeader = newSortColumn.parentElement;
						if(newSortColumnReverse) {
							newSortColumnIcon.setAttribute("icon", (this.sortDescending) ? "ibm:sort-ascending" : "ibm:sort-descending");
							newSortColumn.setAttribute("aria-sort", (this.sortDescending) ? "ascending" : "descending");
							newSortColumnHeader.setAttribute("aria-sort", (this.sortDescending) ? "ascending" : "descending");
						} else {
							newSortColumnIcon.setAttribute("icon", (this.sortDescending) ? "ibm:sort-descending" : "ibm:sort-ascending");
							newSortColumn.setAttribute("aria-sort", (this.sortDescending) ? "descending" : "ascending");
							newSortColumnHeader.setAttribute("aria-sort", (this.sortDescending) ? "descending" : "ascending");
						}
						newSortColumnIcon.classList.remove("unsorted");
						while (!newSortColumn.hasAttribute("header-column")) newSortColumn = newSortColumn.parentElement;
						
						// Sorted by message for screen readers
						var columnTitle = newSortColumnHeader.title;
						if (columnTitle && columnTitle != "" && liveArea) {
							var __dictionary__sortedByMessage = "Sorted by";
							var __dictionary__ascending = "ascending";
							var __dictionary__descending = "descending";
							liveArea.innerHTML = __dictionary__sortedByMessage + " " + columnTitle + " " + ((this.sortDescending) ? __dictionary__ascending : __dictionary__descending);
						}
					}
				});
			},

			_computeRowAriaLabel: function(item) {
				if (this.rowAriaLabelCallback) {
					return this.rowAriaLabelCallback(item);
				} else {
					return "";
				}
			}

		});
	</script>

</dom-module>

<dom-module id="triblock-search-loading-no-matches" assetpath="../triblock-search-popup/">
	<template>
		<style include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning">
			:host {
				flex: 1;
			}

			.box-no-matches,
			.box-no-results {
				font-style: italic;
				padding: 15px;
			}

			.box-loading {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				flex: 1;
				padding: 5px;
			}
		</style>

		<div class="box-no-matches" hidden="[[_hideNoMatches(noMatches, loading)]]">No matches</div>
		<div class="box-no-results" hidden="[[_hideNoResults(noResults, loading)]]">[[noResultsText]]</div>
		<div class="box-loading" hidden="[[!loading]]"><paper-spinner active=""></paper-spinner></div>
	</template>
</dom-module>

<script>
	Polymer({

		is: "triblock-search-loading-no-matches",

		properties: {
			// Loading from the data source.
			loading: {
				type: Boolean,
				value: false
			},

			// True when the "no matches" container is displayed.
			noMatches: {
				type: Boolean,
				value: true
			},

			// True when the "no results" container is displayed.
			noResults: {
				type: Boolean,
				value: false
			},

			// Text displayed inside the "no results" container.
			noResultsText: String
		},

		_hideNoMatches: function(noMatches, loading) {
			return loading || !noMatches;
		},

		_hideNoResults: function(noResults, loading) {
			return loading || !noResults;
		}

	});
</script>
<dom-module id="triblock-search" assetpath="../triblock-search-popup/">
	<template>
		<style include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning">
			:host {
				flex: 1;
				overflow: hidden;
			}
			:host:not([dropdown]) {
				@apply(--layout-vertical);
			}

			.search-content {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				overflow: hidden;
			}
			:host:not([dropdown]) .search-content {
				overflow: hidden;
			}

			paper-input-container {
				--paper-input-container: {
					padding-top: 8px;
					padding-bottom: 8px;
					@apply(--triblock-search-paper-input-container);
				};

				--paper-input-container-input: {
					font-size: 14px;
					font-family: var(--tri-font-family);

					@apply(--triblock-search-paper-input-container-input);
				};

				--paper-input-container-label: {
					font-size: 14px;

					@apply(--triblock-search-paper-input-container-label);
				};

				--paper-input-container-label-floating: {
					font-size: 14px;

					@apply(--triblock-search-paper-input-container-label-floating);
				};

				--paper-input-container-underline: {
					height: 2px;
				};

				--paper-input-container-color: var(--ibm-gray-30);
				
				@apply(--triblock-search-paper-input);
			}
			:host[dropdown] paper-input-container {
				--paper-input-container: {
					padding-bottom: 1px;
					padding-top: 1px;
				};
			}
			paper-input-container iron-icon {
				margin: 10px;
			}
			paper-input-container paper-icon-button {
				font-family: initial;
				font-size: initial;
				line-height: initial;
			}
			paper-input-container paper-icon-button.icon-clear {
				color: var(--ibm-gray-30);
				--paper-icon-button: {
					height: 30px;
					padding: 5px;
					width: 30px;
				};
			}
			paper-input-container paper-icon-button.icon-select {
				color: var(--ibm-blue-50);
				margin-top: -12px;
				transform: rotate(45deg);
				--paper-icon-button: {
					height: 35px;
					padding: 10px;
					width: 35px;
				};
			}
			paper-input-container input {
				font-family: var(--tri-font-family);
				font-size: 14px;
			}
			paper-input-container input::-webkit-contacts-auto-fill-button {
				display: none !important;
				pointer-events: none;
				position: absolute;
				right: 0;
				visibility: hidden;
			}
			paper-input-container input::-ms-clear {
				display: none;
			}

			.container-results {
				flex: 1;
				margin-top: 1em;
				overflow: auto;
			}

			triblock-table {
				--triblock-table-header: {
					display: none;
				};
				--triblock-table-cell: {
					height: auto !important;
				};
			}

			iron-dropdown {
				border: 1px solid var(--ibm-gray-30);
				border-top: 0;
				box-sizing: border-box;
				position: absolute !important;
			}

			.dropdown-content {
				@apply(--layout);
				@apply(--layout-vertical);
				background-color: white;
			}

			.aux-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				bottom: 0;
				height: 100%;
				position: absolute;
				width: 100%;
			}
			
			.spacer-when-opened {
				margin-bottom: var(--triblock-search-margin-bottom-when-opened, 0px);
			}
		</style>

		<div class="search-content">
			<iron-a11y-keys id="searchFieldKeys" target="[[_searchFieldEl]]" keys="down" on-keys-pressed="_onNavigateResults"></iron-a11y-keys>

			<paper-input-container id="searchField" focused="{{focused}}" disabled$="[[disabled]]" aria-label="{{label}}" no-label-float="">
				<iron-icon icon="ibm:search" prefix="" hidden="[[noSearchIcon]]"></iron-icon>
				<label id="[[_labelId]]" for$="[[_inputId]]">
					[[label]]<content id="labelContent" select="[label]"></content>
				</label>
				<input id="[[_inputId]]" placeholder="[[_computePlaceHolder(placeholder)]]" aria-labelledby="[[_labelId]]" is="iron-input" bind-value="{{_searchValue}}" disabled$="[[disabled]]" aria-label$="{{label}}" on-tap="_onInputTapped">
				<paper-icon-button class="icon-clear" icon="ibm-glyphs:clear-input" suffix="" on-tap="_clearSearch" hidden="[[_hideClearBtn]]" alt$="[[altClearButton]]"></paper-icon-button>
				<paper-icon-button class="icon-select" icon="ibm-glyphs:expand-close" suffix="" on-tap="_onIconSelectTapped" hidden="[[!selectBox]]" alt$="[[altDropdownButton]]"></paper-icon-button>
			</paper-input-container>

			<div id="dropdownAnchor"></div>

			<template is="dom-if" if="[[!dropdown]]">
				<div id="listContainer" class="container-results">
					<triblock-table id="resultsTable" data="{{searchResult}}" disable-default-tooltips="" on-row-tap="_selectItem" on-dom-change="_onResultsTableChanged" on-keydown="_onTableTabPressed" tabindex="-1" row-aria-label-callback="[[rowAriaLabelCallback]]">
						<triblock-table-column>
							<content></content>
						</triblock-table-column>
					</triblock-table>
					<triblock-search-loading-no-matches loading="[[loading]]" no-matches="[[_noMatches]]" no-results="[[_displayNoResults]]" no-results-text="[[noResults]]"></triblock-search-loading-no-matches>
				</div>
			</template>

			<template is="dom-if" if="[[dropdown]]">
				<iron-dropdown id="dropdown" horizontal-align="left" vertical-align="top" vertical-offset="0" position-target="[[_targetEl]]" scroller="{{scroller}}">
					<div id="dropdownContent" class="dropdown-content">
						<triblock-table id="resultsTable" data="{{searchResult}}" disable-default-tooltips="" on-row-tap="_selectItem" on-dom-change="_onResultsTableChanged" on-keydown="_onTableTabPressed" tabindex="-1" row-aria-label-callback="[[rowAriaLabelCallback]]">
							<triblock-table-column>
								<content></content>
							</triblock-table-column>
						</triblock-table>
						<div class="aux-container">
							<triblock-search-loading-no-matches loading="[[loading]]" no-matches="[[_noMatches]]" no-results="[[_displayNoResults]]" no-results-text="[[noResults]]"></triblock-search-loading-no-matches>
						</div>
					</div>
				</iron-dropdown>
			</template>
		</div>
	</template>
</dom-module>

<script>
	Polymer({

		is: "triblock-search",

		behaviors: [
			TriBlockViewResponsiveBehavior,
			TriplatInputContainerBehavior,
			Polymer.IronResizableBehavior
		],

		properties: {
			// Alternate text for the clear icon button.
			altClearButton: {
				type: String,
				value: "Clear search"
			},

			// Alternate text for the dropdown icon button.
			altDropdownButton: {
				type: String,
				value: "Select"
			},

			// Placeholder message for the search input field.
			placeholder: {
				type: String,
				value: null
			},

			// Scrollable container.
			scroller: {
				type: Object,
				notify: true
			},

			// Value of the search field. It will be used by an external data source to filter.
			searchValue: {
				type: String,
				notify: true
			},

			// Array of results from the search.
			searchResult: {
				type: Array,
				value: [],
				observer: "_observeSearchResult"
			},

			// Loading from the data source.
			loading: {
				type: Boolean,
				value: false
			},

			// If true, the table of results will be displayed inside a dropdown.
			dropdown: {
				type: Boolean,
				value: false,
				reflectToAttribute: true
			},

			// If true, the search icon will be hidden.
			noSearchIcon: {
				type: Boolean,
				value: false
			},

			// Label for input field. When setting a label, the placeholder text will not be displayed.
			label: {
				type: String,
				value: ""
			},

			// Boolean to indicate that this is a disabled input field.
			disabled: {
				type: Boolean,
				value: false
			},

			// Value name of the selected item object that will be displayed in the input field when one of the items is selected.
			valueName: String,

			/*
			 * If true, the component will act like a select box, opening the dropdown even when the input field is empty.
			 */
			selectBox: {
				type: Boolean,
				value: false
			},

			/*
			 * Text displayed when there are no results to display in the dropdown.
			 * The text will be displayed only when the `selectBox` property is true, and when the input field is empty.
			 */
			noResults: {
				type: String,
				value: ""
			},

			/*
			 * This property will only work when the `dropdown` property is true.
			 * Set to true to scroll the selected input element into view (on focus). 
			 * If scroll is available, it will align the element to the top of the browser window (if possible).
			 * The scroll into view is applied on mobile devices only, where screens are small and the virtual keyboard takes much of the screen area.
			 */
			scrollElementIntoView: {
				type: Boolean,
				value: false
			},

			// Value from the search field.
			_searchValue: {
				type: String,
				observer: '_observeSearchValue'
			},

			// Hide search clear buttons.
			_hideClearBtn: {
				type: Boolean,
				value: true
			},

			// Search input field object.
			_searchFieldEl: {
				type: Object,
				value: function() {
					return this.$.searchField;
				}
			},

			// Target element for `iron-dropdown`.
			_targetEl: Object,

			// True when "no matches" container should be displayed.
			_noMatches: {
				type: Boolean,
				value: true
			},
			
			// True when an item is selected from the table of results.
			_isItemSelected: {
				type: Boolean,
				value: false
			},

			// True when "no results" should be displayed.
			_displayNoResults: {
				type: Boolean,
				value: false,
				computed: "_computeNoResults(noResults, searchResult, searchValue)"
			},

			/**
			 * Callback function used to determine the aria-label value of each row from the table of results.
			 */
			rowAriaLabelCallback: {
				type: Object
			}
		},

		observers: [
			"_observeLabel(label)",
			"_observeFocused(focused)",
			"_setTableHeight(_searchValue, searchResult)",
			"_setNoMatches(searchValue, searchResult, loading)",
			"_displayAuxContainer(dropdown, loading, _noMatches, _displayNoResults)"
		],

		listeners: {
			"iron-resize": "_screenResize"
		},

		attached: function() {
			// Set the scroller container
			this.async(function() {
				if (this.dropdown) {
					this.set('_targetEl', this.$$("#dropdownAnchor"));
					this.set('scroller', this.$$("triblock-table").scroller);
					this._setDropdownWidth();
				} else {
					this.set('scroller', this.$$("#listContainer"));
				}
			}, 500);
		},

		// Clear search field.
		clearSearch: function(e) {
			this.set("_searchValue", "");
		},

		// Clear search field.
		_clearSearch: function(e) {
			e.stopPropagation();

			this.focusSearchField();
			this.clearSearch();
		},

		// Compute the default placeholder message.
		_computePlaceHolder: function(placeholder) {
			var __dictionary__placeholder = "Search by building name or city";
			return placeholder ? placeholder : __dictionary__placeholder; 
		},

		// Set "_noMatches" container.
		_setNoMatches: function(searchValue, results, loading) {
			this.debounce(
				"setNoMatches",
				function() {
					var hideNoMatches = loading || ((searchValue === "") || (searchValue !== "" && results && results.length > 0));

					this._noMatches = !hideNoMatches;
				},
				200
			);
		},

		// Observer for `searchResult`.
		_observeSearchResult: function(result) {
			if (!result || (this._searchValue === "" && result.length > 0 && !this.selectBox)) {
				this.searchResult = [];
			} else if (this._searchValue === "" && result && result.length > 0 && this.selectBox) {
				// Indicate that the `searchResult` needs to be refreshed.
				// Fix for iOS, that doesn't refresh `triblock-table` inside a closed dropdown.
				// Only required when `selectBox` is true, because it allows the dropdown to open with an empty `_searchValue`.e
				this._refreshSearchResultRequired = true;
			}
		},

		// Enable the label in the search field.
		_observeLabel: function(label) {
			if (label && label !== "") {
				this.$.searchField.querySelector("input").placeholder = "";
				this.$.searchField.noLabelFloat = false;
			}
		},

		// Observe for _searchValue - Use debounce.
		_observeSearchValue: function(value) {
			if (!this.selectBox) {
				this._hideClearBtn = (value == "") ? true : false;
			}

			this.debounce(
				"refreshSearchValue",
				function() {
					this.set("searchValue", value);

					if (this.dropdown && value !== "" && !this._isItemSelected && this.focused) {
						this._openDropdown();
					} else if (this.dropdown && (value === "" || this._isItemSelected)) {
						if (this._isItemSelected) { this._isItemSelected = false; }
						this._closeDropdown();
					}
				},
				300
			);
		},

		// Handle select item from the list.
		_selectItem: function(e) {
			e.stopPropagation();

			// Selected Data
			var selectedData = e.detail.item;

			// Fire the selected item
			this.fire("item-selected", selectedData);

			if (this.valueName && this.valueName !== "") {
				this._searchValue = selectedData[this.valueName];
			} else {
				this._searchValue = "";
			}

			if (this.dropdown && !this._isItemSelected) { this._isItemSelected = true; }
			this._closeDropdown();
		},

		// Handle notify resize, that is required for dynamic table.
		_onResultsTableChanged: function() {
			this.debounce("tableChanged", this.notifyResize, 300);
		},

		// Focus on the search field when the popup opened.
		focusSearchField: function() {
			this.$$("#" + this._inputId).focus();
		},

		// Navigate through the results.
		_onNavigateResults: function() {
			this.$$("#resultsTable").querySelector("div[row-container]").focus();
		},

		// Callback listener for screen resize.
		_screenResize: function() {
			this._setDropdownWidth();
			this._setTableHeight(this._searchValue, this.searchResult);
		},

		// Check if the dropdown is opened.
		_isDropdownOpened: function() {
			var dropdownEl = this.$$("#dropdown");
			return (dropdownEl) ? dropdownEl.opened : false;
		},

		// Open dropdown.
		_openDropdown: function() {
			if (!this._isDropdownOpened()) {
				this.$$("#dropdown").open();

				// Reset the value for `searchResult` when the popup opens.
				if (this._refreshSearchResultRequired) {
					// Set visibility hidden, so the previous results will not be seem before the new table is rendered.
					this.$$("#resultsTable").style.visibility = "hidden";

					this.async(function() {
						var results = this.searchResult;
						this.set("searchResult", []);
						this.set("searchResult", results);
						this.$$("#resultsTable").style.visibility = "visible";
						this.notifyResize();
					}, 300);

					this._refreshSearchResultRequired = false;
				}
			}
		},

		// Close dropdown.
		_closeDropdown: function() {
			if (this._isDropdownOpened()) {
				this.$$("#dropdown").close();
			}
		},

		// Set the dropdown width.
		_setDropdownWidth: function() {
			if (this.$$("#dropdown")) {
				this.$$("#dropdown").style.width = this.$.dropdownAnchor.offsetWidth + "px";
			}
		},

		// Set the triblock-table height.
		_setTableHeight: function(searchValue, searchResult) {
			if (this.dropdown && this.$$("triblock-table")) {
				// Async is required to wait for table to render the rows
				this.async(function() {
					var tableHeight = 0;
					var validSearchResults = searchResult && searchResult.length > 0;

					// Calc to check the remaing space between the element and the bottom of the screen
					var windowHeight = window.innerHeight;
					var inputHeigh = this.$.searchField.offsetHeight;
					var anchorPosition = this.$.dropdownAnchor.getBoundingClientRect().top;
					var calcHeigh = calcHeigh = windowHeight - inputHeigh - anchorPosition;

					// The height of the table list
					var listHeight = this.$$("triblock-table").$.tableBodyList.getBoundingClientRect().height;

					// Check if the list height is greater than the calculated height
					tableHeight = (listHeight > calcHeigh) ? calcHeigh : listHeight;

					// Table should have a min-height of 47px
					tableHeight = (tableHeight < 47) ? 47 : tableHeight;

					// Set table height
					this.$$("triblock-table").style.height = tableHeight + "px";

					this.async(function() { this.$$("#dropdown").refit(); });
				}, 200);
			}
		},

		// Observer for `focused`.
		_observeFocused: function(focused) {
			// Handle scroll element into view
			if (this.scrollElementIntoView && this.smallScreenWidth) {
				if (focused) {
					this.toggleClass("spacer-when-opened", true, this.$.dropdownAnchor);
					this.$.searchField.scrollIntoView(true); //On mobile devices, scrolls the page, if possible, and bring the current input element into a higher area of the screen.
				} else if (!focused) {
					this.toggleClass("spacer-when-opened", false, this.$.dropdownAnchor);
				}
			}
		},

		// Determine when to show and hide the ".aux-container".
		_displayAuxContainer: function(dropdown, loading, noMatches, displayNoResults) {
			if (dropdown && this.$$(".aux-container")) {
				if (loading || noMatches || displayNoResults) {
					this.$$(".aux-container").style.display = "flex";
				} else {
					this.$$(".aux-container").style.display = "none";
				}
			}
		},

		// On input field tapped: Open the dropdown if there's a value in the field.
		_onInputTapped: function() {
			if (this.dropdown && (this._searchValue !== "" || this.selectBox)) {
				this._openDropdown();
			}
		},

		// On icon select tapped.
		_onIconSelectTapped: function() {
			var input = this.$.searchField.querySelector("input");
			this.fire("tap", {}, {node: input});
		},

		// Determine when to display the "no results" text.
		_computeNoResults: function(noResults, searchResult, searchValue) {
			return (noResults !== "") && (!searchResult || searchResult.length == 0) && (searchValue === "");
		},

		get table() {
			return this.$$("#resultsTable");
		},

		_onTableTabPressed: function(e) {
			if (e.key == "Tab" && !e.shiftKey && e.target != this.table) {
				e.preventDefault();
				this.table.focus();
			} else if (e.key == "Tab" && e.shiftKey && e.target == this.table) {
				e.preventDefault();
				this.$$("#resultsTable").querySelector("div[row-container]").focus();
			}
		}

	});
</script>
<dom-module id="triblock-search-popup" assetpath="../triblock-search-popup/">
	<template>
		<style include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning">
			triblock-popup {
				@apply(--layout-vertical);
			}
			triblock-popup[small-screen-width] {
				padding: 10px;

				@apply(--search-popup-small-screen-width);
			}
			triblock-popup:not([small-screen-width])  {
				top: 15%;
				bottom: 15%;
				width: 50%;

				@apply(--search-popup-not-small-screen-width);
			}
			triblock-popup[small-screen-height]:not([small-screen-width]) {
				top: 5%;
				bottom: 5%;
				padding-top: 5px;
				padding-bottom: 5px;
			}
			triblock-popup[medium-screen-width] {
				width: 70%;
			}

			.title {
				font-weight: lighter;
			}
		</style>

		<triblock-popup id="searchPopup" with-backdrop="" title="[[_computeTitle(title)]]" small-screen-max-height="300px" on-iron-overlay-opened="_onPopupOpen" aria-label$="[[_computeTitle(title)]]">

			<span class="title tri-h2" hidden$="[[smallScreen]]">[[_computeTitle(title)]]</span>

			<triblock-search id="searchComponent" placeholder="[[placeholder]]" search-value="{{searchValue}}" scroller="{{scroller}}" search-result="[[searchResult]]" loading="[[loading]]" on-item-selected="_selectItem" row-aria-label-callback="[[rowAriaLabelCallback]]">
				<content></content>
			</triblock-search>

		</triblock-popup>
	</template>
</dom-module>

<script>
	Polymer({

		is: "triblock-search-popup",

		behaviors: [
			TriBlockViewResponsiveBehavior
		],

		properties: {
			// Title message of the popup.
			title: {
				type: String,
				value: null
			},

			// Placeholder message for the search input field.
			placeholder: {
				type: String,
				value: null
			},

			// Scrollable container.
			scroller: {
				type: Object,
				notify: true
			},

			// Value of the search field. It will be used by an external data source to filter.
			searchValue: {
				type: String,
				notify: true
			},

			// Array of results from the search.
			searchResult: Array,

			// Loading from the data source.
			loading: {
				type: Boolean,
				value: false
			},

			// If true it will only provide the search, without the popup.
			searchOnly: {
				type: Boolean,
				value: false
			},

			/**
			 * Callback function used to determine the aria-label value of each row from the table of results.
			 */
			rowAriaLabelCallback: {
				type: Object
			}
		},

		listeners: {
			'iron-overlay-opened': '_popupOpen',
			'iron-overlay-closed': '_popupClose'
		},

		// Open triblock-search-popup.
		open: function() {
			this.$.searchPopup.lastNode = this.$.searchComponent.table;
			this.$.searchPopup.openPopup();
		},

		// Close triblock-search-popup.
		close: function() {
			this.$.searchPopup.closePopup();
		},

		// Clear search field.
		clearSearch: function() {
			this.$.searchComponent.clearSearch();
		},

		_computeTitle: function(title) {
			var __dictionary__title = "Locate a Building";
			return title ? title : __dictionary__title;
		},

		// Listen for popup open.
		_popupOpen: function() {
			this.clearSearch();
		},

		// Listen for popup close.
		_popupClose: function() {
			this.clearSearch();
		},

		// Handle select item from the list.
		_selectItem: function(e) {
			e.stopPropagation();

			// Selected Data
			var selectedData = e.detail;

			// Fire the selected item
			this.fire("search-item-selected", selectedData);

			// Close triblock-popup
			if (!this.searchOnly) {
				this.close();
			}
		},

		// Focus on the search field when the popup opened.
		_onPopupOpen: function() {
			this.$.searchComponent.focusSearchField();
		}

	});
</script>
<script>
	Polymer({
		is: "triplat-word-highlight",

		extends: "span",

		properties: {
			value: {
				type: String,
				value: ""
			},

			searchValue: {
				type: String,
				value: ""
			}
		},

		observers: ["_handleValueChanged(value, searchValue)"],

		_handleValueChanged: function(value, searchValue) {
			var text = "";
			if (searchValue == null) {
				searchValue = "";
			}
			if (value != null) {
				var regex = new RegExp('(' + searchValue + ')','i');
				text = value.replace(regex, "<strong>$1</strong>");
			}
			Polymer.dom(this).innerHTML = text;		
		}
		
	});
 </script>


<dom-module id="triblock-image-info-card" assetpath="../triblock-search-popup/">
	<template include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning">
		<style>
			#horizontal {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			.image {
				position: relative;
				z-index: 1;
				display: inline-block;
				border-radius: 100%;
				overflow: hidden;
				background-color: var(--tri-secondary-color);
				height: 44px;
				width: 44px;
				min-width: 44px;
				@apply(--layout-vertical);
				@apply(--layout-center-justified);

				@apply(--triblock-image-info-card-image-container);
			}
			:host[image-align-top] .image {
				align-self: flex-start;
			}

			.image-non-circular {
				border-radius: 0;
			}

			triplat-image {
				--triplat-image-placeholder-icon: {
					height: 32px;
					width: 32px;
					color: white;

					@apply(--triblock-image-info-card-placeholder-icon);
				};
			}

			.detail {
				@apply(--layout-vertical);
				flex: 1;
				padding: 0 1em;

				@apply(--triblock-image-info-card-detail-container);
			}

			.detail * {
				margin: 0;
				font-size: 14px;
			}

			.detail h3 {
				font-weight: 400;
			}
		</style>

		<div id="horizontal">
			<div class$="[[_computeImageClass(data.picture, circularImage)]]" aria-hidden="true">
				<triplat-image src="[[data.picture]]" width="[[imageWidth]]" height="[[imageHeight]]" sizing="cover" placeholder-icon="[[placeholderIcon]]" cache="[[cacheImage]]" thumbnail="[[thumbnail]]">
				</triplat-image>
			</div>

			<div class="detail">
				<content></content>
			</div>
		</div>
	</template>
</dom-module>

<script>
	Polymer({

		is: "triblock-image-info-card",

		properties: {
			// Data object that should have a `picture` property with an image URL path.
			data: Object,
			
			// Placeholder icon that is displayed when no user-defined image is provided.
			placeholderIcon: String,
			
			// Height in pixels.
			imageHeight: {
				type: Number,
				value: 44
			},

			// Width in pixels.
			imageWidth: {
				type: Number,
				value: 44
			},
			
			// If true, the image will be displayed in a circular container.
			circularImage: {
				type: Boolean,
				value: false
			},

			// If true, the image will be aligned at the top of the card.
			imageAlignTop: {
				type: Boolean,
				value: false,
				reflectToAttribute: true
			},
			
			/**
			 * If true, the images displayed by this component will be saved to the offline cache.
			 */
			cacheImage: {
				type: Boolean,
				value: false
			},
			
			/**
			 * If true, it will display a thumbnail version of the images.
			 */
			thumbnail: {
				type: Boolean,
				value: false
			}
		},

		_computeImageClass: function(image, circularImage) {
			var imageClass = "image" + ((image && !circularImage) ? "image-non-circular" : "");
			return imageClass;
		}

	});
</script>
<dom-module id="tricomp-location-card" assetpath="../triapp-location-context/">
	<template include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning">
		<style>
			.detail * {
				margin: 0;
				font-size: 14px;
			}

			.detail h3 {
				font-weight: 400;
			}
		</style>

		<triblock-image-info-card class="detail" data="[[data]]" placeholder-icon="ibm:buildings" thumbnail="">
			<h3><span is="triplat-word-highlight" value="[[data.building]]" search-value="[[searchValue]]"></span></h3>
			<p>
				<span is="triplat-word-highlight" value="[[data.city]]" search-value="[[searchValue]]"></span><template is="dom-if" if="[[data.stateProvince]]">, </template>
				[[data.stateProvince]]<template is="dom-if" if="[[data.country]]">, </template>
				[[data.country]]
			</p>
		</triblock-image-info-card>

	</template>
	<script>
		Polymer({

			is: "tricomp-location-card",

			properties: {
				data: Object,
				searchValue: String
			},

		});
	</script>
</dom-module>
<dom-module id="tricomp-location-context" assetpath="../triapp-location-context/">
	<template>
		<style>

			:host {
				flex: 1;
			}
			
			:host([small-screen]) .location-image {
				margin-right: 12px;
			}
			
			:host([medium-screen-width]) .search-icon {
				padding: 4px 2px 4px 2px;
				min-width: 30px;
			}

			.location-container {
				@apply --layout-horizontal;
				@apply --layout-justified;
				@apply --layout-center;
			}

			.image-info {
				@apply --layout-horizontal;
				@apply --layout-start;
			}

			.location-info {
				@apply --layout-vertical;
				@apply --layout-justified;
				@apply --layout-self-stretch;
				@apply --layout-start;
				padding-right: 5px;
				color: var(--tri-primary-color-100);
			}
			.location-info-center {
				@apply --layout-center-justified;
			}

			.building {
				font-size: 22px;
			}
			:host([small-screen-width]) .building {
				font-size: 18px;
			}

			.regular-building {
				font-size: 14px;
				font-weight: bold;
			}

			.location-image {
				margin-right: 20px;
				--triplat-image-placeholder-icon: {
					height: 64px;
					width: 64px;
				};
			}

			.change-location {
				background-color: transparent !important;
				color: var(--tri-primary-color) !important;
				font-size: 14px;
				margin: 0 !important;
				padding: 0 !important;
			}

			paper-icon-button {
				margin-top: 15px;
				padding: 4px 4px 4px 11px;
				height: 32px;
				width: 43px;
			}

			.search-icon {
				border-left: 1px solid var(--ibm-gray-10);
			}

		</style>

		<triplat-ds id="lookupBuildingSearch" name="lookupBuilding" filtered-data="{{searchResult}}" loading="{{_lookupBuildingLoading}}" disable="">
			<triplat-query>
				<triplat-query-scroll-page scroller="[[_scroller]]" size="50" disable-auto-fetch=""></triplat-query-scroll-page>
				<triplat-query-filter name="building" operator="contains" value="{{_searchValue}}"></triplat-query-filter>
				<triplat-query-or></triplat-query-or>
				<triplat-query-filter name="city" operator="contains" value="{{_searchValue}}"></triplat-query-filter>
				<triplat-query-sort name="building"></triplat-query-sort>
				<triplat-query-sort name="city"></triplat-query-sort>
			</triplat-query>
		</triplat-ds>

		<div id="locationContainer" class="location-container" on-tap="_changeLocation">
			<div class="image-info">
				<triplat-image class="location-image" src="[[building.picture]]" width="[[imageWidth]]" height="[[imageHeight]]" sizing="cover" placeholder-icon="buildings" hidden="[[noImage]]" thumbnail="" role="img" aria-label="Building"></triplat-image>

				<div class$="[[_computeLocationInfoClass(changeLocationType)]]">
					<tricomp-alert-message warning="" hidden$="[[_hideNoLocationMessage(hideMessage, building)]]">
						<div>[[_noLocationDetectedErrorMessage]]</div>
					</tricomp-alert-message>
					
					<div>
						<div class$="[[_computeBuildingClass(regularFontSize)]]">{{_computeBuildingName(building.building)}}</div>
						<div class="city">
							{{building.city}}<template is="dom-if" if="{{building.stateProvince}}">, </template>{{building.stateProvince}}<template is="dom-if" if="{{building.country}}">, </template>{{building.country}}
						</div>
					</div>
					<paper-button id="changeLocationLink" hidden$="[[!_isLinkType(changeLocationType, disabled)]]" class="tri-link change-location" aria-label="Change location">Change location</paper-button>
				</div>
			</div>
			<paper-icon-button id="changeLocationIcon" hidden$="[[!_isIconType(changeLocationType, disabled)]]" icon="ibm-glyphs:search" class="search-icon" primary="" on-tap="_changeLocation" role="button" alt="Search locations"></paper-icon-button>
		</div>
		
		
		<template is="dom-if" if="[[!noPopup]]">
			<triblock-search-popup id="searchBuildingPopup" title="[[searchTitle]]" placeholder="[[searchPlaceholder]]" scroller="{{_scroller}}" search-value="{{_searchValue}}" search-result="[[searchResult]]" loading="[[_lookupBuildingLoading]]" on-iron-overlay-opened="_enableDS" on-iron-overlay-closed="_disableDS" on-search-item-selected="_buildingSelected" row-aria-label-callback="[[_computeRowAriaLabelCallback]]">
				<template>
					<tricomp-location-card data="[[item]]" search-value="[[_searchValue]]"></tricomp-location-card>
				</template>
			</triblock-search-popup>
		</template>
	</template>
	<script>
		Polymer({

			is: "tricomp-location-context",
			
			behaviors: [TriBlockViewResponsiveBehavior],

			properties: {
				searchTitle: String,
				searchPlaceholder: String,
				building: {
					type: Object
				},
				// link vs icon
				changeLocationType: {
					type: String,
					value: "link"
				},
				showClear: {
					type: Boolean,
					value: false
				},
				imageHeight: {
					type: Number,
					value: 82
				},
				imageWidth: {
					type: Number,
					value: 82
				},
				regularFontSize: {
					type: Boolean,
					value: false
				},
				hideMessage: Boolean,
				_noLocationDetectedErrorMessage: {
					type: String,
					value: function(){
						var __dictionary__noLocationMessage = "We cannot detect your location. Select a location:";
						return __dictionary__noLocationMessage;
					}
				},
				noImage: {
					type: Boolean,
					value: false
				},

				disabled: {
					type: Boolean,
					value: false
				},

				// If true it will disable the search popup
				noPopup: {
					type: Boolean,
					value: false
				},

				// Scroller object to allow the scroll pagination in the building search
				scroller: {
					type: Object
				},

				// Search string for the building search
				searchValue: {
					type: String
				},

				// Search results from the building search
				searchResult: {
					type: Array,
					notify: true
				},

				// Loading from the building search
				loading: {
					type: Boolean,
					value: false,
					notify: true
				},

				_computeRowAriaLabelCallback: {
					type: Function,
					value: function() {
						return this._computeRowAriaLabel.bind(this);
					}
				}
			},

			observers: [
				"_observeScroller(scroller)",
				"_observeSearchValue(searchValue)",
				"_observeLoading(_lookupBuildingLoading)"
			],

			_changeLocation: function() {
				if (!this.disabled) {
					// When `noPopup` is true fire an event instead of open the popup
					if (!this.noPopup) {
						this.$$("#searchBuildingPopup").open();
					} else {
						this.fire("open-search-without-popup");
					}
				}
			},

			_computeBuildingName: function(bldgName) {
				return bldgName;
			},

			_enableDS: function() {
				this.$.lookupBuildingSearch.disable = false;
			},

			_disableDS: function() {
				this.$.lookupBuildingSearch.disable = true;
			},

			_buildingSelected: function(e) {
				var emptyObj = {id: "", value:""};
				var newBuilding = e.detail;
				var oldBuilding = (this.building) ? this.building : emptyObj;

				// Check if the new building is not equal to old building
				if (newBuilding._id != oldBuilding._id) {
					var finalBuilding = {
						id: newBuilding._id,
						value: newBuilding.building
					};

					this.fire("select-building", {building: finalBuilding});
				}
			},

			_isLinkType: function(type, disabled) {
				return !disabled && type == "link"; 
			},

			_isIconType: function(type, disabled) {
				return !disabled && type == "icon"; 
			},

			_computeLocationInfoClass: function(changeLocationType) {
				return (changeLocationType === "icon") ? "location-info location-info-center" : "location-info";
			},

			_computeBuildingClass: function(regularFontSize) {
				return !regularFontSize ? "building" : "regular-building";
			},

			_hideNoLocationMessage: function(hideMessage, building) {
				return hideMessage
						|| (Boolean(building) && building._id);
			},

			// Observers to support `noPopup`
			// In this case data will come and go to an external component
			_observeScroller: function(scroller) {
				if (this.noPopup) {
					this.set("_scroller", scroller);
				}
			},
			_observeSearchValue: function(searchValue) {
				if (this.noPopup) {
					this.set("_searchValue", searchValue);
				}
			},
			_observeLoading: function(loading) {
				if (this.noPopup) {
					this.set("loading", loading);
				}
			},

			_computeRowAriaLabel: function(item) {
				var __dictionary__taskRowAriaLabel1 = "This building is named";
				return __dictionary__taskRowAriaLabel1 + " " + item.building;
			}

		});
	</script>
</dom-module>
<dom-module id="triapp-location-context" assetpath="../triapp-location-context/">
	<template>
		<style>
			:host {
				display: block;
				@apply --layout-vertical;
				background-color: white;
			}

			.container {
				@apply --layout-horizontal;
				@apply --layout-flex;
				display: block;
			}

			.location-container {
				@apply --layout-vertical;
				@apply --layout-center-justified;

				font-size: 18px;
			}

			:host([regular-font-size]) .location-container {
				font-size: 14px;
			}

			.location {
				@apply --layout-horizontal;
				display: block;
			}

			.location-container[disabled] {
				display: none;
			}

			.location-container[disabled] > * {
				display: none;
			}

			.header {
				font-weight: lighter;
				padding-bottom: 5px;
			}

			.title {
				margin-bottom: 15px;
				font-size: 18px;
				font-weight: 300;
				color: var(--tri-primary-content-label-color);
			}

		</style>
		
		<iron-localstorage id="selectedBldgStorage" name="tridata-session" value="{{_tridataSession}}"></iron-localstorage>

		<triplat-ds id="currentUser" name="currentUser" data="{{currentUser}}"></triplat-ds>

		<triplat-ds id="buildingsForSearch" name="buildingsForSearchLocation" data="{{_buildingsForSearch}}" disable=""></triplat-ds>

		<triplat-ds id="lookupBuilding" name="lookupBuilding" data="{{_lookupBuilding}}">
			<triplat-ds-instance instance-id="[[_lookupBuildingId]]"></triplat-ds-instance>
		</triplat-ds>

		<triplat-ds id="primaryBuilding" name="parentBuilding" data="{{_primaryBuilding}}" disable="[[ignorePrimaryLocation]]">
			<triplat-ds-context name="currentUser" context-id="[[currentUser._id]]">
			</triplat-ds-context>
		</triplat-ds>

		<triplat-search-location id="searchLocation" locations="[[_buildingsForSearch]]" closest-location="{{_closestLocation}}" locations-within-threshold="{{withinThreshold}}" threshold="[[locationSearchThresholdDistance]]" disable="[[_computeGeoSearchDisable(_lookupBuildingId, _buildingIdFromLocalStorage, _buildingIdFromLocalStorageLoaded, disabled, _locationType)]]">
		</triplat-search-location>

		<div class="container">
			<div class="location-container" disabled$="[[!locationSearching]]">
				<paper-spinner active=""></paper-spinner>
			</div>

			<div class="location-container" disabled$="[[locationSearching]]">
				<template is="dom-if" if="[[label]]">
					<div class="header tri-h3">
						[[label]]
					</div>
				</template>
				<span class="title" hidden$="[[hideMessage]]">[[_computeLocationMessage(_locationType)]]</span>
				
				<div class="location">
					<tricomp-location-context id="locationContext" search-title="[[searchTitle]]" search-placeholder="[[searchPlaceHolder]]" hide-message="[[!hideMessage]]" building="[[_lookupBuilding]]" image-height="[[imageHeight]]" image-width="[[imageWidth]]" on-select-building="_handleSelectBuilding" change-location-type="[[changeLocationType]]" regular-font-size="[[regularFontSize]]" no-image="[[noImage]]" disabled="[[disabled]]" no-popup="[[noPopup]]" scroller="[[scroller]]" search-value="[[searchValue]]" search-result="{{searchResult}}" loading="{{loading}}">
					</tricomp-location-context>
				</div>
			</div>
		</div>
	</template>
	<script>
		Polymer({
			is: "triapp-location-context",

			behaviors: [TriPlatViewBehavior],

			properties: {
				label: String,
				searchTitle: String,
				searchPlaceHolder: String,
				overrideBuildingId: {
					type: Number,
					value: null,
					notify: true
				},
				_buildingIdFromLocalStorage: {
					type: Number,
					value: -1
				},
				_buildingIdFromLocalStorageLoaded: {
					type: Boolean,
					value: false
				},
				_tridataSession: {
					type: Object
				},
				_lookupBuildingId: {
					type: Number,
					value: -1
				},
				hideMessage: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},
				locationSearching: {
					type: Boolean,
					value: true
				},
				locationSearchError: {
					type: Boolean,
					value: null
				},
				locationSearchThresholdDistance: {
					type: Number,
					value: 100
				},
				imageHeight: {
					type: Number,
					value: 82
				},
				imageWidth: {
					type: Number,
					value: 82
				},
				
				changeLocationType: {
					type: String,
					value: "link" // value can be: link or icon
				},
				regularFontSize: {
					type: Boolean,
					value: false
				},
				noImage: {
					type: Boolean,
					value: false
				},

				disabled: {
					type: Boolean,
					value: false
				}, 

				refresh: {
					type: Boolean,
					observer: '_onRefresh'
				},

				_locationType: {
					type: String,
					value: null, //value can be: selected, primary, geo
				},

				_disableGeoLookup: {
					type: Boolean,
					value: true,
					computed: "_computeGeoSearchDisable(_lookupBuildingId, _buildingIdFromLocalStorage, _buildingIdFromLocalStorageLoaded, disabled, _locationType)"
				},

				// If true it will disable the search popup
				noPopup: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},

				// Scroller object to allow the scroll pagination in the building search
				scroller: {
					type: Object
				},

				// Search string for the building search
				searchValue: {
					type: String
				},

				// Search results from the building search
				searchResult: {
					type: Array,
					notify: true
				},

				// Loading from the building search
				loading: {
					type: Boolean,
					value: false,
					notify: true
				},

				// If `true`, the component will ignore the local storage.
				ignoreLocalStorage: {
					type: Boolean,
					value: false
				},

				// If `true`, the component will ignore the user primary location.
				ignorePrimaryLocation: {
					type: Boolean,
					value: false
				}
			},

			observers: [
				"_onTridataSessionChanged(_tridataSession, ignoreLocalStorage)",
				"_handleClosestLocationChanged(_closestLocation)",
				"_handleUserBuilding(_primaryBuilding, locationSearchError, _closestLocation, _buildingIdFromLocalStorageLoaded, _buildingIdFromLocalStorage, _lookupBuildingId)",
				"_handleBuildingChange(_lookupBuilding)",
				"_handleBuildingForLookup(overrideBuildingId, _buildingIdFromLocalStorage)",
				"_setBuildingIdToStorage(_lookupBuilding, overrideBuildingId, _tridataSession, ignoreLocalStorage)",
				"_setLocationTypeToStorage(_locationType, _tridataSession, ignoreLocalStorage)"
			],

			listeners: {
				"searchLocation.triplat-geo-error": "_handleSearchLocationError",
				"searchLocation.triplat-geo-success": "_handleSearchLocationSuccess",
			},

			_onGeoLocationFound: function() {
				this.$.buildingsForSearch.disable = false;
			},

			_handleBuildingForLookup: function(overrideBuildingId, buildingIdFromLocalStorage) {
				if (overrideBuildingId) {
					this.set("_lookupBuildingId", overrideBuildingId);
				} else if (buildingIdFromLocalStorage) {
					this.set("_lookupBuildingId", buildingIdFromLocalStorage);
				} else {
					this.set("_lookupBuildingId", -1);
				}
			},

			_computeGeoSearchDisable: function(lookupBuildingId, buildingIdFromLocalStorage, buildingIdFromLocalStorageLoaded, disabled, locationType) {
				// Disable geo location search if:
				// 		- explicitly disabled in the component
				//		- location from session has not been loaded yet
				//		- there is already a valid location in session or for look up and it is not the user's primary location
				var disableSearch = disabled
									|| !buildingIdFromLocalStorageLoaded
									|| (buildingIdFromLocalStorage && buildingIdFromLocalStorage > 0 && locationType != "primary") 
									|| (lookupBuildingId && lookupBuildingId > 0 && locationType != "primary");
				if (disableSearch) {
					this.set("locationSearching", false);
				} else if (this.$.searchLocation.disable) {
					this.set("locationSearching", true);
				}
				
				return disableSearch;
			},

			_computeLocationMessage: function(locationType) {
				var __dictionary__usingPrimaryLocation = "We cannot detect your location. Using your primary location:";
				var __dictionary__usingGeoLocation = "We detected your location:";
				var __dictionary__noLocation = "We cannot detect your location. Select a location:";
				var __dictionary__selectedLocation = "Your selected location:";

				if (locationType) {
					if (locationType == "primary") {
						return __dictionary__usingPrimaryLocation;
					} else if (locationType == "geo") {
						return __dictionary__usingGeoLocation;
					} else if (locationType == "selected") {
						return __dictionary__selectedLocation;
					}
				} else {
					return __dictionary__noLocation;
				}
			},

			_handleSearchLocationError: function(e) {
				if (!this._disableGeoLookup) {
					this._setDoneSearching();
					this.set("locationSearchError", true);
				}
			},

			_handleSearchLocationSuccess: function(e) {
				this._onGeoLocationFound();
				this._setDoneSearching();

				// if this has already been set, don't unset it
				if (this.locationSearchError != true) {
					this.set("locationSearchError", false);
				}
			},

			_setDoneSearching: function() {
				this.set("locationSearching", false);
			},

			_handleBuildingChange: function(building) {
				this.fire("location-changed", {building: building});
			},

			_handleUserBuilding: function(building, locationSearchError, closestLocation,
										  buildingIdFromLocalStorageLoaded, buildingIdFromLocalStorage, lookupBuildingId) {
				// only set the user's primary building if:
				// 		- location from session has been loaded
				// 		- and there was no valid location in session or for lookup
				// 		- and there was a locationSearchError or no closest location found from geo lookup
				if (buildingIdFromLocalStorageLoaded 
					&& (!buildingIdFromLocalStorage || buildingIdFromLocalStorage < 1)
					&& (!lookupBuildingId || lookupBuildingId < 1)
					&& (locationSearchError || !closestLocation) && building && building._id) {
					this.set("_locationType", "primary");
					this._setBuilding(building);
				}
			},

			_handleClosestLocationChanged: function(location) {
				if (location == null) {
					return;
				}

				// Detect location within the threshold ?
				if (this.withinThreshold.length > 0) {
					this.set("_locationType", "geo");
					this._setBuilding(location);
				} else {
					this.set("locationSearchError", true);
				}
			},

			_handleSelectBuilding: function(e) {
				if (e && e.detail.building) {
					this.set("overrideBuildingId", null);
					this.set("_locationType", "selected");
					this._setBuilding(e.detail.building);
				}
			},

			_setBuilding: function(building) {
				if (building) {
					var buildingId = building._id ? building._id : building.id;

					// react if it has changed...
					if (buildingId != this._lookupBuildingId) {
						this.set("_lookupBuildingId", buildingId);
						this.set("_buildingIdFromLocalStorage", buildingId);
					}
				} else {
					this.set("_lookupBuildingId", -1);
					this.set("_buildingIdFromLocalStorage", null);
				}
			},

			created: function() {
				if (!Boolean(this.modelAndView)) {
					this.set("modelAndView", "triAppLocationContext");
					this.set("instanceId", -1);
				}
			},

			_onRefresh: function() {
				if (this.refresh) {
					this.set("_buildingIdFromLocalStorageLoaded", false);
					this.set("_buildingIdFromLocalStorage", null);
					this.$.selectedBldgStorage.reload();
				}
			},

			_onTridataSessionChanged: function(tridataSession, ignoreLocalStorage) {
				if (tridataSession) {
					if (tridataSession.locationContextSelectedBuildingId && !ignoreLocalStorage) {
						this.set("_buildingIdFromLocalStorage", tridataSession.locationContextSelectedBuildingId);
					} else {
						this.set("_buildingIdFromLocalStorage", null);
					}

					if (tridataSession.locationContextType && !ignoreLocalStorage) {
						this.set("_locationType", tridataSession.locationContextType);
					} else {
						this.set("_locationType", null);
					}
				} else {
					console.error("TRIRIGA data in session is now invalid.  Logout and log back in to the app.");
				}

				this.set("_buildingIdFromLocalStorageLoaded", true);
			},

			_setBuildingIdToStorage: function(building, overrideBuildingId, tridataSession, ignoreLocalStorage) {
				//do not store in session the override building like (someone else or building pass from portal)
				if (!overrideBuildingId && building && building._id && !ignoreLocalStorage) {
					this.set("_tridataSession.locationContextSelectedBuildingId", building._id);
				}
			},

			_setLocationTypeToStorage: function(locationType, tridataSession, ignoreLocalStorage) {
				if (locationType && !ignoreLocalStorage) {
					this.set("_tridataSession.locationContextType", locationType);
				}
			},

			reload: function() {
				this.set("overrideBuildingId", null);
				this.set("_locationType", "selected");
				this.set("_buildingIdFromLocalStorage", null);
				this.$.selectedBldgStorage.reload();
			},

			// Functions to allow enable and disable the building search DS
			enableSearchDs: function() {
				this.$.locationContext._enableDS();
			},
			disableSearchDs: function() {
				this.$.locationContext._disableDS();
			}
		});
	</script>
</dom-module>
<dom-module id="shared-app-layout-styles" assetpath="">
	<template>
		<style>
			triplat-route-selector, iron-pages {
				@apply(--layout-flex);
				@apply(--layout-vertical);
			}

			iron-pages > * {
				@apply(--layout-flex);
			}

			triplat-loading-indicator {
				--triplat-loading-indicator-clear-background: rgba(0, 0, 0, 0.12);
				--triplat-loading-indicator-container: {
					position: fixed;
				}
			}
		</style>
	</template>
</dom-module>

<dom-module id="shared-page-styles" assetpath="">
	<template>
		<style>
			.page-header {
				@apply(--layout-justified);
				@apply(--layout-horizontal);
				@apply(--layout-center);
				padding: 20px;
			}

			.header-text {
				font-weight: bold;
			}

			.page-main {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				@apply(--layout-center);

				min-height: 0;

				background-color: var(--tri-primary-content-background-color);

				box-sizing: border-box; /* This is necessary to prevent any padding applied on page-main elements from overflowing (happens on small screen) */
			}
			.page-main[disabled] * {
				opacity: .8;
				pointer-events: none;
			}

			.page-message {
				@apply(--layout-horizontal);
				@apply(--layout-wrap);
				@apply(--layout-scroll);
				max-height: 64px;

				padding: 5px;

				flex-shrink: 0;

				background-color: var(--tri-danger-color);
				color: white;
				text-align: center;
			}

			.page-wrap { /* place directly inside page-main */
				@apply(--layout-vertical);
				@apply(--layout-flex);
				width: 100%;
			}

			.page-wrap > * {
				flex-shrink: 0; /* prevent all children from shrinking - we want content to overflow and be scrollable */
			}

			.empty-data-message {
				@apply(--layout-vertical);
				@apply(--layout-center-center);
				text-align: center;
				padding: 0 20px;
			}

			.end-reservation-time-icon {
				color: var(--ibm-gray-30);
			}

			.favorite-icon {
				color: var(--tri-primary-icon-button-color);
			}

			.favorite-icon:hover {
				color: var(--tri-primary-icon-button-hover-color)!important;
			}

			.favorite-icon[favorited] {
				color: var(--tri-primary-icon-button-press-color);
			}

			.favorite-icon[active][toggles] {
				color: var(--tri-primary-icon-button-press-color);
			}

			.field-container {
				@apply(--layout-vertical);
				padding: 8px 0;
			}
			
			.field-label {
				font-size: .75em;
				color: var(--tri-primary-content-label-color);
			}

			/* hold-time-message should be hidden until necessary via the [show] attribute */
			.hold-time-message:not([show]) {
				display: none;
			}
			.hold-time-countdown {
				display: inline-flex;
				--countdown: {
					font-size: 20px;
				};
			}

			.link {
				color: var(--tri-primary-color);
				cursor: pointer;
				text-decoration: underline;
			}
			.link[disabled] {
				pointer-events: none;
				cursor: pointer;
				opacity: 0.3;
			}

			.expand-button {
				height: 32px;
				width: 32px;
				--iron-icon-stroke-color: var(--tri-primary-color);
			}

			paper-checkbox {
				--paper-checkbox-size: 24px;
			}

			paper-dropdown-menu {
				--paper-dropdown-menu-ripple: {
					display: none;
				};
				--paper-input-container-input: {
					overflow: hidden;
					white-space: nowrap;
					text-overflow: ellipsis;
					max-width: 100%;
					box-sizing: border-box;

					cursor: pointer;
					font-family: var(--tri-font-family);
				};
			}

			paper-tabs {
				--paper-tabs-selection-bar-color: white;
				--paper-tabs-selection-bar: {
					height: 7px;
				};
				--paper-tabs: {
					background-color: var(--tri-primary-color);
				};
			}
			paper-tab {
				--paper-tab: {
					@apply(--layout-flex);
					color: white;
					font-family: var(--tri-font-family);
					font-size: 18px;
				};
			}
			paper-tab.iron-selected {
				font-weight: bold;
			}

			.required-asterisk {
				color: var(--tri-danger-color);
				font-size: 20px;
			}

			.start-reservation-time-icon {
				color: var(--ibm-green-30);
			}

			triplat-date-picker,
			triplat-datetime-picker {
				--triplat-date-picker-icon-color: var(--tri-primary-color);
			}

			.with-border {
				border-bottom: 1px solid var(--tri-primary-content-accent-color);
			}

			.padded-container {
				padding: 0 20px;
			}

			.toolbar-symmetrical paper-button {
				white-space: nowrap;
				flex-basis: 25%;
			}
			
			:host[small-screen-width] .toolbar-symmetrical paper-button {
				flex-basis: 50%;
			}
			
			triplat-loading-indicator {
				--triplat-loading-indicator-clear-background: rgba(0, 0, 0, 0.12);
				--triplat-loading-indicator-container: {
					position: fixed;
				}
			}

			.multiline-overflow-text {
				position: relative;
				max-height: 2.4em;
				line-height: 1.2em;
				overflow: hidden;
			}
		</style>
	</template>
</dom-module>

<style is="custom-style">
	:root iron-overlay-backdrop {
		--iron-overlay-backdrop-opacity: 0.12;
	}
</style><script>
	TriRoomReservationUtilBehavior = {

		properties: {
			_meetingSpaceId: Number,
			_workspaceId: Number,
			_hasBookedRooms: {
				type: Boolean,
				value: false,
				computed: "_computeHasBookedRooms(reservationLocations)"
			}
		},

		listeners: {
			"room-types-changed" : "_onRoomTypesChanged"
		},

		_onRoomTypesChanged: function(e) {
			if (e.detail.roomTypes && e.detail.roomTypes.length > 0) {
				e.detail.roomTypes.forEach(function(roomType) {
					if (roomType.internalValue == "Meeting Space") {
						this.set("_meetingSpaceId", roomType._id);
					} else if (roomType.internalValue == "Workspace") {
						this.set("_workspaceId", roomType._id);
					}
				}.bind(this));
			}
		},

		_computeArrayItem: function(change, index, path) {
			return this.get(path, change.base[index])
		},

		_isRoomTypeMeetingSpace: function(roomType, meetingSpaceId) {
			return roomType && roomType.id == meetingSpaceId;
		},

		_isRoomTypeWorkspace: function(roomType, workspaceId) {
			return roomType && roomType.id == workspaceId;
		},

		_isStartAndEndTimesValid: function(start, end) {
			var mo = moment();
			var startMo = moment(start);
			var endMo = moment(end);
			return startMo.isBefore(endMo);
		},

		_isAllDayStartAndEndDatesValid: function(start, end) {
			var mo = moment();
			var startMo = moment(start);
			var endMo = moment(end);
			return startMo.isBefore(endMo, 'day') || startMo.isSame(endMo, 'day');
		},

		_computeEmailAddressLink: function(email) {
			return "mailto:" + email;
		},

		_computeTelephoneLink: function(phoneNumber) {
			return "tel:" + phoneNumber;
		},

		_generateRandomIDValue: function() {
			return "" + Math.random();
		},

		_isRoomServiceAvailable: function(value) {
			return value && (value == true || value == "Yes");
		},

		_isAvailable: function(item) {
			return Boolean(item && item._availCount && item._availCount > 0);
		},

		_isRecurring: function(item) {
			return Boolean(item && item._maxOccurrenceCount && item._maxOccurrenceCount > 1);
		},

		_isNoEndRecurringCutoff: function(item, reservationManager, currentTime) {
			if (item && reservationManager && currentTime) {
				return this._isRecurring(item) && reservationManager.eventQueryEndDateTime == null && item.cutoffDuration > 0;
			} else {
				return false;
			}
		},

		_isEndCutoff: function(item, reservationManager, currentTime, timezone, cutoffDateTime) {
			if (item && reservationManager && currentTime) {
				if (reservationManager.eventQueryEndDateTime && item.cutoffDuration && item.cutoffDuration > 0) {
					var endMo = moment(reservationManager.eventQueryEndDateTime).tz(timezone);
					var cutoffDateTimeMo = moment(cutoffDateTime).tz(timezone);
					return endMo.isAfter(cutoffDateTimeMo, "day") || endMo.isSame(cutoffDateTimeMo, "day");
				} else {
					return false;
				}
			} else {
				return false;
			}
		},

		_isRecurringMeeting: function(reservationManager) {
			return Boolean(reservationManager && reservationManager.recurrenceRule && reservationManager.recurrenceRule.length > 0);
		},

		_isWaitListable: function(item) {
			return !this._isAvailable(item) && !this._isRecurring(item);
		},

		_isOdd: function(index) {
			return index % 2 == 1;
		},

		_randomYesNo: function(index) {
			var rdm = Math.round(Math.random()) == 0 ? "Yes" : "No";
			return rdm;
		},

		_randomTrueFalse: function(index) {
			var rdm = Math.round(Math.random()) == 0;
			return rdm;
		},

		_computeRoomLoc: function(building, floor) {
			return building + (floor ? " / " + floor : "");
		},

		_computeRoomGeo: function(city, state, country) {
			return (city ? city : "") + (state ? " / " + state : "") + (country ? " / " + country : "");
		},

		_logExchangeResponse: function(exchangeResponse) {
			if (exchangeResponse && exchangeResponse.responseCode) {
				try {
					var responseCode = Number(exchangeResponse.responseCode);
					var message = exchangeResponse.messageContent;

					// 200-Success, 300-Info, 400-Warning, 500-Error
					if (responseCode == 300) {
						console.log("*** INFO: " + message);
					} else if (responseCode == 400) {
						console.log("*** WARN: " + message);
					} else if (responseCode == 500) {
						console.log("*** ERROR: " + message);
					}

				} catch(err) {
					console.log("*** ERROR: " + err.message);
				}
			}
		},

		_computeImageUrl: function(img, baseUrl) {
			if (!img) {
					return "";
			}
			return baseUrl + img;
		},

		_handleNavigateSummary: function(e) {
			this.fire("navigate-summary-page");
		},

		_handleNavigateHome: function(validated) {
			this.fire("navigate-home", {validated: validated});
		},

		_showDiscardChanges: function(isOutlookEmbedded, reservationManager) {
			return !this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager) && !isOutlookEmbedded && this._isExistingReservation(reservationManager);
		},

		_showAddAnotherRoom: function(isOutlookEmbedded, reservationManager) {
			return !this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager);
		},

		_showSubmit: function(isOutlookEmbedded, reservationManager) {
			return !this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager) && !this._isExistingReservation(reservationManager);
		},

		_showSave: function(isOutlookEmbedded, reservationManager) {
			return !this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager) && this._isExistingReservation(reservationManager);
		},

		_showDone: function(isOutlookEmbedded, reservationManager) {
			return true;
		},

		_showDelete: function(isOutlookEmbedded, reservationManager) {
			return !this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager) && !isOutlookEmbedded;
		},

		_showList: function(isOutlookEmbedded) {
			return !isOutlookEmbedded;
		},

		_showImage: function(applicationSettings) {
			if (applicationSettings) return !applicationSettings.disableImages;
			return false;
		},

		_positionDoneToolbarRight: function(isOutlookEmbedded, reservationManager) {
			return !this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager);
		},

		_readonlySubject: function(isOutlookEmbedded, reservationManager) {
			return this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager);
		},

		// determine if this is an outlook reservation being opened outside an outlook embedded scenario
		_isOutsideOutlook: function(isOutlookEmbedded, reservationManager) {
			return (!isOutlookEmbedded && this._isOutlookMeeting(reservationManager));
		},

		// determine if this should be read-only due to the fact that
		// this is an outlook meeting being opened outside of outlook
		_isReadOnlyOutlook: function(isOutlookEmbedded, reservationManager) {
			var rtn = this._isOutsideOutlook(isOutlookEmbedded, reservationManager);
			return rtn;
		},

		// determine if this should be read-only (like trying to edit from non-outlook embedded scenarios)
		_isOutlookMeeting: function(reservationManager) {
			var rtn = reservationManager != null && (reservationManager.iCalUID != null && reservationManager.iCalUID.length > 0);
			return rtn;
		},

		_isExistingReservation: function(reservationManager) {
			return reservationManager != null && (reservationManager.reservation != null && reservationManager.reservation.id);
		},

		// Handlers from Summary Page
		//
		_computeDoneEnabled: function(startTime, endTime, allDay, startDate, endDate, reservationLocations, isOutlookEmbedded, reservationManager) {
			var doneEnabled = false;

			if (!this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager) && reservationLocations.base.length == 0) {
					if (allDay) {
							doneEnabled = startDate && endDate ? this._isAllDayStartAndEndDatesValid(startDate, endDate) : doneEnabled;
					} else {
							doneEnabled = startTime && endTime ? this._isStartAndEndTimesValid(startTime, endTime) : doneEnabled;
					}
			} else if (this._isReadOnlyOutlook && reservationLocations.base.length >= 0) {
				doneEnabled = true;
			}
		return doneEnabled;
		},

		_doCancel: function(e) {
			this.fire("action-cancel");
		},

		_handleCheckIn: function(e) {
			this.fire("action-checkin");
		},

		_handleCheckOut: function(e) {
			this.fire("action-checkout");
		},

		_handleEarlyEnd: function(e) {
			this.fire("action-earlyend");
		},

		_handleStart: function(e) {
			if (this.reservationManagerInstance.cancellationAutoDateTime) {
				console.log("this meeting has an auto-cancellation policy - skipping auto start");
			} else {
				this.set("reservationManagerInstance.actualStart", new Date());
			}
		},

		_handleEnd: function(e) {			
			this.set("reservationManagerInstance.actualEnd", new Date());
		},

		_handleAutoCancel: function(e) {
			if (this.reservationManagerInstance.cancellationAutoDateTime) {
				this.set("reservationManagerInstance.actualStart", "-1");
				this.set("reservationManagerInstance.actualEnd", "-1");
			}
		},

		_handleNavigateInstructions: function(e) {
			this.fire("navigate-summary-instructions");
		},

		_computeHasBookedRooms: function(reservationLocations) {
			return reservationLocations != null && reservationLocations.length > 0;
		},

		_hasNonExpiredResources: function(reservationLocations) {
			var currentDate = moment();
			var hasNonExpiredResources = false;
			for (var i = 0; i < reservationLocations.length && !hasNonExpiredResources; i++) {
				var bookedLocation = reservationLocations[i];
				if (bookedLocation.holdTimeDeadline != null) {
					hasNonExpiredResources = currentDate.isBefore(moment(bookedLocation.holdTimeDeadline));
				} else {
					hasNonExpiredResources = true;
				}
			}
			return hasNonExpiredResources;
		},

		_isReservationRequestedForCurrentUserPerson: function() {
			var currentUserPersonId = this.currentUser && this.currentUser.person && this.currentUser.person.data && this.currentUser.person.data._id;
			var reservationRequestedForId = this.reservationManager && this.reservationManager.requestedForName && this.reservationManager.requestedForName.id;
			return currentUserPersonId == reservationRequestedForId;
		}

	};
</script>
<dom-module id="tricomp-amenities-list" assetpath="">
	<template>
		<style>
			
			:host {
				@apply(--layout-horizontal);
				@apply(--layout-wrap);
			}

			.room-service-icon {
				--iron-icon-width: 24px;
				--iron-icon-height: 24px;
				padding: 5px;
			}

		</style>

		<div hidden$="[[!catering]]">
			<iron-icon class="room-service-icon" icon="ibm-glyphs:catering"></iron-icon>
			<paper-tooltip fit-to-visible-bounds="" position="top" offset="5" animation-delay="100">Catering</paper-tooltip>
		</div>
		<div hidden$="[[!disabledAccess]]">
			<iron-icon class="room-service-icon" icon="ibm-glyphs:accessibility"></iron-icon>
			<paper-tooltip fit-to-visible-bounds="" position="top" offset="5" animation-delay="100">Accessible</paper-tooltip>
		</div>
		<div hidden$="[[!networkConnection]]">
			<iron-icon class="room-service-icon" icon="ibm-glyphs:wired"></iron-icon>
			<paper-tooltip fit-to-visible-bounds="" position="top" offset="5" animation-delay="100">Network Connection</paper-tooltip>
		</div>
		<div hidden$="[[!projector]]">
			<iron-icon class="room-service-icon" icon="ibm-glyphs:projector"></iron-icon>
			<paper-tooltip fit-to-visible-bounds="" position="top" offset="5" animation-delay="100">Projector</paper-tooltip>
		</div>
		<div hidden$="[[!phoneConference]]">
			<iron-icon class="room-service-icon" icon="ibm-glyphs:phone-call"></iron-icon>
			<paper-tooltip fit-to-visible-bounds="" position="top" offset="5" animation-delay="100">Telephone Conference</paper-tooltip>
		</div>
		<div hidden$="[[!videoConference]]">
			<iron-icon class="room-service-icon" icon="ibm-glyphs:video"></iron-icon>
			<paper-tooltip fit-to-visible-bounds="" position="top" offset="5" animation-delay="100">Video Conference</paper-tooltip>
		</div>
		<div hidden$="[[!whiteboard]]">
			<iron-icon class="room-service-icon" icon="ibm-glyphs:whiteboard"></iron-icon>
			<paper-tooltip fit-to-visible-bounds="" position="top" offset="5" animation-delay="100">Whiteboard</paper-tooltip>
		</div>

	</template>
	<script>
		Polymer({

			is: "tricomp-amenities-list",

			properties: {
				catering: {
					type: Boolean,
					value: false
				},
				disabledAccess: {
					type: Boolean,
					value: false
				},
				networkConnection: {
					type: Boolean,
					value: false
				},
				phoneConference: {
					type: Boolean,
					value: false
				},
				projector: {
					type: Boolean,
					value: false
				},
				videoConference: {
					type: Boolean,
					value: false
				},
				whiteboard: {
					type: Boolean,
					value: false
				}
			},

		});
	</script>
</dom-module>


<dom-module id="tricomp-incremental-number-input" assetpath="">
	<template>
		<style>

			:host {
				padding-top: var(--tricomp-incremental-number-input-padding-top, 8px);
				position: relative;
				font-size: 16px;
			}
			:host:not([float-label]) {
				@apply(--layout-horizontal);
				@apply(--layout-baseline);
			}
			:host[float-label] {
				@apply(--layout-vertical);
			}

			.input-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			input {
				-moz-appearance: textfield;
			}
			input::-ms-clear {
				display: none;
			}
			input::-webkit-inner-spin-button,
			input::-webkit-outer-spin-button {
				-webkit-appearance: none;
				margin: 0;
			}

			label[float-label] {
				font-size: 12px;
				padding-right: 10px;
				font-weight: 400;
				font-family: var(--tri-font-family);
			}

			paper-icon-button {
				height: 34px;
				width: 34px;
			}

			paper-input-container {
				--paper-input-container-input: {
					padding: 0;
				}
				--paper-input-container-input: {
					font-family: var(--tri-font-family);
					text-align: center;
					width: var(--tricomp-incremental-number-input-min-width, 60px);
				};
			}

		</style>

		<label hidden$="[[!label]]" for="numberinput" float-label$="[[floatLabel]]">[[label]]</label>

		<div class="input-container">
			<paper-icon-button primary="" disabled$="[[_disableDecrementButton(disabled, value)]]" icon="ibm-glyphs:incremental-input-minus" on-tap="_decrementTap" tab-index="0" aria-label="Decrement"></paper-icon-button>

			<paper-input-container auto-validate="" no-label-float="" disabled$="[[disabled]]" invalid="[[invalid]]">
				<input is="iron-input" id="numberinput" allowed-pattern="[[_computeAllowedPattern(preventNegative)]]" autofocus$="[[autofocus]]" bind-value="{{value}}" disabled$="[[disabled]]" inputmode$="[[inputmode]]" invalid="{{invalid}}" max$="[[max]]" min$="[[min]]" name$="[[name]]" on-input="_onUserInput" placeholder$="[[placeholder]]" prevent-invalid-input="" readonly$="[[readonly]]" required$="[[required]]" step$="[[step]]" tabindex$="[[tabindex]]" title$="[[title]]" type="number">
						
				<paper-input-error>[[errorMessage]]</paper-input-error>
			</paper-input-container>

			<paper-icon-button primary="" disabled$="[[_disableIncrementButton(disabled, value)]]" icon="ibm-glyphs:incremental-input-add" on-tap="_incrementTap" tab-index="0" aria-label="Increment"></paper-icon-button>
		</div>

	</template>
	<script>
		Polymer({

			is: "tricomp-incremental-number-input",

			/*behaviors: [ Polymer.IronValidatorBehavior ],*/

			/**
			* Fired whenever the user changes the input value, either by tapping the increment/decrement buttons or by typing in the input
			*
			* @event user-change
			*/

			properties: {
				/*
				* Allow blank value
				*/
				/*allowEmpty: {
					type: Boolean,
					value: false
				},*/

				/*
				* Value to default to when input is NaN or outside of allowed range
				*/
				/*default: {
					type: Number
				},*/

				/*
				* Disable any input
				*/
				disabled: {
					type: Boolean,
					value: false
				},

				/*
				* Error message displayed when input is invalid (NaN, < min, or > max)
				*/
				errorMessage: {
					type: String,
					value: ""
				},

				/*
				* Display the label above the input at 75% of its size
				*/
				floatLabel: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},

				/*
				* Indicates that the input is invalid
				*/
				invalid: {
					type: Boolean,
					notify: true,
				},

				/*
				* Label for input
				*/
				label: String,

				/*
				* Maximum allowed value. If a value greater than max is entered, `value` will immediately be changed to max.
				*/
				max: {
					type: Number
				},

				/*
				* Minimum allowed value. If a value less than min is entered, `value` will immediately be changed to min.
				*/
				min: {
					type: Number,
				},

				/*
				* Prevent user from typing in '-'. This will be automatically set to true if 'min' >= 0.
				*/
				preventNegative: {
					type: Boolean
				},

				/*
				* Amount added/subtracted when incrementing/decrementing
				*/
				step: {
					type: Number,
					value: 1
				},

				/*
				* String value for input
				*/
				value: {
					type: String,
					notify: true
				}
			},

			/**
			* Decrement `value`.
			*/
			decrement: function() {
				if (this.invalid && this.max != null) {
					this.set("value", Number(this.max));
				} else {
					this.set("value", Number(this.value) - Number(this.step));
				}
			},

			/**
			* Increment `value`.
			*/
			increment: function() {
				if (this.invalid && this.min != null) {
					this.set("value", Number(this.min));
				} else {
					this.set("value", Number(this.value) + Number(this.step));
				}
			},

			ready: function() {
				// initialize 'preventNegative' based on 'min'
				if (typeof this.preventNegative == 'undefined' && this.min && this.min >= 0) this.set("preventNegative", true);
			},

			/**
			* See Polymer.IronValidatorBehavior.
			*/
			/*validate: function(value) {
				var value = Number(value);
				if (isNaN(value)) return false;
				if (value < Number(this.min)) return false;
				if (value > Number(this.max)) return false;
				return true;
			},*/

			_computeAllowedPattern: function(preventNegative) {
				return preventNegative ? "[0-9]" : "[0-9-]";
			},

			_decrementTap: function() {
				this.decrement();
				this.fire("user-change", {"value": this.value});
			},

			_disableDecrementButton: function(disabled, value) {
				if (disabled) return true;

				var value = Number(value);
				if (isNaN(value)) return true;
				if (value <= Number(this.min)) return true;

				return false;
			},

			_disableIncrementButton: function(disabled, value) {
				if (disabled) return true;

				var value = Number(value);
				if (isNaN(value)) return true;
				if (value >= Number(this.max)) return true;

				return false;
			},

			_incrementTap: function() {
				this.increment();
				this.fire("user-change", {"value": this.value});
			},

			_onUserInput: function(e) {
				this.fire("user-change", {"value": this.value});
			},

			/*_onValueChanged: function(e) {
				// resize input?
				// var value = e.detail.value;
				// var canvas = document.createElement("canvas");
				// var context = canvas.getContext("2d");
				// context.font = this.$.input.style.font;
				// var valueWidth = context.measureText(value).width;
				// valueWidth += 10; // add some additional width
				// this.$.input.style.width = valueWidth + "px";

				// fix invalid values
				var value = e.detail.value;
				if (isNaN(value) || !value) {
					this.async(function() {
						if (this.default != null && Number(this.default) < Number(this.max) && Number(this.default) > Number(this.min)) {
							this.set("value", Number(this.default));
						} else if (this.min != null) {
							this.set("value", Number(this.min));
						} else if (this.max != null) {
							this.set("value", Number(this.max));
						} else {
							this.set("value", 0);
						}
					});
				}
				else if (Number(value) > Number(this.max)) {
					this.async(function() {
						this.set("value", Number(this.max));
					});
				} else if (Number(value) < Number(this.min)) {
					this.async(function() {
						this.set("value", Number(this.min));
					});
				}
			}*/

		});

	</script>
</dom-module>
<dom-module id="tricomp-alert-message" assetpath="">
	<template>

		<style>

			:host {
				@apply(--layout-horizontal);
				background-color: var(--tricomp-alert-message-bg-color, --tri-primary-color);
				@apply(--tricomp-alert-message);
			}
			:host[info] {
				background-color: var(--tricomp-alert-message-info-bg-color, --tri-info-color);
			}
			:host[success] {
				background-color: var(--tricomp-alert-message-success-bg-color, --tri-success-color);
			}
			:host[warning] {
				background-color: var(--tricomp-alert-message-warning-bg-color, --tri-warning-color);
			}
			:host[major-warning] {
				background-color: var(--tricomp-alert-message-major-warning-bg-color, --tri-major-warning-color);
			}
			:host[danger] {
				background-color: var(--tricomp-alert-message-danger-bg-color, --tri-danger-color);
			}
			:host[error] {
				background-color: var(--tricomp-alert-message-error-bg-color, --tri-error-color);
			}

			.status-icon-container {
				@apply(--layout-vertical);
				@apply(--layout-start);
				padding: 5px;
			}
			.status-icon {
				--iron-icon-height: var(--tricomp-alert-message-icon-size, 24px);
				--iron-icon-width: var(--tricomp-alert-message-icon-size, 24px);
				color: var(--tricomp-alert-message-icon-color, white);
			}

			.message-container {
				@apply(--layout-flex);
				@apply(--layout-vertical);
				@apply(--layout-center-justified);
				background-color: var(--tricomp-alert-message-message-bg-color, rgba(255, 255, 255, 0.8));
				padding: 5px 5px 5px 10px;
			}

			.message {
				@apply(--tricomp-alert-message-message);
			}

			.title {
				font-weight: bold;
				@apply(--tricomp-alert-message-title);
			}

			.tooltip-indicator-icon-container {
				@apply(--layout-vertical);
				@apply(--layout-start);
				background-color: var(--tricomp-alert-message-message-bg-color, rgba(255, 255, 255, 0.8));
				padding: 5px;
			}
			.tooltip-indicator-icon {
				--iron-icon-height: 24px;
				--iron-icon-width: 24px;
				color: var(--tricomp-alert-message-bg-color, --tri-primary-color);
			}
			:host[info] .tooltip-indicator-icon {
				color: var(--tricomp-alert-message-info-bg-color, --tri-info-color);
			}
			:host[success] .tooltip-indicator-icon {
				color: var(--tricomp-alert-message-success-bg-color, --tri-success-color);
			}
			:host[warning] .tooltip-indicator-icon {
				color: var(--tricomp-alert-message-warning-bg-color, --tri-warning-color);
			}
			:host[major-warning] .tooltip-indicator-icon {
				color: var(--tricomp-alert-message-major-warning-bg-color, --tri-major-warning-color);
			}
			:host[danger] .tooltip-indicator-icon {
				color: var(--tricomp-alert-message-danger-bg-color, --tri-danger-color);
			}
			:host[error] .tooltip-indicator-icon {
				color: var(--tricomp-alert-message-error-bg-color, --tri-error-color);
			}

		</style>

		<div class="status-icon-container">
			<iron-icon class="status-icon" icon="[[_computeIcon(icon, info, success, warning, majorWarning, danger, error)]]"></iron-icon>
		</div>

		<div class="message-container">
			<div class="title">[[alertTitle]]</div>
			<div class="message"><content></content></div>
		</div>

		<div class="tooltip-indicator-icon-container" hidden$="[[!showTooltipIndicatorIcon]]">
			<iron-icon class="tooltip-indicator-icon" icon="ibm:menuoverflow"></iron-icon>
		</div>
		
	</template>

	<script>
		Polymer({

			is: 'tricomp-alert-message',

			properties: {
				alertTitle: {
					type: String,
					value: ""
				},
				icon: {
					type: String,
					value: ""
				},
				showTooltipIndicatorIcon: {
					type: Boolean,
					value: false
				},

				info: {
					reflectToAttribute: true,
					type: Boolean,
					value: false
				},
				success: {
					reflectToAttribute: true,
					type: Boolean,
					value: false
				},
				warning: {
					reflectToAttribute: true,
					type: Boolean,
					value: false
				},
				majorWarning: {
					reflectToAttribute: true,
					type: Boolean,
					value: false
				},
				danger: {
					reflectToAttribute: true,
					type: Boolean,
					value: false
				},
				error: {
					reflectToAttribute: true,
					type: Boolean,
					value: false
				},
			},

			_computeIcon: function(icon, info, success, warning, majorWarning, danger, error) {
				if (icon && icon != "") return icon;
				else if (info) return "ibm:status-info";
				else if (success) return "ibm:status-success";
				else if (warning) return "ibm:status-warning";
				else if (majorWarning) return "ibm:status-warning-major";
				else if (danger) return "ibm:status-warning-major";
				else if (error) return "ibm:status-error";
				else return "";
			}
		});
	</script>
</dom-module><dom-module id="tricomp-select-input" assetpath="">
  <template>
	<style>
		:host {
			display: block;
			position: relative;
		}

		#dropdown {      
			/* iron-dropdown calculate the max-height for the dropdown base on the screen size. The dropdown scroll 
			* is set to auto, and will be displayed if the items size is bigger then the dropdown size.
			* If using scroll pagination with low number of records that fit the screen, the scroll will not be displayed.
			* In that case, App developer should set the dropdown max-height to be smaller then the height of the pagination records, to force scroll display.
			*/
			max-height: var(--tricomp-select-input-dropdown-max-height, none);
		}

		.dropdown-content {
			@apply(--layout);
			@apply(--layout-vertical);

			@apply(--shadow-elevation-2dp);
			margin-bottom: 20px;
		}
		
		#selectClear {
			@apply(--layout-horizontal);
			position: relative;
		}
		
		#selectClear:focus{
			outline: none;   
		}

		iron-list {
			@apply(--layout-flex);
		}

		paper-item {
			--paper-item: {
				cursor: pointer;
				background-color: #ffffff;
				@apply(--tricomp-select-input-paper-item);
			};
			--paper-item-min-height: {
				@apply(--tricomp-select-input-paper-item-min-height);
			};
			--paper-item-focused: {
				@apply(--tricomp-select-input-paper-item-focused);
			};
		}
		paper-item:hover {
			background-color: var(--tri-primary-light-color);
		}
		
		paper-item span {
			pointer-events: none;
		}
		
		paper-input-container input::-ms-clear {
			display: none;
		}

		.suffix-button {
			height: 24px;
			width: 24px;
			padding: 0;
		}

		#clearButton {
			@apply(--tricomp-select-input-clear-button);
		}

		#dropdownButton {
			@apply(--tricomp-select-input-dropdown-button);
		}

		#dropdownButton[dropdown-opened] {
			transform: rotate(0.5turn);
		}
		
		#triSelectInputField{
			text-overflow: ellipsis;
		} 
	</style>

  	<div id="selectClear">
  		<paper-input-container class="flex" id="input" focused="{{focused}}" disabled$="[[disabled]]" aria-label$="{{label}}" auto-validate$="[[autoValidate]]" no-label-float$="[[noLabelFloat]]" always-float-label$="[[alwaysFloatLabel]]" on-keydown="_keyDownInputHandler">
  			<label id="triSelectInputLabel" for="triSelectInputField">[[label]]<content id="labelContent" select="[label]"></content></label>
  			<input id="triSelectInputField" aria-labelledby="triSelectInputLabel" is="iron-input" bind-value="{{_searchValue}}" required$="[[required]]" disabled$="[[disabled]]" readonly$="[[readonly]]" aria-label$="{{label}}">

	  		<paper-icon-button suffix="" id="clearButton" class="suffix-button" icon="clear" secondary="" on-tap="_clearValue" on-keydown="_keyDownClearHandler" disabled$="[[disabled]]" alt="Clear"></paper-icon-button>

	  		<paper-icon-button suffix="" id="dropdownButton" class="suffix-button" icon="hardware:keyboard-arrow-down" dropdown-opened$="[[dropdownOpened]]" primary="" on-tap="_dropdownButtonTap" on-keydown="" disabled$="[[disabled]]" alt="Clear"></paper-icon-button>

	      	<template is="dom-if" if="[[errorMessage]]">
    	    	<paper-input-error>[[errorMessage]]</paper-input-error>
      		</template>
  		</paper-input-container>
  	</div>
	<iron-dropdown id="dropdown" horizontal-align="left" vertical-align="top" opened="{{dropdownOpened}}" no-overlap="">
		<div role="alert" aria-live="assertive" id="dropdownContent" class="dropdown-content">
			<paper-menu id="menu" role="list" aria-label$="{{label}}" on-keydown="_keyDownMenuHandler">
				<template id="itemsTemplate" is="dom-repeat" items="{{selectSrc}}">
					<paper-item role="listitem" on-keypress="_keyPressHandler"><span>{{_computeItemValue(item)}}</span></paper-item>
				</template>
			</paper-menu>
		</div>
	</iron-dropdown>
  </template>
  <script>
		Polymer({

			is: "tricomp-select-input",
			
			/**
			* Fired after the dropdown list opens.
			*
			* @event select-input-list-open
			*/
			
			/**
			* Fired after the dropdown list closes.
			*
			* @event select-input-list-close
			*/
			
			/**
			* Fired after the input value changes. Contains the new value in event.detail.value.
			*
			* @event select-input-value-change 
			*/

			properties: {
				/*
				* Label for input field.
				*/
				label: {
					type: String,
					notify: false,
					readOnly: false
				},

				/*
				* STRING_WITH_ID object for the currently selected value for the field. 
				* If the dropdown is open. then this value won't change until you select a new value.
				* This value will be null if there is no match.
				*/
				value: {
					type: Object,
					notify: true,
					readOnly: false,
					observer: "_onValueChanged"
				},
				
				/*
				* Value name used in the STRING_WITH_ID object. This will specify the property of the STRING_WITH_ID object
				* that you want to set. Typically, STRING_WITH_ID contains 2 properties, "id" and "value", and you would want 
				* to set the valueName to "value".
				*/
				valueName: {
					type: String,
					notify: false,
					readOnly: false
				},

				/*
				* String for filter/search. This is set to the value that is typed in the input field and is updated each
				* time a character is typed or removed. When selectSrc references a data source with a filter, this value can 
				* be used in that filter to produce typeahead filtering by data-binding this value with a
				* triplat-query-filter value attribute.
				*/
				searchValue: {
					type: String,
					notify: true,
					readOnly: true
				},

				/*
				* Select data source. The values in this array are displayed in the dropdown box.
				* This array is also used to data-bind with the triplat-ds data attribute or filtered-data attribute.
				*/
				selectSrc: {
					type: Array,
					notify: false,
					readOnly: false,
					observer: "_onSelectSrcChanged"
				},
				
				/*
				* Scroller container element object. This object is also used to data-bind with the triplat-query-scroll-page scroller attribute.
				*/
				scroller: {
					type: Object,
					notify: true,
					readOnly: true
				},
				
				/*
				* Query scroll page element ID that defines the scroller property. This ID is used to get the 
				* triplat-query-scroll-page size attribute to ensure that the scrollbar is displayed for a small pagination size.
				*/
				queryScrollPageId: {
					type: String
				},
				
				/** 
				* Boolean to indicate that this is a disabled input field. Show
				* the value, but not the clear button. The value will be grayed out and not editable.
				* The value will be underlined to indicate it is an input field.
				*/
				disabled: {
					type: Boolean,
					value: false
				},

				/** 
				* Boolean to indicate that this is a read-only value. Show
				* the value, but not the clear button.
				*/
				readonly: {
					type: Boolean,
					value: false
				}, 


				/**
				* Set to true to mark the input field as required.
				*/
				required: {
				type: Boolean,
				value: false
				},

				/**
				* The error message to display when the input value is invalid.
				*/
				errorMessage: {
				type: String
				},

				/**
				* Set to true to auto-validate the input value when it changes.
				*/
				autoValidate: {
				type: Boolean,
				value: false
				},

				/**
				* Set to true to scroll the selected input element into view (on focus). If scroll is available, it will align the element to the top of the browser window (if possible).
				* The scroll into view is applied on mobile devices only, where screens are small and the virtual keyboard takes much of the screen area.
				*/
				scrollElementIntoView: {
				type: Boolean,
				value: false
				},

				/*
				* Set to true to always float the floating label.
				*/
				alwaysFloatLabel: {
					type: Boolean,
					value: false
				},

				
			/**
				* The delay (in milliseconds) between the time a single letter is typed, 
				* and the time the dropdown shows results. This delay is needed so we can wait a bit after presenting the results list in 
				* the dropdown. This way, we can achieve better performance, skipping searches against single letters.
				*/
				delay: {
					type: Number,
					notify: false,
					readOnly: false,
					value: 300
				},

				noLabelFloat: {
					type: Boolean,
					value: false
				},



				/**
				* Internally set to true to open the dropdown when the select source change.
				*/
				_openDropDownOnMenuChange: {
				type: Boolean,
				value: false
				},
			},

			observers: [
				"_onFocusedChanged(focused)",
				"_on_searchValueChanged(_searchValue)"
			],

			listeners: {
				"dropdown.iron-overlay-closed": "_onIronOverlayClosed",
				"dropdown.iron-overlay-opened": "_onIronOverlayOpened",
				"menu.iron-select": "_onIronSelect"
			},

			attached: function() {
				this.$.dropdown.positionTarget = this.$.input;
				this.$.dropdown.focusTarget = this.$.input;
				this._setScroller(this.$.dropdownContent);
				if(Polymer.dom(this.$$('#labelContent')).getDistributedNodes().length >0){
					this.label=" ";
				}
			},

			_dropdownButtonTap: function() {
				this.$.triSelectInputField.focus();
				this._openDropDown();
			},

			_computeItemValue: function(item) {
				return (item == undefined)? "":item[this.valueName];
			},

			_onFocusedChanged: function(focused) {
				if(this._isDisabledOrReadonly()) {
					return;
				}
				
				if (focused && (!this.$.dropdown.opened)) {
					var searchValue = this._searchValue;
					var value = (this.value)? this.value.value:null;
					if(searchValue && searchValue.length>0 && value && value.length>0 && searchValue.length==value.length && searchValue.indexOf(value)>-1) {
						// Even if value is already set, we want to open dropdown and display all the available values to tell user this is a list
						// values from drop down will be filetered on user's key stroke
						this._on_searchValueChanged(""); //set search value includes: enable/disable clear icon, open dropdown
						this.$.clearButton.style.display = "inline"; //display clear icon as there is a value
					}else{
						this.$.dropdown.resetFit();
						this._on_searchValueChanged(""); //set search value includes: enable/disable clear icon, open dropdown
					} 
				}
			},

			_selectItem: function(selectedElement) {
				this.$.dropdown.resetFit();
				var selectedItem = this.$.itemsTemplate.itemForElement(selectedElement);
				this._valueSelected = true;
				this.$.menu.selected = -1;
				this.$.dropdown.close();
				this.fire('select-input-list-close');
				this._internalSet = true;
				// only set value when it has actually changed
				if ((this.value == undefined || this.value.id == undefined || this.value.value == undefined) ||
					(this.value.id != selectedItem._id && this.value.value != selectedItem[this.valueName])) {
					this.set("value", {id: selectedItem._id, value: selectedItem[this.valueName]});
				} else if(this._searchValue != selectedItem[this.valueName]) {
					//if value did not change but search value change, then update the search value (input display value)
					this.set("_searchValue", selectedItem[this.valueName]);
				}
				this._internalSet = false;
			},
			
			_onIronSelect: function(e) {	
				this.async(function() {
					var selectedElement = e.detail.item;
					this._selectItem(selectedElement);
				}, 200);
			},

			_onSelectSrcChanged: function(selectSrc) {
				if(this._openDropDownOnMenuChange){
					this._openDropDown();
				}
			},
			
			_onValueChanged: function(value) {
				this._internalSet = true;
				if (value && (value.value!=null)) {
					this.set("_searchValue", value.value);
				} else {
					this.set("_searchValue", "");
				}
				this._internalSet = false;
				this.fire('select-input-value-change', {'value': (value ? value.value : "")});
			},

			_onIronOverlayClosed: function(e) {
				if (!this._valueSelected) {
					var canceled = e.detail.canceled;
					if (canceled && this.searchValue && this.searchValue.length == 0) {
						this.set("value", null);
					} else {
						if (this.value && (this.value.value!=null)) {
							//string with id has value, update search value
							this.set("_searchValue", this.value.value);
						} else {
							this.set("_searchValue", "");
						}
					}
				}
				this._valueSelected = false;
				this._overlayClosed = true;
				if(this.tabToNextElement){
					//do not set focus and allow tab to next element in the page
					this.set("tabToNextElement", false);
				} else {
					//reset focus, so clicking of the input field again will open the dropdown
					this._setFocus();
				}
			},

			_onIronOverlayOpened: function(e) {
				//check if need to adjust menu height to guarantee scroller is displayed (to get next records)
				if(this.scroller !=undefined && this.queryScrollPageId !=undefined){
					var queryScrollPage = document.querySelector("#"+this.queryScrollPageId);
					if(queryScrollPage != undefined && this.$.menu.items !=undefined 
						&& this.$.menu.items.length < queryScrollPage.totalSize){
						var menuHeight = this.$.menu.getBoundingClientRect().bottom - this.$.menu.getBoundingClientRect().top;
						var dropdownContentHeight = parseInt(this.$.dropdownContent.style.maxHeight);
						if(menuHeight <= dropdownContentHeight){
							//Make wrapper height a bit smaller then menu to insure scroller is displayed
							this.$.dropdownContent.style.maxHeight = menuHeight - 10 + "px";
						}
					}
				}
			},

			_on_searchValueChanged: function(_searchValue) {
				if(_searchValue && _searchValue.length > 0 && !this._isDisabledOrReadonly()){
					this.$.clearButton.style.display = "inline";
				}else {
					this.$.clearButton.style.display = "none";
				}

				var toOpenDropDown = (!this._internalSet && this._overlayClosed)? true:false;

				if(toOpenDropDown){
					//no delay in setting search value and opening dropdown dialog in that order so
					//dropdown max-height calculation is done on the full set
					if(this.searchValue !=  _searchValue){
						//new search trigger new request, open dropdown on request results change
						this._openDropDownOnMenuChange = true;
						this._setSearchValue(_searchValue);
					} else {
						//open dropdown directly (no change means no request)
						this._setSearchValue(_searchValue);
						this._openDropDown();
					}
				} else {
					if(_searchValue == "" || this.searchValue == ""
						|| (this.value && this.value.value != null && this.value.value == _searchValue)){
						this._setSearchValue(_searchValue);
					} else {
						//once dropdown already open (and sized), delay the search text 
						if (this._delayHandle != undefined && this._delayHandle != null) {
							this.cancelAsync(this._delayHandle);
						}

						this._delayHandle = this.async(function() {
							this._setSearchValue(_searchValue);
						}, this._intDelay);
					}
				}

				if(this._overlayClosed == undefined) {
					this._overlayClosed = true;
				}
			},
			
			get _intDelay() {
				var intDelay = parseInt(this.delay);
				return (intDelay > 200)? intDelay:200; //minimum search delay of 200 milliseconds to avoid sync results issues
			},

			_keyPressHandler: function(event) {
				var code = event.keyCode;
				// accept Enter (13) as select item
				if (code == 13) {
					var selectedElement = event.target;
					this._selectItem(selectedElement);
					//console.log("_keyPressHandler selectedElement: " + selectedElement);
				}
				event.preventDefault();
			},
			
			_keyDownInputHandler: function(event) {
				var code = event.keyCode;
				if(code == 40 ||
						(code == 9 && this.$.clearButton.style.display == "none")) {
					// on the input field, accept Down Arrow (40) or TAB(9) without clear icon as a move to dropdown first item (menu.div.paper-item)
					var firstItem = this.$.menu.firstElementChild.firstElementChild;
					if(firstItem != null) {
						firstItem.focus();
					}
				} else if(code==9 && event.shiftKey && this.$.dropdown.opened) {
					// on the input field, accept shiftKey + TAB(9) as a move back to previouse TAB element in the page and therefore close the dropdown menu
					this.$.dropdown.close();
				}
			},
			
			_keyDownMenuHandler: function(event) {
				var code = event.keyCode;
				if(code == 9) {
					// on the menu, accept TAB(9) as a move to next TAB element in the page and therefore close the dropdown menu
					this.$.dropdown.close();
					this.set("tabToNextElement", true);
				}
			},
			
			_keyDownClearHandler: function(event) {
				var code = event.keyCode;
				if(code == 9) {
					// on the clear icon, accept TAB(9) as a move to dropdown first item (menu.div.paper-item)
					var firstItem = this.$.menu.firstElementChild.firstElementChild;
					if(firstItem != null) {
						firstItem.focus();
						event.preventDefault();
					}
				}
			},
			
			_clearValue: function() {
				this.$.dropdown.resetFit();
				this._internalSet = true;
				this.set("value", null);
				this.set("_searchValue", "");
				this._internalSet = false;
				this._setFocus();
			},
			
			_setFocus: function(){
				this.$.selectClear.tabIndex = 0;
				this.$.selectClear.focus();
				this.$.selectClear.tabIndex = -1;
			},

			/* Return true if the component is disabled or readonly.
			*/
			_isDisabledOrReadonly: function() {
				return this.disabled || this.readonly;
			},

			_openDropDown: function() {
				if(!this.$.dropdown.opened && !this._isDisabledOrReadonly()){
					var openDelay = 200;
					if(this._isMobileDevice()){
						//Mobile devices, such iPad, need more delay for scrollToTop and virtual keyboard
						openDelay = 400;
						if(this._isAndroidDevice()) {
							//Android field keyboard and field scroll to to seem to be slower. Therefore, increase delay for Android to 
							//allow more time for the virtual keyboard to be displayed and for the field to scroll to top before 
							//dropdown is opened and positioned next to the field.
							openDelay = 1000;
						}
						if(this.scrollElementIntoView){
							this.$.input.scrollIntoView(true); //On mobile devices, scrolls the page, if possible, and bring the current input element into a higher area of the screen.
						}
					}
					
					this.async(function() {
						this.$.dropdownContent.style.width = this.offsetWidth + "px";
						this.$.dropdown.open();
						//this.$.dropdown.notifyResize(); commented out since it cause dialog to be center when leaving and returning to the page 
						this.fire('select-input-list-open');
						this._openDropDownOnMenuChange = false;
						this._overlayClosed = false;
					}, openDelay); //100 not enough in some cases for the search input to keep its focus
				}
			},

			_isMobileDevice: function () {
				if( navigator.userAgent.match(/Android/i)
					|| navigator.userAgent.match(/webOS/i)
					|| navigator.userAgent.match(/iPhone/i)
					|| navigator.userAgent.match(/iPad/i)
					|| navigator.userAgent.match(/iPod/i)
					|| navigator.userAgent.match(/BlackBerry/i)
					|| navigator.userAgent.match(/Windows Phone/i)
				){
					return true;
				}
				else {
					return false;
				}
			},

			_isAndroidDevice: function () {
				return navigator.userAgent.match(/Android/i);
			}


		});

	</script>
</dom-module>


<dom-module id="paper-radio-group" assetpath="../paper-radio-group/">
  <template>
    <style>
      :host {
        display: inline-block;
      }

      :host ::content > * {
        padding: var(--paper-radio-group-item-padding, 12px);
      }
    </style>

    <content id="items" select="*"></content>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'paper-radio-group',

    behaviors: [
      Polymer.IronMenubarBehavior
    ],

    hostAttributes: {
      role: 'radiogroup',
      tabindex: 0
    },

    properties: {
      /**
       * Fired when the radio group selection changes.
       *
       * @event paper-radio-group-changed
       */

      /**
       * Overriden from Polymer.IronSelectableBehavior
       */
      attrForSelected: {
        type: String,
        value: 'name'
      },

      /**
       * Overriden from Polymer.IronSelectableBehavior
       */
      selectedAttribute: {
        type: String,
        value: 'checked'
      },

      /**
       * Overriden from Polymer.IronSelectableBehavior
       */
      selectable: {
        type: String,
        value: 'paper-radio-button'
      },

      /**
       * If true, radio-buttons can be deselected
       */
      allowEmptySelection: {
        type: Boolean,
        value: false
      }
    },

    /**
     * Selects the given value.
     */
    select: function(value) {
      var newItem = this._valueToItem(value);
      if (newItem && newItem.hasAttribute('disabled')) {
        return;
      }

      if (this.selected) {
        var oldItem = this._valueToItem(this.selected);

        if (this.selected == value) {
          // If deselecting is allowed we'll have to apply an empty selection.
          // Otherwise, we should force the selection to stay and make this
          // action a no-op.
          if (this.allowEmptySelection) {
            value = '';
          } else {
            if (oldItem)
              oldItem.checked = true;
            return;
          }
        }

        if (oldItem)
          oldItem.checked = false;
      }

      Polymer.IronSelectableBehavior.select.apply(this, [value]);
      this.fire('paper-radio-group-changed');
    },

    _activateFocusedItem: function() {
      this._itemActivate(this._valueForItem(this.focusedItem), this.focusedItem);
    },

    _onUpKey: function(event) {
      this._focusPrevious();
      event.preventDefault();
      this._activateFocusedItem();
    },

    _onDownKey: function(event) {
      this._focusNext();
      event.preventDefault();
      this._activateFocusedItem();
    },

    _onLeftKey: function(event) {
      Polymer.IronMenubarBehaviorImpl._onLeftKey.apply(this, arguments);
      this._activateFocusedItem();
    },

    _onRightKey: function(event) {
      Polymer.IronMenubarBehaviorImpl._onRightKey.apply(this, arguments);
      this._activateFocusedItem();
    }
  });
</script>
<dom-module id="tricomp-room-criteria-when-basic" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
			}

			.days-container {
				@apply(--layout-horizontal);
				@apply(--layout-justified);
				@apply(--layout-center);
				padding: 8px 0;
			}

			.days-radio-group {
				@apply(--layout-horizontal);
			}

			.parts-of-day-radio-group {
				@apply(--layout-vertical);
				padding: 8px 0;
			}

			paper-radio-button {
				--paper-radio-button-size: 24px;
			}

			.tri-link[disabled] {
				cursor: default !important;
				color: var(--tri-disabled-dark-color) !important;
			}

			.tri-link[disabled]:hover {
				text-decoration: none !important;
			}
		</style>

		<div class="days-container with-border">
			<paper-radio-group class="days-radio-group" selected="{{day}}">
				<paper-radio-button name="today" disabled="[[disabled]]">Today</paper-radio-button>
				<paper-radio-button name="tomorrow" disabled="[[disabled]]">Tomorrow</paper-radio-button>
			</paper-radio-group>
			<div class="tri-link" on-tap="_handleAdvancedTap" disabled$="[[disabled]]">Advanced</div>
		</div>

		<paper-radio-group class="parts-of-day-radio-group" selected="{{partOfDay}}">
			<paper-radio-button name="am" disabled="[[disabled]]">Morning</paper-radio-button>
			<paper-radio-button name="pm" disabled="[[disabled]]">Afternoon</paper-radio-button>
			<paper-radio-button name="all-day" disabled="[[disabled]]">All Day</paper-radio-button>
		</paper-radio-group>
	</template>
	<script>
		Polymer({
			is: "tricomp-room-criteria-when-basic",

			properties: {
				day:  {
					type: String,
					notify: true
				},

				partOfDay:  {
					type: String,
					notify: true
				},

				disabled: {
					type: Boolean,
					value: false
				},
			},

			_handleAdvancedTap: function(e) {
				if (!this.disabled) {
					this.fire("open-criteria-when-advanced");
				}
			}
		});
	</script>
</dom-module>
<dom-module id="tricomp-room-criteria-when-advanced" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
			}

			.time-options-section {
				padding-top: 10px;
			}

			.start-end-rule-checkbox-container {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			.start-end-rule-checkbox {
				padding: 10px 0;
			}

			.row-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			.row-container.tappable {
				cursor: pointer;
			}

			.row-container.tappable[disabled] {
				pointer-events: none;
				cursor: default;
			}

			.date-picker-label {
				@apply(--layout-horizontal);
			}

			.repeats-value {
				@apply(--layout-flex);
				padding: 20px 0 20px 20px;
			}

			.tri-link[disabled] {
				cursor: default !important;
				color: var(--tri-disabled-dark-color) !important;
			}

			.tri-link[disabled]:hover {
				text-decoration: none !important;
			}

			:host-context([dir="rtl"]) .expand-button {
				transform: scaleX(-1);
			}

		</style>

		<div class="time-options-section">
			<div class="row-container">
				<div class="start-end-rule-checkbox-container">
					<paper-checkbox id="allDayToggleButton" class="start-end-rule-checkbox" disabled$="[[_disableDate]]" checked="[[allDayEvent]]" noink="" on-change="_handleUserChangedAllDay">All day event</paper-checkbox>
				</div>
				<div class="tri-link" on-tap="_handleBasicTap" hidden$="[[_hideBasicButton]]" disabled$="[[_disableDate]]">Basic</div>
			</div>

			<div hidden$="[[allDayEvent]]" tab-index="0">
				<triplat-datetime-picker required="" null-date-invalid="" readonly$="[[_disableDate]]" time-zone="[[currentUser._TimeZoneId]]" display-format="[[currentUser._DateTimeFormat]]" value="[[startTime]]" on-datetime-picker-user-change="_handleUserChangedStartTime" label="Start Date" aria-label="Start Date" on-iron-overlay-opened="_onDatetimeOverlayOpened">
					<div label="" class="date-picker-label"><span class="required-asterisk">*</span><iron-icon icon="av:play-arrow" class="start-reservation-time-icon"></iron-icon>Start</div>
				</triplat-datetime-picker>
				<triplat-datetime-picker required="" null-date-invalid="" readonly$="[[_disableDate]]" time-zone="[[currentUser._TimeZoneId]]" display-format="[[currentUser._DateTimeFormat]]" value="[[endTime]]" on-datetime-picker-user-change="_handleUserChangedEndTime" label="End Date" aria-label="End Date" on-iron-overlay-opened="_onDatetimeOverlayOpened">
					<div label="" class="date-picker-label"><span class="required-asterisk">*</span><iron-icon icon="av:stop" class="end-reservation-time-icon"></iron-icon>End</div>
				</triplat-datetime-picker>
			</div>

			<div hidden$="[[!allDayEvent]]" tab-index="0">
				<triplat-date-picker class="start-end-date-picker" required="" null-date-invalid="" readonly$="[[_disableDate]]" time-zone="[[currentUser._TimeZoneId]]" display-format="[[currentUser._DateFormat]]" value="[[startDate]]" on-date-picker-user-change="_handleUserChangedStartDate" label="Start Date" aria-label="Start Date">
					<div label="" class="date-picker-label"><span class="required-asterisk">*</span><iron-icon icon="av:play-arrow" class="start-reservation-time-icon"></iron-icon>Start</div>
				</triplat-date-picker>
				<triplat-date-picker class="start-end-date-picker" required="" null-date-invalid="" readonly$="[[_disableDate]]" time-zone="[[currentUser._TimeZoneId]]" display-format="[[currentUser._DateFormat]]" value="[[endDate]]" on-date-picker-user-change="_handleUserChangedEndDate" label="End Date" aria-label="End Date">
					<div label="" class="date-picker-label"><span class="required-asterisk">*</span><iron-icon icon="av:stop" class="end-reservation-time-icon"></iron-icon>End</div>
				</triplat-date-picker>
			</div>
		</div>

		<div class="row-container tappable" disabled$="[[_disableRecurrence]]" on-tap="_handleNavigateRecurrence">
			<div class="repeats-value" tabindex="0" aria-label$="[[_computeRecurrenceRuleDisplayLabel(reservationEditMode, recurrenceRuleLabel)]]">
				[[_computeRecurrenceRuleDisplayLabel(reservationEditMode, recurrenceRuleLabel)]]
			</div>
			<paper-icon-button primary="" class="expand-button" icon="ibm-glyphs:expand-open" hidden$="[[_disableRecurrence]]" aria-label="Change Recurrence">
			</paper-icon-button>
		</div>
	</template>
	<script>
		Polymer({

			is: "tricomp-room-criteria-when-advanced",

			behaviors: [
				Polymer.IronResizableBehavior
			],

			properties: {
				currentUser: {
					type: Object
				},

				reservationEditMode: {
					type: String
				},

				recurrenceRuleLabel: {
					type: String
				},

				recurringMeeting: {
					type: Boolean,
					value: false
				},

				showBasicButton: {
					type: Boolean,
					value: false
				},

				disabled: {
					type: Boolean,
					value: false
				},

				allDayEvent: {
					type: Boolean,
					value: false,
					notify: true
				},

				startTime: {
					type: String,
					notify: true
				},

				endTime: {
					type: String,
					notify: true
				},

				startDate: {
					type: String,
					notify: true
				},

				endDate: {
					type: String,
					notify: true
				},

				_disableRecurrence: {
					type: Boolean,
					value: false,
					computed: "_computeDisableRecurrence(reservationEditMode, disabled)"
				},

				_disableDate: {
					type: Boolean,
					value: false,
					computed: "_computeDisableDate(recurringMeeting, disabled)"
				},

				_hideBasicButton: {
					type: Boolean,
					value: false,
					computed: "_computeHideBasicButton(showBasicButton, disabled)"
				},

				_isMobileDevice: {
					type: Boolean,
					value: function() {
						var isMobile = navigator.userAgent.match(/Android/i)
							|| navigator.userAgent.match(/webOS/i)
							|| navigator.userAgent.match(/iPhone/i)
							|| navigator.userAgent.match(/iPad/i)
							|| navigator.userAgent.match(/iPod/i)
							|| navigator.userAgent.match(/BlackBerry/i)
							|| navigator.userAgent.match(/Windows Phone/i);
						return isMobile;
					}
				}
			},

			_handleBasicTap: function(e) {
				if (!this._disableDate) {
					this.fire("open-criteria-when-basic");
				}
			},

			_handleNavigateRecurrence: function(e) {
				this.fire("navigate-recurrence", {"backEventName": "navigate-room-criteria-back"});
			},

			_computeDisableRecurrence: function(reservationEditMode, disabled) {
				return (reservationEditMode != "Occurrence" && reservationEditMode != "Series") ||  
					disabled;
			},

			_computeDisableDate: function(recurringMeeting, disabled) {
				return recurringMeeting || disabled;
			},

			_computeHideBasicButton: function(showBasicButton, disabled) {
				return !showBasicButton || disabled;
			},

			_computeRecurrenceRuleDisplayLabel: function(reservationEditMode, recurrenceRuleLabel) {
				var __dictionary__seriesDisplayLabel = "You are changing a series occurrence.";
				if (reservationEditMode != "Occurrence" && reservationEditMode != "Series") {
					return __dictionary__seriesDisplayLabel;
				}
				return recurrenceRuleLabel;
			},

			_handleUserChangedStartTime: function(event) {
				event.stopPropagation();
				this.fire("change-start-time", {reservationStartTime: event.detail.value});
			},

			_handleUserChangedEndTime: function(event) {
				event.stopPropagation();
				this.fire("change-end-time", {reservationEndTime: event.detail.value});
			},

			_handleUserChangedAllDay: function(event) {
				event.stopPropagation();
				this.fire("change-all-day", {reservationAllDay: event.currentTarget.checked});
			},

			_handleUserChangedStartDate: function(event) {
				event.stopPropagation();
				this.fire("change-start-date", {reservationStartDate: event.detail.value});
			},

			_handleUserChangedEndDate: function(event) {
				event.stopPropagation();
				this.fire("change-end-date", {reservationEndDate: event.detail.value});
			},

			/**
			 * On mobile devices when the keyboard is opened the viewport area is smaller. 
			 * When the keyboard is opened and clicking on datetime-picker, the keyboard will close 
			 * (because the focus is no longer on the input field), but the calendar overlay from
			 * triplat-datetime-picker will open based on the smaller viewport, when keyboard was opened.
			 * It's necessary to notify resize after the calendar overlay is opened, 
			 * so the overlay will be position based on the current viewport area.
			 */
			_onDatetimeOverlayOpened: function(event) {
				var windowScrollY = window.scrollY;
				var bodyScrollTop = document.querySelector("body").scrollTop;
				if (this._isMobileDevice && (windowScrollY != 0 || bodyScrollTop != 0)) {
					this.async(function() {
						this.notifyResize();
					}.bind(this), 300);
				}
			}
		});
	</script>
</dom-module>
<dom-module id="tricomp-room-criteria-when" assetpath="">
	<template>
		<style include="shared-page-styles">
			.sub-pages {
				border-top: 1px solid var(--tri-primary-content-accent-color);
			}
		</style>

		<iron-pages selected="{{_criteriaWhenType}}" class="sub-pages" attr-for-selected="page">
			<tricomp-room-criteria-when-basic page="[[_getBasicType()]]" disabled="[[disabled]]" day="{{_day}}" part-of-day="{{_partOfDay}}" on-open-criteria-when-advanced="_handleOpenCriteriaWhenAdvanced">
			</tricomp-room-criteria-when-basic>
			<tricomp-room-criteria-when-advanced page="[[_getAdvancedType()]]" disabled="[[disabled]]" current-user="[[currentUser]]" reservation-edit-mode="[[reservationManager.reservationEditMode]]" recurrence-rule-label="[[reservationManager.recurrenceRuleLabel]]" recurring-meeting="[[_isRecurringMeeting(reservationManager)]]" show-basic-button="[[_showBasicButton]]" all-day-event="[[reservationManager.reservationAllDay]]" start-date="[[reservationManager.reservationStartDate]]" end-date="[[reservationManager.reservationEndDate]]" start-time="[[reservationManager.reservationStartTime]]" end-time="[[reservationManager.reservationEndTime]]" on-open-criteria-when-basic="_handleOpenCriteriaWhenBasic">
			</tricomp-room-criteria-when-advanced>
		</iron-pages>
	</template>
	<script>
		(function() {
			TricompRoomCriteriaWhenConstants = {};
			TricompRoomCriteriaWhenConstants.ADVANCED = "Advanced";
			TricompRoomCriteriaWhenConstants.BASIC = "Basic";
			TricompRoomCriteriaWhenConstants.START_HOUR = {hour: 8, minute: 0, second: 0, millisecond: 0};
			TricompRoomCriteriaWhenConstants.MID_HOUR = {hour: 13, minute: 0, second: 0, millisecond: 0};
			TricompRoomCriteriaWhenConstants.END_HOUR = {hour: 18, minute: 0, second: 0, millisecond: 0};
			TricompRoomCriteriaWhenConstants.ZERO_HOUR = {hour: 0, minute: 0, second: 0, millisecond: 0};

			Polymer({

				is: "tricomp-room-criteria-when",

				behaviors: [
					TriRoomReservationUtilBehavior
				],

				properties: {
					reservationManager: {
						type: Object
					},

					currentUser: {
						type: Object
					},

					isWorkspaceRoom: {
						type: Boolean,
						value: false
					},

					isMeetingRoom: {
						type: Boolean,
						value: false
					},

					disabled: {
						type: Boolean,
						value: false
					},

					active: {
						type: Boolean,
						value: false,
						observer: "_handleActiveChanged"
					},

					hasBookedRooms: {
						type: Boolean,
						value: false
					},

					_day:  {
						type: String
					},

					_partOfDay: {
						type: String
					},

					_criteriaWhenType: {
						type: String,
						observer: "_handleCriteriaWhenTypeChanged"
					},

					_showBasicButton: {
						type: Boolean,
						value: false
					}
				},

				observers: [
					"_computeWorkspaceDateTime(_day, _partOfDay)",
					"_handleCurrentRoomTypeChanged(isWorkspaceRoom, isMeetingRoom)"
				],

				refresh: function() {
					if(!this.active) {
						return;
					}
					this.debounce(
						"room-criteria-when-refresh", 
						this._doRefresh
					);
				},

				_doRefresh: function() {
					this._criteriaWhenType = null;
					this._showBasicButton = this.isWorkspaceRoom;
					if (this.isMeetingRoom) {
						this._criteriaWhenType = TricompRoomCriteriaWhenConstants.ADVANCED;
					} else if (this.isWorkspaceRoom) {
						if (this._isRecurringOrAllDaySet()) {
							this._criteriaWhenType = TricompRoomCriteriaWhenConstants.ADVANCED;
						} else {
							var basicDate = this._convertToBasicDate(
								this.reservationManager.reservationStartTime,
								this.reservationManager.reservationEndTime
							);
							if (basicDate.match || !this.hasBookedRooms) {
								this._criteriaWhenType = TricompRoomCriteriaWhenConstants.BASIC;
							} else {
								this._criteriaWhenType = TricompRoomCriteriaWhenConstants.ADVANCED;
							}
						}
					}
				},

				_isRecurringOrAllDaySet: function() {
					return (
						this._isRecurringMeeting(this.reservationManager) || 
						(
							this.reservationManager.reservationEditMode != "Occurrence" && this.reservationManager.reservationEditMode != "Series")
						)	||
						(
							this.reservationManager.reservationAllDay && 
							this.hasBookedRooms
						);
				},

				_computeWorkspaceDateTime: function(dayOption, partOfDayOption) {
					if (this.reservationManager == null || !this.active) {
						return;
					}
					this.debounce(
						"_computeWorkspaceDateTime", 
						this._doComputeWorkspaceDateTime.bind(this, dayOption, partOfDayOption)
					);
				},
				
				_doComputeWorkspaceDateTime: function(dayOption, partOfDayOption) {
					var timezone = this.currentUser._TimeZoneId;
					if (this._criteriaWhenType == TricompRoomCriteriaWhenConstants.BASIC) {
						var startMo = moment().tz(timezone);
						var endMo;

						if (dayOption == "tomorrow") {
							startMo = startMo.add(1, 'days');
						}

						if (partOfDayOption == "all-day") {
							startMo.set(TricompRoomCriteriaWhenConstants.START_HOUR);
							endMo = startMo.clone().set(TricompRoomCriteriaWhenConstants.END_HOUR);
						} else if (partOfDayOption == "am") {
							startMo.set(TricompRoomCriteriaWhenConstants.START_HOUR);
							endMo = startMo.clone().set(TricompRoomCriteriaWhenConstants.MID_HOUR);
						} else if (partOfDayOption == "pm") {
							startMo.set(TricompRoomCriteriaWhenConstants.MID_HOUR);
							endMo = startMo.clone().set(TricompRoomCriteriaWhenConstants.END_HOUR);
						}
						this.fire(
							"change-start-and-end-time", 
							{
								reservationStartTime: startMo.toISOString(), 
								reservationEndTime: endMo.toISOString()
							}
						);
					}
				},

				_handleActiveChanged: function(newActive) {
					if (newActive) {
						this.refresh();
					}
				},

				_handleCriteriaWhenTypeChanged: function(newCriteriaWhenType) {
					if (this.reservationManager == null || !this.active) {
						return;
					}
					this.debounce(
						"_handleCriteriaWhenTypeChanged", 
						this._doHandleCriteriaWhenTypeChanged.bind(this, newCriteriaWhenType)
					);
				},

				_doHandleCriteriaWhenTypeChanged: function(newCriteriaWhenType) {
					if (newCriteriaWhenType == TricompRoomCriteriaWhenConstants.BASIC) {
						if (this.reservationManager.reservationAllDay && !this.hasBookedRooms) {
							this.fire(
								"change-all-day", 
								{
									reservationAllDay: false,
									completeCallback: this.refresh.bind(this)
								}
							);
						} else {
							var basicDate = this._convertToBasicDate(
								this.reservationManager.reservationStartTime,
								this.reservationManager.reservationEndTime
							);
							if (basicDate.match) {
								this._day = basicDate.day;
								this._partOfDay = basicDate.partOfDay;
							} else {
								this._day = "today";
								this._partOfDay = "all-day";
								this._computeWorkspaceDateTime(this._day, this._partOfDay);
							}
						}
					}
				},

				_handleOpenCriteriaWhenAdvanced: function(e) {
					this._criteriaWhenType = TricompRoomCriteriaWhenConstants.ADVANCED;
				},

				_handleOpenCriteriaWhenBasic: function(e) {
					this._criteriaWhenType = TricompRoomCriteriaWhenConstants.BASIC;
				},

				_getBasicType: function() { 
					return TricompRoomCriteriaWhenConstants.BASIC;
				},

				_getAdvancedType: function() { 
					return TricompRoomCriteriaWhenConstants.ADVANCED;
				},
				
				_computeBasicDayOption: function(reservationStartTime, reservationEndTime, timezone) {
					var todayMo = moment().tz(timezone).set(TricompRoomCriteriaWhenConstants.ZERO_HOUR);
					var tomorrowMo = todayMo.clone().tz(timezone).add(1, 'days');
					
					var reservationStartTimeMo = moment(reservationStartTime)
							.tz(timezone).set(TricompRoomCriteriaWhenConstants.ZERO_HOUR);
					var reservationEndTimeMo = moment(reservationEndTime)
							.tz(timezone).set(TricompRoomCriteriaWhenConstants.ZERO_HOUR);

					if (reservationStartTimeMo.isSame(todayMo) && reservationEndTimeMo.isSame(todayMo)) {
						return "today";
					} else if (reservationStartTimeMo.isSame(tomorrowMo) && reservationEndTimeMo.isSame(tomorrowMo)) {
						return "tomorrow";
					} else {
						return null;
					}
				},

				_computeBasicPartOfDayOption: function(reservationStartTime, reservationEndTime, timezone) {
					var reservationStartTimeMo = moment(reservationStartTime).tz(timezone);
					var reservationEndTimeMo = moment(reservationEndTime).tz(timezone);

					var startHourMo = reservationStartTimeMo.clone()
							.tz(timezone).set(TricompRoomCriteriaWhenConstants.START_HOUR);
					var midHourMo = reservationStartTimeMo.clone()
							.tz(timezone).set(TricompRoomCriteriaWhenConstants.MID_HOUR);
					var endHourMo = reservationStartTimeMo.clone()
							.tz(timezone).set(TricompRoomCriteriaWhenConstants.END_HOUR);

					if (reservationStartTimeMo.isSame(startHourMo) && reservationEndTimeMo.isSame(endHourMo)) {
						return "all-day";
					} else if (reservationStartTimeMo.isSame(startHourMo) && reservationEndTimeMo.isSame(midHourMo)) {
						return "am";
					} else if (reservationStartTimeMo.isSame(midHourMo) && reservationEndTimeMo.isSame(endHourMo)) {
						return "pm";
					} else {
						return null;
					}
				},

				_convertToBasicDate: function(reservationStartTime, reservationEndTime) {
					var day = null;
					var partOfDay = null;
					var timezone = this.currentUser != null ? this.currentUser._TimeZoneId : "";

					day = this._computeBasicDayOption(reservationStartTime, reservationEndTime, timezone);
					if (day != null) {
						partOfDay = this._computeBasicPartOfDayOption(reservationStartTime, reservationEndTime, timezone);
					}

					return {
						match: day != null && partOfDay != null, 
						day: day,
						partOfDay: partOfDay
					};
				},

				_handleCurrentRoomTypeChanged: function(isWorkspaceRoom, isMeetingRoom) {
					if (this.active) {
						this.refresh();
					}
				}
			});
		})();
	</script>
</dom-module>
<dom-module id="tricomp-room-criteria" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
			}

			.header-section {
				padding: 10px 20px 10px 20px;
			}

			triapp-location-context {
				padding: 5px 20px 20px 20px;
				display: block;
			}
			
			.location-options-section {
				border-top: 1px solid var(--tri-primary-content-accent-color);
			}


			.amenities-list {
				@apply(--layout-flex);
			}

			.row-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			.select-amenities-link {
				@apply(--layout-flex);
			}

			.sub-section:not(:first-child) {
				padding-top: 12px;
			}
			.sub-section:not(:last-child) {
				padding-bottom: 12px;
			}

			.sub-section-amenities {
				padding-left: 20px;
			}

			.layout-dropdown-container {
				@apply(--layout-horizontal);
				@apply(--layout-start);
			}

			paper-dropdown-menu {
				--paper-input-container-label-floating:{
    				font-family: var(--tri-font-family);
   					font-weight: 400;
					-webkit-font-smoothing: subpixel-antialiased;

   				};
			}

			.action-bar {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				@apply(--layout-center-justified);
			}

			.action-button {
				font-weight: 500;
				margin: 10px 5px;
			}

			:host(:not([small-screen-width])) .action-bar {
				padding-bottom: 20px;
			}

			:host([small-screen-width]) .action-bar {
				background-color: var(--tri-footer-background-color);
				color: var(--tri-footer-color);
				width: 100%;
				padding: 5px;
				@apply(--layout-center-center);
				@apply(--layout-fixed-bottom);
				z-index: 102;
			}

			:host([small-screen-width]) .action-bar-space {
				height: 55px;
			}

			.empty-data-message > * {
				margin: 10px 0;
			}

			.empty-data-message-icon {
				height: 32px;
				width: 32px;
			}

			#amenities{
				font-weight: 400;
				font-size: 12px;
				color: var(--tri-primary-content-label-color);
				font-family: var(--tri-font-family);
			}

			:host-context([dir="rtl"]) .expand-button {
                 transform: scaleX(-1);
            } 

		</style>

		<triplat-ds id="roomTypes" name="roomTypes" data="{{roomTypes}}"></triplat-ds>

		<triplat-ds id="layoutTypes" name="layoutTypes" filtered-data="{{layoutTypes}}">
			<triplat-query>
				<triplat-query-filter name="parentListValueId" operator="equals" value="{{reservationManager.searchRoomType.id}}"></triplat-query-filter>
			</triplat-query>
		</triplat-ds>

		<triplat-ds id="lookupPeople" name="lookupPeople" data="{{_allPeople}}" loading="{{lookupPeopleLoading}}">
			<triplat-query delay="500">
			   <triplat-query-scroll-page scroller="[[peopleScroller]]" size="30">
			   </triplat-query-scroll-page>
			   <triplat-query-filter name="name" operator="equals" value="{{_peopleSearchValue}}" ignore-if-blank="">
			   </triplat-query-filter>
		   </triplat-query>
	   </triplat-ds>

		<div class="page-main">
			<div class="page-wrap">
				<tricomp-alert-message id="appUserMessage" warning="" hidden$="[[!reservationManager.userMessage]]">
					<div>[[reservationManager.userMessage]]</div>
				</tricomp-alert-message>

				<section class="header-section">
					<tricomp-select-input required="" no-label-float="" value="{{selectedRoomType}}" search-value="{{_roomTypeSearchValue}}" value-name="value" select-src="[[roomTypes]]" disabled="[[_disableSelectRoomType(hasBookedRooms, reservationManager.timeZone)]]">
					</tricomp-select-input>
				</section>

				<triapp-location-context id="userLocation" tabindex="-1" hide-message="" override-building-id="{{overrideBuildingId}}" on-location-changed="_handleLocationChanged" change-location-type="icon" regular-font-size="" image-width="64" image-height="64" hidden$="[[!_hasRoomType]]" disabled="[[disabled]]" no-popup="[[noPopup]]" scroller="[[scroller]]" search-value="[[searchValue]]" search-result="{{searchResult}}" loading="{{loading}}">
				</triapp-location-context>

				<tricomp-room-criteria-when id="criteriaWhen" class="padded-container" reservation-manager="{{reservationManager}}" current-user="[[currentUser]]" is-workspace-room="[[_isRoomTypeWorkspace(reservationManager.searchRoomType, _workspaceId)]]" is-meeting-room="[[_isRoomTypeMeetingSpace(reservationManager.searchRoomType, _meetingSpaceId)]]" has-booked-rooms="[[hasBookedRooms]]" active="[[active]]" disabled="[[_disableCriteriaWhen]]" hidden$="[[!_hasRoomType]]">
				</tricomp-room-criteria-when>

				<section class="location-options-section padded-container" hidden$="{{!_isRoomTypeMeetingSpace(selectedRoomType, _meetingSpaceId)}}">
					<div class="sub-section">
						
						<tricomp-incremental-number-input id="capacity" invalid="{{attendeesInvalid}}" float-label="" label="Attendees12345" aria-label="Attendees" min="1" max="9999" value="{{reservationManager.searchCapacity}}" disabled="[[_noTimezone(reservationManager.timeZone)]]">
						</tricomp-incremental-number-input>

						<div class="layout-dropdown-container">
							<paper-dropdown-menu label="Layout" tab-index="0" no-animations="" on-tap="_jumpTo" always-float-label="" disabled="[[_noTimezone(reservationManager.timeZone)]]">
								<paper-listbox id="layoutTypesListBox" class="dropdown-content" on-iron-select="_handleRoomLayoutSelected">
									<template id="layoutTypesTemplate" is="dom-repeat" items="[[layoutTypes]]" on-dom-change="_handleLayoutTypesTemplateDomChange">
										<paper-item>[[item.value]]</paper-item>
									</template>
								</paper-listbox>
							</paper-dropdown-menu>
						</div>
					</div>
				</section>

				<div class="sub-section sub-section-amenities" hidden$="{{!_isRoomTypeMeetingSpace(selectedRoomType, _meetingSpaceId)}}">
					<iron-label class="field-container">
						<span id="amenities">Amenities</span>
						<div class="row-container" iron-label-target="">
							<tricomp-amenities-list class="amenities-list" hidden$="[[_noAmenitiesSelected]]" catering="[[reservationManager.isCateringAvailable]]" disabled-access="[[reservationManager.isADAAvailable]]" network-connection="[[reservationManager.isNetworkConnection]]" phone-conference="[[reservationManager.isConferencePhone]]" projector="[[reservationManager.isProjector]]" video-conference="[[reservationManager.isVideoConference]]" whiteboard="[[reservationManager.isWhiteboard]]">
							</tricomp-amenities-list>
							<span class="link select-amenities-link" hidden$="[[!_noAmenitiesSelected]]" tabindex="0" aria-label="Select amenities" on-tap="_handleNavigateAmenities">Select amenities</span>
							<span class="link" hidden$="[[_noAmenitiesSelected]]" on-tap="_handleNavigateAmenities">Select more</span>
							<paper-icon-button primary="" class="expand-button" icon="ibm-glyphs:expand-open" on-tap="_handleNavigateAmenities" tabindex="0" aria-label="Expand amenities"></paper-icon-button>
						</div>
					</iron-label>
				</div>
				<section class="location-options-section">
					<triplat-select-input id="supervisor" label="Close to my co-worker" value="{{selectedPerson}}" search-value="{{_peopleSearchValue}}" value-name="name" select-src="[[_allPeople]]" scroll-element-into-view="" scroller="{{peopleScroller}}">
					</triplat-select-input>
				</section>
				<div class="action-bar" hidden$="{{_hideSearchButton}}">
					<paper-button class="action-button" on-tap="_updateSearch" noink="" disabled="[[_noTimezone(reservationManager.timeZone)]]">Search</paper-button>
				</div>
				<div class="action-bar-space"></div>
				<div class="action-bar" hidden$="{{_hideSmallScreenSearchButton}}">
					<paper-button footer-secondary$="[[smallScreenWidth]]" on-tap="_handleReturnToSummary" hidden="[[!hasBookedRooms]]">Return to summary</paper-button>
					<paper-button footer$="[[smallScreenWidth]]" on-tap="_handleSearchRoom" disabled="[[_noTimezone(reservationManager.timeZone)]]">Search</paper-button>
				</div>
				<div class="empty-data-message" hidden$="[[_hasRoomType]]">
					<iron-icon class="empty-data-message-icon" icon="ibm:status-info" info=""></iron-icon>
					<div>Select a room type.</div>
				</div>
			</div>
		</div>
	</template>
	<script>
		Polymer({

			is: "tricomp-room-criteria",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior,
				TriValidationBehavior
			],

			properties: {
				currentUser: {
					type: Object
				},

				reservationManager: {
					type: Object
				},

				isOutlookEmbedded: {
					type: Object
				},

				selectedRoomType: {
					type: Object,
					value: {
						id: -1,
						value: "",
					},
					observer: "_handleSelectedRoomTypeChange"
				},
				selectedPerson: {
					type: Object,
					value: {
						id: -1,
						value: "",
					},
/* 					observer: "_handleSelectedPersonChange"
 */				},

				roomTypes: {
					type: Array,
					observer: "_handleRoomTypesChange"
				},

				_noAmenitiesSelected: {
					type: Boolean,
					computed: "_computeNoAmenitiesSelected(reservationManager.isCateringAvailable, reservationManager.isADAAvailable, reservationManager.isNetworkConnection, reservationManager.isProjector, reservationManager.isConferencePhone, reservationManager.isVideoConference, reservationManager.isWhiteboard)"
				},

				hasBookedRooms: {
					type: Boolean,
					value: false
				},

				active: {
					type: Boolean,
					value: false
				},

				noActionBar: {
					type: Boolean,
					value: false
				},

				_disableCriteriaWhen: {
					type: Boolean,
					value: false,
					computed: "_computeDisableCriteriaWhen(isOutlookEmbedded, reservationManager, hasBookedRooms)"
				},

				_hasRoomType: {
					type: Boolean,
					value: false
				},

				_hideSearchButton: {
					type: Boolean,
					value: false
				},

				_hideSmallScreenSearchButton: {
					type: Boolean,
					value: false
				},

				_searchRoomLayoutId: {
					type: String,
					computed: "_computeSearchRoomLayoutId(reservationManager)",
					observer: "_handleSearchRoomLayoutIdChanged"
				},

				disabled: {
					type: Boolean,
					value: false
				},

				overrideBuildingId: {
					type: Number,
					notify: true
				},
				
				// If true it will disable the search popup
				noPopup: {
					type: Boolean,
					value: false
				},

				// Scroller object to allow the scroll pagination in the building search
				scroller: {
					type: Object
				},

				// Search string for the building search
				searchValue: {
					type: String
				},

				// Search results from the building search
				searchResult: {
					type: Array,
					notify: true
				},

				// Loading from the building search
				loading: {
					type: Boolean,
					value: false,
					notify: true
				}
			},

			observers: [
				"_computeHideSearchButton(_hasRoomType, smallScreenWidth)"
			],

			_jumpTo: function(e) {
				e.target.scrollIntoView();
			},

			_handleRoomLayoutSelected: function(e) {
				var selectedRoomLayout = this.$.layoutTypesTemplate.itemForElement(e.detail.item);
				this.set('reservationManager.searchRoomLayout', { id: selectedRoomLayout._id, value: selectedRoomLayout.value });
			},

			_computeNoAmenitiesSelected: function(isCateringAvailable, isADAAvailable, isNetworkConnection, isProjector, isConferencePhone, isVideoConference, isWhiteboard) {
				return !isCateringAvailable && !isADAAvailable && !isNetworkConnection && !isProjector && !isConferencePhone && !isVideoConference && !isWhiteboard;
			},

			_handleNavigateAmenities: function(e) {
				this.fire("navigate-criteria-amenities", {"backEventName": "navigate-room-criteria-back"});
			},

			_handleNavigateRecurrence: function(e) {
				this.fire("navigate-recurrence", {"backEventName": "navigate-room-criteria-back"});
			},

			// update the reservation manager so that the server side query can perform the context filtering
			// for the room results
			_updateSearch: function() {
				if (this._isValidString(this.reservationManager.userMessage)) {
					this.$.appUserMessage.focus();
					this.fire("action-update-search");
					return false;
				} else if (!(this.reservationManager.searchBuilding && this.reservationManager.searchBuilding.id)) {
					this.$.userLocation.focus();
					return false;
				} else {
					this.fire("action-update-search");
					return true;
				}
			},

			_updateSearchResults: function() {
				this.fire("update-search-results");
			},

			_handleSelectedRoomTypeChange: function(value, oldValue) {
				this._hasRoomType = value != null && value.id != null && value.id != -1;
				if (!this.reservationManager) {
					return;
				}

				if (value) {
					if (this.reservationManager.searchRoomType) {
						if (value.id != this.reservationManager.searchRoomType.id) {
							this._onChangeRoomType(value);

							// clear the amenities if the room type is a workspace
							if (this._isRoomTypeWorkspace(this.selectedRoomType, this._workspaceId)) {
								this.set("reservationManager.isCateringAvailable", false);
								this.set("reservationManager.isProjector", false);
								this.set("reservationManager.isVideoConference", false);
								this.set("reservationManager.isWhiteboard", false);
								this.set("reservationManager.isNetworkConnection", false);
								this.set("reservationManager.isConferencePhone", false);
								this.set("reservationManager.isADAAvailable", false);
							}
						}
					} else {
						this._onChangeRoomType(value);
					}
				} else {
					this._onChangeRoomType({id: null, value: null});
				}
			},

			_onChangeRoomType: function(value) {
				this.fire("on-change-room-type", {value: value});
			},

			_pageAttached: function() {
				this._setRoomTypeFromRM();
			},

			_setRoomTypeFromRM: function() {
				if (this.selectedRoomType.id != this.reservationManager.searchRoomType.id) {
					this.set("selectedRoomType", this.reservationManager.searchRoomType);
				}
			},

			_handleSearchRoomLayoutIdChanged: function(searchRoomLayoutId) {
				var types = this.layoutTypes;
				if (types != null) {
					var selectedIndex = types.findIndex(
						function(item) {
							return item._id == searchRoomLayoutId;
						}
					);
					this.$.layoutTypesListBox.selected = selectedIndex != -1 ? selectedIndex : null;
				}
			},

			_handleLayoutTypesTemplateDomChange: function() {
				var searchRoomLayoutId = null;
				if (this.reservationManager != null && this.reservationManager.searchRoomLayout != null) {
					searchRoomLayoutId = this.reservationManager.searchRoomLayout.id;
				}
				this._handleSearchRoomLayoutIdChanged(searchRoomLayoutId);
			},

			_computeSearchRoomLayoutId: function() {
				if (this.reservationManager != null && this.reservationManager.searchRoomLayout != null) {
					return this.reservationManager.searchRoomLayout.id;
				} else {
					return null;
				} 
			},

			_handleLocationChanged: function(e) {
				if (e && e.detail && e.detail.building) {
					this.fire("set-building-id", {buildingId: e.detail.building._id});
				}
			},
			
			_handleSearchRoom: function(){
				if(this.smallScreen){
					if (this._updateSearch()) {
						this.fire("responsive-layout-switch-view", {viewId: "reservation-page-right-panel"});
					}
				}
			},

			_computeDisableCriteriaWhen: function(isOutlookEmbedded, reservationManager, hasBookedRooms) {
				return this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager) ||
					hasBookedRooms || this._noTimezone(reservationManager.timeZone);
			},

			_computeHideSearchButton: function(_hasRoomType, smallScreenWidth) {
				this._hideSearchButton = (this.noActionBar) ? true : (smallScreenWidth || !_hasRoomType);
				this._hideSmallScreenSearchButton = (this.noActionBar) ? true : (!smallScreenWidth || !_hasRoomType);
			},

			_handleRoomTypesChange: function() {
				this.fire("room-types-changed", {roomTypes: this.roomTypes});
			},

			_handleReturnToSummary: function(e) {
				this.fire("navigate-summary-page");
			},

			reloadLocalstorage: function() {
				this.$.userLocation.reload();
			},

			_disableSelectRoomType: function(hasBookedRooms, timezone) {
				return hasBookedRooms || this._noTimezone(timezone);
			},

			_noTimezone: function(timezone) {
				return !(timezone && timezone.id && this._isValidString(timezone.value));
			},

			enableSearchDs: function() {
				this.$.userLocation.enableSearchDs();
			},

			disableSearchDs: function() {
				this.$.userLocation.disableSearchDs();
			}

		});
	</script>
</dom-module>

<script>
	Polymer.TriplatKeyboardBehavior = {
        
        properties: {
            _ENTER: {
                type: Number,
                value: 13
            },
            _SPACE: {
                type: Number,
                value: 32
            },
            _ARROW_DOWN: {
                type: Number,
                value: 40
            }
        },
        
        _handleKeyDown: function(keyEvent){
            if(keyEvent.keyCode == this._ENTER){
                keyEvent.preventDefault();
                this.fire("triplat-keyboard-enter"); 
            }
        }
    };
</script>

<dom-module id="iron-scroll-threshold" assetpath="../iron-scroll-threshold/">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <content></content>

  </template>
</dom-module>

<script>

  Polymer({

    is: 'iron-scroll-threshold',

    properties: {

      /**
       * Distance from the top (or left, for horizontal) bound of the scroller
       * where the "upper trigger" will fire.
       */
      upperThreshold: {
        type: Number,
        value: 100
      },

      /**
       * Distance from the bottom (or right, for horizontal) bound of the scroller
       * where the "lower trigger" will fire.
       */
      lowerThreshold: {
        type: Number,
        value: 100
      },

      /**
       * Read-only value that tracks the triggered state of the upper threshold.
       */
      upperTriggered: {
        type: Boolean,
        value: false,
        notify: true,
        readOnly: true
      },

      /**
       * Read-only value that tracks the triggered state of the lower threshold.
       */
      lowerTriggered: {
        type: Boolean,
        value: false,
        notify: true,
        readOnly: true
      },

      /**
       * True if the orientation of the scroller is horizontal.
       */
      horizontal: {
        type: Boolean,
        value: false
      }
    },

    behaviors: [
      Polymer.IronScrollTargetBehavior
    ],

    observers: [
      '_setOverflow(scrollTarget)',
      '_initCheck(horizontal, isAttached)'
    ],

    get _defaultScrollTarget() {
      return this;
    },

    _setOverflow: function(scrollTarget) {
      this.style.overflow = scrollTarget === this ? 'auto' : '';
    },

    _scrollHandler: function() {
      // throttle the work on the scroll event
      var THROTTLE_THRESHOLD = 200;
      if (!this.isDebouncerActive('_checkTheshold')) {
        this.debounce('_checkTheshold', function() {
          this.checkScrollThesholds();
        }, THROTTLE_THRESHOLD);
      }
    },

    _initCheck: function(horizontal, isAttached) {
      if (isAttached) {
        this.debounce('_init', function() {
          this.clearTriggers();
          this.checkScrollThesholds();
        });
      }
    },

    /**
     * Checks the scroll thresholds.
     * This method is automatically called by iron-scroll-threshold.
     *
     * @method checkScrollThesholds
     */
    checkScrollThesholds: function() {
      if (!this.scrollTarget || (this.lowerTriggered && this.upperTriggered)) {
        return;
      }
      var upperScrollValue = this.horizontal ? this._scrollLeft : this._scrollTop;
      var lowerScrollValue = this.horizontal ?
          this.scrollTarget.scrollWidth - this._scrollTargetWidth - this._scrollLeft :
              this.scrollTarget.scrollHeight - this._scrollTargetHeight - this._scrollTop;

      // Detect upper threshold
      if (upperScrollValue <= this.upperThreshold && !this.upperTriggered) {
        this._setUpperTriggered(true);
        this.fire('upper-threshold');
      }
      // Detect lower threshold
      if (lowerScrollValue <= this.lowerThreshold && !this.lowerTriggered) {
        this._setLowerTriggered(true);
        this.fire('lower-threshold');
      }
    },

    /**
     * Clear the upper and lower threshold states.
     *
     * @method clearTriggers
     */
    clearTriggers: function() {
      this._setUpperTriggered(false);
      this._setLowerTriggered(false);
    }

    /**
     * Fires when the lower threshold has been reached.
     *
     * @event lower-threshold
     */

    /**
     * Fires when the upper threshold has been reached.
     *
     * @event upper-threshold
     */

  });

</script>
<script>
	TriplatSearchDropdownBehaviorImpl = {

    properties: {
      _smallFooter: {
        type: Boolean,
        readOnly: true,
        value: false
      }
    },

    _resizeDropdown: function(inputWidth){
      if(!(inputWidth == 0)){
        var dropdownWidth = 600;
        if(inputWidth > dropdownWidth){
          dropdownWidth += inputWidth*0.1;
            if(dropdownWidth > inputWidth){
              dropdownWidth = inputWidth;
            }
        }else{
          dropdownWidth = inputWidth;
        }
        this.$.main.style.width = dropdownWidth+'px';
        if(document.querySelector('body').getAttribute('dir') == 'rtl'){
          if(!this._isIEOrFFOrEdge) {
            this.$.main.style.right = '-'+inputWidth+'px';
          }else if(this._isFF){
            this.$.main.style.right = '0px';
          }
        }
      }
    },

    _adjustFooter: function(inputWidth){
      // 320 is the minimum possible footer.
      this._set_smallFooter((inputWidth < 320) ? true : false);
      
      var footerHeight = 54;
      // Cross-browser pure JS way of getting half of the viewing height
      var half_vh = document.documentElement.clientHeight/2;
      // The max height calculated automatically by iron-fit-behavior
      var rootMaxHeight = Number(this.style.maxHeight.replace(/[^\d\.\-]/g, ''));
      
      // Apply rootMaxHeight if needed
      var isRootMaxHeightLess = rootMaxHeight < half_vh + footerHeight;
      var resultsMaxHeight = isRootMaxHeightLess ? rootMaxHeight - footerHeight : half_vh;
      // Do the actual height changing
      this.$.results.style.maxHeight = resultsMaxHeight+'px';
    },

    _handleFFOpenPositionDelay: function(){
      if(this._isFF){
        //FF, resetFit the dropdown so CSS absolute position is reflected
        this.async(function(){
          this.resetFit();
        }, 20);
      }
    },

    get _isFF(){
      return typeof InstallTrigger !== 'undefined';
    },
        
    get _isIEOrFFOrEdge() {
      // TODO: This is not good.
      // We should find out another way of fixing bidi mirroing
      // without doing this!
      var isIE = /*@cc_on!@*/false || !!document.documentMode;
      var isEdge = !isIE && !!window.StyleMedia;
      return isIE || isEdge || this._isFF;
    },

    get _intDelay() {
      return parseInt(this.delay);
    }
	};

	TriplatSearchDropdownBehavior = [Polymer.IronOverlayBehavior, TriplatSearchDropdownBehaviorImpl];
</script><script>
    Polymer.TriplatSearchMenuBehavior = {
        
        properties: {
            _focusedByKeyboard: {
                type: Boolean,
                value: false,
                readOnly: true
            }   
        },
        
        _handleKeyDown: function(e){
            var target = e.target;
            if(e.keyCode == 40) { // Arrow Down
                if(e.target.tagName == "LI"){
                    var aux = Polymer.dom(target).firstElementChild;
                    if(aux.tagName == "PAPER-CHECKBOX"){
                        target = this._nextLine(target);
                        this._focusElement(target);
                    } else {
                        this._focusElement(aux);
                    }
                } 
                if(e.target.tagName == "SPAN"){
                    var aux = Polymer.dom(target).nextElementSibling;
                    if(aux && aux.hidden){
                        aux = Polymer.dom(aux).nextElementSibling;
                    }
                    if(aux){
                        this._focusElement(aux); 
                    } else {
                        target = Polymer.dom(target).parentNode;
                        target = this._nextLine(target);
                        this._focusElement(target);
                    }
                }
                e.preventDefault();
                return;
            }
            if(e.keyCode == 38) { // Arrow Up
                if(e.target.tagName == "LI"){
                    var aux = Polymer.dom(target).previousElementSibling;
                    if(!aux && Polymer.dom(target).parentNode.tagName == "IRON-SCROLL-THRESHOLD"){
                        aux = Polymer.dom(Polymer.dom(target).parentNode).previousElementSibling;
                    }
                    if(aux && aux.tagName == "TEMPLATE"){
                        aux = Polymer.dom(aux).previousElementSibling;
                        if(this._singleHeaderMode){
                            target = Polymer.dom(this.$$("#singleHeader")).lastElementChild;
                            this._focusElement(target);
                            e.preventDefault();
                            return;
                        }
                    }
                    if(aux){
                        target = Polymer.dom(aux).lastElementChild;
                        if(target.hidden){
                            target = Polymer.dom(target).previousElementSibling;
                        } else if(Polymer.dom(target).previousElementSibling.tagName == "PAPER-CHECKBOX"){
                            target = aux;    
                        }
                    } else {
                        target = this._previousLine(target);
                    }
                    this._focusElement(target);
                } 
                if(e.target.tagName == "SPAN"){
                    var aux = Polymer.dom(target).previousElementSibling;
                    if(aux){
                        this._focusElement(aux); 
                    } else {
                        target = Polymer.dom(target).parentNode;
                        target = this._previousLine(target);
                        this._focusElement(target);
                    }
                }
                e.preventDefault();
                return;
            }
            if(e.keyCode == 13) { // ENTER
                if(target.tagName == "PAPER-BUTTON"){
                    return;
                }
                target.click();
                e.preventDefault(); 
                return;
            }
            
            if(e.keyCode == 9 || e.keyCode == 16) { // TAB, SHIFT
                return;    
            }
            
            this.fire("triplat-search-menu-user-typed");
        },
        
        _nextLine: function(elem){
            var next = Polymer.dom(elem).nextElementSibling;
            if(next.tagName == "TEMPLATE" && next.id != "childRepeater"){
                next = Polymer.dom(next).nextElementSibling;    
            }
            if(next.tagName == "IRON-SCROLL-THRESHOLD"){
                next = Polymer.dom(next).firstElementChild;
            }
            if(next.tagName == "DIV"){
                next = Polymer.dom(next).firstElementChild;
                next = Polymer.dom(next).firstElementChild;
                next = Polymer.dom(next).nextElementSibling;
                next = Polymer.dom(next).nextElementSibling;
            }
            if(!(next.tagName == "LI")){
                next = Polymer.dom(next).parentNode;
                if(next.tagName == "IRON-SCROLL-THRESHOLD"){
                    next = Polymer.dom(next).parentNode;
                }
                next = Polymer.dom(next).nextElementSibling;
                if(next.tagName == "UL"){
                    next = Polymer.dom(next).firstElementChild;
                    next = Polymer.dom(next).firstElementChild;
                }
            }
            return next;
        },
        
        _previousLine: function(elem){
            var previous = elem;
            previous = Polymer.dom(previous).previousElementSibling;
            if(!previous){
                previous = Polymer.dom(elem).parentNode;
                if(previous.tagName == "IRON-SCROLL-THRESHOLD"){
                    previous = Polymer.dom(previous).parentNode;
                }
                previous = Polymer.dom(previous).previousElementSibling;
                if(!previous){
                    this._handleBackToAllResults();
                    this.close();
                    return;
                }
                if(previous.tagName == "UL"){
                    previous = Polymer.dom(previous).lastElementChild;
                    if(previous.tagName == "IRON-SCROLL-THRESHOLD"){
                        previous = Polymer.dom(previous).lastElementChild;
                    }
                    if(!(previous.tagName == "LI")){
                        previous = Polymer.dom(previous).previousElementSibling;
                    }
                }
            }
            return previous;
        },
        
        _focusElement: function(elem){
            if(elem){
                elem.tabIndex = -1;
                elem.focus();
                this._set_focusedByKeyboard(true);
            }
        },
        
        focusFirstElement: function(){
            var firstList = Polymer.dom(this.$.main).firstElementChild.nextElementSibling.firstElementChild;
            var firstLine = Polymer.dom(firstList).firstElementChild;
            this._focusElement(Polymer.dom(firstLine).firstElementChild);
        },
        
        _focusFirstElementSingleHeader: function(){
            var firstLine = Polymer.dom(this.$$("#singleHeader")).firstElementChild;
            this._focusElement(firstLine);
        },
        
        get _isIEOrFFOrEdge(){
            // TODO: This is not good.
            // We should find out another way of fixing bidi mirroing
            // without doing this!
            var isFF = typeof InstallTrigger !== 'undefined';
            var isIE = /*@cc_on!@*/false || !!document.documentMode;
            var isEdge = !isIE && !!window.StyleMedia;
            
            return isFF || isIE || isEdge;
        },
    }
</script><dom-module id="triplat-search-menu" assetpath="../triplat-search-input/">
	<template>
        <style>
            
            :host {
                --triplat-search-input-hover-border-color: var(--triplat-search-input-dropdown-item-hover-border-color, white);
                position: relative;
                top: 0px;
                left: 0px;
            }
            
            #main {
                padding-bottom: 3px;
                font-size: 12px;
                position: absolute;
                outline: none;
            }
            
            .results {
                overflow: auto; 
            }
            
            ul {
                margin: 0;
                padding: 0;
                background-color: var(--triplat-search-input-dropdown-item-background-color, --tri-primary-color);
            }
            
            li{
                list-style: none;
            }
            
            .header {
                @apply(--layout);
                @apply(--layout-horizontal);
                @apply(--layout-flex);
                min-height: 44px;
                background-color: var(--triplat-search-input-dropdown-header-background-color, --tri-primary-color-60);
                @apply(--triplat-search-input-dropdown-header);
            }
            
            .header-text {
                position: relative;
                font-weight: 200;
                @apply(--layout-self-center);
                margin: 9px;
            }
            
            .header-title {
                @apply(--layout-flex-10);
                color: var(--triplat-search-input-dropdown-header-text-color, --tri-primary-light-color);
                text-transform: uppercase;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .header-counter {
                position: absolute;
                color: var(--triplat-search-input-text-color);
                font-weight: bold;
                margin-left: 5px;
                margin-right: 0px;
            }
            
            :host-context([dir="rtl"]) .header-counter {
                margin-left: 0px;
                margin-right: 5px;
            }
            
            .header-option {
                @apply(--layout-flex-1);
                color: var(--triplat-search-input-text-color);
                margin-right: 9px;
            }
            
            .header-option:hover, .header-option:focus{
                text-decoration: underline;
                cursor: pointer;
                outline: none;
            }

            .child {
                @apply(--layout-horizontal);
                @apply(--layout-flex);
                min-height: 54px;
                margin: 0 9px;
                background-color: var(--triplat-search-input-dropdown-item-background-color, --tri-primary-color);
                border-bottom: 1px solid var(--triplat-search-input-dropdown-item-border-color, --tri-primary-color-40); 
                @apply(--triplat-search-input-dropdown-item);
            }
            
            .child-text{
                @apply(--layout-flex-11);
                font-size: 14px;
                color: var(--triplat-search-input-text-color);
                @apply(--layout-self-center);
                vertical-align: middle;
                font-weight: 200;
                overflow: hidden;
                text-overflow: ellipsis;
                pointer-events: none;
            }
            
            .child-checkbox{
                @apply(--layout-flex-1);
                @apply(--layout-self-center);
                margin-left: 9px;
                margin-right: 0px;
                --paper-checkbox-unchecked-color: var(--triplat-search-input-text-color);
                --paper-checkbox-checked-color: var(--tri-primary-dark-color);
            }
            
            :host-context([dir="rtl"]) .child-checkbox {
                margin-left: 0px;
                margin-right: 9px;
            }
            
            .child:hover, .child:focus {
                outline: none;
                margin: 0;
                margin-top: -1px;
                padding: 0 9px;
                cursor: pointer;
                border-bottom: 1px solid var(--triplat-search-input-hover-border-color);
                border-top: 1px solid var(--triplat-search-input-hover-border-color);  
            }
            
            li:last-of-type{
                border-bottom: 1px solid rgba(0,0,0,0);   
            }
            
            .footer-container{
                @apply(--layout-horizontal);
                @apply(--layout-flex);
                @apply(--layout-end-justified);
                height: 54px;
                padding-right: 10px;
                background-color: var(--triplat-search-input-dropdown-footer-background-color, --tri-primary-dark-color);
                @apply(--triplat-search-input-dropdown-footer-container);
            }

            :host-context([dir="rtl"]) .footer-container {
                padding-right: 0px;
                padding-left: 10px;
            }
            
            .footer-text {
                line-height: 44px;
                margin: 5px 0;
            }
            
            .footer-selected-text{
                font-size: 14px;
                color: var(--triplat-search-input-text-color);
                margin-right: 24px;
                margin-left: 0px; 
            }
            
            :host-context([dir="rtl"]) .footer-selected-text {
                margin-right: 0px;
                margin-left: 24px;   
            }
            
            .footer-deselect-option {
                font-size: 14px;
                color: var(--triplat-search-input-dropdown-footer-deselect-text-color, --tri-primary-light-color);
                margin-right: 12px;
            }
            
            :host-context([dir="rtl"]) .footer-deselect-option {
                margin-left: 12px;
                margin-right: 0px;
            }
            
            .footer-deselect-option:hover,
            .footer-deselect-option:focus{
                text-decoration: underline;
                outline: none;
                cursor: pointer;
            }
            
            .footer-divider {
                color: var(--tri-primary-light-color);
                font-size: 20px;  
                font-weight:lighter;
            }
            
            .done-button {
                @apply(--layout-self-center); 
                padding-left: 24px;
                padding-right: 24px;
                height: 40px;
                border: 2px solid rgba(255,255,255,0.8);
                font-size: 14px;
                color: rgb(255,255,255);
                text-transform: none;
                margin-left: 12px;
                text-align: center;
            }
            
            :host-context([dir="rtl"]) .done-button {
                margin-right: 12px;
                margin-left: 0px;
            }
            
            .done-button:hover{
                border: 2px solid rgba(255,255,255,1);
                background-color: var(--tri-primary-color);
            }
            
        </style>
        
        <div id="main">
            <template is="dom-if" if="{{_singleHeaderMode}}" id="singleHeaderTemplate" restamp="">
                <div class="header" id="singleHeader">
                    <span class="header-text header-title">
                        {{_currentHeader.value}}<span class="header-counter">{{_currentHeader.count}}
                            <span hidden="{{_isSelectedItemsHidden(_currentHeader, _selected.length, _currentSelected.length)}}">
                                ({{_computeSelected(_currentHeader.value, _selected.length, _currentSelected.length)}} selected)
                       			<span hidden="{{_toggleHidden}}">&nbsp;</span>
                            </span>
                       		<span hidden="{{_toggleHidden}}">&nbsp;</span>
                        </span>
                    </span>
                    <span class="header-text header-option" on-tap="_handleBackToAllResults" aria-label="Back to all results">&lt; Back to all results...</span>
                </div>
            </template>
            <div class="results" id="results">
                <template is="dom-repeat" items="{{_fields}}" as="field" id="repeater" filter="{{_filterHeader(_currentHeader)}}">
                    <ul role="listbox">
                        <template is="dom-if" if="{{!_singleHeaderMode}}">
                            <li class="header" role="option" tabindex="0">
                                <span class="header-text header-title">
                                    {{field.value}}<span class="header-counter">{{field.children.length}} 
                                        <span hidden="{{_isSelectedItemsHidden(field, _currentSelected.length, _selected.length)}}">
                                            ({{_computeSelected(field.value, _currentSelected.length, _selected.length)}} selected)
                                            <span hidden="{{_toggleHidden}}">&nbsp;</span>
                                        </span>
                                        <span hidden="{{_toggleHidden}}">&nbsp;</span>
                                    </span>
                                </span>
                                <span class="header-text header-option" hidden="{{_isShowMoreHidden(field.children.length)}}" on-tap="_handleShowMore" aria-label="Show More">Show more...</span>
                            </li>
                        </template>
                        <iron-scroll-threshold on-lower-threshold="_handleThreshold" scroll-target="results" lower-threshold="0" id="threshold">
                            <template is="dom-repeat" id="childRepeater" items="{{field.children}}" as="child" filter="{{_limitChildren(_currentHeader, _currentAllowedMax)}}">
                                <li class="child" role="option" on-tap="_handleItemSelected">
                                    <paper-checkbox noink="" tabindex="-1" class="child-checkbox" on-change="_handleItemChange" checked="{{child.checked}}" on-iron-change="_handleIronChange"></paper-checkbox>
                                    <span class="child-text" is="triplat-word-highlight" value="{{child.value}}" search-value="{{value}}"></span>
                                </li>
                            </template>
                        </iron-scroll-threshold>
                    </ul>
                </template>
            </div>
            <div class="footer-container" id="footerContainer" hidden$="{{_isFooterHidden(_fields)}}">
                <span class="footer-text footer-selected-text" hidden$="{{_smallFooter}}">{{_selectedTotal}} SELECTED</span>
                <span class="footer-text footer-deselect-option" on-tap="_handleDeselectAll" tabindex="0" hidden$="{{_smallFooter}}">Deselect All</span>
                <span class="footer-text footer-divider" hidden$="{{_smallFooter}}">|</span>
                <paper-button class="done-button tri-disable-theme" noink="" on-tap="_handleDone">Done</paper-button>
            </div>
        </div>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-search-menu",
        
        behaviors: [TriplatSearchDropdownBehavior, Polymer.TriplatSearchMenuBehavior],
        
		properties: {
            value: {
				type: String,
				readOnly: false,
                observer: "_handleValueChanged"
			}, 
            
            aliases: {
                type: Object,
                value: {},
                readOnly: false
            },
            
            data: {
                type: Object,
                observer: "_handleDataChanged"
            },
            
            maxHeaderChildren: {
                type: Number,
                value: 3
            },
            
            delay: {
				type: Number,
				notify: false,
			},
            
            _singleHeaderMode: {
                type: Boolean,
                value: false,
                readOnly: true
            },
            
            _selected: {
                type: Array,
                value: []
            },
            
            _currentSelected: {
                type: Array,
                value: []
            },
            
            _selectedLookup: {
                type: Object,
                value: {}
            },
            
            _dataLookup: {
                type: Object,
                value: {},
                readOnly: true
            },
            
            _fieldsList: {
                type: Array,
                value: [],
                readOnly: true
            },
            
            _fields: {
                type: Array,
                value: [],
                readOnly: true
            },
            
            _currentHeader: {
                type: Object, 
                readOnly: true,
                value: function(){
                    return {value:""};   
                }
            },
            
            _selectedTotal: {
                type: Number,
                value: 0,
                readOnly: true
            },
            
             _selectedByField: {
                type: Object,
                value: {}
            },
            
            _checkboxesLookup: {
                type: Object,
                value: {}
            },
            
            _stringWithIdFields: {
                type: Array,
                value: []
            },
            
            _focusedByKeyboard: {
                type: Boolean,
                value: false,
                readOnly: true
            },
            
            _scrollTopController: {
                type: Number,
                readOnly: true
            },

            _toggleHidden: {
                type: Boolean,
                value: false,
                readOnly: true
            },
            
            _matchFields: {
                type: Array,
                value: [],
                readOnly: true
            },
            
            _currentAllowedMax: {
                type: Number,
                value: 50,
                readOnly: true
            }
            
		},
        
        ready: function(){
            this.listen(this, "iron-overlay-canceled", "_handleCancel");
            this.listen(this.$.main, "keydown", "_handleKeyDown");
            this.listen(this.$.singleHeaderTemplate, "dom-change", "_handleDomChange");
            this.closeMenu();
        },

        _forceCounterRender: function(){
            /*
             * In Microsoft Edge the header counters dont display the new calculated count as the browser does not render them. Hidden/displaying elements within 
             * the counts elements, effects their sizing and forces the browser to render.
             */
        	this._set_toggleHidden(!this._toggleHidden);
        },
        
        _handleDomChange: function(e){
            if(this._focusedByKeyboard){
                if(this._singleHeaderMode){
                    this._focusFirstElementSingleHeader();
                } else {
                    this.async(this.focusFirstElement);
                }
            }
            this.async(this._adjustScroll);
        },
        
        _filterHeader: function(current){
            if(!current.value){
                return null;   
            }
            return function(header){
                return header.value == current.value;  
            };
        },
        
        _limitChildren: function(currentHeader, currentAllowedMax){
            if(!currentHeader.value == ""){
                return function(item){
                    return this.items.indexOf(item) < currentAllowedMax;
                };
            }
            var maxHeader = this.maxHeaderChildren;
            return function(item){
                return this.items.indexOf(item) < maxHeader;
            };
        },
        
        _handleThreshold: function(){
            if(this._singleHeaderMode){
                var max = this._currentAllowedMax;
                this._set_currentAllowedMax(max*2);
            }
            this.$$("#threshold").clearTriggers();
        },
        
        _isSelectedItemsHidden: function(field){
            if(this._selectedByField[field.value] > 0){
                return false;
            }
            return true;
        },
        
        _computeSelected: function(value){
            return this._selectedByField[value];
        },
        
        _isShowMoreHidden: function(childrenLength){
            return childrenLength <= this.maxHeaderChildren;
        },
        
        _isFooterHidden: function(fields){
            return fields ? fields.length == 0 : true; 
        },
        
        _handleShowMore: function(e){
            // Open issue - https://github.com/Polymer/polymer/issues/1865
            // e.model is returning the dom-if no the dom-repeat model.
            // Only way to get the model at the moment is this:
            var model = this.$$("#repeater").modelForElement(e.target);
            this._set_currentHeader({value: model.field.value, count: model.field.children.length});
            this._set_singleHeaderMode(true);
            this._set_scrollTopController(this.$.results.scrollTop);
            this.$.results.scrollTop = 0;
        },
        
        _handleBackToAllResults: function(e){
            this._set_currentHeader({value:""});
            this._set_singleHeaderMode(false);
            this._set_currentAllowedMax(50);
        },
        
        _adjustScroll: function(scrollTop){
            this.$.results.scrollTop = this._singleHeaderMode ? 0 : this._scrollTopController;    
        },
        
        _handleValueChanged: function(value){
            if (this._delayHandle != undefined && this._delayHandle != null) {
				this.cancelAsync(this._delayHandle);
			}
            if(!(value == "")){
                this._delayHandle = this.async(this._doValueChanged, this._intDelay);
            }
        },
        
        _doValueChanged: function(){
            var value = this.value;
            var fields = [];
            var matchFields = [];
            var selectedTotal = 0;
            this._fieldsList.forEach(function(field){
                var fieldObj = {value: this.aliases[field], children: [], checked: 0};
                var selectedByField = 0;
                this._dataLookup[field].forEach(function(child){
                    if(child.toLowerCase().indexOf(value.toLowerCase()) != -1){
                        var checked = this._selectedLookup[field+"_"+child] ? true : false;
                        if(checked){
                            fieldObj.checked++;
                            selectedByField++;
                        }
                        fieldObj.children.push({value: child, field: field, checked: checked});
                    }
                }, this);
                if(fieldObj.children.length > 0){
                    fields.push(fieldObj);
                    this._selectedByField[this.aliases[field]] = selectedByField;
                    selectedTotal += selectedByField;
                    matchFields.push(field);
                }
            }, this);
            this._set_selectedTotal(selectedTotal);
            this._set_fields(fields);
            this._set_matchFields(matchFields);
            this.fire("triplat-search-menu-value-changed");
            
            this._forceCounterRender();
            this._handleFFOpenPositionDelay();
        },
        
        _handleDataChanged: function(){
            this._set_dataLookup(this._buildDataLookup);
        },
        
        get _buildDataLookup() {
            if(!this.data || this.data.length == 0){
                return;    
            }
            var fields = Object.keys(this.data[0]);
            var mappedResults = {};
            var fieldsList = [];
            for(var field in fields){
            	var fieldName = fields[field];
                if(this.aliases[fieldName]){
                    var fieldResults = [];
                    this.data.forEach(function(dataRow){
                        if(dataRow[fieldName]){
                            var fieldValue = dataRow[fieldName];
                            var actualValue = fieldValue;
                            if(actualValue.value){
                                actualValue = actualValue.value;
                                if(this._stringWithIdFields.indexOf(fieldName) == -1){
                                    this._stringWithIdFields.push(fieldName);
                                }
                            }
                            if(typeof actualValue == "string" && fieldResults.indexOf(actualValue) == -1){
                                fieldResults.push(actualValue);
                            }
                        }
                    }, this);
                    fieldsList.push({"fieldName":fieldName, "alias": this.aliases[fieldName]});
                    
                    //sorted field results
                    mappedResults[fieldName] = fieldResults.sort();
                }
            }
            
            //sort fields list by aliases
            fieldsList.sort(function(field1,field2){
            	var alias1 = field1.alias.toLowerCase();
            	var alias2 = field2.alias.toLowerCase();
            	if(alias1>alias2){
            		return 1;
            	} else if (alias1<alias2) {
            		return -1;
            	} else {
            		return 0;
            	}
            });
            
            // create array of fields names (sorted by their aliases)
            var sortedFieldsNames = [];
            fieldsList.forEach(function(field){
	            	sortedFieldsNames.push(field.fieldName);
            });
            
			this._set_fieldsList(sortedFieldsNames);
            return mappedResults;
        },
        
        _handleItemSelected: function(e){
            /* Event propagation is not working as expect. 
            * should find another way out to do this
            */
            if(e.target.tagName == "LI"){
                Polymer.dom(e.target).firstElementChild.fire("tap");
            }
        },
        
        _handleItemChange: function(e){
            var child = e.model.child;
            var lookup = child.field+"_"+child.value;
            if(e.target.checked){
                this.buildSelection(lookup, child);
                this._selectedByField[this.aliases[child.field]]++;
                this._set_selectedTotal(++this._selectedTotal);
                this._checkboxesLookup[lookup] = e.target;
                this.push("_currentSelected", child);
            } else {
                this._selectedByField[this.aliases[child.field]]--;
                this.removeSelected(lookup);
                this._set_selectedTotal(--this._selectedTotal);
                var index = this._searchSelected(child, this._selected);
                if(index != -1){
                    this.splice("_selected", index, 1);
                }
                index = this._searchSelected(child, this._currentSelected);
                if(index != -1){
                    this.splice("_currentSelected", index, 1);
                }
            }

            this._forceCounterRender();
        },
        
        _searchSelected: function(child, selected){
            for(var i = 0; i < selected.length; i++){
                var selection = selected[i];
                if(selection.name == child.name && selection.value == child.value) {
                    return i;   
                }
            }
            return -1;
        },
        
        _handleCancel: function(){
            this._currentSelected.forEach(function(selected){
                var lookup = selected.field+"_"+selected.value;
                this._selectedByField[this.aliases[selected.field]]--;
                this.removeSelected(lookup);
                this._set_selectedTotal(--this._selectedTotal);
            }, this);
            this._currentSelected = [];
            this._handleBackToAllResults();
            this._set_focusedByKeyboard(false);
        },
        
        _handleIronChange: function(e){
            var child = e.model.child;
            if(child && child.checked){
                var lookup = child.field+"_"+child.value;
                this._checkboxesLookup[lookup] = e.target;
            }
        },
        
        _handleDeselectAll: function(){
            this._deselectSelected(this._selected);
            this._deselectSelected(this._currentSelected);
            this._updateSelections();
            var aux = this.value;
            this.value = "";
            this.value = aux;
        },
        
        _deselectSelected: function(selected){
            selected.forEach(function(selection){
            var lookup = selection.field+"_"+selection.value;
                if(this._selectedLookup[lookup]){
                    this.removeSelected(lookup);
                    this._selectedByField[this.aliases[selection.field]]--;
                    this._set_selectedTotal(--this._selectedTotal);
                    this._checkboxesLookup[lookup].checked = false;   
                }
            }, this); 
        },
        
        _handleDone: function(){
            var filters = {};
            this._currentSelected.forEach(function(selected){
                this._selected.push(selected);
            }, this);
            this._selected.forEach(function(selection){
                if(!filters[selection.field]){
                    filters[selection.field] = [];   
                }
                filters[selection.field].push(selection.value);   
            });
            
            //sort the values in each filter
            var fields = Object.keys(filters);
            for(var field in fields){
            	var fieldName = fields[field];
            	if(filters[fieldName]!=null && filters[fieldName].length>1){
                	filters[fieldName].sort();
            	}
            }

            this.fire("triplat-search-menu-items-selected", {
                    filters: filters, 
                    stringWithId: this._stringWithIdFields});
            
            this._selected = [];
            this._currentSelected = [];
            this._handleBackToAllResults();
            this._set_focusedByKeyboard(false);
            this.close();
        },
        
        _updateSelections: function(){
            this._currentSelected = [];
            this._selected = [];
            var selections = Object.keys(this._selectedLookup);
            for(var selection in selections){
                var selectedObj = this._selectedLookup[selections[selection]];
                if(this._selected.indexOf(selectedObj) == -1){
                    this._selected.push(selectedObj);
                }
            }
        },
        
        buildSelection: function(lookup, selection){
            this._selectedLookup[lookup] = selection;    
        },
        
        removeSelected: function(lookup){
            delete this._selectedLookup[lookup];
        },
        
        removeAllSelected: function(lookup){
            this._selectedLookup = {};
        },
        
        openMenu: function(inputWidth){
            this._updateSelections();
            this.$.results.scrollTop = 0;
            this._handleBackToAllResults();
            this.resizeDropdown(inputWidth);
            this.open();
            this._handleFFOpenPositionDelay();
        },
        
        resizeDropdown: function(inputWidth){
            this._resizeDropdown(inputWidth);
            this._adjustFooter(inputWidth);
        },
        
        closeMenu: function(inputWidth){
            this.close();
        },
        
        handleUniversalSearch: function(){
            this.fire("triplat-search-menu-universal-search", {fields: this._matchFields, stringWithId: this._stringWithIdFields}); 
            this.close();
        }
	});
</script><dom-module id="triplat-search-mobile-filters" assetpath="../triplat-search-input/">
    <template>
        <style>
            
            :host {
                position: relative;
                top: 0px;
                left: 0px;
            }
            
            #main {
                font-size: 12px;
                position: absolute;
                outline: none;
                z-index: 1;
                overflow: auto; 
                max-height: 50vh;
                background-color: var(--triplat-search-input-expand-filters-background-color, --tri-primary-color-10);
            }
            
            .filters {
                @apply(--layout);
                @apply(--layout-vertical); 
                @apply(--triplat-search-input-expand-filters-container);
            }

            .single {
                @apply(--layout);
                @apply(--layout-horizontal); 
                background-color: var(--triplat-search-input-expand-filters-background-color, --tri-primary-color-10);
                color: var(--triplat-search-input-filter-text-color, --tri-primary-content-color);
                margin: 0px 10px;
                padding: 5px 0px;
                border-bottom: 1px solid white;
            }
            
            .group {
                @apply(--layout-flex);
                @apply(--layout-self-center);
                padding: 0px;
                margin: 0px;
                font-size: 0;
            }
            
            .filter-text{
                font-size: 12px;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            
            .filter-text-divider{
                margin: 1px;
            }

            .operator {
                background-color: var(--triplat-search-input-filter-operator-background-color, --tri-primary-color);
                min-width: 44px;
                min-height: 44px;
            }
            
            :host-context([dir="ltr"]) .operator {
                margin-left: 0px;
                margin-right: 5px;  
            }

            :host-context([dir="rtl"]) .operator {
                margin-left: 5px;
                margin-right: 0px; 
            }

            iron-icon.equals-icon{
                min-width: 24px; 
                min-height: 24px;
                color: var(--triplat-search-input-operator-equals-icon-color, white);
                margin: 10px;
            }

            .clearfilter {
                min-width: 44px;
                min-height: 44px;
                margin-right: 0; 
            }

            .clear-filter-icon{
                min-width: 32px; 
                min-height: 32px;
                margin: 3px;
                color: var(--triplat-search-input-expand-filters-remove-icon-color, --tri-primary-color);
                cursor: pointer; 
            }

            triplat-icon iron-icon:focus{
                background-color:rgba(0, 0, 0, 0.07);
            }
            
            .footer {
                @apply(--layout);
                @apply(--layout-horizontal);
                min-height: 54px;
                margin: 0px;
                background-color: var(--triplat-search-input-dropdown-footer-background-color, --tri-primary-dark-color);
                color: white;
                text-align: right;
            }
            
            .footer-container {
                @apply(--layout-flex);
                @apply(--layout-self-center);
                font-size: 14px;
                color: var(--triplat-search-input-dropdown-footer-deselect-text-color, --tri-primary-dark-color);
                margin-right: 12px;
            }
            
            .clear-all-button {
                padding-left: 24px;
                padding-right: 24px;
                border: 2px solid rgba(255,255,255,0.8);
                color: rgb(255,255,255);
                text-transform: none;
                margin-left: 12px;
                text-align: center;
                background-color: none;
            }
            
            .clear-all-button:hover{
                border: 2px solid rgba(255,255,255,1);
                background-color: var(--tri-primary-color);
            }
            
        </style>
        
        <div id="main">
            <div class="filters" id="filtersContainer">
                <template is="dom-repeat" items="{{filters}}" as="filter">
                    <div class="single">
                        <div class="operator" title="Equals">
                            <triplat-icon class="equals-icon" icon="ibm-glyphs:equals"></triplat-icon>
                        </div>
                        <div class="group">
                            <template is="dom-repeat" items="{{filter.value}}" as="value" index-as="idx">
                                <span class="filter-text filter-text-divider" hidden$="{{_computeHidden(idx)}}">,</span>
                                <span class="filter-text">{{value}}</span>
                            </template>
                        </div>
                        <div class="clearfilter">
                            <triplat-icon icon="remove-delete" tabindex="0" class="clear-filter-icon" description="Clear filter" on-tap="_handleFilterDelete" on-keydown="_handleActionKeyDown"></triplat-icon>
                        </div>
                    </div>
                </template>
                <div class="footer">
                    <div class="footer-container">
                        <paper-button class="clear-all-button tri-disable-theme" noink="" on-tap="_handleClearAll">Remove All</paper-button>
                    </div>
                </div>
            </div>
        </div>
        
    </template>
</dom-module>
<script>
    Polymer({

		is: "triplat-search-mobile-filters",
        
        behaviors: [TriplatSearchDropdownBehavior, Polymer.TriplatSearchMenuBehavior],
        
        properties: {
            filters: {
                type: Array,
                value: [] 
            }
        },
        
        _computeHidden: function(index){
            return (index == 0);   
        },
        
        _handleFilterDelete: function(e){
            var filter = e.model.filter;
            this.fire("triplat-search-mobile-filters-delete", {filter: filter});
        },
        
        _handleClearAll: function(){
            this.fire("triplat-search-mobile-filters-delete-all");
        },
        
        openDropdown: function(inputWidth){
            this.resizeDropdown(inputWidth);
            this.open();
        },

        resizeDropdown: function(inputWidth){
            this._resizeDropdown(inputWidth);
        },
        
        _handleActionKeyDown: function(e){
			if(e.keyCode == 13) {
                e.target.click();
                e.preventDefault();   
            }
        }
    });
</script>
    <dom-module id="triplat-search-input" assetpath="../triplat-search-input/">
	<style include="iron-flex iron-flex-alignment">
        
        :host {
            --triplat-search-input-text-color: var(--triplat-search-input-primary-text-color, white);      
        }
        
        #inputContainer {
            @apply(--layout);
			@apply(--layout-horizontal);
            @apply(--layout-flex);
            padding-left: 5px;
			background-color: rgb(255,255,255);
			border-bottom: var(--triplat-search-input-border-height, 2px) solid var(--triplat-search-input-border-color, --tri-primary-color);
            height: 44px;
            font-size: 12px;
            font-family: var(--tri-font-family);
            @apply(--triplat-search-input);
        }

		triplat-icon.search-icon {
			min-width: 22px; 
			min-height: 22px;
			padding: 11px;
			color: var(--triplat-search-input-search-icon-color, --tri-primary-content-label-color);
		}
        
		triplat-icon.clear-icon {
			min-width: 22px; 
			min-height: 22px;
			padding: 11px;
			color: var(--triplat-search-input-clear-icon-color, --tri-primary-content-label-color);
			cursor: pointer;
		}
        
        triplat-icon.filters-icon {
			min-width: 24px; 
			min-height: 24px;
			color: var(--triplat-search-input-filters-icon-color, --tri-primary-color);
		}
        
        triplat-icon.filters-expand-icon {
			width: 16px; 
			height: 16px;
			color: var(--triplat-search-input-expand-filters-icon-color, --tri-primary-color);
			cursor: pointer;
		}
        
        triplat-icon.filters-close-icon {
			width: 16px; 
			height: 16px;
			color: var(--triplat-search-input-close-filters-icon-color, --tri-primary-color);
			cursor: pointer;
		}
        
        :host-context([dir="rtl"]) triplat-icon.filters-icon,
        :host-context([dir="rtl"]) triplat-icon.filters-expand-icon,
        :host-context([dir="rtl"]) triplat-icon.filters-close-icon{
            transform: scaleX(-1);
        }
        
        triplat-icon.equals-icon {
            min-width: 24px; 
            min-height: 24px;
            color: var(--triplat-search-input-operator-equals-icon-color, white);
            margin: 10px;
        }
        
		.search-input {
			@apply(--layout-flex);
			border: none;
			background-color: inherit;
			width: 100%;
			min-width: 20px;
			color: var(--tri-primary-content-label-color);
            font-size: 12px;
            height: 44px;
            padding: 0;
            margin: 0;
            outline: none;
		}

		.search-input::-ms-clear, .search-input::-ms-reveal {  
			display: none; 
			width : 0; 
			height: 0; 
		}
        
        .filters {
            @apply(--layout);
			@apply(--layout-horizontal); 
            margin-bottom: 3px;
            @apply(--triplat-search-input-filter-elements-container);
        }
        
        .group {
            @apply(--layout);
			@apply(--layout-horizontal); 
            background-color: var(--triplat-search-input-filter-background-color, --ibm-neutral-2);
            color: var(--triplat-search-input-filter-text-color, --tri-primary-content-color);
        }
        
        :host-context([dir="ltr"]) .group {
            margin-left: 0px;
            margin-right: 10px;  
        }
        
        :host-context([dir="rtl"]) .group {
            margin-left: 10px;
            margin-right: 0px;  
        }
        
        .filters div span {
            margin-left: 1px;
            vertical-align: middle;
            line-height: 40px;
            word-break: break-all;
            overflow: hidden;
        }
        
        .operator {
            background-color: var(--triplat-search-input-filter-operator-background-color, --tri-primary-color);
            min-width: 40px;
            min-height: 40px;
        }
        
        :host-context([dir="ltr"]) .operator {
            margin-left: 0px;
            margin-right: 5px;  
        }
        
        :host-context([dir="rtl"]) .operator {
            margin-left: 5px;
            margin-right: 0px; 
        }
        
        .filters div div.clearfilter {
            min-width: 40px;
            min-height: 40px;
            margin-right: 0; 
        }
        
        .filters div div.clearfilter triplat-icon {
            min-width: 24px; 
            min-height: 24px;
            margin: 8px;
            color: var(--triplat-search-input-filter-remove-icon-color, --tri-primary-content-label-color);
            cursor: pointer; 
        }
        
        .filters div triplat-icon:focus{
            background-color:rgba(0, 0, 0, 0.07);
        }
        
        .filters-action {
            @apply(--layout-horizontal);
            height: 24px;
            margin: 10px 0px;
        }
        
        :host-context([dir="ltr"]) .filters-action {
            border-left: 1px solid var(--ibm-gray-10);
            border-right: none;
            padding: 0px 0px 0px 10px;
        }
        
        :host-context([dir="rtl"]) .filters-action {
            border-left: none;
            border-right: 1px solid var(--ibm-gray-10);
            padding: 0px 10px 0px 0px;
        }
        
        .filters-number-badge {
            margin-top: -5px;
        }
        
        .filters-number-badge-text {
            font-family: var(--tri-font-family);
            font-size: 16px;
            color: var(--triplat-search-input-expand-filters-number-color, --ibm-orange-50);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;    
        }
        
	</style>
	<template>
        <div id="inputContainer">
            <template is="dom-if" if="{{searchIconPrecede}}">
                <triplat-icon class="search-icon" icon="search"></triplat-icon>
            </template>
            <template is="dom-if" if="{{!_mobileView}}">
                <div class="filters" id="filtersContainer">
                    <template is="dom-repeat" items="{{_filters}}" as="filter" on-dom-change="_controlView">
                        <div class="group">
                            <div class="operator" title="Equals">
                                <triplat-icon class="equals-icon" icon="ibm-glyphs:equals"></triplat-icon>
                            </div>
                            <template is="dom-repeat" items="{{filter.value}}" as="value">
                                <span hidden$="{{_computeHidden(index)}}">,</span>
                                <span>{{value}}</span>
                            </template>
                            <div class="clearfilter">
                                <triplat-icon icon="remove-delete" tabindex="0" on-keydown="_handleActionKeyDown" on-tap="_handleFilterDelete" description="Clear filter"></triplat-icon>
                            </div>
                        </div>
                    </template>
                </div>
            </template>
            <input id="inputField" type="text" is="iron-input" bind-value="{{_value}}" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="search-input" placeholder="{{placeholder}}" aria-label$="{{placeholder}}">
            <triplat-icon class="clear-icon" icon="ibm-glyphs:clear-input" hidden="{{!_showClear}}" on-tap="_clearSearch" tabindex="0" on-keydown="_handleActionKeyDown" description="Clear all filters"></triplat-icon>
            <template is="dom-if" if="{{!searchIconPrecede}}">
                <triplat-icon class="search-icon" icon="search"></triplat-icon>
            </template>
            <template is="dom-if" if="{{_mobileView}}">
                <div class="filters-action">
                    <triplat-icon class="filters-icon" icon="ibm-glyphs:filter" id="filters-icon"></triplat-icon>
                    <div class="filters-number-badge">
                        <span class="filters-number-badge-text">{{_selectedTotal}}</span>
                    </div>
                    <triplat-icon class="filters-expand-icon" icon="ibm-glyphs:expand-open" tabindex="0" hidden$="{{_filtersOpen}}" on-tap="_openFiltersMenu" description="Open all filters" on-keydown="_handleActionKeyDown" id="expandIcon"></triplat-icon>
                    <triplat-icon class="filters-close-icon" icon="ibm-glyphs:expand-close" tabindex="0" hidden$="{{!_filtersOpen}}" on-tap="_closeFiltersMenu" description="Close all filters" on-keydown="_handleActionKeyDown" id="closeIcon"></triplat-icon>
                </div>
            </template>
        </div>
        <triplat-search-menu id="searchMenu" value="{{_value}}" data="{{data}}" aliases="{{aliases}}" max-header-children="{{maxHeaderChildren}}" delay="{{delay}}"></triplat-search-menu>
        <triplat-search-mobile-filters id="mobileFilters" filters="{{_filters}}"></triplat-search-mobile-filters>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triplat-search-input",
        
        behaviors: [Polymer.TriplatKeyboardBehavior, Polymer.IronResizableBehavior],

		properties: {
            
            /**
			 * Value of the search box.
			 */
			value: {
				type: String,
				notify: true,
				readOnly: false
			}, 

			/**
			 * Label to display when no search value has been entered. The default value is 'Type to search'
			 */
			placeholder: {
				type: String
			},
            
			/**
			 * Flag to indicate that you want the search icon precede the input field. 
			 * If not specified, the icon will succeed the input field. 
			 */
			searchIconPrecede: {
				type: Boolean,
				value: false
			},
            
            /**
			 * Object containing the data you would like to filter against. It is the
             * "filtered-data" returned by "triplat-ds" or the "data" returned by "triplat-query".
			 */
            data: Object,
            
            /**
			 * This object holds information about the headers in the
             * search menu. If an alias is not provided for any of the
             * available fields in a data source, that field will be skipped
             * from the display.
             */
            aliases: {
                type: Object,
                value: {},
                readOnly: false
            },
            
            /**
			 * This array represents all filters that will be
             * automatically created into the "triplat-ds" or 
             * "triplat-query". The same binding should exist in the
             * "triplat-query" element associated to this search.
             */
            appendFilters: {
				type: Array,
				notify: true,
                value: []
			},
            
            /**
            * Number of maximum children under each header in
            * the search input dropdown.
            */
            maxHeaderChildren: {
                type: Number,
                value: 3
            },
            
           /**
			 * The amount of delay between the time (milliseconds) a single letter is typed, 
             * and the time the dropdown show results.
			 * 
			 * This delay is needed so we can wait a bit after presenting the results list in 
			 * the dropdown. This way we can achieve better performance, skipping searchs against
             * single letters.
			 */
            delay: {
				type: Number,
				notify: false,
				readOnly: false,
				value: 200
			},
            
            _value: {
				type: String,
				readOnly: false,
                observer: "_handleInternalValueChanged"
			}, 
            
            _placeholder: {
                type: String,
                readOnly: true
            },
            
            _filters: {
                type: Array,
                value: []
            },
            
            _showClear: {
                type: Boolean,
                value: false,
                readOnly: true
            },
            
            _mobileView: {
                type: Boolean,
                value: false,
                readOnly: true
            },
            
            _filtersOpen: {
                type: Boolean,
                value: false,
                readOnly: true
            },
            
            _selectedTotal: {
                type: Number,
                value: 0,
                readOnly: true
            },
            
            _focusedByKeyboard: {
                type: Boolean,
                value: false,
                readOnly: true
            },
		},
        
        listeners : {
            "triplat-search-menu-value-changed" : "_handleValueChanged",
            "triplat-search-menu-items-selected" : "_handleItemsSelected",
            "triplat-search-menu-user-typed" : "_handleUserTyped",
            "triplat-search-menu-universal-search": "_handleUniversalSearch",
            "triplat-search-mobile-filters-delete": "_handleFilterDeleteFromOverlay",
            "triplat-search-mobile-filters-delete-all": "_clearSearch",
            "iron-resize": "_controlView"
        },
        
        observers: ["_filtersChanged(_filters.*)"],

		ready: function() {
		    var __dictionary__default_placeholder =  "Type to search";
            if (this.placeholder == null || this.placeholder.length == 0) {
            	this.placeholder = __dictionary__default_placeholder;
            }
            this._set_placeholder(this.placeholder);
            this.listen(this.$.inputField, "keydown", "_handleInputKeyDown");
            this.listen(this.$.mobileFilters, "iron-overlay-canceled", "_handleFiltersOverlayCancel");
        },
        
        _computeHidden: function(index){
            return (index == 0);   
        },
        
        _handleInputKeyDown: function(e){
            if(e.keyCode == this._ARROW_DOWN) {
				this.$.searchMenu.focusFirstElement();
                e.preventDefault();
			}
            
            if(e.keyCode == this._ENTER){
                this.$.searchMenu.handleUniversalSearch();  
                e.preventDefault();
            }
            
        },
        
        _handleActionKeyDown: function(e){
            this._set_focusedByKeyboard(true);
			if(e.keyCode == this._ENTER || e.keyCode == this._SPACE) {
                e.target.click();
                e.preventDefault();   
            }
        },
        
        _handleUserTyped: function(){
            this.$.inputField.focus();
        },
        
        /**
		 * Clears all filters and values in the search input. It will also refresh
         * the list of records associated to this component.
		 */
        clearSearch: function(){
            this._clearSearch();    
        },
        
		_clearSearch: function() {
            this.value = "";
            this._filters = [];
            this.splice("appendFilters", 0, this.appendFilters.length);
            this._set_showClear(false);
            this._resetFiltersState(this._placeholder);
            this.$.searchMenu.removeAllSelected();
            this._set_mobileView(false);
		},
        
        _handleValueChanged: function(e){
            if(!this._mobileView){
                this._set_showClear(true);
            }
            this.$.searchMenu.openMenu(this.$.inputContainer.getBoundingClientRect().width);
        },
        
        _handleInternalValueChanged: function(value){
            this.value = value;
            // For old search compatibility
            if(value != "" && !this._mobileView){
                this._set_showClear(true);   
            } else {
                this._set_showClear(false);
                if(this._filters.length > 0 && !this._mobileView){
                    this._set_showClear(true);
                }
                this.$.searchMenu.closeMenu();
            }
        },
        
        _handleItemsSelected: function(e){
            this.splice("appendFilters", 0, this.appendFilters.length);
            this._set_mobileView(false);
            var filters = e.detail.filters;
            var stringWithId = e.detail.stringWithId;
            this._filters = [];
            var fields = Object.keys(filters);
            for(var field in fields){
                var isStringWithId = (stringWithId.indexOf(fields[field]) != -1);
                this.push("_filters", { field: fields[field], value: filters[fields[field]],
                                      isStringWithId: isStringWithId});
            }
            this._resetFiltersState("");
            if(fields.length > 0){
                this._set_showClear(true);
            }
            
            this._set_selectedTotal(this._filters.length)
        },
        
        _controlView: function(){
            if(this._filters.length > 0){
                this._set_mobileView(false);
                this._set_showClear(true);
                this.async(this._handleMobileView);
            } else {
                this.$.mobileFilters.close();
                this._set_filtersOpen(false);
                if(this._mobileView){
                    this._set_mobileView(false);
                }
            }
            var newWidth = this.$.inputContainer.getBoundingClientRect().width;
            this.$.searchMenu.resizeDropdown(newWidth);
            this.$.mobileFilters.resizeDropdown(newWidth);
        },
        
        _handleMobileView: function(){
            var inputWidth = this.$.inputContainer.offsetWidth;
            var filtersWidth = this.$$("#filtersContainer").offsetWidth;
            var remainingWidth = inputWidth - filtersWidth;
            if(remainingWidth < 150){
                this._set_mobileView(true);
                this._set_showClear(false);
            } else {
                this.$.mobileFilters.close();
                this._set_filtersOpen(false);
                this.$.inputField.focus();
            }
        },
        
        _resetFiltersState: function(placeholder){
            this._value = "";
            this.placeholder = placeholder;
            this.$.inputField.focus();
        },
        
        _handleFilterDelete: function(e){
            var filter = e.model.filter;
            this._doFilterDelete(filter);
        },
        
        _handleFilterDeleteFromOverlay: function(e){
            var filter = e.detail.filter;
            this._doFilterDelete(filter);
            this.$$("#closeIcon").focus();
        },
        
        _doFilterDelete: function(filter){
            var index = this._filters.indexOf(filter);
            if(index != -1){
                this.splice("_filters", index, 1);
            }
            if(this._filters.length == 0){
                this.placeholder = this._placeholder;   
                this._set_showClear(false);
            }
            this.$.inputField.focus();
            this._set_selectedTotal(this._filters.length)
        },
        
        _filtersChanged: function(change){
            if(change.path == "_filters.splices"){
                var indexSplice = change.value.indexSplices[0];
                indexSplice.removed.forEach(function(removed) {
                    this._removeFilter({
                        name: removed.field,
                        operator: "equals",
                        value: removed.value
                    });
                    removed.value.forEach(function(elem){
                        this.$.searchMenu.removeSelected(removed.field+"_"+elem);
                    }, this);
                }, this);
                for (var i = 0; i < indexSplice.addedCount; i++) {
    				var added = indexSplice.object[indexSplice.index + i];
                    this._addFilter({
                        name: added.field,
                        operator: "equals",
                        value: added.value,
                        isStringWithId: added.isStringWithId,
                        appendWithAnd: true
                    });
                }
            }
        },
        
        _addFilter: function(filter){
            this.push("appendFilters", filter);  
        },
        
        _removeFilter: function(filterOut){
            var index = -1;
            this.appendFilters.forEach(function(filterIn){
                if(filterIn.name == filterOut.name &&
                   filterIn.operator == filterOut.operator &&
                   filterIn.value == filterOut.value){
                       index = this.appendFilters.indexOf(filterIn);
                }
            }, this);
            if(index > -1){
                this.splice("appendFilters", index, 1);
            }
        },
        
        _handleUniversalSearch: function(e){
            this._removeUniversalFilter();
            if(this._value != ""){
                var universalFilter = { isUniversal: true, filters: [] };
                var fields = e.detail.fields;
                var stringWithId = e.detail.stringWithId;
                fields.forEach(function(field, index){
                    var isStringWithId = (stringWithId.indexOf(field) != -1);
                    var appendWithAnd = (index == 0) ? true : false;
                    universalFilter.filters.push({
                        name: field,
                        operator: "contains",
                        value: this._value,
                        isStringWithId: isStringWithId,
                        appendWithAnd: appendWithAnd
                    });
                }, this);
                this._addFilter(universalFilter);
            }
        },
        
        _removeUniversalFilter: function(){
            var index = this._universalFilterIndex;
            if(index != -1){
                this.splice("appendFilters", index, 1);    
            }
        },
                                        
        get _universalFilterIndex(){
            for(var i = 0; i < this.appendFilters.length; i++){
                if(this.appendFilters[i].isUniversal){
                    return i;    
                }
            }
            return -1;
        },
        
        _openFiltersMenu: function(){
            this.$.mobileFilters.openDropdown(this.$.inputContainer.getBoundingClientRect().width); 
            this._set_filtersOpen(true);
            if(this._focusedByKeyboard){
                this.$$("#closeIcon").focus();
            }
        },
        
        _closeFiltersMenu: function(){
            this.$.mobileFilters.close();
            if(this._focusedByKeyboard){
                this.$$("#expandIcon").focus();
            }
        },
        
        _handleFiltersOverlayCancel: function(){
            this._set_filtersOpen(false);
        },
        
        /**
		 * Restores a previous state of the search input. It will create filter containers in the field again
         * and will refresh the list of records.
		 * 
		 * @param {Array} filters The filters we want to restore in this component.
         * Usually, it is the "append-filters" value stored before we clear the search.
		 */
        restoreFilters: function(filters){
            this._clearSearch();
            var noFilters = true;
            filters.forEach(function(filter){
                if(!filter.isUniversal){
                    noFilters = false;
                    this.push("_filters", { field: filter.name, value: filter.value,
                              isStringWithId: filter.isStringWithId});
                    filter.value.forEach(function(filterValue){
                        var lookup = filter.name+"_"+filterValue;
                        this.$.searchMenu.buildSelection(lookup, {field:filter.name, value: filterValue, checked: true});
                    }, this);
                }
            }, this);
            if(!noFilters){
                this._resetFiltersState("");
                this._set_showClear(true);
            }
        }
	});
</script>


<dom-module id="triplat-loading-indicator" assetpath="../triplat-loading-indicator/">

	<template>

		<style>
			.container > div {
				@apply(--layout-fit);
				@apply(--layout-vertical);
				@apply(--layout-center-center);
				z-index: 7;
				@apply(--triplat-loading-indicator-container);
			}
	
			.clear-background {
				background-color: var(--triplat-loading-indicator-clear-background, rgba(0, 0, 0, .65));
			}
	
			.opaque-background {
				background-color: var(--triplat-loading-indicator-opaque-background, --tri-body-background-color);
			}
	
			paper-spinner {
				z-index: 8;
			}
		</style>

		<div class="container" hidden$="{{!show}}">
			<div class="clear-background" hidden$="{{hideBackground}}">
				<paper-spinner active=""></paper-spinner>
			</div>
			<div class="opaque-background" hidden$="{{!hideBackground}}">
				<paper-spinner active=""></paper-spinner>
			</div>
		</div>

	</template>

</dom-module>

<script>
	Polymer({

		is: "triplat-loading-indicator",

		properties: {
			/**
			 * If true, the screen is dimmed and a loading indicator is shown on the screen.
			 */
			show: {
				type: Boolean,
				value: false
			},
			/**
			 * If true, hides the content of the page when the loading indicator is activated.  Otherwise, it shows the content of the page in the background.
			 */
			hideBackground: {
				type: Boolean,
				value: false
			}
		}

	});
</script>


<script>
(function() {

  triPlatDuration = {};
  triPlatDuration.Multiplier = {};
  triPlatDuration.Multiplier.SECOND = 1000;
  triPlatDuration.Multiplier.MINUTE = 60*triPlatDuration.Multiplier.SECOND;
  triPlatDuration.Multiplier.HOUR = 60*triPlatDuration.Multiplier.MINUTE;
  triPlatDuration.Multiplier.DAY = 24*triPlatDuration.Multiplier.HOUR;
  triPlatDuration.Multiplier.WEEK = 7*triPlatDuration.Multiplier.DAY;
  triPlatDuration.Multiplier.MONTH_DAY = (365 * triPlatDuration.Multiplier.DAY)/12;
  triPlatDuration.Multiplier.MONTH = 100000000000000;
  triPlatDuration.Symbol = {};
  triPlatDuration.Symbol.MILLISECOND = "S";
  triPlatDuration.Symbol.SECOND = "s";
  triPlatDuration.Symbol.MINUTE = "m";
  triPlatDuration.Symbol.HOUR = "h";
  triPlatDuration.Symbol.DAY = "d";
  triPlatDuration.Symbol.WEEK = "w";
  triPlatDuration.Symbol.MONTH = "M";
  triPlatDuration.Symbol.YEAR = "y";
  triPlatDuration.Max = {};
  triPlatDuration.Max.SECOND = 59;
  triPlatDuration.Max.MINUTE = 59;
  triPlatDuration.Max.HOUR = 23;
  triPlatDuration.Max.DAY = 6;
  triPlatDuration.Max.MONTH = 11;

  /**
	* A behavior to support duration. 
	*
	* @polymerBehavior Polymer.TriPlatDurationBehavior
	*
	*/
  Polymer.TriPlatDurationBehavior = {
 
      properties: {

        /*
         * Optional minimum allowed when a year value is decreased. If a value is smaller than yearMin, the value will immediately be changed to yearMin.
         */
        yearMin: {
          type: Number,
          value: 0
        },

        /*
         * Optional maximum allowed when a year value is increased. If a value is greater than yearMax, the value will immediately be changed to yearMax.
         */
        yearMax: {
          type: Number
        },

        /*
         * Optional looping functionality for the year. When set to 1, looping is enabled, and when set to 0, looping is disabled. 
         * Looping occurs when a year value is increased or decreased (between yearMin and yearMax). If a value is greater than yearMax, the value will immediately be changed to yearMin.
         * If a value is smaller than yearMin, the value will immediately be changed to yearMax. Requires yearMax value.
         */
        yearLoop: {
          type: Number,
          value: 0
        },

        /*
         * Amount to add or subtract when incrementing or decrementing a year value.
         */
        yearStep: {
          type: Number,
          value: 1
        },    

        /*
         * Optional minimum allowed when a month value is decreased. If a value is smaller than monthMin, the value will immediately be changed to monthMin.
         */
        monthMin: {
          type: Number,
          value: 0
        },

        /*
         * Optional maximum allowed when a month value is increased. If a value is greater than monthMax, the value will immediately be changed to monthMax.
         */
        monthMax: {
          type: Number,
          value: 11
        },

        /*
         * Optional looping functionality for the month. When set to 1, looping is enabled, and when set to 0, looping is disabled. 
         * Looping occurs when a month value is increased or decreased (between monthMin and monthMax). If a value is greater than monthMax, the value will immediately be changed to monthMin.
         * If a value is smaller than monthMin, the value will immediately be changed to monthMax. Requires monthMax value.
         */
        monthLoop: {
          type: Number,
          value: 1
        },

        /*
         * Amount to add or subtract when incrementing or decrementing a month value.
         */
        monthStep: {
          type: Number,
          value: 1
        },    

        /*
         * Optional minimum allowed when a week value is decreased. If a value is smaller than weekMin, the value will immediately be changed to weekMin.
         */
        weekMin: {
          type: Number,
          value: 0
        },

        /*
         * Optional maximum allowed when a week value is increased. If a value is greater than weekMax, the value will immediately be changed to weekMax.
         */
        weekMax: {
          type: Number
        },

        /*
         * Optional looping functionality for the week. When set to 1, looping is enabled, and when set to 0, looping is disabled. 
         * Looping occurs when a week value is increased or decreased (between weekMin and weekMax). If a value is greater than weekMax, the value will immediately be changed to weekMin.
         * If a value is smaller than weekMin, the value will immediately be changed to weekMax. Requires weekMax value.
         */
        weekLoop: {
          type: Number,
          value: 0
        },

        /*
         * Amount to add or subtract when incrementing or decrementing a week value.
         */
        weekStep: {
          type: Number,
          value: 1
        },    

        /*
         * Optional minimum allowed when a day value is decreased. If a value is smaller than dayMin, the value will immediately be changed to dayMin.
         */
        dayMin: {
          type: Number,
          value: 0
        },

        /*
         * Optional maximum allowed when a day value is increased. If a value is greater than dayMax, the value will immediately be changed to dayMax.
         */
        dayMax: {
          type: Number,
          value: 6
        },

        /*
         * Optional looping functionality for the day. When set to 1, looping is enabled, and when set to 0, looping is disabled. 
         * Looping occurs when a day value is increased or decreased (between dayMin and dayMax). If a value is greater than dayMax, the value will immediately be changed to dayMin.
         * If a value is smaller than dayMin, the value will immediately be changed to dayMax. Requires dayMax value.
         */
        dayLoop: {
          type: Number,
          value: 1
        },

        /*
         * Amount to add or subtract when incrementing or decrementing a day value.
         */
        dayStep: {
          type: Number,
          value: 1
        },    

        /*
         * Optional minimum allowed when an hour value is decreased. If a value is smaller than hourMin, the value will immediately be changed to hourMin.
         */
        hourMin: {
          type: Number,
          value: 0
        },

        /*
         * Optional maximum allowed when an hour value is increased. If a value is greater than hourMax, the value will immediately be changed to hourMax.
         */
        hourMax: {
          type: Number,
          value: 23
        },

        /*
         * Optional looping functionality for the hour. When set to 1, looping is enabled, and when set to 0, looping is disabled. 
         * Looping occurs when an hour value is increased or decreased (between hourMin and hourMax). If a value is greater than hourMax, the value will immediately be changed to hourMin.
         * If a value is smaller than hourMin, the value will immediately be changed to hourMax. Requires hourMax value.
         */
        hourLoop: {
          type: Number,
          value: 1
        },

        /*
         * Amount to add or subtract when incrementing or decrementing an hour value.
         */
        hourStep: {
          type: Number,
          value: 1
        },    

        /*
         * Optional minimum allowed when a minute value is decreased. If a value is smaller than minuteMin, the value will immediately be changed to minuteMin.
         */
        minuteMin: {
          type: Number,
          value: 0
        },

        /*
         * Optional maximum allowed when a minute value is increased. If a value is greater than minuteMax, the value will immediately be changed to minuteMax.
         */
        minuteMax: {
          type: Number,
          value: 59
        },

        /*
         * Optional looping functionality for the minute. When set to 1, looping is enabled, and when set to 0, looping is disabled. 
         * Looping occurs when a minute value is increased or decreased (between minuteMin and minuteMax). If a value is greater than minuteMax, the value will immediately be changed to minuteMin.
         * If a value is smaller than minuteMin, the value will immediately be changed to minuteMax. Requires minuteMax value.
         */
        minuteLoop: {
          type: Number,
          value: 1
        },

        /*
         * Amount to add or subtract when incrementing or decrementing a minute value.
         */
        minuteStep: {
          type: Number,
          value: 1
        },    

        /*
         * Optional minimum allowed when a second value is decreased. If a value is smaller than secondMin, the value will immediately be changed to secondMin.
         */
        secondMin: {
          type: Number,
          value: 0
        },

        /*
         * Optional maximum allowed when a second value is increased. If a value is greater than secondMax, the value will immediately be changed to secondMax.
         */
        secondMax: {
          type: Number,
          value: 59
        },

        /*
         * Optional looping functionality for the second. When set to 1, looping is enabled, and when set to 0, looping is disabled. 
         * Looping occurs when a second value is increased or decreased (between secondMin and secondMax). If a value is greater than secondMax, the value will immediately be changed to secondMin.
         * If a value is smaller than secondMin, the value will immediately be changed to secondMax. Requires secondMax value.
         */
        secondLoop: {
          type: Number,
          value: 1
        },

        /*
         * Amount to add or subtract when incrementing or decrementing a second value.
         */
        secondStep: {
          type: Number,
          value: 1
        },    

        /*
         * Optional minimum allowed when a millisecond value is decreased. If a value is smaller than millisecondMin, the value will immediately be changed to millisecondMin.
         */
        millisecondMin: {
          type: Number,
          value: 0
        },

        /*
         * Optional maximum allowed when a millisecond value is increased. If a value is greater than millisecondMax, the value will immediately be changed to millisecondMax.
         */
        millisecondMax: {
          type: Number,
          value: 999
        },

        /*
         * Optional looping functionality for the millisecond. When set to 1, looping is enabled, and when set to 0, looping is disabled. 
         * Looping occurs when a millisecond value is increased or decreased (between millisecondMin and millisecondMax). If a value is greater than millisecondMax, the value will immediately be changed to millisecondMin.
         * If a value is smaller than millisecondMin, the value will immediately be changed to millisecondMax. Requires millisecondMax value.
         */
        millisecondLoop: {
          type: Number,
          value: 1
        },

        /*
         * Amount to add or subtract when incrementing or decrementing a millisecond value.
         */
        millisecondStep: {
          type: Number,
          value: 1
        }

      },

       /**
        * Return a formatted string duration to display (periods and values).
        * Only duration periods that have a value will be displayed.
        * Each duration period is followed by its period label (adjust to singular/plural).
        */
      formatDisplayedDuration: function (displayedDuration) {
        if(displayedDuration==null){
          return "";
        }

        var formatedValue = "";

        formatedValue = formatedValue + this.addDisplayedPeriod(displayedDuration.years, "Year");
        formatedValue = formatedValue + this.addDisplayedPeriod(displayedDuration.months, "Month");
        formatedValue = formatedValue + this.addDisplayedPeriod(displayedDuration.weeks, "Week");
        formatedValue = formatedValue + this.addDisplayedPeriod(displayedDuration.days, "Day");
        formatedValue = formatedValue + this.addDisplayedPeriod(displayedDuration.hours, "Hour");
        formatedValue = formatedValue + this.addDisplayedPeriod(displayedDuration.minutes, "Minute");
        formatedValue = formatedValue + this.addDisplayedPeriod(displayedDuration.seconds, "Second");
        formatedValue = formatedValue + this.addDisplayedPeriod(displayedDuration.milliseconds, "Millisecond");

        return formatedValue.trim();
      },

 
       /**
        * Return a string duration to display a given period.
        */
      addDisplayedPeriod: function (periodValue, period) {
        if(periodValue==null || period==null){
          return "";
        }

        var formatedValue = "";

        if(periodValue>0){
          var periodLabel = period;
          if(periodValue > 1){
            //get the plural translated value
            periodLabel = periodLabel + "s";
          }

          formatedValue = periodValue + " " + this.handleTranslation(periodLabel) + " ";
        }

        return formatedValue;
      },

      /**
        * Process the numeric duration value and return an object that contains the duration values.
        * Only duration values that are part of the duration displayToken are returned.
        */
      getDisplayedDuration: function (durationValue, displayTokens) {
        //Convert to absolute value;
        if(durationValue < 0) {
            durationValue = 0-durationValue;
        }

        var displayedDuration = {};
        displayedDuration.years;
        displayedDuration.months;
        displayedDuration.weeks;
        displayedDuration.days;
        displayedDuration.hours;
        displayedDuration.minutes;
        displayedDuration.seconds;
        displayedDuration.milliseconds;

          //Only calculate the Duartion Fields being displayed/visible.
        if (this.isDisplayYears(displayTokens) || this.isDisplayMonths(displayTokens)) {
            var tempval = Math.floor(durationValue/triPlatDuration.Multiplier.MONTH);  
            durationValue = durationValue%triPlatDuration.Multiplier.MONTH;
            if (this.isDisplayYears(displayTokens)) {
              displayedDuration.years = Math.floor(tempval/12);
            } else {
              displayedDuration.months = tempval;
            }
            if (this.isDisplayYears(displayTokens) && this.isDisplayMonths(displayTokens)) {
              displayedDuration.months = tempval%12;
            }
          } else {
            // Handle durationValue if months/years are no longer displayed on the duration field,
            // but were once populated. This modifies the duration value to a number usable by
            // weeks, days, hours, seconds, and milliseconds.
            durationValue = this.handleDurationValueForNonDisplayedMonths(durationValue);
          }
        if (this.isDisplayWeeks(displayTokens)) {
            displayedDuration.weeks = Math.floor(durationValue/triPlatDuration.Multiplier.WEEK);
            durationValue = durationValue%triPlatDuration.Multiplier.WEEK;
        }
        if (this.isDisplayDays(displayTokens)) {
            displayedDuration.days = Math.floor(durationValue/triPlatDuration.Multiplier.DAY);
            durationValue = durationValue%triPlatDuration.Multiplier.DAY;
        }
        if (this.isDisplayHours(displayTokens)) {
            displayedDuration.hours = Math.floor(durationValue/triPlatDuration.Multiplier.HOUR);
            durationValue = durationValue%triPlatDuration.Multiplier.HOUR;
        }
        if (this.isDisplayMinutes(displayTokens)) {
            displayedDuration.minutes = Math.floor(durationValue/triPlatDuration.Multiplier.MINUTE);
            durationValue = durationValue%triPlatDuration.Multiplier.MINUTE;
        }
        if (this.isDisplaySeconds(displayTokens)) {
          displayedDuration.seconds = Math.floor(durationValue/triPlatDuration.Multiplier.SECOND);
        }
        if (this.isDisplayMilliseconds(displayTokens)) {
          displayedDuration.milliseconds = durationValue%triPlatDuration.Multiplier.SECOND;
        }

      return displayedDuration;
    },

    /**
     * Return an adjusted duration value (if the month was removed).
     */
    handleDurationValueForNonDisplayedMonths:function(durationValue){
        var nonDisplayedMonths = Math.floor(durationValue/triPlatDuration.Multiplier.MONTH);
        var ONE_MONTH = 1;

          if ( nonDisplayedMonths >= ONE_MONTH) {
            durationValue = durationValue%triPlatDuration.Multiplier.MONTH + nonDisplayedMonths*triPlatDuration.Multiplier.MONTH_DAY;
          }
          return durationValue;
    },

    /**
      * Return a numeric calculated duration value for a given duration object.
      * This is the numeric value that can be saved.
      */
    calculateDurationValue: function(periods) {
        var durationValue = 0;
        if(periods==null) {
          return "";
        }

        //verify positive numeric values
        periods.year = (this.isNumericPositiveValue(periods.year))? Number(periods.year):0;
        periods.month = (this.isNumericPositiveValue(periods.month))? Number(periods.month):0;
        periods.week = (this.isNumericPositiveValue(periods.week))? Number(periods.week):0;
        periods.day = (this.isNumericPositiveValue(periods.day))? Number(periods.day):0;
        periods.hour = (this.isNumericPositiveValue(periods.hour))? Number(periods.hour):0;
        periods.minute = (this.isNumericPositiveValue(periods.minute))? Number(periods.minute):0;
        periods.second = (this.isNumericPositiveValue(periods.second))? Number(periods.second):0;
        periods.millisecond = (this.isNumericPositiveValue(periods.millisecond))? Number(periods.millisecond):0;

        //calculation formula base on Duration class
        durationValue = (triPlatDuration.Multiplier.MONTH * ((periods.year *12 ) + periods.month)) +
                  (periods.week * triPlatDuration.Multiplier.WEEK ) + (periods.day * triPlatDuration.Multiplier.DAY) +
                  (periods.hour * triPlatDuration.Multiplier.HOUR) + (periods.minute * triPlatDuration.Multiplier.MINUTE) +
                  (periods.second * triPlatDuration.Multiplier.SECOND) + periods.millisecond;

        return durationValue;
    },

    /*
     * Return true if the loop value is 1, and return false if it is 0. Otherwise, keep the default loop setting.
     */
    isLoop: function(loopValue) {
      if (loopValue != undefined && loopValue == 1) {
        return true;
      } else if (loopValue != undefined && loopValue == 0) {
        return false;
      }

      return;
     },

    /*
     * Return true if the value is numeric and positive. Otherwise, return false.
     */
    isNumericPositiveValue: function(value) {
      if(isNaN(value) || value==null || value<0) {
        return false;
      } else {
        return true;
      }
    },

    /**
      * Return true if the given display tokens include the symbol for the year. Otherwise, return false.
      */
    isDisplayYears:function(displayTokens){
      return (displayTokens!=null && displayTokens.indexOf(triPlatDuration.Symbol.YEAR)>-1)? true:false;
    },

    /**
      * Return true if the given display tokens include the symbol for the month. Otherwise, return false.
      */
    isDisplayMonths:function(displayTokens){
      return (displayTokens!=null && displayTokens.indexOf(triPlatDuration.Symbol.MONTH)>-1)? true:false;
    },

    /**
      * Return true if the given display tokens include the symbol for the week. Otherwise, return false.
      */
    isDisplayWeeks:function(displayTokens){
      return (displayTokens!=null && displayTokens.indexOf(triPlatDuration.Symbol.WEEK)>-1)? true:false;
    },

    /**
      * Return true if the given display tokens include the symbol for the day. Otherwise, return false.
      */
    isDisplayDays:function(displayTokens){
      return (displayTokens!=null && displayTokens.indexOf(triPlatDuration.Symbol.DAY)>-1)? true:false;
    },

    /**
      * Return true if the given display tokens include the symbol for the hour. Otherwise, return false.
      */
    isDisplayHours:function(displayTokens){
      return (displayTokens!=null && displayTokens.indexOf(triPlatDuration.Symbol.HOUR)>-1)? true:false;
    },

    /**
      * Return true if the given display tokens include the symbol for the minute. Otherwise, return false.
      */
    isDisplayMinutes:function(displayTokens){
      return (displayTokens!=null && displayTokens.indexOf(triPlatDuration.Symbol.MINUTE)>-1)? true:false;
    },

    /**
      * Return true if the given display tokens include the symbol for the second. Otherwise, return false.
      */
    isDisplaySeconds:function(displayTokens){
      return (displayTokens!=null && displayTokens.indexOf(triPlatDuration.Symbol.SECOND)>-1)? true:false;
    },

    /**
      * Return true if the given display tokens include the symbol for the millisecond. Otherwise, return false.
      */
    isDisplayMilliseconds:function(displayTokens){
      return (displayTokens!=null && displayTokens.indexOf(triPlatDuration.Symbol.MILLISECOND)>-1)? true:false;
    },

    /**
     * Return a translated period label.
     */
    handleTranslation: function(durationPeriod){
      //singular duration periods
    var __dictionary__y = "Year";
    var __dictionary__M = "Month";
    var __dictionary__w = "Week";
    var __dictionary__d = "Day";
    var __dictionary__h = "Hour";
    var __dictionary__m = "Minute";
    var __dictionary__s = "Second";
    var __dictionary__S = "Millisecond";

      //plural duration periods
    var __dictionary__yp = "Years";
    var __dictionary__Mp = "Months";
    var __dictionary__wp = "Weeks";
    var __dictionary__dp = "Days";
    var __dictionary__hp = "Hours";
    var __dictionary__mp = "Minutes";
    var __dictionary__sp = "Seconds";
    var __dictionary__Sp = "Milliseconds";

    if(durationPeriod ==="Year") return __dictionary__y;
    if(durationPeriod ==="Month") return __dictionary__M;
    if(durationPeriod ==="Week") return __dictionary__w;
    if(durationPeriod ==="Day") return __dictionary__d;
    if(durationPeriod ==="Hour") return __dictionary__h;
    if(durationPeriod ==="Minute") return __dictionary__m;
    if(durationPeriod ==="Second") return __dictionary__s;
    if(durationPeriod ==="Millisecond") return __dictionary__S;
    if(durationPeriod ==="Years") return __dictionary__yp;
    if(durationPeriod ==="Months") return __dictionary__Mp;
    if(durationPeriod ==="Weeks") return __dictionary__wp;
    if(durationPeriod ==="Days") return __dictionary__dp;
    if(durationPeriod ==="Hours") return __dictionary__hp;
    if(durationPeriod ==="Minutes") return __dictionary__mp;
    if(durationPeriod ==="Seconds") return __dictionary__sp;
    if(durationPeriod ==="Milliseconds") return __dictionary__Sp;
    }
   
  };

})();

</script><dom-module id="triplat-duration-period-counter" assetpath="../triplat-duration/">
	<template>
	<style include="iron-flex iron-flex-alignment">

	    paper-input {
	        text-align: center;
	     	width: 44px;
	     	padding-left: 4px;
	     	padding-right: 4px;
	    }

		.period-label{
			color: var(--ibm-gray-60);
		}
			
		paper-icon-button{
    		height: 44px;
    		width: 44px; 
    		padding: 6px;
    		color: var(--tri-actionable-color, --tri-primary-color);
    		background-color: var(--tri-actionable-color-contrast, white);
    		@apply(--triplat-duration-period-counter-icon); 
    	}

	</style>

   	<div class="layout vertical">
   		<span class="period-label">{{label}}</span>
   		<div class="layout horizontal center-center">
    		<paper-icon-button icon="ibm-glyphs:incremental-input-minus" on-tap="decreaseValue" aria-label$="[[decreaseAriaLabel]]" disabled$="[[_disableDecrementButton(loop, value)]]"></paper-icon-button>
    		<paper-input value="{{value}}" on-change="_handleEdit" allowed-pattern="[0-9]" prevent-invalid-input="" no-label-float="" readonly$="[[readonly]]">
    		</paper-input>
    		<paper-icon-button icon="ibm-glyphs:incremental-input-add" on-tap="increaseValue" aria-label$="[[increaseAriaLabel]]" disabled$="[[_disableIncrementButton(loop, value)]]"></paper-icon-button>
   		</div>
   	</div>
        
	</template>
</dom-module>
<script>

	Polymer({
		is: "triplat-duration-period-counter",


		properties: {

			/**
			 * Calculated numeric value for a duration field. 
			 */
	  		value: {
	  			type: Number,
	  			notify: true
	  		},


	  		/**
	  		  * String value to be used for the duration period label.
	  		  */
			label: {
				type: String,
			},

			/*
			 * String value to be used for the increase icon ARIA label.
			 */
			increaseAriaLabel: {
				type: String,
			},

			/*
			 * String value to be used for the decrease icon ARIA label.
			 */
			decreaseAriaLabel: {
				type: String,
			},

			/*
			 * Optional minimum allowed for a value when a value is decreased. If a value is smaller than min, the value will immediately be changed to min.
			 */
			min: {
				type: Number,
				value: 0
			},

			/*
			 * Optional maximum allowed for a value when a value is increased. If a value is greater than max, the value will immediately be changed to max.
			 */
			max: {
				type: Number
			},

			/*
			 * Optional loop when a value is increased or decreased (between min and max). If a value is greater than max, the value will immediately be changed to min.
			 * If a value is smaller than min, the value will immediately be changed to max. Requires max value.
			 */
			loop: {
				type: Boolean,
				value: false
			},

			/*
			 * Amount to add or subtract when incrementing or decrementing.
			 */
			step: {
				type: Number,
				value: 1
			}

		},

		_disableDecrementButton: function(loop, value) {
			if (loop) return false;

			var value = Number(value);
			if (isNaN(value)) return true;
			if (value <= Number(this.min)) return true;

			return false;
		},

		_disableIncrementButton: function(loop, value) {
			if (loop) return false;

			var value = Number(value);
			if (isNaN(value)) return true;
			if (value >= Number(this.max)) return true;

			return false;
		},
		
		/**
		  * Increase the value of a duration period by a given step.
		  * If max value is set, duration value cannot exceed it.
		  * If loop is set and duration value exceeds max, then set duration value to min.
		  */
		increaseValue: function(){
			this.value = Number(this.value) + Number(this.step);
			if(this.max != null) {
				if(this.loop){
					//loop value min to max
					this.value = (this.value > this.max ) ? Number(this.min) : this.value;
				} else {
					//value no bigger then max
					this.value = (this.value > this.max ) ? Number(this.max) : this.value;
				}
			}
		},

		/**
		  * Decrease the value of a duration period by a given step.
		  * Duration value cannot be smaller than min (or zero).
		  * If loop is set and duration value is smaller than min, then set duration value to max.
		  */
		decreaseValue: function(){
			this.value = Number(this.value) - Number(this.step);
			if(this.max != null && this.loop) {
				//loop value min to max
				this.value = (this.value < this.min || this.value > this.max) ? Number(this.max) : this.value;
			} else {
				//value no smaller then min
				this.value = (this.value < this.min ) ? Number(this.min) : this.value;
			}
		},

		_handleEdit: function(){
			var numberValue = parseInt(this.value);
			if(isNaN(numberValue)) {
				//value not a number, set value to the min
				this.value = this.min;
			} else {
				//Set typed value as numeric instead of string.
				//It also handle the case of value contains mix of letter and number, set to number value
				this.value = numberValue;
			}
		}	  	
	});
</script><dom-module id="triplat-duration-picker" assetpath="../triplat-duration/">
	<template>
	<style include="iron-flex iron-flex-alignment">
	    :host {
  		  	background-color: #fff;
  		  	border: 1px solid #ccc;
	      	padding-top: 20px;
	      	padding-bottom: 20px;
	      	overflow: auto;
	    }

	    .rtl-picker {
	    	padding-right: 20px;
	    	padding-left: 14px;
	    }

	    .ltr-picker {
	    	padding-right: 14px;
	    	padding-left: 20px;
	    }

		.periods {
		  	box-sizing: border-box;
			max-width: 100%;
			padding-top: 14px;
			padding-bottom: 24px;
			overflow: auto; 
			font-size: 14px;
			overflow: visible;
		}
		
		#cancelButton {
			height: 40px;
			background-color: white;
			color: var(--tri-primary-color);
			border: 1px solid var(--tri-primary-color);
			-moz-border-radius: 0px;
			-webkit-border-radius: 0px;
			border-radius: 0px;
			text-transform: none;
			--paper-button-flat-keyboard-focus: {
				border-width: 3px !important;
			};
			@apply(--triplat-duration-cancel-button);  
		}

		#doneButton {
			height: 40px;
			background-color: var(--tri-primary-color);
			color: white;
			-moz-border-radius: 0px;
			-webkit-border-radius: 0px;
			border-radius: 0px;
			text-transform: none;
			@apply(--triplat-duration-done-button);  
		}

		.ltr-done-button {
			margin-right: 10px;
		}
		
		.rtl-done-button {
			margin-left: 10px;
		}
		
		.header {
		  	margin: 0;
			font-size: 16px;
			font-weight: bold;
			letter-spacing: 0.02em;
			text-align: left;
			color: var(--ibm-gray-60);
		}

		paper-input {
		    text-align: center;
		  	width: 50px;
		   	margin-top: -2em;
		}

		paper-button:not([raised]).paper-button-0.keyboard-focus{
		    border-style: none;
		}

		.period-label{
			width: 80px;
		}
		
		triplat-duration-period-counter {
		    @apply(--layout-flex);
		}
			
	</style>

	<div id="picker">
		<div class="layout horizontal">
		    <div class="flex relative">
	        	<span class="header">Duration</span>
		    </div>
		</div>

		 <div class="periods layout vertical">

		    <div class="layout horizontal" hidden$="{{!isDisplayYears(displayTokens)}}">
		    	<triplat-duration-period-counter label="Years:" value="{{year}}" min$="[[yearMin]]" max$="[[yearMax]]" step$="[[yearStep]]" loop$="[[isLoop(yearLoop)]]" increase-aria-label="{{increaseYears}}" decrease-aria-label="{{decreaseYears}}" on-change="_handleEdit"></triplat-duration-period-counter>
		    </div>

		    <div class="layout horizontal" hidden$="{{!isDisplayMonths(displayTokens)}}">
		    	<triplat-duration-period-counter label="Months:" value="{{month}}" min$="[[monthMin]]" max$="[[monthMax]]" step$="[[monthStep]]" loop$="[[isLoop(monthLoop)]]" increase-aria-label="{{increaseMonths}}" decrease-aria-label="{{decreaseMonths}}" on-change="_handleEdit"></triplat-duration-period-counter>
		    </div>

		    <div class="layout horizontal" hidden$="{{!isDisplayWeeks(displayTokens)}}">
		    	<triplat-duration-period-counter label="Weeks:" value="{{week}}" min$="[[weekMin]]" max$="[[weekMax]]" step$="[[weekStep]]" loop$="[[isLoop(weekLoop)]]" increase-aria-label="{{increaseWeeks}}" decrease-aria-label="{{decreaseWeeks}}" on-change="_handleEdit"></triplat-duration-period-counter>
		    </div>

		    <div class="layout horizontal" hidden$="{{!isDisplayDays(displayTokens)}}">
		    	<triplat-duration-period-counter label="Days:" value="{{day}}" min$="[[dayMin]]" max$="[[dayMax]]" step$="[[dayStep]]" loop$="[[isLoop(dayLoop)]]" increase-aria-label="{{increaseDays}}" decrease-aria-label="{{decreaseDays}}" on-change="_handleEdit"></triplat-duration-period-counter>
		    </div>

		    <div class="layout horizontal" hidden$="{{!isDisplayHours(displayTokens)}}">
		    	<triplat-duration-period-counter label="Hours:" value="{{hour}}" min$="[[hourMin]]" max$="[[hourMax]]" step$="[[hourStep]]" loop$="[[isLoop(hourLoop)]]" increase-aria-label="{{increaseHours}}" decrease-aria-label="{{decreaseHours}}" on-change="_handleEdit"></triplat-duration-period-counter>
		    </div>

		    <div class="layout horizontal" hidden$="{{!isDisplayMinutes(displayTokens)}}">
		    	<triplat-duration-period-counter label="Minutes:" value="{{minute}}" min$="[[minuteMin]]" max$="[[minuteMax]]" step$="[[minuteStep]]" loop$="[[isLoop(minuteLoo)]]" increase-aria-label="{{increaseMinutes}}" decrease-aria-label="{{decreaseMinutes}}" on-change="_handleEdit"></triplat-duration-period-counter>
		    </div>

		   <div class="layout horizontal" hidden$="{{!isDisplaySeconds(displayTokens)}}">
		    	<triplat-duration-period-counter label="Seconds:" value="{{second}}" min$="[[secondMin]]" max$="[[secondMax]]" step$="[[secondStep]]" loop$="[[isLoop(secondLoop)]]" increase-aria-label="{{increaseSeconds}}" decrease-aria-label="{{decreaseSeconds}}" on-change="_handleEdit"></triplat-duration-period-counter>
		    </div>

		   <div class="layout horizontal" hidden$="{{!isDisplayMilliseconds(displayTokens)}}">
		    	<triplat-duration-period-counter label="Milliseconds:" value="{{millisecond}}" min$="[[millisecondMin]]" max$="[[millisecondMax]]" step$="[[millisecondStep]]" loop$="[[isLoop(millisecondLoop)]]" increase-aria-label="{{increaseMilliseconds}}" decrease-aria-label="{{decreaseMilliseconds}}" on-change="_handleEdit"></triplat-duration-period-counter>
		    </div>
		  </div>

          <div class="layout horizontal">
		   	<paper-button id="cancelButton" class="cancelButton" on-tap="_handleCancel" tabindex="0">Cancel</paper-button>
            <paper-button id="doneButton" class="doneButton" on-tap="_handleOk" tabindex="0" disabled$="{{invalidInput}}">Done</paper-button>
          </div>
	</div>
        
	</template>
</dom-module>
<script>

	Polymer({
		is: "triplat-duration-picker",

        behaviors: [Polymer.IronOverlayBehavior, Polymer.TriPlatDurationBehavior],

		properties: {
			/**
			 * Calculated numeric value for a duration field. 
			 */
	  		value: {
	  			type: Number,
	  			notify: true
	  		},
			/**
			 * String value to indicate which duration periods to display.
			 * Available duration periods are: <br>
			 * y - year <br>
			 * M - month <br>
			 * w - week <br>
			 * d - day <br>
			 * h - hour <br>
			 * m - minute <br>
			 * s - second <br>
			 * S - millisecond
			 */
	  		displayTokens: {
	  			type: String,
	  			notify: false,
	  			value: "y:M:w:d:h:m:s"
	  		},
			invalidInput: {
	  			type: Boolean,
	  			value: false
	  		},

			year:{
				type: Number,
				value: 0
			},
			month:{
				type: Number,
				value: 0
			},
			week:{
				type: Number,
				value: 0
			},
			day:{
				type: Number,
				value: 0
			},
			hour:{
				type: Number,
				value: 0
			},
			minute:{
				type: Number,
				value: 0
			},
			second:{
				type: Number,
				value: 0
			},
			millisecond:{
				type: Number,
				value: 0
			},


		},

		attached: function() {
			var textDirectionValue = document.querySelector('body').getAttribute('dir');
			if(textDirectionValue==="rtl"){
				this.$.picker.classList.add('rtl-picker');
				this.$.doneButton.classList.add('rtl-done-button');
			} else {
				this.$.picker.classList.add('ltr-picker');
				this.$.doneButton.classList.add('ltr-done-button');
			}
		},

        ready: function(){
        	//set translated values for aria-label periods counters buttons
		    var __dictionary__yi = "Increase Years";
		    var __dictionary__Mi = "Increase Months";
		    var __dictionary__wi = "Increase Weeks";
		    var __dictionary__di = "Increase Days";
		    var __dictionary__hi = "Increase Hours";
		    var __dictionary__mi = "Increase Minutes";
		    var __dictionary__si = "Increase Seconds";
		    var __dictionary__Si = "Increase Milliseconds";
		    var __dictionary__yd = "Decrease Years";
		    var __dictionary__Md = "Decrease Months";
		    var __dictionary__wd = "Decrease Weeks";
		    var __dictionary__dd = "Decrease Days";
		    var __dictionary__hd = "Decrease Hours";
		    var __dictionary__md = "Decrease Minutes";
		    var __dictionary__sd = "Decrease Seconds";
		    var __dictionary__Sd = "Decrease Milliseconds";

		    this.increaseYears = __dictionary__yi;
		    this.increaseMonths = __dictionary__Mi;
		    this.increaseWeeks = __dictionary__wi;
		    this.increaseDays = __dictionary__di;
		    this.increaseHours = __dictionary__hi;
		    this.increaseMinutes = __dictionary__mi;
		    this.increaseSeconds = __dictionary__si;
		    this.increaseMilliseconds = __dictionary__Si;
		    this.decreaseYears = __dictionary__yd;
		    this.decreaseMonths = __dictionary__Md;
		    this.decreaseWeeks = __dictionary__wd;
		    this.decreaseDays = __dictionary__dd;
		    this.decreaseHours = __dictionary__hd;
		    this.decreaseMinutes = __dictionary__md;
		    this.decreaseSeconds = __dictionary__sd;
		    this.decreaseMilliseconds = __dictionary__Sd;
        },

		/**
		  * Open the duration dialog and set the duration values.
		  * If duration values exist, the dialog displays the duration values. Otherwise, duration values are set to zero.
		  */
      	openPicker: function () {
      		//set picker periods values
	        this.invalidInput = false;
	        if(this.value == null) {
	        	//set periods to zero
	            this.year = 0;
	            this.month = 0;
	            this.week = 0;
	            this.day = 0;
	            this.hour = 0;
	            this.minute = 0;
	            this.second = 0;
	            this.millisecond = 0;
	        } else {
	        	//find the periods values for a given calculate duration value
	        	var displayedDuration = this.getDisplayedDuration(this.value, this.displayTokens);
		        this.year = (this.isNumericPositiveValue(displayedDuration.years))? displayedDuration.years:0;
		        this.month = (this.isNumericPositiveValue(displayedDuration.months))? displayedDuration.months:0;
		        this.week = (this.isNumericPositiveValue(displayedDuration.weeks))? displayedDuration.weeks:0;
		        this.day = (this.isNumericPositiveValue(displayedDuration.days))? displayedDuration.days:0;
		        this.hour = (this.isNumericPositiveValue(displayedDuration.hours))? displayedDuration.hours:0;
		        this.minute = (this.isNumericPositiveValue(displayedDuration.minutes))? displayedDuration.minutes:0;
		        this.second = (this.isNumericPositiveValue(displayedDuration.seconds))? displayedDuration.seconds:0;
		        this.millisecond = (this.isNumericPositiveValue(displayedDuration.milliseconds))? displayedDuration.milliseconds:0;
	        }

	        //display picker
	        this.open();
      	},

		_handleCancel: function() {
			//close picker (without changing the duration)
		 	this.close();
		 },

		_handleOk: function() {
			this._handleEdit();
			if(!this.invalidInput){
					var newPeriods = {};
					newPeriods.year = this.year;
				  	newPeriods.month = this.month;
				  	newPeriods.week = this.week;
				  	newPeriods.day = this.day;
				  	newPeriods.hour = this.hour; 
				  	newPeriods.minute = this.minute; 
				  	newPeriods.second = this.second;
				  	newPeriods.millisecond = this.millisecond;

				  	//calculate and set new duration value
					var newDurationValue = this.calculateDurationValue(newPeriods);
					this.set("value",newDurationValue);

					//close picker
					this.close();
			}
		},

		_handleEdit: function(e){
				//On field edit, verify duration periods are positive numeric values
				if(this.isNumericPositiveValue(this.year)
					&& this.isNumericPositiveValue(this.month)
					&& this.isNumericPositiveValue(this.week)
					&& this.isNumericPositiveValue(this.day)
					&& this.isNumericPositiveValue(this.hour)
					&& this.isNumericPositiveValue(this.minute)
					&& this.isNumericPositiveValue(this.second)
					&& this.isNumericPositiveValue(this.millisecond)
					) {
					//rollup periods value (if possible)
					this._rollup();
		  			this.invalidInput = false;
				} else {
					//Disable the OK button.
					//This should not happen as triplat-duration-period-counter force positive numeric value.
		  			this.invalidInput = true;
				}
		 },

		/**
		  * Optimizes and rollup periods values (if possible). 
		  * Does not rollup weeks to months, or days to months.
		  */
		_rollup: function(){
			//rolls up milliseconds to seconds
			if(this.millisecond > 999 && this.isDisplaySeconds(this.displayTokens)) {
				var divisor = Math.floor(this.millisecond/1000);
				var remainder = this.millisecond%1000;
				this.millisecond = remainder;
				this.second = Number(this.second) + divisor;
			}
			//rolls up seconds to minutes
			if(this.second > 59 && this.isDisplayMinutes(this.displayTokens)) {
				var divisor = Math.floor(this.second/60);
				var remainder = this.second%60;
				this.second = remainder;
				this.minute = Number(this.minute) + divisor;
			}
			//rolls up minutes to hours
			if(this.minute > 59 && this.isDisplayHours(this.displayTokens)) {
				var divisor = Math.floor(this.minute/60);
				var remainder = this.minute%60;
				this.minute = remainder;
				this.hour = Number(this.hour) + divisor;
			}
			//rolls up hours to days
			if(this.hour > 23 && this.isDisplayDays(this.displayTokens)) {
				var divisor = Math.floor(this.hour/24);
				var remainder = this.hour%24;
				this.hour = remainder;
				this.day = Number(this.day) + divisor;
			}
			//rolls up days to weeks
			if(this.day > 6 && this.isDisplayWeeks(this.displayTokens)) {
				var divisor = Math.floor(this.day/7);
				var remainder = this.day%7;
				this.day = remainder;
				this.week = Number(this.week) + divisor;
			}
			//rolls up months to years
			if(this.month > 11 && this.isDisplayYears(this.displayTokens)) {
				var divisor = Math.floor(this.month/12);
				var remainder = this.month%12;
				this.month = remainder;
				this.year = Number(this.year) + divisor;
			}
		}

		  	
	});
</script><dom-module id="triplat-duration" assetpath="../triplat-duration/">
	<style include="iron-flex iron-flex-alignment">
	
		.triplat-duration-div {
			@apply(--layout);
			@apply(--layout-horizontal);
			width: var(--triplat-duration-width, 100%);
		}

		paper-input-container {
			--paper-input-container-input: {
				color: inherit;
				font-size: inherit;
			};
		}
		:host[no-underline] paper-input-container {
			--paper-input-container-underline: {
				display: none;
			};
		}

		.clock-time-icon {
			padding: 0px;
			bottom: 2px;
			height: 24px;
			width: 24px;
			color: var(--tri-actionable-color, --tri-primary-color);
			background-color: var(--tri-actionable-color-contrast, white);
			cursor: pointer;
			@apply(--triplat-duration-clock-time-icon);
		}

		.__triplatDurationPicker {
			top: var(--triplat-duration-picker-position-top);
			left: var(--triplat-duration-picker-position-left);
			position: var(--triplat-duration-picker-position);
		}

	</style>
	<template>

		<iron-media-query query="max-width: 414px" query-matches="{{phone}}"></iron-media-query>

		<div class="triplat-duration-div">
			<paper-input-container class="flex" no-label-float="[[noLabelFloat]]">
				<label id="[[_labelId]]" for$="[[_inputId]]">[[label]]<content id="labelContent" select="[label]"></content></label>
				<input is="iron-input" readonly="" id="[[_inputId]]" aria-labelledby$="[[_labelId]]" bind-value="{{_displayValue(value)}}">
				<template is="dom-if" if="{{!readonly}}">
					<paper-icon-button suffix="" class="clock-time-icon" icon="ibm:clock-time" id="durationPickerButton" on-tap="_openDurationPicker" aria-label$="{{_setPickerAriaLabel(label)}}"></paper-icon-button>
				</template>

			</paper-input-container>
		</div>
		<triplat-duration-picker class="__triplatDurationPicker" id="durationPicker" display-tokens="{{displayTokens}}" value="{{value}}" year-min$="[[yearMin]]" year-max$="[[yearMax]]" year-step$="[[yearStep]]" year-loop$="[[yearLoop]]" month-min$="[[monthMin]]" month-max$="[[monthMax]]" month-step$="[[monthStep]]" month-loop$="[[monthLoop]]" week-min$="[[weekMin]]" week-max$="[[weekMax]]" week-step$="[[weekStep]]" week-loop$="[[weekLoop]]" day-min$="[[dayMin]]" day-max$="[[dayMax]]" day-step$="[[dayStep]]" day-loop$="[[dayLoop]]" hour-min$="[[hourMin]]" hour-max$="[[hourMax]]" hour-step$="[[hourStep]]" hour-loop$="[[hourLoop]]" minute-min$="[[minuteMin]]" minute-max$="[[minuteMax]]" minute-step$="[[minuteStep]]" minute-loop$="[[minuteLoop]]" second-min$="[[secondMin]]" second-max$="[[secondMax]]" second-step$="[[secondStep]]" second-loop$="[[secondLoop]]" millisecond-min$="[[millisecondMin]]" millisecond-max$="[[millisecondMax]]" millisecond-step$="[[millisecondStep]]" millisecond-loop$="[[millisecondLoop]]" restore-focus-on-close=""></triplat-duration-picker>
	</template>
</dom-module>
<script>

	Polymer({

		is: "triplat-duration",
		
		/**
	     * Fired after a duration value change.
	     *
	     * @event triplat-duration-change
	     */


		behaviors: [Polymer.TriPlatDurationBehavior,
			TriplatInputContainerBehavior],

	  	properties: {

			/**
			 * Calculated numeric value for a duration field. 
			 */
	  		value: {
	  			type: Number,
	  			notify: true,
	  			observer: "_valueChanged"
	  		},

	  		/**
	  		  * String value to be used for the duration label.
	  		  */
	  		label: {
	  			type: String,
	  			value: null
	  		},

			/**
			 * String value to indicate which duration periods to display.
			 * Available duration periods are: <br>
			 * y - year <br>
			 * M - month <br>
			 * w - week <br>
			 * d - day <br>
			 * h - hour <br>
			 * m - minute <br>
			 * s - second <br>
			 * S - millisecond
			 */
	  		displayTokens: {
	  			type: String,
	  			notify: false,
	  			value: "y:M:w:d:h:m:s"
	  		},

	  		/** 
	  		  * Boolean value to indicate that this is a read-only duration value. Show
	  		  * the value, but not the duration picker icon.
	  		  */
	  		readonly: {
	  			type: Boolean,
	  			value: false
	  		},

			/** 
			  * Set to true to disable the floating label.
			  */
			noLabelFloat: {
				type: Boolean,
				value: false
			},

			/** 
			  * Set to true to remove the underline.
			  */
			noUnderline: {
				type: Boolean,
				value: false,
				reflectToAttribute: true
			}

		},

	  	attached: function(){
	  		if(Polymer.dom(this.$$('#labelContent')).getDistributedNodes().length >0){
				this.label=" ";
			}
	  	},

	  	_openDurationPicker: function () {
	  		if(this.phone || this._isMobileDevice()){
            	this._openInMobileDevice(this.$.durationPicker);
        	}else{
            	this._openInNonMobileDevice(this.$.durationPicker, this.$$("#durationPickerButton"));
        	}

	  		this.$.durationPicker.openPicker();
		  	this._handleBrowserResize();
	  	},

	    _openInNonMobileDevice: function(durationPicker, durationPickerButton){
	        durationPicker.style.position = "fixed";
	        durationPicker.style.top = durationPickerButton.getBoundingClientRect().top+"px";
	        durationPicker.style.left = durationPickerButton.getBoundingClientRect().left+"px";
			
	        //Cannot compute the actual size of a hidden element. Calculate height base on the number of periods displayed.
	        var numOfPeriods = (durationPicker.displayTokens && durationPicker.displayTokens.length>0)? durationPicker.displayTokens.split(':').length:0;
	        var durationPickerHeight = 140 + numOfPeriods*60; //140 is dialog padding, title and buttons
	        var durationPickerWidth = 260;
	        
	        //position the dialog to the right of the picker button
	        var _top = durationPicker.style.top;
	        var _left= durationPicker.style.left;
	        var _position = durationPicker.style.position;
			
	        //check if there is enough space on the right side of the picker button to display the dialog
	        if (window.innerWidth - durationPickerButton.getBoundingClientRect().left < durationPickerWidth){
	            //display the dialog on the left side of the picker button
	        	var newWPosition = durationPickerButton.getBoundingClientRect().left - durationPickerWidth;
	        	if(newWPosition<0){
	        		newWPosition = 0;
	        	}
	            durationPicker.style.left = newWPosition + "px";
	            _left = durationPicker.style.left;
	        }
	        
	        //check if there is enough space below the picker button to display the dialog
	        if (window.innerHeight - durationPickerButton.getBoundingClientRect().top <= durationPickerHeight){
	            //display the dialog above the picker button
	            var newHPosition = durationPickerButton.getBoundingClientRect().top - durationPickerHeight;
	        	if(newHPosition<0){
	        		newHPosition = 0;
	        	}
	            durationPicker.style.top = newHPosition + "px";
	            _top = durationPicker.style.top;
	        }

	        this._handleTriplatDurationPickerPosition(_top, _left, _position);
	    },

	    _openInMobileDevice: function(durationPicker){
	    	//on small screen and mobile devices the dialog is displayed in the center
	        durationPicker.resetFit();
	        durationPicker.style.position = '';
	        durationPicker.style.top = '';
	        durationPicker.style.left = '';

	        var _top = durationPicker.style.top;
	        var _left= durationPicker.style.left;
	        var _position = durationPicker.style.position;
	        this._handleTriplatDurationPickerPosition(_top, _left, _position);
	    },

	    _handleTriplatDurationPickerPosition: function(_top, _left, _position){
	        this.customStyle['--triplat-duration-picker-position-top'] = _top + " !important";
	        this.customStyle['--triplat-duration-picker-position-left'] = _left + " !important";
	        this.customStyle['--triplat-duration-picker-position'] = _position + " !important";
	        this.updateStyles();
	    },

	    _isMobileDevice: function () {
	        if( navigator.userAgent.match(/Android/i)
	             || navigator.userAgent.match(/webOS/i)
	             || navigator.userAgent.match(/iPhone/i)
	             || navigator.userAgent.match(/iPad/i)
	             || navigator.userAgent.match(/iPod/i)
	             || navigator.userAgent.match(/BlackBerry/i)
	             || navigator.userAgent.match(/Windows Phone/i)
	        ){
	            return true;
	        }
	        else {
	            return false;
	        }
	    },
	  	
      	_displayValue: function (durationValue) {
        	if(durationValue == null) {
            	return "";
        	}

        	var displayedDuration = this.getDisplayedDuration(durationValue, this.displayTokens);
        	var formatDisplayedDuration = this.formatDisplayedDuration(displayedDuration);

        	return formatDisplayedDuration;
      	},

	  	_valueChanged:function(){
	  		this.fire("triplat-duration-change", {value: this.value});
	  	},

        _keyPressHandlerOpenDuration: function(event) {
        	var code = event.keyCode;
        	// accept enter or spacebar
        	if (code == 13 || code == 32) {
        		this.$.durationPicker.openPicker();
        	}
        },

	    /**
	      * Return a calculated end datetime for a given start datetime by adding the current duration periods.
	      */
	    getCalculatedEndDateTime: function(startDateTime) {
	      	if(this.value == null) {
	        	return startDateTime;
	      	}
	
	      	var displayedDuration = this.getDisplayedDuration(this.value, this.displayTokens);
	      	var endDateTime = new Date(startDateTime.getTime());
	
	      	//append each displayed duration period value to the date
	      	if(displayedDuration.years>0){
	        	endDateTime.setFullYear(endDateTime.getFullYear() + displayedDuration.years);
	      	}
	      	if(displayedDuration.months>0){
	        	endDateTime.setMonth(endDateTime.getMonth() + displayedDuration.months);
	      	}
	      	if(displayedDuration.weeks>0){
	        	endDateTime.setHours(endDateTime.getHours() + displayedDuration.weeks*7*24); //there is no d.setWeeks()
	      	}
	      	if(displayedDuration.days>0){
	        	endDateTime.setHours(endDateTime.getHours() + displayedDuration.days*24); //there is no d.setDays()
	      	}
	      	if(displayedDuration.hours>0){
	        	endDateTime.setHours(endDateTime.getHours() + displayedDuration.hours);
	      	}
	      	if(displayedDuration.minutes>0){
	        	endDateTime.setMinutes(endDateTime.getMinutes() + displayedDuration.minutes);
	      	}
	      	if(displayedDuration.seconds>0){
	        	endDateTime.setSeconds(endDateTime.getSeconds() + displayedDuration.seconds);
	      	}
	      	if(displayedDuration.milliseconds>0){
	        	endDateTime.setMilliseconds(endDateTime.getMilliseconds() + displayedDuration.milliseconds);
	      	}
	
	      	return endDateTime;
	    },

	  	_setPickerAriaLabel: function(val){
        	if (!val) {
           	return "";
        	}

			return "Select " + val;
	    },

		_handleBrowserResize: function(){
			var self = this;
			window.onresize = function(){
				self._openInMobileDevice(self.$$("#durationPicker"));
			} 
		}

	});
</script>

<script>
	/**
	 * Behavior for components that require the web context ID.
	 * 
	 * @polymerBehavior
	 */
	Polymer.TriplatRequiresWebContextIdBehavior = {

		properties: {

			/**
			 * The web context ID for communicating with the server.
			 */
			webContextId: {
				type: String,
				notify: true,
				observer: "_webContextIdChanged"
			},

			/**
			 * Set this property to prevent the web context ID from being looked up with the 
			 * element is attached.
			 */
			preventWebContextIdLookupOnAttach: {
				type: Boolean,
				value: false
			}

		},

		/**
	     * Fired when the webContextId is changed. The detail of the even contains the webContextId.
	     *
	     * @event triplat-web-context-id-changed
	     */

		listeners: {
			"triplat-ds-web-context-id-parent-found": "_foundWebContextIdParent"
		},

		attached: function() {
			if (this.preventWebContextIdLookupOnAttach) {
				return;
			}

			this.lookupWebContextId();
		},

		/**
		 * Looks up the web context ID and set it to the webContextId property.
		 */
		lookupWebContextId: function() {
			this.fire("triplat-ds-web-context-id-search", {sourceElement: this});
		},

		_foundWebContextIdParent: function(e) {
			var parentEl = e.detail;
			parentEl.getWebContextId().then(function(webContextId) {
				this.set("webContextId", webContextId);
			}.bind(this));
		},

		_webContextIdChanged: function(webContextId) {
			this.fire("triplat-web-context-id-changed", webContextId);
		}

	};
</script><script>

	Polymer({

		is: "triplat-availability-layout",

		/**
	     * Fired when the layout properties change.
	     *
	     * @event triplat-availability-layout-change
	     */

		properties: {

			/**
			 * The maximum view mode available for the availability component.
			 */ 
			maxViewMode: {
				type: String,
				notify: false,
				readOnly: false
			},
			
			/**
			 * The default view mode for the availability component.
			 */ 
			defaultViewMode: {
				type: String,
				notify: false,
				readOnly: false
			},

			/**
			 * Whether the single selection is enabled.
			 * Because the multiple selection is not yet supported, the default
			 * value of this property is true.
			 */
			singleSelect: {
				type: Boolean,
				notify: false,
				readOnly: false,
				value: true // Only single selection for this release
			},

			/**
			 * The columns that are displayed for each resource in the availability
			 * component. It is an object that must be formatted as follows: <br/>
			 * 
			 * var columns = {
			 *		room: "Room Name",
			 *		floor: "Floor number",
			 *		capacity: "Max capacity"
			 * };
			 *
			 * <b>room</b>, <b>floor</b> and <b>capacity</b> are 
			 * the data source fields.
			 * <b>"Room Name"</b>, <b>"Floor number"</b> and <b>"Max capacity"</b> 
			 * represent how these fields (columns) will be displayed.
			 */
			columns: {
				type: Object,
				notify: false,
				readOnly: false
			},

			/**
			 * Whether there is only the Home button in the toolbar.
			 */
			homeOnlyToolbar: {
				type: Boolean,
				value: false
			},

			/**
			 * An internal representation of the view.
			 */
			_layout: {
				type: Object,
				notify: true,
				readOnly: true,
				observer: "_layoutChanged"
			},

		},

		observers: [
			"_init(maxViewMode, defaultViewMode, singleSelect, columns, homeOnlyToolbar)"
		],

		_init: function(maxViewMode, defaultViewMode, singleSelect, columns, homeOnlyToolbar) {
			this._set_layout({maxViewMode: maxViewMode, 
				defaultViewMode: defaultViewMode, 
				singleSelect: singleSelect, columns: columns,
				homeOnlyToolbar: homeOnlyToolbar});
		},

		_layoutChanged: function(layout) {
			this.fire("triplat-availability-layout-change", layout);
		}

	});
</script>
<script>

	Polymer({

		is: "triplat-availability-data-context",

		/**
	  	* Fired when the data context properties change.
	    *
	    * @event triplat-availability-data-context-change
	  */

		properties: {

			/**
			 * The name of the context data source.
			 */
			name: {
				type: String,
				notify: false,
				readOnly: false
			},
			
			/**
			 * The context ID.
			 */
			contextId: {
				type: String,
				notify: false,
				readOnly: false
			},

			/**
			 * An internal representation of the context.
			 */
			_context: {
				type: Object,
				notify: true,
				readOnly: true,
				observer: "_contextChanged"
			},

		},

		observers: [
			"_init(name, contextId)"
		],

		_init: function(name, contextId) {
			if(!contextId){
				return
			}
			this._set_context({name: name, contextId: contextId});
		},

		_contextChanged: function(context) {
			this.fire("triplat-availability-data-context-change", context);
		}

	});
</script><dom-module id="triplat-availability-data" assetpath="../triplat-availability/">

	<template>

		<style></style>
		<content select="triplat-availability-data-context"></content>

	</template>

</dom-module>

<script>

	Polymer({

		is: "triplat-availability-data",

		/**
	  	* Fired when the data properties change.
	    *
	    * @event triplat-availability-data-change
	  */

	  listeners: {
	  	'triplat-availability-data-context-change': '_contextChanged'
	  },

		properties: {

			/**
			 * The name of the data source from which the
			 * resources are retrieved.
			 */ 
			datasource: {
				type: String,
				notify: false,
				readOnly: false
			},
			
			/**
			* Whether the unavailable time for each resource is
			* retrieved.
			*/
			includeUnavailable: {
				type: Boolean,
				value: false
			},

			/**
			* The calendar set name to which the resources
			* are associated.
			*/
			calendarSetName:{
				type: String
			},

			/**
			 * An internal representation of the data.
			 */
			_data: {
				type: Object,
				notify: true,
				readOnly: true,
				observer: "_dataChanged"
			},

			_contexts: {
				type: Array,
				notify: false,
				readOnly: false,
				value: []
			},

			_contextChildren: {
				type: Number,
				readOnly: true
			}
		},

		observers: [
			'_init(datasource, includeUnavailable, calendarSetName, _contexts.splices, _contextChildren)'
		],

		attached: function(){
			var contextChildren = this.queryAllEffectiveChildren('triplat-availability-data-context').length;
			this._set_contextChildren(contextChildren);
		},

		_init: function(datasource, includeUnavailable, calendarSetName, splices, contextChildren) {
			if(!(this._contexts.length == this._contextChildren)){
				return;
			}
			this._set_data({datasource: datasource, includeUnavailable: includeUnavailable, calendarSetName: calendarSetName,
				contexts: this._contexts});
		},

		_dataChanged: function(data) {
			this.fire("triplat-availability-data-change", data);
		},

		_contextChanged: function(e){
			this.push("_contexts", e.detail);
		}

	});
</script><style>
/* Should override this style for the treegrid links */
a {
	color: #000000!important;
}

.TUXGanttLineTimeSelector {
	background-color: #00B4A0;
	opacity:0.4;
	width:1px;
}


.TUXGanttLineTimeBorder {
	background-color:#00665B;
	width:1px;
}

.TUXGanttBackUnavailable {
	background-color:#ECECEC;
}

.TUXGanttTentativeIn {
	background-color:#AEAEAE;
}

.TUXGanttTentativeOut {
	border-color:#AEAEAE;
}

.TUXGanttSimpleIn {
	background-color:#AEAEAE;
}

.TUXGanttSimpleOut {
	border-color:#AEAEAE;
}

.TUXGanttSeriesIn {
	background-color:#AEAEAE;
}

.TUXGanttSeriesOut {
	border-color:#AEAEAE;
}

.TUXGanttExceptionIn {
	background-color:#AEAEAE;
}

.TUXGanttExceptionOut {
	border-color:#AEAEAE;
}

.TUXGanttMark90 {
	background-color:#D6CA42;
	margin-top:4px!important; 
	height:21px!important; 
	margin-bottom:-25px!important;
}

.TUXGanttMark80 {
	background-color:#D6CA42;
	margin-top:25px!important; 
	height:21px!important; 
	margin-bottom:-46px!important;
}
</style><dom-module id="triplat-availability" assetpath="../triplat-availability/">
	<template>

		<style>
			:host {
				@apply(--layout-vertical);
			}

			#treeGridContainer {
				@apply(--layout-flex);
			}
		</style>

		<tricore-url id="treeGridUrl" hidden="" raw-url="/html/en/default/js/lib/TreeGrid/Grid/GridE.js">
		</tricore-url>

		<tricore-url hidden="" raw-url="/p/availability/layout" bind-url="{{_layoutUrl}}">
		</tricore-url>

		<tricore-url hidden="" raw-url="/p/availability/data" bind-url="{{_dataUrl}}">
		</tricore-url>

		<tricore-url hidden="" raw-url="/p/availability/text" bind-url="{{_textUrl}}">
		</tricore-url>

		<div id="treeGridContainer" hidden$="[[loading]]">
		</div>

		<content select="triplat-availability-layout"></content>
		<content select="triplat-availability-data"></content>

	</template>

</dom-module>

<script>

	function ScrollToNext(){
		Grids.triplatElement.nextOccurrence();
	}

	function ScrollToPrevious() {
		Grids.triplatElement.previousOccurrence();
	}

	function ScrollToHome() {
		Grids.triplatElement.scrollToHome();
	}

	function NextDisabled() {
		return !Grids.triplatElement.hasNextOccurrence();
	}

	function PreviousDisabled() {
		return !Grids.triplatElement.hasPreviousOccurrence();
	}
	
	function HandleResourceLink(resourceId) {
		if(resourceId != null){
			Grids.triplatElement.fire("resource-click", {resourceId: resourceId});
		}
	}

	function TRIGanttdependencyerrors() {
		// not used but prevents exception in TextXML processing because TextXML is shared with Gantt
		return "";	
	}

	Polymer({

		is: "triplat-availability",

		/**
	  * Fired when the maximum number of rows to be
	  * displayed is reached.
	  * The row limit can be set
	  * by changing the AVAILABILITY_SECTION_ROW_LIMIT
	  * in TRIRIGAWEB.properties.
	  *
	  * @event row-limit
	  */

	  /**
	  * Fired every time the user clicks
	  * a resource detail.
	  *
	  * @event resource-click
	  */

		properties: {

			/**
			 * An array containing the resources 
			 * that are selected through this component.
			 */
			selected: {
				type: Array,
				value: [],
				notify: true
			},

			/**
			 * A flag that can notify the user when this 
			 * component is requesting data from the server.
			 */
			loading: {
				type: Boolean,
				value: false,
				notify: true,
				readOnly: true
			},

			/**
			 * If this property is set, the availability component will display only the resources that are contained in this array.
			 */
			visibleResources: {
				type: Array
			},

			_layout: {
				type: Object,
				readOnly: true,
			},

			_data: {
				type: Object,
				readOnly: true,
			},

			_modelAndView: {
				type: String,
				readOnly: true
			},

			_instanceId: {
				type: String,
				readOnly: true
			},

			_layoutAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_dataAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_textAjax: {
				type: Object,
				notify: false,
				readOnly: true
			},

			_layoutRequestBody: {
				type: Object,
				readOnly: true
			},

			_dataRequestBody: {
				type: Object,
				readOnly: true
			},

			_refresh: {
				type: Boolean,
				readOnly: true
			},

			_layoutLoaded: {
				type: Boolean,
				readOnly: true
			},

			_dataLoaded: {
				type: Boolean,
				readOnly: true
			},

			_textLoaded: {
				type: Boolean,
				readOnly: true
			},

			_dataXml: {
				type: String,
				notify: false,
				readOnly: true,
			},

			_layoutXml: {
				type: String,
				notify: false,
				readOnly: true,
			},

			_textXml: {
				type: String,
				notify: false,
				readOnly: true,
			},
			
			_warningMessage:{
				type: String,
				computed: '_computeWarningMessage(_rowLimit)'
			},

			_dateRangeStart: {
				type: Number,
				value: 0
			},

			_dateRangeEnd: {
				type: Number,
				value: 0
			},

			_occurrenceCount: {
				type: Number,
				value: 0
			},

			_currentOccurrence: {
				type: Number,
				value: 0
			},
			
			_treeGridLoaded: {
				type: Boolean,
				value: false
			},
			
			_treeGridLoading: {
				type: Boolean,
				value: false
			}
		},

		behaviors: [Polymer.TriplatRequiresWebContextIdBehavior],

		observers: [
			'_buildLayoutRequestBody(_modelAndView, _instanceId, _data, _layout)',
			'_buildDataRequestBody(_modelAndView, _instanceId, _data, _layout)',
			'_triggerAvailabilityRequests(_layoutRequestBody, _dataRequestBody, _refresh, _treeGridLoaded)',
			'_handleLoading(_layoutLoaded, _dataLoaded, _textLoaded)',
			'_handleVisibleResourcesChange(visibleResources.*)'
		],

		listeners: {
			'triplat-availability-layout-change': '_layoutChanged',
			'triplat-availability-data-change': '_dataChanged'
		},

		attached: function(){
			var node = this;
			var container = null;
			while (node) {
				node = Polymer.dom(node).parentNode;
				if (node && node.nodeType !== Node.ELEMENT_NODE) {
					node = node.host;
				}
				if (node && node.isTriplatDsContainer === true) {
					container = node;
					break;
				}
			}

			if (!container) {
				console.warn("No view container found.");
				console.warn(this);
				return;
			}
			this._set_modelAndView(container.modelAndView);
			this._set_instanceId(container.instanceId);
		},
		
		_loadTreeGridLib: function() {
			if (window.Grids === undefined && !this._treeGridLoaded && !this._treeGridLoading) {
				this._treeGridLoading = true;
				var treegridLib = document.createElement('script');
				treegridLib.addEventListener("load", this._handleTreeGridLibLoaded.bind(this))
				treegridLib.setAttribute('src', this.$.treeGridUrl.bindUrl);
				document.body.appendChild(treegridLib);
			}
		},
		
		_handleTreeGridLibLoaded: function() {
			this._treeGridLoading = false;
			this._treeGridLoaded = true;
		},

		/**
		 * Refreshes the component.
		 */
		refresh: function() {
			this._loadTreeGridLib();
			this._dateRangeStart = 0;
			this._dateRangeEnd = 0;
			this._occurrenceCount = 0;
			this._currentOccurrence = 0;
			this._set_refresh(true);
		},

		/**
		 * Scrolls to the initial date range.
		 */
		scrollToHome: function() {
			this._scrollToOccurrence(0);
		},

		/**
		 * Scrolls to the current occurrence of 
		 * a recurring meeting.
		 */
		scrollToCurrentOccurrence: function() {
			this._scrollToOccurrence(this._currentOccurrence);
		},

		/**
		 * Scrolls to the next occurrence of 
		 * a recurring meeting.
		 */
		nextOccurrence: function() {
			if (this._currentOccurrence < (this._occurrenceCount - 1)) {
				this._scrollToOccurrence(this._currentOccurrence + 1);
			}
		},

		/**
		 * Scrolls to the previous occurrence of 
		 * a recurring meeting.
		 */
		previousOccurrence: function() {
			if (this._currentOccurrence  > 0) {
				this._scrollToOccurrence(this._currentOccurrence - 1);
			}
		},

		_scrollToOccurrence: function(occurrence) {
			var grid = this._getDefaultGrid();
			var index = occurrence * 3;
			var line = grid.GetGanttLine(index);
			if (line != null && line[0] > 0) {
				this._currentOccurrence = occurrence;
				this._recalculateRecurrenceButtons();
				if (line[0] < this._dateRangeStart || line[1] > this._dateRangeEnd) {
					this.async(this._getDataForOccurrence.bind(this, line[0], line[1]));
				} else {
					grid.ScrollToDate(line[0]);
				}
			}
		},

		/**
		 * Whether there is a next occurrence for a 
		 * recurring meeting.
		 * @return {Boolean}
		 */
		hasNextOccurrence: function() {
			return this._currentOccurrence < (this._occurrenceCount - 1);
		},

		/**
		 * Whether there is a previous occurrence for a 
		 * recurring meeting.
		 * @return {Boolean}
		 */
		hasPreviousOccurrence: function() {
			return this._currentOccurrence > 0;
		},

		_layoutChanged: function(e){
			e.stopPropagation();
			this._set_layout(e.detail);
		},

		_dataChanged: function(e){
			e.stopPropagation();
			this._set_data(e.detail);
		},

		_buildLayoutRequestBody: function(modelAndView, instanceId, data, layout){
			var requestBody = {
				layout: layout,
				modelAndView: modelAndView,
				instanceId: instanceId,
				data: data
			};
			this._set_layoutRequestBody(requestBody);
		},

		_buildDataRequestBody: function(modelAndView, instanceId, data, layout){
			var requestBody = {
				modelAndView: modelAndView,
				instanceId: instanceId,
				data: data,
				columns: layout.columns,
				singleSelect: layout.singleSelect,
				defaultViewMode: layout.defaultViewMode
			};
			this._set_dataRequestBody(requestBody);
		},

		_triggerAvailabilityRequests: function(layoutRequestBody, dataRequestBody, refresh, treeGridLoaded){

			if(refresh) {
				this._setLoading(true);
				
				if (!treeGridLoaded) {
					return;
				}
				
				this._createLayoutRequest(layoutRequestBody).then(
					function(response){
						this._set_layoutXml(response);
						this._set_layoutLoaded(true);
					}.bind(this) 
				);

				this._createDataRequest(dataRequestBody).then(
					function(response){
						this._set_dataXml(response);
						this._set_dataLoaded(true);
					}.bind(this)
				);

				this._createTextRequest().then(
					function(response){
						this._set_textXml(response);
						this._set_textLoaded(true);
					}.bind(this)
				);

				this._set_refresh(false);
			}
		},

		_getDataForOccurrence: function(occurrenceStart, occurrenceEnd) {
			var dataRequestBody = Object.assign({}, this._dataRequestBody);
			dataRequestBody.occurrenceStart = occurrenceStart;
			dataRequestBody.occurrenceEnd = occurrenceEnd;
			var layoutRequestBody = Object.assign({}, this._layoutRequestBody);
			layoutRequestBody.occurrenceStart = occurrenceStart;
			layoutRequestBody.occurrenceEnd = occurrenceEnd;
			this._triggerAvailabilityRequests(layoutRequestBody, dataRequestBody, true, this._treeGridLoaded);
		},

		_createLayoutRequest: function(requestBody){
			return new Promise(function(resolve, reject) {
				this._doLayoutRequest(requestBody, resolve, reject);
			}.bind(this));
		},

		_createDataRequest: function(requestBody){
			return new Promise(function(resolve, reject) {
				this._doDataRequest(requestBody, resolve, reject);
			}.bind(this));
		},

		_createTextRequest: function(){
			return new Promise(function(resolve, reject) {
				this._doTextRequest(resolve, reject);
			}.bind(this));
		},

		_doLayoutRequest: function(requestBody, resolve, reject){
			var layoutAjax = this._layoutAjax;
			if (!layoutAjax) {
				layoutAjax = document.createElement("iron-ajax");
				layoutAjax.url = this._layoutUrl;
				layoutAjax.addEventListener("response", 
					this._handleLayoutResponse.bind(this));
				layoutAjax.addEventListener("error", 
					this._onError.bind(this, "_onLayoutRequestError"));
				layoutAjax.method = "POST";
				layoutAjax.contentType = 'application/json';
				layoutAjax.handleAs = 'text';
				this._set_layoutAjax(layoutAjax);
			}

			layoutAjax.body = JSON.stringify(requestBody);
			var request = layoutAjax.generateRequest();
			request._promiseResolve = resolve;
			request._promiseReject = reject;
		},

		_handleLayoutResponse: function(e) {
			var response = e.detail.response;
			e.detail._promiseResolve(response);
		},

		_doDataRequest: function(requestBody, resolve, reject){
			var dataAjax = this._dataAjax;
			if (!dataAjax) {
				dataAjax = document.createElement("iron-ajax");
				dataAjax.url = this._dataUrl;
				dataAjax.addEventListener("response", 
					this._handleDataResponse.bind(this));
				dataAjax.addEventListener("error", 
					this._onError.bind(this, "_onDataRequestError"));
				dataAjax.method = "POST";
				dataAjax.contentType = 'application/json';
				dataAjax.handleAs = 'text';
				this._set_dataAjax(dataAjax);
			}

			var headers = { "triWebContextId": this.webContextId };
			dataAjax.headers = headers;
			dataAjax.body = JSON.stringify(requestBody);
			var request = dataAjax.generateRequest();
			request._promiseResolve = resolve;
			request._promiseReject = reject;
		},

		_handleDataResponse: function(e) {
			var response = e.detail.response;
			var xhr = e.detail.xhr;
			var rowLimit = xhr.getResponseHeader("Tri-Availability-Row-Limit");
			if(rowLimit){
				this._rowLimit = rowLimit;
				this.async(function(){
					this.fire("row-limit", this._warningMessage);
				});
			}
			this._dateRangeStart = Number(xhr.getResponseHeader("Tri-Availability-Date-Range-Start"));
			this._dateRangeEnd = Number(xhr.getResponseHeader("Tri-Availability-Date-Range-End"));
			e.detail._promiseResolve(response);
		},

		_doTextRequest: function(resolve, reject){
			var textAjax = this._textAjax;
			if (!textAjax) {
				textAjax = document.createElement("iron-ajax");
				textAjax.url = this._textUrl;
				textAjax.addEventListener("response", 
					this._handleTextResponse.bind(this));
				textAjax.addEventListener("error", 
					this._onError.bind(this, "_onTextRequestError"));
				textAjax.method = "GET";
				textAjax.handleAs = 'text';
				this._set_textAjax(textAjax);
			}
			var request = textAjax.generateRequest();
			request._promiseResolve = resolve;
			request._promiseReject = reject;
		},

		_handleTextResponse: function(e) {
			var response = e.detail.response;
			e.detail._promiseResolve(response);
		},

		_onError: function(functionName, e) {
			console.log("fName: "+functionName+"  e: "+e);
		},

		_handleLoading: function(layoutLoaded, dataLoaded, textLoaded){
			this.async(function(){
				if(layoutLoaded && dataLoaded && textLoaded){
					this._set_layoutLoaded(false);
					this._set_dataLoaded(false);
					this._set_textLoaded(false);
					this._buildTreeGrid(this._layoutXml, this._dataXml, this._textXml);
				}
			}, 1000)
		},

		_buildTreeGrid: function(layoutXml, dataXml, textXml){
			var grid = this._getDefaultGrid();
			if(grid){
				grid.Source.Layout.Data = layoutXml;
				grid.Source.Data.Data = dataXml;
				if(textXml.length > 0){
					grid.Source.Text.Data = textXml;
				}
				grid.Reload();
			} else {
				this.async(function(){
					Grids.triplatElement = this;
					
					var treeGridProps = {};
					treeGridProps.Layout = { Data: layoutXml };
					treeGridProps.Data = { Data: dataXml };
					if(textXml.length > 0){
						treeGridProps.Text = { Data: textXml };
					}
					treeGridProps.Debug = "";
					TreeGrid(treeGridProps, "treeGridContainer");

					Grids.OnLoadCfg = function(grid, cfg) {
						return true;
					}

					Grids.OnLinkClick = function(grid, row, col, url, target) {
						if(row && row.id){
							this.fire("resource-click", {resourceId: row.id});
						}
						return true;
					}.bind(this);

					Grids.OnRenderStart = function(grid) {
						//This will hide the "EJS TreeGrid 12.0" link...
						grid.Toolbar.EmptyVisible = 0;
						this.set("selected", []);
					}.bind(this);

					Grids.OnRenderFinish = this._handleGridRenderFinish.bind(this);

					/* When clicking/dragging on Gantt headers, we don't
					 * want to do anything. Returning true will tell
					 * tree grid to do nothing .
					 */
					var doNothing = function(){
						return true;
					}
					Grids.OnClickGanttHeader = doNothing;
					Grids.OnRightClickGanttHeader = doNothing;
					Grids.OnDragGanttHeader = doNothing;
					Grids.OnDrag2GanttHeader = doNothing;

					Grids.OnValueChanged = function(grid, row, col, val, oldval, errors) {
						if (row && row.id && row.id > 0 && col == 'SELECT') {
							var selection = (val == 1 ? true : false);
							var resourceId = row.id;
						}
						return val;
					}

					Grids.OnSelect = function(grid, row, deselect, cols) {
						if(row && row.id){
							//TODO: Multi Select - BUG
							if(!deselect){
								this.push("selected", row.id);
							} else {
								this.shift("selected");
							}
						}
					}.bind(this);
				}, 1000);
			}
		},

		_handleGridRenderFinish: function(grid) {
			this._filterVisibleResources(grid);
			this._setLoading(false);
			this._computeOccurenceCount();
			this.async(this.scrollToCurrentOccurrence, 300);
		},

		_filterVisibleResources: function(grid) {
			if (grid != null) {
				if (this.visibleResources != null) {
					for (var rowId in grid.Rows) {
						var row = grid.Rows[rowId];
						if (row.Kind == "Data") {
							grid.HideRow(row);
						}
					}
					for (var index = 0; index < this.visibleResources.length; index++) {
						var available = this.visibleResources[index];
						var row = grid.Rows[available._id];
						if (row != null) {
							grid.ShowRow(row);
						}
					}
				} else {
					for (var rowId in grid.Rows) {
						var row = grid.Rows[rowId];
						if (row.Kind == "Data") {
							grid.ShowRow(row);
						}
					}
				}
			}
		},

		_handleVisibleResourcesChange: function(visibleResources) {
			var grid = this._getDefaultGrid();
			if (grid == null) {
				return;
			}
			if (visibleResources.path == "visibleResources") {
				this._filterVisibleResources(grid);
			} else if (visibleResources.path == "visibleResources.splices") {
				var indexSplice = visibleResources.value.indexSplices[0];
				indexSplice.removed.forEach(
					function(removed) {
						var row = this._grid.Rows[removed._id];
						if (row != null) {
							this._grid.HideRow(row);
						}
					}, 
					this
				);
				for (var i = 0; i < indexSplice.addedCount; i++) {
					var added = indexSplice.object[indexSplice.index + i];
					var row = this._grid.Rows[added._id];
					if (row != null) {
						this._grid.ShowRow(row);
					}
				}
			}
		},

		_getDefaultGrid: function() {
			return window.Grids != null ? window.Grids["IbmTririgaAvailability"] : null;
		},

		_computeWarningMessage: function(rowLimit){
			var __dictionary__warningMsg = "The number of rows to be shown in availability exceeds the maximum allowable of ${rowLimit}. Additional rows will not be rendered.";
			var _temp = __dictionary__warningMsg.replace("${rowLimit}", rowLimit);
			__dictionary__warningMsg = _temp;
			return __dictionary__warningMsg;
		},

		_computeOccurenceCount: function() {
			var grid = this._getDefaultGrid();
			var index = 0;
			var occurrenceCount = 0;
			var line = grid.GetGanttLine(index);
			while (line != null &&  line[0] > 0) {
				++occurrenceCount;
				index = index + 3;
				line = grid.GetGanttLine(index);
			}
			this._occurrenceCount = occurrenceCount;
		},

		_recalculateRecurrenceButtons: function() {
			if (this._occurrenceCount > 1) {
				var grid = this._getDefaultGrid();
				grid.Recalculate(grid.Toolbar, 'Next');
				grid.Recalculate(grid.Toolbar, 'Previous');
				grid.RefreshRow(grid.Toolbar);
			}
		}
	});
</script>


<iron-iconset-svg name="paper-tabs" size="24">
<svg><defs>
<g id="chevron-left"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></g>
<g id="chevron-right"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></g>
</defs></svg>
</iron-iconset-svg>


<dom-module id="paper-tab" assetpath="../paper-tabs/">
  <template>
    <style>
      :host {
        @apply(--layout-inline);
        @apply(--layout-center);
        @apply(--layout-center-justified);
        @apply(--layout-flex-auto);

        position: relative;
        padding: 0 12px;
        overflow: hidden;
        cursor: pointer;
        vertical-align: middle;

        @apply(--paper-font-common-base);
        @apply(--paper-tab);
      }

      :host(:focus) {
        outline: none;
      }

      :host([link]) {
        padding: 0;
      }

      .tab-content {
        height: 100%;
        transform: translateZ(0);
          -webkit-transform: translateZ(0);
        transition: opacity 0.1s cubic-bezier(0.4, 0.0, 1, 1);
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        @apply(--layout-flex-auto);
        @apply(--paper-tab-content);
      }

      :host(:not(.iron-selected)) > .tab-content {
        opacity: 0.8;

        @apply(--paper-tab-content-unselected);
      }

      :host(:focus) .tab-content {
        opacity: 1;
        font-weight: 700;
      }

      paper-ripple {
        color: var(--paper-tab-ink, --paper-yellow-a100);
      }

      .tab-content > ::content > a {
        @apply(--layout-flex-auto);

        height: 100%;
      }
    </style>

    <div class="tab-content">
      <content></content>
    </div>
  </template>

  <script>
    Polymer({
      is: 'paper-tab',

      behaviors: [
        Polymer.IronControlState,
        Polymer.IronButtonState,
        Polymer.PaperRippleBehavior
      ],

      properties: {

        /**
         * If true, the tab will forward keyboard clicks (enter/space) to
         * the first anchor element found in its descendants
         */
        link: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        }

      },

      hostAttributes: {
        role: 'tab'
      },

      listeners: {
        down: '_updateNoink',
        tap: '_onTap'
      },

      attached: function() {
        this._updateNoink();
      },

      get _parentNoink () {
        var parent = Polymer.dom(this).parentNode;
        return !!parent && !!parent.noink;
      },

      _updateNoink: function() {
        this.noink = !!this.noink || !!this._parentNoink;
      },

      _onTap: function(event) {
        if (this.link) {
          var anchor = this.queryEffectiveChildren('a');

          if (!anchor) {
            return;
          }

          // Don't get stuck in a loop delegating
          // the listener from the child anchor
          if (event.target === anchor) {
            return;
          }

          anchor.click();
        }
      }

    });
  </script>
</dom-module>
<dom-module id="paper-tabs" assetpath="../paper-tabs/">
  <template>
    <style>
      :host {
        @apply(--layout);
        @apply(--layout-center);

        height: 48px;
        font-size: 14px;
        font-weight: 500;
        overflow: hidden;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;

        /* NOTE: Both values are needed, since some phones require the value to be `transparent`. */
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        -webkit-tap-highlight-color: transparent;

        @apply(--paper-tabs);
      }

      :host-context([dir=rtl]) {
        @apply(--layout-horizontal-reverse);
      }

      #tabsContainer {
        position: relative;
        height: 100%;
        white-space: nowrap;
        overflow: hidden;
        @apply(--layout-flex-auto);
      }

      #tabsContent {
        height: 100%;
        -moz-flex-basis: auto;
        -ms-flex-basis: auto;
        flex-basis: auto;
      }

      #tabsContent.scrollable {
        position: absolute;
        white-space: nowrap;
      }

      #tabsContent:not(.scrollable),
      #tabsContent.scrollable.fit-container {
        @apply(--layout-horizontal);
      }

      #tabsContent.scrollable.fit-container {
        min-width: 100%;
      }

      #tabsContent.scrollable.fit-container > ::content > * {
        /* IE - prevent tabs from compressing when they should scroll. */
        -ms-flex: 1 0 auto;
        -webkit-flex: 1 0 auto;
        flex: 1 0 auto;
      }

      .hidden {
        display: none;
      }

      .not-visible {
        opacity: 0;
        cursor: default;
      }

      paper-icon-button {
        width: 48px;
        height: 48px;
        padding: 12px;
        margin: 0 4px;
      }

      #selectionBar {
        position: absolute;
        height: 2px;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: var(--paper-tabs-selection-bar-color, --paper-yellow-a100);
          -webkit-transform: scale(0);
        transform: scale(0);
          -webkit-transform-origin: left center;
        transform-origin: left center;
          transition: -webkit-transform;
        transition: transform;

        @apply(--paper-tabs-selection-bar);
      }

      #selectionBar.align-bottom {
        top: 0;
        bottom: auto;
      }

      #selectionBar.expand {
        transition-duration: 0.15s;
        transition-timing-function: cubic-bezier(0.4, 0.0, 1, 1);
      }

      #selectionBar.contract {
        transition-duration: 0.18s;
        transition-timing-function: cubic-bezier(0.0, 0.0, 0.2, 1);
      }

      #tabsContent > ::content > *:not(#selectionBar) {
        height: 100%;
      }
    </style>

    <paper-icon-button icon="paper-tabs:chevron-left" class$="[[_computeScrollButtonClass(_leftHidden, scrollable, hideScrollButtons)]]" on-up="_onScrollButtonUp" on-down="_onLeftScrollButtonDown" tabindex="-1"></paper-icon-button>

    <div id="tabsContainer" on-track="_scroll" on-down="_down">
      <div id="tabsContent" class$="[[_computeTabsContentClass(scrollable, fitContainer)]]">
        <div id="selectionBar" class$="[[_computeSelectionBarClass(noBar, alignBottom)]]" on-transitionend="_onBarTransitionEnd"></div>
        <content select="*"></content>
      </div>
    </div>

    <paper-icon-button icon="paper-tabs:chevron-right" class$="[[_computeScrollButtonClass(_rightHidden, scrollable, hideScrollButtons)]]" on-up="_onScrollButtonUp" on-down="_onRightScrollButtonDown" tabindex="-1"></paper-icon-button>

  </template>

  <script>
    Polymer({
      is: 'paper-tabs',

      behaviors: [
        Polymer.IronResizableBehavior,
        Polymer.IronMenubarBehavior
      ],

      properties: {
        /**
         * If true, ink ripple effect is disabled. When this property is changed,
         * all descendant `<paper-tab>` elements have their `noink` property
         * changed to the new value as well.
         */
        noink: {
          type: Boolean,
          value: false,
          observer: '_noinkChanged'
        },

        /**
         * If true, the bottom bar to indicate the selected tab will not be shown.
         */
        noBar: {
          type: Boolean,
          value: false
        },

        /**
         * If true, the slide effect for the bottom bar is disabled.
         */
        noSlide: {
          type: Boolean,
          value: false
        },

        /**
         * If true, tabs are scrollable and the tab width is based on the label width.
         */
        scrollable: {
          type: Boolean,
          value: false
        },

        /**
         * If true, tabs expand to fit their container. This currently only applies when
         * scrollable is true.
         */
        fitContainer: {
          type: Boolean,
          value: false
        },

        /**
         * If true, dragging on the tabs to scroll is disabled.
         */
        disableDrag: {
          type: Boolean,
          value: false
        },

        /**
         * If true, scroll buttons (left/right arrow) will be hidden for scrollable tabs.
         */
        hideScrollButtons: {
          type: Boolean,
          value: false
        },

        /**
         * If true, the tabs are aligned to bottom (the selection bar appears at the top).
         */
        alignBottom: {
          type: Boolean,
          value: false
        },

        selectable: {
          type: String,
          value: 'paper-tab'
        },

        /**
         * If true, tabs are automatically selected when focused using the
         * keyboard.
         */
        autoselect: {
          type: Boolean,
          value: false
        },

        /**
         * The delay (in milliseconds) between when the user stops interacting
         * with the tabs through the keyboard and when the focused item is
         * automatically selected (if `autoselect` is true).
         */
        autoselectDelay: {
          type: Number,
          value: 0
        },

        _step: {
          type: Number,
          value: 10
        },

        _holdDelay: {
          type: Number,
          value: 1
        },

        _leftHidden: {
          type: Boolean,
          value: false
        },

        _rightHidden: {
          type: Boolean,
          value: false
        },

        _previousTab: {
          type: Object
        }
      },

      hostAttributes: {
        role: 'tablist'
      },

      listeners: {
        'iron-resize': '_onTabSizingChanged',
        'iron-items-changed': '_onTabSizingChanged',
        'iron-select': '_onIronSelect',
        'iron-deselect': '_onIronDeselect'
      },

      keyBindings: {
        'left:keyup right:keyup': '_onArrowKeyup'
      },

      created: function() {
        this._holdJob = null;
        this._pendingActivationItem = undefined;
        this._pendingActivationTimeout = undefined;
        this._bindDelayedActivationHandler = this._delayedActivationHandler.bind(this);
        this.addEventListener('blur', this._onBlurCapture.bind(this), true);
      },

      ready: function() {
        this.setScrollDirection('y', this.$.tabsContainer);
      },

      detached: function() {
        this._cancelPendingActivation();
      },

      _noinkChanged: function(noink) {
        var childTabs = Polymer.dom(this).querySelectorAll('paper-tab');
        childTabs.forEach(noink ? this._setNoinkAttribute : this._removeNoinkAttribute);
      },

      _setNoinkAttribute: function(element) {
        element.setAttribute('noink', '');
      },

      _removeNoinkAttribute: function(element) {
        element.removeAttribute('noink');
      },

      _computeScrollButtonClass: function(hideThisButton, scrollable, hideScrollButtons) {
        if (!scrollable || hideScrollButtons) {
          return 'hidden';
        }

        if (hideThisButton) {
          return 'not-visible';
        }

        return '';
      },

      _computeTabsContentClass: function(scrollable, fitContainer) {
        return scrollable ? 'scrollable' + (fitContainer ? ' fit-container' : '') : ' fit-container';
      },

      _computeSelectionBarClass: function(noBar, alignBottom) {
        if (noBar) {
          return 'hidden';
        } else if (alignBottom) {
          return 'align-bottom';
        }

        return '';
      },

      // TODO(cdata): Add `track` response back in when gesture lands.

      _onTabSizingChanged: function() {
        this.debounce('_onTabSizingChanged', function() {
          this._scroll();
          this._tabChanged(this.selectedItem);
        }, 10);
      },

      _onIronSelect: function(event) {
        this._tabChanged(event.detail.item, this._previousTab);
        this._previousTab = event.detail.item;
        this.cancelDebouncer('tab-changed');
      },

      _onIronDeselect: function(event) {
        this.debounce('tab-changed', function() {
          this._tabChanged(null, this._previousTab);
          this._previousTab = null;
        // See polymer/polymer#1305
        }, 1);
      },

      _activateHandler: function() {
        // Cancel item activations scheduled by keyboard events when any other
        // action causes an item to be activated (e.g. clicks).
        this._cancelPendingActivation();

        Polymer.IronMenuBehaviorImpl._activateHandler.apply(this, arguments);
      },

      /**
       * Activates an item after a delay (in milliseconds).
       */
      _scheduleActivation: function(item, delay) {
        this._pendingActivationItem = item;
        this._pendingActivationTimeout = this.async(
            this._bindDelayedActivationHandler, delay);
      },

      /**
       * Activates the last item given to `_scheduleActivation`.
       */
      _delayedActivationHandler: function() {
        var item = this._pendingActivationItem;
        this._pendingActivationItem = undefined;
        this._pendingActivationTimeout = undefined;
        item.fire(this.activateEvent, null, {
          bubbles: true,
          cancelable: true
        });
      },

      /**
       * Cancels a previously scheduled item activation made with
       * `_scheduleActivation`.
       */
      _cancelPendingActivation: function() {
        if (this._pendingActivationTimeout !== undefined) {
          this.cancelAsync(this._pendingActivationTimeout);
          this._pendingActivationItem = undefined;
          this._pendingActivationTimeout = undefined;
        }
      },

      _onArrowKeyup: function(event) {
        if (this.autoselect) {
          this._scheduleActivation(this.focusedItem, this.autoselectDelay);
        }
      },

      _onBlurCapture: function(event) {
        // Cancel a scheduled item activation (if any) when that item is
        // blurred.
        if (event.target === this._pendingActivationItem) {
          this._cancelPendingActivation();
        }
      },

      get _tabContainerScrollSize () {
        return Math.max(
          0,
          this.$.tabsContainer.scrollWidth -
            this.$.tabsContainer.offsetWidth
        );
      },

      _scroll: function(e, detail) {
        if (!this.scrollable) {
          return;
        }

        var ddx = (detail && -detail.ddx) || 0;
        this._affectScroll(ddx);
      },

      _down: function(e) {
        // go one beat async to defeat IronMenuBehavior
        // autorefocus-on-no-selection timeout
        this.async(function() {
          if (this._defaultFocusAsync) {
            this.cancelAsync(this._defaultFocusAsync);
            this._defaultFocusAsync = null;
          }
        }, 1);
      },

      _affectScroll: function(dx) {
        this.$.tabsContainer.scrollLeft += dx;

        var scrollLeft = this.$.tabsContainer.scrollLeft;

        this._leftHidden = scrollLeft === 0;
        this._rightHidden = scrollLeft === this._tabContainerScrollSize;
      },

      _onLeftScrollButtonDown: function() {
        this._scrollToLeft();
        this._holdJob = setInterval(this._scrollToLeft.bind(this), this._holdDelay);
      },

      _onRightScrollButtonDown: function() {
        this._scrollToRight();
        this._holdJob = setInterval(this._scrollToRight.bind(this), this._holdDelay);
      },

      _onScrollButtonUp: function() {
        clearInterval(this._holdJob);
        this._holdJob = null;
      },

      _scrollToLeft: function() {
        this._affectScroll(-this._step);
      },

      _scrollToRight: function() {
        this._affectScroll(this._step);
      },

      _tabChanged: function(tab, old) {
        if (!tab) {
          // Remove the bar without animation.
          this.$.selectionBar.classList.remove('expand');
          this.$.selectionBar.classList.remove('contract');
          this._positionBar(0, 0);
          return;
        }

        var r = this.$.tabsContent.getBoundingClientRect();
        var w = r.width;
        var tabRect = tab.getBoundingClientRect();
        var tabOffsetLeft = tabRect.left - r.left;

        this._pos = {
          width: this._calcPercent(tabRect.width, w),
          left: this._calcPercent(tabOffsetLeft, w)
        };

        if (this.noSlide || old == null) {
          // Position the bar without animation.
          this.$.selectionBar.classList.remove('expand');
          this.$.selectionBar.classList.remove('contract');
          this._positionBar(this._pos.width, this._pos.left);
          return;
        }

        var oldRect = old.getBoundingClientRect();
        var oldIndex = this.items.indexOf(old);
        var index = this.items.indexOf(tab);
        var m = 5;

        // bar animation: expand
        this.$.selectionBar.classList.add('expand');

        var moveRight = oldIndex < index;
        var isRTL = this._isRTL;
        if (isRTL) {
          moveRight = !moveRight;
        }

        if (moveRight) {
          this._positionBar(this._calcPercent(tabRect.left + tabRect.width - oldRect.left, w) - m,
              this._left);
        } else {
          this._positionBar(this._calcPercent(oldRect.left + oldRect.width - tabRect.left, w) - m,
              this._calcPercent(tabOffsetLeft, w) + m);
        }

        if (this.scrollable) {
          this._scrollToSelectedIfNeeded(tabRect.width, tabOffsetLeft);
        }
      },

      _scrollToSelectedIfNeeded: function(tabWidth, tabOffsetLeft) {
        var l = tabOffsetLeft - this.$.tabsContainer.scrollLeft;
        if (l < 0) {
          this.$.tabsContainer.scrollLeft += l;
        } else {
          l += (tabWidth - this.$.tabsContainer.offsetWidth);
          if (l > 0) {
            this.$.tabsContainer.scrollLeft += l;
          }
        }
      },

      _calcPercent: function(w, w0) {
        return 100 * w / w0;
      },

      _positionBar: function(width, left) {
        width = width || 0;
        left = left || 0;

        this._width = width;
        this._left = left;
        this.transform(
            'translateX(' + left + '%) scaleX(' + (width / 100) + ')',
            this.$.selectionBar);
      },

      _onBarTransitionEnd: function(e) {
        var cl = this.$.selectionBar.classList;
        // bar animation: expand -> contract
        if (cl.contains('expand')) {
          cl.remove('expand');
          cl.add('contract');
          this._positionBar(this._pos.width, this._pos.left);
        // bar animation done
        } else if (cl.contains('contract')) {
          cl.remove('contract');
        }
      }
    });
  </script>
</dom-module>

<script>
	/**
	 * `TriBlockNavSelectBehavior` handles selection of a navigation item.  Currently, it supports initial selection.   
	 *
	 * @polymerBehavior
	 */
	TriBlockNavSelectBehavior = {

	    properties: {
		/**
		 * If true, the item is navigated when the component is initially rendered on the page.
		 */
	      initialSelection: Boolean
	    },
	};
</script><script>
	/**
	 * `TriBlockBadgeBehavior` configures a badge to be shown on a navigation item.  Value shown on the badge can either be value explicitly set on `badge-number` or `badge-label` property, it cannot be from both.
	 *
	 * @polymerBehavior
	 */
	TriBlockBadgeBehavior = { 

		properties: {
	    	/**
	    	 * Gets or sets number to the badge.  Value is calculated if `badge-max-number` is available then the calculated value is set to the `badge-label` property as text (see `badge-max-number` for details).  If value is 0, badge will not be shown.
	    	 */
			badgeNumber: Number,
	    	/**
	    	 * Gets or sets the maximum number that can be shown on the badge.  If `badge-number` is greater than the `badge-max-number`, the number to show on the badge will only show up to the `badge-max-number` followed by a plus (+) sign.
			 * For example, if the `badge-number` is 100 with `badge-max-number` equals to 50, the badge number to show is 50+.
	    	 */
			badgeMaxNumber: Number,
	    	/**
	    	 * Gets or sets label as text to the badge.  Calculated value of the `badge-number`, if available, will also be set to this property as text.
	    	 */
			badgeLabel: String
		},

		observers: [
			'_handleBadgeNumber(badgeNumber)',
			'_handleBadgeMaxNumber(badgeMaxNumber)',
			'_handleBadgeNumberAndMaxNumberChanged(badgeNumber, badgeMaxNumber)',
			'_handleBadgeLabelChanged(badgeLabel)',
		],

		_handleBadgeNumber: function(badgeNumber) {
			this._handleBadgeNumberAndMaxNumberChanged(badgeNumber, this.badgeMaxNumber);
		},

		_handleBadgeMaxNumber: function(badgeMaxNumber) {
			this._handleBadgeNumberAndMaxNumberChanged(this.badgeNumber, badgeMaxNumber);
		},

		_handleBadgeNumberAndMaxNumberChanged: function(badgeNumber, badgeMaxNumber) {
			var badgeLabel = badgeNumber + "";
			if (badgeMaxNumber && badgeNumber > badgeMaxNumber) {
				badgeLabel = badgeMaxNumber + "+";
			}
			if (badgeNumber > 0 && badgeLabel != "undefined") {
				this.set('badgeLabel', badgeLabel);
			} else if (badgeNumber < 1 && this.badgeLabel) {
				this.set('badgeLabel', undefined);
			}
		},

		_handleBadgeLabelChanged: function(badgeLabel) {
			this._refreshBadge();
		},

		_refreshBadge: function() {
  			/**
 			 * Fired when badge properties are updated.  The element is passed to the event listener as item, like `e.detail.item`.
  			 */
			this.fire("badge-update", {item: this});
		},

	    /**
	     * Returns true if there is a valid value calculated or set to the badge label.
	     * @return {boolean}
	     */
		_hasBadgeLabel: function() {
			if (this.badgeLabel) {
				return true;
			} 
			return false;
		}
  };
</script><script>
	Polymer({

		is: "triblock-tab",

		behaviors: [TriBlockNavBehavior, 
					TriBlockBadgeBehavior,
					TriBlockNavSelectBehavior],

		properties: {
	    	/**
	    	 * Gets or sets the label of the navigation item.
	    	 */
			label: String,
	    	/**
	    	 * Gets or sets the name of the icon of the navigation item.  See demo pages of `triplat-icon` and `iron-icons` to see the list of available icons to use.
	    	 */
			icon: String
		},

		observers: [
			'_handleLabelChanged(label)'
		],

		_handleLabelChanged: function(label) {
			this._refreshTabs();
		},
		
		_refreshTabs: function() {
  			/**
 			 * Fired when navigation item's properties get updated.  The element is passed to the event listener as item, like `e.detail.item`.
  			 *
 			 * @event update
  			 */
			this.fire("update", {item: this});
		}
	});
</script><dom-module id="triblock-slide-animation" assetpath="../triblock-animation/">
	<template>
		<style>
			:host {
				@apply(--layout-fit);
				display: block;
				overflow: hidden;
				
				@apply(--triblock-slide-animation);
			}

			#background {
				width: 100%;
				height: 100%;
				background-color: var(--triblock-slide-animation-background-color);
				transform: translateX(var(--triblock-slide-animation-width));
				transform: translateY(var(--triblock-slide-animation-height));
			}

			#background.rtl {
				transform: translateX(calc(var(--triblock-slide-animation-width) * -1));
			}

			#background.slide-up {
				transform: translateY(0);
		        -webkit-transition: 0.25s;
				-moz-transition: 0.25s;
				-ms-transition: 0.25s;
				-o-transition: 0.25s;
				transition: 0.25s;
			}

			#background.slide-down {
				transform: translateY(var(--triblock-slide-animation-height));
		        -webkit-transition: 0.25s;
				-moz-transition: 0.25s;
				-ms-transition: 0.25s;
				-o-transition: 0.25s;
				transition: 0.25s;
			}

			#background.slide-left {
				transform: translateX(0);
		        -webkit-transition: 0.25s;
				-moz-transition: 0.25s;
				-ms-transition: 0.25s;
				-o-transition: 0.25s;
				transition: 0.25s;
			}

			#background.slide-right {
				transform: translateX(var(--triblock-slide-animation-width));
		        -webkit-transition: 0.25s;
				-moz-transition: 0.25s;
				-ms-transition: 0.25s;
				-o-transition: 0.25s;
				transition: 0.25s;
			}
		</style>
		<div id="background"></div>
	</template>
</dom-module>
<script>
	Polymer({

		is: "triblock-slide-animation",

		attached: function() {
			var textDirectionValue = document.querySelector('body').getAttribute('dir');
			if (textDirectionValue==="rtl") {
				this.$.background.classList.add("rtl");
			}
		},

		/**
		 * Applies animation so that element will slide up.
		 */
		slideUp: function() {
			var slider = Polymer.dom(this.root).querySelector("#background");
			Polymer.dom(slider).classList.remove("slide-down");
			Polymer.dom(slider).classList.add("slide-up");
		},

		/**
		 * Applies animation so that element will slide down.
		 */
		slideDown: function() {
			var slider = Polymer.dom(this.root).querySelector("#background");
			Polymer.dom(slider).classList.remove("slide-up");
			Polymer.dom(slider).classList.add("slide-down");
		},

		/**
		 * Applies animation so that element will slide to the left.
		 */
		slideLeft: function() {
			var slider = Polymer.dom(this.root).querySelector("#background");
			Polymer.dom(slider).classList.remove("slide-right");
			Polymer.dom(slider).classList.add("slide-left");
		},

		/**
		 * Applies animation so that element will slide to the right.
		 */
		slideRight: function() {
			var slider = Polymer.dom(this.root).querySelector("#background");
			Polymer.dom(slider).classList.remove("slide-left");
			Polymer.dom(slider).classList.add("slide-right");
		},
		
	});
</script><script>

	/**
	 * `TriBlockSlideAnimationBehavior` provides animation to a `triblock-slide-animation` overlay component which can slide up, down, left or right. 
	 *
	 * @polymerBehavior
	 */
	TriBlockSlideAnimationBehavior = {

		/**
		 * Slides up the `triblock-slide-animation` overlay component.
		 *
		 * @param {Element} el Contains the `triblock-slide-animation` overlay component to apply the slide up animation.
		 */
		_slideUp: function(el) {
			var slider = Polymer.dom(el).querySelector("triblock-slide-animation");
			slider.slideUp();
		},

		/**
		 * Slides down the `triblock-slide-animation` overlay component.
		 * 
		 * @param {Element} el Contains the `triblock-slide-animation` overlay component to apply the slide down animation.
		 */
		_slideDown: function(el) {
			var slider = Polymer.dom(el).querySelector("triblock-slide-animation");
			slider.slideDown();
		},

		/**
		 * Slides the `triblock-slide-animation` overlay component to the left.
		 *
		 * @param {Element} el Contains the `triblock-slide-animation` overlay component to apply the slide to the left animation.
		 */
		_slideLeft: function(el) {
			var slider = Polymer.dom(el).querySelector("triblock-slide-animation");
			slider.slideLeft();
		},

		/**
		 * Slides the `triblock-slide-animation` overlay component to the right.
		 *
		 * @param {Element} el Contains the `triblock-slide-animation` overlay component to apply the slide to the right animation.
		 */
		_slideRight: function(el) {
			var slider = Polymer.dom(el).querySelector("triblock-slide-animation");
			slider.slideRight();
		}
	};
</script><script>
	/**
	 * `TriBlockBadgeContainerBehavior` manages the badge configuration of the navigation items as per badge settings of the parent or container element.
	 *
	 * @polymerBehavior
	 */
	TriBlockBadgeContainerBehavior = { 

		properties: {
			/**
			 * Sets the maximum number to show on the badge of a navigation item.  If the badge number set to the navigation item exceeds the maximum number specified in this property, the actual number will not be shown to the badge, instead it will show the maximum number and a plus sign.
			 * For example, if the `badge-number` is 100 with `badge-max-number` equals to 50, the badge number to show on the navigation item is 50+. 		
			 */
			badgeMaxNumber: Number
		},

		/**
		 * Sets the value of the `badge-max-number` property of all the navigation items based of the value of the `badge-max-number` property in this container behavior. 
		 * 
		 * @param {Array<HTMLElement>} items Navigation items to set the value of the `badge-max-number` property. 
		 */
		_setBadgeMaxNumber: function(items) {
			if (this.badgeMaxNumber) {
				for (var i = 0; i < items.length; i++) {
					var item = items[i];
					if (!item.badgeMaxNumber && item.badgeNumber) {
						item.badgeMaxNumber = this.badgeMaxNumber;
					}
				}
			}
		}
	};
</script><script>
	/**
	 * `TriBlockNavSelectContainerBehavior` manages the selected navigation item including the initial selection when the navigation items are first rendered in the page.
	 *
	 * @polymerBehavior
	 */
	TriBlockNavSelectContainerBehavior = {

	    properties: {
	    	/**
	    	 * Gets or sets the selected navigation item.  The value corresponds to the value of the `id` property, by default,  or the property value of the property specified in `attr-for-selected` property of the navigation item.
	    	 */
			selected: {
			  type: String,
			  notify: true
			},
			/**
			 * If you want to use a property value that is not from the `id` property for the `selected` property, set this to the name of the property.
			 */
	  		attrForSelected: {
	  			type: String,
	  			value: "id"
	  		}
	    },
	
		attached: function() {
			this.listen(this, 'triblock-nav-behavior-route-activated', '_onRouteActivated');
		},
		
		detached: function() {
			this.unlisten(this, 'triblock-nav-behavior-route-activated', '_onRouteActivated');
		},
	
		_onRouteActivated: function(e) {
			var attrSelector = "[triplat-route-id=" + e.detail.triplatRouteId + "]";
			var routeNavEl = Polymer.dom(this).querySelector(attrSelector);
			if (routeNavEl) {
				var selectAttr = this._computeSelectAttr(routeNavEl, this.attrForSelected);
				if (this.selected !== selectAttr) {
					this.selected = selectAttr;
				}
			}
		},
	
		/**
		 * Returns the value of the property named in `attrForSelected`.
		 * 
		 * @param {HTMLElement} item The element to retrieve the value of the property from. 
		 * @param {string} attrForSelected The name of the property to retrieve the value from.
		 * @return {string}
		 */
	    _computeSelectAttr: function(item, attrForSelected) {
	      return item.getAttribute(attrForSelected);
	    },
	
		/**
		 * Sets a value to the `selected` property if one of the navigation items has `initial-selection` property sets to true.  The value is based from the property value of the property specified in `attr-for-selected`, otherwise the value of the `id` property of the navigation item.
		 * 
		 * @param {Array<HTMLElement>} items Navigation items to check for the `initial-selection` property. 
		 */
	    _computeInitialSelection: function(items) {
	        items.forEach(function(item) {
	          if (item.initialSelection){
	            this.selected = this._computeSelectAttr(item, this.attrForSelected);
	          }
	      }.bind(this));
	    }

	};
</script><dom-module id="triblock-tabs" assetpath="../triblock-tabs/">
	<template>
		<style>

			:host {
				display: flex;
				@apply(--layout-vertical);
				
				@apply(--triblock-tabs-container);
			};
			
			.tri-content {
				font-weight: normal;
			}

			paper-tabs {
				height: var(--triblock-tabs-height, 50px);
				min-width: var(--triblock-tabs-min-width, 200px);
								
				@apply(--triblock-tabs);
			}

			paper-tab:focus,
			paper-tab:hover {
				opacity: 1;
				@apply(--triblock-tab-focused);
			}

			paper-tab:focus:before,
			paper-tab:hover:before {
				@apply(--layout-fit);
				opacity: 1;
				content: "";
				z-index: 1;

				@apply(--triblock-tab-focused-band);
			}

			paper-tabs.primary paper-tab:hover:before,
			paper-tabs.primary paper-tab:focus:before {
				background-color: var(--triblock-tab-focused-band-background-color, --ibm-blue-60);
				height: var(--triblock-tab-focused-band-height, 5px);
				transform: translateY(calc(var(--triblock-tabs-height, 50px) - var(--triblock-tab-focused-band-height, 5px)));
				
				@apply(--triblock-tab-focused-band);
			}

			paper-tabs.secondary paper-tab:hover:before,
			paper-tabs.secondary paper-tab:focus:before {
				background-color: var(--triblock-tab-focused-band-background-color, --tri-primary-color);
				height: var(--triblock-tab-focused-band-height, 4px);
				transform: translateY(calc(var(--triblock-tabs-height, 50px) - var(--triblock-tab-focused-band-height, 4px)));

				@apply(--triblock-tab-focused-band);
			}

			paper-tab:focus > ::content .tri-content {
				@apply --triblock-tab-focused-tricontent;
			}

			paper-tabs.primary {
				--paper-tabs: {
					background-color: var(--triblock-tabs-background-color, --tri-header-background-color);
					color: var(--triblock-tabs-color, --tri-header-color);
					
					@apply(--triblock-tabs);
				};
			}

			paper-tabs.primary paper-tab {
				--paper-tab: {
					padding: 0;
					font-size: 18px;

					@apply(--triblock-tab);
				};
				--paper-tab-content: {
					color: var(--triblock-tab-color, --tri-secondary-content-color);
					
					@apply(--triblock-tab);
				};
				--paper-tab-content-unselected: {
					background-color: var(--triblock-tab-unselected-background-color, --tri-primary-dark-color);
					color: var(--triblock-tab-unselected-color, --tri-secondary-content-color);
					
					@apply(--triblock-tab-unselected);
				};
			}

			paper-tabs.primary .tri-content {
				padding: 0 24px;
				
				@apply(--triblock-tabs-tricontent);
			}

			paper-tabs.secondary {
				--paper-tabs: {
					background-color: var(--triblock-tabs-background-color, white);
					color: var(--triblock-tabs-color, --tri-primary-color);
					font-size: 18px;
					
					@apply(--triblock-tabs);
				};
			}

			paper-tabs.secondary paper-tab {
				padding-left: 10px;
				padding-right: 10px;
				--paper-tab: {
					@apply(--layout-end);
					padding: 0px;
					padding-bottom: 12px;
					box-sizing: border-box;

					@apply(--triblock-tab);
				};
				--paper-tab-content: {
					@apply(--layout-end);
					background-color: var(--triblock-tab-background-color, white);
					color: var(--triblock-tab-color, --tri-primary-dark-color);
					
					@apply(--triblock-tab);
				};
				--paper-tab-content-unselected: {
					/*by default, paper-tab opacity: 0.8 and on select, 1.0*/
					opacity: 1.0;
					color: var(--triblock-tab-unselected-color, --tri-primary-color);
					
					@apply(--triblock-tab-unselected);
				};
			}
			
			:host-context([dir="ltr"]) paper-tabs.secondary paper-tab:first-of-type {
				padding-left: 2px;
			}
			:host-context([dir="rtl"]) paper-tabs.secondary paper-tab:first-of-type {
				padding-right: 2px;
			}
			
			:host-context([dir="ltr"]) paper-tabs.secondary paper-tab:last-of-type {
				padding-right: 2px;
			}
			:host-context([dir="rtl"]) paper-tabs.secondary paper-tab:last-of-type {
				padding-left: 2px;
			}

			paper-tabs.secondary .tri-content {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				padding: 0 5px;
				
				@apply(--triblock-tabs-tricontent);
			}
			
			triplat-icon {
				padding-right: 5px;
				height: 22px;
				width: 22px;
				@apply(--triblock-tabs-icon);
			}

			triblock-slide-animation {
				z-index: -1;
				--triblock-slide-animation-height: var(--triblock-tabs-height, 50px);
				--triblock-slide-animation-background-color: var(--triblock-tab-selected-background-color, --ibm-blue-60);
			}
			
			paper-tabs.secondary paper-tab.iron-selected:before {
				@apply(--layout-fit);
			  	height: var(--triblock-tab-selected-band-height, 4px);
		        background-color: var(--triblock-tab-selected-band-color, --tri-primary-dark-color);
		        content: "";
		        transform: translateY(calc(var(--triblock-tabs-height, 50px) - var(--triblock-tab-selected-band-height, 4px))); 
		        
		        @apply(--triblock-tab-selected-band);
			}

			paper-tab.iron-selected {
				opacity: 1;
		        font-weight: normal;
		        
		        @apply(--triblock-tab-selected);
			}

			paper-tab {
		        font-weight: normal;
				font-family: var(--tri-font-family);
				
				@apply(--triblock-tab);
			}

			.badge {
				font-weight: bold;
				
				@apply(--triblock-tab-badge);
			}

			.primary .badge {
				color: white;

				@apply(--triblock-tab-badge);
			}

			.secondary .badge {
				padding-left: 5px;

				@apply(--triblock-tab-badge);
			}

		</style>

		<content id="tabsContent" style="display:none" select="triblock-tab"></content>

		<paper-tabs id="triTab" selected="{{selected}}" on-iron-select="_handleIronSelected" on-iron-deselect="_handleIronDeselected" attr-for-selected="select-id" hide-scroll-buttons="{{hideScrollButtons}}" fit-container="{{fitContainer}}" class$="[[_computePaperTabsClass(primary)]]" no-bar="" noink="" no-slide="" scrollable="">
			<template id="tabsTemplate" is="dom-repeat" items="{{_tabElements}}" as="item">
				<paper-tab id="triTabItem" select-id$="{{_computeSelectAttr(item, attrForSelected, _tabElements.length)}}" tab-item="{{item}}">
					<div class="tri-content">
						<triplat-icon hidden$="{{!item.icon}}" icon="{{item.icon}}" mirror="[[_computeTriPlatIconMirrorValue(dir)]]"></triplat-icon>
						<span hidden$="{{!item.label}}" dir="[[dir]]">{{_computeLabel(item, _tabElements.length)}}</span>
						<span class="badge" hidden$="{{!_hasBadge(item, _tabElements.length)}}" dir="ltr">{{_computeBadgeLabel(item, _tabElements.length)}}</span>
					</div>
					<triblock-slide-animation hidden="{{!primary}}"></triblock-slide-animation>
				</paper-tab>
			</template>
		</paper-tabs>
			
	</template>
</dom-module>
<script>
	Polymer({

		is: "triblock-tabs",

		behaviors: [TriBlockSlideAnimationBehavior, 
					TriBlockBadgeContainerBehavior,
					TriBlockNavIronPagesContainerBehavior,
					TriBlockNavSelectContainerBehavior],

		properties: {
			/**
			 * If true, tabs are created with primary tabs styles.
			 */
			primary: {
				type: Boolean,
				value: false
			},
			_tabElements: Array,
			/**
			 * Specifies the text direction of the component's content.
			 */
			dir: {
				type: String,
				value: "ltr"
			},
			/**
			 * Number of milliseconds until tabs are refreshed on the page.
			 */
			refreshDelay: {
				type: Number,
				value: 0
			},
			/**
			 * paper-tabs: If true, scroll buttons (left/right arrow) will be hidden for scrollable tabs.
			 */
			hideScrollButtons: {
				type: Boolean,
				value: false
			},
			/**
			 * paper-tabs: If true, tabs expand to fit their container. This currently only applies when scrollable is true.
			 * By default, triblock-tabs is scrollable.
			 */
			fitContainer: {
				type: Boolean,
				value: false
			},
		},

		listeners: {
	        'update': '_tabsUpdated',
	        'badge-update': '_tabsUpdated'
      	},

    	observers: [
			'_handleBadgeMaxNumberAndTabs(badgeMaxNumber, _tabElements)'
		],

		attached: function() {
			if (!this._tabElementsLoaded()) {
			this._retrieveTabs();
			}
			var boundHandler = this._handleContentNodesChanged.bind(this);
			this._observer = Polymer.dom(this.$.tabsContent).observeNodes(boundHandler);
			
			var textDirectionValue = document.querySelector('body').getAttribute('dir');
			if (textDirectionValue==="rtl") {
				this.set('dir', "rtl");
			}
		},
		
		ready: function() {
			if (!this._tabElementsLoaded()) {
				this._retrieveTabs();
			}
		},
		_handleContentNodesChanged: function(info) {
			this.async(function() {
				this.refreshTabs();
			}, this.refreshDelay);
		},

		_getElementsToApplyIronPagesId: function() {
			if (!this._tabElements) {
				this._retrieveTabs();
			}
		
			return this._tabElements;
		},

		_retrieveTabs: function() {
			var tabs = Polymer.dom(this).querySelectorAll("triblock-tab");
			this.set('_tabElements', tabs);
		},

		_handleBadgeMaxNumberAndTabs: function(badgeMaxNumber, _tabElements) {
			this._setBadgeMaxNumber(_tabElements);
		},

		_handleIronSelected: function(e) {
			this._slideUp(e.detail.item);
			this._navigate(e);
		},

		_handleIronDeselected: function(e) {
			this._slideDown(e.detail.item);
		},

		_computePaperTabsClass: function(primary) {
			return primary ? "primary" : "secondary";
		},

		_computeLabel: function(item, length) {
			return item.label;
		},

		_computeBadgeLabel: function(item, length) {
			return item.badgeLabel;
		},

		_tabElementsLoaded: function() {
			return (this._tabElements && this._tabElements.length > 0);
		},
		
		_navigate: function(e) {
			e.detail.item.tabItem._navigate();
		},

		_hasBadge: function(item, length) {
			if (this._tabElementsLoaded() && (item._hasBadgeLabel() || item.badgeIcon)) {
				return true;
			} 
			return false;
		},

      	_tabsUpdated: function() {
      		this.refreshTabs();
      	},

	    /**
	     * Refreshes the tabs with the latest configuration.  You should call this after the tabs are dynamically changed or updated.
	     */
		refreshTabs: function() {
			this.debounce("refreshTabs", function() {
				this._retrieveTabs();
				this._computeInitialSelection(this._tabElements);
			});
		},

		_computeSelectAttr: function(item, attrForSelected, length) {
			return item.getAttribute(attrForSelected);
		},
		
		_computeTriPlatIconMirrorValue: function(dir) {
			return dir === "rtl";
		}
		
	});
</script>

<dom-module id="iron-collapse" assetpath="../iron-collapse/">

  <template>

    <style>
      :host {
        display: block;
        transition-duration: var(--iron-collapse-transition-duration, 300ms);
        overflow: visible;
      }

      :host(.iron-collapse-closed) {
        display: none;
      }

      :host(:not(.iron-collapse-opened)) {
        overflow: hidden;
      }
    </style>

    <content></content>

  </template>

</dom-module>

<script>

  Polymer({

    is: 'iron-collapse',

    behaviors: [
      Polymer.IronResizableBehavior
    ],

    properties: {

      /**
       * If true, the orientation is horizontal; otherwise is vertical.
       *
       * @attribute horizontal
       */
      horizontal: {
        type: Boolean,
        value: false,
        observer: '_horizontalChanged'
      },

      /**
       * Set opened to true to show the collapse element and to false to hide it.
       *
       * @attribute opened
       */
      opened: {
        type: Boolean,
        value: false,
        notify: true,
        observer: '_openedChanged'
      },

      /**
       * Set noAnimation to true to disable animations.
       *
       * @attribute noAnimation
       */
      noAnimation: {
        type: Boolean
      },

      /**
       * Stores the desired size of the collapse body.
       * @private
       */
      _desiredSize: {
        type: String,
        value: ''
      }
    },

    get dimension() {
      return this.horizontal ? 'width' : 'height';
    },

    /**
     * `maxWidth` or `maxHeight`.
     * @private
     */
    get _dimensionMax() {
      return this.horizontal ? 'maxWidth' : 'maxHeight';
    },

    /**
     * `max-width` or `max-height`.
     * @private
     */
    get _dimensionMaxCss() {
      return this.horizontal ? 'max-width' : 'max-height';
    },

    hostAttributes: {
      role: 'group',
      'aria-hidden': 'true',
      'aria-expanded': 'false'
    },

    listeners: {
      transitionend: '_transitionEnd'
    },

    attached: function() {
      // It will take care of setting correct classes and styles.
      this._transitionEnd();
    },

    /**
     * Toggle the opened state.
     *
     * @method toggle
     */
    toggle: function() {
      this.opened = !this.opened;
    },

    show: function() {
      this.opened = true;
    },

    hide: function() {
      this.opened = false;
    },

    /**
     * Updates the size of the element.
     * @param {string} size The new value for `maxWidth`/`maxHeight` as css property value, usually `auto` or `0px`.
     * @param {boolean=} animated if `true` updates the size with an animation, otherwise without.
     */
    updateSize: function(size, animated) {
      // Consider 'auto' as '', to take full size.
      size = size === 'auto' ? '' : size;
      // No change!
      if (this._desiredSize === size) {
        return;
      }

      this._desiredSize = size;

      this._updateTransition(false);
      var willAnimate = animated && !this.noAnimation && this._isDisplayed;
      // If we can animate, must do some prep work.
      if (willAnimate) {
        // Animation will start at the current size.
        var startSize = this._calcSize();
        // For `auto` we must calculate what is the final size for the animation.
        // After the transition is done, _transitionEnd will set the size back to `auto`.
        if (size === '') {
          this.style[this._dimensionMax] = '';
          size = this._calcSize();
        }
        // Go to startSize without animation.
        this.style[this._dimensionMax] = startSize;
        // Force layout to ensure transition will go. Set scrollTop to itself
        // so that compilers won't remove it.
        this.scrollTop = this.scrollTop;
        // Enable animation.
        this._updateTransition(true);
        // If final size is the same as startSize it will not animate.
        willAnimate = (size !== startSize);
      }
      // Set the final size.
      this.style[this._dimensionMax] = size;
      // If it won't animate, call transitionEnd to set correct classes.
      if (!willAnimate) {
        this._transitionEnd();
      }
    },

    /**
     * enableTransition() is deprecated, but left over so it doesn't break existing code.
     * Please use `noAnimation` property instead.
     *
     * @method enableTransition
     * @deprecated since version 1.0.4
     */
    enableTransition: function(enabled) {
      Polymer.Base._warn('`enableTransition()` is deprecated, use `noAnimation` instead.');
      this.noAnimation = !enabled;
    },

    _updateTransition: function(enabled) {
      this.style.transitionDuration = (enabled && !this.noAnimation) ? '' : '0s';
    },

    _horizontalChanged: function() {
      this.style.transitionProperty = this._dimensionMaxCss;
      var otherDimension = this._dimensionMax === 'maxWidth' ? 'maxHeight' : 'maxWidth';
      this.style[otherDimension] = '';
      this.updateSize(this.opened ? 'auto' : '0px', false);
    },

    _openedChanged: function() {
      this.setAttribute('aria-expanded', this.opened);
      this.setAttribute('aria-hidden', !this.opened);

      this.toggleClass('iron-collapse-closed', false);
      this.toggleClass('iron-collapse-opened', false);
      this.updateSize(this.opened ? 'auto' : '0px', true);

      // Focus the current collapse.
      if (this.opened) {
        this.focus();
      }
    },

    _transitionEnd: function() {
      this.style[this._dimensionMax] = this._desiredSize;
      this.toggleClass('iron-collapse-closed', !this.opened);
      this.toggleClass('iron-collapse-opened', this.opened);
      this._updateTransition(false);
      this.notifyResize();
    },

    /**
     * Simplistic heuristic to detect if element has a parent with display: none
     *
     * @private
     */
    get _isDisplayed() {
      var rect = this.getBoundingClientRect();
      for (var prop in rect) {
        if (rect[prop] !== 0) return true;
      }
      return false;
    },

    _calcSize: function() {
      return this.getBoundingClientRect()[this.dimension] + 'px';
    }

  });

</script>
<script>
	Polymer({

		is: "tricomp-array-comparator",

		properties: {
			/**
			 * Array or Object used for matching elements in `source`.
			 */
			compareTo: {
				type: Object
			},

			/**
			 * Name of field for identifying records in `compareTo`.
			 */
			compareToMatchField: {
				type: String,
				value: "_id"
			},

			_debug: {
				type: Boolean,
				value: false
			},

			/**
			 * Name of property that will be applied to elements if that element is found in both `source` and `compareTo`.
			 */
			matchFlag: {
				type: String,
				value: "matches"
			},

			/**
			 * Array/object copied from `source` (shallow copy of each object within `source`), where the element(s) will be flagged with a property (named via `matchFlag`) if that element is also found in `compareTo` array/object. Matching is determined by the `sourceMatchField` and `compareToMatchField` property values that should be present and uniquely-valued on all elements in `source` and `compareTo`. Only created when `updateSource` is false.
			 */
			result: {
				type: Array,
				notify: true,
				readOnly: true
			},

			/**
			 * Array or Object to be flagged.
			 */
			source: {
				type: Object
			},

			/**
			 * Name of field for identifying records in `source`.
			 */
			sourceMatchField: {
				type: String,
				value: "_id"
			},

			/**
			 * When true, `source` itself will be updated with match-flag, instead of creating a new `result` array/object.
			 */
			updateSource: {
				type: Boolean,
				value: false
			}
		},

		observers: [
			"_handleSourceChange(source.*)",
			"_handleCompareToChange(compareTo.*)"
		],

		_handleCompareToChange: function(compareToChange) {
			if (this.updateSource) {
				if (compareToChange.path == "compareTo") {
					// new compareTo array
					if (this._debug) console.log("compareTo change", compareToChange);
					this._updateSourceFlags();
				} else if (compareToChange.path == "compareTo.splices") {
					// array splice
					if (this._debug) console.log("compareTo splice", compareToChange);
					var indexSplices = compareToChange.value.indexSplices;
					if (indexSplices) indexSplices.forEach(function(indexSplice) {
						if (indexSplice.addedCount > 0) {
							// handle new elements added to `compareTo` array
							var start = indexSplice.index;
							var end = indexSplice.index + indexSplice.addedCount;
							for (var i=start; i<end; i++) {
								var curComparison = indexSplice.object[i];
								var curComparisonId = this._valueAtObjectPath(curComparison, this.compareToMatchField);
								if (curComparisonId) this._updateSourceFlagsForNewMatchFieldValue(curComparisonId);
							}
						}
						if (indexSplice.removed.length > 0) {
							// handle elements removed from `compareTo` array
							indexSplice.removed.forEach(function(removedObj) {
								var removedObjId = this._valueAtObjectPath(removedObj, this.compareToMatchField);
								if (removedObjId) this._updateSourceFlagsForRemovedMatchFieldValue(removedObjId);
							}, this);
						}
					}, this);
				} else if (compareToChange.path == "compareTo.length") {
					// array length change (not sure how this happens when we have array splice handler, but it does)
					if (this._debug) console.log("compareTo length change", compareToChange);
					this._updateSourceFlags();
				} else {
					// deep path change
					if (this._debug) console.log("compareTo path change", compareToChange);
					this._updateSourceFlags();
				}
			} else {
				this._updateResult();
			}
		},

		_handleSourceChange: function(sourceChange) {
			if (this.updateSource) {
				if (sourceChange.path == "source") {
					// new source array
					if (this._debug) console.log("source change", sourceChange);
					this._updateSourceFlags();
				} else if (sourceChange.path == "source.splices") {
					// array splice
					if (this._debug) console.log("source splice", sourceChange);
					var indexSplices = sourceChange.value.indexSplices;
					if (indexSplices) indexSplices.forEach(function(indexSplice) {
						if (indexSplice.addedCount > 0) {
							// handle new elements added to `source` array
							var start = indexSplice.index;
							var end = indexSplice.index + indexSplice.addedCount;
							var compareToCopy = this.compareTo.slice(0);
							for (var i=start; i<end; i++) {
								var compareToMatchedIndex = this._updateSourceArrayFlagAtIndex(i, compareToCopy);
								if (compareToMatchedIndex >= 0) {
									// remove matched element from compareToCopy array so it is not used in future comparisons (for improved performance)
									compareToCopy.splice(compareToMatchedIndex, 1);
								}
							}
						}
					}, this);
				} else if (sourceChange.path == "source.length") {
					// array length change (not sure how this happens when we have array splice handler, but it does)
					if (this._debug) console.log("source length change", sourceChange);
					this._updateSourceFlags();
				} else {
					// deep path change
					if (this._debug) console.log("source path change", sourceChange);
					if (this.source) {
						if (this.source.constructor === Array) {
							var sourceChangePath = sourceChange.path.slice(sourceChange.path.indexOf(".")+1);
							var sourceChangeProperty = sourceChangePath.slice(sourceChangePath.indexOf(".")+1);
							if (sourceChangeProperty == this.sourceMatchField) {
								var sourceChangeKey = sourceChangePath.slice(0, sourceChangePath.indexOf("."));
								var collection = Polymer.Collection.get(sourceChange.base);
								var index = sourceChange.base.indexOf(collection.getItem(sourceChangeKey));
								this._updateSourceArrayFlagAtIndex(index, this.compareTo);
							}
						} else {
							// assuming `source` is a JSON Object
							var sourceChangeProperty = sourceChange.path.slice(sourceChange.path.indexOf(".")+1);
							if (sourceChangeProperty == this.sourceMatchField) {
								if (this.compareTo.constructor === Array) this._updateSourceObjectFlagForCompareToArray(this.compareTo);
								else this._updateSourceObjectFlagForCompareToObject(this.compareTo);
							}
						}
					}
				}
			} else {
				this._updateResult();
			}
		},

		/**
		 * Set `matchFlag` value for each item in `source` based on `compareTo`
		 */
		_updateSourceFlags: function() {
			if (this.source && this.compareTo) {
				if (this.source.constructor === Array) {
					if (this.compareTo.constructor === Array) {
						// `source` and `compareTo` both Arrays
						var compareToCopy = this.compareTo.slice(0);
						for (var i=0; i < this.source.length; i++) {
							var compareToMatchedIndex = this._updateSourceArrayFlagAtIndex(i, compareToCopy);
							if (compareToMatchedIndex >= 0) {
								// remove matched element from compareToCopy array so it is not used in future comparisons (for improved performance)
								compareToCopy.splice(compareToMatchedIndex, 1);
							}
						}
					} else {
						// assuming `compareTo` is a JSON Object
						for (var i=0; i < this.source.length; i++) {
							var comparisonId = this._valueAtObjectPath(this.compareTo, this.compareToMatchField);
							this._updateSourceFlagsForMatchFieldValue(comparisonId);
						}
					}
				} else {
					if (this.compareTo.constructor === Array) {
						// assuming `source` is a JSON Object
						this._updateSourceObjectFlagForCompareToArray(this.compareTo);
					} else {
						// assuming `source` and `compareTo` both Objects
						this._updateSourceObjectFlagForCompareToObject(this.compareTo);
					}
				}
			}
		},

		/**
		 * Update all `matchFlag` values for each item in `source` based on if `sourceMatchField` value == `matchFieldValue`.
		 */
		_updateSourceFlagsForMatchFieldValue: function(matchFieldValue) {
			if (this.source) {
				if (this.source.constructor === Array) {
					this.source.forEach(function(item, index) {
						var matched = Boolean(this._valueAtObjectPath(item, this.sourceMatchField) == matchFieldValue);
						if (item[this.matchFlag] !== matched) this.set("source."+index+"."+this.matchFlag, matched);
					}, this);
				} else {
					// assuming `source` is a JSON Object
					var matched = Boolean(this._valueAtObjectPath(this.source, this.sourceMatchField) == matchFieldValue);
					if (this.source[this.matchFlag] !== matched) this.set("source."+this.matchFlag, matched);
				}
			}
		},

		/**
		 * Set `matchFlag` value to true for each item in `source` that has `sourceMatchField` value == `newValue`.
		 */
		_updateSourceFlagsForNewMatchFieldValue: function(newValue) {
			if (this.source) {
				if (this.source.constructor === Array) {
					this.source.forEach(function(item, index) {
						if (this._valueAtObjectPath(item, this.sourceMatchField) == newValue) {
							if (item[this.matchFlag] !== true) this.set("source."+index+"."+this.matchFlag, true);
						}
					}, this);
				} else {
					// assuming `source` is a JSON Object
					if (this._valueAtObjectPath(this.source, this.sourceMatchField) == newValue) {
						if (this.source[this.matchFlag] !== true) this.set("source."+this.matchFlag, true);
					}
				}
			}
		},

		/**
		 * Set `matchFlag` value to false for each item in `source` that has `sourceMatchField` value == `removedValue`.
		 */
		_updateSourceFlagsForRemovedMatchFieldValue: function(removedValue) {
			if (this.source) {
				if (this.source.constructor === Array) {
					this.source.forEach(function(item, index) {
						if (this._valueAtObjectPath(item, this.sourceMatchField) == removedValue) {
							if (item[this.matchFlag] !== false) this.set("source."+index+"."+this.matchFlag, false);
						}
					}, this);
				} else {
					// assuming `source` is a JSON Object
					if (this._valueAtObjectPath(this.source, this.sourceMatchField) == removedValue) {
						if (this.source[this.matchFlag] !== false) this.set("source."+this.matchFlag, false);
					}
				}
			}
		},

		/**
		 * Set `matchFlag` value at `source[index]` (assumes `source` is an Array) based on given `compareToArray`.
		 * Returns index of matched element in given `compareToArray` (-1 if not matched).
		 */
		_updateSourceArrayFlagAtIndex: function(index, compareToArray) {
			var sourceElement = this.source[index];
			var sourceElementId = this._valueAtObjectPath(sourceElement, this.sourceMatchField);
			var matched = false;
			var j = 0;
			
			// determine if element at this.source[index] is found in compareToArray
			while (!matched && j < compareToArray.length) {
				var curComparison = compareToArray[j];
				var curComparisonId = this._valueAtObjectPath(curComparison, this.compareToMatchField);
				if (sourceElementId && curComparisonId && sourceElementId == curComparisonId) {
					matched = true;
				} else {
					j++;
				}
			}

			// update the source element with `matched` value
			if (this.source[index][this.matchFlag] !== matched) this.set("source."+index+"."+this.matchFlag, matched);

			return (matched) ? j : -1;
		},

		/**
		 * Set `matchFlag` value for `source` (assumes `source` is an Object and not an Array) based on given `compareToArray`.
		 * Returns index of matched element in given `compareToArray` (-1 if not matched).
		 */
		_updateSourceObjectFlagForCompareToArray: function(compareToArray) {
			var sourceElementId = this._valueAtObjectPath(this.source, this.sourceMatchField);
			var matched = false;
			var j = 0;
			
			// determine if this.source is found in compareToArray
			while (!matched && j < compareToArray.length) {
				var curComparison = compareToArray[j];
				var curComparisonId = this._valueAtObjectPath(curComparison, this.compareToMatchField);
				if (sourceElementId && curComparisonId && sourceElementId == curComparisonId) {
					matched = true;
				} else {
					j++;
				}
			}

			// update the source element with `matched` value
			if (this.source[this.matchFlag] !== matched) this.set("source."+this.matchFlag, matched);

			return (matched) ? j : -1;
		},

		/**
		 * Set `matchFlag` value for `source` (assumes `source` is an Object and not an Array) based on given `compareToObject`.
		 */
		_updateSourceObjectFlagForCompareToObject: function(compareToObject) {
			// determine if this.source is equivalent to compareToObject
			var matched = Boolean(this._valueAtObjectPath(this.source, this.sourceMatchField) == this._valueAtObjectPath(compareToObject, this.compareToMatchField));

			// update the source element with `matched` value
			if (this.source[this.matchFlag] !== matched) this.set("source."+this.matchFlag, matched);
		},

		/**
		 * Create and set `result` (without modifying `source`).
		 */
		_updateResult: function() {
			this.debounce("updateArrayComparatorResult", function() {
				var source = this.source;
				var compareTo = this.compareTo;
				if (source && compareTo) {
					if (source.constructor === Array) {
						if (compareTo.constructor === Array) {
							// `source` and `compareTo` both Arrays

							var result = [];
							var compareToCopy = compareTo.slice(0);

							// copy source into result
							for (var i=0; i < source.length; i++) {
								var curElement = Object.assign({}, source[i]);
								var curElementId = this._valueAtObjectPath(curElement, this.sourceMatchField);
								var matched = false;
								var j = 0;

								curElement[this.matchFlag] = false;
								
								// set flag to true if element is found in compareTo
								while (!matched && j < compareToCopy.length) {
									var curComparison = compareToCopy[j];
									var curComparisonId = this._valueAtObjectPath(curComparison, this.compareToMatchField);
									if (curElementId && curComparisonId && curElementId == curComparisonId) {
										// match found - set flag to true and remove matched element from compareToCopy array so it is not used in future comparisons (for improved performance)
										matched = true;
										compareToCopy.splice(j, 1);
										curElement[this.matchFlag] = true;
									}
									j++;
								}
								
								result.push(curElement);
							}

							this._setResult(result);
						} else {
							// assuming `compareTo` is a JSON Object

							var result = [];

							// copy source into result
							for (var i=0; i < source.length; i++) {
								var curElement = Object.assign({}, source[i]);
								var curElementId = this._valueAtObjectPath(curElement, this.sourceMatchField);
								
								// set flag to true if element matches compareTo
								curElement[this.matchFlag] = curElementId == this._valueAtObjectPath(compareTo, this.compareToMatchField);
								
								result.push(curElement);
							}

							this._setResult(result);
						}
					} else {
						if (compareTo.constructor === Array) {
							// assuming `source` is a JSON Object

							var sourceCopy = Object.assign({}, source);
							var compareToCopy = compareTo.slice(0);
							var sourceCopyId = this._valueAtObjectPath(sourceCopy, this.sourceMatchField);

							var matched = false;
							var j = 0;

							sourceCopy[this.matchFlag] = false;
							
							// set flag to true if element is found in compareTo
							while (!matched && j < compareToCopy.length) {
								var curComparison = compareToCopy[j];
								var curComparisonId = this._valueAtObjectPath(curComparison, this.compareToMatchField);
								if (sourceCopyId && curComparisonId && sourceCopyId == curComparisonId) {
									// match found - set flag to true and remove matched element from compareToCopy array so it is not used in future comparisons (for improved performance)
									matched = true;
									compareToCopy.splice(j, 1);
									sourceCopy[this.matchFlag] = true;
								}
								j++;
							}

							this._setResult(sourceCopy);
						} else {
							// `source` and `compareTo` both JSON Objects

							var sourceCopy = Object.assign({}, source);
							var sourceCopyId = this._valueAtObjectPath(sourceCopy, this.sourceMatchField);

							// set flag to true if source matches compareTo
							sourceCopy[this.matchFlag] = sourceCopyId == this._valueAtObjectPath(compareTo, this.compareToMatchField);

							this._setResult(sourceCopy);
						}
					}
				}
			});
		},

		/**
		 * Returns value in `obj` for the given `path`
		 */
		_valueAtObjectPath: function(obj, path) {
			for (var i=0, path=path.split('.'), len=path.length; i<len; i++) {
				obj = obj[path[i]];
			}
			return obj;
		}

	});
</script><script>

	TriRoomReservationBehaviorImpl = {

		properties: {
			// status
			isProcessing: {
				type: Boolean,
				computed: '_computeProcessing(isPreCreating, isSaving, isCancelling)'
			},
			isPreCreating: {
				type: Boolean,
				value: false
			},
			isSaving: {
				type: Boolean,
				value: false
			},
			isCancelling: {
				type: Boolean,
				value: false
			},

			resourceId: {
				type: String,
				notify: true,
				value: "-1",
			},
			orderId: {
				type: String,
				notify: true,
				value: "-1",
			},
			equipmentId: {
				type: String,
				notify: true,
				value: "-1",
			}
		},

		listeners: {
			"action-book-room": "_handleBookRoom",

			"action-exception-assign": "_handleExceptionAssign",
			"action-exception-auto-assign": "_handleExceptionAutoAssign",
			"action-exception-auto-assign-all": "_handleExceptionAutoAssignAll",
			"action-exception-clear-assignment": "_handleExceptionClearAssignment",
			"action-exception-clear-assignment-all": "_handleExceptionClearAssignmentAll",

			"action-submit": "_handleSubmit",
			"action-cancel": "_handleCancel",

			"action-checkin": "_handleCheckIn",
			"action-checkout": "_handleCheckOut",
			"action-earlyend": "_handleEarlyEnd",

			"action-booked-room-remove": "_handleBookedRoomRemove",

			"action-equipment-order-cancel": "_handleEquipmentOrderCancel",
			"action-load-equipment-orders": "_loadEquipmentOrders",
			"action-save-equipment-orders": "_saveEquipmentOrders",
			"action-add-equipment-item": "_addEquipmentItem",

			"action-food-order-cancel": "_handleFoodOrderCancel",
			"action-load-food-order": "_loadFoodOrder",
			"action-save-food-order": "_saveFoodOrder",
			"action-add-food-order-item": "_addFoodOrderItem",

			"refresh-reservation-list": "_refreshReservationList",
			"refresh-reservation-locations": "_refreshReservationLocations",

			"ds-add-error": "_handleDSError",
			"ds-create-error": "_handleDSError",
			"ds-delete-error": "_handleDSError",
			"ds-get-error": "_handleDSError",
			"ds-perform-action-error": "_handleDSError",
			"ds-remove-error": "_handleDSError",
			"ds-update-error": "_handleDSError",
		},

		// ------
		// Status
		_computeProcessing: function(isPreCreating, isSaving, isCancelling) {
			return isPreCreating || isSaving || isCancelling;
		},

		_setSaving: function() {
			this.set("isSaving", true);
		},

		_clearSaving: function() {
			this.set("isSaving", false);
		},

		_isSaving: function() {
			return this.isSaving;
		},

		_setCancelling: function() {
			this.set("isCancelling", true);
		},

		_clearCancelling: function() {
			this.set("isCancelling", false);
		},

		_isCancelling: function() {
			return this.isCancelling;
		},

		// ------------
		// Misc Utility
		_setResourceOrder: function(resourceId, orderId) {
			this.set("resourceId", resourceId);
			this.set("orderId", orderId);
		},

		_clearResourceOrder: function() {
			this._setResourceOrder("-1", "-1")
		},

		// TODO: Delete - do we need this?
		_getDefaultSubject: function() {
			var returnValue = null;

			if (this.isOutlookEmbedded) {
				if (this.outlookDataObserver && this.outlookDataObserver.subject) {
					returnValue = this.outlookDataObserver.subject;
				} else {
					returnValue = "";
				}
			} else {
				returnValue = "";
			}
			return returnValue;
		},

		// ------------
		// Flow Control
		_goHome: function() {
			if (this.reservationManager) {
				this._setBusy();
				this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "cleanup").then(function() {
					this._clearBusy();

					if (this.homeApp) {
						this._handleNavigateHome(true);
					} else {
						this._goReservationList();
					}
				}.bind(this));					
			}
		},

		_goReservationList: function() {
			if (this.reservationManager) {
				this._setBusy();
				this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "cleanup").then(function() {
					this._clearBusy();

					this._refreshReservationList();
					this.fire("navigate-reservation-list");
				}.bind(this));					
			} else {
				this._refreshReservationList();
				this.fire("navigate-reservation-list");
			}
		},

		// ------
		// Search
		_handleSearch: function(e) {
			this._setBusy();

			this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "search").then(function() {
				this._clearBusy();
				this.fire("navigate-room-results", {"backEventName": "navigate-room-criteria-back"});
			}.bind(this));
		},

		// ---------
		// On Change
		_handleRoomTypeChange: function(value) {
			this._setBusy();
			this.reservationManager.searchRoomType = value;
			if (value && value.id != null) {
				this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "onChangeRoomType").then(function() {
					this._clearBusy();
				}.bind(this));
			} else {
				this._clearBusy();
			}
		},

		_handleChangeAllDay: function(event) {
			if (this.reservationManager != null && event.detail != null) {
				var allDay = event.detail.reservationAllDay;
				this._changeAllDay(allDay).then(
					function() {
						if (event.detail.completeCallback != null) {
							event.detail.completeCallback();
						}
					}.bind(this)
				);
			}
		},

		_changeAllDay: function(value) {
			var promise = new Promise(
				function(resolve, reject) {
					var oldAllDayToggle = this.reservationManager.reservationAllDay;
					if (value != null && oldAllDayToggle != null && value == oldAllDayToggle) {
						resolve();
					} else {
						this._setBusy();
						this.reservationManager.reservationAllDay = value;
						this.$.reservationManager.updateRecord(
							TriPlatDs.RefreshType.SERVER, 
							"actions", 
							"onChangeAllDay"
						).then(
							function() {
								this.fire("criteria-changed");
								this._clearBusy();
								resolve();
							}.bind(this)
						).catch(
							function() {
								this._clearBusy();
								reject();
							}.bind(this)
						);
					}
				}.bind(this)
			);
			return promise;
		},

		_handleChangeStartAndEndTime: function(event) {
			if (this.reservationManager != null && event.detail != null) {
				var startTime = event.detail.reservationStartTime;
				var endTime = event.detail.reservationEndTime;
				this._changeStartTime(startTime).then(this._changeEndTime.bind(this, endTime));
			}
		},

		_handleChangeStartTime: function(event) {
			if (this.reservationManager != null && event.detail != null) {
				var startTime = event.detail.reservationStartTime;
				this._changeStartTime(startTime);
			}
		},

		_handleChangeEndTime: function(event) {
			if (this.reservationManager != null && event.detail != null) {
				var endTime = event.detail.reservationEndTime;
				this._changeEndTime(endTime);
			}
		},

		_changeStartTime: function(value) {
			var promise = new Promise(
				function(resolve, reject) {
					var oldStartTime = this.reservationManager.reservationStartTime; 
					if (value != null && oldStartTime != null && moment(value).isSame(oldStartTime)) {
						resolve();
					} else {
						this._setBusy();
						this.reservationManager.reservationStartTime = value;
						this.$.reservationManager.updateRecord(
							TriPlatDs.RefreshType.SERVER, 
							"actions", 
							"onChangeStartTime"
						).then(
							function() {
								this._clearBusy();
								this.fire("criteria-changed");
								resolve();
							}.bind(this)
						).catch(
							function() {
								this._clearBusy();
								reject();
							}.bind(this)
						);
					}
				}.bind(this)
			);
			return promise;
		},

		_changeEndTime: function(value) {
			var promise = new Promise(
				function(resolve, reject) {
					var oldEndTime = this.reservationManager.reservationEndTime;
					if (value != null && oldEndTime !=null && moment(value).isSame(oldEndTime)) {
						resolve();
					} else {
						this._setBusy();
						this.reservationManager.reservationEndTime = value;
						this.$.reservationManager.updateRecord(
							TriPlatDs.RefreshType.SERVER, 
							"actions", 
							"onChangeEndTime"
						).then(
							function() {
								this._clearBusy();
								this.fire("criteria-changed");
								resolve();
							}.bind(this)
						).catch(
							function() {
								this._clearBusy();
								reject();
							}.bind(this)
						);
					}
				}.bind(this)
			);
			return promise;
		},

		_handleChangeStartDate: function(event) {
			if (this.reservationManager != null && event.detail != null) {
				var startDate = event.detail.reservationStartDate;
				this._changeStartDate(startDate);
			}
		},

		_changeStartDate: function(value) {
			var promise = new Promise(
				function(resolve, reject) {
					var oldStartDate = this.reservationManager.reservationStartDate; 
					if (this._isSameDayMonthYear(value, oldStartDate)) {
						resolve();
					} else {
						this._setBusy();
						this.reservationManager.reservationStartDate = value;
						this.$.reservationManager.updateRecord(
							TriPlatDs.RefreshType.SERVER, 
							"actions", 
							"onChangeStartDate"
						).then(
							function() {
								this._clearBusy();
								this.fire("criteria-changed");
								resolve();
							}.bind(this)
						).catch(
							function() {
								this._clearBusy();
								reject();
							}.bind(this)
						);
					}
				}.bind(this)
			);
			return promise;
		},

		_isSameDayMonthYear: function(dateA, dateB) {
			var dateAMo = moment(dateA);
			return (
				dateA != null && dateB != null && 
				dateAMo.isSame(dateB,"day") &&
				dateAMo.isSame(dateB,"month") &&
				dateAMo.isSame(dateB,"year")
			);
		},

		_handleChangeEndDate: function(event) {
			if (this.reservationManager != null && event.detail != null) {
				var endDate = event.detail.reservationEndDate;
				this._changeEndDate(endDate);
			}
		},

		_changeEndDate: function(value) {
			var promise = new Promise(
				function(resolve, reject) {
					var oldEndDate = this.reservationManager.reservationEndDate; 
					if (this._isSameDayMonthYear(value, oldEndDate)) {
						resolve();
					} else {
						this._setBusy();
						this.reservationManager.reservationEndDate = value;
						this.$.reservationManager.updateRecord(
							TriPlatDs.RefreshType.SERVER, 
							"actions", 
							"onChangeEndDate"
						).then(
							function() {
								this._clearBusy();
								this.fire("criteria-changed");
								resolve();
							}.bind(this)
						).catch(
							function() {
								this._clearBusy();
								reject();
							}.bind(this)
						);
					}
				}.bind(this)
			);
			return promise;
		},

		// ---------
		// Book Room
		_handleBookRoom: function(e) {
			var roomId = e.detail.roomId;

			this._setBusy();

			var wfParams = {};
			wfParams.rooms = roomId;

			this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "bookSelectedRoom", wfParams).then(function() {
				this.$.reservationLocations.refresh().then(function() {
					this.$.exceptionOccurrences.refresh().then(function() {
						this.async(function() {
							this.fire("navigate-summary-page");
							this._addRoomSuccess();
						});

						this._clearBusy();
					}.bind(this));
				}.bind(this));
			}.bind(this));
		},

		_addRoomSuccess: function() {
			var __dictionary__toastRoomAdded = "Room Added";
			this.$.toast.text = __dictionary__toastRoomAdded;
			this.$.toast.show();
		},

		_handleBookedRoomRemove: function(e) {
			var resourceId = e.detail.bookedRoomId;

			this._setBusy();

			var wfParams = {};
			wfParams.resource = resourceId;

			this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "removeBookedRoom", wfParams).then(function() {
				this.$.reservationLocations.refresh().then(function() {
					this.$.exceptionOccurrences.refresh().then(function() {
						this.async(function() {
							this.fire("navigate-summary-page");
							this._removeRoomSuccess();
						});

						this._clearBusy();
					}.bind(this));
				}.bind(this));
			}.bind(this));
		},

		_removeRoomSuccess: function() {
			var __dictionary__toastRoomRemoved = "Room Removed";
			this.$.toast.text = __dictionary__toastRoomRemoved;
			this.$.toast.show();
		},

		// ----------
		// Exceptions
		_handleExceptionAssign: function(e) {
			var occurrenceId = e.detail.occurrenceId;
			var roomId = e.detail.roomId;

			if (occurrenceId && roomId && this.resourceId) {
				this._setBusy();

				var wfParams = {};
				wfParams.occurrence = occurrenceId;
				wfParams.location = roomId;

				this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "exceptionAssignLocation", wfParams).then(function() {
					this.$.exceptionOccurrences.refresh().then(function() {
						this._clearBusy();
					}.bind(this));
				}.bind(this));
			}
		},

		_handleExceptionAutoAssign: function(e) {
			var occurrenceId = e.detail.occurrenceId;

			if (occurrenceId && this.resourceId) {
				this._setBusy();

				var wfParams = {};
				wfParams.occurrence = occurrenceId;

				this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "exceptionAutoAssignLocation", wfParams).then(function() {
					this.$.exceptionOccurrences.refresh().then(function() {
						this._clearBusy();
					}.bind(this));
				}.bind(this));
			}
		},

		_handleExceptionAutoAssignAll: function(e) {
			if (this.resourceId) {
				this._setBusy();

				var wfParams = {};
				wfParams.resource = this.resourceId;

				this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "exceptionAutoAssignAll", wfParams).then(function() {
					this.$.exceptionOccurrences.refresh().then(function() {
						this._clearBusy();
					}.bind(this));
				}.bind(this));
			}
		},

		_handleExceptionClearAssignment: function(e) {
			var occurrenceId = e.detail.occurrenceId;

			if (occurrenceId && this.resourceId) {
				this._setBusy();

				var wfParams = {};
				wfParams.occurrence = occurrenceId;
				wfParams.resource = this.resourceId;

				this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "exceptionClearAssignment", wfParams).then(function() {
					this.$.exceptionOccurrences.refresh().then(function() {
						this._clearBusy();
					}.bind(this));
				}.bind(this));
			}
		},

		_handleExceptionClearAssignmentAll: function(e) {
			if (this.resourceId) {
				this._setBusy();

				var wfParams = {};
				wfParams.resource = this.resourceId;

				this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "exceptionClearAssignment", wfParams).then(function() {
					this.$.exceptionOccurrences.refresh().then(function() {
						this._clearBusy();
					}.bind(this));
				}.bind(this));
			}
		},

		// ------------------
		// Submit Reservation
		_handleSubmit: function(e) {
			this._setBusy();

			var wfParams = {};
			if (this.reservationManager.reservation != null && this.reservationManager.reservation.id) {
				wfParams.reservation = this.reservationManager.reservation.id;
			}

			this._clearBusy();

			this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "isChanged", wfParams).then(function() {
				if (this.reservationManager.isDirty) {
					this._setSaving();

					this.$.saveDialog.open();

					this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "submit").then(function() {
						this.$.reservationLocations.refresh().then(function() {
							this.$.exceptionOccurrences.refresh().then(function() {
								this.$.reservationManagerInstance.refresh().then(function() {
									this.$.saveDialog.close();

									this.async(function() {
										this._submitSuccess();

										this._clearSaving();

										this._goHome();
									});
								}.bind(this));
							}.bind(this));
						}.bind(this));
					}.bind(this));
				} else {
					this._goHome();
				}
			}.bind(this));
		},

		_submitSuccess: function() {
			var __dictionary__toastReservationSaved = "Reservation Saved";
			this.$.toast.text = __dictionary__toastReservationSaved;
			this.$.toast.show();
		},

		// ------------------
		// Cancel Reservation
		_handleCancel: function(e) {
			this._setCancelling();

			this.$.cancelDialog.open();

			this._cancelRM().then(function() {
				this.$.cancelDialog.close();
				this.$.reservationLocations.refresh().then(function() {
					this.async(function() {
						this._clearCancelling();
						this._cancelSuccess();
						this._goHome();
					});
				}.bind(this));
			}.bind(this));
		},

		// --------
		// Check-In
		_handleCheckIn: function(e) {
			this._setBusy();

			this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "check-in").then(function() {
				this.async(function() {
					this._checkinSuccess();

					this._refreshReservationList();

					this._clearBusy();
				});
			}.bind(this));
		},

		// ---------
		// Check-Out
		_handleCheckOut: function(e) {
			this._setBusy();

			this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "check-out").then(function() {
				this.async(function() {
					this._checkoutSuccess();

					this._refreshReservationList();

					this._clearBusy();
				});
			}.bind(this));
		},

		// ---------
		// Early End
		_handleEarlyEnd: function(e) {
			this._setBusy();

			this.$.reservationManager.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "early-end").then(function() {
				this.async(function() {
					this._earlyendSuccess();

					this._refreshReservationList();

					this._clearBusy();
				});
			}.bind(this));
		},

		// ----------------
		// Equipment Orders
		_handleEquipmentOrderCancel: function(e) {
			var orderId = e.detail.orderId;

			this._setBusy();

			var wfParams = {};
			wfParams.orders = orderId;

			this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "cancelEquipment", wfParams).then(function() {
				this.async(function() {
					this.fire("navigate-summary-page");
					this._cancelEquipmentOrderSuccess();
					this._refreshEquipmentOrdersData();
				});

				this._clearBusy();
			}.bind(this));
		},

		_cancelEquipmentOrderSuccess: function() {
			var __dictionary__toastEquipmentOrderCancelled = "Equipment Order cancelled.";
			this.$.toast.text = __dictionary__toastEquipmentOrderCancelled;
			this.$.toast.show();
		},

		_loadEquipmentOrders: function(e) {
			this._refreshEquipmentOrdersData().then(function() {
			}.bind(this));
		},

		_saveEquipmentOrders: function(e) {

			if (e && e.detail) {
				var resourceId = e.detail.resourceId;
				var equipmentOrders = e.detail.equipmentOrders;

				this._refreshEquipmentOrdersData().then(function() {
					this._updateEquipmentOrders(resourceId, equipmentOrders);
				}.bind(this));
			}
		},

		_addEquipmentItem: function(e) {
			if (e && e.detail) {
				var equipmentId = e.detail.equipmentId;
				var model = e.detail.model;

				this._addEquipmentOrder(equipmentId, model);
			}
		},

		_addEquipmentOrder: function(equipmentId, model) {
			var wfParams = {};
			wfParams.resource = this.resourceId;
			wfParams.specifications = equipmentId;
			this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "addEquipment", wfParams).then(function(wfReturnParams) {

				if (wfReturnParams.wfParametersMap.createdorder.length == 1) {
					var createdOrderId = wfReturnParams.wfParametersMap.createdorder[0];
					if (createdOrderId > 0) {
						model.set("item.quantity", 1);
						model.set("item.instructions", "");
						model.set("item._id", createdOrderId);
					}
				}

				this._refreshEquipmentOrdersData();
			}.bind(this));
		},

		_refreshEquipmentOrdersData: function() {
			return new Promise(function(resolve) {
				if (this.resourceId && this.resourceId > 0) {
					this.$.equipmentOrders.refresh().then(function() {
						resolve();
					}.bind(this));
				} else {
					resolve();
				}
			}.bind(this));
		},

		_updateEquipmentOrders: function(resourceId, equipmentOrders) {
			return new Promise(function(resolve) {

				var promises = [];

				for (var orderIndex=0; orderIndex < equipmentOrders.slice(0).length; orderIndex++) {
					var orderItem = equipmentOrders[orderIndex];

					if (orderItem._id > 0) {
						if (orderItem._modified) {
							if (orderItem.quantity < 1) {
								promises.push(this._cancelEquipmentOrder(orderItem));
							} else {
								promises.push(this._updateEquipmentOrder(orderItem));
							}
						}
					}
				}

				Promise.all(promises).then(function() {
					resolve();
				}.bind(this));
			}.bind(this));
		},

		_updateEquipmentOrder: function(orderItem) {
			return new Promise(function(resolve) {

				var equipmentOrders = this.equipmentOrders;
				if (equipmentOrders) {
					// find and update the equipmentorder with the quantity and instructions
					for (var index=0; index < equipmentOrders.slice(0).length; index++) {
						var equipmentOrder = equipmentOrders[index];

						if (equipmentOrder.equipmentId == orderItem.equipmentId) {
							equipmentOrder.quantity = orderItem.quantity;
							equipmentOrder.instructions = orderItem.instructions;
							break;
						}
					}
				}

				this.$.equipmentOrders.updateRecord(orderItem._id, TriPlatDs.RefreshType.SERVER).then(function() {

					var wfParams = {};
					wfParams.resource = this.resourceId;
					wfParams.orders = orderItem._id;

					this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "updateEquipment", wfParams).then(function() {
						resolve();
					}.bind(this));
				}.bind(this));
			}.bind(this));
		},

		_cancelEquipmentOrder: function(orderItem) {
			return new Promise(function(resolve) {

				var wfParams = {};
				wfParams.orders = orderItem._id;

				this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "cancelEquipment", wfParams).then(function() {
					this._refreshEquipmentOrdersData().then(function() {
						resolve();
					}.bind(this));
				}.bind(this));
			}.bind(this));
		},

		// -----------
		// Food Orders
		_handleFoodOrderCancel: function(e) {
			var orderId = e.detail.orderId;

			this._setBusy();

			var wfParams = {};
			wfParams.orders = orderId;

			this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "cancelFood", wfParams).then(function() {
				this.async(function() {
					this._cancelFoodOrderSuccess();
					this._refreshFoodOrdersData();
				});

				this._clearBusy();
			}.bind(this));
		},

		_cancelFoodOrderSuccess: function() {
			var __dictionary__toastFoodOrderCancelled = "Food Order cancelled.";
			this.$.toast.text = __dictionary__toastFoodOrderCancelled;
			this.$.toast.show();
		},

		_loadFoodOrder: function(e) {
			this._refreshFoodOrdersData().then(function() {
				if (this.orderId != undefined) {

					if (this.orderId == "-1") {
						this._setBusy();

						this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "selectFoodOrder").then(function() {
							this.$.selectedFoodOrder.refresh().then(function() {
								this._clearBusy();
							}.bind(this));
						}.bind(this));
					} else {
						var wfParams = {};
						if (this.orderId != "-1") {
							wfParams.order = this.orderId;
						}

						this._setBusy();

						this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "selectFoodOrder", wfParams).then(function() {
							this.$.selectedFoodOrder.refresh().then(function() {
								this._clearBusy();
							}.bind(this));
						}.bind(this));
					}
				}
			}.bind(this));
		},

		_saveFoodOrder: function(e) {
			if (e && e.detail) {
				var resourceId = e.detail.resourceId;
				var orderId = e.detail.orderId;
				var foodOrderLineItems = e.detail.foodOrderLineItems;

				this._updateFoodOrder(resourceId, orderId).then(function() {
					this._updateFoodLineItems(resourceId, orderId, foodOrderLineItems);
				}.bind(this));
			}
		},

		_addFoodOrderItem: function(e) {
			if (e && e.detail) {
				var resourceId = e.detail.resourceId;
				var orderId = e.detail.orderId;
				var menuItemId = e.detail.menuItemId;
				var model = e.detail.model;

				this._addFoodItem(resourceId, orderId, menuItemId, model);
			}
		},

		_addFoodItem: function(resourceId, orderId, menuItemId, model) {
			var wfParams = {};
			wfParams.resource = resourceId;
			if (orderId && orderId != "-1") {
				wfParams.order = orderId;
			}
			wfParams.menuitems = menuItemId;

			this.fire("set-busy");

			this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "addFoodItem", wfParams).then(function(wfReturnParams) {

				if (wfReturnParams.wfParametersMap.createdorder.length == 1) {
					createdOrderId = wfReturnParams.wfParametersMap.createdorder[0];
					this.set("orderId", createdOrderId);
				}

				if (wfReturnParams.wfParametersMap.createditem.length == 1) {
					var createdItemId = wfReturnParams.wfParametersMap.createditem[0];
					if (createdItemId > 0) {
						model.set("item._id", createdItemId);
						model.set("item.quantity", 1);
					}
				}

				this.async(function() {
					this.fire("clear-busy");
				});
			}.bind(this));
		},

		_refreshFoodOrdersData: function(e) {
			return new Promise(function(resolve) {
				this.$.foodOrders.refresh().then(function() {
					this.$.selectedFoodOrder.refresh().then(function() {
						if (this.selectedFoodOrder && this.selectedFoodOrder._id != this.orderId) {
							this.set("orderId", this.selectedFoodOrder._id ? this.selectedFoodOrder._id : "-1");
						}

						if (this.orderId == "-1") {
							this.set("foodOrderLineItems", new Array());
							resolve();
						} else {
							this.$.foodOrderLineItems.refresh().then(function() {
								resolve();
							}.bind(this));
						}
					}.bind(this));
				}.bind(this));
			}.bind(this));
		},

		_updateFoodOrder: function(resourceId, orderId) {
			return new Promise(function(resolve) {
				var wfParams = {};
				wfParams.resource = resourceId;
				wfParams.order = orderId;

				this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "updateFood", wfParams).then(function() {
					this._refreshFoodOrdersData().then(function() {
						resolve();
					}.bind(this));
				}.bind(this));
			}.bind(this));
		},

		_updateFoodLineItems: function(resourceId, orderId, foodOrderLineItems) {
			return new Promise(function(resolve) {

				var promises = [];

				for (var orderIndex=0; orderIndex < foodOrderLineItems.slice(0).length; orderIndex++) {
					var orderItem = foodOrderLineItems[orderIndex];

					if (orderItem._id > 0) {
						if (orderItem._modified) {
							if (orderItem.quantity < 1) {
								promises.push(this._removeFoodItem(orderId, orderItem, resourceId));
							} else {
								promises.push(this._updateFoodItem(orderItem));
							}
						}
					}
				}

				Promise.all(promises).then(function() {
					resolve();
				}.bind(this));
			}.bind(this));
		},

		_updateFoodItem: function(orderItem) {
			return new Promise(function(resolve) {
				var foodOrderLineItems = this.foodOrderLineItems;
				if (foodOrderLineItems) {
					// find and update the foodOrderLineItem with the quantity
					for (var index=0; index < foodOrderLineItems.slice(0).length; index++) {
						var item = foodOrderLineItems[index];

						if (item.menuItemId == orderItem.menuItemId) {
							item.quantity = orderItem.quantity;
							item.instructions = orderItem.instructions;
							break;
						}
					}
				}

				this.$.foodOrderLineItems.updateRecord(orderItem._id, TriPlatDs.RefreshType.SERVER).then(function() {
					resolve();
				}.bind(this));
			}.bind(this));
		},

		_removeFoodItem: function(orderId, orderItem, resourceId) {
			return new Promise(function(resolve) {
				var wfParams = {};
				if (orderId && orderId != "-1") {
					wfParams.order = orderId;
				}
				wfParams.menuitem = orderItem._id;

				this.$.reservationManager.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "removeFoodItem", wfParams).then(function() {
					this._updateFoodOrder(resourceId, orderId).then(function() {
						resolve();
					}.bind(this));
				}.bind(this));
			}.bind(this));
		},

		// TODO: Delete - do we need this?
		_handleDSError: function(e) {
			var errorDetails = e.detail;
			if (errorDetails) this.set("_errorDetails", errorDetails);
			this.$.errorDialog.open();
		},

		// TODO: Delete - do we need this?
		_handleErrorDetailsCollapseOrExpand: function() {
			this.async(function() {
				this.$.errorDialog.center();
			}.bind(this), 300);
		},

		// TODO: Refactor - can we eliminate the concept of userInterfaceId?  Are we still using it?
		_getUserInterfaceID: function() {
			var returnValue = null;

			if (this.userInterfaceID) {
				returnValue = this.userInterfaceID;
			} else {
				returnValue = this._generateRandomIDValue();
			}

			return returnValue;
		},

		_buildOpenRouteParams: function(reservationId, occurrenceStartISO, occurrenceEndISO) {
			return {
				"reservationId": reservationId,
				"occurrenceStart": occurrenceStartISO != null ? this.toMilliseconds(occurrenceStartISO): -1,
				"occurrenceEnd" : occurrenceEndISO != null ? this.toMilliseconds(occurrenceEndISO): -1
			}
		},

		_refreshReservationLocations: function() {
			if (!this.$.reservationLocations.loading) {
				return this.$.reservationLocations.refresh();
			}
		}
	};

	TriRoomReservationBehavior = [TriDateUtilities, TriReservationUtilitiesBehavior, TriRoomReservationBehaviorImpl];
</script><dom-module id="tricomp-room-results-item" assetpath="">
	<template>
		<style include="shared-page-styles">
			:host {
				@apply(--layout-vertical);
				flex-basis: 100%;
				box-sizing: border-box;
				position: relative;
				min-width: 0;
				margin-bottom: 16px;
				border: 1px solid var(--ibm-gray-10);
				padding: 20px;
				cursor: pointer;
				background-color: white;
			}
			:host:not([small-screen-width]):not([medium-screen-width]) {
				flex-basis: 48%;
				max-width: 48%;
			}

			.room-name-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			.room-name {
				@apply(--layout-flex);
				padding-right: 10px;
			}

			.divider-line {
				height: 24px;
				width: 1px;
				margin-right: 15px;
				margin-left: 10px;
				background-color: var(--tri-primary-content-accent-color);
			}

			.favorite-icon {
				flex-shrink: 0;
				padding: 0px;
				height: 20px;
				width: 20px;
			}

			.room-item-container {
				@apply(--layout-horizontal);
				flex: 1;
				min-width: 0;
				padding: 8px 0;
			}

			.room-image-container {
				@apply(--layout-vertical);
				@apply(--layout-start);
				@apply(--layout-relative);
			}
			.room-image {
				width: 70px;
				height: 70px;
			}
			.room-image-placeholder-icon {
				--triplat-icon-height: 70px;
				--triplat-icon-width: 70px;
				--triplat-icon-fill-color: var(--tri-primary-content-accent-color);
			}

			.room-details-container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				min-width: 0;
				padding-left: 10px;
			}

			.room-info {
				@apply(--paper-font-common-nowrap);
				font-size: 14px;
			}

			.amenities-container {
				position: relative;
				overflow: hidden;
				max-height: 30px;
				padding-right: 1.5em;
			}
			:host(:not([compact-layout])) .amenities-container {
				padding-top: 5px;
			}
			.amenities-container tricomp-multiline-overflow-text {
				--multiline-overflow-text-ellipsis-line-height: 25px;
			}

			.approval-message {
				margin-bottom: 3px;
			}

			.room-actions-container {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				padding-top: 10px;
			}

			.recurrence-count {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				text-align: center;
			}

			.action-button {
				margin: 0 5px;
				font-weight: 500;
			}

			paper-button {
				--paper-button: {
					margin: 0;
				};
			}
		</style>

		<tricore-url raw-url="/getCompanyFile.jsp?fileLoc=" bind-url="{{imgUrl}}"></tricore-url>

		<div class="room-name-container">
			<span id="roomName" class="room-name tri-h3 multiline-overflow-text" tabindex="0" aria-label$="[[item.room]]">
				<tricomp-multiline-overflow-text text="[[item.room]]" parentelement="[[roomEl]]"></tricomp-multiline-overflow-text>
			</span>
			<span class="divider-line"></span>
			<paper-icon-button class="favorite-icon" favorited$="[[item.isFavorite]]" icon="[[_computeFavIcon(item.isFavorite)]]" on-tap="_handleToggleFavorite" aria-label="Favorite icon"></paper-icon-button>
		</div>

		<div class="room-item-container" on-tap="_handleOpenRoomDetails">
			<template is="dom-if" if="[[_showImage(applicationSettings)]]">
				<div class="room-image-container">
					<iron-image id="roomImage" class="room-image" src="{{_computeImageUrl(item.image, imgUrl)}}" sizing="cover" hidden$="[[!roomImageLoaded]]" loaded="{{roomImageLoaded}}"></iron-image>
					<triplat-icon class="room-image-placeholder-icon" icon="picturefile" hidden$="[[roomImageLoaded]]">
					</triplat-icon>
				</div>
			</template>

			<div class="room-details-container">
				<div class="room-info">Capacity [[item.capacity]]</div>

				<template is="dom-if" if="[[showLocation]]">
					<div class="room-info">[[item.floor]]</div>
					<div id="buildingName" class="multiline-overflow-text">
						<tricomp-multiline-overflow-text text="[[item.building]]" parentelement="[[buildingEl]]"></tricomp-multiline-overflow-text>
					</div>
				</template>
				
				<div id="amenitiesContainer" class="amenities-container">
					<tricomp-multiline-overflow-text id="multilineAmenities" parentelement="[[amenitiesEl]]" no-gradient="">
						<tricomp-amenities-list class="amenities-list" catering="[[_isRoomServiceAvailable(item.isCateringAvailable)]]" disabled-access="[[_isRoomServiceAvailable(item.isADAAvailable)]]" network-connection="[[_isRoomServiceAvailable(item.isNetworkConnection)]]" phone-conference="[[_isRoomServiceAvailable(item.isConferencePhone)]]" projector="[[_isRoomServiceAvailable(item.isProjector)]]" video-conference="[[_isRoomServiceAvailable(item.isVideoConference)]]" whiteboard="[[_isRoomServiceAvailable(item.isWhiteboard)]]">
						</tricomp-amenities-list>
					</tricomp-multiline-overflow-text>
				</div>
			</div>
		</div>

		<tricomp-alert-message info="" id="approvalMessage" class="approval-message" hidden$="[[!_isApprovalRequired(item.approvalNameENUS)]]" show-tooltip-indicator-icon="">[[item.approval]]</tricomp-alert-message>
		<paper-tooltip for="approvalMessage" position="top" offset="5" animation-delay="100" fit-to-visible-bounds="">Adding this room to your reservation will require approval from the room's owner, which may result in a delay of the acceptance of this room.  You will be notified of the room owner's decision.</paper-tooltip>

		<div class="room-actions-container">
			<div class="action-button recurrence-count" hidden$="[[_hideRecurrenceCount(item)]]">[[item._availCount]] of [[item._maxOccurrenceCount]] matches</div>
			<paper-button secondary="" class="action-button" on-tap="_handleCloseTap" hidden="[[!showCloseButton]]">Close</paper-button>
			<paper-button secondary="" hidden$="[[!_isAvailable(item)]]" on-tap="_handleBookRoom" class="action-button" noink="">Book</paper-button>
			<paper-button disabled$="[[!_isAvailable(item)]]" hidden$="[[_isAvailable(item)]]" class="action-button" noink="">Unavailable</paper-button>
		</div>
	</template>
	<script>
		Polymer({

			is: "tricomp-room-results-item",

			behaviors: [
				TriRoomReservationUtilBehavior, TriBlockViewResponsiveBehavior
			],

			properties: {
				item: {
					type: Object,
				},
				showLocation: {
					type: Boolean,
					value: false
				},
				showCloseButton: {
					type: Boolean,
					value: false
				},
				compactLayout: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				}
			},

			observers: [
				"_observeAmenities(item.isCateringAvailable, item.isADAAvailable, item.isNetworkConnection, item.isConferencePhone, item.isProjector, item.isVideoConference, item.isWhiteboard)"
			],

			attached: function() {
				this.set("roomEl", this.$.roomName);
				this.set("buildingEl", this.$.buildingName);
				this.set("amenitiesEl", this.$.amenitiesContainer);
			},

			_computeFavIcon: function(isFav) {
				return isFav ? "ibm:rating-star-filled" : "ibm:rating-star";
			},

			_handleBookRoom: function(e) {
				var roomId = this.item._id;
				this.fire("action-book-room", { 'roomId' : roomId });
			},

			_handleOpenRoomDetails: function(e) {
				var roomId = this.item._id;
				this.fire("navigate-room-details", { 'roomId' : roomId, 'backEventName': "navigate-room-results-back"});
			},

			_handleToggleFavorite: function(e) {
				var roomId = this.item._id;
				this.fire("action-toggle-room-favorite", { 'roomId' : roomId, 'isFavorite' : !this.item.isFavorite });

				e.stopPropagation();
			},

			_hideRecurrenceCount: function(item) {
				var isRecurring = this._isRecurring(item);
				var isAvailable = this._isAvailable(item);
				return !(isRecurring && isAvailable);
			},

			_isApprovalRequired: function(approvalNameENUS) {
				return approvalNameENUS && approvalNameENUS === "Requestable";
			},

			_handleCloseTap: function(e) {
				var roomId = this.item._id;
				this.fire("action-close-room", { 'roomId' : roomId});
				e.stopPropagation();
			},

			_observeAmenities: function() {
				this.$.multilineAmenities._checkOverflowText();
			}

		});
	</script>
</dom-module>
<dom-module id="tricomp-room-results" assetpath="">
	<template>
		<style include="shared-page-styles">
			:host {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				@apply(--layout-relative);
			}
			:host > * {
				flex-shrink: 0;
			}

			.amenities-list {
				@apply(--layout-flex);
			}

			.button-container {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				@apply(--layout-wrap);
			}

			.divider-line {
				border-left: 1px solid var(--tri-primary-content-accent-color);
				height: 32px;
				margin-left: 10px;
			}

			.list-page .empty-data-message {
				background-color: var(--ibm-neutral-2);
			}

			.empty-data-message > div > * {
				margin: 10px 0;
			}

			.empty-data-message > div {
				position: absolute;
				top: 25%;
				left: 50%;
				transform: translateX(-50%);
			}

			.empty-data-message-icon {
				height: 32px;
				width: 32px;
			}

			.favorite-icon {
				flex-shrink: 0;
				height: 20px;
				width: 20px;
				margin-left: 20px;
				padding: 0;
			}

			.layout-dropdown {
				display: block;
				@apply(--layout-flex);
			}

			.list {
				@apply(--layout-flex);
				@apply(--layout-scroll);
			}

			.room-details-collapse {
				@apply(--layout-horizontal);
				position: absolute;
				right: 0;
				bottom: 0;
				left: 0;
				background-color: var(--tri-body-background-color);
			}

			.embedded-item {
				@apply(--layout-flex);
				max-width: none;
				min-width: 0; 
				margin: 0px;
			}

			.row-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--layout-wrap);
			}

			.search-row-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				padding: 10px 20px;
			}
			.search-input {
				@apply(--layout-flex);
			}

			.tabs-container {
				@apply(--layout-horizontal);
			}

			.tabs {
				@apply(--layout-flex);
			}
			.tab {
				--triblock-tab-style: {			
					width: 10px;
				}
			}

			.search-criteria-section {
				max-width: var(--max-width-while-we-dont-support-desktop);
				width: 100%;
				@apply(--layout-self-center);
				@apply(--layout-vertical);
			}
			#searchCriteriaCollapse {
				background-color: var(--tri-primary-content-background-color);
				overflow: auto;
			}
			.section-header {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				background-color: var(--tri-footer-background-color);
				color: white;
				cursor: pointer;
				padding: 10px;
				flex-shrink: 0;
			}
			.section-title {
				@apply(--layout-flex);
				font-weight: 500;
				font-size: 18px;
			}
			.sub-section {
				margin: 0 10px;
				padding-bottom: 12px;
			}
			.sub-section:not(:first-child) {
				padding-top: 12px;
			}
			.sub-section:not(:last-child) {
				border-bottom: 1px solid var(--tri-primary-content-accent-color);
			}
			
			.select-amenities-link {
				@apply(--layout-flex);
			}

			.sub-pages {
				@apply(--layout-flex);
				@apply(--layout-vertical);
			}

			.sub-page {
				@apply(--layout-flex);
				border-top: 1px solid var(--ibm-gray-10);
				padding: 20px;
				background-color: var(--ibm-neutral-2);
			}

			.floorplan-page {
				@apply(--layout-vertical);
				padding: 5px 20px 5px 20px;
			}

			.availability-page {
				@apply(--layout-vertical);
				background-color: white;
			}

			.list-page[empty] {
				@apply(--layout-vertical);
			}

			.list-page[empty] > .card-container {
				display:none;
			}

			#availabilityComp {
				@apply(--layout-flex);
			}

			.floor-graphic-container {
				@apply(--layout-flex);
				@apply(--layout-relative);
				@apply(--layout-vertical);
				min-height: 0;
			}

			.floor-graphic {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				user-select: none;
				cursor: default;

				--triplat-graphic-interactive-selected: {
					stroke:blue;
					stroke-width:10;
					cursor: pointer;
				};

				--triplat-graphic-selected: {
					fill-opacity: 1;
				}

				--triplat-graphic-interactive-selectable: {
					cursor: pointer;
				};

				--triplat-graphic-non-selectable: {
					fill: white;
					fill-opacity: 1;
				};

				--triplat-graphic-highlight-group-1: {
					fill: green;
					fill-opacity: .5;
				};

				--triplat-graphic-highlight-group-2: {
					fill: red;
					fill-opacity: .5;
				};
				--triplat-graphic-pin-tooltip-container: {
				z-index: 102;
				}
				--triplat-graphic-pin-tooltip-1: {
					font-size: 14px;
					font-weight: 600;
				};

				--triplat-graphic-pin-color-3: #562f72;
				--triplat-graphic-pin-tooltip: #e4c0fe;
				--triplat-graphic-pin-tooltip: black;
				--triplat-graphic-pin-tooltip: #562f72;
			}

			.slider-container {
				@apply(--layout-vertical);
				@apply(--layout-center);
			}

			.slider {
				max-width: 280px;
			}

			.instruction {
				padding:0px 0px 3px 0px;
			}

			.card-container {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
				@apply(--layout-wrap);
				@apply(--layout-justified);
				@apply(--layout-scroll);
				align-content: flex-start;
				min-width: 0;
			}

			.availability-loading {
				width: 20px;
				height: 20px;
			}
		</style>

		<triplat-ds id="spaceLabelStyle" name="spaceLabelStyle" filtered-data="{{_spaceLabelStyle}}">
			<triplat-query>
				<triplat-query-filter name="ID" operator="equals" value="[[_spaceLabelID]]">
				</triplat-query-filter>
			</triplat-query>
		</triplat-ds>

		<triplat-ds id="lookupFloorSearchResults" name="lookupFloorSearchResults" data="{{floors}}" loading="{{_lookupFloorSearchResultsLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]"></triplat-ds-context>
		</triplat-ds>

		<triplat-ds id="lookupRoom" name="lookupRoom" data="{{_allRoomsUnfiltered}}" reserve-include-unavailable="" loading="{{_lookupRoomLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]"></triplat-ds-context>
		</triplat-ds>

		<triplat-query data="{{_searchableRooms}}" append-filters="{{_roomFilters}}" filtered-data-out="{{_filteredRooms}}">
		</triplat-query>

		<tricomp-array-comparator source="[[_filteredRooms]]" compare-to="[[favoriteRooms]]" match-flag="isFavorite" result="{{_filteredRoomsWithFavoriteIndicator}}">
		</tricomp-array-comparator>

		<tricomp-array-comparator source="[[_selectedRoom]]" compare-to="[[favoriteRooms]]" match-flag="isFavorite" result="{{_roomDetails}}">
		</tricomp-array-comparator>

		<div class="page-main">
			<div class="page-wrap">
				<div class="search-row-container" hidden$="[[_hideResultsContainer(_hideResults, _hasResults)]]">
					<triplat-search-input id="searchInput" aliases="[[_roomSearchAliases]]" append-filters="{{_roomFilters}}" class="search-input" data="[[_searchableRooms]]" max-header-children="4" placeholder="Search" search-icon-precede="">
					</triplat-search-input>
					<div class="divider-line"></div>
					<paper-icon-button class="favorite-icon" icon="[[_computeFavIcon(preferredRoomsSwitchActive)]]" active="{{preferredRoomsSwitchActive}}" toggles=""></paper-icon-button>
				</div>

				<div id="resultsContainer" class="page-wrap" hidden$="[[_hideResultsContainer(_hideResults, _hasResults)]]">

				<div class="tabs-container" hidden$="[[!_hasResults]]">
					<triblock-tabs class="tabs" selected="{{_selectedTab}}" fit-container="[[smallScreenWidth]]">
						<triblock-tab id="floorplanTab" icon="floorplan" label="Floor Plan"></triblock-tab>
						<triblock-tab id="listTab" icon="list-view" label="List"></triblock-tab>
						<template is="dom-if" if="[[_showAvailabilityTab]]" restamp="">
							<triblock-tab id="availabilityTab" icon="availability" label="Availability"></triblock-tab>
						</template>
					</triblock-tabs>
				</div>

				<iron-pages selected="{{_selectedTab}}" class="sub-pages" attr-for-selected="tab" hidden$="[[!_hasResults]]">

					
					<div class="sub-page floorplan-page" tab="floorplanTab">
						<div class="floor-dropdown-container">
							<tricomp-select-input id="floorsDropdown" label="Select a floor" value="{{_selectedFloor}}" value-name="bldgfloor" select-src="[[floors]]" search-value="{{_floorSearchValue}}" scroller="{{_floorInputScroller}}" on-tap="_jumpTo">
							</tricomp-select-input>
						</div>

						<div class="floor-graphic-container" hidden$="[[!hasGraphic]]">
							<div class="instruction">
								You can pan or zoom on the floor plan.
							</div>
							<triplat-graphic id="floorplan" class="floor-graphic" record-id="[[_selectedFloor.id]]" has-graphic="{{hasGraphic}}" svg-loaded="{{_graphicLoaded}}" hidden$="[[!_computeGraphicLoaded(hasGraphic, _graphicLoaded)]]">

								<triplat-graphic-selectable selectable="{{_filteredRoomsGraphic}}" selected="{{_selectedRoom}}">
								</triplat-graphic-selectable>

								<triplat-graphic-label id="graphicLabel" label-id="[[_getLabelId(_spaceLabelStyle.*)]]">
								</triplat-graphic-label> 
								<triplat-graphic-pin pins="[[_filteredRoomsGraphic]]" label-attr-name="_id" record-id-attr-name="_id" icon="ibm:pin-person" selected="[[_filteredRoomsGraphic]]" class-number="1">
								</triplat-graphic-pin>	
								<triplat-graphic-highlight-group spaces="{{_filteredRoomsGraphic}}" group-by="_isAvailable" color-by="color" mask-opacity="1.0" highlight-layer="ATTACHED">
									<triplat-graphic-highlight-class value="true" class-number="1">
									</triplat-graphic-highlight-class>

									<triplat-graphic-highlight-class value="false" class-number="2">
									</triplat-graphic-highlight-class>
								</triplat-graphic-highlight-group>

								<triplat-graphic-zoomable scale="{{_zoomScale}}" cached=""></triplat-graphic-zoomable>
							</triplat-graphic>

							<div class="slider-container">
								<triplat-zoom-slider class="slider" min="0.01" max="1.5" step="0.1" value="{{_zoomScale}}">
								</triplat-zoom-slider>
							</div>

							<div hidden$="[[_computeGraphicLoaded(hasGraphic, _graphicLoaded)]]">
								<triplat-loading-indicator id="graphic-loading-indicator" show="[[!_graphicLoaded]]">
								</triplat-loading-indicator>
							</div>
						</div>

						<div class="page-main empty-data-message" hidden$="[[hasGraphic]]">
							<div>
								<iron-icon class="empty-data-message-icon" icon="ibm:status-info" info="" hidden$="[[isLoading]]">
								</iron-icon>
								<div hidden$="[[isLoading]]">
									There is no floor plan for this floor.  Please switch to the List view or select a different floor.
								</div>
							</div>
						</div>
					</div>

					
					<div class="sub-page list-page" tab="listTab" empty$="[[_showEmptyListPage]]">
						<div class="card-container">
							<template is="dom-repeat" items="{{_filteredRoomsAvailable}}">
								<tricomp-room-results-item class="list-item" item="{{item}}" index$="[[_computeEvenOdd(index)]]" current-user="[[currentUser]]" application-settings="[[applicationSettings]]" show-location="" medium-screen-max-width="800px">
								</tricomp-room-results-item>
							</template>
						</div>
						<div class="page-main empty-data-message" hidden$="[[!_showEmptyListPage]]">
							<div>
								<iron-icon class="empty-data-message-icon" icon="ibm:status-info" info=""></iron-icon>
								<div>No rooms are available for the given search criteria.</div>
							</div>
						</div>
					</div>

					
					<div class="sub-page  availability-page" tab="availabilityTab">
						<template is="dom-if" if="[[!hideAvailabilityTab]]">
							<tricomp-alert-message warning="" class="row-limit-alert" hidden$="[[!_computeShowRowLimitAlert(_rowLimitAlertMessage)]]">
								<div>[[_rowLimitAlertMessage]]</div>
							</tricomp-alert-message>
							<triplat-availability id="availabilityComp" on-resource-click="_handleResourceClick" on-row-limit="_handleRowLimit" selected="{{_selectedRoomsAvailability}}" loading="{{_availabilityLoading}}" visible-resources="[[_filteredRoomsAvailability]]">

								<triplat-availability-layout default-view-mode="day" max-view-mode="month" columns="[[_columns]]" home-only-toolbar="">
								</triplat-availability-layout>

								<triplat-availability-data datasource="lookupRoom" calendar-set-name="triResourceAvailability" include-unavailable="">

									<triplat-availability-data-context name="myReservationManagers" context-id="[[specId]]">
									</triplat-availability-data-context>

								</triplat-availability-data>
							</triplat-availability>
						</template>
					</div>
				</iron-pages>

				<iron-collapse class="room-details-collapse" opened="[[_computeRoomDetailsOpened(_selectedRoom, _selectedTab)]]">
					<tricomp-room-results-item class="embedded-item" item="{{_roomDetails}}" current-user="[[currentUser]]" application-settings="[[applicationSettings]]" show-close-button="" show-location="" compact-layout="" on-action-close-room="_clearSelectedRoom">
					</tricomp-room-results-item>
				</iron-collapse>

				</div>

				<div class="page-main empty-data-message" tabindex="0" hidden$="[[_hideInfoMessage(_hasResults, _hideResults)]]">
					<div>
						<iron-icon class="empty-data-message-icon" icon="ibm:status-info" info=""></iron-icon>
						<div aria-label$="[[_computeInfoMessage(_searchInitiated, _hideResults)]]">[[_computeInfoMessage(_searchInitiated, _hideResults)]]</div>
					</div>
				</div>
			</div>
		</div>
	</template>
	<script>
		Polymer({

			is: "tricomp-room-results",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriDateUtilities,
				Polymer.IronResizableBehavior,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				reservationManager: {
					type: Object
				},

				isWorkspaceRoom: {
					type: Boolean,
					value: false
				},

				hideAvailabilityTab: {
					type: Boolean,
					value: false
				},

				_graphicLoaded: {
					type: Boolean,
					value: false,
					observer: "_handleGraphicLoaded"
				},

				_hasResults: {
					type: Boolean,
					computed: "_computeHasResults(_filteredRooms)"
				},

				/* Array of rooms after pre-filters (removing non-available/post-cutoff rooms) have been applied */
				_searchableRooms: {
					type: Array,
					value: function() { return []; }
				},

				_filteredRoomsAvailable: {
					type: Array,
					value: function() { return []; }
				},

				_filteredRoomsGraphic: {
					type: Array,
					value: function() { return []; }
				},

				_filteredRoomsAvailability: {
					type: Array,
					value: function() { return []; }
				},

				_showEmptyListPage: {
					type: Boolean,
					value: false
				},

				backEventName: String,

				currentTime: Date,			// used to calculate the cutoffDateTime

				isLoading: {
					type: Boolean,
					value: false
				},

				occurrenceId: String,
				occurrenceDate: Date,

				_roomSearchAliases: {
					type: Object,
					value: function() {
						var __dictionary__roomName = "Room Name";
						var __dictionary__building = "Building";
						var __dictionary__floor = "Floor";
						var __dictionary__city = "City";
						var aliases = {};
						aliases["room"] = __dictionary__roomName;
						aliases["building"] = __dictionary__building;
						aliases["floor"] = __dictionary__floor;
						aliases["city"] = __dictionary__city;
						return aliases;
					}
				},

				_selectedTab: {
					type: Number,
					value: "listTab"
				},

				_selectedFloor: {
					type: Object,
					value: {
						id: null,
						value: null
					},
					observer: "_handleSelectedFloorChange"
				},

				_roomDetails: {
					type: Object,
					value: null,
				},
				_selectedRoom: {
					type: Object,
					value: null,
				},
				_selectedRoomsAvailability: {
					type: Array
				},
				_searchInitiated: {
					type: Boolean,
					value: false
				},
				_hideResults: {
					type: Boolean,
					value: false
				},
				_columns: {
					type: Object,
					value: function(){
						var __dictionary__room = "Room";
						var __dictionary__floor = "Floor";
						var __dictionary__capacity = "Capacity";
						var columns = {
							room: __dictionary__room,
							floor: __dictionary__floor,
							capacity: __dictionary__capacity
						};
						return columns;
					}
				},
				_refreshAvailability: {
					type: Boolean,
					value: false
				},

				reservationLocations: {
						type: Array
				},

				_lookupFloorSearchResultsLoading: {
					type: Boolean,
					value: false
				},

				_lookupRoomLoading: {
					type: Boolean,
					value: false
				},

				_availabilityLoading: {
					type: Boolean,
					value: false
				},

				isLoading: {
					type: Boolean,
					computed: "_computeLoading(_lookupFloorSearchResultsLoading, _lookupRoomLoading, _availabilityLoading)",
					notify: true
				},

				_showAvailabilityTab: {
					type: Boolean,
					computed: "_computeShowAvailabilityTab(smallScreenWidth, smallScreenHeight, hideAvailabilityTab)",
					value: true
				},

				_zoomScale: {
					type: Number,
					value: 1.0
				},

				_rowLimitAlertMessage: {
					type: String,
					value: ""
				},

				_spaceLabelID: {
					type: String,
					computed: "_computeSpaceLabelID(isWorkspaceRoom)",
				},

				_spaceLabelStyle: {
					type: Array
				}
			},

			listeners: {
				"action-book-room": "_handleBookRoom"
			},

			observers: [
				"_preferredRoomsFilterToggled(preferredRoomsSwitchActive)",
				"_handleFloorsChange(floors)",
				"_handleSelectedTab(_selectedTab)",
				"_handleHasResultsChange(_hasResults)",
				"_handleSelectedRoomsAvailability(_selectedRoomsAvailability.*)",
				"_handleFilteredRoomsWithFavoriteIndicatorChange(_filteredRoomsWithFavoriteIndicator, preferredRoomsSwitchActive)",
				"_computeSearchableRooms(_allRoomsUnfiltered)"
			],

			refresh: function() {
				if (this._selectedTab == "availabilityTab") {
					this._rowLimitAlertMessage = "";
					this.$$("#availabilityComp").refresh();
				} else {
					this._refreshAvailability = true;
				}
			},

			_computeRoomDetailsOpened: function(selectedRoom, selectedTab) {
				return selectedRoom != null && selectedRoom._id != null &&
						(selectedTab == "floorplanTab" || selectedTab == "availabilityTab");
			},

			_handleSelectedRoomsAvailability: function(selectedRoomsAvailabilityChange) {
				if (this._selectedTab == "availabilityTab" && 
						this._selectedRoomsAvailability != null && this._selectedRoomsAvailability.length > 0) {
					this._selectedRoom = this._getRoomById(this._selectedRoomsAvailability[0]);
				} else {
					this._selectedRoom = null;
				}
			},

			_getRoomById: function(id) {
				if (this._filteredRooms && this._filteredRooms.length > 0) {
					return this._filteredRooms.find(
						function(item) {
							return item._id == id
						}
					);
				} else {
					return null;
				}
			},

			_handleGraphicLoaded: function(value) {
				if (value) {
					this.$.floorplan.refreshViewBox();
				}
			},

			_computeGraphicLoaded: function(hasGraphic, _graphicLoaded) {
				return Boolean(hasGraphic && _graphicLoaded);
			},

			_jumpTo: function(e) {
				e.target.scrollIntoView();
			},

			_handleHasResultsChange: function(value) {
				this.async(function() {
					this.notifyResize();
				});
			},
			
			_computeHasResults: function(results) {
				return (results && results.length > 0);
			},

			_computeEvenOdd: function(index) {
				return (index % 2 == 0) ? "even" : "odd";
			},

			_computeFavIcon: function(isFav) {
				return isFav ? "ibm:rating-star-filled" : "ibm:rating-star";
			},

			_computeSearchableRooms: function(allRoomsUnfiltered) {
				var reservationManager = this.reservationManager;
				var currentTime = this.currentTime;
				var timezone = this.currentUser._TimeZoneId;
				var searchableRooms = [];

				if (allRoomsUnfiltered && allRoomsUnfiltered.length > 0) {
					if (reservationManager && currentTime) {
						var triplatDuration = document.createElement("triplat-duration");
						triplatDuration.displayTokens = "y:M:d";

						// filter unavailable rooms and rooms outside of cutoff date
						searchableRooms = allRoomsUnfiltered.filter(function(item) {
							var isRecurring = this._isRecurring(item);
							var isAvailable = this._isAvailable(item);

							item._isAvailable = "" + isAvailable;
							item.isAvailable = isAvailable;

							triplatDuration.value = item.cutoffDuration;
							var cutoffDateTime = triplatDuration.getCalculatedEndDateTime(currentTime);

							var isNoEndRecurringCutoff = this._isNoEndRecurringCutoff(item, reservationManager, currentTime);
							var isEndCutoff = this._isEndCutoff(item, reservationManager, currentTime, timezone, cutoffDateTime);

							var hideItem = isNoEndRecurringCutoff || isEndCutoff;

							return !hideItem;
						}, this);
					} else {
						// return all rooms (since we don't have reservationManager and currentTime yet)
						searchableRooms = allRoomsUnfiltered.slice(0);
					}
				}

				this._searchableRooms = searchableRooms;
			},

			_handleFilteredRoomsWithFavoriteIndicatorChange: function(filteredRoomsWithFavoriteIndicator, preferredRoomsSwitchActive) {
				this.debounce(
					"_handleFilteredRoomsWithFavoriteIndicatorChange",
					this._handleFilteredRoomsWithFavoriteIndicatorChange.bind(this, filteredRoomsWithFavoriteIndicator, preferredRoomsSwitchActive)
				);
			},

			_handleFilteredRoomsWithFavoriteIndicatorChange: function(filteredRoomsWithFavoriteIndicator, preferredRoomsSwitchActive) {
				var filteredRoomsAvailable = [];
				var filteredRoomsGraphic = [];
				var filteredRoomsAvailability = [];
			
				if (filteredRoomsWithFavoriteIndicator  != null) {
					for (var index = 0; index < filteredRoomsWithFavoriteIndicator.length; index++) {
						var room = filteredRoomsWithFavoriteIndicator[index];
						var isFavorite = preferredRoomsSwitchActive ? room.isFavorite : true;
						if (isFavorite) {
							if (this._isAvailable(room)) {
								filteredRoomsAvailable.push(room);
							} 
							filteredRoomsGraphic.push(room);
							filteredRoomsAvailability.push(room);
						}
					}
				}
				console.log(filteredRoomsAvailable,'filtered rooms available')
				console.log(filteredRoomsGraphic,'filtered rooms Graphic')
				console.log(filteredRoomsAvailability,'filtered rooms avaibality')
				
				this._filteredRoomsAvailable = filteredRoomsAvailable;
				this._filteredRoomsGraphic = filteredRoomsGraphic;
				this._filteredRoomsAvailability = filteredRoomsAvailability;
				this._showEmptyListPage = filteredRoomsAvailable.length == 0;
			},

			_preferredRoomsFilterToggled: function(preferredRoomsSwitchActive) {
				// need to notify resize on the iron-list when it comes into view
				// if (!preferredRoomsSwitchActive) this.$.allRoomsList.notifyResize();
				this._clearSelectedRoom();
			},

			// check to see if we got here as part of the exception assignment process
			// otherwise, let the event bubble-upwards
			_handleBookRoom: function(e) {
				this._clearSelectedRoom();
				this.fire("book-room");
				if (this.occurrenceId) {
					e.stopPropagation();

					var roomId = e.detail.roomId;
					this.fire("action-exception-assign", { 'roomId' : roomId, 'occurrenceId': this.occurrenceId });
				}
			},

			ready: function() {
				this.smallScreenMaxHeight = "600px";
			},

			_pageAttached : function(searchInitiated) {
				this.currentTime = new Date();
				this._refreshResultsData(searchInitiated);
				window.addEventListener("orientationchange", this.refresh.bind(this));
			},

			_pageDetached : function() {
				this.$.searchInput.clearSearch();
				this.set("_selectedTab", "listTab");
				window.removeEventListener("orientationchange", this.refresh.bind(this));
			},

			_refreshResultsData: function(searchInitiated) {
				this.debounce('_refreshResultsData', function () {
					this.$.lookupRoom.refresh().then(function(){
						if (searchInitiated) {
							this.set("_searchInitiated", searchInitiated);
						}
						this.set("_hideResults", false);
					}.bind(this));
					this.$.lookupFloorSearchResults.refresh();
				}, 150);
			},

			_computeInfoMessage: function(searchInitiated, hideResults) {
				if (!searchInitiated || hideResults) {
					var __dictionary__clickSearch = "Click on the Search action to refresh the rooms for the given search criteria.";
					return __dictionary__clickSearch;
				} else {
					var __dictionary__noRooms = "No matching rooms found for the given search criteria.";
					return __dictionary__noRooms;
				}
			},

			//show info message if there is no result OR hideresult
			_hideInfoMessage: function(hasResults, hideResults) {
				return hasResults && !hideResults;
			}, 

			_hideResultsContainer: function(hideResults, hasResults) {
				return hideResults || !hasResults;
			},

			hideResultsSection: function () {
				this.set("_hideResults", true );
			},

			_handleSelectedTab: function (selectedTab) {
				if(selectedTab == "availabilityTab") {
					if(this._refreshAvailability) {
						this._rowLimitAlertMessage = "";
						this.$$("#availabilityComp").refresh();
						this._refreshAvailability = false;
					} else {
						this.$$("#availabilityComp").scrollToCurrentOccurrence();
					}
				} else if (selectedTab == "floorplanTab") {
					this.$.floorplan.refreshViewBox();
				}
			},

			_handleSelectedFloorChange: function(value, oldValue) {
				this._clearSelectedRoom();
				this.$.floorplan.refreshViewBox();
			},

			_handleFloorsChange: function(value, oldValue) {
				// pre-process the floors to create a new calculated property (bldgfloor) as "Building - Floor"
				for (var i=0; i<value.length; i++) {
					var floor = value[i];
					floor.bldgfloor = floor.building + " - " + floor.floor;
				}

				// reset the current floor selection - if the floor was filtered-out
				if (value && value.length > 0) {
					if (this._selectedFloor.id == null) {
						// set to the first item
						this.set("_selectedFloor", {id: value[0]._id, value: value[0].bldgfloor});
					} else {
						var bFound = false;
						for (var i=0; i<value.length; i++) {
							var floor = value[i];
							if (floor._id == this._selectedFloor.id) {
								bFound = true;
								break;
							}
						}

						if (!bFound) {
							// set to the first item
							this.set("_selectedFloor", {id: value[0]._id, value: value[0].bldgfloor});
						}
					}
				} else {
					this.set("_selectedFloor", {id: null, value: null});
				}
			},

			_clearSelectedRoom: function() {
				this.set("_selectedRoom", null);
			},

			_getLabelId: function (change) {
				var labelId = null;
				if (change.base && change.base.length > 0) {
					return change.base[0]._id;
				}
				return labelId;
			},

			_handleResourceClick: function(e){
				var resourceId = e.detail.resourceId;
				this.fire("navigate-room-details", {roomId: resourceId, backEventName: 'navigate-room-results-back'});
			},

			_handleRowLimit: function(e){
				this._rowLimitAlertMessage = e.detail;
			},

			_computeLoading: function(lookupFloorSearchResultsLoading, lookupRoomLoading, availabilityLoading) {
				return lookupFloorSearchResultsLoading || lookupRoomLoading || availabilityLoading;
			},

			_computeShowAvailabilityTab: function(smallScreenWidth, smallScreenHeight, hideAvailabilityTab) {
				return (hideAvailabilityTab) ? false : (!smallScreenWidth && !smallScreenHeight);
			},

			_computeShowRowLimitAlert: function(rowLimitAlertMessage) {
				return rowLimitAlertMessage != null && rowLimitAlertMessage.length > 0;
			},

			_computeSpaceLabelID: function(isWorkspaceRoom) {
				return isWorkspaceRoom ? "triPeople001" : "triSpace002";
			}
		});
	</script>
</dom-module>


<script>

  Polymer({

    is: 'scale-up-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;

      var scaleProperty = 'scale(0)';
      if (config.axis === 'x') {
        scaleProperty = 'scale(0, 1)';
      } else if (config.axis === 'y') {
        scaleProperty = 'scale(1, 0)';
      }

      this._effect = new KeyframeEffect(node, [
        {'transform': scaleProperty},
        {'transform': 'scale(1, 1)'}
      ], this.timingFromConfig(config));

      if (config.transformOrigin) {
        this.setPrefixedProperty(node, 'transformOrigin', config.transformOrigin);
      }

      return this._effect;
    }

  });

</script>



<dom-module id="iron-autogrow-textarea" assetpath="../iron-autogrow-textarea/">
  <template>
    <style>
      :host {
        display: inline-block;
        position: relative;
        width: 400px;
        border: 1px solid;
        padding: 2px;
        -moz-appearance: textarea;
        -webkit-appearance: textarea;
        overflow: hidden;
      }

      .mirror-text {
        visibility: hidden;
        word-wrap: break-word;
      }

      .fit {
        @apply(--layout-fit);
      }

      textarea {
        position: relative;
        outline: none;
        border: none;
        resize: none;
        background: inherit;
        color: inherit;
        /* see comments in template */
        width: 100%;
        height: 100%;
        font-size: inherit;
        font-family: inherit;
        line-height: inherit;
        text-align: inherit;
        @apply(--iron-autogrow-textarea);
      }

      ::content textarea:invalid {
        box-shadow: none;
      }

      textarea::-webkit-input-placeholder {
        @apply(--iron-autogrow-textarea-placeholder);
      }

      textarea:-moz-placeholder {
        @apply(--iron-autogrow-textarea-placeholder);
      }

      textarea::-moz-placeholder {
        @apply(--iron-autogrow-textarea-placeholder);
      }

      textarea:-ms-input-placeholder {
        @apply(--iron-autogrow-textarea-placeholder);
      }
    </style>

    
    
    <div id="mirror" class="mirror-text" aria-hidden="true">&nbsp;</div>

    
    <div class="textarea-container fit">
      <textarea id="textarea" name$="[[name]]" autocomplete$="[[autocomplete]]" autofocus$="[[autofocus]]" inputmode$="[[inputmode]]" placeholder$="[[placeholder]]" readonly$="[[readonly]]" required$="[[required]]" disabled$="[[disabled]]" rows$="[[rows]]" minlength$="[[minlength]]" maxlength$="[[maxlength]]"></textarea>
    </div>
  </template>
</dom-module>

<script>

  Polymer({

    is: 'iron-autogrow-textarea',

    behaviors: [
      Polymer.IronFormElementBehavior,
      Polymer.IronValidatableBehavior,
      Polymer.IronControlState
    ],

    properties: {

      /**
       * Use this property instead of `value` for two-way data binding.
       * This property will be deprecated in the future. Use `value` instead.
       * @type {string|number}
       */
      bindValue: {
        observer: '_bindValueChanged',
        type: String
      },

      /**
       * The initial number of rows.
       *
       * @attribute rows
       * @type number
       * @default 1
       */
      rows: {
        type: Number,
        value: 1,
        observer: '_updateCached'
      },

      /**
       * The maximum number of rows this element can grow to until it
       * scrolls. 0 means no maximum.
       *
       * @attribute maxRows
       * @type number
       * @default 0
       */
      maxRows: {
       type: Number,
       value: 0,
       observer: '_updateCached'
      },

      /**
       * Bound to the textarea's `autocomplete` attribute.
       */
      autocomplete: {
        type: String,
        value: 'off'
      },

      /**
       * Bound to the textarea's `autofocus` attribute.
       */
      autofocus: {
        type: Boolean,
        value: false
      },

      /**
       * Bound to the textarea's `inputmode` attribute.
       */
      inputmode: {
        type: String
      },

      /**
       * Bound to the textarea's `placeholder` attribute.
       */
      placeholder: {
        type: String
      },

      /**
       * Bound to the textarea's `readonly` attribute.
       */
      readonly: {
        type: String
      },

      /**
       * Set to true to mark the textarea as required.
       */
      required: {
        type: Boolean
      },

      /**
       * The minimum length of the input value.
       */
      minlength: {
        type: Number
      },

      /**
       * The maximum length of the input value.
       */
      maxlength: {
        type: Number
      }

    },

    listeners: {
      'input': '_onInput'
    },

    observers: [
      '_onValueChanged(value)'
    ],

    /**
     * Returns the underlying textarea.
     * @type HTMLTextAreaElement
     */
    get textarea() {
      return this.$.textarea;
    },

    /**
     * Returns textarea's selection start.
     * @type Number
     */
    get selectionStart() {
      return this.$.textarea.selectionStart;
    },

    /**
     * Returns textarea's selection end.
     * @type Number
     */
    get selectionEnd() {
      return this.$.textarea.selectionEnd;
    },

    /**
     * Sets the textarea's selection start.
     */
    set selectionStart(value) {
      this.$.textarea.selectionStart = value;
    },

    /**
     * Sets the textarea's selection end.
     */
    set selectionEnd(value) {
      this.$.textarea.selectionEnd = value;
    },

    /**
     * Returns true if `value` is valid. The validator provided in `validator`
     * will be used first, if it exists; otherwise, the `textarea`'s validity
     * is used.
     * @return {boolean} True if the value is valid.
     */
    validate: function() {
      // Empty, non-required input is valid.
      if (!this.required && this.value == '') {
        this.invalid = false;
        return true;
      }

      var valid;
      if (this.hasValidator()) {
        valid = Polymer.IronValidatableBehavior.validate.call(this, this.value);
      } else {
        valid = this.$.textarea.validity.valid;
        this.invalid = !valid;
      }
      this.fire('iron-input-validate');
      return valid;
    },

    _bindValueChanged: function() {
      var textarea = this.textarea;
      if (!textarea) {
        return;
      }

      // If the bindValue changed manually, then we need to also update
      // the underlying textarea's value. Otherwise this change was probably
      // generated from the _onInput handler, and the two values are already
      // the same.
      if (textarea.value !== this.bindValue) {
        textarea.value = !(this.bindValue || this.bindValue === 0) ? '' : this.bindValue;
      }

      this.value = this.bindValue;
      this.$.mirror.innerHTML = this._valueForMirror();
      // manually notify because we don't want to notify until after setting value
      this.fire('bind-value-changed', {value: this.bindValue});
    },

    _onInput: function(event) {
      this.bindValue = event.path ? event.path[0].value : event.target.value;
    },

    _constrain: function(tokens) {
      var _tokens;
      tokens = tokens || [''];
      // Enforce the min and max heights for a multiline input to avoid measurement
      if (this.maxRows > 0 && tokens.length > this.maxRows) {
        _tokens = tokens.slice(0, this.maxRows);
      } else {
        _tokens = tokens.slice(0);
      }
      while (this.rows > 0 && _tokens.length < this.rows) {
        _tokens.push('');
      }
      // Use &#160; instead &nbsp; of to allow this element to be used in XHTML.
      return _tokens.join('<br/>') + '&#160;';
    },

    _valueForMirror: function() {
      var input = this.textarea;
      if (!input) {
        return;
      }
      this.tokens = (input && input.value) ? input.value.replace(/&/gm, '&amp;').replace(/"/gm, '&quot;').replace(/'/gm, '&#39;').replace(/</gm, '&lt;').replace(/>/gm, '&gt;').split('\n') : [''];
      return this._constrain(this.tokens);
    },

    _updateCached: function() {
      this.$.mirror.innerHTML = this._constrain(this.tokens);
    },

    _onValueChanged: function() {
      this.bindValue = this.value;
    }
  });
</script>
<dom-module id="paper-textarea" assetpath="../paper-input/">
  <template>
    <style>
      :host {
        display: block;
      }

      :host([hidden]) {
        display: none !important;
      }

      label {
        pointer-events: none;
      }
    </style>

    <paper-input-container no-label-float$="[[noLabelFloat]]" always-float-label="[[_computeAlwaysFloatLabel(alwaysFloatLabel,placeholder)]]" auto-validate$="[[autoValidate]]" disabled$="[[disabled]]" invalid="[[invalid]]">

      <label hidden$="[[!label]]" aria-hidden="true">[[label]]</label>

      <iron-autogrow-textarea id="input" class="paper-input-input" bind-value="{{value}}" invalid="{{invalid}}" disabled$="[[disabled]]" autocomplete$="[[autocomplete]]" autofocus$="[[autofocus]]" inputmode$="[[inputmode]]" name$="[[name]]" placeholder$="[[placeholder]]" readonly$="[[readonly]]" required$="[[required]]" minlength$="[[minlength]]" maxlength$="[[maxlength]]" autocapitalize$="[[autocapitalize]]" rows$="[[rows]]" max-rows$="[[maxRows]]" on-change="_onChange"></iron-autogrow-textarea>

      <template is="dom-if" if="[[errorMessage]]">
        <paper-input-error>[[errorMessage]]</paper-input-error>
      </template>

      <template is="dom-if" if="[[charCounter]]">
        <paper-input-char-counter></paper-input-char-counter>
      </template>

    </paper-input-container>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'paper-textarea',

    behaviors: [
      Polymer.PaperInputBehavior,
      Polymer.IronFormElementBehavior
    ],

    properties: {
      _ariaLabelledBy: {
        observer: '_ariaLabelledByChanged',
        type: String
      },

      _ariaDescribedBy: {
        observer: '_ariaDescribedByChanged',
        type: String
      },

      /**
       * The initial number of rows.
       *
       * @attribute rows
       * @type number
       * @default 1
       */
      rows: {
        type: Number,
        value: 1
      },

      /**
       * The maximum number of rows this element can grow to until it
       * scrolls. 0 means no maximum.
       *
       * @attribute maxRows
       * @type number
       * @default 0
       */
      maxRows: {
       type: Number,
       value: 0
      }
    },

    _ariaLabelledByChanged: function(ariaLabelledBy) {
      this.$.input.textarea.setAttribute('aria-labelledby', ariaLabelledBy);
    },

    _ariaDescribedByChanged: function(ariaDescribedBy) {
      this.$.input.textarea.setAttribute('aria-describedby', ariaDescribedBy);
    },

    get _focusableElement() {
      return this.$.input.textarea;
    },
  });
</script>
<dom-module id="tricomp-reservation-summary-item" assetpath="">
	<template>
		<style include="shared-page-styles">
			:host {
				@apply(--layout-vertical);
				flex-basis: 100%;
				position: relative;
				min-width: 0;
				border-bottom: 1px solid var(--ibm-gray-50);
				padding-bottom: 10px;
				cursor: pointer;
				background-color: white;
			}
			:host:first-of-type {
				border-top: 1px solid var(--ibm-gray-50);
			}

			tricomp-alert-message {
				margin-bottom: 3px;
			}

			paper-tooltip {
				font-weight: normal;

				--paper-tooltip: {
					line-height: 1.2em;
					font-size: 14px;
				}
			}

			.room-name-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--layout-start-justified);
				padding: 10px 0;
			}

			.room-name {
				min-width: 0;
				overflow: hidden;
				color: var(--ibm-blue-50);
			}

			.divider-line {
				height: 24px;
				width: 1px;
				background-color: var(--tri-primary-content-accent-color);
				margin: 0 10px;
			}

			.favorite-icon {
				flex-shrink: 0;
				height: 22px;
				width: 22px;
				padding: 0px;
				color: var(--ibm-blue-50);
			}

			.info-container,
			.info-location,
			.info-action {
				@apply(--layout-horizontal);
				box-sizing: border-box;
			}

			.info-container {
				@apply(--layout-wrap);
				@apply(--layout-center);
				@apply(--layout-justified);
			}

			.info-container > div {
				@apply(--layout-flex);
				flex-basis: 100%;
			}
			
			.info-location  {
				min-width: 0;
			}
			:host:not([small-screen-width]):not([medium-screen-width]) .info-location {
				flex-basis: 50%;
				max-width: 50%;
				padding-right: 10px;
			}

			.info-action {
				@apply(--layout-center);
				@apply(--layout-justified);
				margin-top: 10px;
			}
			:host:not([small-screen-width]):not([medium-screen-width]) .info-action {
				flex-basis: 49%;
				max-width: 49%;
				margin: 0px;
				border-left: 1px solid var(--ibm-gray-10);
				padding-left: 10px;
			}

			.delete-button {
				box-sizing: content-box;
				white-space: nowrap;
			}

			.room-image-container {
				@apply(--layout-vertical);
				@apply(--layout-start);
				@apply(--layout-relative);
			}

			.room-image {
				width: 63px;
				height: 63px;
			}

			.room-image-placeholder-icon {
				--triplat-icon-height: 63px;
				--triplat-icon-width: 63px;
				--triplat-icon-fill-color: var(--tri-primary-content-accent-color);
			}

			.room-details-container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				min-width: 0;
				padding-left: 10px;
			}

			.room-info {
				@apply(--paper-font-common-nowrap);
				font-size: 14px;
			}

			.amenities-list {
				padding-top: 10px;
			}

			.declined-message {
				background-color: var(--tri-danger-color);
				@apply(--layout-vertical);
				@apply(--layout-center-center);
				color: white;
				text-align: center;
				padding: 10px;
			}

			.tappable-rows-section {
				margin-top: 10px;
				border-top: 1px solid var(--tri-primary-content-accent-color);
			}

			.row-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				padding: 0 12px 0 20px;
			}

			.row-container.tappable {
				border-top: 1px solid var(--tri-primary-content-accent-color);
				border-bottom: 1px solid var(--tri-primary-content-accent-color);
				cursor: pointer;
				margin-top: -1px; /* this merges borders between rows */
				height: 44px;
			}

			.row-content {
				@apply(--layout-flex);
			}

			.row-label {
				color: var(--ibm-gray-50);
			}

			.row-content-count {
				font-weight: bold;
			}

			.expand-button {
				transform: rotate(90deg);
			}

			:host-context([dir="rtl"]) .expand-button {
                 transform: scaleX(-1);
            } 

		</style>

		<tricore-url raw-url="/getCompanyFile.jsp?fileLoc=" bind-url="{{imgUrl}}"></tricore-url>

		<triplat-ds id="exceptionOccurrences" name="exceptionOccurrences" filtered-data="{{exceptionOccurrences}}" loading="{{exceptionOccurrencesLoading}}">
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]">
			</triplat-ds-context>
			<triplat-query>
				<triplat-query-filter name="resourceId" operator="equals" value="[[item._id]]"></triplat-query-filter>
			</triplat-query>
		</triplat-ds>

		<triplat-ds id="equipmentOrders" name="equipmentOrders" filtered-data="{{equipmentOrders}}" loading="{{equipmentOrdersLoading}}">
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]">
			</triplat-ds-context>
			<triplat-query>
				<triplat-query-filter name="resourceId" operator="equals" value="[[item._id]]"></triplat-query-filter>
			</triplat-query>
		</triplat-ds>

		<triplat-ds id="foodOrders" name="foodOrders" data="{{foodData}}" filtered-data="{{foodOrders}}" loading="{{foodOrdersLoading}}">
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]">
			</triplat-ds-context>
			<triplat-query>
				<triplat-query-filter name="resourceId" operator="equals" value="[[item._id]]"></triplat-query-filter>
			</triplat-query>
		</triplat-ds>

		<tricomp-alert-message icon="ibm:clock-time" id="holdTimeMessage" info="[[!holdTimeExpired]]" warning="[[holdTimeExpired]]" class="hold-time-message" show$="[[item.holdTimeDeadline]]" show-tooltip-indicator-icon="">
			<span hidden$="[[holdTimeExpired]]">Hold expires in</span>
			<triplat-countdown class="hold-time-countdown" name="booking-expiration" disabled="[[_computeDisableCountdown(disabled, item.holdTimeDeadline)]]" deadline="[[item.holdTimeDeadline]]" expired-text="Hold time is expired." timezone="[[currentUser._TimeZoneId]]" is-expired="{{holdTimeExpired}}">
			</triplat-countdown>
		</tricomp-alert-message>

		<paper-tooltip for="holdTimeMessage" position="top" offset="5" animation-delay="100" fit-to-visible-bounds="">When the hold time on this room expires, all added food and equipment are not saved, and the room is removed for this reservation.</paper-tooltip>

		<tricomp-alert-message warning="" id="declinedMessage" class="alert-message" alert-title="[[item.status]]" hidden$="[[!_statusIsDeclined(item.statusENUS)]]">
			<div>[[item.userMessage]]</div>
		</tricomp-alert-message>

		<tricomp-alert-message info="" id="approvalMessage" class="alert-message" hidden$="[[!_isApprovalRequired(item.statusENUS, item.approvalNameENUS)]]" show-tooltip-indicator-icon="">[[item.approvalRequired]]</tricomp-alert-message>
		<paper-tooltip for="approvalMessage" position="top" offset="5" animation-delay="100" fit-to-visible-bounds="">Adding this room to your reservation requires approval from the room's owner, which may result in a delay of the acceptance of this room. You will be notified of the room owner's decision.</paper-tooltip>

		<tricomp-alert-message info="" id="costMessage" class="alert-message" hidden$="[[!_roomHasCost(item.usageCost)]]">This room has associated costs.</tricomp-alert-message>

		<tricomp-alert-message danger="" id="approvalMessage" class="alert-message" hidden$="[[!_computeIsPendingApproval(item.statusENUS)]]">This room has not yet been approved.</tricomp-alert-message>

		<div class="room-name-container">
			<span class="room-name tri-h3">[[item.room.value]]</span>
			<span class="divider-line"></span>
			<paper-icon-button class="favorite-icon" favorited$="[[item.isFavorite]]" icon="[[_computeFavIcon(item.isFavorite)]]" on-tap="_handleToggleFavoriteRoom" aria-label="Favorite Icon"></paper-icon-button>
		</div>

		<div class="info-container" on-tap="_handleOpenRoomDetails">
			<div class="info-location">
				<template is="dom-if" if="[[_showImage(applicationSettings)]]"> 
					<div class="room-image-container">
						<iron-image id="roomImage" class="room-image" src="{{_computeImageUrl(item.image, imgUrl)}}" sizing="cover" hidden$="[[!roomImageLoaded]]" loaded="{{roomImageLoaded}}"></iron-image>
						<triplat-icon class="room-image-placeholder-icon" icon="picturefile" hidden$="[[roomImageLoaded]]"></triplat-icon>
					</div>
				</template> 

				<div class="room-details-container">
					<div class="room-info">Capacity [[item.capacity]]</div>
					<div class="room-info">[[item.floor]]</div>
					<div id="buildingName" class="multiline-overflow-text">
						<tricomp-multiline-overflow-text text="[[item.building]]" parentelement="[[buildingEl]]"></tricomp-multiline-overflow-text>
					</div>
					
					<div class="room-info">[[item.layout]] layout</div>
				</div>
			</div>

			<div class="info-action">
				<tricomp-amenities-list class="amenities-list" catering="[[_isRoomServiceAvailable(item.isCateringAvailable)]]" disabled-access="[[_isRoomServiceAvailable(item.isADAAvailable)]]" network-connection="[[_isRoomServiceAvailable(item.isNetworkConnection)]]" phone-conference="[[_isRoomServiceAvailable(item.isConferencePhone)]]" projector="[[_isRoomServiceAvailable(item.isProjector)]]" video-conference="[[_isRoomServiceAvailable(item.isVideoConference)]]" whiteboard="[[_isRoomServiceAvailable(item.isWhiteboard)]]">
				</tricomp-amenities-list>

				<paper-button danger-outline="" on-tap="_handleRemoveBookedRoom" class="delete-button" noink="">Cancel Room</paper-button>
			</div>
		</div>

		<section class="tappable-rows-section" tabindex="0">
			<div class="row-container tappable" hidden$="[[!_isExceptionOccurrences(exceptionOccurrences)]]" on-tap="_handleNavigateExceptions" tabindex="0">
				<div class="row-content">
					<span class="row-label">Exceptions</span>
					<span class="row-content-count">&nbsp;[[exceptionOccurrences.length]]</span>
				</div>
				<paper-icon-button primary="" class="expand-button" icon="ibm-glyphs:expand-open"></paper-icon-button>
			</div>
			<div class="row-container tappable" hidden$="[[!_computeEnableEquipment(item)]]" on-tap="_handleNavigateEquipmentOrder" tabindex="0">
				<div class="row-content">
					<span class="row-label">Equipment</span>
					<span class="row-content-count">&nbsp;[[_equipmentOrders.length]]</span>
				</div>
				<paper-icon-button primary="" class="expand-button" icon="ibm-glyphs:expand-open"></paper-icon-button>
			</div>
			<div class="row-container tappable" hidden$="[[!_computeEnableFood(item)]]" on-tap="_handleNavigateFoodOrders" tabindex="0">
				<div class="row-content">
					<span class="row-label">Food</span>
					<span class="row-content-count">&nbsp;[[_foodOrders.length]]</span>
				</div>
				<paper-icon-button primary="" class="expand-button" icon="ibm-glyphs:expand-open"></paper-icon-button>
			</div>
		</section>
	</template>
	<script>
		Polymer({

			is: "tricomp-reservation-summary-item",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				item: {
					type: Object,
					observer: "_handleItemChange"
				},
				specId: {
					type: String,
					value: null,
				},
				equipmentOrders: Object,
				_equipmentOrders:{
					type: Array,
					value: function(){
						return [];
					},
				},
				foodOrders: Object,
				_foodOrders: Array,

				holdTimeExpired: {
					type: Boolean,
					value: false,
					notify: true
				},
				disabled: {
					type: Boolean,
					value: false
				},
				recurrence: Object,
			},

			observers: [
				"_handleEquipmentOrderChanges(equipmentOrders)",
				"_handleFoodOrderChanges(foodOrders)",
				"_handleRecurrenceChanges(recurrence)"
			],

			attached: function() {
				this.set("buildingEl", this.$.buildingName);
				this._handleItemIdReady();
			},

			_handleItemIdReady: function(){
				var resourceId = this.item._id;
				this.fire("update-resource-id", { 'resourceId' : resourceId });
			},

			_isExceptionOccurrences: function(exceptionOccurrences) {
				return exceptionOccurrences && exceptionOccurrences.length > 0;
			},

			_computeIsPendingApproval: function(status) {
				return status == 'Review In Progress';
			},

			_computeIsAccepted: function(status) {
				return status == 'Accepted';
			},

			_statusIsDeclined: function(status) {
				return status == "Declined";
			},

			_computeFoodOrderName: function(orderItem) {
				if (!orderItem)
					return "";

				if (orderItem.name && orderItem.name.length > 0) {
					return orderItem.name;
				} else {
					return "#" + orderItem.orderNum;
				}
			},

			_computeEnableEquipment: function(item) {
				return Boolean(item && (item.statusENUS && item.statusENUS != "Declined") && (item.roomDetails && item.roomDetails.data.isEquipmentServicesAvailable));
			},

			_computeEnableFood: function(item) {
				return Boolean(item && (item.statusENUS && item.statusENUS != "Declined") && (item.roomDetails && item.roomDetails.data.isFoodServicesAvailable));
			},

			_handleEquipmentOrderChanges: function(equipmentOrders) {
				this._equipmentOrders = new Array();

				if (equipmentOrders && equipmentOrders.constructor === Array) {
					for (var orderIndex=0; orderIndex < equipmentOrders.slice(0).length; orderIndex++) {
						var orderItem = equipmentOrders[orderIndex];

						if (orderItem.resourceId === this.item._id) {
							this.push("_equipmentOrders", orderItem);
						}
					}
				}
			},

			_handleFoodOrderChanges: function(foodOrders) {
				this._foodOrders = new Array();

				if (foodOrders && foodOrders.constructor === Array) {
					for (var orderIndex=0; orderIndex < foodOrders.slice(0).length; orderIndex++) {
						var orderItem = foodOrders[orderIndex];

						if (orderItem.resourceId === this.item._id) {
							this.push("_foodOrders", orderItem);
						}
					}
				}
			},

			_computeDisableCountdown: function(disabled, holdTimeDeadline) {
				return disabled || !holdTimeDeadline;
			},

			_computeApprovalText: function(approval) {
				return approval;
			},

			_isEquipmentAllowed: function(equipmentSpecs) {
				return equipmentSpecs && equipmentSpecs.length > 0;
			},

			_isFoodAllowed: function(menuItems) {
				return menuItems && menuItems.length > 0;
			},

			_handleOpenBookedRoom: function(e) {
				var resourceId = this.item._id;
				this.fire("navigate-booked-room-details", { 'bookedRoomId' : resourceId });
			},

			_handleRemoveBookedRoom: function(e) {
				e.stopPropagation();
				
				var resourceId = this.item._id;
				this.fire("action-booked-room-remove", { 'bookedRoomId' : resourceId });
			},

			_handleNavigateExceptions: function(e) {
				var resourceId = this.item._id;
				this.fire("navigate-exceptions", { 'resourceId' : resourceId });
			},

			_handleNavigateEquipmentOrder: function(e) {
				var resourceId = this.item._id;
				this.fire("navigate-equipment-order", { 'resourceId' : resourceId, 'orderId' : "-1", 'room' : this.item.room.value });
			},

			_handleNavigateFoodOrders: function(e) {
				var resourceId = this.item._id;
				if (this._foodOrders != null && this._foodOrders.length > 0) {
					// navigate to Food Orders Summary page
					this.fire("navigate-food-orders-summary", { 'resourceId' : resourceId, 'room' : this.item.room.value });
				} else {
					// navigate directly to Add Food Order page
					if (resourceId) this.fire("navigate-food-order-add", { 'resourceId' : resourceId, 'orderId' : "-1", 'room' : this.item.room.value });
				}
			},

			_getOrderId: function(e) {
				if (e.target.orderId != undefined) {
					return e.target.orderId;
				} else {
					console.log("*** ERROR: [orderId] property is not set on the target.");
					return null;
				}
			},

			_getRoomId: function() {
				return this.item.room.id;
			},

			_computeFavIcon: function(isFav) {
				return isFav ? "ibm:rating-star-filled" : "ibm:rating-star";
			},

			_handleItemChange: function(item) {
				var isRecurring = this._isRecurring(item);
				var isAvailable = this._isAvailable(item);
				var hideItem = isRecurring && !isAvailable;
				this.toggleAttribute("hidden", hideItem);
				this._handleItemIdReady();
			},

			_handleOpenRoomDetails: function(e) {
				var roomId = this.item.room.id;
				var resourceId = this.item._id;
				this.fire("navigate-room-details", { 'roomId': roomId, 'backEventName': "navigate-summary-page-back", 'resourceId': resourceId });
			},

			_handleToggleFavoriteRoom: function(e) {
				var roomId = this._getRoomId();
				var isFavorite = this.item.isFavorite;
				this.fire("action-toggle-room-favorite", { 'roomId' : roomId, 'isFavorite' : !isFavorite });
			},

			_isApprovalRequired: function(status, approvalNameENUS) {
				return !this._computeIsPendingApproval(status) && (!this._computeIsAccepted(status) && approvalNameENUS && approvalNameENUS === "Requestable");
			},

			_noLocation: function(city, state, country) {
				return (!city || city == "") && (!state || state == "") && (!country || country == "");
			},

			_handleRecurrenceChanges: function(recurrence) {
				this.async(function() {
					this.$.exceptionOccurrences.refresh();
				}, 300);
			},

			_roomHasCost: function(cost) {
				return cost && cost > 0;
			}

		});
	</script>
</dom-module>
<dom-module id="tricomp-reservation-summary" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
			}

			.row-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				padding: 10px 0;
			}

			.row-container.tappable {
				cursor: pointer;
				border-bottom: 1px solid var(--tri-primary-content-accent-color);
			}
			.row-container.tappable[disabled] {
				pointer-events: none;
				cursor: default;
			}

			.row-label {
				@apply(--layout-flex);
				padding: 12px 10px 12px 20px;
			}

			paper-dialog {
				overflow: auto;
			}

			.warning-text { 
				color: red;
				font-weight: bold;
			}

			.no-rooms-alert {
				margin: 10px 20px 10px 0px;
			}

			.instructions-container {
				@apply(--layout-vertical);
			}

			.instructions-label {
				padding-top: 20px;
			}

			.instructions {
				border: 1px solid var(--ibm-gray-30);
				resize: none;
				outline: none;
				box-shadow: none;
				font-size: inherit;
				font-family: inherit;
				margin: 10px 0;
			}

			:host([small-screen-width]) .page-main {
				display: block;
				@apply(--layout-flex-none);
			}
			
			.card-container {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				@apply(--layout-wrap);
				@apply(--layout-justified);
				@apply(--layout-scroll);
				align-content: flex-start;
				min-width: 0;
				padding: 20px 0;
			}

			.sub-page {
				@apply(--layout-flex);
				padding-right: 20px
			}

			.add-room-card {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				flex-basis: 100%;
				padding: 20px 0;
			}
			:host:not([small-screen-width]) .add-room-card {
				@apply(--layout-end-justified);
			}
			
			:host([small-screen-width]) .action-bar-space {
				height: 55px;
			}	
			
			#subjectlabel{
				font-size:13px;
			}

			.required-asterisk {
				color: var(--tri-danger-color);
				font-size: 14px;
			}

			.subject-container {
				padding-top: 8px;
			}
			
			paper-textarea {
				word-break: break-all;
			}

		</style>

		<triplat-ds id="roomTypes" name="roomTypes" data="{{roomTypes}}"></triplat-ds>

		<div class="page-main">
			<div class="page-wrap">
				<template is="dom-if" if="[[!hideSummary]]">
					<tricomp-alert-message info="" id="outlook-reservation" hidden$="[[!_isReadOnlyOutlook(isOutlookEmbedded, reservationManager)]]" show-tooltip-indicator-icon="">Created in Outlook</tricomp-alert-message>
					<paper-tooltip for="outlook-reservation" position="bottom" offset="5" animation-delay="100" fit-to-visible-bounds="">This reservation was created in Microsoft Outlook. Parts of this reservation are editable in Outlook only.</paper-tooltip>

					<tricomp-alert-message error="" hidden$="[[!_showMissingSubjectMessage]]">
						<div>Provide a subject for the reservation.</div>
					</tricomp-alert-message>

					<tricomp-alert-message warning="" hidden$="[[!reservationManager.userMessage]]">
						<div>[[reservationManager.userMessage]]</div>
					</tricomp-alert-message>

						<template is="dom-if" if="[[!isOutlookEmbedded]]">
							<section class="padded-container subject-container">
								<label id="subjectlabel"><span class="required-asterisk">*</span>Subject</label>
								<paper-textarea no-label-float="" value="{{reservationManager.reservationSubject}}" maxlength="150" readonly$="[[_readonlySubject(isOutlookEmbedded, reservationManager)]]" required="">
								</paper-textarea>
							</section>

						<tricomp-room-criteria-when id="criteriaWhen" class="padded-container" reservation-manager="{{reservationManager}}" current-user="[[currentUser]]" is-workspace-room="[[_isRoomTypeWorkspace(reservationManager.searchRoomType, _workspaceId)]]" is-meeting-room="[[_isRoomTypeMeetingSpace(reservationManager.searchRoomType, _meetingSpaceId)]]" has-booked-rooms="[[hasBookedRooms]]" active="[[active]]" disabled="[[_disableCriteriaWhen]]">
						</tricomp-room-criteria-when>

						<div class="instructions-container padded-container">
							<label class="instructions-label" aria-label="Instructions">Instructions</label>
							<textarea id="instructionsField" class="instructions" rows="3" maxlength="250" value="[[_computeInstructions(reservationManager.reservationInstructions)]]" on-input="_handleInstructionsChanged"></textarea>
						</div>
					</template>

					<tricomp-reservation-lifecycle-events timezone="[[currentUser._TimeZoneId]]" disabled="[[_computeLifeCycleDisabled(reservationLocations)]]" check-in-required="[[reservationManagerInstance.checkInRequired]]" check-in-reminder="[[reservationManagerInstance.checkInReminderDateTime]]" check-in-auto-cancel="[[reservationManagerInstance.cancellationAutoDateTime]]" planned-start="[[reservationManagerInstance.startDateTime]]" planned-end="[[reservationManagerInstance.endDateTime]]" actual-start="[[reservationManagerInstance.actualStart]]" actual-end="[[reservationManagerInstance.actualEnd]]" reservation-instance="[[reservationManagerInstance]]" on-checkin="_handleCheckIn" on-checkout="_handleCheckOut" on-earlyend="_handleEarlyEnd" on-start="_handleStart" on-end="_handleEnd" on-autocancel="_handleAutoCancel">
					</tricomp-reservation-lifecycle-events>
				</template>

				<template is="dom-if" if="[[!hideItems]]">
					<tricomp-alert-message warning="" class="no-rooms-alert" hidden$="[[!_showNoRoomsMessage]]">
						<div>You need to add a room to this reservation.</div>
					</tricomp-alert-message>

					<div class="sub-page">
						<div class="card-container">
							<template is="dom-repeat" items="[[reservationLocations]]">
								<tricomp-reservation-summary-item item="{{item}}" current-user="[[currentUser]]" application-settings="[[applicationSettings]]" spec-id="[[specId]]" recurrence="[[recurrence]]" medium-screen-max-width="800px" ,="" on-hold-time-expired-changed="_handleHoldTimeExpiredChanged">
								</tricomp-reservation-summary-item>
							</template>

							<div class="add-room-card">
								<paper-button secondary="" on-tap="_handleAddAnotherRoom" tabindex="0" on-keypress="_handleKeyboardAddRoom" aria-label="Add another room" hidden$="[[_isReadOnlyOutlook(isOutlookEmbedded, reservationManager)]]">Add another room</paper-button>
							</div>
						</div>
					</div>
				</template>

				<div class="action-bar-space"></div>
			</div>
		</div>
	</template>
	<script>
		Polymer({

			is: "tricomp-reservation-summary",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				currentUser: {
					type: Object
				},

				reservationManager: {
					type: Object
				},

				isOutlookEmbedded: {
					type: Object
				},

				hasBookedRooms: {
					type: Boolean,
					value: false
				},

				active: {
					type: Boolean,
					value: false
				},

				_showMissingSubjectMessage: {
					type: Boolean,
					value: false,
					observer: '_handleMissingSubjectMessageChanged'
				},

				hideSummary: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},

				hideItems: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},

				roomTypes: {
					type: Array,
					observer: "_handleRoomTypesChange"
				},

				_disableCriteriaWhen: {
					type: Boolean,
					value: false,
					computed: "_computeDisableCriteriaWhen(isOutlookEmbedded, reservationManager)"
				},

				_showNoRoomsMessage: {
					type: Boolean,
					value: false
				},

				recurrence: Object
			},

			observers: [
				"_loadedWorkspaceId(reservationManager.searchRoomType, _workspaceId)",
				"_computeShowNoRoomsMessage(isOutlookEmbedded, reservationManager, reservationLocations)",
				"_handleSubjectChange(reservationManager.reservationSubject)"
			],

			_handleSubjectChange: function(reservationSubject) {
				if (reservationSubject && reservationSubject.length > 150) {
					this.set("reservationManager.reservationSubject", reservationSubject.substring(0,150));
				}
			},	

			_handleMissingSubjectMessageChanged: function(value) {
				if (value) {
					this._focusSubjectField();
				}
			},

			_focusSubjectField: function() {
				var subjectField = this.$$("#subjectField");
				if (subjectField) {
					subjectField.focus();
				} 
			},

			_computeShowNoRoomsMessage: function(isOutlookEmbedded, reservationManager, reservationLocations) {
				var showNoRoomsMessage = false;
				if (!this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager)) {
					showNoRoomsMessage = !this._hasNonExpiredResources(reservationLocations);
				}
				this._showNoRoomsMessage = showNoRoomsMessage;
			},

			_computeIsPendingApproval: function(status) {
				return status == 'Review In Progress';
			},

			_computeIsDeclined: function(status) {
				return status == 'Declined';
			},

			_computeLifeCycleDisabled: function(reservationResources) {
				var disableLifeCycle = false;
				if (reservationResources && reservationResources.length > 0) {
					for (var i = 0; i < reservationResources.length; i++) {
						var room = reservationResources[i];
						if (this._computeIsDeclined(room.statusENUS) || this._computeIsPendingApproval(room.statusENUS)) {
							disableLifeCycle = true;
							break;
						}
					}
				}
				return disableLifeCycle;
			},

			_handleAddAnotherRoom: function(e) {
				this.fire("navigate-room-results-dramatic", {'backEventName': "navigate-summary-page-back"});
			},

			_handleNavigateRecurrence: function(e) {
				this.fire("navigate-recurrence", {"backEventName": "navigate-summary-page-back"});
			},

			_handleRoomTypesChange: function() {
				this.fire("room-types-changed", {roomTypes: this.roomTypes});
			},

			// override
			_pageAttached : function() {
				this.async(function(){
					this._focusSubjectField();
				}, 100);
				this._showMissingSubjectMessage = false;
			},

			_computeInstructions: function(reservationInstructions) {
				return reservationInstructions != null ? reservationInstructions : "";
			},

			_handleInstructionsChanged: function(event) {
				this.reservationManager.reservationInstructions = event.currentTarget.value;
			},

			_loadedWorkspaceId: function(searchRoomType, workspaceId){
				if (!this._isRoomTypeWorkspace(searchRoomType, workspaceId)) {					
						if(this.$$("#subjectField")){
							if(!this.$$("#subjectField").value){
							this._focusSubjectField();
						    }
					    }
				}
			},

			_computeDisableCriteriaWhen: function(isOutlookEmbedded, reservationManager) {
				return this._isReadOnlyOutlook(isOutlookEmbedded, reservationManager);
			}, 
			
			_handleKeyboardAddRoom: function(e){
				if (e.which == 13 || e.keyCode == 13) {
					this._handleAddAnotherRoom(e);
				}
			},

			_handleHoldTimeExpiredChanged: function(e) {
				if (e.detail.value) {
					this._computeShowNoRoomsMessage(this.isOutlookEmbedded, this.reservationManager, this.reservationLocations);
					this.debounce(
						"refresh-reservation-locations",
						this.fire.bind(this, "refresh-reservation-locations"),
						30000
					);
				}
			}
		});
	</script>
</dom-module>


<dom-module id="triplat-auth-check" assetpath="../triplat-auth-check/">
	<template>

		<tricore-url hidden="" raw-url="/p/auth" bind-url="{{_authUrl}}">
		</tricore-url>

	</template>
	<script>
		(function () {
			var models = {};

			Polymer({

				is: "triplat-auth-check",

				/** 
				* Fired after checking the authorization.
				* <br>The event detail is the auth object
				* and follows the same format.
				*
				* @event check-complete
				*/

				properties: {
					/**
					* The name of the app whose authorization will be checked.
					*/
					appName: {
						type: String,
						value: ""
					},

					/**
					* Holds the current authorization result for the user.
					* It has the following format:<br> 
					* <b>{hasLicense: true/false, canRead: true/false, 
					* canCreate: true/false, canDelete: true/false,
					* canUpdate: true/false}</b>
					*/
					auth: {
						type: Object,
						readOnly: true,
						notify: true
					},

					/**
					* The name of the model whose authorization will be checked.
					*/
					modelName: {
						type: String,
						value: ""
					},

					_authAjax: {
						type: Object,
						notify: false,
						readOnly: true
					},

					_authUrl: {
						type: String
					}
				},

				observers: [
					'_triggerRequestForAuth(appName, modelName, _authUrl)'
				],

				/**
				 * Returns the permission for the specified action. 
				 * It's necessary to provide the exposed name of the model, action, action group, and data sources path. 
				 * The data sources path is the hierarchy of data sources where the action was defined.
				 *
				 * @param {String} modelName The model exposed name where the action was created.
				 * @param {String} actionName The action exposed name.
				 * @param {String} actionGroup The action group exposed name where the action was created.
				 * @param {String} dataSourcesPath The data sources path. It has the following format: "parent_datasource/child_datasource".
				 * @return {Promise}
				 */
				getActionPermission: function(modelName, actionName, actionGroup, dataSourcesPath) {
					return this.getModelPermission(modelName)
						.then(modelPermission => this._checkActionPermission(modelName, actionName, actionGroup, dataSourcesPath));
				},

				_checkActionPermission: function(modelName, actionName, actionGroup, dataSourcesPath) {
					return new Promise(
						function (resolve, reject) {
							var currentAction = (models[modelName] && models[modelName].actions) ? 
									(models[modelName].actions.find(currentAction => currentAction.actionName == actionName && 
											currentAction.actionGroup == actionGroup && 
											currentAction.dataSourcesPath == dataSourcesPath)) :
									null;

							if (currentAction) {
								resolve(currentAction.permission);
							} else {
								reject("The specified action doesn't exist.");
							}
						}
					);
				},

				/**
				 * Returns the authorization result for the specified model. 
				 * It's necessary to provide the exposed name of the model.
				 *
				 * @param {String} modelName The model exposed name.
				 * @return {Promise}
				 */
				getModelPermission: function(modelName) {
					return this._triggerRequestForAuth("", modelName, this._authUrl).then(function() {
						return this.auth;
					}.bind(this));
				},

				_triggerRequestForAuth: function(appName, modelName, url) {
					if (url != "" && (appName != "" || modelName != "")) {
						if (modelName != "" && models && models[modelName]) {
							this._setAuth(models[modelName]);
							return Promise.resolve();
						}

						var params = {};
						if (appName) params.appName = appName;
						if (modelName) params.modelName = modelName;

						return this._createAuthRequest(params, url).then(
							function(response) {
								if (response.applicationNotFound) {
									return Promise.reject("'" + appName + "' application not found when requesting authorization check");
								} else if (response.modelNotFound) {
									return Promise.reject("'" + modelName + "' model not found when requesting authorization check");
								} else {
									var auth = {
										hasLicense: response.hasLicense,
										canRead: response.canRead,
										canCreate: response.canCreate,
										canDelete: response.canDelete,
										canUpdate: response.canUpdate
									}
									if (response && response.actions) auth.actions = response.actions;
									if (response && response.modelName) { 
										auth.modelName = response.modelName;
										models[auth.modelName] = auth;
									}
									this._setAuth(auth);
									this.fire("check-complete", auth);
								}
							}.bind(this),
							function(errorCode) { 
								// Just for sanity as there's a try/catch server side
								Promise.reject("Error when requesting authentication check - Error Code: " + errorCode);
							}
						);
					}
				},

				_createAuthRequest: function(params, url) {
					return new Promise(function(resolve, reject) {
						this._doAuthRequest(params, url, resolve, reject);
					}.bind(this));
				},

				_doAuthRequest: function(params, url, resolve, reject) {
					var _authAjax = this._authAjax;
					if (!_authAjax) {
						_authAjax = document.createElement("iron-ajax");
						_authAjax.url = url;
						_authAjax.addEventListener("response", 
							this._handleAuthResponse.bind(this));
						_authAjax.addEventListener("error", 
							this._onError.bind(this));
						_authAjax.method = "GET";
						_authAjax.handleAs = 'json';
						this._set_authAjax(_authAjax);
					}
					_authAjax.params = params;
					var request = _authAjax.generateRequest();
					request._promiseResolve = resolve;
					request._promiseReject = reject;
				},

				_handleAuthResponse: function(e) {
					var response = e.detail.response;
					e.detail._promiseResolve(response);
				},

				_onError: function(e) {
					var request = e.detail.request;
					request._promiseReject(request.xhr.status);
				},

				_cache: function() {
					var params = {appName: this.appName};
					return this._createAuthRequest(params, this._authUrl);
				}

			});
		})();
	</script>
</dom-module><dom-module id="tricomp-page-toolbar-button" assetpath="">
	<template>
		<style>
			:host {
				@apply(--layout-vertical);
				@apply(--layout-center-center);
				cursor: pointer;
				color: var(--tri-footer-color);
				padding: 5px;
			}

			:host[disabled] {
				opacity: 0.5;
				pointer-events: none;
			}

			.button-icon {
				--iron-icon-height: 32px;
				--iron-icon-width: 32px;
			}

			.button-label {
				text-align: center;
				font-size: 12px;
				font-weight: 100;
				margin-top: 2px;
			}
		</style>

		<iron-icon class="button-icon" icon="[[icon]]"></iron-icon>
		<div class="button-label">[[label]]</div>

	</template>
	<script>
		Polymer({

			is: "tricomp-page-toolbar-button",

			properties: {
				disabled: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},
				icon: String,
				label: String
			}

		});
	</script>
</dom-module>
<dom-module id="tricomp-page-toolbar" assetpath="">
	<template>
		<style>
			:host {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				overflow-x: hidden;
				flex-shrink: 0;
			}

			:host(:not([small-screen-width])) {
				padding: 15px 0;
			}

			:host([small-screen-width]) {
				background-color: var(--tri-footer-background-color);
				padding: 5px;
			}

			.content-container {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
			}

			.content-container-flex {
				@apply(--layout-flex);
				min-width: 0;
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
			}

			.toolbar-left {
				padding-left: 20px;
			}

			.toolbar-right {
				padding-right: 20px;
			}

			.wrapper-while-we-dont-support-desktop {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				max-width: var(--max-width-while-we-dont-support-desktop);
				width: 100%;
			}
		</style>

		<div class="wrapper-while-we-dont-support-desktop">
			<div class="content-container toolbar-left">
				<content select="[toolbar-left]"></content>
			</div>

			<div class="content-container-flex">
				<content select=":not([toolbar-left]):not([toolbar-right])"></content>
			</div>

			<div class="content-container toolbar-right">
				<content select="[toolbar-right]"></content>
			</div>
		</div>

	</template>
	<script>
		Polymer({

			is: "tricomp-page-toolbar",

			properties: {
				smallScreenWidth: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				}
			}
		});
	</script>
</dom-module>
<dom-module id="tricomp-reservation-list" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
			}

			.page-header {
				background-color: var(--ibm-neutral-2);
			}

			.header-text {
				font-weight: bold;
			}

			.action-bar {
				@apply(--layout-horizontal);
			}
			:host([small-screen]) .action-bar {
				@apply(--layout-center-center);
				@apply(--layout-fixed-bottom);
				padding: 10px 0;
				background-color: var(--tri-footer-background-color);
				color: var(--tri-footer-color);
				z-index: 102;
			}
			
			.list-header {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--layout-self-center);
				@apply(--layout-self-stretch);
				border-bottom: 1px solid var(--ibm-gray-30);
				background-color: white;
				height: 44px;
				padding: 10px 20px;
			}
			:host([small-screen]) .list-header {
				@apply(--layout-center-justified);
				padding-right: 0;
				padding-left: 0;
				border-bottom: 1px solid var(--ibm-gray-10);
			}

			.month {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--layout-center-justified);
				height: 100%;
				padding: 0 10px;
				font-size: 22px;
				color: var(--tri-primary-color);
			}

			paper-icon-button {
				width: 44px;
				height: 44px;
				padding: 10px;
				color: var(--tri-primary-color);
			}

			.page-main {
				background-color: var(--tri-body-background-color);
			}

			.page-wrap {
				@apply(--layout-flex);
				@apply(--layout-scroll);
				min-height: 0;
				background-color: var(--tri-primary-content-background-color);
			}

			.list {
				@apply(--layout-flex);
				@apply(--layout-vertical);
				padding: 20px 30px;
			}
			:host([small-screen]) .list {
				padding: 20px 15px;
			}

			.no-reservations-placeholder {
				@apply(--layout-flex);
				@apply(--layout-center-center);
				@apply(--layout-vertical);
				padding: 10px;
			}
			.no-reservations-placeholder > * {
				text-align: center;
				margin: 10px 0;
			}
			.no-reservations-placeholder-icon {
				height: 32px;
				width: 32px;
			}

		</style>

		<triplat-ds id="reservationInstances" name="reservationInstances" data="{{reservationInstances}}" loading="{{reservationInstancesLoading}}" manual="">
		</triplat-ds>

		<triplat-ds id="reservationsForPerson" name="reservationsForPerson" data="{{reservationsForPerson}}" loading="{{reservationsForPersonLoading}}">
			<triplat-ds-instance instance-id="[[currentUser.person.data._id]]"></triplat-ds-instance>
		</triplat-ds>

		<triplat-loading-indicator show="[[_isBusy(isBusy, reservationInstancesLoading, reservationsForPersonLoading)]]"></triplat-loading-indicator>

		<triplat-auth-check app-name="roomReservation" auth="{{auth}}">
		</triplat-auth-check>

		<div class="page-header">
			<div class="header-text tri-h2">My Reservations</div>
			<div class="action-bar">
				<paper-button footer$="[[smallScreen]]" on-tap="_handleNewReservation" hidden="[[!auth.canCreate]]">New Reservation</paper-button>
			</div>
		</div>

		<div class="list-header">
			<paper-icon-button icon="ibm-glyphs:backward" disabled="{{_previousMonthIsPast}}" on-tap="_goToPreviousMonth"></paper-icon-button>
			<div class="month">{{headerLabel}}</div>
			<paper-icon-button icon="ibm-glyphs:forward" on-tap="_goToNextMonth"></paper-icon-button>
		</div>

		<div class="page-main">
			<div class="page-wrap">
				<div class="list">
					<triapp-reservation-list id="reservationList" model-and-view="roomReservation" instance-id="-1" count="{{reservationCount}}" range-start="[[range.start]]" range-end="[[range.end]]" selected-month="[[selectedMonth]]" initial-month="{{_initialMonth}}" home-app="[[_homeApp]]" list-view=""></triapp-reservation-list>
				</div>
			</div>
		</div>

	</template>
	<script>
		Polymer({

			is: "tricomp-reservation-list",
			
			behaviors: [
				TriRoomReservationUtilBehavior,
				TriDateUtilities,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				selectedMonth: String,
				headerLabel: String,

				selectedISOStartDT: {
					type: String,
					notify: false
				},

				selectedISOEndDT: {
					type: String,
					notify: false
				},

				_previousMonthIsPast: {
					type: Boolean,
					value: true
				},
				currentUser: Object,
				favoriteRooms: Array,

				_lang: String,

				_initialMonth: Object	
			},

			observers: [
				'_setInitialYearMonth(_initialMonth.*)'
			],

			_goToNextMonth: function() {
				this._setSelectedMonthYear(1, this.currentUser._TimeZoneId);
			},

			_goToPreviousMonth: function() {
				this._setSelectedMonthYear(-1, this.currentUser._TimeZoneId);
			},

			_setSelectedMonthYear: function(monthInterval, timezone) {
				if (this.selectedISOStartDT && this.selectedISOEndDT) {
					var startMo = moment.tz(this.selectedISOStartDT, timezone);
					var endMo = moment.tz(this.selectedISOEndDT, timezone);

					// can I just use add(-1) for previous?
					if (monthInterval > 0) {
						startMo = moment(startMo).add(monthInterval, "M");
						endMo = moment(endMo).add(monthInterval, "M");
					} else {
						monthInterval = -monthInterval;
						startMo = moment(startMo).subtract(monthInterval, "M");
						endMo = moment(endMo).subtract(monthInterval, "M");
					}

					this._computePreviousMonthIsPast(startMo);

					var monthNameMo = moment.tz(startMo, timezone);
					monthNameMo.locale(this._lang);
					var monthName = monthNameMo.format("MMMM");

					var year = moment.tz(startMo, timezone).format("YYYY");
					this.set('selectedMonth', monthName);

					var startISO = startMo.format("YYYY-MM-DDTHH:mm:ss.SSSZ");

					var endISO = endMo.format("YYYY-MM-DDTHH:mm:ss.SSSZ");
					
					this._setRange(startISO, endISO);
					this._setHeaderLabel(startMo);
				}
			},

			_computePreviousMonthIsPast: function(startMo) {
				var tempPrevMonth = startMo.clone();
				tempPrevMonth = tempPrevMonth.subtract(1, "M");
				if (tempPrevMonth.isBefore(moment(), 'month')) {
					this.set('_previousMonthIsPast', true);
				} else {
					this.set('_previousMonthIsPast', false);
				}
			},

			_setInitialYearMonth: function(month) {
				var mo = month.value;

				var timezone = this.currentUser._TimeZoneId

				var startMo = mo.startDate;
				var startISOpreTZ = startMo.format("YYYY-MM-DDTHH:mm:ss.SSSZ");
				var startISO = this.normalizeToTimezone(startISOpreTZ, timezone);

				var endMo = mo.endDate;
				var endISOpreTZ = endMo.format("YYYY-MM-DDTHH:mm:ss.SSSZ");
				var endISO = this.normalizeToTimezone(endISOpreTZ, timezone);

				this._setRange(startISO, endISO);
				this._setHeaderLabel(startMo);
			},

			_setHeaderLabel: function(date) {
				var translatedDate = moment(date);
				translatedDate.locale(this._lang);
				this.set('headerLabel', translatedDate.format("MMMM YYYY"));
			},

			_isBusy: function(isBusy, reservationInstancesLoading, reservationsForPersonLoading, currentUserLoading, favoriteRoomsLoading) {
				return isBusy || reservationInstancesLoading || reservationsForPersonLoading || currentUserLoading || favoriteRoomsLoading;
			},

			_handleNewReservation: function(e) {
				this.fire("navigate-reservation-new", e);
			},

			_refreshReservationList: function() {
				this.debounce('_refreshReservationList', function () {
					if (this.$.reservationList) {
						this.$.reservationList.doRefresh();
					}
				});
			},

			created: function() {
				// TODO: To be fixed
				moment.locale("en");	
				this._lang = document.querySelector('html').getAttribute("lang") || 'en';	
			},

			attached: function(){
				Polymer.RenderStatus.afterNextRender(this, function(){
					if(window.location.search === "?homeApp=workplaceServices"){
						this._homeApp = "workplaceServices";
					}
				});
			},

			// override
			_pageAttached : function() {
				this._refreshReservationList();
			},

			_setRange: function(start, end) {
				var range = new Object();

				this.set('selectedISOStartDT', start);
				this.set('selectedISOEndDT', end);

				range.start = this.selectedISOStartDT;
				range.end = this.selectedISOEndDT;

				var oldRange = this.range;

				this.set("range", range);
			}

		});
	</script>
</dom-module>
<dom-module id="tripage-new" assetpath="">
	<template>
		<triplat-route id="newRoute" name="new" params="{{pageParams}}" on-route-active="_handleRouteActive"></triplat-route>
	</template>
	<script>
		Polymer({

			is: "tripage-new",

			_handleRouteActive: function(e) {
				if (e.detail.active) {
					// this is just an interim route/page to catch parameters
					this.async(function() {
						this.fire("reservation-new", this.pageParams);
					});
				}
			},
		});
	</script>
</dom-module>
<dom-module id="tripage-open" assetpath="">
	<template>
		<triplat-route id="openRoute" name="open" params="{{pageParams}}" on-route-active="_handleRouteActive"></triplat-route>
	</template>
	<script>
		Polymer({

			is: "tripage-open",

			_handleRouteActive: function(e) {
				if (e.detail.active) {
					// this is just an interim route/page to catch parameters
					this.async(function() {
						this.fire("reservation-open", this.pageParams);
					});
				}
			},
		});
	</script>
</dom-module>
<dom-module id="tripage-loading" assetpath="">

	<style include="shared-page-styles">
		:host {
			@apply(--layout-vertical);
			@apply(--layout-center);
			padding: 10px;
			z-index: 10000;
			background-color: var(--tri-primary-content-background-color);
		}

		.instructions-container {
			@apply(--layout-flex);
			@apply(--layout-vertical);
			@apply(--layout-center-center);
		}

		.instructions {
			font-size: 1.5em;
			text-align: center;
		}

		.spinner-message {
			font-size: 2.0em;
			text-align: center;
		}

		.spinner-container {
			@apply(--layout-vertical);
			@apply(--layout-center);
		}

		paper-spinner {
			@apply(--tri-loading-spinner);
		}
	</style>
	<template>
		<triplat-route id="loadingRoute" name="loading" params="{{pageParams}}" on-route-active="_handleRouteActive"></triplat-route>

		<div class="instructions-container">

			<div class="instructions">
				<p>Loading...</p>
			</div>

			<div class="spinner-container">
				<div>
					<paper-spinner id="spinner" active=""></paper-spinner>
				</div>
			</div>

		</div>
	</template>
	<script>
		Polymer({

			is: "tripage-loading",

			_handleRouteActive: function (e) {
				if (e.detail.active) {
					// if isPreCreating is not set, this means that the user refreshed this route/page
					// let's revert to creating a new reservation - since we've lost the context at this point
					if (!this.isPreCreating) {
						this.async(function () {
							this.fire("reservation-new", this.pageParams);
						});
					}
				}
			}
		});
	</script>
</dom-module>
// list


// find room


// summary


// dialog pages
<dom-module id="tricomp-amenities" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			.amenities-container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				overflow-y: auto;
			}

			.amenity-checkbox {
				--paper-checkbox-label-spacing: 0px;
				--paper-checkbox-size: 22px;
				padding: 10px;
			}

			.amenity-icon {
				--iron-icon-height: 24px;
				--iron-icon-width: 24px;
				padding: 10px;
			}

			.amenity-label {
				@apply(--layout-flex);
			}

			.amenity-list-item {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				border-bottom: 1px solid var(--tri-primary-content-accent-color);
				cursor: pointer;
				flex-shrink: 0;
				margin: 0 0 0 10px;
				padding: 5px 5px 5px 0;
			}

			.divider-line {
				border-left: 1px solid var(--tri-primary-content-accent-color);
				height: 24px;
			}

		</style>

		<div class="amenities-container">
			<div class="amenity-list-item" on-tap="_toggleIsCateringAvailableSelection">
				<paper-checkbox class="amenity-checkbox" checked="[[reservationManager.isCateringAvailable]]"></paper-checkbox>
				<div class="divider-line"></div>
				<iron-icon class="amenity-icon" icon="ibm-glyphs:catering"></iron-icon>
				<span class="amenity-label">Catering</span>
			</div>
			<div class="amenity-list-item" on-tap="_toggleIsADAAvailableSelection">
				<paper-checkbox class="amenity-checkbox" checked="[[reservationManager.isADAAvailable]]"></paper-checkbox>
				<div class="divider-line"></div>
				<iron-icon class="amenity-icon" icon="ibm-glyphs:accessibility"></iron-icon>
				<span class="amenity-label">Accessible</span>
			</div>
			<div class="amenity-list-item" on-tap="_toggleIsNetworkConnectionSelection">
				<paper-checkbox class="amenity-checkbox" checked="[[reservationManager.isNetworkConnection]]"></paper-checkbox>
				<div class="divider-line"></div>
				<iron-icon class="amenity-icon" icon="ibm-glyphs:wired"></iron-icon>
				<span class="amenity-label">Network Connection</span>
			</div>
			<div class="amenity-list-item" on-tap="_toggleIsProjectorSelection">
				<paper-checkbox class="amenity-checkbox" checked="[[reservationManager.isProjector]]"></paper-checkbox>
				<div class="divider-line"></div>
				<iron-icon class="amenity-icon" icon="ibm-glyphs:projector"></iron-icon>
				<span class="amenity-label">Projector</span>
			</div>
			<div class="amenity-list-item" on-tap="_toggleIsConferencePhoneSelection">
				<paper-checkbox class="amenity-checkbox" checked="[[reservationManager.isConferencePhone]]"></paper-checkbox>
				<div class="divider-line"></div>
				<iron-icon class="amenity-icon" icon="ibm-glyphs:phone-call"></iron-icon>
				<span class="amenity-label">Telephone Conference</span>
			</div>
			<div class="amenity-list-item" on-tap="_toggleIsVideoConferenceSelection">
				<paper-checkbox class="amenity-checkbox" checked="[[reservationManager.isVideoConference]]"></paper-checkbox>
				<div class="divider-line"></div>
				<iron-icon class="amenity-icon" icon="ibm-glyphs:video"></iron-icon>
				<span class="amenity-label">Video Conference</span>
			</div>
			<div class="amenity-list-item" on-tap="_toggleIsWhiteboardSelection">
				<paper-checkbox class="amenity-checkbox" checked="[[reservationManager.isWhiteboard]]"></paper-checkbox>
				<div class="divider-line"></div>
				<iron-icon class="amenity-icon" icon="ibm-glyphs:whiteboard"></iron-icon>
				<span class="amenity-label">Whiteboard</span>
			</div>
		</div>

		<tricomp-page-toolbar small-screen-width="[[smallScreenWidth]]">
			<paper-button on-tap="_handleDone" footer$="[[smallScreenWidth]]">Done</paper-button>
		</tricomp-page-toolbar>
	</template>
	<script>
		Polymer({

			is: "tricomp-amenities",
			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				backEventName: String
			},

			_handleDone: function(e) {
				this.fire("done");
			},

			_toggleIsADAAvailableSelection: function() {
				this.set("reservationManager.isADAAvailable", !this.reservationManager.isADAAvailable);
			},
			_toggleIsCateringAvailableSelection: function() {
				this.set("reservationManager.isCateringAvailable", !this.reservationManager.isCateringAvailable);
			},
			_toggleIsConferencePhoneSelection: function() {
				this.set("reservationManager.isConferencePhone", !this.reservationManager.isConferencePhone);
			},
			_toggleIsNetworkConnectionSelection: function() {
				this.set("reservationManager.isNetworkConnection", !this.reservationManager.isNetworkConnection);
			},
			_toggleIsProjectorSelection: function() {
				this.set("reservationManager.isProjector", !this.reservationManager.isProjector);
			},
			_toggleIsVideoConferenceSelection: function() {
				this.set("reservationManager.isVideoConference", !this.reservationManager.isVideoConference);
			},
			_toggleIsWhiteboardSelection: function() {
				this.set("reservationManager.isWhiteboard", !this.reservationManager.isWhiteboard);
			},

		});
	</script>
</dom-module>
<dom-module id="tricomp-recurrence" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			triblock-responsive-layout {
				overflow: auto;
			}

			.dropdown-monthly-day-of-week {
				@apply(--layout-flex);
				margin-left: 10px;
				max-width: 150px;
				min-width: 90px;
			}
			.dropdown-monthly-week-of-month {
				@apply(--layout-flex);
				margin-left: 10px;
				max-width: 150px;
				min-width: 90px;
			}
			.dropdown-yearly-month {
				@apply(--layout-flex);
				margin-left: 10px;
				max-width: 150px;
				min-width: 90px;
			}
			.dropdown-yearly-day-of-week {
				@apply(--layout-flex);
				margin-left: 10px;
				max-width: 150px;
				min-width: 90px;
			}
			.dropdown-yearly-week-of-month {
				@apply(--layout-flex);
				margin-left: 10px;
				max-width: 150px;
				min-width: 90px;
			}

			paper-radio-button {
				--paper-radio-button-size: 24px;
				--paper-radio-button-label-spacing: 6px;
				padding: 16px;
			}

			section {
				@apply(--layout-vertical);
				margin-left: 10px;
			}
			section:first-child {
				padding: 5px 0px 5px;
			}
			section:not(:first-child) {
				border-top: 1px solid var(--tri-primary-content-accent-color);
				padding: 5px 10px 5px 0;
			}

			tricomp-incremental-number-input {
				padding-top: 0;
			}

			.checkbox-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--layout-start-justified);
				@apply(--layout-wrap);
			}
			.checkbox-container > * {
				padding: 12px;
			}

			.duration-input {
				padding: 8px 10px 8px 0;
				--triplat-duration-width: 100%;
				--paper-input-container: {
					padding: 0;
				};

				flex: 1 1 250px;
				-webkit-flex: 1 1 250px; /* fix to address https://bugs.webkit.org/show_bug.cgi?id=136041 */
			}

			.inline-date-picker {
				padding: 10px;
				--paper-input-container: {
					padding: 0;
				};
			}

			#recurrenceMonthlyDayOfMonth {
				display: none;
			}
			#recurrenceMonthlyDayOfMonth[show] {
				display: flex;
			}

			#recurrenceMonthlyDayOfWeek {
				display: none;
			}
			#recurrenceMonthlyDayOfWeek[show] {
				display: flex;
			}

			#recurrenceYearlyDayOfMonth {
				display: none;
			}
			#recurrenceYearlyDayOfMonth[show] {
				display: flex;
			}

			#recurrenceYearlyDayOfWeek {
				display: none;
			}
			#recurrenceYearlyDayOfWeek[show] {
				display: flex;
			}

			.row-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--layout-wrap);
			}
			.row-baseline-container {
				@apply(--layout-horizontal);
				@apply(--layout-baseline);
				@apply(--layout-wrap);
			}
			.row-container > :not(:first-child), .row-baseline-container > :not(:first-child) {
				margin-left: 10px;
			}

			.section-title {
				font-size: 22px;
				padding-bottom: 10px;
			}

			.start-end-rule-checkbox {
				align-self: flex-start;
				padding: 10px 0;
			}

			.start-end-datetime-picker {
				padding: 8px 10px 8px 0;
				--triplat-date-picker-width: 100%;
				--paper-input-container: {
					padding: 0;
				};

				flex: 1 1 250px;
				-webkit-flex: 1 1 250px; /* fix to address https://bugs.webkit.org/show_bug.cgi?id=136041 */
			}

			.sub-section > :not(:first-child) {
				padding-top: 10px;
			}
			.sub-section > :not(:last-child) {
				padding-bottom: 10px;
			}

			.time-options-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--layout-wrap);
			}

			paper-radio-group {
				@apply(--layout);
				@apply(--layout-vertical);
			}

			#recurrenceEndOptions {
				@apply(--layout-horizontal);
			}

		</style>

		<triplat-ds id="recurrence" name="recurrence" data="{{recurrence}}" loading="{{_recurrenceDSLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]"></triplat-ds-context>
		</triplat-ds>

		<triblock-responsive-layout>
			<div id="recurrence-left-panel" hidden$="[[_hideContent]]">
				<section>

					<paper-checkbox id="allDayToggleButton" class="start-end-rule-checkbox" checked="{{recurrence.allDay}}" noink="">All day event</paper-checkbox>

					<div class="time-options-container">
						<triplat-datetime-picker id="startDateTime" class="start-end-datetime-picker" label="First Meeting" null-date-invalid="" hidden$="[[recurrence.allDay]]" time-zone="{{currentUser._TimeZoneId}}" display-format="{{currentUser._DateTimeFormat}}" value="{{recurrence.startDateTime}}">
						</triplat-datetime-picker>

						<triplat-date-picker id="startDate" class="start-end-datetime-picker" label="First Meeting" null-date-invalid="" hidden$="[[!recurrence.allDay]]" display-format="{{currentUser._DateFormat}}" value="{{recurrence.startDate}}">
						</triplat-date-picker>

						<triplat-duration id="duration" class="duration-input" value="{{recurrence.duration}}" label="Duration" hidden$="[[recurrence.allDay]]" display-tokens="h:m">
						</triplat-duration>

						<triplat-duration id="allDayDuration" class="duration-input" value="{{recurrence.duration}}" label="Duration" hidden$="[[!recurrence.allDay]]" readonly="" display-tokens="d">
						</triplat-duration>

						<triplat-datetime-picker id="endDateTime" readonly="" class="start-end-datetime-picker" label="End" null-date-invalid="" hidden$="[[recurrence.allDay]]" time-zone="{{currentUser._TimeZoneId}}" display-format="{{currentUser._DateTimeFormat}}" value="{{recurrence.endDateTime}}">
						</triplat-datetime-picker>

						<triplat-date-picker id="endDate" readonly="" class="start-end-datetime-picker" label="End" null-date-invalid="" hidden$="[[!recurrence.allDay]]" display-format="{{currentUser._DateFormat}}" value="{{recurrence.endDate}}">
						</triplat-date-picker>
					</div>

				</section>

				<section>

					<div class="section-title">Recurrence Type</div>

					<paper-radio-group id="recurrencePatternType" selected="{{recurrence.recurrencePatternType}}">
						<paper-radio-button name="DAILY">Daily</paper-radio-button>
						<paper-radio-button name="WEEKLY">Weekly</paper-radio-button>
						<paper-radio-button name="MONTHLY">Monthly</paper-radio-button>
						<paper-radio-button name="YEARLY">Yearly</paper-radio-button>
					</paper-radio-group>

				</section>
			</div>
			<div id="recurrence-right-panel" hidden$="[[_hideContent]]">
				<section hidden$="{{!_isDailyRecurrence(recurrence.recurrencePatternType)}}">

					<div class="section-title">Daily Recurrence</div>

					<div class="sub-section">
						<paper-radio-group id="recurrenceDailyOptions" selected="{{recurrence.recurrenceDailyOptions}}">
							<paper-radio-button name="Every [x] day(s)">Every <b>[[_computeCountDisplayValue(recurrence.dailyRecurrenceDays)]]</b> day(s)</paper-radio-button>
							<paper-radio-button name="Every weekday">Every weekday</paper-radio-button>
							<paper-radio-button name="Every weekend day">Every weekend day</paper-radio-button>
						</paper-radio-group>

						<div class="row-container" hidden$="{{!_isDailyEveryXDays(recurrence.recurrenceDailyOptions)}}">
							<span>Recur every</span>
							<tricomp-incremental-number-input id="dailyRecurrenceDays" min="1" invalid="{{dailyRecurrenceDaysInvalid}}" value="{{recurrence.dailyRecurrenceDays}}">
							</tricomp-incremental-number-input>
							<span>day(s)</span>
						</div>
					</div>

				</section>

				<section hidden$="{{!_isWeeklyRecurrence(recurrence.recurrencePatternType)}}">

					<div class="section-title">Weekly Recurrence</div>

					<div class="sub-section">
						<div class="checkbox-container">
							<paper-checkbox checked="{{recurrence.weeklySunday}}" name="Sunday">Sunday</paper-checkbox>
							<paper-checkbox checked="{{recurrence.weeklyMonday}}" name="Monday">Monday</paper-checkbox>
							<paper-checkbox checked="{{recurrence.weeklyTuesday}}" name="Tuesday">Tuesday</paper-checkbox>
							<paper-checkbox checked="{{recurrence.weeklyWednesday}}" name="Wednesday">Wednesday</paper-checkbox>
							<paper-checkbox checked="{{recurrence.weeklyThursday}}" name="Thursday">Thursday</paper-checkbox>
							<paper-checkbox checked="{{recurrence.weeklyFriday}}" name="Friday">Friday</paper-checkbox>
							<paper-checkbox checked="{{recurrence.weeklySaturday}}" name="Saturday">Saturday</paper-checkbox>
						</div>

						<div class="row-container">
							<span>Recur every</span>
							<tricomp-incremental-number-input id="weeklyRecurrenceWeeks" min="1" invalid="{{weeklyRecurrenceWeeksInvalid}}" value="{{recurrence.weeklyRecurrenceWeeks}}">
							</tricomp-incremental-number-input>
							<span>week(s)</span>
						</div>
					</div>

				</section>

				<section hidden$="{{!_isMonthlyRecurrence(recurrence.recurrencePatternType)}}">

					<div class="sub-section">
						<div class="section-title">Monthly Recurrence</div>

						<div class="row-container">
							<span>Recur every</span>
							<tricomp-incremental-number-input id="monthlyRecurrenceMonths" min="1" invalid="{{monthlyRecurrenceMonthsInvalid}}" value="{{recurrence.monthlyRecurrenceMonths}}">
							</tricomp-incremental-number-input>
							<span>month(s)</span>
						</div>

						<div class="row-container">
							<span>On</span>
							<paper-dropdown-menu class="dropdown-monthly-week-of-month" no-label-float="" no-animations="">
								<paper-listbox class="dropdown-content" attr-for-selected="data-val" selected="{{_selectedMonthlyWeekOfMonth}}" on-iron-select="_onRecurrenceMonthlyWeekOfMonthChange">
									<paper-item data-val="DAY">Day</paper-item>
									<paper-item data-val="First">First</paper-item>
									<paper-item data-val="Second">Second</paper-item>
									<paper-item data-val="Third">Third</paper-item>
									<paper-item data-val="Fourth">Fourth</paper-item>
									<paper-item data-val="Last">Last</paper-item>
								</paper-listbox>
							</paper-dropdown-menu>
							<paper-dropdown-menu class="dropdown-monthly-day-of-week" id="recurrenceMonthlyDayOfWeek" no-animations="" no-label-float="" show$="{{_showMonthlyTheFirstMondayOfEveryXMonthsOptions(_selectedMonthlyWeekOfMonth)}}">
								<paper-listbox class="dropdown-content" attr-for-selected="data-val" selected="{{recurrence.monthlyDayOfWeek}}">
									<paper-item data-val="day">Day</paper-item>
									<paper-item data-val="weekday">Weekday</paper-item>
									<paper-item data-val="weekend day">Weekend day</paper-item>
									<paper-item data-val="Sunday">Sunday</paper-item>
									<paper-item data-val="Monday">Monday</paper-item>
									<paper-item data-val="Tuesday">Tuesday</paper-item>
									<paper-item data-val="Wednesday">Wednesday</paper-item>
									<paper-item data-val="Thursday">Thursday</paper-item>
									<paper-item data-val="Friday">Friday</paper-item>
									<paper-item data-val="Saturday">Saturday</paper-item>
								</paper-listbox>
							</paper-dropdown-menu>
							<tricomp-incremental-number-input id="recurrenceMonthlyDayOfMonth" min="1" max="31" invalid="{{monthlyDayOfMonthInvalid}}" show$="{{_showMonthlyDayXOfEveryXMonthsOptions(_selectedMonthlyWeekOfMonth)}}" value="{{recurrence.monthlyDayOfMonth}}">
							</tricomp-incremental-number-input>
						</div>
					</div>

				</section>

				<section hidden$="{{!_isYearlyRecurrence(recurrence.recurrencePatternType)}}">

					<div class="sub-section">
						<div class="section-title">Yearly Recurrence</div>

						<div class="row-baseline-container">
							<span>Recur every</span>
							<paper-dropdown-menu class="dropdown-yearly-month" no-label-float="" no-animations="" selected-item-label="{{recurrence.yearlyMonth}}">
								<paper-listbox class="dropdown-content">
									<paper-item>January</paper-item>
									<paper-item>February</paper-item>
									<paper-item>March</paper-item>
									<paper-item>April</paper-item>
									<paper-item>May</paper-item>
									<paper-item>June</paper-item>
									<paper-item>July</paper-item>
									<paper-item>August</paper-item>
									<paper-item>September</paper-item>
									<paper-item>October</paper-item>
									<paper-item>November</paper-item>
									<paper-item>December</paper-item>
								</paper-listbox>
							</paper-dropdown-menu>
						</div>

						<div class="row-container">
							<span>On</span>
							<paper-dropdown-menu class="dropdown-yearly-week-of-month" no-label-float="" no-animations="">
								<paper-listbox class="dropdown-content" attr-for-selected="data-val" selected="{{_selectedYearlyWeekOfMonth}}" on-iron-select="_onRecurrenceYearlyWeekOfMonthChange">
									<paper-item data-val="DAY">Day</paper-item>
									<paper-item data-val="First">First</paper-item>
									<paper-item data-val="Second">Second</paper-item>
									<paper-item data-val="Third">Third</paper-item>
									<paper-item data-val="Fourth">Fourth</paper-item>
									<paper-item data-val="Last">Last</paper-item>
								</paper-listbox>
							</paper-dropdown-menu>
							<paper-dropdown-menu class="dropdown-yearly-day-of-week" id="recurrenceYearlyDayOfWeek" no-label-float="" no-animations="" show$="{{_showYearlyTheFirstMondayOfMayOptions(_selectedYearlyWeekOfMonth)}}">
								<paper-listbox class="dropdown-content" attr-for-selected="data-val" selected="{{recurrence.yearlyDayOfWeek}}">
									<paper-item data-val="day">Day</paper-item>
									<paper-item data-val="weekday">Weekday</paper-item>
									<paper-item data-val="weekend day">Weekend day</paper-item>
									<paper-item data-val="Sunday">Sunday</paper-item>
									<paper-item data-val="Monday">Monday</paper-item>
									<paper-item data-val="Tuesday">Tuesday</paper-item>
									<paper-item data-val="Wednesday">Wednesday</paper-item>
									<paper-item data-val="Thursday">Thursday</paper-item>
									<paper-item data-val="Friday">Friday</paper-item>
									<paper-item data-val="Saturday">Saturday</paper-item>
								</paper-listbox>
							</paper-dropdown-menu>
							<tricomp-incremental-number-input id="recurrenceYearlyDayOfMonth" min="1" max="31" invalid="{{yearlyDayOfMonthInvalid}}" show$="{{_showYearlyEveryMayXOptions(_selectedYearlyWeekOfMonth)}}" value="{{recurrence.yearlyDayOfMonth}}">
							</tricomp-incremental-number-input>
						</div>
					</div>

				</section>

				<section>

					<div class="section-title">Recurrence End</div>

					<div class="sub-section">
						<paper-radio-group id="recurrenceEndOptions" selected="{{recurrence.recurrenceEndOptions}}">
							<paper-radio-button name="End After">End after</paper-radio-button>
							<paper-radio-button name="End Date">End date</paper-radio-button>
							<paper-radio-button name="No End Date">No end</paper-radio-button>
						</paper-radio-group>

						
						<div>
							<div class="row-container" hidden$="{{!_isEndAfter(recurrence.recurrenceEndOptions)}}">
								<span>End after</span>
								<tricomp-incremental-number-input id="endNoOfOccurrencesBeforeEnd" min="1" invalid="{{endNoOfOccurrencesBeforeEndInvalid}}" value="{{recurrence.endNoOfOccurrencesBeforeEnd}}">
								</tricomp-incremental-number-input>
								<span>occurrences</span>
							</div>

							<div class="row-container" hidden$="{{!_isEndDate(recurrence.recurrenceEndOptions)}}">
								<span>Recur until</span>
								<triplat-date-picker no-label-float="" id="endEndDate" class="inline-date-picker" display-format="{{currentUser._DateFormat}}" value="{{recurrence.endEndDate}}">
								</triplat-date-picker>
							</div>
						</div>
					</div>

				</section>
			</div>
		</triblock-responsive-layout>
		<tricomp-page-toolbar small-screen-width="[[smallScreenWidth]]">
			<paper-button danger-outline$="[[!smallScreeWidth]]" footer-danger$="[[smallScreenWidth]]" on-tap="_handleClear">Cancel</paper-button>
			<paper-button footer$="[[smallScreenWidth]]" disabled="[[disableDoneButton]]" on-tap="_handleDone">Done</paper-button>
		</tricomp-page-toolbar>
	</template>
	<script>
		Polymer({

			is: "tricomp-recurrence",
			behaviors: [
				TriReservationUtilitiesBehavior,
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				reservationManager: Object,
				recurrence: Object,

				preCreateComplete: {
					type: Boolean,
					value: false
				},

				rm: {
					type: Object
				},

				backEventName: String,

				disableDoneButton: {
					type: Boolean,
					computed: "_computeDisableDoneButton(dailyRecurrenceDaysInvalid, weeklyRecurrenceWeeksInvalid, _selectedMonthlyWeekOfMonth, monthlyDayOfMonthInvalid, monthlyRecurrenceMonthsInvalid, monthlyDayOfWeekInvalid, _selectedYearlyWeekOfMonth, yearlyDayOfMonthInvalid, recurrence.yearlyMonth, recurrence.yearlyDayOfWeek, endNoOfOccurrencesBeforeEndInvalid, recurrence.recurrencePatternType, recurrence.recurrenceDailyOptions, recurrence.recurrenceMonthlyOptions, recurrence.recurrenceYearlyOptions, recurrence.recurrenceEndOptions, recurrence.endEndDate)"
				},

				monthlyDayOfWeekInvalid: {
					type: Boolean,
					value: false,
					computed: "_computeMonthlyDayOfWeekInvalid(recurrence.monthlyDayOfWeek)"
				},

				isLoading: {
					type: Boolean,
					value: false,
					computed: "_computeLoading(isBusy, _recurrenceDSLoading)",
					notify: true
				},

				_recurrenceDSLoading: {
					type: Boolean,
					value: false,
				},

				_selectedMonthlyWeekOfMonth: {
					type: String,
					value: ""
				},
				_selectedYearlyWeekOfMonth: {
					type: String,
					value: ""
				},

				oldDuration: Number,

				_hideContent: {
					type: Boolean,
					value: true
				},

				loading: {
					type: Boolean,
					value: false
				}
			},

			listeners: {
				"recurrencePatternType.paper-radio-group-changed": "_recurrencePatternTypeChanged",
				"recurrenceDailyOptions.paper-radio-group-changed": "_recurrenceDailyOptionsChanged",
				"recurrenceMonthlyDayOfWeek.iron-select": "_recurrenceMonthlyDayOfWeekChanged",
				"recurrenceYearlyDayOfWeek.iron-select": "_recurrenceYearlyDayOfWeekChanged",
				"recurrenceEndOptions.paper-radio-group-changed": "_recurrenceEndOptionsChanged",

				"endEndDate.date-picker-change": "_endEndDateChanged",

				"startDateTime.datetime-picker-change": "_startDateTimeChanged",
				"startDate.date-picker-change": "_startDateTimeChanged",
				"allDayToggleButton.change": "_allDayChanged"
			},

			observers: [
				"_durationValueChanged(recurrence.duration)",
				"_updateSelectedMonthlyWeekOfMonth(recurrence.recurrenceMonthlyOptions, recurrence.monthlyWeekOfMonth)",
				"_updateSelectedYearlyWeekOfMonth(recurrence.recurrenceYearlyOptions, recurrence.yearlyWeekOfMonth)",
				"_observeLoading(loading)"
			],

			_updateSelectedMonthlyWeekOfMonth: function(recurrenceMonthlyOptions, monthlyWeekOfMonth) {
				if (recurrenceMonthlyOptions && recurrenceMonthlyOptions != "") {
					if (this._isMonthlyDayXOfEveryXMonths(recurrenceMonthlyOptions) && this._selectedMonthlyWeekOfMonth != "DAY") {
						this.set("_selectedMonthlyWeekOfMonth", "DAY");
					} else if (this._isMonthlyTheFirstMondayOfEveryXMonths(recurrenceMonthlyOptions) && this._selectedMonthlyWeekOfMonth != monthlyWeekOfMonth) {
						this.set("_selectedMonthlyWeekOfMonth", monthlyWeekOfMonth);
					}
				}
			},

			_updateSelectedYearlyWeekOfMonth: function(recurrenceYearlyOptions, yearlyWeekOfMonth) {
				if (recurrenceYearlyOptions && recurrenceYearlyOptions != "") {
					if (this._isYearlyEveryMayX(recurrenceYearlyOptions) && this._selectedYearlyWeekOfMonth != "DAY") {
						this.set("_selectedYearlyWeekOfMonth", "DAY");
					} else if (this._isYearlyTheFirstMondayOfMay(recurrenceYearlyOptions) && this._selectedYearlyWeekOfMonth != yearlyWeekOfMonth) {
						this.set("_selectedYearlyWeekOfMonth", yearlyWeekOfMonth);
					}
				}
			},

			_computeLoading: function(isBusy, _recurrenceDSLoading) {
				return isBusy || _recurrenceDSLoading;
			},

			_computeCountDisplayValue: function(val) {
				if (!val || val == "") return "[#]";
				return (typeof val == "string") ? val.toLowerCase() : val;
			},

			_computeDayDisplayValue: function(val) {
				if (!val || val == 0 || val == "") return "[day]";
				return val;
			},

			_computeMonthDisplayValue: function(val) {
				if (!val || val == 0 || val == "") return "[month]";
				return val;
			},

			_computeMonthlyDayOfWeekInvalid: function(recurrenceMonthlyDayOfWeek) {
				return !recurrenceMonthlyDayOfWeek || recurrenceMonthlyDayOfWeek == "";
			},

			/*
			* Validate the input.
			*/
			_computeDisableDoneButton: function(dailyRecurrenceDaysInvalid, weeklyRecurrenceWeeksInvalid, selectedMonthlyWeekOfMonth, monthlyDayOfMonthInvalid, monthlyRecurrenceMonthsInvalid, monthlyDayOfWeekInvalid, selectedYearlyWeekOfMonth, yearlyDayOfMonthInvalid, recurrenceYearlyMonth, recurrenceYearlyDayOfWeek, endNoOfOccurrencesBeforeEndInvalid, recurrencePatternType, recurrenceDailyOptions, recurrenceMonthlyOptions, recurrenceYearlyOptions, recurrenceEndOptions, endEndDate) {
				var isEndDate = this._isEndDate(recurrenceEndOptions);
				if (isEndDate && !endEndDate) {
					// "End date" selected, and is invalid
					return true;
				}

				var isEndAfter = this._isEndAfter(recurrenceEndOptions);
				if (isEndAfter && endNoOfOccurrencesBeforeEndInvalid) {
					// "End after" selected, and is invalid
					return true;
				}

				var isDailyRecurrence = this._isDailyRecurrence(recurrencePatternType);
				var isDailyEveryXDays = this._isDailyEveryXDays(recurrenceDailyOptions);
				if (isDailyRecurrence && isDailyEveryXDays && dailyRecurrenceDaysInvalid) {
					// daily recurrence + "Every [#] days" selected, and is invalid
					return true;
				}

				var isWeeklyRecurrence = this._isWeeklyRecurrence(recurrencePatternType);
				if (isWeeklyRecurrence && weeklyRecurrenceWeeksInvalid) {
					// weekly recurrence selected, and is invalid
					return true;
				}

				var isMonthlyRecurrence = this._isMonthlyRecurrence(recurrencePatternType);
				var monthlyWeekOfMonthInvalid = !selectedMonthlyWeekOfMonth || selectedMonthlyWeekOfMonth == "";
				if (isMonthlyRecurrence && (monthlyWeekOfMonthInvalid || monthlyRecurrenceMonthsInvalid)) {
					// monthly recurrence + no option selected or invalid months between recurrence
					return true;
				}
				var isMonthlyDayXOfEveryXMonths = this._isMonthlyDayXOfEveryXMonths(recurrenceMonthlyOptions);
				if (isMonthlyRecurrence && isMonthlyDayXOfEveryXMonths && monthlyDayOfMonthInvalid) {
					// monthly recurrence + "Day X of every X months" selected, and is invalid
					return true;
				}
				var isMonthlyTheFirstMondayOfEveryXMonths = this._isMonthlyTheFirstMondayOfEveryXMonths(recurrenceMonthlyOptions);
				if (isMonthlyRecurrence && isMonthlyTheFirstMondayOfEveryXMonths && monthlyDayOfWeekInvalid) {
					// monthly recurrence + "[First] [day] of every X months" selected, and is invalid
					return true;
				}

				var isYearlyRecurrence = this._isYearlyRecurrence(recurrencePatternType);
				var recurrenceYearlyMonthInvalid = !recurrenceYearlyMonth || recurrenceYearlyMonth == "";
				var yearlyWeekOfMonthInvalid = !selectedYearlyWeekOfMonth || selectedYearlyWeekOfMonth == "";
				if (isYearlyRecurrence && (yearlyWeekOfMonthInvalid || recurrenceYearlyMonthInvalid)) {
					// yearly recurrence + no option selected
					return true;
				}
				var isYearlyEveryMayX = this._isYearlyEveryMayX(recurrenceYearlyOptions);
				if (isYearlyRecurrence && isYearlyEveryMayX && yearlyDayOfMonthInvalid) {
					// yearly recurrence + "Every [month] [#]" selected, and is invalid
					return true;
				}
				var isYearlyTheFirstMondayOfMay = this._isYearlyTheFirstMondayOfMay(recurrenceYearlyOptions);
				var recurrenceYearlyDayOfWeekInvalid = !recurrenceYearlyDayOfWeek || recurrenceYearlyDayOfWeek == "";
				if (isYearlyRecurrence && isYearlyTheFirstMondayOfMay && recurrenceYearlyDayOfWeekInvalid) {
					// yearly recurrence + "The [First] [Monday] of [May]" selected, and is invalid
					return true;
				}

				return false;
			},

			_showMonthlyTheFirstMondayOfEveryXMonthsOptions: function(selectedMonthlyWeekOfMonthIndex) {
				return selectedMonthlyWeekOfMonthIndex != null && selectedMonthlyWeekOfMonthIndex != "" && selectedMonthlyWeekOfMonthIndex != "DAY";
			},

			_showMonthlyDayXOfEveryXMonthsOptions: function(selectedMonthlyWeekOfMonthIndex) {
				return selectedMonthlyWeekOfMonthIndex == "DAY";
			},

			_showYearlyTheFirstMondayOfMayOptions: function(selectedYearlyWeekOfMonthIndex) {
				return selectedYearlyWeekOfMonthIndex != null && selectedYearlyWeekOfMonthIndex != "" && selectedYearlyWeekOfMonthIndex != "DAY";
			},

			_showYearlyEveryMayXOptions: function(selectedYearlyWeekOfMonthIndex) {
				return selectedYearlyWeekOfMonthIndex == "DAY";
			},

			_recurrencePatternTypeChanged: function(e) {
				this._setBusy();
				this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeRecurrencePatternType").then(function() {
					this._clearBusy();
				}.bind(this));
			},

			_recurrenceDailyOptionsChanged: function(e) {
				this._setBusy();
				this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeDailyOptions").then(function() {
					this._clearBusy();
				}.bind(this));
			},

			_recurrenceMonthlyDayOfWeekChanged: function(e) {
				this._setBusy();
				this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeMonthlyDayOfWeek").then(function() {
					this._clearBusy();
				}.bind(this));
			},

			_onRecurrenceMonthlyWeekOfMonthChange: function(e) {
				var selected = e.currentTarget.selected;

				if (this._isMonthlyDayXOfEveryXMonths(this.recurrence.recurrenceMonthlyOptions) && selected != null && selected != "DAY") {
					// switch to other monthly recurrence option
					this.set("recurrence.recurrenceMonthlyOptions", "The [First] [Monday] of every [x] month(s)");
					this.set("recurrence.monthlyWeekOfMonth", selected);

					this._setBusy();
					this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeMonthlyOptions").then(function() {
						this._clearBusy();
					}.bind(this));
				} else if (this._isMonthlyTheFirstMondayOfEveryXMonths(this.recurrence.recurrenceMonthlyOptions) && selected == "DAY") {
					// switch to other monthly recurrence option
					this.set("recurrence.recurrenceMonthlyOptions", "Day [x] of every [x] month(s)");
					this.set("recurrence.monthlyWeekOfMonth", null);

					this._setBusy();
					this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeMonthlyOptions").then(function() {
						this._clearBusy();
					}.bind(this));
				} else if (this._isMonthlyDayXOfEveryXMonths(this.recurrence.recurrenceMonthlyOptions) && selected == "DAY") {
					this.set("recurrence.monthlyWeekOfMonth", null);
				} else {
					this.set("recurrence.monthlyWeekOfMonth", selected);
				}
			},

			_onRecurrenceYearlyWeekOfMonthChange: function(e) {
				var selected = e.currentTarget.selected;

				if (this._isYearlyEveryMayX(this.recurrence.recurrenceYearlyOptions) && selected != null && selected != "DAY") {
					// switch to other yearly recurrence option
					this.set("recurrence.recurrenceYearlyOptions", "The [First] [Monday] of [May]");
					this.set("recurrence.yearlyWeekOfMonth", selected);

					this._setBusy();
					this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeYearlyOptions").then(function() {
						this._clearBusy();
					}.bind(this));
				} else if (this._isYearlyTheFirstMondayOfMay(this.recurrence.recurrenceYearlyOptions) && selected == "DAY") {
					// switch to other yearly recurrence option
					this.set("recurrence.recurrenceYearlyOptions", "Every [May] [1]");
					this.set("recurrence.yearlyWeekOfMonth", null);

					this._setBusy();
					this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeYearlyOptions").then(function() {
						this._clearBusy();
					}.bind(this));
				} else if (this._isYearlyEveryMayX(this.recurrence.recurrenceYearlyOptions) && selected == "DAY") {
					this.set("recurrence.yearlyWeekOfMonth", null);
				} else {
					this.set("recurrence.yearlyWeekOfMonth", selected);
				}
			},

			_recurrenceYearlyDayOfWeekChanged: function(e) {
				this._setBusy();
				this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeYearlyDayOfWeek").then(function() {
					this._clearBusy();
				}.bind(this));
			},

			_recurrenceEndOptionsChanged: function(e) {
				this._setBusy();
				this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeEndOptions").then(function() {
					this._clearBusy();
				}.bind(this));
			},

			_endEndDateChanged: function(e) {
				this._setBusy();
				this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeEndDateOption").then(function() {
					this._clearBusy();
				}.bind(this));
			},

			_startDateTimeChanged: function(e) {
				this._setBusy();
				this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "onChangeStartDateTime").then(function() {
					this._clearBusy();
				}.bind(this));
			},

			_allDayChanged: function(e) {
				this._setBusy();
				this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.BOTH, "actions", "onChangeAllDay").then(function() {
					this.set("oldDuration", this.recurrence.duration);
					this._clearBusy();
				}.bind(this));
			},

			_durationValueChanged: function(value) {
				if (this.oldDuration == undefined) {
					return;
				}

				if (value == this.oldDuration) {
					return;
				}

				this._durationChanged();
			},

			_durationChanged: function(value) {
				this._setBusy();
				this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.BOTH, "actions", "onChangeDuration").then(function() {
					this.set("oldDuration", this.recurrence.duration);
					this._clearBusy();
				}.bind(this));
			},

			_isDailyRecurrence: function(recurrenceType) {
				return recurrenceType === "DAILY";
			},

			_isWeeklyRecurrence: function(recurrenceType) {
				return recurrenceType === "WEEKLY";
			},

			_isMonthlyRecurrence: function(recurrenceType) {
				return recurrenceType === "MONTHLY";
			},

			_isYearlyRecurrence: function(recurrenceType) {
				return recurrenceType === "YEARLY";
			},

			_isDailyEveryXDays: function(dailyRecurrenceOption) {
				return dailyRecurrenceOption === "Every [x] day(s)";
			},

			_isMonthlyDayXOfEveryXMonths: function(monthlyRecurrenceOption) {
				return monthlyRecurrenceOption === "Day [x] of every [x] month(s)";
			},

			_isMonthlyTheFirstMondayOfEveryXMonths: function(monthlyRecurrenceOption) {
				return monthlyRecurrenceOption === "The [First] [Monday] of every [x] month(s)";
			},

			_isYearlyEveryMayX: function(yearlyRecurrenceOption) {
				return yearlyRecurrenceOption === "Every [May] [1]";
			},

			_isYearlyTheFirstMondayOfMay: function(yearlyRecurrenceOption) {
				return yearlyRecurrenceOption === "The [First] [Monday] of [May]";
			},

			_isEndAfter: function(endOption) {
				return endOption === "End After";
			},

			_isEndDate: function(endOption) {
				return endOption === "End Date";
			},

			_handleNavigateBack: function(e) {
				this.fire("done");
			},

			_handleClear: function(e) {
				if (this._isRecurringMeeting(this.reservationManager)) {
					if (this.recurrence && this.recurrence._id) {
						this._setBusy();

						this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "clearRecurrence").then(function() {
							this._updateReservationManager();
						}.bind(this));
					}
				} else {
					this.async(function() {
						this._handleNavigateBack();
					});
				}
				this.fire("criteria-changed");
			},

			_handleDone: function(e) {
				if (this.recurrence && this.recurrence._id) {
					this._setBusy();
					this.$.recurrence.updateRecord(this.recurrence._id, TriPlatDs.RefreshType.SERVER, "actions", "save").then(function() {
						this._updateReservationManager();
					}.bind(this));
					this.fire("criteria-changed");
					this.fire("recurrence-changed", {'recurrence': this.recurrence});
				}
			},

			_updateReservationManager: function() {
				var wfParams = {};
				if (this.recurrence && this.recurrence._id) {
					wfParams.recurrence = this.recurrence._id;
				}

				this.rm.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "saveRecurrence", wfParams).then(function() {
						this._clearBusy();

						this.async(function() {
							this._handleNavigateBack();
						});
				}.bind(this));
			},

			_pageAttached : function() {
				this.set("oldDuration", undefined);
				this._setBusy();
				this.set("_hideContent", true);

				var wfParams = {};
				if (this.recurrence && this.recurrence._id) {
					wfParams.recurrence = this.recurrence._id;
				}

				this.rm.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "createRecurrence", wfParams).then(function() {
					this.$.recurrence.refresh().then(function() {
						this._clearBusy();
						this.set("oldDuration", this.recurrence.duration);
					}.bind(this));
				}.bind(this));
			},

			_observeLoading: function(loading) {
				this.set("_hideContent", loading);
			}
		});
	</script>
</dom-module>
<dom-module id="tricomp-room-details" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			.room-details-container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			.room-details-scrollable-area {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				overflow-y: auto;
			}


			.approval-message {
				font-size: 16px;
				margin-top: 10px;
			}

			.hold-time-message {
				margin-bottom: 10px;
			}

			.room-details {
				@apply(--layout-vertical);
				padding: 0px 10px 5px 10px;
				flex-shrink: 0;
				border-bottom: 1px solid var(--tri-primary-content-accent-color);
			}

			.room-name-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				padding: 0px 10px;
			}

			.room-name {
				padding-right: 10px;
				font-size: 20px;
				font-weight: 500;
				@apply(--paper-font-common-nowrap);
			}

			.divider-line {
				border-left: 1px solid var(--tri-primary-content-accent-color);
				padding-left: 5px;
				height: 24px;
			}

			.favorite-icon {
				flex-shrink: 0;
				padding: 6px;
				height: 42px;
				width: 42px;
			}

			.room-image-container {
				padding: 20px 0px;
			}

			.room-image {
				width: 200px;
				height: 200px;
			}

			.tappable-rows-section {
				padding-left: 10px;
			}

			.tappable-row {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				border-bottom: 1px solid var(--tri-primary-content-accent-color);
				cursor: pointer;
				height: 44px;
			}

			.row-content {
				@apply(--layout-flex);
			}

			tricomp-amenities-list {
				padding-top: 10px;
			}

			:host-context([dir="rtl"]) .expand-button {
                 transform: scaleX(-1);
            } 

		</style>

		<tricore-url raw-url="/getCompanyFile.jsp?fileLoc=" bind-url="{{imgUrl}}"></tricore-url>

		<triplat-debug message="tricomp-room-details.params" value="{{params}}"></triplat-debug>

		<triplat-ds id="roomDetails" name="lookupRoom" data="{{_roomDetails}}" loading="{{roomDetailsLoading}}">
			<triplat-ds-instance instance-id="{{params.roomId}}"></triplat-ds-instance>
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]">
			</triplat-ds-context>
		</triplat-ds>
		<tricomp-array-comparator source="{{_roomDetails}}" compare-to="{{favoriteRooms}}" match-flag="isFavorite" update-source="">
		</tricomp-array-comparator>

		<triplat-ds id="reservationLocation" name="reservationLocations" data="{{reservationLocation}}" loading="{{reservationLocationsLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]"></triplat-ds-context>
			<triplat-ds-instance instance-id="[[params.resourceId]]"></triplat-ds-instance>
		</triplat-ds>

		<div class="room-details-container">
			<tricomp-alert-message danger="" icon="ibm:clock-time" id="holdTimeMessage" class="hold-time-message" show$="[[reservationLocation.holdTimeDeadline]]" show-tooltip-indicator-icon="">
				<span hidden$="[[holdTimeExpired]]">Hold expires in</span>
				<triplat-countdown class="hold-time-countdown" name="booking-expiration" deadline="[[reservationLocation.holdTimeDeadline]]" expired-text="Hold time is expired." timezone="[[currentUser._TimeZoneId]]" is-expired="{{holdTimeExpired}}">
				</triplat-countdown>
			</tricomp-alert-message>
			<paper-tooltip for="holdTimeMessage" position="bottom" offset="5" animation-delay="100" fit-to-visible-bounds="">When the hold time on this room expires, all added food and equipment are not saved, and the room is removed for this reservation.</paper-tooltip>
			
			<div class="room-name-container">
				<span class="room-name">{{_roomDetails.room}}</span>
				<span class="divider-line"></span>
				<paper-icon-button class="favorite-icon" favorited$="[[_roomDetails.isFavorite]]" icon="[[_computeFavIcon(_roomDetails.isFavorite)]]" on-tap="_handleToggleFavorite"></paper-icon-button>
			</div>
			
			<div class="room-details-scrollable-area">
				<div class="room-details">
					<div hidden$="[[!_roomDetails.building]]">[[_roomDetails.building]]</div>
					<div hidden$="[[!_roomDetails.floor]]">[[_roomDetails.floor]]</div>
					<div>
						<span hidden$="[[!_roomDetails.city]]">[[_roomDetails.city]]</span><span hidden$="[[!_roomDetails.state]]">,&nbsp;[[_roomDetails.state]]</span><span hidden$="[[!_roomDetails.country]]">,&nbsp;[[_roomDetails.country]]</span>
					</div>

					<div class="room-image-container" hidden$="[[!roomImageLoaded]]">
						<iron-image class="room-image" src="{{_computeImageUrl(_roomDetails.image, imgUrl)}}" hidden$="[[!roomImageLoaded]]" sizing="cover" loaded="{{roomImageLoaded}}">
						</iron-image>
					</div>

					<div>Capacity [[_roomDetails.capacity]]</div>
					<div>[[_roomDetails.layout]] layout</div>
					<tricomp-amenities-list class="amenities-list" catering="[[_isRoomServiceAvailable(_roomDetails.isCateringAvailable)]]" disabled-access="[[_isRoomServiceAvailable(_roomDetails.isADAAvailable)]]" network-connection="[[_isRoomServiceAvailable(_roomDetails.isNetworkConnection)]]" phone-conference="[[_isRoomServiceAvailable(_roomDetails.isConferencePhone)]]" projector="[[_isRoomServiceAvailable(_roomDetails.isProjector)]]" video-conference="[[_isRoomServiceAvailable(_roomDetails.isVideoConference)]]" whiteboard="[[_isRoomServiceAvailable(_roomDetails.isWhiteboard)]]">
					</tricomp-amenities-list>

					<tricomp-alert-message info="" id="approvalMessage" class="approval-message" hidden$="[[!_isApprovalRequired(_roomDetails.approvalNameENUS)]]" show-tooltip-indicator-icon="">[[_roomDetails.approval]]</tricomp-alert-message>
					<paper-tooltip for="approvalMessage" position="top" offset="5" animation-delay="100" fit-to-visible-bounds="">Adding this room to your reservation will require approval from the room's owner, which may result in a delay of the acceptance of this room.  You will be notified of the room owner's decision.</paper-tooltip>
				</div>

				<div class="tappable-rows-section">
					
					<div class="tappable-row" on-tap="_handleNavigateRoomLocation">
						<div class="row-content">Room Location</div>
						<paper-icon-button primary="" class="expand-button" icon="ibm-glyphs:expand-open"></paper-icon-button>
					</div>
				</div>
			</div>
		</div>

		<tricomp-page-toolbar small-screen-width="[[smallScreenWidth]]">
			<paper-button on-tap="_handleDone" footer$="[[smallScreenWidth]]">Done</paper-button>
		</tricomp-page-toolbar>
	</template>
	<script>
		Polymer({

			is: "tricomp-room-details",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],
			
			properties: {
				backTo: String,
				hasBackButton: Boolean,
				pageLabel: String,
			},

			_computeFavIcon: function(isFav) {
				return isFav ? "ibm:rating-star-filled" : "ibm:rating-star";
			},

			_isApprovalRequired: function(approvalNameENUS) {
				return approvalNameENUS && approvalNameENUS === "Requestable";
			},

			_isBusy: function(isBusy, roomDetailsLoading, layoutOptionsLoading, favoriteRoomsLoading) {
				return isBusy || roomDetailsLoading || layoutOptionsLoading || favoriteRoomsLoading;
			},

			_handleToggleFavorite: function(e) {
				var roomId = this._roomDetails._id;
				var isFavorite = this._roomDetails.isFavorite;
				this.fire("action-toggle-room-favorite", { 'roomId' : roomId, "isFavorite" : !isFavorite });
			},

			_handleDone: function(e) {
				this.fire("done");
			},

			_handleNavigateRoomSchedule: function(e) {
				this.fire("navigate-room-schedule", { roomId: this.params.roomId });
			},

			_handleNavigateRoomLocation: function(e) {
				this.fire("navigate-room-location", { roomId: this.params.roomId });
			},

			_pageAttached: function() {
				this.$.reservationLocation.refresh();
			}
		});
	</script>
</dom-module>


<script src="../javascript-number-formatter/format.js"></script>
<script>
  /**
   * Use `TriPlatUomBehavior` to get support for retrieving information of a UOM.
   *
   * @polymerBehavior TriPlatUomBehavior
   */
	TriPlatUomBehaviorImpl = {
	
		/**
 		  * Retrieves the information of a UOM based from the type of information to display.
 		  * 
		  * @param {string} uom The unit-of-measure associated with this number (e.g. square-feet). 
		  *
		  * @param {array} uomList An array of unit-of-measure object for a specific type (e.g. Area, Carbon Emission).
		  *
		  * @param {string} display Type of information to retrieve for display: uom | symbol | abbr.
		  *							Use 'uom' to display the value of the UOM in the language of the current user (e.g. "square-feet").  
          *							Use 'symbol' to display the currency symbol of the UOM if it is of type Currency.
          * 						Use 'abbr' to display the abbreviation of the UOM (e.g. ft2).
		  *
		  * @return {string} The information to display from the UOM.
 		  **/		
		getUomInfo: function(uom, uomList, display) {
			if (uom && uomList) {
				if (display == "uom") {
					return this._getUomValue(uomList, uom)._UOM_Display_Value;
				} else if (display == "abbr") {
					return this._getUomValue(uomList, uom)._UOM_Abbreviation;
				} else if (display == "symbol") {
					var uomVal =this._getUomValue(uomList, uom);
					if (uomVal._Currency_Symbol) {
						return uomVal._Currency_Symbol;
					} else {
						return "";
					}
				}
			} else {
				return "";
			}
		},

		_getUomValue: function(uomValues, uom) {
			if (typeof uomValues == 'undefined' || typeof uom == 'undefined' || !uomValues || !uom ) {
				return null;
			}

			for (var i=0; i < uomValues.length; i++) {
				if (uomValues[i]._UOM_Value == uom) {
					return uomValues[i];
				}
			}
			console.log("ERROR: expected to find " + uom + " on the UOM datasource but did not find it.");
			return null;

		}

	};
	TriPlatUomBehavior = [
		TriPlatUomBehaviorImpl
	];

</script><script>
	/**
	  * Use `TriPlatNumberBehavior` to get support for formatting numbers for display.
	  *
	  * @polymerBehavior TriPlatNumberBehavior
	  */
	TriPlatNumberBehaviorImpl = {

		properties: {
			/**
			  * The character used for the thousands separator/delimiter.
			  **/
			_delimiter: String,

			/**
			  * The character used for the decimal separator.
			  **/
			_decimal: String,

			/**
			  * The symbol used for the currency.
			  **/
			_currencySymbol: String,

			/**
			  * The default display mask to be used when formatting numbers without a UOM and without an explicitly specified display mask.
			  **/
			_defaultDisplayMask: {
				type: String,
				value: "0.####",
				readOnly: true
			},

			_isRtl: {
				type: Boolean,
				value: false,
				readOnly: true
			},

			/**
			  * A regular expression that will be used to validate the user input.
			  * It will be create according to mask set for the input field./
			  **/
			_validationPattern: {
				type: String,
				value: ""
			}
		},

		attached: function() {
			var textDirectionValue = document.querySelector('body').getAttribute('dir');
			if(textDirectionValue==="rtl"){
				this._set_isRtl(true);
			}
		},

		_createMissingParameterErrorMsg: function(method, param) {
			return "ERROR: You invoked " + method + " without specifying a " + param + ". No formatting will be done.";
		},

		/**
		  * Take a number as it is stored internally and format it for display, including 
		  * locale-specific thousands delimiter and decimal character based on the user.
		  * 
		  * @param {string} value The string representation of the unformatted number (e.g. 5999.12).
		  *
		  * @param {object} user The object representing the Current User. The decimal separator and 
		  *                      thousands delimiter will be properties of this object. 
		  *
		  * @param {object} mask (optional) The display mask which specifies the pattern, using the Java convention, e.g. ###,###.##
		  *                      If not specified, then ###,###.#### will be used.
		  *
		  * @return {string} val The string representation of the formatted number (e.g. 5,999.12).
		  *
		  **/
		formatNumberWithoutUom: function(value, user, mask) {
			if (typeof value == 'undefined' || value == null) { 
				console.log(this._createMissingParameterErrorMsg("formatNumberWithoutUom", "value"));
				return value;
			}
			if (typeof user == 'undefined' || user == null) { 
				console.log(this._createMissingParameterErrorMsg("formatNumberWithoutUom", "user"));
				return value;
			}
			return this._formatNumber(value, user._Decimal, user._Delimiter, null, null, null, mask);
		},

		/**
		  * Take a number as it is stored internally and format it for display, including 
		  * locale specific thousands delimiter and decimal character based on the user, and currency symbol and
		  * display mask based on the TRIRIGA unit-of-measure (UOM).
		  * 
		  * @param {string} value The string representation of the unformatted number (e.g. 5999.12).
		  *
		  * @param {string} uom The unit-of-measure associated with this number (e.g. square-feet). 
		  *
		  * @param {array} uomValues An array of unit-of-measure object for a specific type (e.g. Area, Carbon Emission).
		  *
		  * @param {object} user The object representing the Current User. The decimal separator and 
		  *                      thousands delimiter will be properties of this object. 
		  *
		  * @return {string} val The string representation of the formatted number (e.g. 5,999.12).
		  *
		  **/
		formatNumberWithUom: function(value, uom, uomValues, user) {
			if (typeof value == 'undefined' || value == null) { 
				console.log(this._createMissingParameterErrorMsg("formatNumberWithUom", "value"));
				return value;
			}
			if (typeof uom == 'undefined' || uom == null) { 
				console.log(this._createMissingParameterErrorMsg("formatNumberWithUom", "uom"));
				return value;
			}
			if (typeof uomValues == 'undefined' || uomValues == null) { 
				console.log(this._createMissingParameterErrorMsg("formatNumberWithUom", "uomValues"));
				return value;
			}
			if (typeof user == 'undefined' || user == null) { 
				console.log(this._createMissingParameterErrorMsg("formatNumberWithUom", "user"));
				return value;
			}
			return this._formatNumber(value, user._Decimal, user._Delimiter, uom, uomValues);
		},

		_formatNumber: function(value, decimal, delimiter, uom, uomValues, displaySymbol, mask) {
			if (typeof value == 'undefined' || value === null)
				return null;

			var val = Number(value);
			if (isNaN(val)) {
				return val;
			}

			var uomValue = this._getUomValue(uomValues, uom);

			var formattedValue = null;

			if (!decimal && !delimiter) {
				console.log(this._createMissingParameterErrorMsg("triplat-number-input", "user"));
				return value;
			} else {
				this._decimal = decimal;
				this._delimiter = delimiter;
			}

			var displayMask = this._generateMask(this._decimal, this._delimiter, uom, uomValues, mask);

			if (uom != null && uomValue != null) {
				if (uomValue._UOM_Type == "Currency") {
					//Following classic form design, the currency is masked with the user local (decimal and delimiter)
					var uomUser = this.user ? this.user._Currency : "";

					if (!this.currencySymbol) { this._computeCurrencySymbol(displaySymbol, uomValue); }

					if (uomUser == "Indian Rupees") {
						formattedValue = (this._formatIndianRupee(val) == "") ? this._formatIndianRupee(0) : this._formatIndianRupee(val);
					} else {
						formattedValue = (format(displayMask, val) == "") ? format(displayMask, 0) : format(displayMask, val);
					}
					if (this._isRtl) {
						if (formattedValue.startsWith(".") || formattedValue.startsWith(",")) {
							//For some reason RTL input will display ".34$" value as "34$." Solve this problem by adding a leading zero.
							formattedValue = "0" + formattedValue;
						}
						formattedValue = formattedValue + this.currencySymbol;
					} else {
						formattedValue = this.currencySymbol + formattedValue;
					}
				} else {
					formattedValue = (format(displayMask, val) == "") ? format(displayMask, 0) : format(displayMask, val);
				}
			} else {
				formattedValue = (format(displayMask, val) == "") ? format(displayMask, 0) : format(displayMask, val);
			}

			this._generateValidationPattern(this._delimiter, this._decimal, uom, uomValues, displaySymbol);
			return formattedValue;
		},

		/**
		  * Convert a formatted number to an unformatted number suitable for TRIRIGA and the database. 
		  * triplat-number-input, formatNumberWithUom, or formatNumberWithoutUom must have been used to format the number.
		  * 
		  * @param {string} val The string representation of the formatted number (e.g. 5,999.12).
		  *
		  * @return {string} val The string representation of the unformatted number (e.g. 5999.12).
		  **/
		unformatNumber: function(val) {
			var delimiter = this._delimiter;
			var decimal = this._decimal;
			if (typeof delimiter == 'undefined' || delimiter == null) {
				return val;
			}

			if (typeof decimal == 'undefined' || decimal == null) {
				return val;
			}

			while (val.indexOf(delimiter) != -1) {
				val = val.replace(delimiter,"");
			}

			val = val.replace(decimal,".");

			val = val.replace(/\s/g,""); //remove all spaces

			val = val.replace(/[^\d.-]/g,""); //remove non-numeric characters except for period and negative sign

			return val;
		},

		_applyLocaleSeparatorsToMask: function(displayMask, uom_decimal, uom_delimiter, user_decimal, user_delimiter) {
			if (typeof uom_decimal == 'undefined' || uom_decimal == null ) {
				uom_decimal = "."; // default to Java format
			}
			if (typeof uom_delimiter == 'undefined' || uom_delimiter == null ) {
				uom_delimiter = ","; // default to Java format
			}

			if (uom_decimal == uom_delimiter) {
				//Safeguard, should not happen (default delimiter "," is used if uom delimiter is not set)
				return displayMask;
			}

			uom_decimal = this._addEscapeChar(uom_decimal);
			uom_delimiter = this._addEscapeChar(uom_delimiter);

			var newMask = displayMask.replace(new RegExp(uom_delimiter, 'g'), "x");
			newMask = newMask.replace(new RegExp(uom_decimal,'g'), user_decimal);
			newMask = newMask.replace(new RegExp("x", 'g'), user_delimiter);

			return newMask;
		},

		_addEscapeChar: function(val) {
			if (val == ".") {
				val = "\\" + val;
			} 
			return val;
		},

		_useDelimiter: function(uom) {
			if (typeof uom == 'undefined' || uom == null || uom._UOM_Delimiter != null) {
				return true;
			}
			return false;
		},

		_formatIndianRupee: function(val) {
			if (val < 100000) {
				return format("##,##,###.00", val);
			}
			//Need to handle value that is more then 5 digits since format() does not handle it well. For example, format("##,##,###.00", 100000.00) return "100,000.00" and not "1,00,000.00"
			var number = format("#,##0.##", val);
			var group = number.split(",");
			var p1 = "";
			for (i=0;i<group.length-1;i++) {
				p1 +=group[i];
			}
			var p2 = group[group.length-1];
			return format("#0,#0.##", p1) + "," + format("#000.00", p2);
		},

		_computeCurrencySymbol: function(displaySymbol, uomValue) {
			if (displaySymbol && uomValue) {
				this.currencySymbol = uomValue._Currency_Symbol || "";
			} else {
				this.currencySymbol = "";
			}
		},

		_generateMask: function(decimal, delimiter, uom, uomValues, mask) {
			var displayMask = "";
			var uomValue = this._getUomValue(uomValues, uom);

			if (uom != null && uomValue != null) {
				if (uomValue._UOM_Type == "Currency") {
					//Following classic form design, the currency is masked with the user local (decimal and delimiter)
					var uomUser = this.user ? this.user._Currency : "";
					var uomValueUser = this._getUomValue(uomValues, uomUser);

					if (uomValueUser) {
						displayMask = this._applyLocaleSeparatorsToMask(uomValueUser._Display_Mask, uomValueUser._UOM_Decimal, uomValueUser._UOM_Delimiter, decimal, delimiter);
					} else {
						displayMask = this._applyLocaleSeparatorsToMask(uomValue._Display_Mask, uomValue._UOM_Decimal, uomValue._UOM_Delimiter, decimal, delimiter);
					}
				} else {
					displayMask = uomValue._Display_Mask;
					displayMask = this._applyLocaleSeparatorsToMask(displayMask, uomValue._UOM_Decimal, uomValue._UOM_Delimiter, decimal, delimiter);
				}
			} else {
				displayMask = this._defaultDisplayMask;
				if (mask != null) {
					displayMask = mask;
				}
				displayMask = this._applyLocaleSeparatorsToMask(displayMask, null, null, decimal, delimiter);
			}

			return displayMask;
		},

		_generateValidationPattern: function(delimiter, decimal, uom, uomValues, displaySymbol) {
			if (!this.currencySymbol) {
				var uomValue = this._getUomValue(uomValues, uom);
				this._computeCurrencySymbol(displaySymbol, uomValue);
			}

			var uomFactor = (displaySymbol && this.currencySymbol && this.currencySymbol != "") ? "(.{" + this.currencySymbol.length + "})?" : "";
			var negativeFactor = "([-])?";
			var mask = this._generateMask(decimal, delimiter, uom, uomValues);
			var uomUser = this.user ? this.user._Currency : "";
			var pattern = "";

			if (uomUser == "Indian Rupees") {
				var indianNumFactor = "([0-9]{1,2})?([,])?([0-9]{1,2})?([,])?([0-9]{1,3})?";
				var indianNumThousandFactor = "([0-9]{1,2})?([,])?([0-9]{1,2})?([,])?([0-9]{1,3})";

				pattern = negativeFactor + "(" + indianNumThousandFactor + "([,])?" + ")*" +
							indianNumFactor + "([.])?" + 
							"([0-9]{1,2})?";
			} else {
				var splitFormat = mask.split(decimal);
				var decimalLength = splitFormat[splitFormat.length - 1].length;

				var numFactor = "([0-9]{1,3})?";
				var numThousandFactor = "([0-9]{1,3})";
				var delimiterFactor = (delimiter && delimiter != "") ? 
										((delimiter == " ") ? "(\\s)" : "([" + delimiter + "])?") : 
										"";
				var decimalFactor = (decimal && decimal != "") ? "([" + decimal + "])?" : "";
				var decimalNumFactor = (decimalLength && decimalLength > 0) ? "([0-9]{1," + decimalLength + "})?" : "";

				pattern = negativeFactor + "(" + numThousandFactor + delimiterFactor + ")*" +
							numFactor + decimalFactor +
							decimalNumFactor;
			}

			var validationPattern = (this._isRtl) ? pattern + uomFactor : uomFactor + pattern;

			this.set("_validationPattern", validationPattern);
		}

	};

	TriPlatNumberBehavior = [
		TriPlatNumberBehaviorImpl,
		TriPlatUomBehaviorImpl
	];

</script>

<dom-module id="triplat-uom" assetpath="../triplat-uom/">
	<style>

		#triUom {
			@apply --triplat-uom-style;
			@apply --triplat-uom-info;
		}

		.triplat-uom-dropdown {
			@apply --triplat-uom-dropdown;
		}
		
		.dropdown-content {
			@apply --triplat-uom-dropdown-content;
		}

		paper-dropdown-menu {
			--iron-icon-fill-color: var(--triplat-uom-dropdown-icon-fill-color, var(--tri-secondary-color));
		}

		paper-item {
			padding: 0px 16px;
		}

	</style>
	<template>
		<template is="dom-if" if="[[_showString(uom)]]">
			<span id="triUom">{{getUomInfo(uom, uomList, display)}}</span>
		</template>
		<template is="dom-if" if="[[!_showString(uom)]]" notifydomchange="">
			<paper-dropdown-menu id="dropdownMenu" class="triplat-uom-dropdown" label="[[label]]" on-iron-overlay-canceled="_handleOverlayCancel" opened="{{_menuOpened}}" aria-label$="[[label]]" tabindex="0">
				<paper-listbox class="dropdown-content" selected="{{uomValue}}" attr-for-selected="name">
					<template is="dom-repeat" items="{{uomList}}">
						<paper-item name="{{item._UOM_Value}}">{{item._UOM_Display_Value}}</paper-item>
					</template>
				</paper-listbox>
			</paper-dropdown-menu>
		</template>
	</template>
</dom-module>
<script>
	Polymer({
		is: "triplat-uom",

		behaviors: [
			TriPlatAccessibilityBehavior,
			TriPlatUomBehavior
		],

		properties: {
			/**
			  * Optional. If omitted, displays the value of the UOM.  If exists, the value can be any of the following: uom, symbol, abbr.
			  *	Use 'uom' to display the value of the UOM in the language of the current user (e.g. "square-feet").  
			  *	Use 'symbol' to display the currency symbol of the UOM if it is of type Currency.
			  * Use 'abbr' to display the abbreviation of the UOM (e.g. ft2).
			  *
			  **/
			display: {
				type: String,
				value: "uom"
			},

			/**
			 * String value to be used for the drop down list label.
			 **/
			label: {
				type: String,
				value: null
			},

			/**
			  * Unit-of-Measure value, typically from the datasource field (e.g. "Metric Ton CO2", "square-feet").
			  **/
			uom: {
				type: String,
				notify: true,
				value: null
			},

			/**
			  * Unit-of-Measure datasource which contains the value specified in uom. If the uom value is an
			  * area, then this should be a UOM datasource that represents Area. 
			  **/
			uomList: {
				type: Object,
				value: null
			},

			/**
			  *  Show all the Unit-of-Measure as an editable drop down list. 
			  **/
			uomValue:{
				type: String,
				value: null,
				notify: true
			},

			_menuOpened: {
				type: Boolean,
				observer: "_setAriaExpanded"
			}
		},

		listeners: {
			"dom-change": "_setAriaExpanded"
		},

		_showString: function(uom) {
			return uom ? true : false;
		},

		attached: function() {
			this.setAttribute("role" , "application");
		},

		_handleOverlayCancel: function(e) {
			e.stopPropagation();
		},

		_setAriaExpanded: function() {
			if (this.$$("#dropdownMenu")) {
				this.setAriaProperty(this.$$("#dropdownMenu"), this._menuOpened, "expanded")
			}
		}
	});
</script><dom-module id="triplat-number-input" assetpath="../triplat-number-input/">
	<style include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning">
		#triUomValue {
			margin-bottom: 0.60em;
			margin-left: 5px;
			display: flex;
			align-self: flex-end;
			font-size: medium;  
			font-weight: lighter;
			@apply(--triplat-uom-value-style);
			@apply(--triplat-uom-value);
		}
		#triUomAbbr {
			margin-bottom: 0.60em;
			margin-left: 5px;
			display: flex;
			align-self: flex-end;
			font-size: medium;
			font-weight: lighter;
			@apply(--triplat-uom-abbr-style);
			@apply(--triplat-uom-abbr);
		}
		#triUomValueReadonly {
			margin-left: 5px;
			@apply(--triplat-uom-value-style);
			@apply(--triplat-uom-value);
		}
		#triUomAbbrReadonly {
			margin-left: 5px;
			@apply(--triplat-uom-abbr-style);
			@apply(--triplat-uom-abbr);
		}
		paper-input {
			@apply(--triplat-paper-input);
		}
	</style>
	<template>
		<div class="layout horizontal">
			<template is="dom-if" if="[[_readonlyNoDisabledNoLabel(disabled,readonly,label)]]">
				<span _style="{{_setStyle(style)}}" class="{{_setClass(class)}}">{{_formatNumber(unformattedValue, _decimal, _delimiter, uom, uomList, displaySymbol)}}</span>
				<template is="dom-if" if="{{displayUom}}">
					<triplat-uom id="triUomValueReadonly" uom="{{uom}}" uom-list="{{uomList}}" display="uom">
					</triplat-uom>
				</template>
				<template is="dom-if" if="{{displayAbbr}}">
					<triplat-uom id="triUomAbbrReadonly" uom="{{uom}}" uom-list="{{uomList}}" display="abbr">
					</triplat-uom>
				</template>
			</template>
			<paper-input hidden$="[[_readonlyNoDisabledNoLabel(disabled,readonly,label)]]" id="triNumberInput" label="[[label]]" _style="{{_setStyle(style)}}" class="{{_setClass(class)}}" value="{{_formatNumber(unformattedValue, _decimal, _delimiter, uom, uomList, displaySymbol)}}" on-change="_valueChanged" disabled="[[disabled]]" readonly="[[readonly]]" tri-scroll-into-view="" auto-validate="[[autoValidate]]" allowed-pattern="[0-9.,-\s]" pattern="[[_validationPattern]]" error-message="[[invalidInputMessage]]" invalid="{{invalid}}">
			</paper-input>
			<template is="dom-if" if="[[!_readonlyNoDisabledNoLabel(disabled,readonly,label)]]">
				<template is="dom-if" if="{{displayUom}}">
					<triplat-uom id="triUomValue" uom="{{uom}}" uom-list="{{uomList}}" display="uom">
					</triplat-uom>
				</template>
				<template is="dom-if" if="{{displayAbbr}}">
					<triplat-uom id="triUomAbbr" uom="{{uom}}" uom-list="{{uomList}}" display="abbr">
					</triplat-uom>
				</template>
			</template>
		</div>
	</template>
</dom-module>
<script>
	Polymer({
		is: "triplat-number-input",

		behaviors: [
			TriPlatNumberBehavior,
			TriBlockScrollFieldIntoViewBehavior
		],

		properties: {
			/**
			  * Style property to be applied to this element and its children.
			  *
			  **/
			style: {
				type: String,
				value: ""
			},

			/**
			  * Class property to be applied to this element and its children.
			  *
			  **/
			class: String,

			/**
			  * Description property to be applied to aria-label for assistive tool to read out description for this icon.
			  *
			  **/
			description: String,

			/**
			  * Numeric value without any formatting (e.g. no thousand delimiter, no decimal separator).
			  *
			  **/
			unformattedValue: {
				type: String,
				value: 0,
				notify: true
			},

			/**
			  * Unit-of-Measure value, typically from the datasource field (e.g. "Metric Ton CO2", "square feet").
			  **/
			uom: {
				type: String,
				value: null,
				notify: true
			},

			/**
			  * Unit-of-Measure datasource which contains the value specified in uom. If the uom value is an
			  * area, then this should be a UOM datasource that represents Area.
			  **/
			uomList: {
				type: Object,
				value: null
			},

			/**
			  * User object which contains the decimal and delimiter.
			  **/
			user: {
				type: Object,
				value: null
			},

			/**
			  * Character to use as the decimal separator. This is derived from the user.
			  **/
			_decimal: {
				type: String,
				computed: '_computeDecimal(user)'
			},

			/**
			  * Character to use as the thousands delimiter. This is derived from the user.
			  **/
			_delimiter: {
				type: String,
				computed: '_computeDelimiter(user)'
			},

			/**
			  * Show the value of the UOM at its default location which is after the input number.
			  * Use 'triplat-uom' component for displaying this information in a preferred location on the page. 
			  *
			  **/
			displayUom: {
				type: Boolean,
				value: false
			},

			/**
			  * Show the abbreviation of the UOM at its default location which is after the input number.
			  * Use 'triplat-uom' component for displaying this information in a preferred location on the page. 
			  *
			  **/
			displayAbbr: {
				type: Boolean,
				value: false
			},

			/**
			  * Show the currency symbol of the UOM at its default location which is before the input number.
			  * Use 'triplat-uom' component for displaying this information in a preferred location on the page. 
			  *
			  **/
			displaySymbol: {
				type: Boolean,
				value: false
			},

			/**
			  * Disable the field. The field cannot be selected nor can the value be changed.
			  *
			  **/
			disabled: {
				type: Boolean,
				value: false
			},

			/**
			  * Make the field read only. The field can be selected, but the value cannot be changed.
			  * To show only the value without the input field, enable this property and don't set a label.
			  *
			  **/
			readonly: { 
				type: Boolean,
				value: false
			},

			/**
			  * String value to be used for the label.
			  */
			label: {
				type: String,
				value: null
			},

			/*
			 * Optional minimum allowed for the input. If a value is smaller than minimum, the value will immediately be set to the defined min.
			 */
			min: {
				type: Number
			},

			/*
			 * Optional maximum allowed for the input. If a value is greater than maximum, the value will immediately be set to the defined max.
			 */
			max: {
				type: Number
			},

			/**
			  * Set to true to auto-validate the input value.
			  * If a `uom` is set, the validation format will be based on the UOM. Otherwise, it will validate a regular number.
			  **/
			autoValidate: {
				type: Boolean,
				value: false
			},

			/**
			  * Returns true if the value is invalid.
			  * If `autoValidate` is true, the `invalid` attribute is managed
			  * automatically (in the component), which can negate attempts to 
			  * manage it manually (in the app).
			  */
			invalid: {
				type: Boolean,
				value: false,
				notify: true
			},

			/**
			  * The error message to display when the input is invalid.
			  */
			invalidInputMessage: {
				type: String,
				value: function() {
					var __dictionary__invalidInputMessage = "Invalid input.";
					return __dictionary__invalidInputMessage;
				}
			}
		},

		observers: [
			"_generateValidationPattern(_delimiter, _decimal, uom, uomList, displaySymbol)"
		],

		get paperInputElement() {
			return this.$.triNumberInput;
		},

		attached: function() {
			// if the width is not set (no one would set to to less than 10px), then set it to flex 
			if (this.$.triNumberInput.offsetWidth < 10) {
				this.$.triNumberInput.classList.add("flex");
			}
		},

		_setStyle: function(style) {
			this.$.triNumberInput.style.cssText = style;
		},

		_resetClassMap: function() {
			for (var myclass in this.$.triNumberInput._classMap) {
				this.$.triNumberInput._classMap[myclass] = false;
			}
		},

		_cleanClassMap: function() {
			var returnClassArray = [];
			for (var myclass in this.$.triNumberInput._classMap) {
				if (!this.$.triNumberInput._classMap[myclass]) {
					returnClassArray.push(myclass);
					delete this.$.triNumberInput._classMap[myclass];
				}
			}
			return returnClassArray;
		},

		_isNewClassInMap: function(newclass) {
			if (typeof this.$.triNumberInput._classMap == 'undefined') {
				this.$.triNumberInput._classMap = {};
				this.$.triNumberInput._classMap[newclass] = true;
				return true;
			} else {
				if (newclass in this.$.triNumberInput._classMap) {
					this.$.triNumberInput._classMap[newclass] = true;
					return false;
				} else {
					this.$.triNumberInput._classMap[newclass] = true;
					return true;
				}
			}
		},

		_setClass: function(myclass){
			if (!myclass) {
				return;
			}
			this._resetClassMap();
			var arr = myclass.split(" ");
			// add in new addition class
			for (var i=0; i < arr.length; i++) {
				if (this._isNewClassInMap(arr[i])) {
					this.$.triNumberInput.classList.add(arr[i]);
				}
			}
			// remove unused class
			var deleteClasses = this._cleanClassMap();
			for (var i=0; i < deleteClasses.length; i++) {
				this.$.triNumberInput.classList.remove(deleteClasses[i]);
			}
		},

		_valueChanged: function(e) {
			var input = e.target.value;
			var newValue = parseFloat(this.unformatNumber(input));
			if (input == "" || input === null) {
				this.set("unformattedValue", null);
			} else if (isNaN(newValue)) {
				this.$.triNumberInput.value = this._formatNumber(this.unformattedValue, this._decimal, this._delimiter, this.uom, this.uomList, this.displaySymbol);
			} else if (this.min != null && this.min > newValue) {
				if (this.unformattedValue == this.min.toString()) 
					this.$.triNumberInput.value = this._formatNumber(this.unformattedValue, this._decimal, this._delimiter, this.uom, this.uomList, this.displaySymbol);
				else
					this.set("unformattedValue", this.min.toString());
			} else if (this.max != null && this.max < newValue) {
				if (this.unformattedValue == this.max.toString())
					this.$.triNumberInput.value = this._formatNumber(this.unformattedValue, this._decimal, this._delimiter, this.uom, this.uomList, this.displaySymbol);
				else
					this.set("unformattedValue", this.max.toString());
			} else
				this.set("unformattedValue", newValue);
		},

		_computeDecimal: function() {
			if (typeof this.user != 'undefined' && this.user != null) {
				return this.user._Decimal;
			}
			return null;
		},

		_computeDelimiter: function() {
			if (typeof this.user != 'undefined' && this.user != null) {
				return this.user._Delimiter;
			}
			return null;
		},

		_readonlyNoDisabledNoLabel: function(disabled,readonly,label) {
			return !disabled && readonly && !label;
		},

	});
</script><dom-module id="tricomp-food-order-item" assetpath="">
	<template>
		<style include="shared-page-styles">
			:host {
				@apply(--layout-vertical);
				flex-shrink: 0;
				border-bottom: 1px solid var(--ibm-gray-30);
			}
			:host:first-of-type {
				border-top: 1px solid var(--ibm-gray-30);
			}

			.container {
				@apply(--layout-horizontal);
				padding: 5px 0;
			}
			:host(:not([small-screen-width])) .container {
				@apply(--layout-center);
			}
			:host([small-screen-width]) .container {
				@apply(--layout-vertical);
				min-height: 0;
			}

			:host([small-screen-width]) .img-details-container,
			:host([small-screen-width]) .button-container {
				flex-shrink: 0;
			}

			.img-details-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}
			:host(:not([small-screen-width])) .img-details-container {
				@apply(--layout-flex);
			}
			
			.image-container {
				@apply(--layout-vertical);
			}
			.image {
				width: 64px;
				height: 64px;
			}
			.image-placeholder-icon {
				--triplat-icon-height: 64px;
				--triplat-icon-width: 64px;
				--triplat-icon-fill-color: var(--tri-primary-content-accent-color);
			}

			.details-container {
				@apply(--layout-flex);
				@apply(--layout-vertical);
				@apply(--layout-self-start);
				padding: 5px 10px;
			}
			.item-name {
				margin-bottom: 3px;
				font-size: 16px;
				font-weight: bold;
			}
			paper-textarea {
				--paper-input-container-input: {
					font-size: 12px !important;
				}
			}

			.button-container {
				@apply(--layout-horizontal);
				@apply(--layout-start);
			}
			:host([small-screen-width]) .button-container {
				@apply(--layout-center-center);
				padding: 10px 0;
			}
			:host[is-added] .button-container {
				@apply(--layout-self-start);
				padding: 10px 0;
			}
			:host[small-screen-width][is-added] .button-container {
				@apply(--layout-self-center);
			}

			:host([small-screen-width]) .quantity-input {
				padding-right: 10px;
			}
			tricomp-incremental-number-input {
				--tricomp-incremental-number-input-padding-top: 0px;
			}
		</style>

		<tricore-url raw-url="/getCompanyFile.jsp?fileLoc=" bind-url="{{imgUrl}}"></tricore-url>

		<div class="container">
			<div class="img-details-container">
				<template is="dom-if" if="[[_showImage(applicationSettings)]]">
					<div class="image-container">
						<iron-image class="image" src="{{_computeImageUrl(item.image, imgUrl)}}" sizing="cover" hidden$="[[!imageLoaded]]" loaded="{{imageLoaded}}"></iron-image>
						<triplat-icon class="image-placeholder-icon" icon="picturefile" hidden$="[[imageLoaded]]"></triplat-icon>
					</div>
				</template>

				<div class="details-container">
					<div class="item-name">[[item.menuItem]]</div>
					<div>[[item.description]]</div>

					<paper-textarea label="Instructions" value="{{item.instructions}}" max-rows="4" hidden$="[[!_computeIsAdded(item._id, item.quantity)]]" always-float-label=""></paper-textarea>
				</div>
			</div>

			<div class="button-container">
				<tricomp-incremental-number-input class="quantity-input" hidden="[[!_computeIsAdded(item._id, item.quantity)]]" on-user-change="_handleQuantityChange" min="1" max="9999" value="{{item.quantity}}"></tricomp-incremental-number-input>
				<paper-button secondary="" class="action-button" hidden$="[[_computeIsAdded(item._id, item.quantity)]]" on-tap="_handleAddFood" noink="">Add</paper-button>
				<paper-button danger-outline="" class="action-button" hidden$="[[!_computeIsAdded(item._id, item.quantity)]]" on-tap="_handleRemoveFood" noink="">Remove</paper-button>
			</div>
		</div>
	</template>
	<script>
		Polymer({

			is: "tricomp-food-order-item",

			behaviors: [
				TriBlockViewResponsiveBehavior,
				TriRoomReservationUtilBehavior,
				TriPlatNumberBehavior
			],

			properties: {
				item: Object,
				isAdded: {
					type: Boolean,
					value: false,
					reflectToAttribute: true,
					computed: '_computeIsAdded(item._id, item.quantity)'
				}
			},

			observers: [
				'_handleInstructionsChange(item.instructions)'
			],

			_computeIsAdded: function(id, quantity) {
				return id != null && quantity > 0;
			},

			_setModified: function() {
				this.item._modified = true;
				this.fire("food-order-changed");
			},

			_handleQuantityChange: function() {
				if (this.item && this.item._id) {
					this._setModified();
				}
			},

			_handleInstructionsChange: function(instructions) {
				if (this.item && this.item._id) {
					this._setModified();
				}
			},

			_handleAddFood: function() {
				if (this.item && this.item._id > 0) {
					this.set("item.quantity", 1);
					this._setModified();
					return;
				} else {
					var menuItemId = this.item.menuItemId;
					this.fire("action-add-food", { 'menuItemId' : menuItemId, 'el' : this });
				}
			},

			_handleRemoveFood: function() {
				this.set("item.quantity", 0);
				this._setModified();
			}

		});
	</script>
</dom-module>
<dom-module id="tricomp-food-order" assetpath="">
	<template>
		<style include="shared-page-styles">
			:host {
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			.food-order-container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				min-height: 0;
			}

			.hold-time-message {
				flex-shrink: 0;
			}
			
			.header {
				padding: 20px 20px 10px 20px;
			}

			.header-title {
				font-size: 18px;
				margin-bottom: 3px;
			}

			.room-name {
				font-size: 17px;
				font-weight: bold;
			}

			.food-order-scrollable-area {
				@apply(--layout-flex);
				overflow-y: auto;
			}

			.order-details {
				padding: 0 20px;
			}
			
			.order-details-primary {
				@apply(--layout-horizontal);
				@apply(--layout-justified);
			}
			:host[small-screen-width] .order-details-primary {
				@apply(--layout-wrap);
			}
			.order-details-primary paper-input,
			.order-details-primary triplat-datetime-picker {
				flex-basis: 48%;
			}
			:host[small-screen-width] .order-details-primary paper-input,
			:host[small-screen-width] .order-details-primary triplat-datetime-picker {
				flex-basis: 100%;
			}

			.order-datetime-picker {
				--triplat-date-picker-width: 100%;
				flex-shrink: 0;
			}

			.list {
				min-height: 0;
				padding: 20px;
			}
		</style>

		<div class="food-order-container" hidden$="[[!foodOrderLineItemsDisplay.length]]">		
			<tricomp-alert-message danger="" icon="ibm:clock-time" id="holdTimeMessage" class="hold-time-message" show$="[[reservationLocation.holdTimeDeadline]]" show-tooltip-indicator-icon="">
				<span hidden$="[[holdTimeExpired]]">Hold expires in</span>
				<triplat-countdown class="hold-time-countdown" name="booking-expiration" deadline="[[reservationLocation.holdTimeDeadline]]" expired-text="Hold time is expired." timezone="[[currentUser._TimeZoneId]]" is-expired="{{holdTimeExpired}}">
				</triplat-countdown>
			</tricomp-alert-message>
			<paper-tooltip for="holdTimeMessage" position="bottom" offset="5" animation-delay="100" fit-to-visible-bounds="">When the hold time on this room expires, all added food and equipment are not saved, and the room is removed for this reservation.</paper-tooltip>

			<div class="header">
				<div class="header-title">Food Order [[reservationManager.foodOrderId]]</div>
				<div class="room-name">[[room]]</div>
			</div>

			<div class="food-order-scrollable-area">
				<div class="order-details">
					<div class="order-details-primary">
						<paper-input label="Order Name" value="{{reservationManager.foodOrderName}}" maxlength="150" auto-validate="" always-float-label="">
						</paper-input>
						<triplat-datetime-picker class="order-datetime-picker" label="Delivery Time" value="{{reservationManager.foodOrderDateTime}}" display-format="[[currentUser._DateTimeFormat]]" time-zone="[[currentUser._TimeZoneId]]"></triplat-datetime-picker>
					</div>

					<paper-textarea label="Instructions" value="{{reservationManager.foodOrderInstructions}}" max-rows="4" always-float-label=""></paper-textarea>
				</div>

				<div class="list">
					<template id="listTemplate" is="dom-repeat" items="[[foodOrderLineItemsDisplay]]">
						<tricomp-food-order-item item="{{item}}" application-settings="[[applicationSettings]]">
						</tricomp-food-order-item>
					</template>
				</div>
			</div>
		</div>

		<template is="dom-if" if="[[!foodOrderLineItemsDisplay.length]]">
			<div class="page-main empty-data-message">
				<span hidden$="[[_pageLoading]]">No food order items are available.</span>
			</div>
		</template>

		<tricomp-page-toolbar small-screen-width="[[smallScreenWidth]]" class="toolbar-symmetrical">
			<paper-button footer$="[[smallScreenWidth]]" on-tap="_handleDone" noink="">Done</paper-button>
		</tricomp-page-toolbar>
	</template>
	<script>
		Polymer({

			is: "tricomp-food-order",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				room: String,
				_disableDeleteActionButton: {
					type: Boolean,
					computed: "_computeDisableDeleteActionButton(orderId)"
				},
				foodOrderLineItemsDisplay: Array,
				_dirtyFlag: {
					type: Boolean,
					value: false
				},
				
				_pageLoading: {
					type: Boolean,
					computed: "_isBusy(isBusy)"
				},
			},

			observers: [
				"_handleChanges(menuItems, foodOrderLineItems)"
			],

			listeners: {
				"action-add-food": "_handleAddFood",
				"food-order-changed": "_handleFoodOrderChanged"
			},

			_isBusy: function(isBusy, reservationManagerLoading, foodOrdersLoading, foodOrderLineItemsLoading, menuItemsLoading, reservationLocationsLoading) {
				return isBusy || reservationManagerLoading || foodOrdersLoading || foodOrderLineItemsLoading || menuItemsLoading || reservationLocationsLoading;
			},

			_computeDisableDeleteActionButton: function(orderId) {
				return (!orderId || orderId < 0);
			},

			_handleFoodOrderChanged: function() {
				this._setDirtyFlag();
			},

			_setDirtyFlag: function() {
				this.set("_dirtyFlag", true);
			},

			_clearDirtyFlag: function() {
				this.set("_dirtyFlag", false);
			},

			_handleChanges: function(menuItems, foodOrderLineItems) {
				if (this._dirtyFlag) {
					return;
				}
				var newFoodOrderLineItemsDisplay = new Array();

				if (menuItems && menuItems.constructor === Array &&
					foodOrderLineItems && foodOrderLineItems.constructor === Array) {

					for (var itemIndex=0; itemIndex < menuItems.slice(0).length; itemIndex++) {
						var menuItem = menuItems[itemIndex];

						var matchingOrderItem = null;
						for (var orderIndex=0; orderIndex < foodOrderLineItems.slice(0).length; orderIndex++) {
							var orderItem = foodOrderLineItems[orderIndex];

							if (orderItem.menuItemId == menuItem._id) {
								matchingOrderItem = orderItem;
								break;
							}
						}

						if (matchingOrderItem == null) {
							var newOrder = new Object();

							newOrder._id = null;
							newOrder.orderNum = null;

							newOrder.image = menuItem.image;
							newOrder.menuItem = menuItem.menuItem;
							newOrder.menuItemId = menuItem._id;
							newOrder.description = menuItem.description;

							newOrder.costPerItem = new Object;
							newOrder.costPerItem.uom = menuItem.costPerItem.uom;
							newOrder.costPerItem.value = menuItem.costPerItem.value;

							newOrder.totalCost = new Object;
							newOrder.totalCost.uom = menuItem.costPerItem.uom;
							newOrder.totalCost.value = 0;

							newOrder.quantity = 0;
							newOrder.instructions = "";

							newFoodOrderLineItemsDisplay.push(newOrder);
						} else {
							newFoodOrderLineItemsDisplay.push(matchingOrderItem);
						}
					}
				}
				this.debounce(
					"setFoodOrderLineItemsDisplay",
					this.set.bind(this,"foodOrderLineItemsDisplay", newFoodOrderLineItemsDisplay),
					300
				);
			},

			_handleDeleteFoodOrderTap: function(e) {
				var resourceId = this.resourceId;
				var orderId = this.orderId;
				if (resourceId && orderId) this.fire("action-food-order-cancel", { 'resourceId' : resourceId, 'orderId' : orderId });
			},

			_handleAddFood: function(e) {
				if (e && e.detail) {
					var menuItemId = e.detail.menuItemId;
					var el = e.detail.el;

					var model = this.$.listTemplate.modelForElement(el);
					if (model) {
						// check to see if the item was already created (add/remove/add)
						var orderItem = model.item;
						if (orderItem._id > 0)
							return;

						this._setDirtyFlag();

						this.fire("action-add-food-order-item", {resourceId: this.resourceId, orderId: this.orderId, menuItemId: menuItemId, model: model});
					}
				}
			},

			_handleSaveOrder: function() {
				if(this.foodOrderLineItemsDisplay.length && this._dirtyFlag){
					this.fire("action-save-food-order", {resourceId: this.resourceId, orderId: this.orderId, foodOrderLineItems: this.foodOrderLineItemsDisplay});
				}
				
			},

			_handleDone: function(){
				this.async(function() {
					this.fire("done");
				});
			},

			// override
			_pageAttached : function() {
				// reset the dirty flag
				this._clearDirtyFlag();

				this.fire("action-load-food-order");
			},
		});
	</script>
</dom-module>
<dom-module id="tricomp-food-orders-summary" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			.food-order-summary-container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				overflow-y: auto;
			}

			.empty-data-message {
				@apply(--layout-flex);
			}
			.empty-data-message > * {
				margin: 10px 0;
			}
			.empty-data-message-icon {
				height: 32px;
				width: 32px;
			}

			.hold-time-message {
				margin-bottom: 1px;
			}

			.order-item {
				@apply(--layout-vertical);
				@apply(--layout-self-start);
				flex-shrink: 0;
				flex-basis: 47%;
				margin-bottom: 20px;
				border: 1px solid var(--ibm-gray-10);
			}
			:host:not([small-screen-width]) .order-item {
				max-width: 47%;
			}
			:host[small-screen-width] .order-item {
				flex-basis: 100%;
			}

			.order-header {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				color: var(--ibm-gray-50);
				font-size: 18px;
				font-weight: bold;
				padding: 10px;
			}
			.order-header iron-icon {
				--iron-icon-width: 30px;
				--iron-icon-height: 30px;

				margin-right: 5px;
			}

			.order-location {
				margin-bottom: 10px;
				padding: 5px 20px 20px 20px;
				color: var(--ibm-gray-50);
			}
			.order-location p {
				margin: 0;
			}
			.order-location .room {
				margin-bottom: 5px;
				font-size: 18px;
				font-weight: bold;
			}

			.order-body {
				@apply(--layout-vertical);
				margin-bottom: 15px;
				border-top: 1px solid var(--ibm-gray-10);
				padding: 20px;
			}

			.order-datetime-picker {
				--triplat-date-picker-width: 100%;
			}

			.order-name {
				margin-bottom: 10px;
				font-size: 20px;
				font-weight: 500;
			}

			.order-actions {
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
				padding: 5px 2px;
			}
			.order-actions paper-button {
				@apply(--layout-flex);
			}

			.list {
				@apply(--layout-horizontal);
				@apply(--layout-wrap);
				@apply(--layout-justified);
				@apply(--layout-flex);
				@apply(--layout-self-stretch);
				padding: 20px;
			}

			paper-button {
				white-space: nowrap;
			}

		</style>
		
		<div class="food-order-summary-container" hidden$="[[!foodOrders.length]]">
			<tricomp-alert-message danger="" icon="ibm:clock-time" id="holdTimeMessage" class="hold-time-message" show$="[[reservationLocation.holdTimeDeadline]]" show-tooltip-indicator-icon="">
				<span hidden$="[[holdTimeExpired]]">Hold expires in</span>
				<triplat-countdown class="hold-time-countdown" name="booking-expiration" deadline="[[reservationLocation.holdTimeDeadline]]" expired-text="Hold time is expired." timezone="[[currentUser._TimeZoneId]]" is-expired="{{holdTimeExpired}}">
				</triplat-countdown>
			</tricomp-alert-message>
			<paper-tooltip for="holdTimeMessage" position="top" offset="5" animation-delay="100" fit-to-visible-bounds="">When the hold time on this room expires, all added food and equipment are not saved, and the room is removed for this reservation.</paper-tooltip>

			<div class="list">
				<template id="foodOrderTemplate" is="dom-repeat" items="[[foodOrders]]">
					<div class="order-item">
						<div class="order-header">
							<iron-icon class="room-service-icon" icon="ibm-glyphs:catering"></iron-icon> 
							Food Order [[item.orderNum]]
						</div>

						<div class="order-location">
							<p class="room">[[item.room]]</p>
							<p>[[item.building]]</p>
							<p>[[item.floor]]</p>
						</div>

						<div class="order-body">
							<div class="order-name" hidden$="[[!item.name]]">[[item.name]]</div>
							<triplat-datetime-picker class="order-datetime-picker" hidden$="[[!item.requestedDateTime]]" label="Delivery Time" value="{{item.requestedDateTime}}" display-format="[[currentUser._DateTimeFormat]]" time-zone="[[currentUser._TimeZoneId]]" readonly=""></triplat-datetime-picker>
						</div>

						<div class="order-actions">
							<paper-button danger-outline="" on-tap="_handleDeleteFoodOrderTap" noink="">Cancel Order</paper-button>
							<paper-button secondary="" on-tap="_handleOpenFoodOrderTap" noink="">Edit Order</paper-button>
						</div>
					</div>
				</template>
			</div>
		</div>

		<template is="dom-if" if="[[!foodOrders.length]]">
			<div class="empty-data-message">
				<iron-icon class="empty-data-message-icon" icon="ibm:status-info" info="" hidden$="[[_pageLoading]]"></iron-icon>
				<div hidden$="[[_pageLoading]]">You don't have any food orders for this room reservation.</div>
				<div hidden$="[[_pageLoading]]">To add a food order, tap the "Add" button.</div>
			</div>
		</template>

		<tricomp-page-toolbar small-screen-width="[[smallScreenWidth]]" class="toolbar-symmetrical">
			<paper-button secondary$="[[!smallScreenWidth]]" footer-secondary$="[[smallScreenWidth]]" on-tap="_handleCloseDialog" noink="">Close</paper-button>
			<paper-button footer$="[[smallScreenWidth]]" on-tap="_handleAddFoodOrderTap" noink="">Add Order</paper-button>
		</tricomp-page-toolbar>

	</template>
	<script>
		Polymer({

			is: "tricomp-food-orders-summary",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				resourceId: {
					type: String,
					value: "-1"
				},
				_pageLoading: {
					type: Boolean,
					computed: "_isBusy(isBusy)"
				},
			},

			_handleAddFoodOrderTap: function(e) {
				var resourceId = this.resourceId;
				if (resourceId) this.fire("navigate-food-order-add", { 'resourceId' : resourceId, 'orderId' : "-1" });
			},

			_handleDeleteFoodOrderTap: function(e) {
				var resourceId = this.resourceId;
				var foodOrder = this.$.foodOrderTemplate.itemForElement(e.currentTarget);
				var orderId = foodOrder._id;
				if (resourceId && orderId) this.fire("action-food-order-cancel", { 'resourceId' : resourceId, 'orderId' : orderId });
			},

			_handleOpenFoodOrderTap: function(e) {
				var resourceId = this.resourceId;
				var foodOrder = this.$.foodOrderTemplate.itemForElement(e.currentTarget);
				var orderId = foodOrder._id;
				if (resourceId && orderId) this.fire("navigate-food-order", { 'resourceId' : resourceId, 'orderId' : orderId });
			},

			_handleCloseDialog: function() {
				this.fire("done");
			},

			// override
			_isBusy: function(isBusy) {
				return isBusy;
			},

			// override
			_pageAttached : function() {

			}
		});
	</script>
</dom-module>
<dom-module id="tricomp-equipment-order-item" assetpath="">
	<template>
		<style include="shared-page-styles">
			:host {
				@apply(--layout-vertical);
				padding: 10px 0 10px 10px;
				flex-shrink: 0;
			}

			:host:nth-of-type(even) {
				background-color: var(--ibm-neutral-2);
			}

			.top-container {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				padding: 10px 0;
				margin-left: 10px;
			}

			.image-container {
				@apply(--layout-vertical);
				padding-right: 10px;
			}

				.image {
					width: 64px;
					height: 64px;
				}

				.image-placeholder-icon {
					--triplat-icon-height: 64px;
					--triplat-icon-width: 64px;
					--triplat-icon-fill-color: var(--tri-primary-content-accent-color);
				}

			.details-container {
				@apply(--layout-flex);
				@apply(--layout-vertical);
				@apply(--layout-self-start);
			}

				.item-name {
					font-weight: bold;
				}

				.description {
					overflow: hidden;
					text-overflow: ellipsis;
					display: -webkit-box;
					-webkit-box-orient: vertical;
					-webkit-line-clamp: 2;
				}

			.button-container {
				@apply(--layout-horizontal);
			}

			.top-container .button-container {
				padding-left: 10px;
			}

			:host([small-screen-width]) .top-container .button-container {
				display: none;
			}

			.drill-container {
				@apply(--layout-self-stretch);
				@apply(--layout-horizontal);
				@apply(--layout-center);
				cursor: pointer;
				padding: 0 10px;
			}

			.bottom-container {
				@apply(--layout-vertical);
			}

			paper-input-container {
				padding: 0;
			}

			:host([small-screen-width]) .bottom-container {
				padding: 0 10px;
			}

			:host(:not([small-screen-width])) .bottom-container {
				padding: 0 52px 0 74px;
			}

			.bottom-container .button-container {
				@apply(--layout-center);
			}

			:host(:not([small-screen-width])) .bottom-container .action-button {
				display: none;
			}

			:host([small-screen-width]) .bottom-container .button-container {
				@apply(--layout-center-center);
			}

			:host-context([dir="rtl"]) .expand-button {
                 transform: scaleX(-1);
            } 

		</style>

		<tricore-url raw-url="/getCompanyFile.jsp?fileLoc=" bind-url="{{imgUrl}}"></tricore-url>

		<div class="top-container">
			<template is="dom-if" if="[[_showImage(applicationSettings)]]">
				<div class="image-container">
					<iron-image class="image" src="{{_computeImageUrl(item.image, imgUrl)}}" sizing="cover" hidden$="[[!imageLoaded]]" loaded="{{imageLoaded}}"></iron-image>
					<triplat-icon class="image-placeholder-icon" icon="picturefile" hidden$="[[imageLoaded]]"></triplat-icon>
				</div>
			</template>
			<div class="details-container">
				<div class="item-name">[[item.equipment]]</div>
				<div class="description">[[item.equipmentDescription]]</div>
			</div>
			<div class="button-container">
				<paper-button secondary="" class="action-button" hidden$="[[_computeIsAdded(item._id, item.quantity)]]" on-tap="_handleAddEquipment">Add</paper-button>
				<paper-button danger-outline="" class="action-button" hidden$="[[!_computeIsAdded(item._id, item.quantity)]]" on-tap="_handleRemoveEquipment">Remove</paper-button>
			</div>
			<div class="drill-container" on-tap="_handleOpenEquipmentDetails">
				<paper-icon-button primary="" class="expand-button" icon="ibm-glyphs:expand-open"></paper-icon-button>
			</div>
		</div>

		<div class="bottom-container">
			<div class="button-container">
				<tricomp-incremental-number-input class="quantity" on-user-change="_handleQuantityChange" hidden$="[[!_computeIsAdded(item._id, item.quantity)]]" min="1" value="{{item.quantity}}"></tricomp-incremental-number-input>
				<paper-button secondary="" class="action-button" hidden$="[[_computeIsAdded(item._id, item.quantity)]]" on-tap="_handleAddEquipment">Add</paper-button>
				<paper-button danger-outline="" class="action-button" hidden$="[[!_computeIsAdded(item._id, item.quantity)]]" on-tap="_handleRemoveEquipment">Remove</paper-button>
			</div>
			<paper-textarea label="[[_computeInstructionsLabel(item.instructions, _instructionsMaxLength)]]" on-change="_handleInstructionsChange" value="{{item.instructions}}" max-rows="4" hidden$="[[!_computeIsAdded(item._id, item.quantity)]]" maxlength="[[_instructionsMaxLength]]"></paper-textarea>
		</div>
	</template>
	<script>
		Polymer({

			is: "tricomp-equipment-order-item",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				item: Object,

				_instructionsMaxLength: {
					type: Number,
					value: 700
				}
			},

			_computeIsAdded: function(id, quantity) {
				return id != null && quantity > 0;
			},

			_setModified: function() {
				this.item._modified = true;
				this.fire("equipment-order-changed");
			},

			_handleQuantityChange: function() {
				if (this.item && this.item._id) {
					this._setModified();
				}
			},

			_handleInstructionsChange: function() {
				if (this.item && this.item._id) {
					this._setModified();
				}
			},

			_handleAddEquipment: function() {
				if (this.item._id > 0) {
					this.set("item.quantity", 1);
					this._setModified();
					return;
				} else {
					var equipmentId = this.item.equipmentId;
					this.fire("action-add-equipment", { 'equipmentId' : equipmentId, 'el' : this });
				}
			},

			_handleRemoveEquipment: function() {
				this.set("item.quantity", 0);
				this._setModified();
			},

			_handleOpenEquipmentDetails: function(e) {
				var equipmentId = this.item.equipmentId;
				this.fire("navigate-equipment-details-save", { 'equipmentId' : equipmentId });
			},

			_computeInstructionsLabel: function(value, maximum) {
				var __dictionary__instructionsString = "Instructions";
				var __dictionary__charactersString = "characters";
				var __dictionary__charactersRemainingString = "characters remaining";

				if (!value || value == "") {
					return __dictionary__instructionsString + " (" + maximum + " " + __dictionary__charactersString + ")";
				} else {
					var count = value.length;
					var remaining = maximum - count;
					return __dictionary__instructionsString + " (" + remaining + " " + __dictionary__charactersRemainingString + ")";
				}
			}

		});
	</script>
</dom-module>
<dom-module id="tricomp-equipment-order" assetpath="">
	<template>
		<style include="shared-page-styles">
			:host {
				position: relative;
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			.equipment-order-container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				min-height: 0;
			}

			tricomp-alert-message {
				flex-shrink: 0;
			}
			
			.header {
				padding: 20px 20px 5px 20px;
			}

			.room-name {
				font-weight: bold;
			}

			.list {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				@apply(--layout-scroll);
				min-height: 0;
			}

			:host(small-screen-width) .action-bar {
				background-color: var(--tri-footer-background-color);
				color: var(--tri-footer-color);
				width: 100%;
				padding: 5px;
				@apply(--layout-center-center);
				@apply(--layout-fixed-bottom);
				z-index: 102;
			}

		</style>

		<tricore-url raw-url="/getCompanyFile.jsp?fileLoc=" bind-url="{{imgUrl}}"></tricore-url>

		<div class="equipment-order-container" hidden$="[[!equipmentOrdersDisplay.length]]">		
			<tricomp-alert-message danger="" class="hold-time-message" icon="ibm:clock-time" id="holdTimeMessage" show$="[[reservationLocation.holdTimeDeadline]]" show-tooltip-indicator-icon="">
				<span hidden$="[[holdTimeExpired]]">Hold expires in</span>
				<triplat-countdown class="hold-time-countdown" name="booking-expiration" deadline="[[reservationLocation.holdTimeDeadline]]" expired-text="Hold time is expired." timezone="[[currentUser._TimeZoneId]]" is-expired="{{holdTimeExpired}}">
				</triplat-countdown>
			</tricomp-alert-message>
			<paper-tooltip for="holdTimeMessage" position="bottom" offset="5" animation-delay="100" fit-to-visible-bounds="">When the hold time on this room expires, all added food and equipment are not saved, and the room is removed for this reservation.</paper-tooltip>

			<div class="list">
				<div class="header">
					<div class="tri-h2">Equipment</div>
					<div class="tri-h3 room-name">[[room]]</div>
				</div>
				<template id="listTemplate" is="dom-repeat" items="[[equipmentOrdersDisplay]]">
					<tricomp-equipment-order-item item="{{item}}" application-settings="[[applicationSettings]]">
					</tricomp-equipment-order-item>
				</template>
			</div>
		</div>

		<template is="dom-if" if="[[!equipmentOrdersDisplay.length]]">
			<div class="page-main empty-data-message">
				<span hidden$="[[_pageLoading]]">No equipment order items are available.</span>
			</div>
		</template>

		<tricomp-page-toolbar small-screen-width="[[smallScreenWidth]]">
			<paper-button footer$="[[smallScreenWidth]]" on-tap="_handleDone">Done</paper-button>
		</tricomp-page-toolbar>
	</template>
	<script>
		Polymer({

			is: "tricomp-equipment-order",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				equipmentOrdersDisplay: Array,
				addedEquipmentId: String,
				room: String,
				_pageLoading: {
					type: Boolean,
					computed: "_isBusy(isBusy)"
				},
			},

			observers: [
				"_handleChanges(equipmentSpecs, equipmentOrders)",
			],

			listeners: {
				"action-add-equipment": "_handleAddEquipment",
				"equipment-order-changed": "_handleEquipmentOrderChanged",
				"navigate-equipment-details-save": "_handleNavigateEquipmentDetails"
			},

			_isBusy: function(isBusy, reservationManagerLoading, equipmentOrdersLoading, equipmentSpecsLoading, reservationLocationsLoading) {
				return isBusy || reservationManagerLoading || equipmentOrdersLoading || equipmentSpecsLoading || reservationLocationsLoading;
			},

			_handleEquipmentOrderChanged: function() {
				this._setDirtyFlag();
			},

			_setDirtyFlag: function() {
				this.set("_dirtyFlag", true);
			},

			_clearDirtyFlag: function() {
				this.set("_dirtyFlag", false);
			},

			_handleChanges: function(equipmentSpecs, equipmentOrders) {
				if (this._dirtyFlag) {
					return;
				}

				var newEquipmentOrdersDisplay = new Array();

				if (equipmentSpecs && equipmentSpecs.constructor === Array &&
					equipmentOrders && equipmentOrders.constructor === Array) {

					for (var itemIndex=0; itemIndex < equipmentSpecs.slice(0).length; itemIndex++) {
						var spec = equipmentSpecs[itemIndex];

						var matchingOrderItem = null;
						for (var orderIndex=0; orderIndex < equipmentOrders.slice(0).length; orderIndex++) {
							var orderItem = equipmentOrders[orderIndex];

							if (orderItem.equipmentId == spec._id) {
								matchingOrderItem = orderItem;
								break;
							}
						}

						if (matchingOrderItem == null) {
							var newOrder = new Object();

							newOrder._id = null;
							newOrder.orderNum = null;

							newOrder.image = spec.image;
							newOrder.equipment = spec.name;
							newOrder.equipmentId = spec._id;
							newOrder.equipmentDescription = spec.description;

							newOrder.usageCost = new Object;
							newOrder.usageCost.uom = spec.usageCost.uom;
							newOrder.usageCost.value = spec.usageCost.value;

							newOrder.totalCost = new Object;
							newOrder.totalCost.uom = spec.usageCost.uom;
							newOrder.totalCost.value = 0;

							newOrder.quantity = 0;
							newOrder.instructions = "";

							newEquipmentOrdersDisplay.push(newOrder);
						} else {
							newEquipmentOrdersDisplay.push(matchingOrderItem);
						}
					}
					this.debounce(
						"setEquipmentOrdersDisplay",
						this.set.bind(this,"equipmentOrdersDisplay", newEquipmentOrdersDisplay),
						300
					);
				}
			},

			_handleAddEquipment: function(e) {
				if (e && e.detail) {
					var equipmentId = e.detail.equipmentId;
					var el = e.detail.el;

					var model = this.$.listTemplate.modelForElement(el);
					if (model) {
						var orderItem = model.item;
						if (orderItem._id > 0)
							return;

						this._setDirtyFlag();

						this.fire("action-add-equipment-item", {equipmentId: equipmentId, model: model});
					}
				}
			},

			_handleDone: function(){
				this.async(function() {
					this.fire("done");
				});
			},

			_handleSaveOrders: function(e) {
				this.fire("action-save-equipment-orders", {resourceId: this.resourceId, equipmentOrders: this.equipmentOrdersDisplay});
			},

			_handleNavigateEquipmentDetails: function(e) {
				var equipmentId = e.detail.equipmentId;
				if (equipmentId) {
					this.fire("navigate-equipment-details", { 'equipmentId' : equipmentId });
				}
			},

			_pageAttached : function() {
				this._clearDirtyFlag();
				this.fire("action-load-equipment-orders");
			}
		});
	</script>
</dom-module>


<dom-module id="triplat-note" assetpath="../triplat-note/">
    <template>

    	<style>
	    	#noteContainer {
	    		overflow: auto;
	    		padding: 2px;
	    		word-wrap: break-word;
	    		border-width: 1px;
				border-style: solid;	
				border-color: var(--ibm-gray-20);
	    		background-color : var(--triplat-note-container-background-color, --tri-primary-content-background-color);
	    		@apply(--triplat-note-container);
	    	}

	    	iron-label {
	    		color : var(--triplat-note-label-color, --tri-primary-content-label-color);
	    		@apply(--triplat-note-label);
	    	}
		</style>

    	<tricore-context-path get-path="{{_contextPath}}"></tricore-context-path>
		<tricore-url raw-url="/html/en/default/smartrecord/richTextEditor/richTextEditorStyles.jsp" bind-url="{{_downloadCSSUrl}}">
		</tricore-url>
		<iron-ajax id="downloadCSSAjax" url="[[_downloadCSSUrl]]" handle-as="text" method="GET" on-response="_handleDownloadCSSResponse">
		</iron-ajax>

		<template is="dom-if" if="[[_showLabel(label)]]">
		      <iron-label for="noteContainer">[[label]]</iron-label>
	    </template>
	    <iron-label><content id="labelContent" select="[label]"></content></iron-label>
        <div id="noteContainer"></div>
    </template>
</dom-module>
<script>
    Polymer({
		is: "triplat-note",  

		 properties: {
    		
    		/*
			 * The note field to be displayed.
			 */
            value: {
                type: String,
                notify: true,
				readOnly: false,
				value: "",
				observer: "_handleValueChange"
            },

            /**
			 * The label text for the note.
			 */
            label:{
            	type: String,
            },   			
        },

		ready: function() {
			// Download the rich text editor styles customized by the user using the Style Manager.
			this.$.downloadCSSAjax.generateRequest();
		},

		attached: function(){
			if(Polymer.dom(this.$$('#labelContent')).getDistributedNodes().length >0){
				this.label=" ";
			}
		},

		_handleValueChange: function(newValue, oldValue) {
			newValue = (newValue != null ? newValue : "");
			if (oldValue == null || oldValue != newValue) {
				var noteContainer = this.$.noteContainer;
				Polymer.dom(noteContainer).innerHTML = this._adjustImagesPath(newValue);
				var allNotesElements = Polymer.dom(noteContainer).querySelectorAll('*');
				for (var i = 0; i < allNotesElements.length; i++) {
					this.toggleClass("tri-disable-theme", true, allNotesElements[i]);
				}
			}
		},

		_handleDownloadCSSResponse: function(e) {
			var style = document.createElement('style');
			Polymer.dom(this.root).appendChild(style);
			Polymer.dom(style).innerHTML = e.detail.response;
		},

		/**
		 * Add the Tririga context path to the source attribute of 'img' tags inside the note field.
		 * Only 'img' tags with relative source paths will be modified.
		 */
		_adjustImagesPath: function(note) {
			if (note == null ) {
				return note;
			}
			return note.replace(/src=\"(?!(http|\/))/gi,'src="' + this._contextPath + '/');
		},

		_hasValue: function(elem) {
			return elem != undefined && elem != null && elem.length > 0;
		},

		_showLabel: function(label) {
			return this._hasValue(label);
		},

    });
</script><dom-module id="tricomp-equipment-details" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			.hold-time-message {
				margin-bottom: 10px;
				flex-shrink: 0;
			}

			.equipment-details-container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				overflow-y: auto;
			}
			
			.header {
				padding-bottom: 10px;
			}

			.equipment-details-scrollable-area {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				@apply(--layout-scroll);
				padding: 20px;
			}

			.equipment-image {
				width: 200px;
				height: 200px;
			}

			triplat-note {
				--triplat-note-container: {
					border: none;
					padding: 0;
				};
			}

			.section-header {
				padding-top: 10px;
			}
			
			.description {
				margin: 14px 0;
			}

		</style>

		<tricore-url raw-url="/getCompanyFile.jsp?fileLoc=" bind-url="{{imgUrl}}"></tricore-url>

		<triplat-ds id="equipmentDetails" name="equipmentDetails" data="{{equipmentDetails}}" loading="{{equipmentDetailsLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]"></triplat-ds-context>
			<triplat-ds-context name="reservationLocations" context-id="[[resourceId]]"></triplat-ds-context>
			<triplat-ds-instance instance-id="[[equipmentId]]"></triplat-ds-instance>
		</triplat-ds>

		<div class="equipment-details-container">
			<tricomp-alert-message danger="" icon="ibm:clock-time" id="holdTimeMessage" class="hold-time-message" show$="[[reservationLocation.holdTimeDeadline]]" show-tooltip-indicator-icon="">
				<span hidden$="[[holdTimeExpired]]">Hold expires in</span>
				<triplat-countdown class="hold-time-countdown" name="booking-expiration" deadline="[[reservationLocation.holdTimeDeadline]]" expired-text="Hold time is expired." timezone="[[currentUser._TimeZoneId]]" is-expired="{{holdTimeExpired}}">
				</triplat-countdown>
			</tricomp-alert-message>
			<paper-tooltip for="holdTimeMessage" position="bottom" offset="5" animation-delay="100" fit-to-visible-bounds="">When the hold time on this room expires, all added food and equipment are not saved, and the room is removed for this reservation.</paper-tooltip>

			<div class="equipment-details-scrollable-area">
				<div class="tri-h2 header" hidden$="[[_isEmpty(equipmentDetails.name)]]">[[equipmentDetails.name]]</div>

				<template is="dom-if" if="[[_showImage(applicationSettings)]]">
					<section hidden$="[[!equipmentImageLoaded]]">
						<iron-image class="equipment-image" src="{{_computeImageUrl(equipmentDetails.image, imgUrl)}}" loaded="{{equipmentImageLoaded}}" sizing="contain"></iron-image>
					</section>
				</template>
				
				<div hidden$="[[_isEmpty(equipmentDetails.description)]]">
					<div class="tri-h3 section-header">Description</div>
					<div class="description">[[equipmentDetails.description]]</div>
				</div>

				<div hidden$="[[_isEmpty(equipmentDetails.descriptionNotes)]]">
					<div class="tri-h3 section-header">Equipment Details</div>
					<triplat-note value="[[equipmentDetails.descriptionNotes]]"></triplat-note>
				</div>

				<div hidden$="[[_isEmpty(equipmentDetails.featuresNotes)]]">
					<div class="tri-h3 section-header">Features</div>
					<triplat-note value="[[equipmentDetails.featuresNotes]]"></triplat-note>
				</div>
			</div>
		</div>

		<tricomp-page-toolbar small-screen-width="[[smallScreenWidth]]">
			<paper-button footer$="[[smallScreenWidth]]" on-tap="_handleDoneTap">Done</paper-button>
		</tricomp-page-toolbar>
	</template>
	<script>
		Polymer({

			is: "tricomp-equipment-details",

			behaviors: [
				TriRoomReservationUtilBehavior,
				TriBlockViewResponsiveBehavior
			],

			_isEmpty: function(val) {
				return !val || val == "";
			},

			_pageAttached : function() {
				this.$.equipmentDetails.refresh().then(function() {
				}.bind(this));
			},

			_handleDoneTap: function(e) {
				this.async(this.fire.bind(this, "done"));
			}
		});
	</script>
</dom-module>
<dom-module id="tricomp-exceptions-table" assetpath="">
	<style include="shared-page-styles">

		.section-header {
			@apply(--layout-horizontal);
			@apply(--layout-center);
			padding: 10px 20px;
		}

		.section-title-container {
			@apply(--layout-flex);
			@apply(--layout-horizontal);
			@apply(--layout-baseline);
			@apply(--layout-wrap);
		}

		.section-title {
			padding: 0 10px;
			font-weight: 500;
			font-size: 18px;
			line-height: 44px;
		}

		.section-header-links-container {
			@apply(--layout-flex);
			@apply(--layout-horizontal);
			@apply(--layout-baseline);
			@apply(--layout-wrap);
		}
		.section-header-links-container > * {
			padding: 0 10px;
		}

		.exceptions-table {
			@apply(--layout-flex);
			overflow-y: auto;
			padding: 0px 20px;

			--triblock-table-font-size: 16px;
			--triblock-table-header-color: var(--ibm-blue-50);
		}

		.exceptions-table-date-column {
			--triblock-table-column-fixed-width: 140px;
		}

		.exceptions-table-action-buttons-column {
			--triblock-table-column-fixed-width: 64px;
		}

		paper-icon-button {
			flex-shrink: 0;
			height: 44px;
			width: 44px;
			padding: 6px;
		}

		.auto-assign-icon {
			color: var(--tri-warning-color);
			padding-right: 5px;
			flex-shrink: 0;
		}
		.auto-assign-label-container {
			@apply(--layout-horizontal);
			@apply(--layout-center);
		}

	</style>

	<template>
        <div class="section-header">
            <div class="section-title-container">
                <div class="section-title">Schedule</div>
                <div class="section-header-links-container">
                    <div class="link" on-tap="_handleAutoAssignAll">Auto-assign All</div>
                    <div class="link" on-tap="_handleClearAllAssignments">Clear All Assignments</div>
                </div>
            </div>
        </div>

        <triblock-table class="exceptions-table" data="{{exceptionOccurrences}}" disable-row-hover-styling="">
            <triblock-table-column title="Scheduled Date" class="exceptions-table-date-column">
                <template>
                    <div hidden$="[[!item.exceptionDateTime]]">[[item.formattedDate]]</div>
                </template>
            </triblock-table-column>

            <triblock-table-column title="Booked Room">
                <template>
                    <div hidden$="[[!item.alternateResource]]">[[item.alternateResource]]</div>
                    <div hidden$="[[item.alternateResource]]" class="link auto-assign-label-container">
                        <iron-icon icon="ibm:warning" class="auto-assign-icon"></iron-icon>
                        <span class="" on-tap="_handleAutoAssign">Auto-assign</span>
                    </div>
                </template>
            </triblock-table-column>

            <triblock-table-column class="exceptions-table-action-buttons-column" merge-with-previous-column="">
                <template>
                    <paper-icon-button danger="" hidden$="[[!item.alternateResourceRecordId]]" icon="ibm:remove-delete" on-tap="_handleClearAssignment">Delete</paper-icon-button>
                    <paper-icon-button primary="" hidden$="[[item.alternateResourceRecordId]]" icon="ibm:search" on-tap="_handleSearch">Search</paper-icon-button>
                </template>
            </triblock-table-column>
        </triblock-table>
	</template>
	<script>
		Polymer({

			is: "tricomp-exceptions-table",

			behaviors: [
				TriReservationUtilitiesBehavior,
				TriRoomReservationUtilBehavior,
				TriDateUtilities,
				TriBlockViewResponsiveBehavior,
				Polymer.IronResizableBehavior
			],

			properties: {
				exceptionOccurrences: Object
			},

			observers: [
				"_observeExceptionOccurrences(exceptionOccurrences)"
			],

			_handleClearAssignment: function(e) {
				var item = e.model.item;
				if (item) {
					var occurrenceId = item._id;

					this.fire("action-exception-clear-assignment", {'occurrenceId': occurrenceId});
				}
			},

			_handleClearAllAssignments: function(e) {
				this.fire("action-exception-clear-assignment-all");
			},

			_handleSearch: function(e) {
				var item = e.model.item;

				this.fire("search-room", {'item': item});
			},

			_handleAutoAssign: function(e) {
				var item = e.model.item;
				if (item) {
					var occurrenceId = item._id;

					this.fire("action-exception-auto-assign", {'occurrenceId': occurrenceId});
				}
			},

			_handleAutoAssignAll: function(e) {
				this.fire("action-exception-auto-assign-all");
			},

			_observeExceptionOccurrences: function() {
				this.debounce(
					"tableChanged",
					function() {
						this.notifyResize();
					},
					500
				);
			}

		});
	</script>
</dom-module>
<dom-module id="tricomp-exceptions" assetpath="">
	<template>
		<style include="shared-page-styles">

			:host {
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			.exceptions-container {
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			.header {
				padding: 10px 20px;
				background-color: var(--ibm-gray-10);
				font-size: 16px;
			}

			iron-pages {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				overflow-y: auto;
			}

			tricomp-room-criteria {
				@apply(--layout-flex);
				padding: 0 20px;
			}

			triblock-search {
				@apply(--layout-vertical);
				@apply(--layout-flex);
				padding: 10px 25px;
			}

		</style>

		<triplat-ds id="exceptionOccurrencesForResource" name="exceptionOccurrences" filtered-data="{{exceptionOccurrencesForResource}}" loading="{{exceptionOccurrencesLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[specId]]"></triplat-ds-context>
			<triplat-query>
				<triplat-query-filter name="resourceId" operator="equals" value="[[resourceId]]"></triplat-query-filter>
			</triplat-query>
		</triplat-ds>

		<div class="exceptions-container" hidden$="[[!exceptionOccurrencesForResource.length]]">		
			<tricomp-alert-message danger="" icon="ibm:clock-time" id="holdTimeMessage" class="hold-time-message" show$="[[reservationLocation.holdTimeDeadline]]" show-tooltip-indicator-icon="">
				<span hidden$="[[holdTimeExpired]]">Hold expires in</span>
				<triplat-countdown class="hold-time-countdown" name="booking-expiration" deadline="[[reservationLocation.holdTimeDeadline]]" expired-text="Hold time is expired." timezone="[[currentUser._TimeZoneId]]" is-expired="{{holdTimeExpired}}">
				</triplat-countdown>
			</tricomp-alert-message>
			<paper-tooltip for="holdTimeMessage" position="bottom" offset="5" animation-delay="100" fit-to-visible-bounds="">When the hold time on this room expires, all added food and equipment are not saved, and the room is removed for this reservation.</paper-tooltip>

			<div class="header">Recurring Meeting Exceptions</div>

			<triblock-tabs id="exceptionTab" iron-pages-id="tabPages" selected="selectRoomsTab">
				<triblock-tab id="selectRoomsTab" label="Select Rooms" iron-page-id="selectRoomsPage"></triblock-tab>
				<triblock-tab id="criteriaTab" label="Change Search Criteria" iron-page-id="criteriaPage"></triblock-tab>
			</triblock-tabs>
			
			<iron-pages id="tabPages" attr-for-selected="tab" on-iron-select="_ironPageChanged">
				<tricomp-exceptions-table tab="selectRoomsPage" exception-occurrences="{{exceptionOccurrencesForResource}}" on-search-room="_handleSearch"></tricomp-exceptions-table>

				<template is="dom-if" if="[[isActive]]">
					<tricomp-room-criteria id="roomCriteriaPageExceptions" tab="criteriaPage" is-outlook-embedded="[[isOutlookEmbedded]]" override-building-id="{{buildingId}}" current-user="[[currentUser]]" favorite-rooms="{{favoriteRooms}}" reservation-manager="{{reservationManager}}" reservation-locations="{{reservationLocations}}" spec-id="[[specId]]" has-booked-rooms="[[_hasBookedRooms]]" no-action-bar="" no-popup="" scroller="[[_scroller]]" search-value="[[_searchValue]]" search-result="{{_lookupBuildingSearch}}" loading="{{_lookupBuildingLoading}}">
					</tricomp-room-criteria>
				</template>

				<tricomp-room-results id="roomResultsPage" tab="roomResultsPage" is-outlook-embedded="[[isOutlookEmbedded]]" current-user="[[currentUser]]" application-settings="[[applicationSettings]]" favorite-rooms="{{favoriteRooms}}" reservation-manager="{{reservationManager}}" reservation-locations="{{reservationLocations}}" resource-id="[[resourceId]]" spec-id="[[specId]]" hide-availability-tab="" is-workspace-room="[[_isRoomTypeWorkspace(reservationManager.searchRoomType, _workspaceId)]]">&gt;
				</tricomp-room-results>

				<triblock-search id="searchPage" tab="searchPage" title="[[_searchTitle]]" placeholder="[[searchPlaceholder]]" scroller="{{_scroller}}" search-value="{{_searchValue}}" search-result="[[_lookupBuildingSearch]]" loading="[[_lookupBuildingLoading]]" search-only="" on-item-selected="_searchItemSelected">
					<template>
						<tricomp-location-card data="[[item]]" search-value="[[_searchValue]]"></tricomp-location-card>
					</template>
				</triblock-search>
			</iron-pages>
		</div>

		<template is="dom-if" if="[[!exceptionOccurrencesForResource.length]]">
			<div class="page-main empty-data-message">
				<span hidden$="[[_pageLoading]]">This room reservation does not have any exceptions.</span>
			</div>
		</template>

		<tricomp-page-toolbar small-screen-width="[[smallScreenWidth]]">
			<paper-button footer$="[[smallScreenWidth]]" on-tap="_handleDoneTap">Done</paper-button>
		</tricomp-page-toolbar>
	</template>
	<script>
		Polymer({

			is: "tricomp-exceptions",

			behaviors: [
				TriReservationUtilitiesBehavior,
				TriRoomReservationUtilBehavior,
				TriDateUtilities,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				_pageLoading: {
					type: Boolean,
					computed: "_isBusy(isBusy, exceptionOccurrencesLoading)"
				},
				isActive: {
					type: Boolean,
					observer: "_onActiveChanged"
				},
				buildingId: Number
			},

			observers: [
				"_handleExceptionOccurrencesChanged(exceptionOccurrencesForResource)"
			],

			listeners: {
				"open-search-without-popup": "_openSearchWithoutPopup"
			},

			_onActiveChanged: function(isActive) {
				if (isActive) {
					this.async(function() {
						this.$$("#roomCriteriaPageExceptions")._pageAttached();
					});
					this.$.roomResultsPage._pageAttached(true);
					this.$.roomResultsPage.refresh();
				} else {
					if (this.$.roomResultsPage) {
						this.$.roomResultsPage._pageDetached();
					}
				}
			},

			_handleExceptionOccurrencesChanged: function(exceptionOccurrencesForResource) {
				if (exceptionOccurrencesForResource && exceptionOccurrencesForResource.length > 0) {
					this.$.tabPages.selected = "selectRoomsPage";
					this.$.exceptionTab.selected = "selectRoomsTab";

					for (var i = 0; i < exceptionOccurrencesForResource.length; i++) {
						var item = exceptionOccurrencesForResource[i];
						var formattedDate = moment.tz(item.exceptionDateTime, this.currentUser._TimeZoneId).formatWithJDF(this.currentUser._DateFormat);
						item['formattedDate'] = formattedDate;
					}
				}
			},

			// TODO: Push back to MAIN - eliminate RM usage
			_handleSearch: function(e) {
				var item = e.detail.item;

				if (item) {
					this._setBusy();

					var occurrenceId = item._id;
					var occurrenceDate = item.exceptionDateTime;

					var wfParams = {};
					wfParams.occurrence = occurrenceId;

					this.rm.updateRecord(TriPlatDs.RefreshType.SERVER, "actions", "exceptionSearch", wfParams).then(function() {
						this._clearBusy();

						this.$.roomResultsPage._pageAttached(true);
						this.$.roomResultsPage.refresh();
						this.$.tabPages.selected = "roomResultsPage";
						this.$.roomResultsPage.occurrenceId = occurrenceId;

					}.bind(this));
				}
			},

			_handleDoneTap: function(e) {
				this.fire("done");
			},

			// override
			_isBusy: function(isBusy, exceptionOccurrencesLoading) {
				return isBusy  || exceptionOccurrencesLoading;
			},

			// TODO: Push back to MAIN - eliminate RM usage
			_setOccurrenceSeriesContext: function(occurrenceId) {
				return new Promise(function(resolve) {
					var wfParams = {};
					wfParams.occurrence = occurrenceId;

					this.rm.updateRecord(this.reservationManager._id, TriPlatDs.RefreshType.SERVER, "actions", "setOccurrenceSeriesContext", wfParams).then(function() {
						resolve();
					}.bind(this));
				}.bind(this));
			},

			// override
			_pageAttached : function() {
				this._setOccurrenceSeriesContext().then(function() {
					this.$.exceptionOccurrencesForResource.refresh();
				}.bind(this));

				this.async(function() {
					this.$$("#roomCriteriaPageExceptions").reloadLocalstorage();
				}, 300);
			},

			_ironPageChanged: function(e) {
				if (this.$$("#roomCriteriaPageExceptions")) {
					// If the search page is active, enable the building search DS
					if (this.$.tabPages.selected == "searchPage") {
						this.$$("#roomCriteriaPageExceptions").enableSearchDs();
					} else if (this.$.tabPages.selected != "searchPage") {
						this.$.searchPage.clearSearch();
						this.$$("#roomCriteriaPageExceptions").disableSearchDs();
					}
				}
			},

			_openSearchWithoutPopup: function() {
				this.debounce(
					"openSearchWithoutPopup",
					function() {
						this.$.tabPages.selected = "searchPage";
					},
					200
				);
			},

			_searchItemSelected: function(e) {
				var building = e.detail;

				// Set an override-building-id
				this.set("buildingId", building._id);

				this.$.tabPages.selected = "criteriaPage";
			}
			
		});
	</script>
</dom-module>


// to be removed?

<dom-module id="tricomp-error-prompt" assetpath="">
	<template>
		<style>
			:host {
				display: block;
				font-family: var(--tri-font-family);
			}

			a {
				text-decoration: underline;
				cursor: pointer;
				color: var(--tri-primary-color) !important;
			}

			.content {
				overflow: auto;
			}

			.error-details-collapser {
				cursor: pointer;
				color: var(--tri-error-color);
			}
		</style>

		<triplat-signout id="signout"></triplat-signout>
		
		<div class="content">
			<p>An error occurred. Please contact your server administrator.</p>

			<p>You can either <a on-tap="_handleRefreshPageTap">refresh the page</a> or <a on-tap="_handleLogOutTap">log out</a>.</p>

			<p class="error-details-collapser" on-tap="_handleErrorDetailsTap" hidden$="{{!_showErrorDetails(errorDetails, isAdmin)}}"><iron-icon icon="{{_computeCollapseIcon(_errorDetailsOpened)}}"></iron-icon>Error details:</p>
			<iron-collapse opened="{{_errorDetailsOpened}}" aria-labelledby="errorDetails">
				<span id="errorDetailsSpan"></span>
			</iron-collapse>
		</div>

	</template>
	<script>
		Polymer({

			is: "tricomp-error-prompt",

			properties: {
				errorDetails: {
					type: Object,
					value: {}
				},
				_errorDetailsOpened: {
					type: Boolean,
					value: false
				},
				isAdmin: {
					type: Boolean,
					value: false
				}
			},

			_computeCollapseIcon: function(errorDetailsOpened) {
				return (errorDetailsOpened) ? "hardware:keyboard-arrow-down" : "hardware:keyboard-arrow-right";
			},

			_handleErrorDetailsTap: function() {
				this.set("_errorDetailsOpened", !this._errorDetailsOpened);
				this.fire("error-details-collapse-or-expand");
			},

			_handleLogOutTap: function() {
				this.$.signout.signout();
			},

			_handleRefreshPageTap: function() {
				location.reload();
			},

			_showErrorDetails: function(errorDetails, isAdmin) {
				if (!isAdmin) return false;
				if (errorDetails && Object.keys(errorDetails).length > 0) {
					var errorDetailsString = JSON.stringify(this.errorDetails, null, '\t');
					var errorDetailsHTML = errorDetailsString.replace(new RegExp("\n", "g"), "<br>");
					errorDetailsHTML = errorDetailsHTML.replace(new RegExp("\t", "g"), "&nbsp;&nbsp;&nbsp;&nbsp;")
					this.$.errorDetailsSpan.innerHTML = errorDetailsHTML;
					return true;
				}
				return false;
			}

		});
	</script>
</dom-module>
<dom-module id="triapp-reservation-list" assetpath="../triapp-reservation-list/">
	<template>
		<style>
			:host {
				@apply(--layout-vertical);
			}
			:host([list-view]:not([small-screen-width])) {
				@apply(--layout-horizontal);
				@apply(--layout-wrap);
			}

			.no-reservations-placeholder {
				@apply(--layout-flex);
				padding: 15px 15px 0 15px;
				font-size: 18px;
				font-weight: 300;
			}
			.no-reservations-placeholder > * {
				text-align: center;
				margin: 0;
			}

			paper-icon-button {
				width: 44px;
				height: 44px;
				padding: 10px;
			}

			triblock-scroll-container {
				--triblock-scroll-container-button-background: var(--ibm-blue-50);
				--triblock-scroll-container-left-arrow: 25px;
				--triblock-scroll-container-right-arrow: 25px
			}

			.cancel-dialog {
				@apply(--layout-vertical);
				@apply(--layout-center-center);
			}

			.loading-indicator {
				margin: 20px;
				text-align: center;
			}

			.reservation-padding{
				padding-left: 30px;
			}

			:host([list-view]:not([small-screen-width])) .loading-indicator {
				@apply(--layout-flex);
				flex-basis: 100%;
			}

			#roomPopup {
				width: 80%;
				height: 80%;
				max-width: 600px;
				padding: 0px;
			}

		</style>

		
		<triplat-ds id="currentUser" name="currentUser" data="{{currentUser}}" loading="{{currentUserLoading}}"></triplat-ds>

		<triplat-ds id="reservationInstances" name="reservationInstances" data="{{reservationInstances}}" loading="{{reservationInstancesLoading}}" manual=""></triplat-ds>

		<triplat-ds id="reservationsForPerson" name="reservationsForPerson" data="{{reservationsForPerson}}" loading="{{reservationsForPersonLoading}}">
			<triplat-ds-instance instance-id="[[currentUser.person.data._id]]"></triplat-ds-instance>
		</triplat-ds>

		<triplat-ds id="myReservationEvents" name="myReservationEvents" data="{{myReservationEvents}}" loading="{{myReservationEventsLoading}}" manual="">
			<triplat-ds-context name="reservationsForPerson" context-id="{{currentUser.person.data._id}}">
			</triplat-ds-context>
			<triplat-query id="myReservationEventsQuery">
				<triplat-query-resource-calendar start-date="[[_range.start]]" end-date="[[_range.end]]">
				</triplat-query-resource-calendar>
			</triplat-query>
		</triplat-ds>

		<triplat-ds id="myReservationManagers" name="myReservationManagers" data="{{myReservationManagers}}" manual=""></triplat-ds>

		<triplat-ds id="myOldReservationManagers" name="myOldReservationManagers" data="{{myOldReservationManagers}}" manual=""></triplat-ds>

		<triplat-ds id="reservationManager" name="reservationManager" data="{{reservationManager}}" loading="{{reservationManagerLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[reservationManagerSpecId]]">
			</triplat-ds-context>
		</triplat-ds>

		<triplat-ds id="reservationManagerInstance" name="reservationManagerInstance" data="{{reservationManagerInstance}}" loading="{{reservationManagerInstanceLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[reservationManagerSpecId]]">
			</triplat-ds-context>
		</triplat-ds>

		<triplat-ds id="reservationLocations" name="reservationLocations" data="{{reservationLocations}}" loading="{{reservationLocationsLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[reservationManagerSpecId]]">
			</triplat-ds-context>
		</triplat-ds>

		<triplat-ds id="exceptionOccurrences" name="exceptionOccurrences" data="{{exceptionOccurrences}}" loading="{{exceptionOccurrencesLoading}}" manual="">
			<triplat-ds-context name="myReservationManagers" context-id="[[reservationManagerSpecId]]">
			</triplat-ds-context>
		</triplat-ds>

		<tricore-url hidden="" raw-url="/p/web/roomReservation" bind-url="{{mainUrl}}"></tricore-url>

		<template is="dom-if" if="[[!listView]]">
			<tricomp-reservation-month-title main-url="[[mainUrl]]" home-app="[[homeApp]]"></tricomp-reservation-month-title>
		</template>

		<div class="loading-indicator" hidden="[[!_isLoading]]">
			<paper-spinner active=""></paper-spinner>
		</div>

		<template is="dom-if" if="[[reservationsGroupByDate]]">
			<template is="dom-if" if="[[!listView]]">
				<triblock-scroll-container class="reservation-padding" id="cardsContainer" auto-height="">
					<template is="dom-repeat" items="{{reservationsGroupByDate}}" as="dayGroupedItems">
						<template is="dom-repeat" items="{{dayGroupedItems}}">

							<tricomp-reservation-list-item event-item="{{item}}" current-user="[[currentUser]]" is-card="[[!listView]]">
							</tricomp-reservation-list-item>

						</template>
					</template>
				</triblock-scroll-container>
			</template>

			<template is="dom-if" if="[[listView]]">
				<template is="dom-repeat" items="[[reservationsGroupByDate]]">
					<tricomp-reservation-list-group group="[[item]]" current-user="[[currentUser]]" is-card="[[!listView]]" is-last-group="[[_computeIsLastGroup(index)]]" hidden="[[_isLoading]]">
					</tricomp-reservation-list-group>
				</template>
			</template>
		</template>

		<template is="dom-if" if="[[!reservationsGroupByDate]]">
			<div class="no-reservations-placeholder" hidden="[[_isLoading]]">
				<div>You do not have any reservations in progress for [[selectedMonth]].</div>
			</div>
		</template>

		<triblock-popup id="roomPopup" with-backdrop="">
			<tricomp-reservation-room-details id="roomDetails" action-label="[[actionLabel]]"></tricomp-reservation-room-details>
		</triblock-popup>

		<paper-dialog id="cancelDialog" class="cancel-dialog" with-backdrop="">
			<p>Please wait while we cancel your reservation.</p>
			<paper-spinner active=""></paper-spinner>
		</paper-dialog>

		<paper-toast id="toast" text=""></paper-toast>

	</template>
	<script>
		Polymer({

			is: "triapp-reservation-list",

			behaviors: [
				TriReservationActionsBehavior,
				TriReservationUtilitiesBehavior,
				TriPlatViewBehavior,
				TriDateUtilities,
				TriBlockViewResponsiveBehavior
			],

			properties: {
				reservationsGroupByDate: Array,
				selectedMonth: String,
				initialMonth: {
					type: Object,
					notify: true
				},
				count: {
					type: Number,
					computed: "_computeRecordCount(reservationsGroupByDate)",
					notify: true
				},
				homeApp: {
					type: String
				},
				listView: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},
				rangeStart: String,
				rangeEnd: String,
				actionLabel: String,
				_isLoading: {
					type: Boolean,
					computed: "_isBusy(isBusy, myReservationEventsLoading, reservationInstancesLoading, reservationsForPersonLoading)"
				},
				_range: {
					type: Object,
					value: function() {
						return {
							start: "",
							end: ""
						}
					}
				}
			},

			listeners: {
				"navigate-reservation-open": "_handleOpenReservation",
				"dom-change": "_handleDomChange",
				"reservation-resources-change": "_handleReservationResourcesChange",
				"reservation-room-detail-open": "_handleOpenRoomDetails",
				"reservation-room-location-close": "_handleCloseRoomDetails"
			},

			observers: [
				'_handleEvents(myReservationEvents, currentUser._TimeZoneId)',
				'_setInitialYearMonth(currentUser._TimeZoneId)',
				'_setNewRange(rangeStart, rangeEnd)',
				"_observeRange(_range)"
			],

			_isBusy: function(isBusy, myReservationEventsLoading, reservationInstancesLoading, reservationsForPersonLoading) {
				return isBusy || myReservationEventsLoading || reservationInstancesLoading || reservationsForPersonLoading;
			},

			_handleOpenReservation: function(e) {
				var reservationId = e.detail.reservationId;
				var occurrenceStart = e.detail.occurrenceStart != null ? this.toMilliseconds(e.detail.occurrenceStart): -1;
				var occurrenceEnd = e.detail.occurrenceEnd != null ? this.toMilliseconds(e.detail.occurrenceEnd): -1;
				if (reservationId) {
					this.fire("set-busy");

					var url = this.mainUrl;
					if (this.homeApp) {
						url += "?homeApp=" + this.homeApp + "&";
					}
					url += "#!/open/" + reservationId + "/" + occurrenceStart + "/" + occurrenceEnd;

					this._openUrl(url);
				} else {
					console.error("Cannot open reservation because [reservationId] was not specified.");
				}
			},

			_openUrl: function(url) {
				this.fire("set-busy");
				this.async(function() {
					location.assign(url);
				});
			},

			_computeRecordCount: function(reservationGroups) {
				var count = (Boolean(reservationGroups) && reservationGroups.length > 0) ? reservationGroups[0].length : 0;
				return count;
			},

			_setInitialYearMonth: function(timezone) {
				var mo = moment();

				var lang = document.querySelector('html').getAttribute("lang") || 'en';
				var monthNameMo = moment.tz(mo, timezone);
				monthNameMo.locale(lang);
				var monthName = monthNameMo.format("MMMM");

				this.set('selectedMonth', monthName);

				var startMo = mo.clone();
				startMo = startMo.set({'date': 1, 'hour': 0, 'minute': 0, 'second': 0, 'millisecond': 0});
				var startISOpreTZ = startMo.format("YYYY-MM-DDTHH:mm:ss.SSSZ");
				var startISO = this.normalizeToTimezone(startISOpreTZ, timezone);

				var endMo = startMo.clone();
				endMo = endMo.add(1, "M");
				var endISOpreTZ = endMo.format("YYYY-MM-DDTHH:mm:ss.SSSZ");
				var endISO = this.normalizeToTimezone(endISOpreTZ, timezone);

				// Set initial month
				var initialMonth = {
					startDate: startMo,
					endDate: endMo
				};
				this.set("initialMonth", initialMonth);

				this._setRange(startISO, endISO);
			},

			_sortEvents: function(events, timezone) {
				events.sort(function(a, b) {
					var aMo = moment(a._Start_Datetime).tz(timezone);
					var bMo = moment(b._Start_Datetime).tz(timezone);

					if (aMo._d > bMo._d) {
						return 1
					} else if (aMo._d < bMo._d) {
						return -1;
					} else {
						return 0;
					}
				});
			},

			_bindMatchingEventInstance: function(reservationInstances, event) {
				var rdSpecId = this._getEventId(event);

				for (var i = 0; i < reservationInstances.length; i++) {
					var reservationInstance = reservationInstances[i];

					// match-up the instace based on the Reservation Definition specId and the StartDateTime of the event
					if (reservationInstance._rdSpecId == rdSpecId && reservationInstance.startDateTime == event._Start_Datetime) {
						event.reservationInstance = reservationInstance;
						break;
					}
				}
			},

			_getEventId: function(event) {
				if (!event._Event_Id) {
					return event._Master_Recurring_Event_Id;
				}

				return event._Event_Id;
			},

			_handleEvents: function(events, timezone) {
				var reservationDateGroups = [];

				if (events && events.length > 0 && timezone) {

					this.$.reservationInstances.refresh().then(function() {
						var reservationInstances = this.$.reservationInstances.data;

						this._sortEvents(events, timezone);

						var tempReservationDateGroup = [];
						var tempReservationStartMo = null;
						var nowMo = moment().tz(timezone);

						for (var i = 0; i < events.length; i++) {
							var reservation = events[i];

							// preserve the Start Time before it has been timezone-converted
							reservation._Orig_Start_Datetime = reservation._Start_Datetime;
							var reservationStartMo = moment(reservation._Start_Datetime).tz(timezone);

							// preserve the End Time before it has been timezone-converted
							reservation._Orig_End_Datetime = reservation._End_Datetime;
							var reservationEndMo = moment(reservation._End_Datetime).tz(timezone);

							// if we are already beyond the end time of the reservation, discard it
							if (reservationEndMo.isBefore(nowMo, "second")) {
								continue;
							}

							// only bind instances for today
							if (this._isToday(nowMo, reservationStartMo, timezone) || this._isToday(nowMo, reservationEndMo, timezone)) {
								this._bindMatchingEventInstance(reservationInstances, reservation);

								// if there is a bound instance, discard this event if the meeting has been checked-out/ended, or cancelled
								if (reservation.reservationInstance && (reservation.reservationInstance.actualEnd || reservation.reservationInstance.cancellationDateTime)) {
									continue;
								}
							}

							if (!tempReservationStartMo) {
								if (reservationStartMo.isBefore(nowMo, "day") ) {
									tempReservationStartMo = nowMo;
								} else {
									tempReservationStartMo = reservationStartMo;
								}
							}

							if (this.listView) {
								if (reservationStartMo.isSame(tempReservationStartMo, "day") || reservationStartMo.isBefore(tempReservationStartMo, "day")) {
									tempReservationDateGroup.push(reservation);
								} else {
									reservationDateGroups.push(tempReservationDateGroup);
									tempReservationDateGroup = [];
									tempReservationStartMo = reservationStartMo;
									tempReservationDateGroup.push(reservation);
								}
							} else {
							// put them all in a single grouping - since we're not doing daily grouping like the reservation list
								tempReservationDateGroup.push(reservation);
							}
						}

						// Push the temporary array after the `for` loop
						if (tempReservationDateGroup && tempReservationDateGroup.length !== 0) {
							reservationDateGroups.push(tempReservationDateGroup);
						}

						this._resetReservationDateGroups(reservationDateGroups);
					}.bind(this));
				} else {
					this._resetReservationDateGroups(reservationDateGroups);
				}
			},

			_resetReservationDateGroups: function(reservationDateGroups) {
				this.debounce('_resetReservationGroups', function () {
					this.set("reservationsGroupByDate", null);
					this.async(function() {
						if (reservationDateGroups.length == 0) {
							this.set("reservationsGroupByDate", null);
						} else {
							this.set("reservationsGroupByDate", reservationDateGroups);
						}
					});
				});
			},

			_isToday: function(todayMo, datetimeMo, timezone) {
				if (!todayMo) {
					todayMo = moment().tz(timezone);
				}

				return datetimeMo.isSame(todayMo, 'day');
			},

			created: function() {
				// TODO: To be fixed
				moment.locale("en");
			},

			doRefresh: function() {
				this.debounce('doRefresh', function () {
					if (this.$.myReservationEvents) {
						this.$.myReservationEvents.refresh();
					}
				});
			},

			_setRange: function(start, end) {
				var range = new Object();

				range.start = start;
				range.end = end;

				this.set("_range", range);
			},

			_handleDomChange: function() {
				this._cardsNotifyResize();
			},

			_handleReservationResourcesChange: function() {
				this._cardsNotifyResize();
			},

			_cardsNotifyResize: function() {
				this.debounce(
					"cardsChanged",
					function() {
						var cardsContainer = document.querySelector("#cardsContainer");
						if (cardsContainer) {
							cardsContainer.notifyResize();
						}
					},
					500
				);
			},

			_setNewRange: function(start, end) {
				if (start && end && start !== "" && end !== "") {
					this._setRange(start, end);
				}
			},

			_computeIsLastGroup: function(index) {
				if (this.reservationsGroupByDate.length - 1 === index) {
					return true;
				} else {
					return false;
				}
			},

			_handleOpenRoomDetails: function(e) {
				var item = e.detail;
				this.$.roomDetails.eventItem = item.eventItem;
				this.$.roomDetails.applicationSettings = item.applicationSettings;
				this.$.roomPopup.openPopup();
			},

			_handleCloseRoomDetails: function(){
				this.$.roomPopup.closePopup();
			},

			_observeRange: function(range) {
				Polymer.RenderStatus.afterNextRender(this, function() {
					this.$.myReservationEvents.refresh();
				});
			}

		});
	</script>
</dom-module>
</div><dom-module id="triview-room-reservation">
	<template>
		<style>
			triblock-app-layout {
				--triblock-app-layout-body-background-color: white;
				--triblock-app-layout-mobile-drawer-z-index: 104;
			}

			trimain-room-reservation {
				@apply(--layout-flex);
				@apply(--layout-vertical);
			}
		</style>

		<tricore-url id="triurl" hidden=""></tricore-url>

		<triblock-app-layout id="appLayout" home-app="[[homeApp]]" app-label="[[homeAppLabel]]" mobile-page-label="[[mobilePageLabel]]" show-mobile-back-button="[[showMobileBackButton]]" hide-signout-button="">

			<triblock-banner-button tap-handler="_handleBannerNavigateHome" home=""></triblock-banner-button>
			<triblock-banner-button back="" tap-handler="_handleBackButtonTap"></triblock-banner-button>

			<triblock-banner-button icon="ibm:sign-out" label="Sign Out" tap-handler="_handleSignout"></triblock-banner-button>

			<trimain-room-reservation id="appMain" home-app="[[homeApp]]" content=""></trimain-room-reservation>

		</triblock-app-layout>
	</template>
	<script>
		Polymer({

			is: "triview-room-reservation",
			
			behaviors: [
				TriPlatViewBehavior, 
				TriLazyLoadingBehavior,
				TriHomeAppBehavior,

				TriBlockAppLayoutBannerRoutingBehavior,
				TriBlockAppLayoutBannerPopupBehavior,
				TriBlockAppLayoutBannerIronPagesBehavior,
				TriBlockAppLayoutBannerResponsiveLayoutBehavior,
			],

			properties: {
				_popupElement: Object,
				_ironPages: Object,
				_responsiveLayoutView: Object,
			},

			listeners: {
				'navigate-home': '_navigateHome',

				'reservation-list-route-active': '_manageAppLayoutBannerRoute',
				'reservation-new-route-active': '_manageAppLayoutBannerRoute',
				'reservation-open-route-active': '_manageAppLayoutBannerRoute',
				'find-room-route-active': '_manageAppLayoutBannerRoute',
				'reservation-summary-route-active': '_manageAppLayoutBannerRoute',

				'popup-page-opened': '_managePopupPages',
				'responsive-layout-switch-view-display':'_manageResponsiveLayoutSwitchView',

				'route-active': '_closeOpenedPopups',
				'signout': '_signout'
			},

			_isBlank: function(val) {
				return !val || val == "";
			},

			ready: function() {
				document.querySelector("body").style.height = "auto";
				this._convertUrlSearchToRoute();
				Polymer.RenderStatus.afterNextRender(this, function(){
					this._loadAppMain();
				});
			},

			_convertUrlSearchToRoute: function() {
				/*
				 * The open route can be activated when loading the app if some search paramaters are passed.
				 * Ex: The url /p/web/roomReservation?route=open&id=123456&start=555555&end=6666666
				 * will activate the route open route.
				 * This is used by Outlook room search add-in because of a limitation on Windows Outlook about
				 * about passing hash parameters when opening a page from the add-in.
				 */
				var urlSearch = window.location.search;
				urlSearch = urlSearch != null ? urlSearch : "";
				var searchParametersMatchOpenRoute = urlSearch.match(/route=open&id=(\d+)&start=([\d,-]+)&end=([\d,-]+)/);
				if (searchParametersMatchOpenRoute != null && searchParametersMatchOpenRoute.length == 4) {
					window.location.hash =  "#!/open/" + searchParametersMatchOpenRoute[1] + "/" + searchParametersMatchOpenRoute[2] + "/" + searchParametersMatchOpenRoute[3];
				}
			},

			_handleBannerNavigateHome: function(e) {
				if (this.$.appMain.$.reservationSummaryRoute.active 
					|| this.$.appMain.$.reservationSummaryPage.addAnotherRoomActive && this.$.appMain.$.reservationFindRoomRoute.active) {
					// if user navigates to "Summary" page, DO NOT skip reservationManager.isDirty check
					// if user navigates to "Find Room" page via "Add another room" button on "Summary" page, DO NOT skip reservationManager.isDirty check
					this._navigateHome( { detail: { validated: false } });
				} else {
					// for other pages, skip reservationManager.isDirty check
					this._navigateHome( { detail: { validated: true } } );
				}
			},

			_navigateHome: function(e) {
				if (e && e.detail && e.detail.validated) {
					if (this.homeUrl) {
						location.assign(this.homeUrl);
					} else {
						this.fire('navigate-app-home', {}, {node: this.$.appMain});
					}
				} else {
					this.fire('navigate-app-home-validate', {}, {node: this.$.appMain});
				}
			},

			_loadAppMain: function() {
				this.loadResource(this.$.appMain, "trimain-room-reservation.html");
			},

			_getDefaultAppLabel: function() {
				var __dictionary__appLabel =  "Room Reservation";
				return __dictionary__appLabel;
			},

			_manageAppLayoutBannerRoute: function(e){
				this.manageBannerOnRouteChange(e.detail);
			},	

			_managePopupPages: function(e){
				this._ironPages = e.detail.ironPages;
				this._popupElement = e.detail.popup;
				this.manageBannerOnIronPagesChange(this._ironPages);
			},

			_manageResponsiveLayoutSwitchView: function(e){
				var responsiveLayoutView = e.detail.currentView;
				this._responsiveLayoutView = e.detail.currentView;
				this.manageBannerOnResponsiveLayoutChange(this._responsiveLayoutView);
			},

			_handleBackButtonTap: function() {
				var isPopupOpened = this.isPopupOpened();
				if(isPopupOpened){
					this.managePopupBackBehavior();
					//Iron pages use inside popup
					if(this._ironPages){
						this.navigateToPreviousIronPages(this._ironPages);
					}
				}
				else if(this._responsiveLayoutView){
					this.navigateToPreviousView(this._responsiveLayoutView);
				}
				else{
					this.navigateToPreviousRoutedPage();
				}
			},

			_handleNoPreviousPage: function(){
				if(this._popupElement){
					this._popupElement.closePopup();
				}
			},

			_handleNoPreviousView: function(){
				window.history.back();
			},

			_closeOpenedPopups: function(e) {
				if (!e.detail.active && this._openedPopupElement && !this.smallScreenWidth) {
					this._openedPopupElement.closePopup();
				}
			},

			_handleSignout: function() {
				if (this.$.appMain.$.reservationSummaryRoute.active) {
					// if user taps on signout button while on "Summary" page, DO NOT skip reservationManager.isDirty check
					this.fire('navigate-app-home-validate', { intention: "signout" }, {node: this.$.appMain});
				} else if (this.$.appMain.$.reservationSummaryPage.addAnotherRoomActive && this.$.appMain.$.reservationFindRoomRoute.active) {
					// if user taps on signout button while on "Find Room" page via "Add another room" button, DO NOT skip reservationManager.isDirty check
					this.fire('navigate-app-home-validate', { intention: "signout" }, {node: this.$.appMain});
				} else {
					// for other pages, on signout button tap, skip reservationManager.isDirty check
					this._signout();
				}
			},

			_signout: function() {
				this.$.appLayout._signout();
			},

		});
	</script>
</dom-module>
</body></html>
